(()=>{var e={};e.id=931,e.ids=[931],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4596:(e,t,n)=>{"use strict";n.r(t),n.d(t,{GlobalError:()=>s.a,__next_app__:()=>h,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d}),n(908),n(1506),n(5866);var r=n(3191),i=n(8716),o=n(7922),s=n.n(o),a=n(5231),l={};for(let e in a)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>a[e]);n.d(t,l);let d=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(n.bind(n,908)),"/home/runner/canvasite/app/page.tsx"]}]},{layout:[()=>Promise.resolve().then(n.bind(n,1506)),"/home/runner/canvasite/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(n.t.bind(n,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/home/runner/canvasite/app/page.tsx"],u="/page",h={require:n,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},8433:(e,t,n)=>{Promise.resolve().then(n.bind(n,4878))},2446:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,2994,23)),Promise.resolve().then(n.t.bind(n,6114,23)),Promise.resolve().then(n.t.bind(n,9727,23)),Promise.resolve().then(n.t.bind(n,9671,23)),Promise.resolve().then(n.t.bind(n,1868,23)),Promise.resolve().then(n.t.bind(n,4759,23))},942:()=>{},4878:(e,t,n)=>{"use strict";let r,i,o,s,a,l,d,c,u,h,p,g,f,m,y,b,v,x,S,w,C,_,k;n.r(t),n.d(t,{default:()=>vh});var P,I,E,j=n(326),M=n(3353),T=n.n(M);function A(e){return e&&"object"==typeof e&&"parents"in e}function O(e){for(let t=0,n=e.parents.length;t<n;t++)if(e.parents[t].__unsafe__getWithoutCapture(),e.parents[t].lastChangedEpoch!==e.parentEpochs[t])return!0;return!1}n(8582);let R=(e,t)=>{if(e.children.remove(t)&&e.children.isEmpty&&A(e))for(let t=0,n=e.parents.length;t<n;t++)R(e.parents[t],e)},L=(e,t)=>{if(e.children.add(t)&&A(e))for(let t=0,n=e.parents.length;t<n;t++)L(e.parents[t],e)};function D(e,t){return e===t||Object.is(e,t)||!!(e&&t&&"function"==typeof e.equals&&e.equals(t))}function z(e,t){let n=Symbol.for(`com.tldraw.state/${e}`),r=globalThis;return r[n]??=t(),r[n]}let N=z("empty_array",()=>Object.freeze([]));class ${arraySize=0;array=Array(8);set=null;get isEmpty(){if(this.array)return 0===this.arraySize;if(this.set)return 0===this.set.size;throw Error("no set or array")}add(e){if(this.array)return -1===this.array.indexOf(e)&&(this.arraySize<8?(this.array[this.arraySize]=e,this.arraySize++):(this.set=new Set(this.array),this.array=null,this.set.add(e)),!0);if(this.set)return!this.set.has(e)&&(this.set.add(e),!0);throw Error("no set or array")}remove(e){if(this.array){let t=this.array.indexOf(e);return -1!==t&&(this.array[t]=void 0,this.arraySize--,t!==this.arraySize&&(this.array[t]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return!!this.set.has(e)&&(this.set.delete(e),!0);throw Error("no set or array")}visit(e){if(this.array){for(let t=0;t<this.arraySize;t++){let n=this.array[t];void 0!==n&&e(n)}return}if(this.set){this.set.forEach(e);return}throw Error("no set or array")}}let F=Symbol.for("com.tldraw.state/RESET_VALUE");class B{constructor(e){this.capacity=e,this.buffer=Array(e)}index=0;buffer;pushEntry(e,t,n){if(void 0!==n){if(n===F){this.clear();return}this.buffer[this.index]=[e,t,n],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){let{index:t,capacity:n,buffer:r}=this;for(let i=0;i<n;i++){let o=(t-1+n-i)%n,s=r[o];if(!s)break;let[a,l]=s;if(0===i&&e>=l)return[];if(a<=e&&e<l){let e=i+1,t=Array(e);for(let i=0;i<e;i++)t[i]=r[(o+i)%n][2];return t}}return F}}class V{constructor(e,t){this.below=e,this.child=t}offset=0;numNewParents=0;maybeRemoved}let U=z("capture",()=>({stack:null}));function K(e){U.stack=new V(U.stack,e)}function H(){let e=U.stack;if(U.stack=e.below,e.numNewParents>0||e.offset!==e.child.parents.length){for(let t=e.offset;t<e.child.parents.length;t++){let n=e.child.parents[t];e.child.parents.indexOf(n)>=e.offset&&R(n,e.child)}if(e.child.parents.length=e.offset,e.child.parentEpochs.length=e.offset,U.stack?.maybeRemoved)for(let t=0;t<U.stack.maybeRemoved.length;t++){let n=U.stack.maybeRemoved[t];-1===e.child.parents.indexOf(n)&&R(n,e.child)}}}function Y(e){if(U.stack){let t=U.stack.child.parents.indexOf(e);if(t<0&&(U.stack.numNewParents++,U.stack.child.isActivelyListening&&L(e,U.stack.child)),t<0||t>=U.stack.offset){if(t!==U.stack.offset&&t>0){let e=U.stack.child.parents[U.stack.offset];U.stack.maybeRemoved?-1===U.stack.maybeRemoved.indexOf(e)&&U.stack.maybeRemoved.push(e):U.stack.maybeRemoved=[e]}U.stack.child.parents[U.stack.offset]=e,U.stack.child.parentEpochs[U.stack.offset]=e.lastChangedEpoch,U.stack.offset++}}}class W{constructor(e,t,n){this.name=e,this.runEffect=t,this._scheduleEffect=n?.scheduleEffect}_isActivelyListening=!1;get isActivelyListening(){return this._isActivelyListening}lastTraversedEpoch=-1;lastReactedEpoch=-1;_scheduleCount=0;get scheduleCount(){return this._scheduleCount}parentEpochs=[];parents=[];_scheduleEffect;maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==J()){if(this.parents.length&&!O(this)){this.lastReactedEpoch=J();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}maybeExecute=()=>{this._isActivelyListening&&this.execute()};attach(){this._isActivelyListening=!0;for(let e=0,t=this.parents.length;e<t;e++)L(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,t=this.parents.length;e<t;e++)R(this.parents[e],this)}execute(){try{K(this);let e=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=J(),e}finally{H()}}}let X=z("EffectScheduler",()=>W);function G(e,t,n){let r=new X(e,t,n);return r.attach(),r.scheduleEffect(),()=>{r.detach()}}class q{constructor(e){this.parent=e}initialAtomValues=new Map;get isRoot(){return null===this.parent}commit(){if(this.isRoot){let e=this.initialAtomValues;this.initialAtomValues=new Map,Q(e.keys())}else this.initialAtomValues.forEach((e,t)=>{this.parent.initialAtomValues.has(t)||this.parent.initialAtomValues.set(t,e)})}abort(){Z.globalEpoch++,this.initialAtomValues.forEach((e,t)=>{t.set(e),t.historyBuffer?.clear()}),this.commit()}}let Z=z("transactions",()=>({globalEpoch:0,globalIsReacting:!1,currentTransaction:null}));function J(){return Z.globalEpoch}function Q(e){if(Z.globalIsReacting)throw Error("cannot change atoms during reaction cycle");try{Z.globalIsReacting=!0;let t=new Set,n=e=>{e.lastTraversedEpoch!==Z.globalEpoch&&(e.lastTraversedEpoch=Z.globalEpoch,e instanceof X?t.add(e):e.children.visit(n))};for(let t of e)t.children.visit(n);for(let e of t)e.maybeScheduleEffect()}finally{Z.globalIsReacting=!1}}function ee(e){return Z.currentTransaction?e():function(e){let t=new q(Z.currentTransaction);Z.currentTransaction=t;try{let n=!1,r=e(()=>n=!0);return n?t.abort():t.commit(),r}catch(e){throw t.abort(),e}finally{Z.currentTransaction=Z.currentTransaction.parent}}(e)}class et{constructor(e,t,n){if(this.name=e,this.current=t,this.isEqual=n?.isEqual??null,!n)return;n.historyLength&&(this.historyBuffer=new B(n.historyLength)),this.computeDiff=n.computeDiff}isEqual;computeDiff;lastChangedEpoch=J();children=new $;historyBuffer;__unsafe__getWithoutCapture(){return this.current}get(){return Y(this),this.current}set(e,t){if(this.isEqual?.(this.current,e)??D(this.current,e))return this.current;Z.globalEpoch++,this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,J(),t??this.computeDiff?.(this.current,e,this.lastChangedEpoch,J())??F),this.lastChangedEpoch=J();let n=this.current;return this.current=e,Z.currentTransaction?Z.currentTransaction.initialAtomValues.has(this)||Z.currentTransaction.initialAtomValues.set(this,n):Q([this]),e}update(e){return this.set(e(this.current))}getDiffSince(e){return(Y(this),e>=this.lastChangedEpoch)?N:this.historyBuffer?.getChangesSince(e)??F}}let en=z("Atom",()=>et);function er(e,t,n){return new en(e,t,n)}let ei=!1,eo=Symbol.for("com.tldraw.state/UNINITIALIZED"),es=e=>e===eo,ea=z("WithDiff",()=>class{constructor(e,t){this.value=e,this.diff=t}});function el(e,t){return new ea(e,t)}class ed{constructor(e,t,n){this.name=e,this.derive=t,n?.historyLength&&(this.historyBuffer=new B(n.historyLength)),this.computeDiff=n?.computeDiff,this.isEqual=n?.isEqual??D}lastChangedEpoch=-1;lastTraversedEpoch=-1;lastCheckedEpoch=-1;parents=[];parentEpochs=[];children=new $;get isActivelyListening(){return!this.children.isEmpty}historyBuffer;state=eo;computeDiff;isEqual;__unsafe__getWithoutCapture(){let e=-1===this.lastChangedEpoch;if(!e&&(this.lastCheckedEpoch===J()||!O(this)))return this.lastCheckedEpoch=J(),this.state;try{K(this);let t=this.derive(this.state,this.lastCheckedEpoch),n=t instanceof ea?t.value:t;if(this.state===eo||!this.isEqual(n,this.state)){if(this.historyBuffer&&!e){let e=t instanceof ea?t.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,J(),e??this.computeDiff?.(this.state,n,this.lastCheckedEpoch,J())??F)}this.lastChangedEpoch=J(),this.state=n}return this.lastCheckedEpoch=J(),this.state}finally{H()}}get(){let e=this.__unsafe__getWithoutCapture();return Y(this),e}getDiffSince(e){return(this.get(),e>=this.lastChangedEpoch)?N:this.historyBuffer?.getChangesSince(e)??F}}let ec=z("Computed",()=>ed);function eu(e={},t,n,r){return r.get?(ei||(ei=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`)),function(e={},t,n,r){let i=r.get,o=Symbol.for("__@tldraw/state__computed__"+n);return r.get=function(){let t=this[o];return t||Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:t=new ec(n,i.bind(this),e)}),t.get()},r}(e,0,n,r)):function(e={},t,n,r){let i=r.value,o=Symbol.for("__@tldraw/state__computed__"+n);return r.value=function(){let t=this[o];return t||Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:t=new ec(n,i.bind(this),e)}),t.get()},r.value[eh]=!0,r}(e,0,n,r)}let eh="@@__isComputedMethod__@@";function ep(){if(1==arguments.length){let e=arguments[0];return(t,n,r)=>eu(e,t,n,r)}return"string"==typeof arguments[0]?new ec(arguments[0],arguments[1],arguments[2]):eu(void 0,arguments[0],arguments[1],arguments[2])}if(1!==z("apiVersion",()=>1))throw Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");var eg=n(7577),ef=n.t(eg,2),em=n.n(eg);function ey(e,t){let n=eg.useRef(t);n.current=t;let[r,i,o]=eg.useMemo(()=>{let t=null,r=new X(`useStateTracking(${e})`,()=>n.current?.(),{scheduleEffect(){t?.()}});return[r,e=>(t=e,()=>{t=null}),()=>r.scheduleCount]},[e]);return eg.useSyncExternalStore(i,o,o),eg.useEffect(()=>(r.attach(),r.maybeScheduleEffect(),()=>{r.detach()}),[r]),r.execute()}let eb={apply:(e,t,n)=>ey(e.displayName??e.name??"tracked(???)",()=>e.apply(t,n))},ev=Symbol.for("react.memo"),ex=Symbol.for("react.forward_ref");function eS(e){let t=null,n=e.$$typeof;return(n===ev&&(t=(e=e.type).compare),n===ex)?(0,eg.memo)((0,eg.forwardRef)(new Proxy(e.render,eb))):(0,eg.memo)(new Proxy(e,eb),t)}function ew(){let e=arguments[0],t=arguments[1],n=3==arguments.length?void 0:arguments[2],r=3==arguments.length?arguments[2]:arguments[3];return(0,eg.useMemo)(()=>ep(`useComputed(${e})`,t,n),r)}function eC(e,t,n=N){(0,eg.useEffect)(()=>{let n=new X(e,t);return n.attach(),n.execute(),()=>{n.detach()}},n)}function e_(){let e=arguments,t=3===e.length?e[2]:[e[0]],n=3===e.length?e[0]:`useValue(${e[0].name})`,r=(0,eg.useRef)(!0);r.current=!0;let i=(0,eg.useMemo)(()=>1===e.length?e[0]:ep(n,()=>{if(r.current)return e[1]();try{return e[1]()}catch{return{}}}),t);try{let{subscribe:e,getSnapshot:t}=(0,eg.useMemo)(()=>({subscribe:e=>G(`useValue(${n})`,()=>{i.get(),e()}),getSnapshot:()=>i.get()}),[i]);return(0,eg.useSyncExternalStore)(e,t,t)}finally{r.current=!1}}class ek{constructor(e){this.previousValue=e}nextValue;diff;get(){let e=this.diff?.removed?.size??0,t=this.diff?.added?.size??0;if(0!==e||0!==t)return{value:this.nextValue,diff:this.diff}}_add(e,t){this.nextValue??=new Set(this.previousValue),this.nextValue.add(e),this.diff??={},t?this.diff.removed?.delete(e):(this.diff.added??=new Set,this.diff.added.add(e))}add(e){let t=this.previousValue.has(e);if(t){if(!this.diff?.removed?.has(e))return;return this._add(e,t)}this.nextValue?.has(e)||this._add(e,t)}_remove(e,t){this.nextValue??=new Set(this.previousValue),this.nextValue.delete(e),this.diff??={},t?(this.diff.removed??=new Set,this.diff.removed.add(e)):this.diff.added?.delete(e)}remove(e){let t=this.previousValue.has(e);if(!t){if(!this.diff?.added?.has(e))return;return this._remove(e,t)}this.diff?.removed?.has(e)||this._remove(e,t)}}function eP(e,t){let n=[];e:for(let r of e){for(let e of n)if(t?t(r,e):r===e)continue e;n.push(r)}return n}function eI(e){return e.filter(e=>null!=e)}function eE(e){return e[e.length-1]}function ej(e){let t=(...n)=>{try{return e(...n)}catch(e){throw e instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(e,t),e}};return t}function eM(e,t){let n=t&&e&&"object"==typeof e&&t in e?e[t]:e;throw Error(`Unknown switch case ${n}`)}let eT=ej((e,t)=>{if(!e)throw Error(t||"Assertion Error")}),eA=ej((e,t)=>{if(null==e)throw Error(t??"value must be defined");return e});function eO(e,t){let n;let r=(...r)=>(n||((n={}).promise=new Promise((e,t)=>{n.resolve=e,n.reject=t})),clearTimeout(n.timeout),n.latestArgs=r,n.timeout=setTimeout(()=>{let t=n;n=void 0;try{t.resolve(e(...t.latestArgs))}catch(e){t.reject(e)}},t),n.promise);return r.cancel=()=>{n&&clearTimeout(n.timeout)},r}let eR=new WeakMap;function eL(e,t){if("object"!=typeof e||null===e)return;let n=eR.get(e);n||(n={tags:{},extras:{}},eR.set(e,n)),t.tags&&(n.tags={...n.tags,...t.tags}),t.extras&&(n.extras={...n.extras,...t.extras})}let eD=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];"undefined"!=typeof Int32Array&&(eD=new Int32Array(eD));let ez=(e,t)=>{let n=0===t?0:-1^~~t;for(let t=0;t<e.length;t++)n=eD[(n^e[t])&255]^n>>>8;return -1^n};class eN{static isPng(e,t){return 137===e.getUint8(t+0)&&80===e.getUint8(t+1)&&78===e.getUint8(t+2)&&71===e.getUint8(t+3)&&13===e.getUint8(t+4)&&10===e.getUint8(t+5)&&26===e.getUint8(t+6)&&10===e.getUint8(t+7)}static getChunkType(e,t){return[String.fromCharCode(e.getUint8(t)),String.fromCharCode(e.getUint8(t+1)),String.fromCharCode(e.getUint8(t+2)),String.fromCharCode(e.getUint8(t+3))].join("")}static readChunks(e,t=0){let n={};if(!eN.isPng(e,t))throw Error("Not a PNG");for(t+=8;t<=e.buffer.byteLength;){let r=t,i=e.getInt32(t);t+=4;let o=eN.getChunkType(e,t);if("IDAT"===o&&n[o]){t+=i+4+4;continue}if("IEND"===o)break;n[o]={start:r,dataOffset:t+4,size:i},t+=i+4+4}return n}static parsePhys(e,t){return{ppux:e.getUint32(t),ppuy:e.getUint32(t+4),unit:e.getUint8(t+4)}}static findChunk(e,t){return eN.readChunks(e)[t]}static setPhysChunk(e,t=1,n){let r=46,i=0,o=eN.findChunk(e,"pHYs");o&&(r=o.start,i=o.size);let s=eN.findChunk(e,"IDAT");s&&(r=s.start,i=0);let a=new ArrayBuffer(21),l=new DataView(a);l.setUint32(0,9),l.setUint8(4,112),l.setUint8(5,72),l.setUint8(6,89),l.setUint8(7,115),l.setInt32(8,2835.5*t),l.setInt32(12,2835.5*t),l.setInt8(16,1);let d=new Uint8Array(a.slice(4,17));return l.setInt32(17,ez(d)),new Blob([e.buffer.slice(0,r),a,e.buffer.slice(r+i)],n)}}function e$(e=""){let t=0,n=0,r=0,i=0;function o(){let e=t^t<<11;return t=n,n=r,r=i,(i^=(i>>>19^e^e>>>8)>>>0)/4294967296*2}for(let n=0;n<e.length+64;n++)t^=0|e.charCodeAt(n),o();return o}function eF(e,t,n,r=!1){let[i,o]=t,[s,a]=n,l=s+(e-i)/(o-i)*(a-s);return r?s<a?Math.max(Math.min(l,a),s):Math.max(Math.min(l,s),a):l}function eB(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function eV(e,t){if(eB(e,t))return e[t]}function eU(e){if(!e)return e;if(Array.isArray(e)){let t=[],n=e.length;for(let r=0;r<n;r++)t.push(eU(e[r]));return t}if("object"==typeof e){let t=Object.keys(e),n=t.length,r={};for(let i=0;i<n;i++){let n=t[i];r[n]=eU(e[n])}return r}return e}function eK(e){return Object.keys(e)}function eH(e){return Object.values(e)}function eY(e){return Object.entries(e)}function eW(e){return Object.fromEntries(e)}function eX(e,t){let n={},r=!1;for(let[i,o]of eY(e))t(i,o)?n[i]=o:r=!0;return r?n:e}function eG(e,t){let n={};for(let[r,i]of eY(e)){let e=t(r,i);n[r]=e}return n}let eq=()=>"undefined"!=typeof process&&!1,eZ=[],eJ=()=>{for(let e of eZ.splice(0,eZ.length))e()};function eQ(e,t){return e.id>t.id?1:-1}function e0(e){return null!==e}let e1="undefined"!=typeof window&&window.structuredClone?window.structuredClone:e=>e?JSON.parse(JSON.stringify(e)):e,e2=require("crypto"),e5=e=>{!i||i.length<e?(i=Buffer.allocUnsafe(128*e),(0,e2.randomFillSync)(i),o=0):o+e>i.length&&((0,e2.randomFillSync)(i),o=0),o+=e},e3=(e=21)=>{e5(e-=0);let t="";for(let n=o-e;n<o;n++)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&i[n]];return t};class e4{constructor(e,t){this.typeName=e,this.createDefaultProperties=t.createDefaultProperties,this.migrations=t.migrations,this.validator=t.validator??{validate:e=>e},this.scope=t.scope??"document"}createDefaultProperties;migrations;validator;scope;create(e){let t={...this.createDefaultProperties(),id:this.createId()};for(let[n,r]of Object.entries(e))void 0!==r&&(t[n]=r);return t.typeName=this.typeName,t}clone(e){return{...e1(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??e3())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isInstance=e=>e?.typeName===this.typeName;isId(e){if(!e)return!1;for(let t=0;t<this.typeName.length;t++)if(e[t]!==this.typeName[t])return!1;return":"===e[this.typeName.length]}withDefaultProperties(e){return new e4(this.typeName,{createDefaultProperties:e,migrations:this.migrations,validator:this.validator,scope:this.scope})}validate(e){return this.validator.validate(e)}}function e6(e,t){return new e4(e,{createDefaultProperties:()=>({}),migrations:t.migrations??{currentVersion:0,firstVersion:0,migrators:{}},validator:t.validator,scope:t.scope})}class e8{items=new WeakMap;get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}}var e9=n(5575);function e7(e,t){for(let[n,r]of Object.entries(e)){let e=t[n];if("eq"in r&&e!==r.eq||"neq"in r&&e===r.neq||"gt"in r&&("number"!=typeof e||e<=r.gt))return!1}return!0}function te(e,t,n){let r=Object.fromEntries(Object.keys(n).map(e=>[e,new Set]));for(let[i,o]of Object.entries(n))if("eq"in o){let n=e.index(t,i).get().get(o.eq);if(n)for(let e of n)r[i].add(e)}else if("neq"in o){for(let[n,s]of e.index(t,i).get())if(n!==o.neq)for(let e of s)r[i].add(e)}else if("gt"in o){for(let[n,s]of e.index(t,i).get())if(n>o.gt)for(let e of s)r[i].add(e)}return function(e){if(0===e.length)return new Set;let t=e[0],n=e.slice(1),r=new Set;for(let e of t)n.every(t=>t.has(e))&&r.add(e);return r}(Object.values(r))}class tt{constructor(e,t){this.atoms=e,this.history=t}indexCache=new Map;historyCache=new Map;filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);let t=ep("filterHistory:"+e,(t,n)=>{if(es(t))return this.history.get();let r=this.history.getDiffSince(n);if(r===F)return this.history.get();let i={added:{},removed:{},updated:{}},o=0,s=0,a=0;for(let t of r){for(let n of eH(t.added))if(n.typeName===e){if(i.removed[n.id]){let e=i.removed[n.id];delete i.removed[n.id],s--,e!==n&&(i.updated[n.id]=[e,n],a++)}else i.added[n.id]=n,o++}for(let[n,r]of eH(t.updated))r.typeName===e&&(i.added[r.id]?i.added[r.id]=r:i.updated[r.id]?i.updated[r.id]=[i.updated[r.id][0],r]:(i.updated[r.id]=[n,r],a++));for(let n of eH(t.removed))n.typeName===e&&(i.added[n.id]?(delete i.added[n.id],o--):(i.updated[n.id]?(i.removed[n.id]=i.updated[n.id][0],delete i.updated[n.id],a--):i.removed[n.id]=n,s++))}return o||s||a?el(this.history.get(),i):t},{historyLength:100});return this.historyCache.set(e,t),t}index(e,t){let n=e+":"+t;if(this.indexCache.has(n))return this.indexCache.get(n);let r=this.__uncached_createIndex(e,t);return this.indexCache.set(n,r),r}__uncached_createIndex(e,t){let n=this.filterHistory(e),r=()=>{n.get();let r=new Map;for(let n of eH(this.atoms.get())){let i=n.get();if(i.typeName===e){let e=i[t];r.has(e)||r.set(e,new Set),r.get(e).add(i.id)}}return r};return ep("index:"+e+":"+t,(i,o)=>{let s,a;if(es(i))return r();let l=n.getDiffSince(o);if(l===F)return r();let d=new Map,c=(e,t)=>{let n=d.get(e);n||(n=new ek(i.get(e)??new Set)),n.add(t),d.set(e,n)},u=(e,t)=>{let n=d.get(e);n||(n=new ek(i.get(e)??new Set)),n.remove(t),d.set(e,n)};for(let n of l){for(let r of eH(n.added))r.typeName===e&&c(r[t],r.id);for(let[r,i]of eH(n.updated))if(i.typeName===e){let e=r[t],n=i[t];e!==n&&(u(e,i.id),c(n,i.id))}for(let r of eH(n.removed))r.typeName===e&&u(r[t],r.id)}for(let[e,t]of d){let n=t.get();n&&(s||(s=new Map(i)),a||(a=new Map),0===n.value.size?s.delete(e):s.set(e,n.value),a.set(e,n.diff))}return s&&a?el(s,a):i},{historyLength:100})}record(e,t=()=>({}),n="record:"+e+(t?":"+t.toString():"")){let r=this.ids(e,t,n);return ep(n,()=>{for(let e of r.get())return this.atoms.get()[e]?.get()})}records(e,t=()=>({}),n="records:"+e+(t?":"+t.toString():"")){let r=this.ids(e,t,"ids:"+n);return ep(n,()=>[...r.get()].map(e=>{let t=this.atoms.get()[e];if(!t)throw Error("no atom found for record id: "+e);return t.get()}))}ids(e,t=()=>({}),n="ids:"+e+(t?":"+t.toString():"")){let r=this.filterHistory(e),i=()=>{r.get();let n=t();return 0===Object.keys(n).length?new Set(eH(this.atoms.get()).flatMap(t=>{let n=t.get();return n.typeName===e?n.id:[]})):te(this,e,n)},o=e=>{let t=i(),n=function(e,t){let n={};for(let r of t)e.has(r)||(n.added??=new Set,n.added.add(r));for(let r of e)t.has(r)||(n.removed??=new Set,n.removed.add(r));return n.added||n.removed?n:void 0}(e,t);return n?el(t,n):e},s=ep("ids_query:"+n,t,{isEqual:e9});return ep("query:"+n,(t,n)=>{let a=s.get();if(es(t))return i();if(n<s.lastChangedEpoch)return o(t);let l=r.getDiffSince(n);if(l===F)return o(t);let d=new ek(t);for(let t of l){for(let n of eH(t.added))n.typeName===e&&e7(a,n)&&d.add(n.id);for(let[n,r]of eH(t.updated))r.typeName===e&&(e7(a,r)?d.add(r.id):d.remove(r.id));for(let n of eH(t.removed))n.typeName===e&&d.remove(n.id)}let c=d.get();return c?el(c.value,c.diff):t},{historyLength:50})}exec(e,t){let n=te(this,e,t);if(0===n.size)return N;let r=this.atoms.get();return[...n].map(e=>r[e].get())}}class tn{id=e3();atoms=er("store_atoms",{});history=er("history",0,{historyLength:1e3});query=new tt(this.atoms,this.history);listeners=new Set;historyAccumulator=new ti;historyReactor;schema;props;scopedTypes;constructor(e){let{initialData:t,schema:n}=e;this.schema=n,this.props=e.props,t&&this.atoms.set(eW(eY(t).map(([e,t])=>[e,er("atom:"+e,this.schema.validateRecord(this,t,"initialize",null))]))),this.historyReactor=function(e,t,n){let r=new X(e,t,n);return{scheduler:r,start:e=>{let t=e?.force??!1;r.attach(),t?r.scheduleEffect():r.maybeScheduleEffect()},stop:()=>{r.detach()}}}("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:e=>(function(e){if(eq())return e();!eZ.includes(e)&&(eZ.push(e),r||(r=requestAnimationFrame(()=>{r=void 0,eJ()})))})(e)}),this.scopedTypes={document:new Set(eH(this.schema.types).filter(e=>"document"===e.scope).map(e=>e.typeName)),session:new Set(eH(this.schema.types).filter(e=>"session"===e.scope).map(e=>e.typeName)),presence:new Set(eH(this.schema.types).filter(e=>"presence"===e.scope).map(e=>e.typeName))}}_flushHistory(){if(this.historyAccumulator.hasChanges())for(let{changes:e,source:t}of this.historyAccumulator.flush()){let n=null,r=null,i=null;for(let{onHistory:o,filters:s}of this.listeners)if("all"===s.source||s.source===t){if("all"!==s.scope){if("document"===s.scope){if(!(r??=this.filterChangesByScope(e,"document")))continue;o({changes:r,source:t})}else if("session"===s.scope){if(!(n??=this.filterChangesByScope(e,"session")))continue;o({changes:n,source:t})}else{if(!(i??=this.filterChangesByScope(e,"presence")))continue;o({changes:i,source:t})}}else o({changes:e,source:t})}}}filterChangesByScope(e,t){let n={added:eX(e.added,(e,n)=>this.scopedTypes[t].has(n.typeName)),updated:eX(e.updated,(e,n)=>this.scopedTypes[t].has(n[1].typeName)),removed:eX(e.removed,(e,n)=>this.scopedTypes[t].has(n.typeName))};return 0===Object.keys(n.added).length&&0===Object.keys(n.updated).length&&0===Object.keys(n.removed).length?null:n}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),0===this.listeners.size&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach(t=>this.schema.validateRecord(this,t,e,null))}onBeforeCreate;onAfterCreate;onBeforeChange;onAfterChange;onBeforeDelete;onAfterDelete;_runCallbacks=!0;put=(e,t)=>{ee(()=>{let n;let r={},i={},o=this.atoms.__unsafe__getWithoutCapture(),s=null,a=!1,l=this.onBeforeCreate&&this._runCallbacks?this.onBeforeCreate:null,d=this.onBeforeChange&&this._runCallbacks?this.onBeforeChange:null,c=this.isMergingRemoteChanges?"remote":"user";for(let u=0,h=e.length;u<h;u++){let h=(s??o)[(n=e[u]).id];if(h){let e=h.__unsafe__getWithoutCapture();d&&(n=d(e,n,c)),n=this.schema.validateRecord(this,n,t??"updateRecord",e),h.set(n);let i=h.__unsafe__getWithoutCapture();e!==i&&(a=!0,r[n.id]=[e,i])}else l&&(n=l(n,c)),a=!0,i[(n=this.schema.validateRecord(this,n,t??"createRecord",null)).id]=n,s||(s={...o}),s[n.id]=er("atom:"+n.id,n)}if(s&&this.atoms.set(s),a&&(this.updateHistory({added:i,updated:r,removed:{}}),this._runCallbacks)){let{onAfterCreate:e,onAfterChange:t}=this;e&&Object.values(i).forEach(t=>{e(t,c)}),t&&Object.values(r).forEach(([e,n])=>{t(e,n,c)})}})};remove=e=>{ee(()=>{let t;let n=[],r=this.isMergingRemoteChanges?"remote":"user";if(this.onBeforeDelete&&this._runCallbacks)for(let t of e){let e=this.atoms.__unsafe__getWithoutCapture()[t];e&&!1===this.onBeforeDelete(e.get(),r)&&n.push(t)}if(this.atoms.update(r=>{let i;for(let o of e)!n.includes(o)&&o in r&&(i||(i={...r}),t||(t={}),delete i[o],t[o]=r[o].get());return i??r}),t&&(this.updateHistory({added:{},updated:{},removed:t}),this.onAfterDelete&&this._runCallbacks)){let n;for(let i=0,o=e.length;i<o;i++)(n=t[e[i]])&&this.onAfterDelete(n,r)}})};get=e=>this.atoms.get()[e]?.get();unsafeGetWithoutCapture=e=>this.atoms.get()[e]?.__unsafe__getWithoutCapture();serialize=(e="document")=>{let t={};for(let[n,r]of eY(this.atoms.get())){let i=r.get();("all"===e||this.scopedTypes[e].has(i.typeName))&&(t[n]=i)}return t};getSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}migrateSnapshot(e){let t=this.schema.migrateStoreSnapshot(e);if("error"===t.type)throw Error(`Failed to migrate snapshot: ${t.reason}`);return{store:t.value,schema:this.schema.serialize()}}loadSnapshot(e){let t=this.schema.migrateStoreSnapshot(e);if("error"===t.type)throw Error(`Failed to migrate snapshot: ${t.reason}`);ee(()=>{this.clear(),this.put(Object.values(t.value)),this.ensureStoreIsUsable()})}allRecords=()=>eH(this.atoms.get()).map(e=>e.get());clear=()=>{this.remove(eK(this.atoms.get()))};update=(e,t)=>{let n=this.atoms.get()[e];if(!n){console.error(`Record ${e} not found. This is probably an error`);return}this.put([t(n.__unsafe__getWithoutCapture())])};has=e=>!!this.atoms.get()[e];listen=(e,t)=>{this._flushHistory();let n={onHistory:e,filters:{source:t?.source??"all",scope:t?.scope??"all"}};return this.listeners.add(n),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(n),0===this.listeners.size&&this.historyReactor.stop()}};isMergingRemoteChanges=!1;mergeRemoteChanges=e=>{if(this.isMergingRemoteChanges)return e();try{this.isMergingRemoteChanges=!0,ee(e)}finally{this.isMergingRemoteChanges=!1}};extractingChanges(e){let t=[],n=this.historyAccumulator.intercepting(e=>t.push(e.changes));try{return ee(e),tr(t)}finally{n()}}applyDiff(e,t=!0){let n=this._runCallbacks;try{this._runCallbacks=t,ee(()=>{let t=eH(e.added).concat(eH(e.updated).map(([e,t])=>t)),n=eK(e.removed);t.length&&this.put(t),n.length&&this.remove(n)})}finally{this._runCallbacks=n}}createComputedCache=(e,t,n)=>{let r=new e8;return{get:i=>{let o=this.atoms.get()[i];if(o)return r.get(o,()=>{let r=n?ep(o.name+":equals",()=>o.get(),{isEqual:n}):o;return ep(e+":"+i,()=>t(r.get()))}).get()}}};createSelectedComputedCache=(e,t,n)=>{let r=new e8;return{get:i=>{let o=this.atoms.get()[i];if(!o)return;let s=ep(e+":"+i+":selector",()=>t(o.get()));return r.get(o,()=>ep(e+":"+i,()=>n(s.get()))).get()}}};getRecordType=e=>{let t=this.schema.types[e.typeName];if(!t)throw Error(`Record type ${e.typeName} not found`);return t};_integrityChecker;ensureStoreIsUsable(){this._integrityChecker??=this.schema.createIntegrityChecker(this),this._integrityChecker?.()}_isPossiblyCorrupted=!1;markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}}function tr(e){let t={added:{},removed:{},updated:{}};for(let n of e){for(let[e,r]of eY(n.added))if(t.removed[e]){let n=t.removed[e];delete t.removed[e],n!==r&&(t.updated[e]=[n,r])}else t.added[e]=r;for(let[e,[r,i]]of eY(n.updated)){if(t.added[e]){t.added[e]=i,delete t.updated[e],delete t.removed[e];continue}if(t.updated[e]){t.updated[e]=[t.updated[e][0],i],delete t.removed[e];continue}t.updated[e]=n.updated[e],delete t.removed[e]}for(let[e,r]of eY(n.removed))t.added[e]?delete t.added[e]:t.updated[e]?(t.removed[e]=t.updated[e][0],delete t.updated[e]):t.removed[e]=r}return t}class ti{_history=[];_interceptors=new Set;intercepting(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){for(let t of(this._history.push(e),this._interceptors))t(e)}flush(){let e=function(e){let t;let n=[],r=e[0];for(let i=1,o=e.length;i<o;i++)t=e[i],r.source!==t.source?(n.push(r),r=t):r={source:r.source,changes:tr([r.changes,t.changes])};return n.push(r),n}(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function to(e){let{currentVersion:t,firstVersion:n,migrators:r={},subTypeKey:i,subTypeMigrations:o}=e;if("number"==typeof t&&"number"==typeof n){if(t===n)throw Error("Current version is equal to initial version.");if(t<n)throw Error("Current version is lower than initial version.")}return{firstVersion:n??0,currentVersion:t??0,migrators:r,subTypeKey:i,subTypeMigrations:o}}var ts=((g=ts||{}).IncompatibleSubtype="incompatible-subtype",g.UnknownType="unknown-type",g.TargetVersionTooNew="target-version-too-new",g.TargetVersionTooOld="target-version-too-old",g.MigrationError="migration-error",g.UnrecognizedSubtype="unrecognized-subtype",g);function ta({record:e,migrations:t,fromVersion:n,toVersion:r}){let i=n;if(!("object"==typeof e&&null!==e&&"id"in e&&"typeName"in e))throw Error("[migrateRecord] object is not a record");let{typeName:o,id:s,...a}=e,l=a;for(;i<r;){let e=i+1,n=t.migrators[e];if(!n)return{type:"error",reason:"target-version-too-new"};l=n.up(l),i=e}for(;i>r;){let e=i-1,n=t.migrators[i];if(!n)return{type:"error",reason:"target-version-too-old"};l=n.down(l),i=e}return{type:"success",value:{...l,id:s,typeName:o}}}function tl({value:e,migrations:t,fromVersion:n,toVersion:r}){let i=n;for(;i<r;){let n=i+1,r=t.migrators[n];if(!r)return{type:"error",reason:"target-version-too-new"};e=r.up(e),i=n}for(;i>r;){let n=i-1,r=t.migrators[i];if(!r)return{type:"error",reason:"target-version-too-old"};e=r.down(e),i=n}return{type:"success",value:e}}class td{constructor(e,t){this.types=e,this.options=t}static create(e,t){return new td(e,t??{})}get currentStoreVersion(){return this.options.snapshotMigrations?.currentVersion??0}validateRecord(e,t,n,r){try{let e=eV(this.types,t.typeName);if(!e)throw Error(`Missing definition for record type ${t.typeName}`);return e.validate(t)}catch(i){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:t,phase:n,recordBefore:r,error:i});throw i}}migratePersistedRecord(e,t,n="up"){let r=eV(this.types,e.typeName),i=t.recordVersions[e.typeName];if(!i||!r)return{type:"error",reason:ts.UnknownType};let o=r.migrations.currentVersion,s=i.version;if(o!==s){let t="up"===n?ta({record:e,migrations:r.migrations,fromVersion:s,toVersion:o}):ta({record:e,migrations:r.migrations,fromVersion:o,toVersion:s});if("error"===t.type)return t;e=t.value}if(!r.migrations.subTypeKey)return{type:"success",value:e};let a=r.migrations.subTypeMigrations?.[e[r.migrations.subTypeKey]],l="subTypeVersions"in i?i.subTypeVersions[e[r.migrations.subTypeKey]]:void 0;if(void 0===a)return{type:"error",reason:ts.UnrecognizedSubtype};if(void 0===l)return{type:"error",reason:ts.IncompatibleSubtype};let d="up"===n?ta({record:e,migrations:a,fromVersion:l,toVersion:a.currentVersion}):ta({record:e,migrations:a,fromVersion:a.currentVersion,toVersion:l});return"error"===d.type?d:{type:"success",value:d.value}}migrateStoreSnapshot(e){let{store:t}=e,n=this.options.snapshotMigrations;if(!n)return{type:"success",value:t};let r=n.currentVersion,i=e.schema.storeVersion??0;if(r<i)return{type:"error",reason:ts.TargetVersionTooOld};if(r>i){let e=tl({value:t,migrations:n,fromVersion:i,toVersion:r});if("error"===e.type)return e;t=e.value}let o=[];for(let n of eH(t)){let t=this.migratePersistedRecord(n,e.schema);if("error"===t.type)return t;t.value&&t.value!==n&&o.push(t.value)}if(o.length)for(let e of(t={...t},o))t[e.id]=e;return{type:"success",value:t}}createIntegrityChecker(e){return this.options.createIntegrityChecker?.(e)??void 0}serialize(){return{schemaVersion:1,storeVersion:this.options.snapshotMigrations?.currentVersion??0,recordVersions:Object.fromEntries(eH(this.types).map(e=>[e.typeName,e.migrations.subTypeKey&&e.migrations.subTypeMigrations?{version:e.migrations.currentVersion,subTypeKey:e.migrations.subTypeKey,subTypeVersions:e.migrations.subTypeMigrations?Object.fromEntries(Object.entries(e.migrations.subTypeMigrations).map(([e,t])=>[e,t.currentVersion])):void 0}:{version:e.migrations.currentVersion}]))}}serializeEarliestVersion(){return{schemaVersion:1,storeVersion:this.options.snapshotMigrations?.firstVersion??0,recordVersions:Object.fromEntries(eH(this.types).map(e=>[e.typeName,e.migrations.subTypeKey&&e.migrations.subTypeMigrations?{version:e.migrations.firstVersion,subTypeKey:e.migrations.subTypeKey,subTypeVersions:e.migrations.subTypeMigrations?Object.fromEntries(Object.entries(e.migrations.subTypeMigrations).map(([e,t])=>[e,t.firstVersion])):void 0}:{version:e.migrations.firstVersion}]))}}}let tc=(e,t)=>{if(e.schemaVersion>t.schemaVersion)return 1;if(e.schemaVersion<t.schemaVersion)return -1;if(e.storeVersion>t.storeVersion)return 1;if(e.storeVersion<t.storeVersion)return -1;for(let n of Object.keys(e.recordVersions)){let r=e.recordVersions[n],i=t.recordVersions[n];if(r.version>i.version)return 1;if(r.version<i.version)return -1;if("subTypeVersions"in r&&!("subTypeVersions"in i))return 1;if(!("subTypeVersions"in r)&&"subTypeVersions"in i)return -1;if("subTypeVersions"in r&&"subTypeVersions"in i)for(let e of Object.keys(r.subTypeVersions)){let t=r.subTypeVersions[e],n=i.subTypeVersions[e];if(t>n)return 1;if(t<n)return -1}}return 0};class tu extends Error{constructor(e,t=[]){let n=function(e){if(!e.length)return null;let t="";for(let n of e)"number"==typeof n?t+=`.${n}`:n.startsWith("(")?t.endsWith(")")?t=`${t.slice(0,-1)}, ${n.slice(1)}`:t+=n:t+=`.${n}`;return t.startsWith(".")?t.slice(1):t}(t),r=e.split("\n").map((e,t)=>0===t?e:`  ${e}`).join("\n");super(t?`At ${n}: ${r}`:r),this.rawMessage=e,this.path=t}name="ValidationError"}function th(e,t){try{return t()}catch(t){if(t instanceof tu)throw new tu(t.rawMessage,[e,...t.path]);throw new tu(t.toString(),[e])}}function tp(e){if(null===e)return"null";if(Array.isArray(e))return"an array";let t=typeof e;switch(t){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${t}`;case"object":return`an ${t}`;case"undefined":return"undefined";default:eM(t)}}class tg{constructor(e){this.validationFn=e}validate(e){return this.validationFn(e)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){var e;return e=this,new tg(t=>null===t?null:e.validate(t))}optional(){return tD(this)}refine(e){return new tg(t=>e(this.validate(t)))}check(e,t){return"string"==typeof e?this.refine(n=>(th(`(check ${e})`,()=>t(n)),n)):this.refine(t=>(e(t),t))}}class tf extends tg{constructor(e){super(t=>{let n=tj.validate(t);for(let t=0;t<n.length;t++)th(t,()=>e.validate(n[t]));return n}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(0===e.length)throw new tu("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new tu("Expected an array with length greater than 1")})}}class tm extends tg{constructor(e,t=!1){super(n=>{if("object"!=typeof n||null===n)throw new tu(`Expected object, got ${tp(n)}`);for(let[t,r]of Object.entries(e))th(t,()=>{r.validate(eV(n,t))});if(!t){for(let t of Object.keys(n))if(!eB(e,t))throw new tu("Unexpected property",[t])}return n}),this.config=e,this.shouldAllowUnknownProperties=t}allowUnknownProperties(){return new tm(this.config,!0)}extend(e){return new tm({...this.config,...e})}}class ty extends tg{constructor(e,t,n){super(n=>{if("object"!=typeof n||null===n)throw new tu(`Expected an object, got ${tp(n)}`,[]);let r=eV(n,e);if("string"!=typeof r)throw new tu(`Expected a string for key "${e}", got ${tp(r)}`);let i=eB(t,r)?t[r]:void 0;return void 0===i?this.unknownValueValidation(n,r):th(`(${e} = ${r})`,()=>i.validate(n))}),this.key=e,this.config=t,this.unknownValueValidation=n}validateUnknownVariants(e){return new ty(this.key,this.config,e)}}class tb extends tg{constructor(e,t){super(n=>{if("object"!=typeof n||null===n)throw new tu(`Expected object, got ${tp(n)}`);for(let[r,i]of Object.entries(n))th(r,()=>{e.validate(r),t.validate(i)});return n}),this.keyValidator=e,this.valueValidator=t}}function tv(e){return new tg(t=>{if(typeof t!==e)throw new tu(`Expected ${e}, got ${tp(t)}`);return t})}new tg(e=>e);let tx=new tg(e=>e),tS=tv("string"),tw=tv("number").check(e=>{if(Number.isNaN(e))throw new tu("Expected a number, got NaN");if(!Number.isFinite(e))throw new tu(`Expected a finite number, got ${e}`)}),tC=tw.check(e=>{if(e<0)throw new tu(`Expected a positive number, got ${e}`)});tw.check(e=>{if(e<=0)throw new tu(`Expected a non-zero positive number, got ${e}`)});let t_=tw.check(e=>{if(!Number.isInteger(e))throw new tu(`Expected an integer, got ${e}`)}),tk=t_.check(e=>{if(e<0)throw new tu(`Expected a positive integer, got ${e}`)}),tP=t_.check(e=>{if(e<=0)throw new tu(`Expected a non-zero positive integer, got ${e}`)}),tI=tv("boolean");function tE(e){return new tg(t=>{if(t!==e)throw new tu(`Expected ${e}, got ${JSON.stringify(t)}`);return e})}tv("bigint");let tj=new tg(e=>{if(!Array.isArray(e))throw new tu(`Expected an array, got ${tp(e)}`);return e});function tM(e){return new tf(e)}function tT(e){return new tm(e)}new tg(e=>{if("object"!=typeof e||null===e)throw new tu(`Expected object, got ${tp(e)}`);return e});let tA=new tg(e=>{if(function e(t){return null===t||"number"==typeof t||"string"==typeof t||"boolean"==typeof t||(Array.isArray(t)?t.every(e):"object"==typeof t&&Object.values(t).every(e))}(e))return e;throw new tu(`Expected json serializable value, got ${typeof e}`)});function tO(e,t){return new ty(e,t,(n,r)=>{throw new tu(`Expected one of ${Object.keys(t).map(e=>JSON.stringify(e)).join(" or ")}, got ${JSON.stringify(r)}`,[e])})}function tR(e,t){return new tg(n=>th(n&&"object"==typeof n&&"id"in n&&"string"==typeof n.id?`${e}(id = ${n.id})`:e,()=>t.validate(n)))}function tL(e){return new tg(t=>{if(!e.has(t)){let n=Array.from(e,e=>JSON.stringify(e)).join(" or ");throw new tu(`Expected ${n}, got ${t}`)}return t})}function tD(e){return new tg(t=>{if(void 0!==t)return e.validate(t)})}function tz(...e){return tL(new Set(e))}function tN(e){try{return new URL(e)}catch(t){if(e.startsWith("/")||e.startsWith("./"))try{return new URL(e,"http://example.com")}catch(e){}throw new tu(`Expected a valid url, got ${JSON.stringify(e)}`)}}let t$=new Set(["http:","https:","mailto:"]),tF=tS.check(e=>{if(""===e)return;let t=tN(e);if(!t$.has(t.protocol.toLowerCase()))throw new tu(`Expected a valid url, got ${JSON.stringify(e)} (invalid protocol)`)}),tB=new Set(["http:","https:","data:"]),tV=tS.check(e=>{if(""===e)return;let t=tN(e);if(!tB.has(t.protocol.toLowerCase()))throw new tu(`Expected a valid url, got ${JSON.stringify(e)} (invalid protocol)`)});function tU(e){return tS.refine(t=>{if(!t.startsWith(`${e}:`))throw Error(`${e} ID must start with "${e}:"`);return t})}let tK=tU("asset");function tH(e,t){return tT({id:tK,typeName:tE("asset"),type:tE(e),props:t,meta:tA})}let tY=tR("camera",tT({typeName:tE("camera"),id:tU("camera"),x:tw,y:tw,z:tw,meta:tA})),tW={AddMeta:1},tX=e6("camera",{validator:tY,migrations:to({currentVersion:tW.AddMeta,migrators:{[tW.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),tG=tT({x:tw,y:tw,z:tw.optional()}),tq=tT({x:tw,y:tw,w:tw,h:tw}),tZ=tL(new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"])),tJ=tT({type:tZ,rotation:tw}),tQ=tw.check(e=>{if(e<0||e>1)throw new tu("Opacity must be between 0 and 1")}),t0=tL(new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"])),t1=new Set(["starting","paused","active","stopping"]),t2=tT({id:tS,points:tM(tG),size:tC,color:t0,opacity:tw,state:tL(t1),delay:tw,shrink:tw,taper:tI}),t5=tU("page"),t3=tR("page",tT({typeName:tE("page"),id:t5,name:tS,index:tS,meta:tA})),t4={AddMeta:1},t6=e6("page",{validator:t3,migrations:to({currentVersion:t4.AddMeta,migrators:{[t4.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),scope:"document"}).withDefaultProperties(()=>({meta:{}}));function t8(e){return t6.isId(e)}tU("instance");let t9={AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24},t7=to({currentVersion:t9.AddDuplicateProps,migrators:{[t9.AddTransparentExportBgs]:{up:e=>({...e,exportBackground:!0}),down:({exportBackground:e,...t})=>t},[t9.RemoveDialog]:{up:({dialog:e,...t})=>t,down:e=>({...e,dialog:null})},[t9.AddToolLockMode]:{up:e=>({...e,isToolLocked:!1}),down:({isToolLocked:e,...t})=>t},[t9.RemoveExtraPropsForNextShape]:{up:({propsForNextShape:e,...t})=>({...t,propsForNextShape:Object.fromEntries(Object.entries(e).filter(([e])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(e)))}),down:e=>e},[t9.AddLabelColor]:{up:({propsForNextShape:e,...t})=>({...t,propsForNextShape:{...e,labelColor:"black"}}),down:e=>{let{labelColor:t,...n}=e.propsForNextShape;return{...e,propsForNextShape:{...n}}}},[t9.AddFollowingUserId]:{up:e=>({...e,followingUserId:null}),down:({followingUserId:e,...t})=>t},[t9.RemoveAlignJustify]:{up:e=>{let t=e.propsForNextShape.align;return"justify"===t&&(t="start"),{...e,propsForNextShape:{...e.propsForNextShape,align:t}}},down:e=>({...e})},[t9.AddZoom]:{up:e=>({...e,zoomBrush:null}),down:({zoomBrush:e,...t})=>t},[t9.AddVerticalAlign]:{up:e=>({...e,propsForNextShape:{...e.propsForNextShape,verticalAlign:"middle"}}),down:e=>{let{verticalAlign:t,...n}=e.propsForNextShape;return{...e,propsForNextShape:n}}},[t9.AddScribbleDelay]:{up:e=>null!==e.scribble?{...e,scribble:{...e.scribble,delay:0}}:{...e},down:e=>{if(null!==e.scribble){let{delay:t,...n}=e.scribble;return{...e,scribble:n}}return{...e}}},[t9.RemoveUserId]:{up:({userId:e,...t})=>t,down:e=>({...e,userId:"user:none"})},[t9.AddIsPenModeAndIsGridMode]:{up:e=>({...e,isPenMode:!1,isGridMode:!1}),down:({isPenMode:e,isGridMode:t,...n})=>n},[t9.HoistOpacity]:{up:({propsForNextShape:{opacity:e,...t},...n})=>({...n,opacityForNextShape:Number(e??"1"),propsForNextShape:t}),down:({opacityForNextShape:e,...t})=>({...t,propsForNextShape:{...t.propsForNextShape,opacity:e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}})},[t9.AddChat]:{up:e=>({...e,chatMessage:"",isChatting:!1}),down:({chatMessage:e,isChatting:t,...n})=>n},[t9.AddHighlightedUserIds]:{up:e=>({...e,highlightedUserIds:[]}),down:({highlightedUserIds:e,...t})=>t},[t9.ReplacePropsForNextShapeWithStylesForNextShape]:{up:({propsForNextShape:e,...t})=>({...t,stylesForNextShape:{}}),down:({stylesForNextShape:e,...t})=>({...t,propsForNextShape:{color:"black",labelColor:"black",dash:"draw",fill:"none",size:"m",icon:"file",font:"draw",align:"middle",verticalAlign:"middle",geo:"rectangle",arrowheadStart:"none",arrowheadEnd:"arrow",spline:"line"}})},[t9.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})},[t9.RemoveCursorColor]:{up:e=>{let{color:t,...n}=e.cursor;return{...e,cursor:n}},down:e=>({...e,cursor:{...e.cursor,color:"black"}})},[t9.AddLonelyProperties]:{up:e=>({...e,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1}),down:({canMoveCamera:e,isFocused:t,devicePixelRatio:n,isCoarsePointer:r,openMenus:i,isChangingStyle:o,isReadOnly:s,...a})=>({...a})},[t9.ReadOnlyReadonly]:{up:({isReadOnly:e,...t})=>({...t,isReadonly:e}),down:({isReadonly:e,...t})=>({...t,isReadOnly:e})},[t9.AddHoveringCanvas]:{up:e=>({...e,isHoveringCanvas:null}),down:({isHoveringCanvas:e,...t})=>({...t})},[t9.AddScribbles]:{up:({scribble:e,...t})=>({...t,scribbles:[]}),down:({scribbles:e,...t})=>({...t,scribble:null})},[t9.AddInset]:{up:e=>({...e,insets:[!1,!1,!1,!1]}),down:({insets:e,...t})=>({...t})},[t9.AddDuplicateProps]:{up:e=>({...e,duplicateProps:null}),down:({duplicateProps:e,...t})=>({...t})}}}),ne="instance:instance",nt=tS.refine(e=>{if(!e.startsWith("page:")&&!e.startsWith("shape:"))throw Error('Parent ID must start with "page:" or "shape:"');return e}),nn=tU("shape"),nr=tR("instance_page_state",tT({typeName:tE("instance_page_state"),id:tU("instance_page_state"),pageId:t5,selectedShapeIds:tM(nn),hintingShapeIds:tM(nn),erasingShapeIds:tM(nn),hoveredShapeId:nn.nullable(),editingShapeId:nn.nullable(),croppingShapeId:nn.nullable(),focusedGroupId:nn.nullable(),meta:tA})),ni={AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5},no=e6("instance_page_state",{migrations:to({currentVersion:ni.RenamePropertiesAgain,migrators:{[ni.AddCroppingId]:{up:e=>({...e,croppingShapeId:null}),down:({croppingShapeId:e,...t})=>t},[ni.RemoveInstanceIdAndCameraId]:{up:({instanceId:e,cameraId:t,...n})=>n,down:e=>({...e,instanceId:ne,cameraId:tX.createId("void")})},[ni.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})},[ni.RenameProperties]:{up:e=>{let{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}=e;return{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}},down:e=>{let{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}=e;return{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}}},[ni.RenamePropertiesAgain]:{up:e=>{let{selectedIds:t,hintingIds:n,erasingIds:r,hoveredId:i,editingId:o,croppingShapeId:s,croppingId:a,focusLayerId:l,...d}=e;return{...d,selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s??a??null,focusedGroupId:l}},down:e=>{let{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}=e;return{...l,selectedIds:t,hintingIds:n,erasingIds:r,hoveredId:i,editingId:o,croppingId:s,focusLayerId:a}}}}}),validator:nr,scope:"session"}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),ns=tR("pointer",tT({typeName:tE("pointer"),id:tU("pointer"),x:tw,y:tw,lastActivityTimestamp:tw,meta:tA})),na={AddMeta:1},nl=e6("pointer",{validator:ns,migrations:to({currentVersion:na.AddMeta,migrators:{[na.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),nd=nl.createId("pointer"),nc=tR("instance_presence",tT({typeName:tE("instance_presence"),id:tU("instance_presence"),userId:tS,userName:tS,lastActivityTimestamp:tw,followingUserId:tS.nullable(),cursor:tT({x:tw,y:tw,type:tZ,rotation:tw}),color:tS,camera:tT({x:tw,y:tw,z:tw}),screenBounds:tq,selectedShapeIds:tM(tU("shape")),currentPageId:tU("page"),brush:tq.nullable(),scribbles:tM(t2),chatMessage:tS,meta:tA})),nu={AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5},nh=e6("instance_presence",{migrations:to({currentVersion:nu.RenameSelectedShapeIds,migrators:{[nu.AddScribbleDelay]:{up:e=>null!==e.scribble?{...e,scribble:{...e.scribble,delay:0}}:{...e},down:e=>{if(null!==e.scribble){let{delay:t,...n}=e.scribble;return{...e,scribble:n}}return{...e}}},[nu.RemoveInstanceId]:{up:({instanceId:e,...t})=>t,down:e=>({...e,instanceId:ne})},[nu.AddChatMessage]:{up:e=>({...e,chatMessage:""}),down:({chatMessage:e,...t})=>t},[nu.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})},[nu.RenameSelectedShapeIds]:{up:e=>{let{selectedShapeIds:t,...n}=e;return{selectedShapeIds:t,...n}},down:e=>{let{selectedShapeIds:t,...n}=e;return{selectedShapeIds:t,...n}}}}}),validator:nc,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})),np=tR("document",tT({typeName:tE("document"),id:tE("document:document"),gridSize:tw,name:tS,meta:tA})),ng={AddName:1,AddMeta:2},nf=e6("document",{migrations:to({currentVersion:ng.AddMeta,migrators:{[ng.AddName]:{up:e=>({...e,name:""}),down:({name:e,...t})=>t},[ng.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),validator:np,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),nm=nf.createId("document");function ny(e,t){return e.index<t.index?-1:e.index>t.index?1:0}function nb(e){"asset"===e.typeName&&("src"in e&&(e.src="<redacted>"),"src"in e.props&&(e.props.src="<redacted>"))}let nv=({error:e,phase:t,record:n,recordBefore:r})=>{throw eL(e,{tags:{origin:"store.validateRecord",storePhase:t,isExistingValidationIssue:"initialize"===t},extras:{recordBefore:r?nb(e1(r)):void 0,recordAfter:nb(e1(n))}}),e};function nx(e){let t=e.query.ids("page"),n=()=>{if(!e.has(nm))return e.put([nf.create({id:nm,name:e.props.defaultName})]),n();if(!e.has(nd))return e.put([nl.create({id:nd})]),n();let r=t.get();if(0===r.size)return e.put([t6.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]),n();let i=e.get(ne);if(!i)return e.put([e.schema.types.instance.create({id:ne,currentPageId:[...r].map(t=>e.get(t)).sort(ny)[0].id,exportBackground:!0})]),n();if(!r.has(i.currentPageId))return e.put([{...i,currentPageId:[...r].map(t=>e.get(t)).sort(ny)[0].id}]),n();let o=new Set,s=new Set;for(let t of r){let n=no.createId(t);e.has(n)||o.add(n);let r=tX.createId(t);e.has(r)||s.add(r)}o.size>0&&e.put([...o].map(e=>no.create({id:e,pageId:no.parseId(e)}))),s.size>0&&e.put([...s].map(e=>tX.create({id:e})))};return n}let nS=tH("bookmark",tT({title:tS,description:tS,image:tS,src:tV.nullable()})),nw={MakeUrlsValid:1},nC=to({currentVersion:nw.MakeUrlsValid,migrators:{[nw.MakeUrlsValid]:{up:e=>{let t=e.props.src;return t&&!tV.isValid(t)?{...e,props:{...e.props,src:""}}:e},down:e=>e}}}),n_=tH("image",tT({w:tw,h:tw,name:tS,isAnimated:tI,mimeType:tS.nullable(),src:tV.nullable()})),nk={AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3},nP=to({currentVersion:nk.MakeUrlsValid,migrators:{[nk.AddIsAnimated]:{up:e=>({...e,props:{...e.props,isAnimated:!1}}),down:e=>{let{isAnimated:t,...n}=e.props;return{...e,props:n}}},[nk.RenameWidthHeight]:{up:e=>{let{width:t,height:n,...r}=e.props;return{...e,props:{w:t,h:n,...r}}},down:e=>{let{w:t,h:n,...r}=e.props;return{...e,props:{width:t,height:n,...r}}}},[nk.MakeUrlsValid]:{up:e=>{let t=e.props.src;return t&&!tV.isValid(t)?{...e,props:{...e.props,src:""}}:e},down:e=>e}}}),nI=tH("video",tT({w:tw,h:tw,name:tS,isAnimated:tI,mimeType:tS.nullable(),src:tV.nullable()})),nE={AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3},nj=to({currentVersion:nE.MakeUrlsValid,migrators:{[nE.AddIsAnimated]:{up:e=>({...e,props:{...e.props,isAnimated:!1}}),down:e=>{let{isAnimated:t,...n}=e.props;return{...e,props:n}}},[nE.RenameWidthHeight]:{up:e=>{let{width:t,height:n,...r}=e.props;return{...e,props:{w:t,h:n,...r}}},down:e=>{let{w:t,h:n,...r}=e.props;return{...e,props:{width:t,height:n,...r}}}},[nE.MakeUrlsValid]:{up:e=>{let t=e.props.src;return t&&!tV.isValid(t)?{...e,props:{...e.props,src:""}}:e},down:e=>e}}}),nM=tR("asset",tO("type",{image:n_,video:nI,bookmark:nS})),nT={AddMeta:1},nA=e6("asset",{migrations:to({subTypeKey:"type",subTypeMigrations:{image:nP,video:nj,bookmark:nC},currentVersion:nT.AddMeta,migrators:{[nT.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),validator:nM,scope:"document"}).withDefaultProperties(()=>({meta:{}})),nO=e=>{!s||s.length<e?(s=Buffer.allocUnsafe(128*e),(0,e2.randomFillSync)(s),a=0):a+e>s.length&&((0,e2.randomFillSync)(s),a=0),a+=e},nR=(e=21)=>{nO(e-=0);let t="";for(let n=a-e;n<a;n++)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&s[n]];return t};class nL{constructor(e,t,n){this.id=e,this.defaultValue=t,this.type=n}static define(e,t){let{defaultValue:n,type:r=tx}=t;return new nL(e,n,r)}static defineEnum(e,t){let{defaultValue:n,values:r}=t;return new nD(e,n,r)}validate(e){return this.type.validate(e)}}class nD extends nL{constructor(e,t,n){super(e,t,tz(...n)),this.values=n}}let nz={AddIsLocked:1,HoistOpacity:2,AddMeta:3},nN=to({currentVersion:nz.AddMeta,migrators:{[nz.AddIsLocked]:{up:e=>({...e,isLocked:!1}),down:e=>{let{isLocked:t,...n}=e;return{...n}}},[nz.HoistOpacity]:{up:({props:{opacity:e,...t},...n})=>({...n,opacity:Number(e??"1"),props:t}),down:({opacity:e,...t})=>({...t,props:{...t.props,opacity:e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}})},[nz.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}});function n$(e){return!!e&&"shape"===e.typeName}function nF(e){return!!e&&e.startsWith("shape:")}function nB(e){return`shape:${e??nR()}`}function nV(e){let t=new Map;for(let[n,r]of Object.entries(e))if(r instanceof nL){if(t.has(r))throw Error(`Duplicate style prop ${r.id}. Each style prop can only be used once within a shape.`);t.set(r,n)}return t}let nU={RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4},nK=to({currentVersion:nU.RemoveUserDocument,migrators:{[nU.RemoveCodeAndIconShapeTypes]:{up:e=>Object.fromEntries(Object.entries(e).filter(([e,t])=>"shape"!==t.typeName||"icon"!==t.type&&"code"!==t.type)),down:e=>e},[nU.AddInstancePresenceType]:{up:e=>e,down:e=>Object.fromEntries(Object.entries(e).filter(([e,t])=>"instance_presence"!==t.typeName))},[nU.RemoveTLUserAndPresenceAndAddPointer]:{up:e=>Object.fromEntries(Object.entries(e).filter(([e,t])=>!t.typeName.match(/^(user|user_presence)$/))),down:e=>Object.fromEntries(Object.entries(e).filter(([e,t])=>"pointer"!==t.typeName))},[nU.RemoveUserDocument]:{up:e=>Object.fromEntries(Object.entries(e).filter(([e,t])=>!t.typeName.match("user_document"))),down:e=>e}}}),nH=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red"],nY={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4263eb",semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#adb5bd",semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4dabf7",semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#40c057",semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#ff8787",semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e599f7",semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#f76707",semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#ffc078",semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 8%)",solid:"#010403",black:{solid:"#e1e1e1",semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4263eb",semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#099268",semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#9398b0",semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#4dabf7",semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#40c057",semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#ff8787",semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#e599f7",semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#f76707",semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#e03131",semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#ae3ec9",semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#ffc034",semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}}}};function nW(e){return e.isDarkMode?nY.darkMode:nY.lightMode}let nX=nL.defineEnum("tldraw:color",{defaultValue:"black",values:nH});nL.defineEnum("tldraw:labelColor",{defaultValue:"black",values:nH});let nG=nL.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),nq=nL.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern"]}),nZ=nL.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),nJ=nL.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),nQ=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],n0=nL.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:nQ}),n1=nL.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:nQ});tO("type",{binding:tT({type:tE("binding"),boundShapeId:nn,normalizedAnchor:tG,isExact:tI,isPrecise:tI}),point:tT({type:tE("point"),x:tw,y:tw})});let n2={AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3};to({currentVersion:n2.AddLabelPosition,migrators:{[n2.AddLabelColor]:{up:e=>({...e,props:{...e.props,labelColor:"black"}}),down:e=>{let{labelColor:t,...n}=e.props;return{...e,props:n}}},[n2.AddIsPrecise]:{up:e=>{let{start:t,end:n}=e.props;return{...e,props:{...e.props,start:"binding"===t.type?{...t,isPrecise:!(.5===t.normalizedAnchor.x&&.5===t.normalizedAnchor.y)}:t,end:"binding"===n.type?{...n,isPrecise:!(.5===n.normalizedAnchor.x&&.5===n.normalizedAnchor.y)}:n}}},down:e=>{let{start:t,end:n}=e.props,r={...t},i={...n};return"binding"===r.type&&(r.isPrecise||(r.normalizedAnchor={x:.5,y:.5}),delete r.isPrecise),"binding"===i.type&&(i.isPrecise||(i.normalizedAnchor={x:.5,y:.5}),delete i.isPrecise),{...e,props:{...e.props,start:r,end:i}}}},[n2.AddLabelPosition]:{up:e=>({...e,props:{...e.props,labelPosition:.5}}),down:e=>{let{labelPosition:t,...n}=e.props;return{...e,props:n}}}}}),tK.nullable();let n5={NullAssetId:1,MakeUrlsValid:2};to({currentVersion:n5.MakeUrlsValid,migrators:{[n5.NullAssetId]:{up:e=>void 0===e.props.assetId?{...e,props:{...e.props,assetId:null}}:e,down:e=>{if(null===e.props.assetId){let{assetId:t,...n}=e.props;return{...e,props:n}}return e}},[n5.MakeUrlsValid]:{up:e=>""===e.props.url||tF.isValid(e.props.url)?e:{...e,props:{...e.props,url:""}},down:e=>e}}});let n3=tT({type:tz("free","straight"),points:tM(tG)});tM(n3);let n4={AddInPen:1};to({currentVersion:n4.AddInPen,migrators:{[n4.AddInPen]:{up:e=>{let{points:t}=e.props.segments[0];if(0===t.length)return{...e,props:{...e.props,isPen:!1}};let n=!(0===t[0].z||.5===t[0].z);return t[1]&&(n=n&&!(0===t[1].z||.5===t[1].z)),{...e,props:{...e.props,isPen:n}}},down:e=>{let{isPen:t,...n}=e.props;return{...e,props:{...n}}}}}});let n6=/(^\/r\/[^/]+\/?$)/,n8=e=>{try{return new URL(e)}catch(e){return}},n9=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:e=>{let t=n8(e);if(t&&t.pathname.match(n6))return e},fromEmbedUrl:e=>{let t=n8(e);if(t&&t.pathname.match(n6))return e}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:e=>{if(e.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!e.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${e}`},fromEmbedUrl:e=>{let t=n8(e);if(t&&t.pathname.match(/^\/embed\/?$/)){let e=t.searchParams.get("url");if(e)return e}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{if(e.includes("/maps/")){let t;let n=e.match(/@(.*),(.*),(.*)z/);if(n){let[,r,i,o]=n,s=new URL(e).host.replace("www.","");t=`https://${s}/maps/embed/v1/view?key=${process.env.NEXT_PUBLIC_GC_API_KEY}&center=${r},${i}&zoom=${o}`}else t="";return t}},fromEmbedUrl:e=>{let t=n8(e);if(t&&t.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&t.searchParams.has("center")&&t.searchParams.get("zoom")){let e=t.searchParams.get("zoom"),[n,r]=t.searchParams.get("center").split(",");return`https://www.google.com/maps/@${n},${r},${e}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=n8(e),n=t&&t.pathname.match(/\/v\/([^/]+)\/?/);if(n)return`https://www.val.town/embed/${n[1]}`},fromEmbedUrl:e=>{let t=n8(e),n=t&&t.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://www.val.town/v/${n[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=n8(e),n=t&&t.pathname.match(/\/s\/([^/]+)\/?/);if(n)return`https://codesandbox.io/embed/${n[1]}`},fromEmbedUrl:e=>{let t=n8(e),n=t&&t.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://codesandbox.io/s/${n[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=e.match(/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/);if(t){let[e,n,r]=t;return`https://codepen.io/${n}/embed/${r}`}},fromEmbedUrl:e=>{let t=e.match(/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/);if(t){let[e,n,r]=t;return`https://codepen.io/${n}/pen/${r}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,canUnmount:!1,toEmbedUrl:e=>{let t=e.match(/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/);if(t){let[e,n]=t;return`https://scratch.mit.edu/projects/embed/${n}`}},fromEmbedUrl:e=>{let t=e.match(/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/);if(t){let[e,n]=t;return`https://scratch.mit.edu/projects/${n}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,canUnmount:!1,overridePermissions:{"allow-presentation":!0},isAspectRatioLocked:!0,toEmbedUrl:e=>{let t=n8(e);if(!t)return;let n=t.hostname.replace(/^www./,"");if("youtu.be"===n){let e=t.pathname.split("/").filter(Boolean)[0];return`https://www.youtube.com/embed/${e}`}if(("youtube.com"===n||"m.youtube.com"===n)&&t.pathname.match(/^\/watch/)){let e=t.searchParams.get("v");return`https://www.youtube.com/embed/${e}`}},fromEmbedUrl:e=>{let t=n8(e);if(t&&"youtube.com"===t.hostname.replace(/^www./,"")){let e=t.pathname.match(/^\/embed\/([^/]+)\/?/);if(e)return`https://www.youtube.com/watch?v=${e[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,canUnmount:!1,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",toEmbedUrl:e=>{let t=n8(e),n=t?.searchParams.get("cid");if(t?.pathname.match(/\/calendar\/u\/0/)&&n){for(let e of(t.pathname="/calendar/embed",Array.from(t.searchParams.keys())))t.searchParams.delete(e);return t.searchParams.set("src",n),t.href}},fromEmbedUrl:e=>{let t=n8(e),n=t?.searchParams.get("src");if(t?.pathname.match(/\/calendar\/embed/)&&n){for(let e of(t.pathname="/calendar/u/0",Array.from(t.searchParams.keys())))t.searchParams.delete(e);return t.searchParams.set("cid",n),t.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=n8(e);if(t?.pathname.match(/^\/presentation/)&&t?.pathname.match(/\/pub\/?$/)){for(let e of(t.pathname=t.pathname.replace(/\/pub$/,"/embed"),Array.from(t.searchParams.keys())))t.searchParams.delete(e);return t.href}},fromEmbedUrl:e=>{let t=n8(e);if(t?.pathname.match(/^\/presentation/)&&t?.pathname.match(/\/embed\/?$/)){for(let e of(t.pathname=t.pathname.replace(/\/embed$/,"/pub"),Array.from(t.searchParams.keys())))t.searchParams.delete(e);return t.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:e=>{let t=n8(e);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/)){if(!e.split("/").pop())return;return e}},fromEmbedUrl:e=>{let t=n8(e);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/)){if(!e.split("/").pop())return;return e}}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=n8(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${e}?embed=true`},fromEmbedUrl:e=>{let t=n8(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/)&&t.searchParams.has("embed"))return t.searchParams.delete("embed"),t.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=n8(e);if(t&&t.pathname.match(/^\/map\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:e=>{let t=n8(e);if(t&&t.pathname.match(/^\/embed\/map\//))return t.pathname=t.pathname.replace(/^\/embed/,""),t.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=n8(e);if(t&&t.pathname.match(/^\/(artist|album)\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:e=>{let t=n8(e);if(t&&t.pathname.match(/^\/embed\/(artist|album)\//))return t.origin+t.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!0,toEmbedUrl:e=>{let t=n8(e);if(t&&"vimeo.com"===t.hostname&&t.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+t.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:e=>{let t=n8(e);if(t&&"player.vimeo.com"===t.hostname){let e=t.pathname.match(/^\/video\/([^/]+)\/?$/);if(e)return"https://vimeo.com/"+e[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!0,toEmbedUrl:e=>{let t=n8(e);if(t&&t.hash.match(/#room=/))return e},fromEmbedUrl:e=>{let t=n8(e);if(t&&t.hash.match(/#room=/))return e}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:e=>{let t=n8(e);if(t&&t.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${t.origin}/embed${t.pathname}?cell=*`;if(t&&t.pathname.match(/^\/d\/([^/]+)\/?$/)){let e=t.pathname.replace(/^\/d/,"");return`${t.origin}/embed${e}?cell=*`}},fromEmbedUrl:e=>{let t=n8(e);return t&&t.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/)?`${t.origin}${t.pathname.replace("/embed","")}#cell-*`:t&&t.pathname.match(/^\/embed\/([^/]+)\/?$/)?`${t.origin}${t.pathname.replace("/embed","/d")}#cell-*`:void 0}}],n7={GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4};to({currentVersion:n7.RemovePermissionOverrides,migrators:{[n7.GenOriginalUrlInEmbed]:{up:e=>{let t;let n=e.props.url,r=new URL(n).host.replace("www.","");for(let e of n9)if(e.hostnames.includes(r))try{t=e.fromEmbedUrl(n)}catch(e){console.warn(e)}return{...e,props:{...e.props,tmpOldUrl:e.props.url,url:t??""}}},down:e=>{let t=e.props.tmpOldUrl;if(!t||""===t){let n=e.props.url,r=new URL(n).host.replace("www.","");for(let e of n9)if(e.hostnames.includes(r))try{t=e.toEmbedUrl(n)}catch(e){console.warn(e)}}let{tmpOldUrl:n,...r}=e.props;return{...e,props:{...r,url:t??""}}}},[n7.RemoveDoesResize]:{up:e=>{let{doesResize:t,...n}=e.props;return{...e,props:{...n}}},down:e=>({...e,props:{...e.props,doesResize:!0}})},[n7.RemoveTmpOldUrl]:{up:e=>{let{tmpOldUrl:t,...n}=e.props;return{...e,props:{...n}}},down:e=>({...e,props:{...e.props}})},[n7.RemovePermissionOverrides]:{up:e=>{let{overridePermissions:t,...n}=e.props;return{...e,props:{...n}}},down:e=>({...e,props:{...e.props}})}}}),to({});let re=nL.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),rt=nL.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),rn=nL.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box"]}),rr={AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8};to({currentVersion:rr.MakeUrlsValid,migrators:{[rr.AddUrlProp]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{let{url:t,...n}=e.props;return{...e,props:n}}},[rr.AddLabelColor]:{up:e=>({...e,props:{...e.props,labelColor:"black"}}),down:e=>{let{labelColor:t,...n}=e.props;return{...e,props:n}}},[rr.RemoveJustify]:{up:e=>{let t=e.props.align;return"justify"===t&&(t="start"),{...e,props:{...e.props,align:t}}},down:e=>({...e})},[rr.AddCheckBox]:{up:e=>({...e}),down:e=>({...e,props:{...e.props,geo:"check-box"===e.props.geo?"rectangle":e.props.geo}})},[rr.AddVerticalAlign]:{up:e=>({...e,props:{...e.props,verticalAlign:"middle"}}),down:e=>{let{verticalAlign:t,...n}=e.props;return{...e,props:n}}},[rr.MigrateLegacyAlign]:{up:e=>{let t;switch(e.props.align){case"start":t="start-legacy";break;case"end":t="end-legacy";break;default:t="middle-legacy"}return{...e,props:{...e.props,align:t}}},down:e=>{let t;switch(e.props.align){case"start-legacy":t="start";break;case"end-legacy":t="end";break;case"middle-legacy":t="middle";break;default:t=e.props.align}return{...e,props:{...e.props,align:t}}}},[rr.AddCloud]:{up:e=>e,down:e=>{if("cloud"===e.props.geo)return{...e,props:{...e.props,geo:"rectangle"}}}},[rr.MakeUrlsValid]:{up:e=>""===e.props.url||tF.isValid(e.props.url)?e:{...e,props:{...e.props,url:""}},down:e=>e}}});let ri={},ro=to({});tM(n3),to({});let rs=tT({topLeft:tG,bottomRight:tG});tK.nullable(),rs.nullable();let ra={AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3};to({currentVersion:ra.MakeUrlsValid,migrators:{[ra.AddUrlProp]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{let{url:t,...n}=e.props;return{...e,props:n}}},[ra.AddCropProp]:{up:e=>({...e,props:{...e.props,crop:null}}),down:e=>{let{crop:t,...n}=e.props;return{...e,props:n}}},[ra.MakeUrlsValid]:{up:e=>""===e.props.url||tF.isValid(e.props.url)?e:{...e,props:{...e.props,url:""}},down:e=>e}}});let rl=tT({id:tS,type:tL(new Set(["vertex","virtual","create"])),canBind:tI.optional(),canSnap:tI.optional(),index:tS,x:tw,y:tw}),rd=nL.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]});new tb(tS,rl);let rc={AddSnapHandles:1};to({currentVersion:rc.AddSnapHandles,migrators:{[rc.AddSnapHandles]:{up:e=>{let t=eU(e.props.handles);for(let e in t)t[e].canSnap=!0;return{...e,props:{...e.props,handles:t}}},down:e=>{let t=eU(e.props.handles);for(let e in t)delete t[e].canSnap;return{...e,props:{...e.props,handles:t}}}}}});let ru={AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5};to({currentVersion:ru.MakeUrlsValid,migrators:{[ru.AddUrlProp]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{let{url:t,...n}=e.props;return{...e,props:n}}},[ru.RemoveJustify]:{up:e=>{let t=e.props.align;return"justify"===t&&(t="start"),{...e,props:{...e.props,align:t}}},down:e=>({...e})},[ru.MigrateLegacyAlign]:{up:e=>{let t;switch(e.props.align){case"start":t="start-legacy";break;case"end":t="end-legacy";break;default:t="middle-legacy"}return{...e,props:{...e.props,align:t}}},down:e=>{let t;switch(e.props.align){case"start-legacy":t="start";break;case"end-legacy":t="end";break;case"middle-legacy":t="middle";break;default:t=e.props.align}return{...e,props:{...e.props,align:t}}}},[ru.AddVerticalAlign]:{up:e=>({...e,props:{...e.props,verticalAlign:"middle"}}),down:e=>{let{verticalAlign:t,...n}=e.props;return{...e,props:n}}},[ru.MakeUrlsValid]:{up:e=>""===e.props.url||tF.isValid(e.props.url)?e:{...e,props:{...e.props,url:""}},down:e=>e}}});let rh={RemoveJustify:1};to({currentVersion:rh.RemoveJustify,migrators:{[rh.RemoveJustify]:{up:e=>{let t=e.props.align;return"justify"===t&&(t="start"),{...e,props:{...e.props,align:t}}},down:e=>({...e})}}}),tK.nullable();let rp={AddUrlProp:1,MakeUrlsValid:2};to({currentVersion:rp.MakeUrlsValid,migrators:{[rp.AddUrlProp]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{let{url:t,...n}=e.props;return{...e,props:n}}},[rp.MakeUrlsValid]:{up:e=>""===e.props.url||tF.isValid(e.props.url)?e:{...e,props:{...e.props,url:""}},down:e=>e}}});let rg=[{locale:"ca",label:"Catal\xe0"},{locale:"cs",label:"etina"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Espa\xf1ol"},{locale:"fr",label:"Fran\xe7ais"},{locale:"gl",label:"Galego"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Portugu\xeas - Brasil"},{locale:"pt-pt",label:"Portugu\xeas - Europeu"},{locale:"ro",label:"Rom\xe2n"},{locale:"ru",label:"Russian"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Ting Vit"},{locale:"tr",label:"T\xfcrk\xe7e"},{locale:"uk",label:"Ukrainian"},{locale:"he",label:""},{locale:"ar",label:""},{locale:"fa",label:""},{locale:"ku",label:""},{locale:"ne",label:""},{locale:"hi-in",label:""},{locale:"te",label:""},{locale:"th",label:""},{locale:"my",label:""},{locale:"ko-kr",label:""},{locale:"ja",label:""},{locale:"zh-cn",label:""},{locale:"zh-tw",label:" ()"}],rf={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};var rm=n(8029);let ry={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>e*(2-e),easeOutCubic:e=>--e*e*e+1,easeInOutCubic:e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInExpo:e=>e<=0?0:Math.pow(2,10*e-10)},rb=[.1,.25,.5,1,2,4,8],rv={};for(let e=1;e<=Math.ceil(8);e++)rv[e+"_dark"]=`hash_pattern_zoom_${e}_dark`,rv[e+"_light"]=`hash_pattern_zoom_${e}_light`;let rx={duration:0,easing:ry.easeInOutCubic},rS=[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],rw={CAMERA_MOVE:-10},rC={},r_={preventDefaultLogging:rk("preventDefaultLogging",{defaults:{all:!1}}),pointerCaptureLogging:rk("pointerCaptureLogging",{defaults:{all:!1}}),pointerCaptureTracking:rk("pointerCaptureTracking",{defaults:{all:!1}}),pointerCaptureTrackingObject:rk("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),elementRemovalLogging:rk("elementRemovalLogging",{defaults:{all:!1}}),debugSvg:rk("debugSvg",{defaults:{all:!1}}),showFps:rk("showFps",{defaults:{all:!1}}),throwToBlob:rk("throwToBlob",{defaults:{all:!1}}),logMessages:rk("uiLog",{defaults:{all:[]}}),resetConnectionEveryPing:rk("resetConnectionEveryPing",{defaults:{all:!1}}),debugCursors:rk("debugCursors",{defaults:{all:!1}}),forceSrgb:rk("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:rk("debugGeometry",{defaults:{all:!1}}),hideShapes:rk("hideShapes",{defaults:{all:!1}})};if("undefined"!=typeof window&&(window.tldrawLog=e=>{r_.logMessages.set(r_.logMessages.get().concat(e))}),"undefined"!=typeof Element){let e=Element.prototype.removeChild;G("element removal logging",()=>{r_.elementRemovalLogging.get()?Element.prototype.removeChild=function(t){return console.warn("[tldraw] removing child:",t),e.call(this,t)}:Element.prototype.removeChild=e})}function rk(e,{defaults:t,shouldStoreForSession:n=!0}){return function(e){let t=function(e){switch(rP(()=>process.env.TLDRAW_ENV)??rP(()=>process.env.VERCEL_PUBLIC_TLDRAW_ENV)??rP(()=>process.env.NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return e.defaults.production??e.defaults.all;case"preview":case"staging":return e.defaults.staging??e.defaults.all;default:return e.defaults.development??e.defaults.all}}(e),n=e.shouldStoreForSession?function(e){try{return JSON.parse(window?.sessionStorage.getItem(`tldraw_debug:${e}`)??"null")}catch(e){return null}}(e.name):null,r=er(`debug:${e.name}`,n??t);return"undefined"!=typeof window&&(e.shouldStoreForSession&&G(`debug:${e.name}`,()=>{let n=r.get();try{n===t?window.sessionStorage.removeItem(`tldraw_debug:${e.name}`):window.sessionStorage.setItem(`tldraw_debug:${e.name}`,JSON.stringify(n))}catch{}}),Object.defineProperty(window,`tldraw${e.name.replace(/^[a-z]/,e=>e.toUpperCase())}`,{get:()=>r.get(),set(e){r.set(e)},configurable:!0})),Object.assign(r,e)}({name:e,defaults:t,shouldStoreForSession:n})}function rP(e){try{return e()}catch{return null}}function rI(e){if(e instanceof HTMLElement)return e;if(e.parentElement)return rI(e.parentElement);throw Error("Could not find a parent element of an HTML type!")}function rE(e){e.preventDefault(),r_.preventDefaultLogging.get()&&console.warn("preventDefault called on event:",e)}function rj(e,t){if(e.setPointerCapture(t.pointerId),r_.pointerCaptureTracking.get()){let t=r_.pointerCaptureTrackingObject.get();t.set(e,(t.get(e)??0)+1)}r_.pointerCaptureLogging.get()&&console.warn("setPointerCapture called on element:",e,t)}function rM(e,t){if(e.hasPointerCapture(t.pointerId)){if(e.releasePointerCapture(t.pointerId),r_.pointerCaptureTracking.get()){let t=r_.pointerCaptureTrackingObject.get();1===t.get(e)?t.delete(e):t.has(e)?t.set(e,t.get(e)-1):console.warn("Release without capture")}r_.pointerCaptureLogging.get()&&console.warn("releasePointerCapture called on element:",e,t)}}let rT=e=>e.stopPropagation();function rA(e){return e.isKilled=!0,{point:{x:e.clientX,y:e.clientY,z:e.pressure},shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,pointerId:e.pointerId,button:e.button,isPen:"pen"===e.pointerType}}let rO=eg.createContext({});function rR(){return eg.useContext(rO)}let rL=(0,eg.createContext)(null);function rD({container:e,children:t}){return(0,j.jsx)(rL.Provider,{value:e,children:t})}function rz(){return eA((0,eg.useContext)(rL),"useContainer used outside of <Tldraw />")}let rN=["input","select","button","textarea"];function r$(){let{activeElement:e}=document;return!!(e&&(e.getAttribute("contenteditable")||rN.indexOf(e.tagName.toLowerCase())>-1))}let rF={error:null};class rB extends eg.Component{static getDerivedStateFromError(e){return{error:e}}state=rF;componentDidCatch(e){this.props.onError?.(e)}render(){let{error:e}=this.state;if(null!==e){let{fallback:t}=this.props;return(0,j.jsx)(t,{error:e})}return this.props.children}}function rV({children:e,fallback:t,...n}){return null===t?(0,j.jsx)(j.Fragment,{children:e}):(0,j.jsx)(rB,{fallback:t,...n,children:e})}class rU{constructor(e){this.shape=e}equals(e){return this.shape?.isLocked===e?.shape?.isLocked&&this.shape?.props===e?.shape?.props&&this.shape?.meta===e?.shape?.meta}}let rK=({shape:e,util:t})=>ey("Indicator:"+e.type,()=>t.indicator(e)),rH=({editor:e,id:t})=>{let n=e_("shape",()=>new rU(e.store.get(t)),[e,t]),{ShapeIndicatorErrorFallback:r}=iL();return!n.shape||n.shape.isLocked?null:(0,j.jsx)(rV,{fallback:r,onError:t=>e.annotateError(t,{origin:"react.shapeIndicator",willCrashApp:!1}),children:(0,j.jsx)(rK,{shape:n.shape,util:e.getShapeUtil(n.shape)},n.shape.id)})},rY=eg.memo(({id:e,className:t,color:n,opacity:r})=>{let i=rR(),o=e_("transform",()=>{let t=i.getShapePageTransform(e);return t?t.toCssString():""},[i,e]);return(0,j.jsx)("svg",{className:rm("tl-overlays__item",t),children:(0,j.jsx)("g",{className:"tl-shape-indicator",transform:o,stroke:n??"var(--color-selected)",opacity:r,children:(0,j.jsx)(rH,{editor:i,id:e})})})});function rW(){return(0,j.jsx)("div",{className:"tl-background"})}function rX(e,t,n,r,i,o){(0,eg.useLayoutEffect)(()=>{let s=e.current;if(!s||void 0===t)return;let a=`translate(${t}px, ${n}px)`;void 0!==r&&(a+=` scale(${r})`),void 0!==i&&(a+=` rotate(${i}rad)`),o&&(a+=` translate(${o.x}px, ${o.y}px)`),s.style.transform=a})}class rG{constructor(e=0,t=0,n=1){this.x=e,this.y=t,this.z=n}get pressure(){return this.z}set(e=this.x,t=this.y,n=this.z){return this.x=e,this.y=t,this.z=n,this}setTo({x:e=0,y:t=0,z:n=1}){return this.x=e,this.y=t,this.z=n,this}rot(e){if(0===e)return this;let{x:t,y:n}=this,r=Math.sin(e),i=Math.cos(e);return this.x=t*i-n*r,this.y=t*r+n*i,this}rotWith(e,t){if(0===t)return this;let n=this.x-e.x,r=this.y-e.y,i=Math.sin(t),o=Math.cos(t);return this.x=e.x+(n*o-r*i),this.y=e.y+(n*i+r*o),this}clone(){let{x:e,y:t,z:n}=this;return new rG(e,t,n)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,t){return this.x-=e,this.y-=t,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,t){return this.x+=e,this.y+=t,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,t){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),void 0!==t&&(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,t){let n=rG.Tan(e,this);return this.add(n.mul(t))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return rG.Dpr(this,e)}cpr(e){return rG.Cpr(this,e)}len2(){return rG.Len2(this)}len(){return rG.Len(this)}pry(e){return rG.Pry(this,e)}per(){let{x:e,y:t}=this;return this.x=t,this.y=-e,this}uni(){return rG.Uni(this)}tan(e){return rG.Tan(this,e)}dist(e){return rG.Dist(this,e)}distanceToLineSegment(e,t){return rG.DistanceToLineSegment(e,t,this)}slope(e){return rG.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return rG.Angle(this,e)}toAngle(){return rG.ToAngle(this)}lrp(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this}equals(e){return rG.Equals(this,e)}equalsXY(e,t){return rG.EqualsXY(this,e,t)}norm(){let e=this.len();return this.x=0===e?0:this.x/e,this.y=0===e?0:this.y/e,this}toFixed(){return rG.ToFixed(this)}toString(){return rG.ToString(rG.ToFixed(this))}toJson(){return rG.ToJson(this)}toArray(){return rG.ToArray(this)}static Add(e,t){return new rG(e.x+t.x,e.y+t.y)}static AddXY(e,t,n){return new rG(e.x+t,e.y+n)}static Sub(e,t){return new rG(e.x-t.x,e.y-t.y)}static SubXY(e,t,n){return new rG(e.x-t,e.y-n)}static AddScalar(e,t){return new rG(e.x+t,e.y+t)}static SubScalar(e,t){return new rG(e.x-t,e.y-t)}static Div(e,t){return new rG(e.x/t,e.y/t)}static Mul(e,t){return new rG(e.x*t,e.y*t)}static DivV(e,t){return new rG(e.x/t.x,e.y/t.y)}static MulV(e,t){return new rG(e.x*t.x,e.y*t.y)}static Neg(e){return new rG(-e.x,-e.y)}static Per(e){return new rG(e.y,-e.x)}static Dist2(e,t){return rG.Sub(e,t).len2()}static Abs(e){return new rG(Math.abs(e.x),Math.abs(e.y))}static Dist(e,t){return Math.hypot(e.y-t.y,e.x-t.x)}static Dpr(e,t){return e.x*t.x+e.y*t.y}static Cross(e,t){return new rG(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z)}static Cpr(e,t){return e.x*t.y-t.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return Math.hypot(e.x,e.y)}static Pry(e,t){return rG.Dpr(e,t)/rG.Len(t)}static Uni(e){return rG.Div(e,rG.Len(e))}static Tan(e,t){return rG.Uni(rG.Sub(e,t))}static Min(e,t){return new rG(Math.min(e.x,t.x),Math.min(e.y,t.y))}static Max(e,t){return new rG(Math.max(e.x,t.x),Math.max(e.y,t.y))}static From({x:e,y:t,z:n=1}){return new rG(e,t,n)}static FromArray(e){return new rG(e[0],e[1])}static Rot(e,t=0){let n=Math.sin(t),r=Math.cos(t);return new rG(e.x*r-e.y*n,e.x*n+e.y*r)}static RotWith(e,t,n){let r=e.x-t.x,i=e.y-t.y,o=Math.sin(n),s=Math.cos(n);return new rG(t.x+(r*s-i*o),t.y+(r*o+i*s))}static NearestPointOnLineThroughPoint(e,t,n){return rG.Mul(t,rG.Sub(n,e).pry(t)).add(e)}static NearestPointOnLineSegment(e,t,n,r=!0){let i=rG.Tan(t,e),o=rG.Add(e,rG.Mul(i,rG.Sub(n,e).pry(i)));if(r){if(o.x<Math.min(e.x,t.x))return rG.Cast(e.x<t.x?e:t);if(o.x>Math.max(e.x,t.x))return rG.Cast(e.x>t.x?e:t);if(o.y<Math.min(e.y,t.y))return rG.Cast(e.y<t.y?e:t);if(o.y>Math.max(e.y,t.y))return rG.Cast(e.y>t.y?e:t)}return o}static DistanceToLineThroughPoint(e,t,n){return rG.Dist(n,rG.NearestPointOnLineThroughPoint(e,t,n))}static DistanceToLineSegment(e,t,n,r=!0){return rG.Dist(n,rG.NearestPointOnLineSegment(e,t,n,r))}static Snap(e,t=1){return new rG(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}static Cast(e){return e instanceof rG?e:rG.From(e)}static Slope(e,t){return e.x===t.y?NaN:(e.y-t.y)/(e.x-t.x)}static Angle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}static Lrp(e,t,n){return rG.Sub(t,e).mul(n).add(e)}static Med(e,t){return new rG((e.x+t.x)/2,(e.y+t.y)/2)}static Equals(e,t){return 1e-4>Math.abs(e.x-t.x)&&1e-4>Math.abs(e.y-t.y)}static EqualsXY(e,t,n){return e.x===t&&e.y===n}static Clockwise(e,t,n){return(n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y)<0}static Rescale(e,t){let n=rG.Len(e);return new rG(t*e.x/n,t*e.y/n)}static ScaleWithOrigin(e,t,n){return rG.Sub(e,n).mul(t).add(n)}static ToFixed(e,t=2){return new rG(+e.x.toFixed(t),+e.y.toFixed(t),+e.z.toFixed(t))}static Nudge(e,t,n){return rG.Add(e,rG.Tan(t,e).mul(n))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let t=Math.atan2(e.y,e.x);return t<0&&(t+=2*Math.PI),t}static FromAngle(e,t=1){return new rG(Math.cos(e)*t,Math.sin(e)*t)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){let{x:t,y:n,z:r}=e;return{x:t,y:n,z:r}}static Average(e){let t=e.length,n=new rG(0,0);for(let r=0;r<t;r++)n.add(e[r]);return n.div(t)}static Clamp(e,t,n){return void 0===n?new rG(Math.min(Math.max(e.x,t)),Math.min(Math.max(e.y,t))):new rG(Math.min(Math.max(e.x,t),n),Math.min(Math.max(e.y,t),n))}static PointsBetween(e,t,n=6){let r=[];for(let i=0;i<n;i++){let o=ry.easeInQuad(i/(n-1)),s=rG.Lrp(e,t,o);s.z=Math.min(1,.5+.65*Math.abs(.5-rq(o))),r.push(s)}return r}static SnapToGrid(e,t=8){return new rG(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}}let rq=e=>e<.5?2*e*e:-1+(4-2*e)*e;function rZ(e){return`${is(e.x)},${is(e.y)} `}function rJ(e,t){return`${is((e.x+t.x)/2)},${is((e.y+t.y)/2)} `}let rQ=Math.PI,r0=rQ/2,r1=2*rQ,r2=Math.sin;function r5(e,t,n){return Math.max(t,void 0!==n?Math.min(e,n):e)}function r3(e,t=1e10){return e?Math.round(e*t)/t:0}function r4(e,t,n=1e-6){return Math.abs(e-t)<=n}function r6(e,t){let n=Math.pow(e-t,2)/Math.pow(e+t,2);return rQ*(e+t)*(1+3*n/(10+Math.sqrt(4-3*n)))}function r8(e){return(e%=r1)<0?e+=r1:0===e&&(e=0),e}function r9(e,t){return(e=r8(e))>(t=r8(t))&&(t+=r1),t-e}function r7(e,t){return r1-r9(e,t)}function ie(e,t){let n=(t-e)%r1;return 2*n%r1-n}function it(e,t,n){return new rG(e.x,e.y).add(rG.FromAngle(n,t))}function ir(e,t,n,r){let i=Math.max(e,n),o=Math.min(t,r);return i<=o?[i,o]:null}function ii(e,t,n){return(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y)}function io(e,t){let n,r,i=0;for(let o=0;o<t.length;o++){if((n=t[o]).x===e.x&&n.y===e.y||(r=t[(o+1)%t.length],rG.Dist(e,n)+rG.Dist(e,r)===rG.Dist(n,r)))return!0;n.y<=e.y?r.y>e.y&&ii(n,r,e)>0&&(i+=1):r.y<=e.y&&0>ii(n,r,e)&&(i-=1)}return 0!==i}function is(e){return+e.toFixed(4)}function ia(e){return+e.toFixed(2)}let il=e=>Math.abs(e)<Number.MAX_SAFE_INTEGER;function id(e,t,n,r){let i;if(Math.abs(e)>rQ){i=ie(t,r);let o=ie(r,n);return Math.abs(i)<Math.abs(o)?i/e:(e-o)/e}{let n=(i=ie(t,r))/e;return Math.sign(i)!==Math.sign(e)?Math.abs(n)>.5?1:0:n}}let ic=({brush:e,color:t,opacity:n,className:r})=>{let i=(0,eg.useRef)(null);rX(i,e.x,e.y);let o=is(Math.max(1,e.w)),s=is(Math.max(1,e.h));return(0,j.jsx)("svg",{className:"tl-overlays__item",ref:i,children:t?(0,j.jsxs)("g",{className:"tl-brush",opacity:n,children:[(0,j.jsx)("rect",{width:o,height:s,fill:t,opacity:.75}),(0,j.jsx)("rect",{width:o,height:s,fill:"none",stroke:t,opacity:.1})]}):(0,j.jsx)("rect",{className:`tl-brush tl-brush__default ${r}`,width:o,height:s})})},iu=({className:e,zoom:t,point:n,color:r,viewport:i,opacity:o=1})=>{let s=(0,eg.useRef)(null);return rX(s,r5(n.x,i.minX+5/t,i.maxX-5/t),r5(n.y,i.minY+5/t,i.maxY-5/t),1/t,rG.Angle(i.center,n)),(0,j.jsxs)("svg",{ref:s,className:rm("tl-overlays__item",e),children:[(0,j.jsx)("use",{href:"#cursor_hint",color:r,strokeWidth:3,stroke:"var(--color-background)"}),(0,j.jsx)("use",{href:"#cursor_hint",color:r,opacity:o})]})},ih=(0,eg.memo)(({className:e,zoom:t,point:n,color:r,name:i,chatMessage:o})=>{let s=(0,eg.useRef)(null);return(rX(s,n?.x,n?.y,1/t),n)?(0,j.jsxs)("div",{ref:s,className:rm("tl-overlays__item",e),children:[(0,j.jsx)("svg",{className:"tl-cursor",children:(0,j.jsx)("use",{href:"#cursor",color:r})}),o?(0,j.jsxs)(j.Fragment,{children:[i&&(0,j.jsx)("div",{className:"tl-nametag-title",style:{color:r},children:i}),(0,j.jsx)("div",{className:"tl-nametag-chat",style:{backgroundColor:r},children:o})]}):i&&(0,j.jsx)("div",{className:"tl-nametag",style:{backgroundColor:r},children:i})]}):null}),ip={openWindow:(e,t)=>window.open(e,t,"noopener noreferrer"),refreshPage:()=>window.location.reload(),hardReset:async()=>await window.__tldraw__hardReset?.()};function ig(){ip.hardReset()}function im(){}let iy=({error:e,editor:t})=>{let n=(0,eg.useRef)(null),[r,i]=(0,eg.useState)(!1),[o,s]=(0,eg.useState)(!1),[a,l]=(0,eg.useState)(!1),d=e instanceof Error?e.message:String(e),c=e instanceof Error?e.stack:null,u=e_("isDarkMode",()=>{try{if(t)return t.user.getIsDarkMode()}catch{}return null},[t]),[h,p]=(0,eg.useState)(null);(0,eg.useLayoutEffect)(()=>{null!==u&&p(u);let e=n.current?.parentElement,t=!1;for(;e;){if(e.classList.contains("tl-theme__dark")||e.classList.contains("tl-theme__light")){t=!0;break}e=e.parentElement}if(t){p(null);return}p(window.matchMedia("(prefers-color-scheme: dark)").matches)},[u]),(0,eg.useEffect)(()=>{if(o){let e=setTimeout(()=>{s(!1)},2e3);return()=>clearTimeout(e)}},[o]);let g=async()=>{ig()},f=new URL("https://github.com/tldraw/tldraw/issues/new");return f.searchParams.set("title",d),f.searchParams.set("labels","bug"),f.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${c??d}
\`\`\`

My browser: ${navigator.userAgent}`),(0,j.jsxs)("div",{ref:n,className:rm("tl-container tl-error-boundary",null===h?"":h?"tl-theme__dark":"tl-theme__light"),children:[(0,j.jsx)("div",{className:"tl-error-boundary__overlay"}),t&&(0,j.jsx)(rB,{onError:im,fallback:()=>null,children:(0,j.jsx)(rO.Provider,{value:t,children:(0,j.jsx)("div",{className:"tl-overlay tl-error-boundary__canvas",children:(0,j.jsx)(oK,{})})})}),(0,j.jsx)("div",{className:rm("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":r&&!a}),children:a?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("h2",{children:"Are you sure?"}),(0,j.jsx)("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),(0,j.jsxs)("div",{className:"tl-error-boundary__content__actions",children:[(0,j.jsx)("button",{onClick:()=>l(!1),children:"Cancel"}),(0,j.jsx)("button",{className:"tl-error-boundary__reset",onClick:g,children:"Reset data"})]})]}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("h2",{children:"Something's gone wrong."}),(0,j.jsxs)("p",{children:["Sorry, we encountered an error. Please refresh the page to continue. If you keep seeing this error, you can ",(0,j.jsx)("a",{href:f.toString(),children:"create a GitHub issue"})," or"," ",(0,j.jsx)("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"ask for help on Discord"}),"."]}),r&&(0,j.jsxs)("div",{className:"tl-error-boundary__content__error",children:[(0,j.jsx)("pre",{children:(0,j.jsx)("code",{children:c??d})}),(0,j.jsx)("button",{onClick:()=>{let e=document.createElement("textarea");e.value=c??d,document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove(),s(!0)},children:o?"Copied!":"Copy"})]}),(0,j.jsxs)("div",{className:"tl-error-boundary__content__actions",children:[(0,j.jsx)("button",{onClick:()=>i(!r),children:r?"Hide details":"Show details"}),(0,j.jsxs)("div",{className:"tl-error-boundary__content__actions__group",children:[(0,j.jsx)("button",{className:"tl-error-boundary__reset",onClick:()=>l(!0),children:"Reset data"}),(0,j.jsx)("button",{className:"tl-error-boundary__refresh",onClick:()=>{ip.refreshPage()},children:"Refresh Page"})]})]})]})})]})},ib=({x:e,y:t,z:n,size:r})=>(0,j.jsxs)("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[(0,j.jsx)("defs",{children:rS.map(({min:i,mid:o,step:s},a)=>{let l=s*r*n,d=.5+e*n,c=.5+t*n,u=d>0?d%l:l+d%l,h=c>0?c%l:l+c%l,p=n<o?eF(n,[i,o],[0,1]):1;return(0,j.jsx)("pattern",{id:`grid-${s}`,width:l,height:l,patternUnits:"userSpaceOnUse",children:(0,j.jsx)("circle",{className:"tl-grid-dot",cx:u,cy:h,r:1,opacity:p})},`grid-pattern-${a}`)})}),rS.map(({step:e},t)=>(0,j.jsx)("rect",{width:"100%",height:"100%",fill:`url(#grid-${e})`},`grid-rect-${t}`))]}),iv=({handle:e,isCoarse:t,className:n,zoom:r})=>{let i=("create"===e.type&&t?3:4)/r;return(0,j.jsxs)("g",{className:rm("tl-handle",{"tl-handle__virtual":"virtual"===e.type,"tl-handle__create":"create"===e.type},n),children:[(0,j.jsx)("circle",{className:"tl-handle__bg",r:(t?20:12)/r}),(0,j.jsx)("circle",{className:"tl-handle__fg",r:i})]})},ix=({children:e})=>(0,j.jsx)("svg",{className:"tl-user-handles tl-overlays__item",children:e}),iS=({shapeId:e})=>(0,j.jsx)(rY,{className:"tl-user-indicator__hovered",id:e});function iw(e,t=!0){let n=e.length;if(n<2)return"";let r=e[0],i=e[1];if(2===n)return`M${rZ(r)}L${rZ(i)}`;let o="";for(let t=2,s=n-1;t<s;t++)o+=rJ(r=e[t],i=e[t+1]);return t?`M${rJ(e[0],e[1])}Q${rZ(e[1])}${rJ(e[1],e[2])}T${o}${rJ(e[n-1],e[0])}${rJ(e[0],e[1])}Z`:`M${rZ(e[0])}Q${rZ(e[1])}${rJ(e[1],e[2])}${e.length>3?"T":""}${o}L${rZ(e[n-1])}`}let iC=({scribble:e,zoom:t,color:n,opacity:r,className:i})=>e.points.length?(0,j.jsx)("svg",{className:i?rm("tl-overlays__item",i):i,children:(0,j.jsx)("path",{className:"tl-scribble",d:iw(e.points,!1),stroke:n??`var(--color-${e.color})`,fill:"none",strokeWidth:8/t,opacity:r??e.opacity})}):null,i_=({bounds:e,rotation:t})=>{let n=eg.useRef(null);return rX(n,e.x,e.y,1,t),eg.useLayoutEffect(()=>{let t=n.current;t&&(t.style.width=is(Math.max(1,e.width))+"px",t.style.height=is(Math.max(1,e.height))+"px")},[e.width,e.height]),(0,j.jsx)("div",{ref:n,className:"tl-selection__bg",draggable:!1})},ik=({bounds:e,rotation:t})=>{let n=rR(),r=(0,eg.useRef)(null),i=e_("only selected shape",()=>n.getOnlySelectedShape(),[n]),o=i?n.getShapeUtil(i).expandSelectionOutlinePx(i):0;return rX(r,e?.x,e?.y,1,t,{x:-o,y:-o}),e=e.clone().expandBy(o).zeroFix(),(0,j.jsx)("svg",{ref:r,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:(0,j.jsx)("rect",{className:rm("tl-selection__fg__outline"),width:is(e.width),height:is(e.height)})})},iP=()=>(0,j.jsx)("div",{className:"tl-shape-error-boundary"}),iI=()=>(0,j.jsx)("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"});function iE({points:e,zoom:t}){let n,r,i,o;let s=2.5/t,a=e.reduce((e,t)=>Math.min(e,t.x),1/0),l=e.reduce((e,t)=>Math.max(e,t.x),-1/0),d=e.reduce((e,t)=>Math.min(e,t.y),1/0),c=e.reduce((e,t)=>Math.max(e,t.y),-1/0);return e.some(e=>e.x===a&&e.y===d)?(n=a,r=d,i=l,o=c):(n=a,r=c,i=l,o=d),(0,j.jsxs)("g",{className:"tl-snap-line",children:[(0,j.jsx)("line",{x1:n,y1:r,x2:i,y2:o}),e.map((e,t)=>(0,j.jsx)("g",{transform:`translate(${e.x},${e.y})`,children:(0,j.jsx)("path",{className:"tl-snap-point",d:`M ${-s},${-s} L ${s},${s} M ${-s},${s} L ${s},${-s}`})},t))]})}function ij({gaps:e,direction:t,zoom:n}){let r=3.5/n,i=[-1/0,1/0],o=null,s="horizontal"===t;for(let t of e)(o=ir(i[0],i[1],s?t.startEdge[0].y:t.startEdge[0].x,s?t.startEdge[1].y:t.startEdge[1].x))&&(o=ir((i=o)[0],i[1],s?t.endEdge[0].y:t.endEdge[0].x,s?t.endEdge[1].y:t.endEdge[1].x))&&(i=o);if(null===i)return null;let a=(i[0]+i[1])/2;return(0,j.jsx)("g",{className:"tl-snap-line",children:e.map(({startEdge:e,endEdge:t},n)=>(0,j.jsx)(eg.Fragment,{children:s?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("line",{x1:e[0].x,y1:a-2*r,x2:e[1].x,y2:a+2*r}),(0,j.jsx)("line",{x1:t[0].x,y1:a-2*r,x2:t[1].x,y2:a+2*r}),(0,j.jsx)("line",{x1:e[0].x,y1:a,x2:t[0].x,y2:a}),(0,j.jsx)("line",{x1:(e[0].x+t[0].x)/2,y1:a-r,x2:(e[0].x+t[0].x)/2,y2:a+r})]}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("line",{x1:a-2*r,y1:e[0].y,x2:a+2*r,y2:e[1].y}),(0,j.jsx)("line",{x1:a-2*r,y1:t[0].y,x2:a+2*r,y2:t[1].y}),(0,j.jsx)("line",{x1:a,y1:e[0].y,x2:a,y2:t[0].y}),(0,j.jsx)("line",{x1:a-r,y1:(e[0].y+t[0].y)/2,x2:a+r,y2:(e[0].y+t[0].y)/2})]})},n))})}let iM=({className:e,line:t,zoom:n})=>(0,j.jsx)("svg",{className:rm("tl-overlays__item",e),children:"points"===t.type?(0,j.jsx)(iE,{...t,zoom:n}):"gaps"===t.type?(0,j.jsx)(ij,{...t,zoom:n}):null}),iT=()=>(0,j.jsx)("svg",{width:16,height:16,viewBox:"0 0 16 16",children:(0,j.jsxs)("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[(0,j.jsx)("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"var(--color-text-1)"}),(0,j.jsx)("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"var(--color-text-1)",children:(0,j.jsx)("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})}),iA=()=>null,iO=(0,eg.createContext)({});function iR({overrides:e,children:t}){return(0,j.jsx)(iO.Provider,{value:(0,eg.useMemo)(()=>({Background:rW,SvgDefs:iA,Brush:ic,ZoomBrush:ic,ScreenshotBrush:ic,CollaboratorBrush:ic,Cursor:ih,CollaboratorCursor:ih,CollaboratorHint:iu,CollaboratorShapeIndicator:rY,Grid:ib,Scribble:iC,SnapLine:iM,Handles:ix,Handle:iv,CollaboratorScribble:iC,ErrorFallback:iy,ShapeErrorFallback:iP,ShapeIndicatorErrorFallback:iI,Spinner:iT,SelectionBackground:i_,SelectionForeground:ik,HoveredShapeIndicator:iS,OnTheCanvas:null,InFrontOfTheCanvas:null,...e}),[e]),children:t})}function iL(){return(0,eg.useContext)(iO)}let iD=["textarea","input"],iz={toVector:(e,t)=>(void 0===e&&(e=t),Array.isArray(e)?e:[e,e]),add:(e,t)=>[e[0]+t[0],e[1]+t[1]],sub:(e,t)=>[e[0]-t[0],e[1]-t[1]],addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function iN(e,t,n){return 0===t||Math.abs(t)===1/0?Math.pow(e,5*n):e*t*n/(t+n*e)}function i$(e,t,n,r=.15){return 0===r?Math.max(t,Math.min(e,n)):e<t?-iN(t-e,n-t,r)+t:e>n?+iN(e-n,n-t,r)+n:e}function iF(e,t,n){var r;return(t="symbol"==typeof(r=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?r:String(r))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function iB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function iV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?iB(Object(n),!0).forEach(function(t){iF(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iB(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let iU={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function iK(e){return e?e[0].toUpperCase()+e.slice(1):""}let iH=["enter","leave"],iY=["gotpointercapture","lostpointercapture"];function iW(e){return"touches"in e}function iX(e){return iW(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}function iG(e){return iW(e)?("touchend"===e.type||"touchcancel"===e.type?e.changedTouches:e.targetTouches)[0]:e}function iq(e,t){try{let n=t.clientX-e.clientX,r=t.clientY-e.clientY,i=(t.clientX+e.clientX)/2,o=(t.clientY+e.clientY)/2;return{angle:-(180*Math.atan2(n,r))/Math.PI,distance:Math.hypot(n,r),origin:[i,o]}}catch(e){}return null}function iZ(e,t){let[n,r]=Array.from(e.touches).filter(e=>t.includes(e.identifier));return iq(n,r)}function iJ(e){let t=iG(e);return iW(e)?t.identifier:t.pointerId}function iQ(e){let t=iG(e);return[t.clientX,t.clientY]}function i0(e){let{deltaX:t,deltaY:n,deltaMode:r}=e;return 1===r?(t*=40,n*=40):2===r&&(t*=800,n*=800),[t,n]}function i1(e,...t){return"function"==typeof e?e(...t):e}function i2(){}function i5(e,t){return Object.assign({},t,e||{})}class i3{constructor(e,t,n){this.ctrl=e,this.args=t,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){let{state:e,shared:t,ingKey:n,args:r}=this;t[n]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=r,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){let t=this.state,n=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=n.from?i1(n.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){let t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){let e=this.state;e._initial=e._values,e.initial=e.values}compute(e){let{state:t,config:n,shared:r}=this;t.args=this.args;let i=0;if(e&&(t.event=e,n.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,r.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,r.locked=!!document.pointerLockElement,Object.assign(r,function(e){let t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){let{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o}=e;Object.assign(t,{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o})}return t}(e)),r.down=r.pressed=r.buttons%2==1||r.touches>0,i=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){let e=t._delta.map(Math.abs);iz.addTo(t._distance,e)}this.axisIntent&&this.axisIntent(e);let[o,s]=t._movement,[a,l]=n.threshold,{_step:d,values:c}=t;if(n.hasCustomTransform?(!1===d[0]&&(d[0]=Math.abs(o)>=a&&c[0]),!1===d[1]&&(d[1]=Math.abs(s)>=l&&c[1])):(!1===d[0]&&(d[0]=Math.abs(o)>=a&&Math.sign(o)*a),!1===d[1]&&(d[1]=Math.abs(s)>=l&&Math.sign(s)*l)),t.intentional=!1!==d[0]||!1!==d[1],!t.intentional)return;let u=[0,0];if(n.hasCustomTransform){let[e,t]=c;u[0]=!1!==d[0]?e-d[0]:0,u[1]=!1!==d[1]?t-d[1]:0}else u[0]=!1!==d[0]?o-d[0]:0,u[1]=!1!==d[1]?s-d[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(u);let h=t.offset,p=t._active&&!t._blocked||t.active;p&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=r[this.ingKey]=t._active,e&&(t.first&&("bounds"in n&&(t._bounds=i1(n.bounds,t)),this.setup&&this.setup()),t.movement=u,this.computeOffset()));let[g,f]=t.offset,[[m,y],[b,v]]=t._bounds;t.overflow=[g<m?-1:g>y?1:0,f<b?-1:f>v?1:0],t._movementBound[0]=!!t.overflow[0]&&(!1===t._movementBound[0]?t._movement[0]:t._movementBound[0]),t._movementBound[1]=!!t.overflow[1]&&(!1===t._movementBound[1]?t._movement[1]:t._movementBound[1]);let x=t._active&&n.rubberband||[0,0];if(t.offset=function(e,[t,n],[r,i]){let[[o,s],[a,l]]=e;return[i$(t,o,s,r),i$(n,a,l,i)]}(t._bounds,t.offset,x),t.delta=iz.sub(t.offset,h),this.computeMovement(),p&&(!t.last||i>32)){t.delta=iz.sub(t.offset,h);let e=t.delta.map(Math.abs);iz.addTo(t.distance,e),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&i>0&&(t.velocity=[e[0]/i,e[1]/i],t.timeDelta=i)}}emit(){let e=this.state,t=this.shared,n=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!n.triggerAllEvents)return;let r=this.handler(iV(iV(iV({},t),e),{},{[this.aliasKey]:e.values}));void 0!==r&&(e.memo=r)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}class i4 extends i3{constructor(...e){super(...e),iF(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=iz.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=iz.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){let t=this.state,n=this.config;if(!t.axis&&e){let r="object"==typeof n.axisThreshold?n.axisThreshold[iX(e)]:n.axisThreshold;t.axis=function([e,t],n){let r=Math.abs(e),i=Math.abs(t);return r>i&&r>n?"x":i>r&&i>n?"y":void 0}(t._movement,r)}t._blocked=(n.lockDirection||!!n.axis)&&!t.axis||!!n.axis&&n.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0}}}let i6=e=>e,i8={enabled:(e=!0)=>e,eventOptions:(e,t,n)=>iV(iV({},n.shared.eventOptions),e),preventDefault:(e=!1)=>e,triggerAllEvents:(e=!1)=>e,rubberband(e=0){switch(e){case!0:return[.15,.15];case!1:return[0,0];default:return iz.toVector(e)}},from:e=>"function"==typeof e?e:null!=e?iz.toVector(e):void 0,transform(e,t,n){let r=e||n.shared.transform;return this.hasCustomTransform=!!r,r||i6},threshold:e=>iz.toVector(e,0)},i9=0,i7=iV(iV({},i8),{},{axis(e,t,{axis:n}){if(this.lockDirection="lock"===n,!this.lockDirection)return n},axisThreshold:(e=i9)=>e,bounds(e={}){if("function"==typeof e)return t=>i7.bounds(e(t));if("current"in e)return()=>e.current;if("function"==typeof HTMLElement&&e instanceof HTMLElement)return e;let{left:t=-1/0,right:n=1/0,top:r=-1/0,bottom:i=1/0}=e;return[[t,n],[r,i]]}}),oe={ArrowRight:(e,t=1)=>[e*t,0],ArrowLeft:(e,t=1)=>[-1*e*t,0],ArrowUp:(e,t=1)=>[0,-1*e*t],ArrowDown:(e,t=1)=>[0,e*t]},ot="undefined"!=typeof window&&window.document&&window.document.createElement;function on(){return ot&&"ontouchstart"in window}let or={isBrowser:ot,gesture:function(){try{return"constructor"in GestureEvent}catch(e){return!1}}(),touch:on(),touchscreen:on()||ot&&window.navigator.maxTouchPoints>1,pointer:ot&&"onpointerdown"in window,pointerLock:ot&&"exitPointerLock"in window.document},oi=10,oo={mouse:0,touch:0,pen:8};function os(e){let[t,n]=e.overflow,[r,i]=e._delta,[o,s]=e._direction;(t<0&&r>0&&o<0||t>0&&r<0&&o>0)&&(e._movement[0]=e._movementBound[0]),(n<0&&i>0&&s<0||n>0&&i<0&&s>0)&&(e._movement[1]=e._movementBound[1])}iV(iV({},i7),{},{device(e,t,{pointer:{touch:n=!1,lock:r=!1,mouse:i=!1}={}}){return(this.pointerLock=r&&or.pointerLock,or.touch&&n)?"touch":this.pointerLock?"mouse":or.pointer&&!i?"pointer":or.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:n}){if(this.preventScrollDelay="number"==typeof n?n:n||void 0===n&&e?250:void 0,or.touchscreen&&!1!==n)return e||(void 0!==n?"y":void 0)},pointerCapture(e,t,{pointer:{capture:n=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&"pointer"===this.device&&n},threshold(e,t,{filterTaps:n=!1,tapsThreshold:r=3,axis:i}){let o=iz.toVector(e,n?r:i?1:0);return this.filterTaps=n,this.tapsThreshold=r,o},swipe({velocity:e=.5,distance:t=50,duration:n=250}={}){return{velocity:this.transform(iz.toVector(e)),distance:this.transform(iz.toVector(t)),duration:n}},delay(e=0){switch(e){case!0:return 180;case!1:return 0;default:return e}},axisThreshold:e=>e?iV(iV({},oo),e):oo,keyboardDisplacement:(e=oi)=>e});class oa extends i3{constructor(...e){super(...e),iF(this,"ingKey","pinching"),iF(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();let e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){let{type:e,movement:t,lastOffset:n}=this.state;"wheel"===e?this.state.offset=iz.add(t,n):this.state.offset=[(1+t[0])*n[0],t[1]+n[1]]}computeMovement(){let{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){let e=this.state,[t,n]=e._movement;if(!e.axis){let r=30*Math.abs(t)-Math.abs(n);r<0?e.axis="angle":r>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&("scale"===this.state.axis?e[1]=0:"angle"===this.state.axis&&(e[0]=0))}cancel(){let e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);let t=this.state,n=this.ctrl.touchIds;if(t._active&&t._touchIds.every(e=>n.has(e))||n.size<2)return;this.start(e),t._touchIds=Array.from(n).slice(0,2);let r=iZ(e,t._touchIds);r&&this.pinchStart(e,r)}pointerStart(e){if(null!=e.buttons&&e.buttons%2!=1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);let t=this.state,n=t._pointerEvents,r=this.ctrl.pointerIds;if(t._active&&Array.from(n.keys()).every(e=>r.has(e))||(n.size<2&&n.set(e.pointerId,e),t._pointerEvents.size<2))return;this.start(e);let i=iq(...Array.from(n.values()));i&&this.pinchStart(e,i)}pinchStart(e,t){this.state.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;let t=iZ(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){let t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;let n=iq(...Array.from(t.values()));n&&this.pinchMove(e,n)}pinchMove(e,t){let n=this.state,r=n._values[1],i=t.angle-r,o=0;Math.abs(i)>270&&(o+=Math.sign(i)),this.computeValues([t.distance,t.angle-360*o]),n.origin=t.origin,n.turns=o,n._movement=[n._values[0]/n._initial[0]-1,n._values[1]-n._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(e=>!this.ctrl.touchIds.has(e))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){let t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch(e){}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();let t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;let t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];let n=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=iz.sub(t._movement,n),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){let t=this.config.modifierKey;(!t||(Array.isArray(t)?t.find(t=>e[t]):e[t]))&&(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||!e.cancelable||e.preventDefault();let t=this.state;t._delta=[-i0(e)[1]/100*t.offset[0],0],iz.addTo(t._movement,t._delta),os(t),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){let t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}let ol=iV(iV({},i8),{},{device(e,t,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!or.touch&&or.gesture)return"gesture";if(or.touch&&r)return"touch";if(or.touchscreen){if(or.pointer)return"pointer";if(or.touch)return"touch"}},bounds(e,t,{scaleBounds:n={},angleBounds:r={}}){let i=e=>{let t=i5(i1(n,e),{min:-1/0,max:1/0});return[t.min,t.max]},o=e=>{let t=i5(i1(r,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!=typeof n&&"function"!=typeof r?[i(),o()]:e=>[i(e),o(e)]},threshold(e,t,n){return this.lockDirection="lock"===n.axis,iz.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey:e=>void 0===e?"ctrlKey":e,pinchOnWheel:(e=!0)=>e});iV(iV({},i7),{},{mouseOnly:(e=!0)=>e});class od extends i4{constructor(...e){super(...e),iF(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){let t=this.state;t._delta=i0(e),iz.addTo(t._movement,t._delta),os(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}iV(iV({},i7),{},{mouseOnly:(e=!0)=>e});let oc=new Map,ou=new Map,oh={target(e){if(e)return()=>"current"in e?e.current:e},enabled:(e=!0)=>e,window:(e=or.isBrowser?window:void 0)=>e,eventOptions:({passive:e=!0,capture:t=!1}={})=>({passive:e,capture:t}),transform:e=>e},op=["target","eventOptions","window","enabled","transform"];function og(e={},t){let n={};for(let[r,i]of Object.entries(t))switch(typeof i){case"function":n[r]=i.call(n,e[r],r,e);break;case"object":n[r]=og(e[r],i);break;case"boolean":i&&(n[r]=e[r])}return n}class of{constructor(e,t){iF(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,n,r,i){let o=this._listeners,s=function(e,t=""){let n=iU[e];return e+(n&&n[t]||t)}(t,n),a=iV(iV({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),i);e.addEventListener(s,r,a);let l=()=>{e.removeEventListener(s,r,a),o.delete(l)};return o.add(l),l}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class om{constructor(){iF(this,"_timeouts",new Map)}add(e,t,n=140,...r){this.remove(e),this._timeouts.set(e,window.setTimeout(t,n,...r))}remove(e){let t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class oy{constructor(e){iF(this,"gestures",new Set),iF(this,"_targetEventStore",new of(this)),iF(this,"gestureEventStores",{}),iF(this,"gestureTimeoutStores",{}),iF(this,"handlers",{}),iF(this,"config",{}),iF(this,"pointerIds",new Set),iF(this,"touchIds",new Set),iF(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),function(e,t){t.drag&&ob(e,"drag"),t.wheel&&ob(e,"wheel"),t.scroll&&ob(e,"scroll"),t.move&&ob(e,"move"),t.pinch&&ob(e,"pinch"),t.hover&&ob(e,"hover")}(this,e)}setEventIds(e){return iW(e)?(this.touchIds=new Set(Array.from(e.touches).filter(t=>{var n,r;return t.target===e.currentTarget||(null===(n=e.currentTarget)||void 0===n||null===(r=n.contains)||void 0===r?void 0:r.call(n,t.target))}).map(e=>e.identifier)),this.touchIds):"pointerId"in e?("pointerup"===e.type||"pointercancel"===e.type?this.pointerIds.delete(e.pointerId):"pointerdown"===e.type&&this.pointerIds.add(e.pointerId),this.pointerIds):void 0}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=function(e,t,n={}){let{target:r,eventOptions:i,window:o,enabled:s,transform:a}=e,l=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,op);if(n.shared=og({target:r,eventOptions:i,window:o,enabled:s,transform:a},oh),t){let e=ou.get(t);n[t]=og(iV({shared:n.shared},l),e)}else for(let e in l){let t=ou.get(e);t&&(n[e]=og(iV({shared:n.shared},l[e]),t))}return n}(e,t,this.config)}clean(){for(let e of(this._targetEventStore.clean(),this.gestures))this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){let t;let n=this.config.shared,r={};if(!n.target||(t=n.target())){if(n.enabled){for(let n of this.gestures){let i=this.config[n],o=ov(r,i.eventOptions,!!t);i.enabled&&new(oc.get(n))(this,e,n).bind(o)}let i=ov(r,n.eventOptions,!!t);for(let t in this.nativeHandlers)i(t,"",n=>this.nativeHandlers[t](iV(iV({},this.state.shared),{},{event:n,args:e})),void 0,!0)}for(let e in r)r[e]=function(...e){return 0===e.length?i2:1===e.length?e[0]:function(){let t;for(let n of e)t=n.apply(this,arguments)||t;return t}}(...r[e]);if(!t)return r;for(let e in r){let{device:n,capture:i,passive:o}=function(e){let t=e.substring(2).toLowerCase(),n=!!~t.indexOf("passive");n&&(t=t.replace("passive",""));let r=iY.includes(t)?"capturecapture":"capture",i=!!~t.indexOf(r);return i&&(t=t.replace("capture","")),{device:t,capture:i,passive:n}}(e);this._targetEventStore.add(t,n,"",r[e],{capture:i,passive:o})}}}}function ob(e,t){e.gestures.add(t),e.gestureEventStores[t]=new of(e,t),e.gestureTimeoutStores[t]=new om}let ov=(e,t,n)=>(r,i,o,s={},a=!1)=>{var l,d;let c=null!==(l=s.capture)&&void 0!==l?l:t.capture,u=null!==(d=s.passive)&&void 0!==d?d:t.passive,h=a?r:function(e,t="",n=!1){let r=iU[e],i=r&&r[t]||t;return"on"+iK(e)+iK(i)+(!function(e=!1,t){return e&&!iH.includes(t)}(n,i)?"":"Capture")}(r,i,c);n&&u&&(h+="Passive"),e[h]=e[h]||[],e[h].push(o)},ox=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function oS(e,t,n,r,i,o){if(!e.has(n)||!oc.has(r))return;let s=n+"Start",a=n+"End";i[r]=e=>{let r;return e.first&&s in t&&t[s](e),n in t&&(r=t[n](e)),e.last&&a in t&&t[a](e),r},o[r]=o[r]||{}}n(37);let ow=/Mac|iPod|iPhone|iPad/.test("undefined"==typeof window?"node":window.navigator.platform);function oC(e){let{deltaY:t,deltaX:n}=e,r=0;if(e.ctrlKey||e.altKey||e.metaKey){let n=Math.sign(e.deltaY),i=Math.abs(e.deltaY),o=t;i>10&&(o=10*n),r=o/100}else e.shiftKey&&!ow&&(n=t,t=0);return{x:-n,y:-t,z:-r}}let o_=([{key:"wheel",engine:od,resolver:i7},{key:"pinch",engine:oa,resolver:ol}].forEach(function(e){oc.set(e.key,e.engine),ou.set(e.key,e.resolver)}),function(e,t){let{handlers:n,nativeHandlers:r,config:i}=function(e,t){let[n,r,i]=function(e){let t={},n={},r=new Set;for(let i in e)ox.test(i)?(r.add(RegExp.lastMatch),n[i]=e[i]):t[i]=e[i];return[n,t,r]}(e),o={};return oS(i,n,"onDrag","drag",o,t),oS(i,n,"onWheel","wheel",o,t),oS(i,n,"onScroll","scroll",o,t),oS(i,n,"onPinch","pinch",o,t),oS(i,n,"onMove","move",o,t),oS(i,n,"onHover","hover",o,t),{handlers:o,config:t,nativeHandlers:r}}(e,t||{});return function(e,t={},n,r){let i=em().useMemo(()=>new oy(e),[]);if(i.applyHandlers(e,r),i.applyConfig(t,n),em().useEffect(i.effect.bind(i)),em().useEffect(()=>i.clean.bind(i),[]),void 0===t.target)return i.bind.bind(i)}(n,i,void 0,r)}),ok=e=>void 0===p?(p=e,!1):e-p>120&&e-p<160?(p=e,!0):(p=e,!1);function oP(e,t,n){let r=e.getShape(t),i=e.getShapeHandles(r);return{shape:r,handle:i.find(e=>e.id===n)}}var oI=n(1594);class oE{constructor(e=0,t=0,n=0,r=0){this.x=e,this.y=t,this.w=n,this.h=r}x=0;y=0;w=0;h=0;get point(){return new rG(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new rG(this.midX,this.midY)}set center(e){this.minX=e.x-this.width/2,this.minY=e.y-this.height/2}get corners(){return[new rG(this.minX,this.minY),new rG(this.maxX,this.minY),new rG(this.maxX,this.maxY),new rG(this.minX,this.maxY)]}get snapPoints(){return[new rG(this.minX,this.minY),new rG(this.maxX,this.minY),new rG(this.maxX,this.maxY),new rG(this.minX,this.maxY),this.center]}get sides(){let{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new rG(this.w,this.h)}toFixed(){return this.x=r3(this.x),this.y=r3(this.y),this.w=r3(this.w),this.h=r3(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,t=0,n=0,r=0){return this.x=e,this.y=t,this.w=n,this.h=r,this}expand(e){let t=Math.min(this.minX,e.minX),n=Math.min(this.minY,e.minY),r=Math.max(this.maxX,e.maxX),i=Math.max(this.maxY,e.maxY);return this.x=t,this.y=n,this.w=r-t,this.h=i-n,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=2*e,this.h+=2*e,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){let{x:e,y:t,w:n,h:r}=this;return new oE(e,t,n,r)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){let t=Math.round(this.minX/e)*e,n=Math.round(this.minY/e)*e,r=Math.round(this.maxX/e)*e,i=Math.round(this.maxY/e)*e;this.minX=t,this.minY=n,this.width=Math.max(1,r-t),this.height=Math.max(1,i-n)}collides(e){return oE.Collides(this,e)}contains(e){return oE.Contains(this,e)}includes(e){return oE.Includes(this,e)}containsPoint(e,t=0){return oE.ContainsPoint(this,e,t)}getHandlePoint(e){switch(e){case"top_left":return new rG(this.minX,this.minY);case"top_right":return new rG(this.maxX,this.minY);case"bottom_left":return new rG(this.minX,this.maxY);case"bottom_right":return new rG(this.maxX,this.maxY);case"top":return new rG(this.midX,this.minY);case"right":return new rG(this.maxX,this.midY);case"bottom":return new rG(this.midX,this.maxY);case"left":return new rG(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(e,t,n){let{minX:r,minY:i,maxX:o,maxY:s}=this,{minX:a,minY:l,maxX:d,maxY:c}=this;switch(e){case"left":case"top_left":case"bottom_left":a+=t;break;case"right":case"top_right":case"bottom_right":d+=t}switch(e){case"top":case"top_left":case"top_right":l+=n;break;case"bottom":case"bottom_left":case"bottom_right":c+=n}let u=(c-l)/(s-i);if((d-a)/(o-r)<0){let e=d;d=a,a=e}if(u<0){let e=c;c=l,l=e}this.minX=a,this.minY=l,this.width=Math.abs(d-a),this.height=Math.abs(c-l)}union(e){let t=Math.min(this.minX,e.x),n=Math.min(this.minY,e.y),r=Math.max(this.maxX,e.w+e.x),i=Math.max(this.maxY,e.h+e.y);return this.x=t,this.y=n,this.width=r-t,this.height=i-n,this}static From(e){return new oE(e.x,e.y,e.w,e.h)}static FromCenter(e,t){return new oE(e.x-t.x/2,e.y-t.y/2,t.x,t.y)}static FromPoints(e){let t;if(0===e.length)return new oE;let n=1/0,r=1/0,i=-1/0,o=-1/0;for(let s=0,a=e.length;s<a;s++)n=Math.min((t=e[s]).x,n),r=Math.min(t.y,r),i=Math.max(t.x,i),o=Math.max(t.y,o);return new oE(n,r,i-n,o-r)}static Expand(e,t){let n=Math.min(t.minX,e.minX),r=Math.min(t.minY,e.minY);return new oE(n,r,Math.max(t.maxX,e.maxX)-n,Math.max(t.maxY,e.maxY)-r)}static ExpandBy(e,t){return new oE(e.minX-t,e.minY-t,e.width+2*t,e.height+2*t)}static Collides=(e,t)=>!(e.maxX<t.minX||e.minX>t.maxX||e.maxY<t.minY||e.minY>t.maxY);static Contains=(e,t)=>e.minX<t.minX&&e.minY<t.minY&&e.maxY>t.maxY&&e.maxX>t.maxX;static Includes=(e,t)=>oE.Collides(e,t)||oE.Contains(e,t);static ContainsPoint=(e,t,n=0)=>!(t.x<e.minX-n||t.y<e.minY-n||t.x>e.maxX+n||t.y>e.maxY+n);static Common=e=>{let t=1/0,n=1/0,r=-1/0,i=-1/0;for(let o=0;o<e.length;o++){let s=e[o];t=Math.min(t,s.minX),n=Math.min(n,s.minY),r=Math.max(r,s.maxX),i=Math.max(i,s.maxY)}return new oE(t,n,r-t,i-n)};static Sides=(e,t=0)=>{let{corners:n}=e;return[[n[0],n[1]],[n[1],n[2]],[n[2],n[3]],[n[3],n[0]]]};static Resize(e,t,n,r,i=!1){let{minX:o,minY:s,maxX:a,maxY:l}=e,{minX:d,minY:c,maxX:u,maxY:h}=e;switch(t){case"left":case"top_left":case"bottom_left":d+=n;break;case"right":case"top_right":case"bottom_right":u+=n}switch(t){case"top":case"top_left":case"top_right":c+=r;break;case"bottom":case"bottom_left":case"bottom_right":h+=r}let p=(u-d)/(a-o),g=(h-c)/(l-s);if(i){let e=(a-o)/(l-s),n=Math.abs(u-d),r=Math.abs(h-c),i=n*(g<0?1:-1)*(1/e),f=r*(p<0?1:-1)*e,m=e<n/r;switch(t){case"top_left":m?c=h+i:d=u+f;break;case"top_right":m?c=h+i:u=d-f;break;case"bottom_right":m?h=c-i:u=d-f;break;case"bottom_left":m?h=c-i:d=u+f;break;case"bottom":case"top":{let t=(d+u)/2,n=r*e;d=t-n/2,u=t+n/2;break}case"left":case"right":{let t=(c+h)/2,r=n/e;c=t-r/2,h=t+r/2}}}if(p<0){let e=u;u=d,d=e}if(g<0){let e=h;h=c,c=e}let f=new oE(d,c,Math.abs(u-d),Math.abs(h-c));return{box:f,scaleX:+(f.width/e.width*(p>0?1:-1)).toFixed(5),scaleY:+(f.height/e.height*(g>0?1:-1)).toFixed(5)}}equals(e){return oE.Equals(this,e)}static Equals(e,t){return t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new oE(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}}class oj{constructor(e,t,n,r,i,o){this.a=e,this.b=t,this.c=n,this.d=r,this.e=i,this.f=o}a=1;b=0;c=0;d=1;e=0;f=0;equals(e){return this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){let{a:t,b:n,c:r,d:i,e:o,f:s}=this;return this.a=t*e.a+r*e.b,this.c=t*e.c+r*e.d,this.e=t*e.e+r*e.f+o,this.b=n*e.a+i*e.b,this.d=n*e.c+i*e.d,this.f=n*e.e+i*e.f+s,this}rotate(e,t,n){return 0===e?this:void 0===t?this.multiply(oj.Rotate(e)):this.translate(t,n).multiply(oj.Rotate(e)).translate(-t,-n)}translate(e,t){return this.multiply(oj.Translate(e,t))}scale(e,t){return this.multiply(oj.Scale(e,t))}invert(){let{a:e,b:t,c:n,d:r,e:i,f:o}=this,s=e*r-t*n;return this.a=r/s,this.b=-(t/s),this.c=-(n/s),this.d=e/s,this.e=-((r*i-n*o)/s),this.f=(t*i-e*o)/s,this}applyToPoint(e){return oj.applyToPoint(this,e)}applyToPoints(e){return oj.applyToPoints(this,e)}rotation(){return oj.Rotation(this)}point(){return oj.Point(this)}decomposed(){return oj.Decompose(this)}toCssString(){return oj.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return oj.Decompose(this)}clone(){return new oj(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new oj(1,0,0,1,0,0)}static Translate(e,t){return new oj(1,0,0,1,e,t)}static Rotate(e,t,n){if(0===e)return oj.Identity();let r=Math.cos(e),i=Math.sin(e),o=new oj(r,i,-i,r,0,0);return void 0===t?o:oj.Compose(oj.Translate(t,n),o,oj.Translate(-t,-n))}static Scale=(e,t,n,r)=>{let i=new oj(e,0,0,t,0,0);return void 0===n?i:oj.Compose(oj.Translate(n,r),i,oj.Translate(-n,-r))};static Multiply(e,t){return{a:e.a*t.a+e.c*t.b,c:e.a*t.c+e.c*t.d,e:e.a*t.e+e.c*t.f+e.e,b:e.b*t.a+e.d*t.b,d:e.b*t.c+e.d*t.d,f:e.b*t.e+e.d*t.f+e.f}}static Inverse(e){let t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:-(e.b/t),c:-(e.c/t),d:e.a/t,e:-((e.d*e.e-e.c*e.f)/t),f:(e.b*e.e-e.a*e.f)/t}}static Absolute(e){let t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:-(e.b/t),c:-(e.c/t),d:e.a/t,e:(e.d*e.e-e.c*e.f)/t,f:-((e.b*e.e-e.a*e.f)/t)}}static Compose(...e){let t=oj.Identity();for(let n=0,r=e.length;n<r;n++)t.multiply(e[n]);return t}static Point(e){return new rG(e.e,e.f)}static Rotation(e){let t;if(0!==e.a||0!==e.c){let n=Math.hypot(e.a,e.c);t=Math.acos(e.a/n)*(e.c>0?-1:1)}else if(0!==e.b||0!==e.d){let n=Math.hypot(e.b,e.d);t=r0+Math.acos(e.b/n)*(e.d>0?-1:1)}else t=0;return(r1+t)%r1}static Decompose(e){let t,n,r;if(0!==e.a||0!==e.c){let i=Math.hypot(e.a,e.c);t=i,n=(e.a*e.d-e.b*e.c)/i,r=Math.acos(e.a/i)*(e.c>0?-1:1)}else if(0!==e.b||0!==e.d){let i=Math.hypot(e.b,e.d);t=(e.a*e.d-e.b*e.c)/i,n=i,r=r0+Math.acos(e.b/i)*(e.d>0?-1:1)}else t=0,n=0,r=0;return{x:e.e,y:e.f,scaleX:t,scaleY:n,rotation:(r1+r)%r1}}static Smooth(e,t=1e10){return e.a=Math.round(e.a*t)/t,e.b=Math.round(e.b*t)/t,e.c=Math.round(e.c*t)/t,e.d=Math.round(e.d*t)/t,e.e=Math.round(e.e*t)/t,e.f=Math.round(e.f*t)/t,e}static toCssString(e){return`matrix(${is(e.a)}, ${is(e.b)}, ${is(e.c)}, ${is(e.d)}, ${is(e.e)}, ${is(e.f)})`}static applyToPoint(e,t){return new rG(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z)}static applyToXY(e,t,n){return[e.a*t+e.c*n+e.e,e.b*t+e.d*n+e.f]}static applyToPoints(e,t){return t.map(t=>new rG(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z))}static applyToBounds(e,t){return new oE(e.e+t.minX,e.f+t.minY,t.width,t.height)}static From(e){return new oj(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof oj?e:oj.From(e)}}class oM{isFilled=!1;isClosed=!0;isLabel=!1;isSnappable=!0;debugColor;ignore;constructor(e){this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.isSnappable=e.isSnappable??!1,this.isLabel=e.isLabel??!1,this.debugColor=e.debugColor,this.ignore=e.ignore}hitTestPoint(e,t=0,n=!1){return this.distanceToPoint(e,n)<=t}distanceToPoint(e,t=!1){let n=e.dist(this.nearestPoint(e));return this.isClosed&&(this.isFilled||t)&&io(e,this.vertices)?-n:n}distanceToLineSegment(e,t){let n=this.nearestPointOnLineSegment(e,t),r=rG.DistanceToLineSegment(e,t,n);return this.isClosed&&this.isFilled&&io(n,this.vertices)?-r:r}hitTestLineSegment(e,t,n=0){return this.distanceToLineSegment(e,t)<=n}nearestPointOnLineSegment(e,t){let n,r=1/0;for(let i=0;i<this.vertices.length;i++){let o=this.vertices[i],s=rG.DistanceToLineSegment(e,t,o);s<r&&(r=s,n=o)}if(!n)throw Error("nearest point not found");return n}isPointInBounds(e,t=0){let{bounds:n}=this;return!(e.x<n.minX-t||e.y<n.minY-t||e.x>n.maxX+t||e.y>n.maxY+t)}_vertices;get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return oE.FromPoints(this.vertices)}_bounds;get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}_snapPoints;get snapPoints(){return this._snapPoints||(this._snapPoints=this.bounds.snapPoints),this._snapPoints}get center(){return this.bounds.center}_area;get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;let{vertices:e}=this,t=0;for(let n=0,r=e.length;n<r;n++){let i=e[n],o=e[(n+1)%r];t+=i.x*o.y-o.x*i.y}return t/2}toSimpleSvgPath(){let e="",{vertices:t}=this,n=t.length;if(0===n)return e;e+=`M${t[0].x},${t[0].y}`;for(let r=1;r<n;r++)e+=`L${t[r].x},${t[r].y}`;return this.isClosed&&(e+="Z"),e}}class oT extends oM{children=[];ignoredChildren=[];constructor(e){for(let t of(super({...e,isClosed:!0,isFilled:!1}),e.children))t.ignore?this.ignoredChildren.push(t):this.children.push(t);if(0===this.children.length)throw Error("Group2d must have at least one child")}getVertices(){return this.children.filter(e=>!e.isLabel).flatMap(e=>e.vertices)}nearestPoint(e){let t,n=1/0,{children:r}=this;if(0===r.length)throw Error("no children");for(let i of r){let r=i.nearestPoint(e),o=r.dist(e);o<n&&(n=o,t=r)}if(!t)throw Error("nearest point not found");return t}distanceToPoint(e,t=!1){return Math.min(...this.children.map((n,r)=>n.distanceToPoint(e,t||r>0)))}hitTestPoint(e,t,n){return!!this.children.filter(e=>!e.isLabel).find(r=>r.hitTestPoint(e,t,n))}hitTestLineSegment(e,t,n){return!!this.children.filter(e=>!e.isLabel).find(r=>r.hitTestLineSegment(e,t,n))}getArea(){return this.children[0].area}toSimpleSvgPath(){let e="";for(let t of this.children)e+=t.toSimpleSvgPath();let t=oE.FromPoints(this.vertices).corners;for(let n=0,r=t.length;n<r;n++){let i=t[n],o=t[(n-1+r)%r],s=i.dist(o),a=t[(n+1)%r],l=i.dist(a),d=i.clone().lrp(o,4/s),c=i.clone().lrp(a,4/l);e+=`M${d.x},${d.y} L${i.x},${i.y} L${c.x},${c.y} `}return e}}let oA=eS(function({showStroke:e=!0,showVertices:t=!0,showClosestPointOnOutline:n=!0}){let r=rR();!function(e=!0){let[t,n]=(0,eg.useState)(0),r=rR();(0,eg.useEffect)(()=>{if(!e)return;let t=()=>n(e=>e+1);return r.on("tick",t),()=>{r.off("tick",t)}},[r,e])}(n);let i=r.getZoomLevel(),o=r.getRenderingShapes(),{inputs:{currentPagePoint:s}}=r;return(0,j.jsx)("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:o.map(o=>{let a=r.getShape(o.id);if("group"===a.type)return null;let l=r.getShapeGeometry(a),d=r.getShapePageTransform(a),c=r.getPointInShapeSpace(a,s),u=l.nearestPoint(c),h=l.distanceToPoint(c,!0),p=Math.abs(h)*i,{vertices:g}=l;return(0,j.jsxs)("g",{transform:d.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[e&&(0,j.jsx)(oO,{geometry:l}),t&&g.map((e,t)=>(0,j.jsx)("circle",{cx:e.x,cy:e.y,r:"2",fill:`hsl(${eF(t,[0,g.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:"1"},`v${t}`)),n&&p<150&&(0,j.jsx)("line",{x1:u.x,y1:u.y,x2:c.x,y2:c.y,opacity:1-p/150,stroke:h<0?"goldenrod":"dodgerblue",strokeWidth:"2"})]},o.id+"_outline")})})});function oO({geometry:e}){return e instanceof oT?(0,j.jsx)(j.Fragment,{children:[...e.children,...e.ignoredChildren].map((e,t)=>(0,j.jsx)(oO,{geometry:e},t))}):(0,j.jsx)("path",{stroke:e.debugColor??"red",strokeWidth:"2",fill:"none",opacity:"1",d:e.toSimpleSvgPath()})}var oR=n(9402);function oL(e){let t=rR(),n=(0,eg.useMemo)(()=>t.store.query.records("instance_presence",()=>({userId:{eq:e}})),[t,e]);return e_(`latestPresence:${e}`,()=>n.get().slice().sort((e,t)=>t.lastActivityTimestamp-e.lastActivityTimestamp)[0],[])??null}let oD=eS(function(){let e=function(){let e=rR(),t=(0,eg.useMemo)(()=>e.store.query.records("instance_presence",()=>({userId:{neq:e.user.getId()}})),[e]);return e_(ew("userIds",()=>oR(t.get().map(e=>e.userId)).sort(),{isEqual:(e,t)=>e.join(",")===t.join?.(",")},[t]))}();return(0,j.jsx)(j.Fragment,{children:e.map(e=>(0,j.jsx)(oz,{collaboratorId:e},e))})}),oz=eS(function({collaboratorId:e}){let t=rR(),n=oL(e),r=function(e){let t=(0,eg.useRef)(e?.lastActivityTimestamp??-1),[n,r]=(0,eg.useState)(()=>o$(Date.now()-t.current));return(0,eg.useEffect)(()=>{let e=setInterval(()=>{r(o$(Date.now()-t.current))},1200);return()=>clearInterval(e)},[]),e&&(t.current=e.lastActivityTimestamp),n}(n);if(!(n&&n.currentPageId===t.getCurrentPageId()))return null;switch(r){case"inactive":{let{followingUserId:e,highlightedUserIds:r}=t.getInstanceState();if(!(e===n.userId||r.includes(n.userId)))return null;break}case"idle":{let{highlightedUserIds:e}=t.getInstanceState();if(n.followingUserId===t.user.getId()&&!(n.chatMessage||e.includes(n.userId)))return null}}return(0,j.jsx)(oN,{latestPresence:n})}),oN=eS(function({latestPresence:e}){let t=rR(),{CollaboratorBrush:n,CollaboratorScribble:r,CollaboratorCursor:i,CollaboratorHint:o,CollaboratorShapeIndicator:s}=iL(),a=t.getZoomLevel(),l=t.getViewportPageBounds(),{userId:d,chatMessage:c,brush:u,scribbles:h,selectedShapeIds:p,userName:g,cursor:f,color:m}=e,y=!(f.x<l.minX-12/a||f.y<l.minY-16/a||f.x>l.maxX-12/a||f.y>l.maxY-16/a);return(0,j.jsxs)(j.Fragment,{children:[u&&n?(0,j.jsx)(n,{className:"tl-collaborator__brush",brush:u,color:m,opacity:.1},d+"_brush"):null,y&&i?(0,j.jsx)(i,{className:"tl-collaborator__cursor",point:f,color:m,zoom:a,name:"New User"!==g?g:null,chatMessage:c},d+"_cursor"):o?(0,j.jsx)(o,{className:"tl-collaborator__cursor-hint",point:f,color:m,zoom:a,viewport:l},d+"_cursor_hint"):null,r&&h.length?(0,j.jsx)(j.Fragment,{children:h.map(e=>(0,j.jsx)(r,{className:"tl-collaborator__scribble",scribble:e,color:m,zoom:a,opacity:"laser"===e.color?.5:.1},d+"_scribble_"+e.id))}):null,s&&p.map(e=>(0,j.jsx)(s,{className:"tl-collaborator__shape-indicator",id:e,color:m,opacity:.5},d+"_"+e))]})});function o$(e){return e>6e4?"inactive":e>3e3?"idle":"active"}let oF=eS(function({id:e,shape:t,util:n,index:r,backgroundIndex:i,opacity:o,isCulled:s}){let a=rR(),{ShapeErrorFallback:l}=iL(),d=eg.useRef(null),c=eg.useRef(null),u=eg.useCallback((e,t)=>{d.current?.style.setProperty(e,t),c.current?.style.setProperty(e,t)},[]);eC("set shape container transform position",()=>{if(!a.getShape(e))return;let t=a.getShapePageTransform(e);u("transform",oj.toCssString(t))},[a,u]),eC("set shape container clip path",()=>{if(!a.getShape(e))return null;u("clip-path",a.getShapeClipPath(e)??"none")},[a,u]),eC("set shape height and width",()=>{let t=a.getShape(e);if(!t)return null;let n=a.getShapeGeometry(t).bounds,r=function(e){let t=e.toString().split(".")[1];if(!t)return 1;let n=Math.pow(10,t.length);return n/function e(t,n){return 0===n?t:e(n,t%n)}(parseInt(t,10),n)}(Math.floor(100*a.getInstanceState().devicePixelRatio)/100),i=n.w%r,o=0===i?n.w:n.w+(r-i),s=n.h%r,l=0===s?n.h:n.h+(r-s);u("width",Math.max(o,r)+"px"),u("height",Math.max(l,r)+"px")},[a]),eg.useLayoutEffect(()=>{u("opacity",o+""),d.current?.style.setProperty("z-index",r+""),c.current?.style.setProperty("z-index",i+"")},[o,r,i,u]);let h=eg.useCallback(e=>{a.annotateError(e,{origin:"react.shape",willCrashApp:!1})},[a]);return t?(0,j.jsxs)(j.Fragment,{children:[n.backgroundComponent&&(0,j.jsx)("div",{ref:c,className:"tl-shape tl-shape-background","data-shape-type":t.type,draggable:!1,children:!s&&(0,j.jsx)(rV,{fallback:l,onError:h,children:(0,j.jsx)(oV,{shape:t,util:n})})}),(0,j.jsx)("div",{ref:d,className:"tl-shape","data-shape-type":t.type,draggable:!1,children:s?(0,j.jsx)(oU,{shape:t}):(0,j.jsx)(rV,{fallback:l,onError:h,children:(0,j.jsx)(oB,{shape:t,util:n})})})]}):null}),oB=eg.memo(function({shape:e,util:t}){return ey("InnerShape:"+e.type,()=>t.component(e))},(e,t)=>e.shape.props===t.shape.props&&e.shape.meta===t.shape.meta&&e.util===t.util),oV=eg.memo(function({shape:e,util:t}){return ey("InnerShape:"+e.type,()=>t.backgroundComponent?.(e))},(e,t)=>e.shape.props===t.shape.props&&e.shape.meta===t.shape.meta),oU=eg.memo(function({shape:e}){let t=rR().getShapeGeometry(e).bounds;return(0,j.jsx)("div",{className:"tl-shape__culled",style:{transform:`translate(${is(t.minX)}px, ${is(t.minY)}px)`,width:Math.max(1,is(t.width)),height:Math.max(1,is(t.height))}})},()=>!0);function oK({className:e}){let t=rR(),{Background:n,SvgDefs:r}=iL(),i=eg.useRef(null),o=eg.useRef(null),s=eg.useRef(null);(function(){let e=rR();(0,eg.useLayoutEffect)(()=>{let t=oI(()=>{e.updateViewportScreenBounds()},200,{trailing:!0});e.updateViewportScreenBounds();let n=setInterval(t,1e3);return window.addEventListener("resize",t),window.addEventListener("scroll",t),()=>{clearInterval(n),window.removeEventListener("resize",t),window.removeEventListener("scroll",t)}},[e])})(),function(){let e=rR(),t=rz(),n=e_("isFocused",()=>e.getInstanceState().isFocused,[e]);(0,eg.useEffect)(()=>{let t=null,n=()=>{null!=t&&t();let r=matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),i=e=>{"change"===e.type&&n()};r.addEventListener?r.addEventListener("change",n):r.addListener&&r.addListener(i),t=()=>{r.removeEventListener?r.removeEventListener("change",n):r.removeListener&&r.removeListener(i)},e.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return n(),()=>{t?.()}},[e]),(0,eg.useEffect)(()=>{if(!n)return;let r=n=>{if(n.altKey&&(e.isIn("zoom")||!e.getPath().endsWith(".idle"))&&!r$()&&rE(n),n.isKilled)return;switch(n.isKilled=!0,n.key){case"=":case"-":case"0":if(n.metaKey||n.ctrlKey){rE(n);return}break;case"Tab":default:if(r$()||e.getIsMenuOpen())return;break;case",":return;case"Escape":if((e.getEditingShape()||e.getSelectedShapeIds().length>0)&&n.preventDefault(),e.getOpenMenus().length>0)return;e.inputs.keys.has("Escape")||(e.inputs.keys.add("Escape"),e.cancel(),t.focus());return}let r={type:"keyboard",name:n.repeat?"key_repeat":"key_down",key:n.key,code:n.code,shiftKey:n.shiftKey,altKey:n.altKey,ctrlKey:n.metaKey||n.ctrlKey};e.dispatch(r)},i=t=>{if(t.isKilled||(t.isKilled=!0,r$()||e.getIsMenuOpen()||","===t.key))return;let n={type:"keyboard",name:"key_up",key:t.key,code:t.code,shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey};e.dispatch(n)};function o(n){if(t.contains(n.target)){let t=n.touches[0].pageX,r=n.touches[0].radiusX||0;(t-r<10||t+r>e.getViewportScreenBounds().width-10)&&(n.target?.tagName==="BUTTON"&&n.target?.click(),rE(n))}}let s=e=>{t.contains(e.target)&&(e.ctrlKey||e.metaKey)&&rE(e)};return t.addEventListener("touchstart",o,{passive:!1}),t.addEventListener("wheel",s,{passive:!1}),document.addEventListener("gesturestart",rE),document.addEventListener("gesturechange",rE),document.addEventListener("gestureend",rE),t.addEventListener("keydown",r),t.addEventListener("keyup",i),()=>{t.removeEventListener("touchstart",o),t.removeEventListener("wheel",s),document.removeEventListener("gesturestart",rE),document.removeEventListener("gesturechange",rE),document.removeEventListener("gestureend",rE),t.removeEventListener("keydown",r),t.removeEventListener("keyup",i)}},[e,t,n])}(),function(){let e=rR();(0,eg.useEffect)(()=>{if(e.environment.isFirefox&&!e.environment.isAndroid&&!e.environment.isIos){e.updateInstanceState({isCoarsePointer:!1});return}if(window.matchMedia){let t=window.matchMedia("(pointer: coarse)"),n=()=>{e.updateInstanceState({isCoarsePointer:!!t.matches})};if(n(),t)return t.addEventListener("change",n),()=>t.removeEventListener("change",n)}},[e])}(),function(e){let t=rR();o_(eg.useMemo(()=>{let n="not sure",r=1,i=1,o=1,s=0,a=new rG,l=new rG,d=e=>{if(e&&(n="zooming"),"zooming"===n)return;let t=Math.abs(s-r),i=rG.Dist(a,l);switch(n){case"not sure":t>24?n="zooming":i>16&&(n="panning");break;case"panning":t>64&&(n="zooming")}};return{onWheel:({event:e})=>{if(!t.getInstanceState().isFocused||(n="not sure",ok(Date.now())))return;let r=t.getEditingShapeId();if(r){let e=t.getShape(r);if(e&&t.getShapeUtil(e).canScroll(e)){let e=t.getShapePageBounds(r);if(e?.containsPoint(t.inputs.currentPagePoint))return}}rE(e);let i=oC(e);if(0===i.x&&0===i.y)return;let o={type:"wheel",name:"wheel",delta:i,point:new rG(e.clientX,e.clientY),shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey};t.dispatch(o)},onPinchStart:o=>{let s=e.current;n="not sure";let{event:d,origin:c,da:u}=o;!(d instanceof WheelEvent)&&(d.target===s||s?.contains(d.target))&&(l.x=c[0],l.y=c[1],a.x=c[0],a.y=c[1],r=u[0],i=t.getZoomLevel(),t.dispatch({type:"pinch",name:"pinch_start",point:{x:c[0],y:c[1],z:t.getZoomLevel()},delta:{x:0,y:0},shiftKey:d.shiftKey,altKey:d.altKey,ctrlKey:d.metaKey||d.ctrlKey}))},onPinchEnd:r=>{let i=e.current,{event:o,origin:s,offset:a}=r;if(o instanceof WheelEvent||!(o.target===i||i?.contains(o.target)))return;let l=a[0];n="not sure",requestAnimationFrame(()=>{t.dispatch({type:"pinch",name:"pinch_end",point:{x:s[0],y:s[1],z:l},delta:{x:s[0],y:s[1]},shiftKey:o.shiftKey,altKey:o.altKey,ctrlKey:o.metaKey||o.ctrlKey})})},onPinch:r=>{let a=e.current,{event:c,origin:u,offset:h,da:p}=r;if(c instanceof WheelEvent||!(c.target===a||a?.contains(c.target)))return;let g="gesturechange"===r.type||"gestureend"===r.type;s=p[0];let f=u[0]-l.x,m=u[1]-l.y;switch(l.x=u[0],l.y=u[1],d(g),n){case"zooming":o=h[0],t.dispatch({type:"pinch",name:"pinch",point:{x:u[0],y:u[1],z:o},delta:{x:f,y:m},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey});break;case"panning":t.dispatch({type:"pinch",name:"pinch",point:{x:u[0],y:u[1],z:i},delta:{x:f,y:m},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey})}}}},[t,e]),{target:e,eventOptions:{passive:!1},pinch:{from:()=>[t.getZoomLevel(),0],scaleBounds:()=>({from:t.getZoomLevel(),max:8,min:.05})}})}(i),function(e){let t=rR();(0,eg.useEffect)(()=>{let n=e.current;if(!n)return;let r=e=>{if(e instanceof PointerEvent&&"pen"===e.pointerType){e.isKilled=!0;let{target:n}=e;iD.includes(n.tagName?.toLocaleLowerCase())||t.isIn("select.editing_shape")||rE(e)}};return n.addEventListener("touchstart",r),n.addEventListener("touchend",r),()=>{n.removeEventListener("touchstart",r),n.removeEventListener("touchend",r)}},[t,e])}(i),eC("position layers",()=>{let e=o.current;if(!e)return;let n=s.current;if(!n)return;let{x:r,y:i,z:a}=t.getCamera(),l=a>=1?eF(a,[1,8],[.125,.5],!0):eF(a,[.1,1],[-2,.125],!0),d=`scale(${is(a)}) translate(${is(r+l)}px,${is(i+l)}px)`;e.style.setProperty("transform",d),n.style.setProperty("transform",d)},[t]);let a=function(){let e=rR();return(0,eg.useMemo)(function(){let t,n;return{onPointerDown:function(t){if(!t.isKilled){if(2===t.button){e.dispatch({type:"pointer",target:"canvas",name:"right_click",...rA(t)});return}(0===t.button||1===t.button||5===t.button)&&(rj(t.currentTarget,t),e.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...rA(t)}),e.getOpenMenus().length>0&&(e.updateInstanceState({openMenus:[]}),document.body.click(),e.getContainer().focus()))}},onPointerMove:function(r){r.isKilled||r.clientX===t&&r.clientY===n||(t=r.clientX,n=r.clientY,e.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...rA(r)}))},onPointerUp:function(r){r.isKilled||0!==r.button&&1!==r.button&&2!==r.button&&5!==r.button||(t=r.clientX,n=r.clientY,rM(r.currentTarget,r),e.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...rA(r)}))},onPointerEnter:function(t){if(t.isKilled||e.getInstanceState().isPenMode&&"pen"!==t.pointerType)return;let n="mouse"===t.pointerType||"pen"===t.pointerType;e.updateInstanceState({isHoveringCanvas:!!n||null})},onPointerLeave:function(t){if(t.isKilled||e.getInstanceState().isPenMode&&"pen"!==t.pointerType)return;let n="mouse"===t.pointerType||"pen"===t.pointerType;e.updateInstanceState({isHoveringCanvas:!n&&null})},onDragOver:function(e){rE(e)},onDrop:async function(t){if(rE(t),!t.dataTransfer?.files?.length)return;let n=Array.from(t.dataTransfer.files);await e.putExternalContent({type:"files",files:n,point:e.screenToPage({x:t.clientX,y:t.clientY}),ignoreParent:!1})},onTouchStart:function(e){e.isKilled=!0,document.body.click(),rE(e)},onTouchEnd:function(e){e.isKilled=!0,"A"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&rE(e)},onClick:function(e){rT(e)}}},[e])}(),l=e_("shapeSvgDefs",()=>{let e=new Map;for(let n of eH(t.shapeUtils)){if(!n)return;for(let{key:t,component:r}of n.getCanvasSvgDefs())e.has(t)||e.set(t,(0,j.jsx)(r,{},t))}return[...e.values()]},[t]),d=e_("debug_shapes",()=>r_.hideShapes.get(),[r_]),c=e_("debug_svg",()=>r_.debugSvg.get(),[r_]),u=e_("debug_geometry",()=>r_.debugGeometry.get(),[r_]);return(0,j.jsxs)("div",{ref:i,draggable:!1,className:rm("tl-canvas",e),"data-testid":"canvas",...a,children:[n&&(0,j.jsx)(n,{}),(0,j.jsx)(oH,{}),(0,j.jsx)(o9,{}),(0,j.jsx)("svg",{className:"tl-svg-context",children:(0,j.jsxs)("defs",{children:[l,o5&&(0,j.jsx)(o5,{}),(0,j.jsx)(o3,{}),(0,j.jsx)(o4,{}),(0,j.jsx)(o6,{}),r&&(0,j.jsx)(r,{})]})}),(0,j.jsxs)("div",{ref:o,className:"tl-html-layer tl-shapes",draggable:!1,children:[(0,j.jsx)(st,{}),(0,j.jsx)(se,{}),d?null:c?(0,j.jsx)(oJ,{}):(0,j.jsx)(oQ,{})]}),(0,j.jsxs)("div",{className:"tl-fixed-layer tl-overlays",children:[(0,j.jsxs)("div",{ref:s,className:"tl-html-layer",children:[u?(0,j.jsx)(oA,{}):null,(0,j.jsx)(oq,{}),(0,j.jsx)(oW,{}),(0,j.jsx)(oY,{}),(0,j.jsx)(oX,{}),(0,j.jsx)(o0,{}),(0,j.jsx)(o1,{}),(0,j.jsx)(o2,{}),(0,j.jsx)(oG,{}),(0,j.jsx)(o7,{}),(0,j.jsx)(oD,{})]}),(0,j.jsx)(sn,{})]})]})}function oH(){let e=rR(),t=e_("gridSize",()=>e.getDocumentSettings().gridSize,[e]),{x:n,y:r,z:i}=e_("camera",()=>e.getCamera(),[e]),o=e_("isGridMode",()=>e.getInstanceState().isGridMode,[e]),{Grid:s}=iL();return s&&o?(0,j.jsx)(s,{x:n,y:r,z:i,size:t}):null}function oY(){let e=rR(),t=e_("scribbles",()=>e.getInstanceState().scribbles,[e]),n=e_("zoomLevel",()=>e.getZoomLevel(),[e]),{Scribble:r}=iL();return r&&t.length?(0,j.jsx)(j.Fragment,{children:t.map(e=>(0,j.jsx)(r,{className:"tl-user-scribble",scribble:e,zoom:n},e.id))}):null}function oW(){let e=rR(),t=e_("brush",()=>e.getInstanceState().brush,[e]),{Brush:n}=iL();return n&&t?(0,j.jsx)(n,{className:"tl-user-brush",brush:t}):null}function oX(){let e=rR(),t=e_("zoomBrush",()=>e.getInstanceState().zoomBrush,[e]),{ZoomBrush:n}=iL();return n&&t?(0,j.jsx)(n,{className:"tl-user-brush tl-zoom-brush",brush:t}):null}function oG(){let e=rR(),t=e_("snapLines",()=>e.snaps.getLines(),[e]),n=e_("zoomLevel",()=>e.getZoomLevel(),[e]),{SnapLine:r}=iL();return r&&t.length>0?(0,j.jsx)(j.Fragment,{children:t.map(e=>(0,j.jsx)(r,{className:"tl-user-snapline",line:e,zoom:n},e.id))}):null}function oq(){let e=rR(),{Handles:t}=iL(),n=e_("zoomLevel",()=>e.getZoomLevel(),[e]),r=e_("coarse pointer",()=>e.getInstanceState().isCoarsePointer,[e]),i=e_("isChangingStyle",()=>e.getInstanceState().isReadonly,[e]),o=e_("isChangingStyle",()=>e.getInstanceState().isChangingStyle,[e]),s=e_("onlySelectedShape",()=>e.getOnlySelectedShape(),[e]),a=e_("transform",()=>s?e.getShapePageTransform(s):null,[e,s]),l=e_("handles",()=>{if(!s)return null;let t=e.getShapeHandles(s);if(!t)return null;let i=(r?20:12)/n*2;return t.filter(e=>"virtual"!==e.type||!t.some(t=>t!==e&&"vertex"===t.type&&rG.Dist(e,t)<i)).sort(e=>"vertex"===e.type?1:-1)},[e,s,n,r]);return t&&s&&!o&&!i&&l&&a?(0,j.jsx)(t,{children:(0,j.jsx)("g",{transform:oj.toCssString(a),children:l.map(e=>(0,j.jsx)(oZ,{shapeId:s.id,handle:e,zoom:n,isCoarse:r},e.id))})}):null}function oZ({shapeId:e,handle:t,zoom:n,isCoarse:r}){let i=function(e,t){let n=rR();return eg.useMemo(()=>{let r,i;return{onPointerDown:r=>{if(r.isKilled)return;rj(rI(r.currentTarget),r);let{shape:i,handle:o}=oP(n,e,t);o&&n.dispatch({type:"pointer",target:"handle",handle:o,shape:i,name:"pointer_down",...rA(r)})},onPointerMove:o=>{if(o.isKilled||o.clientX===r&&o.clientY===i)return;r=o.clientX,i=o.clientY;let{shape:s,handle:a}=oP(n,e,t);a&&n.dispatch({type:"pointer",target:"handle",handle:a,shape:s,name:"pointer_move",...rA(o)})},onPointerUp:r=>{if(r.isKilled)return;rM(rI(r.currentTarget),r);let{shape:i,handle:o}=oP(n,e,t);o&&n.dispatch({type:"pointer",target:"handle",handle:o,shape:i,name:"pointer_up",...rA(r)})}}},[n,e,t])}(e,t.id),{Handle:o}=iL();return o?(0,j.jsx)("g",{"aria-label":"handle",transform:`translate(${t.x}, ${t.y})`,...i,children:(0,j.jsx)(o,{shapeId:e,handle:t,zoom:n,isCoarse:r})}):null}function oJ(){let e=rR(),t=e_("rendering shapes",()=>e.getRenderingShapes(),[e]);return(0,j.jsx)(j.Fragment,{children:t.map(e=>(0,j.jsxs)(eg.Fragment,{children:[(0,j.jsx)(oF,{...e}),(0,j.jsx)(o8,{id:e.id})]},e.id+"_fragment"))})}function oQ(){let e=rR(),t=e_("rendering shapes",()=>e.getRenderingShapes(),[e]);return(0,j.jsx)(j.Fragment,{children:t.map(e=>(0,j.jsx)(oF,{...e},e.id+"_shape"))})}function o0(){let e=rR(),t=e_("selectedShapeIds",()=>e.getCurrentPageState().selectedShapeIds,[e]);return e_("should display selected ids",()=>e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!e.getInstanceState().isChangingStyle,[e])?(0,j.jsx)(j.Fragment,{children:t.map(e=>(0,j.jsx)(rY,{className:"tl-user-indicator__selected",id:e},e+"_indicator"))}):null}let o1=function(){let e=rR(),{HoveredShapeIndicator:t}=iL(),n=e_("coarse pointer",()=>e.getInstanceState().isCoarsePointer,[e]),r=e_("hovering canvas",()=>e.getInstanceState().isHoveringCanvas,[e]),i=e_("hovered id",()=>e.getCurrentPageState().hoveredShapeId,[e]);return!n&&r&&i&&t?(0,j.jsx)(t,{shapeId:i}):null},o2=eS(function(){let e=eP(rR().getHintingShapeIds());return e.length?(0,j.jsx)(j.Fragment,{children:e.map(e=>(0,j.jsx)(rY,{className:"tl-user-indicator__hint",id:e},e+"_hinting"))}):null});function o5(){return(0,j.jsxs)("g",{id:"cursor",children:[(0,j.jsxs)("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[(0,j.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,j.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,j.jsxs)("g",{fill:"white",transform:"translate(-12,-12)",children:[(0,j.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,j.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,j.jsxs)("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[(0,j.jsx)("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),(0,j.jsx)("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function o3(){return(0,j.jsx)("path",{id:"cursor_hint",fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function o4(){return(0,j.jsx)("marker",{id:"arrowhead-dot",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:(0,j.jsx)("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function o6(){return(0,j.jsxs)("marker",{id:"arrowhead-cross",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[(0,j.jsx)("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),(0,j.jsx)("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}let o8=eS(function({id:e}){let t=rR(),n=t.getShape(e),[r,i]=eg.useState(""),o=n?.parentId===t.getCurrentPageId();return(eg.useEffect(()=>{if(!o)return;let n=null,r=G("shape to svg",async()=>{let r=Math.random();n=r;let o=t.getShapePageBounds(e),s=await t.getSvg([e],{padding:0,background:t.getInstanceState().exportBackground});s&&o&&n===r&&(s.style.setProperty("overflow","visible"),s.setAttribute("preserveAspectRatio","xMidYMin slice"),s.style.setProperty("transform",`translate(${o.x}px, ${o.y+o.h+12}px)`),s.style.setProperty("border","1px solid black"),i(s?.outerHTML))});return()=>{n=null,r()}},[t,e,o]),o)?(0,j.jsx)("div",{style:{paddingTop:12,position:"absolute"},children:(0,j.jsx)("div",{style:{display:"flex"},dangerouslySetInnerHTML:{__html:r}})}):null});function o9(){let e=e_("debugging ui log",()=>r_.logMessages.get(),[r_]);return e.length?(0,j.jsx)("div",{className:"debug__ui-logger",children:e.map((e,t)=>{let n="string"==typeof e?e:JSON.stringify(e);return(0,j.jsx)("div",{className:"debug__ui-logger__line",children:n},t)})}):null}function o7(){let e=rR(),t=e_("selection rotation",()=>e.getSelectionRotation(),[e]),n=e_("selection bounds",()=>e.getSelectionRotatedPageBounds(),[e]),{SelectionForeground:r}=iL();return n&&r?(0,j.jsx)(r,{bounds:n,rotation:t}):null}function se(){let e=rR(),t=e_("selection rotation",()=>e.getSelectionRotation(),[e]),n=e_("selection bounds",()=>e.getSelectionRotatedPageBounds(),[e]),{SelectionBackground:r}=iL();return n&&r?(0,j.jsx)(r,{bounds:n,rotation:t}):null}function st(){let{OnTheCanvas:e}=iL();return e?(0,j.jsx)(e,{}):null}function sn(){let{InFrontOfTheCanvas:e}=iL();return e?(0,j.jsx)(e,{}):null}let sr=()=>(0,j.jsx)(lL,{children:"Connecting..."}),si=e=>{!l||l.length<e?(l=Buffer.allocUnsafe(128*e),(0,e2.randomFillSync)(l),d=0):d+e>l.length&&((0,e2.randomFillSync)(l),d=0),d+=e},so=(e=21)=>{si(e-=0);let t="";for(let n=d-e;n<d;n++)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&l[n]];return t};function ss(){return so()}let sa="TLDRAW_USER_DATA_v3",sl=tT({id:tS,name:tS.nullable().optional(),locale:tS.nullable().optional(),color:tS.nullable().optional(),isDarkMode:tI.nullable().optional(),animationSpeed:tw.nullable().optional(),edgeScrollSpeed:tw.nullable().optional(),isSnapMode:tI.nullable().optional()}),sd={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4},sc=to({currentVersion:sd.AddEdgeScrollSpeed,migrators:{[sd.AddAnimationSpeed]:{up:e=>({...e,animationSpeed:1}),down:({animationSpeed:e,...t})=>t},[sd.AddIsSnapMode]:{up:e=>({...e,isSnapMode:!1}),down:({isSnapMode:e,...t})=>t},[sd.MakeFieldsNullable]:{up:e=>e,down:e=>({id:e.id,name:e.name??sh.name,locale:e.locale??sh.locale,color:e.color??sh.color,isDarkMode:e.isDarkMode??sh.isDarkMode,animationSpeed:e.animationSpeed??sh.animationSpeed,isSnapMode:e.isSnapMode??sh.isSnapMode})},[sd.AddEdgeScrollSpeed]:{up:e=>({...e,edgeScrollSpeed:1}),down:({edgeScrollSpeed:e,...t})=>t}}}),su=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"],sh=Object.freeze({name:"New User",locale:function(e){for(let t of e){let e=function(e){let t=rg.find(t=>t.locale===e.toLowerCase());if(t)return t.locale;let[n,r]=e.split(/[-_]/).map(e=>e.toLowerCase());if(r){let e=rg.find(e=>e.locale===n);if(e)return e.locale}return n in rf?rf[n]:null}(t);if(e)return e}return"en"}("undefined"!=typeof window?window.navigator.languages??["en"]:["en"]),color:su[Math.floor(Math.random()*su.length)],isDarkMode:!1,edgeScrollSpeed:1,animationSpeed:"undefined"!=typeof window&&window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches?0:1,isSnapMode:!1});function sp(){return{id:ss()}}function sg(e){if(null===e||"object"!=typeof e||!("version"in e)||!("user"in e)||"number"!=typeof e.version)return sp();let t=tl({value:e.user,fromVersion:e.version,toVersion:sc.currentVersion??0,migrations:sc});if("error"===t.type)return sp();try{sl.validate(t.value)}catch(e){return sp()}return t.value}let sf=er("globalUserData",sg("undefined"==typeof window?null:JSON.parse(window?.localStorage?.getItem(sa)||"null")??null));function sm(e){sl.validate(e),sf.set(e),"undefined"!=typeof window&&window.localStorage&&window.localStorage.setItem(sa,JSON.stringify({version:sc.currentVersion,user:sf.get()})),sb?.postMessage({type:sx,origin:sv,data:{user:sf.get(),version:sc.currentVersion}})}let sy="undefined"!=typeof process&&!1,sb="undefined"==typeof BroadcastChannel||sy?null:new BroadcastChannel("tldraw-user-sync");sb?.addEventListener("message",e=>{let t=e.data;t?.type===sx&&t?.origin!==sv&&sf.set(sg(t.data))});let sv=ss(),sx="tldraw-user-preferences-change";function sS(e={}){return{derivePresenceState:e.derivePresenceState??(()=>ep("presence",()=>null)),userPreferences:e.userPreferences??ep("userPreferences",()=>sf.get()),setUserPreferences:e.setUserPreferences??sm}}var sw=n(1028);function sC({children:e,className:t="",...n}){return(0,j.jsx)("svg",{...n,className:`tl-svg-container ${t}`,children:e})}function s_(e,t,n,r){let i=e.x-n.x,o=e.y-n.y,s=r.x-n.x,a=r.y-n.y,l=t.x-e.x,d=t.y-e.y,c=s*o-a*i,u=l*o-d*i,h=a*l-s*d;if(0===c||0===u||0===h)return null;if(0!==h){let t=c/h,n=u/h;if(0<=t&&t<=1&&0<=n&&n<=1)return rG.AddXY(e,t*l,t*d)}return null}function sk(e,t,n,r){let i=(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y),o=2*((t.x-e.x)*(e.x-n.x)+(t.y-e.y)*(e.y-n.y)),s=o*o-4*i*(n.x*n.x+n.y*n.y+e.x*e.x+e.y*e.y-2*(n.x*e.x+n.y*e.y)-r*r);if(s<0||0===s)return null;let a=Math.sqrt(s),l=(-o+a)/(2*i),d=(-o-a)/(2*i);if((l<0||l>1)&&(d<0||d>1))return null;let c=[];return(0<=l&&l<=1&&c.push(rG.Lrp(e,t,l)),0<=d&&d<=1&&c.push(rG.Lrp(e,t,d)),0===c.length)?null:c}function sP(e,t,n){let r;let i=[];for(let o=0,s=n.length-1;o<s;o++)(r=s_(e,t,n[o],n[o+1]))&&i.push(r);return 0===i.length?null:i}function sI(e,t,n){let r;let i=[];for(let o=0,s=n.length;o<s;o++)(r=sk(n[o],n[(o+1)%n.length],e,t))&&i.push(...r);return 0===i.length?null:i}function sE(e,t,n){let r;let i=[];for(let o=1,s=n.length;o<s;o++)(r=sk(n[o-1],n[o],e,t))&&i.push(...r);return 0===i.length?null:i}function sj(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function sM(e,t,n,r){return sj(e,n,r)!==sj(t,n,r)&&sj(e,t,n)!==sj(e,t,r)}function sT(e,t){let n,r;let i=new Map;for(let r=0,o=e.length;r<o;r++)if(io(n=e[r],t)){let e=sA(n);i.has(e)||i.set(e,n)}for(let r=0,o=t.length;r<o;r++)if(io(n=t[r],e)){let e=sA(n);i.has(e)||i.set(e,n)}for(let o=0,s=e.length;o<s;o++){n=e[o],r=e[(o+1)%e.length];for(let e=0,o=t.length;e<o;e++){let o=s_(n,r,t[e],t[(e+1)%t.length]);if(null!==o){let e=sA(o);i.has(e)||i.set(e,o)}}}return 0===i.size?null:function(e){let t=rG.Average(e);return e.sort((e,n)=>rG.Angle(t,e)-rG.Angle(t,n))}([...i.values()])}function sA(e){return`${e.x},${e.y}`}class sO extends oM{start;end;d;u;ul;constructor(e){super({...e,isClosed:!1,isFilled:!1});let{start:t,end:n}=e;this.start=t,this.end=n,this.d=t.clone().sub(n),this.u=this.d.clone().uni(),this.ul=this.u.len()}_length;get length(){return this._length?this._length:this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(e){let{start:t,end:n,u:r,ul:i}=this;if(0===i)return t;let o=rG.Sub(e,t).dpr(r)/i,s=t.x+r.x*o;if(s<Math.min(t.x,n.x))return t.x<n.x?t:n;if(s>Math.max(t.x,n.x))return t.x>n.x?t:n;let a=t.y+r.y*o;return a<Math.min(t.y,n.y)?t.y<n.y?t:n:a>Math.max(t.y,n.y)?t.y>n.y?t:n:new rG(s,a)}hitTestLineSegment(e,t,n){return sM(e,t,this.start,this.end)}}class sR extends oM{points;constructor(e){super({isClosed:!1,isFilled:!1,...e});let{points:t}=e;this.points=t}_segments;get segments(){if(!this._segments){this._segments=[];let{vertices:e}=this;for(let t=0,n=e.length-1;t<n;t++){let n=e[t],r=e[t+1];this._segments.push(new sO({start:n,end:r}))}this.isClosed&&this._segments.push(new sO({start:e[e.length-1],end:e[0]}))}return this._segments}_length;get length(){return this._length||(this._length=this.segments.reduce((e,t)=>e+t.length,0)),this._length}getVertices(){return this.points}nearestPoint(e){let t,n;let{segments:r}=this,i=this.points[0],o=1/0;for(let s=0;s<r.length;s++)(n=(t=r[s].nearestPoint(e)).dist(e))<o&&(i=t,o=n);return i}hitTestLineSegment(e,t,n){return this.segments.some(r=>r.hitTestLineSegment(e,t,n))}}class sL extends sR{constructor(e){super({...e}),this.isClosed=!0}}class sD extends sL{x;y;w;h;constructor(e){let{x:t=0,y:n=0,width:r,height:i}=e;super({...e,points:[new rG(t,n),new rG(t+r,n),new rG(t+r,n+i),new rG(t,n+i)]}),this.x=t,this.y=n,this.w=r,this.h=i}getBounds(){return new oE(this.x,this.y,this.w,this.h)}}class sz{constructor(e){this.editor=e}static props;static migrations;static type;canSnap=()=>!0;canScroll=()=>!1;canUnmount=()=>!0;canBind=(e,t)=>!0;canEdit=()=>!1;canResize=()=>!0;canEditInReadOnly=()=>!1;canCrop=()=>!1;providesBackgroundForChildren(e){return!1}hideResizeHandles=()=>!1;hideRotateHandle=()=>!1;hideSelectionBoundsBg=()=>!1;hideSelectionBoundsFg=()=>!1;isAspectRatioLocked=()=>!1;getOutlineSegments(e){return[this.editor.getShapeGeometry(e).vertices]}canReceiveNewChildrenOfType(e,t){return!1}canDropShapes(e,t){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}onBeforeCreate;onBeforeUpdate;onDragShapesOver;onDragShapesOut;onDropShapesOver;onResizeStart;onResize;onResizeEnd;onTranslateStart;onTranslate;onTranslateEnd;onHandleDrag;onRotateStart;onRotate;onRotateEnd;onBindingChange;onChildrenChange;onDoubleClickHandle;onDoubleClickEdge;onDoubleClick;onClick;onEditEnd}function sN({bounds:e,className:t}){let n=rR(),r=e_("zoom level",()=>n.getZoomLevel(),[n]);return(0,j.jsx)("g",{className:t,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:e.sides.map((e,t)=>{let{strokeDasharray:n,strokeDashoffset:i}=function(e,t,n={}){let{closed:r=!1,snap:i=1,start:o="outset",end:s="outset",lengthRatio:a=2,style:l="dashed"}=n,d=0,c=0,u=1,h=0,p=0;switch(l){case"dashed":u=1,d=Math.min(t*a,e/4);break;case"dotted":d=t/(u=100);break;default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||("outset"===o?(e+=d/2,p+=d/2):"skip"===o&&(e-=d,p-=d),"outset"===s?e+=d/2:"skip"!==s||(e-=d)),c=Math.floor(e/d/(2*u)),(c-=c%i)<3&&"dashed"===l?e/t<5?(d=e,c=1,h=0):(d=.333*e,h=.333*e):(d=e/(c=Math.max(c,3))/(2*u),r?(p=d/2,h=(e-c*d)/c):h=(e-c*d)/Math.max(1,c-1)),{strokeDasharray:[d,h].join(" "),strokeDashoffset:p.toString()}}(e[0].dist(e[1]),1/r,{style:"dashed",lengthRatio:4});return(0,j.jsx)("line",{x1:e[0].x,y1:e[0].y,x2:e[1].x,y2:e[1].y,strokeDasharray:n,strokeDashoffset:i},t)})})}class s$ extends sz{static type="group";static props=ri;static migrations=ro;hideSelectionBoundsFg=()=>!0;canBind=()=>!1;getDefaultProps(){return{}}getGeometry(e){let t=this.editor.getSortedChildIdsForParent(e.id);return 0===t.length?new sD({width:1,height:1,isFilled:!1}):new oT({children:t.map(e=>{let t=this.editor.getShape(e),n=this.editor.getShapeGeometry(e),r=this.editor.getShapeLocalTransform(t).applyToPoints(n.vertices);return n.isClosed?new sL({points:r,isFilled:!0}):new sR({points:r})})})}component(e){let t=this.editor.getErasingShapeIds().includes(e.id),{hintingShapeIds:n}=this.editor.getCurrentPageState(),r=n.length>0&&n.some(t=>t!==e.id&&this.editor.isShapeOfType(this.editor.getShape(t),"group")),i=this.editor.getCurrentPageState().focusedGroupId!==e.id;if(!t&&(i||r))return null;let o=this.editor.getShapeGeometry(e).bounds;return(0,j.jsx)(sC,{id:e.id,children:(0,j.jsx)(sN,{className:"tl-group",bounds:o})})}indicator(e){let t=this.editor.getShapeGeometry(e).bounds;return(0,j.jsx)(sN,{className:"",bounds:t})}onChildrenChange=e=>{let t=this.editor.getSortedChildIdsForParent(e.id);if(0===t.length){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([e.id]);return}if(1===t.length){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(t,e.parentId),this.editor.deleteShapes([e.id]);return}}}let sF=[s$],sB=new Set(sF.map(e=>e.type));function sV(e){let t=[...sF],n=new Set;for(let r of e){if(sB.has(r.type))throw Error(`Shape type "${r.type}" is a core shapes type and cannot be overridden`);if(n.has(r.type))throw Error(`Shape type "${r.type}" is defined more than once`);t.push(r),n.add(r.type)}return t}function sU(e,t){if(!t)return!1;switch(e.type){case"mixed":return"mixed"===t.type;case"shared":return"shared"===t.type&&e.value===t.value;default:throw eM(e)}}class sK{map;constructor(e){this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){let t=this.get(e);if(t&&"mixed"!==t.type)return t.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;let t=new Set;for(let[n,r]of this){if(!sU(r,e.get(n)))return!1;t.add(n)}for(let[n,r]of e)if(!t.has(n)&&!sU(r,this.get(n)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class sH extends sK{set(e,t){this.map.set(e,t)}applyValue(e,t){let n=this.get(e);if(!n){this.set(e,{type:"shared",value:t});return}switch(n.type){case"mixed":return;case"shared":n.value!==t&&this.set(e,{type:"mixed"});return;default:eM(n,"type")}}}class sY{items=new WeakMap;get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}access(e){return this.items.get(e)}set(e,t){this.items.set(e,t)}has(e){return this.items.has(e)}invalidate(e){this.items.delete(e)}bust(){this.items=new WeakMap}}let sW="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",sX="A00000000000000000000000000";function sG(e){if(e>="a"&&e<="z")return e.charCodeAt(0)-97+2;if(e>="A"&&e<="Z")return 90-e.charCodeAt(0)+2;throw Error("Invalid index key head: "+e)}function sq(e){if(e.length!==sG(e.charAt(0)))throw Error("invalid integer part of index key: "+e)}function sZ(e){if(void 0===e)throw Error("n is undefined")}function sJ(e){sq(e);let[t,...n]=e.split(""),r=!0;for(let e=n.length-1;r&&e>=0;e--){let t=sW.indexOf(n[e])+1;t===sW.length?n[e]="0":(n[e]=sW.charAt(t),r=!1)}if(!r)return t+n.join("");{if("Z"===t)return"a0";if("z"===t)return;let e=String.fromCharCode(t.charCodeAt(0)+1);return e>"a"?n.push("0"):n.pop(),e+n.join("")}}function sQ(e,t){if(void 0!==t&&e>=t)throw Error(e+" >= "+t);if("0"===e.slice(-1)||t&&"0"===t.slice(-1))throw Error("trailing zero");if(t){let n=0;for(;(e.charAt(n)||"0")===t.charAt(n);)n++;if(n>0)return t.slice(0,n)+sQ(e.slice(n),t.slice(n))}let n=e?sW.indexOf(e.charAt(0)):0,r=void 0!==t?sW.indexOf(t.charAt(0)):sW.length;return r-n>1?sW.charAt(Math.round(.5*(n+r))):t&&t.length>1?t.slice(0,1):sW.charAt(n)+sQ(e.slice(1),void 0)}function s0(e){let t=sG(e.charAt(0));if(t>e.length)throw Error("invalid index: "+e);return e.slice(0,t)}function s1(e){if(e===sX)throw Error("invalid index: "+e);let t=s0(e);if("0"===e.slice(t.length).slice(-1))throw Error("invalid index: "+e)}function s2(e,t){if(void 0!==e&&s1(e),void 0!==t&&s1(t),void 0!==e&&void 0!==t&&e>=t)throw Error(e+" >= "+t);if(void 0===e&&void 0===t)return"a0";if(void 0===e){if(void 0===t)throw Error("b is undefined");let e=s0(t),n=t.slice(e.length);if(e===sX)return e+sQ("",n);if(e<t)return e;let r=function(e){sq(e);let[t,...n]=e.split(""),r=!0;for(let e=n.length-1;r&&e>=0;e--){let t=sW.indexOf(n[e])-1;-1===t?n[e]=sW.slice(-1):(n[e]=sW.charAt(t),r=!1)}if(!r)return t+n.join("");{if("a"===t)return"Z"+sW.slice(-1);if("A"===t)return;let e=String.fromCharCode(t.charCodeAt(0)-1);return e<"Z"?n.push(sW.slice(-1)):n.pop(),e+n.join("")}}(e);return sZ(r),r}if(void 0===t){let t=s0(e),n=e.slice(t.length),r=sJ(t);return void 0===r?t+sQ(n,void 0):r}let n=s0(e),r=e.slice(n.length),i=s0(t),o=t.slice(i.length);if(n===i)return n+sQ(r,o);let s=sJ(n);return sZ(s),s<t?s:n+sQ(r,void 0)}function s5(e,t,n){if(0===n)return[];if(1===n)return[s2(e,t)];if(void 0===t){let r=s2(e,t),i=[r];for(let e=0;e<n-1;e++)i.push(r=s2(r,t));return i}if(void 0===e){let r=s2(e,t),i=[r];for(let t=0;t<n-1;t++)i.push(r=s2(e,r));return i.reverse(),i}let r=Math.floor(n/2),i=s2(e,t);return[...s5(e,i,r),i,...s5(i,t,n-r-1)]}function s3(e,t){return s5(e,void 0,t)}function s4(e,t){return s5(e,t,1)[0]}function s6(e){return s5(e,void 0,1)[0]}function s8(e,t="a1"){return[t,...s5(t,void 0,e)]}function s9(e,t){return e.index<t.index?-1:e.index>t.index?1:0}function s7(e,t,n){if(0===n.length)return[];let r=new Map;for(let t of eI(n.map(t=>e.getShape(t)))){let{parentId:n}=t;r.has(n)||r.set(n,{children:eI(e.getSortedChildIdsForParent(n).map(t=>e.getShape(t))),moving:new Set}),r.get(n).moving.add(t)}let i=[];switch(t){case"toBack":r.forEach(({moving:e,children:t})=>(function(e,t,n){let r,i;let o=t.length;if(e.size!==o){for(let n=0;n<o;n++){let o=t[n];if(e.has(o))r=o.index,e.delete(o);else{i=o.index;break}}if(0===e.size)return;{let t=s5(r,i,e.size);n.push(...Array.from(e.values()).sort(s9).map((e,n)=>({...e,index:t[n]})))}}})(e,t,i));break;case"toFront":r.forEach(({moving:e,children:t})=>(function(e,t,n){let r,i;let o=t.length;if(e.size!==o){for(let n=o-1;n>-1;n--){let o=t[n];if(e.has(o))i=o.index,e.delete(o);else{r=o.index;break}}if(0===e.size)return;{let t=s5(r,i,e.size);n.push(...Array.from(e.values()).sort(s9).map((e,n)=>({...e,index:t[n]})))}}})(e,t,i));break;case"forward":r.forEach(({moving:e,children:t})=>(function(e,t,n){let r=t.length;if(e.size===r)return;let i={name:"skipping"};for(let o=0;o<r;o++){let r=e.has(t[o]);switch(i.name){case"skipping":if(!r)continue;i={name:"selecting",selectIndex:o};break;case"selecting":{if(r)continue;let{selectIndex:e}=i;s5(t[o].index,t[o+1]?.index,o-e).forEach((r,i)=>n.push({...t[e+i],index:r})),i={name:"skipping"}}}}})(e,t,i));break;case"backward":r.forEach(({moving:e,children:t})=>(function(e,t,n){let r=t.length;if(e.size===r)return;let i={name:"skipping"};for(let o=r-1;o>-1;o--){let r=e.has(t[o]);switch(i.name){case"skipping":if(!r)continue;i={name:"selecting",selectIndex:o};break;case"selecting":if(r)continue;s5(t[o-1]?.index,t[o].index,i.selectIndex-o).forEach((e,r)=>{n.push({...t[o+r+1],index:e})}),i={name:"skipping"}}}})(e,t,i))}return i}let ae=e=>{let{store:t}=e,n=t.query.filterHistory("shape"),r=t.query.records("shape",()=>({type:{eq:"arrow"}}));function i(){let e=r.get(),t={};for(let n of e){let{start:e,end:r}=n.props;if("binding"===e.type){let r=t[e.boundShapeId];r?r.push({arrowId:n.id,handleId:"start"}):t[e.boundShapeId]=[{arrowId:n.id,handleId:"start"}]}if("binding"===r.type){let e=t[r.boundShapeId];e?e.push({arrowId:n.id,handleId:"end"}):t[r.boundShapeId]=[{arrowId:n.id,handleId:"end"}]}}return t}return ep("arrowBindingsIndex",(t,r)=>{let o;if(es(t))return i();let s=n.getDiffSince(r);if(s===F)return i();function a(e){o||(o={...t}),o[e]?o[e]===t[e]&&(o[e]=[...o[e]]):o[e]=[]}function l(e,t,n){a(e),o[e]=o[e].filter(e=>e.arrowId!==t||e.handleId!==n),0===o[e].length&&delete o[e]}function d(e,t,n){a(e),o[e].push({arrowId:t,handleId:n})}for(let t of s){for(let n of Object.values(t.added))if(e.isShapeOfType(n,"arrow")){let{start:e,end:t}=n.props;"binding"===e.type&&d(e.boundShapeId,n.id,"start"),"binding"===t.type&&d(t.boundShapeId,n.id,"end")}for(let[n,r]of Object.values(t.updated))if(e.isShapeOfType(n,"arrow")&&e.isShapeOfType(r,"arrow"))for(let e of["start","end"]){let t=n.props[e],i=r.props[e];"binding"===t.type&&"point"===i.type?l(t.boundShapeId,n.id,e):"point"===t.type&&"binding"===i.type?d(i.boundShapeId,r.id,e):"binding"===t.type&&"binding"===i.type&&t.boundShapeId!==i.boundShapeId&&(l(t.boundShapeId,n.id,e),d(i.boundShapeId,r.id,e))}for(let n of Object.values(t.removed))if(e.isShapeOfType(n,"arrow")){let{start:e,end:t}=n.props;"binding"===e.type&&l(e.boundShapeId,n.id,"start"),"binding"===t.type&&l(t.boundShapeId,n.id,"end")}}return o??t})},at=e=>{let t=e.query.ids("shape");function n(){let n={},r=t.get(),i=Array(r.size);return r.forEach(t=>i.push(e.get(t))),i.sort(s9),i.forEach(e=>{n[e.parentId]||(n[e.parentId]=[]),n[e.parentId].push(e.id)}),n}return ep("parentsToChildrenWithIndexes",(t,r)=>{let i;if(es(t))return n();let o=e.history.getDiffSince(r);if(o===F)return n();if(0===o.length)return t;let s=null,a=e=>{s||(s={...t}),s[e]?s[e]===t[e]&&(s[e]=[...s[e]]):s[e]=[]},l=new Set;for(let e=0,t=o.length;e<t;e++){for(let t of Object.values((i=o[e]).added))n$(t)&&(a(t.parentId),s[t.parentId].push(t.id),l.add(s[t.parentId]));for(let[e,t]of Object.values(i.updated))if(n$(t)&&n$(e)){if(e.parentId!==t.parentId)a(e.parentId),a(t.parentId),s[e.parentId].splice(s[e.parentId].indexOf(t.id),1),s[t.parentId].push(t.id),l.add(s[t.parentId]);else if(e.index!==t.index){a(t.parentId);let e=s[t.parentId].indexOf(t.id);s[t.parentId][e]=t.id,l.add(s[t.parentId])}}for(let e of Object.values(i.removed))n$(e)&&(a(e.parentId),s[e.parentId].splice(s[e.parentId].indexOf(e.id),1))}for(let t of l){let n=eI(t.map(t=>e.get(t)));n.sort(s9),t.splice(0,t.length,...n.map(e=>e.id))}return s??t})},an=(e,t,n)=>{for(;!t8(n.parentId);){let t=e.get(n.parentId);if(!t)return!1;n=t}return n.parentId===t},ar=(e,t)=>{let n=e.query.ids("shape"),r=null;function i(){let i=t();return r=i,new Set([...n.get()].filter(t=>an(e,i,e.get(t))))}return ep("_shapeIdsInCurrentPage",(n,o)=>{if(es(n))return i();let s=t();if(s!==r)return i();let a=e.history.getDiffSince(o);if(a===F)return i();let l=new ek(n);for(let t of a){for(let n of Object.values(t.added))n$(n)&&an(e,s,n)&&l.add(n.id);for(let[n,r]of Object.values(t.updated))n$(r)&&(an(e,s,r)?l.add(r.id):l.remove(r.id));for(let e of Object.keys(t.removed))nF(e)&&l.remove(e)}let d=l.get();return d?el(d.value,d.diff):n})};class ai{constructor(e){this.editor=e}_clickId="";_clickTimeout;_clickScreenPoint;_previousScreenPoint;_getClickTimeout=(e,t=ss())=>{this._clickId=t,clearTimeout(this._clickTimeout),this._clickTimeout=setTimeout(()=>{if(this._clickState===e&&this._clickId===t){switch(this._clickState){case"pendingTriple":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break;case"pendingQuadruple":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break;case"pendingOverflow":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"})}this._clickState="idle"}},"idle"===e||"pendingDouble"===e?450:200)};_clickState="idle";get clickState(){return this._clickState}lastPointerInfo={};transformPointerDownEvent=e=>{if(!this._clickState)return e;switch(this._clickScreenPoint=rG.From(e.point),this._previousScreenPoint&&this._previousScreenPoint.dist(this._clickScreenPoint)>40&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"idle":return this._clickState="pendingDouble",this._clickTimeout=this._getClickTimeout(this._clickState),e;case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"pendingOverflow":return this._clickState="overflow",this._clickTimeout=this._getClickTimeout(this._clickState),e;default:return this._clickTimeout=this._getClickTimeout(this._clickState),e}};transformPointerUpEvent=e=>{if(!this._clickState)return e;switch(this._clickScreenPoint=rG.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"};default:return e}};cancelDoubleClickTimeout=()=>{this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"};handleMove=()=>{"idle"!==this._clickState&&this._clickScreenPoint&&this._clickScreenPoint.dist(this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?6:4)&&this.cancelDoubleClickTimeout()}}class ao{constructor(e){this.editor=e,"undefined"!=typeof window&&"navigator"in window?(this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),this.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)):(this.isSafari=!1,this.isIos=!1,this.isChromeForIos=!1,this.isFirefox=!1,this.isAndroid=!1)}isSafari;isIos;isChromeForIos;isFirefox;isAndroid}function as(e){if(e){let t=al;for(;e.length;)t=t.push(e.pop());return t}return al}class aa{length=0;head=null;tail=this;push(e){return new ad(e,this)}toArray(){return N}[Symbol.iterator](){return{next:()=>({value:void 0,done:!0})}}}let al=new aa;class ad{constructor(e,t){this.head=e,this.tail=t,this.length=t.length+1}length;push(e){return new ad(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(!e.length)return{value:void 0,done:!0};{let t=e.head;return e=e.tail,{value:t,done:!1}}}}}}class ac{constructor(e,t){this.ctx=e,this.annotateError=t}_undos=er("HistoryManager.undos",as());_redos=er("HistoryManager.redos",as());_batchDepth=0;onBatchComplete=()=>void 0;_commands={};getNumUndos(){return this._undos.get().length}getNumRedos(){return this._redos.get().length}createCommand=(e,t,n)=>{if(this._commands[e])throw Error(`Duplicate command: ${e}`);this._commands[e]=n;let r=(...i)=>{if(!this._batchDepth)return this.batch(()=>r(...i)),this.ctx;let o=t(...i);if(!o)return this.ctx;let{data:s,ephemeral:a,squashing:l,preservesRedoStack:d}=o;if(this.ignoringUpdates((e,t)=>(n.do(s),{undos:e,redos:t})),!a){let t=this._undos.get().head;l&&t&&"command"===t.type&&t.name===e&&t.preservesRedoStack===d?this._undos.update(e=>e.tail.push({...t,id:ss(),data:n.squash(t.data,s)})):this._undos.update(t=>t.push({type:"command",name:e,data:s,id:ss(),preservesRedoStack:d})),o.preservesRedoStack||this._redos.set(as()),this.ctx.emit("change-history",{reason:"push"})}return this.ctx};return r};batch=e=>{try{this._batchDepth++,1===this._batchDepth?ee(()=>{let t=this._undos.get().head?.id;e(),t!==this._undos.get().head?.id&&this.onBatchComplete()}):e()}catch(e){throw this.annotateError(e),e}finally{this._batchDepth--}return this};ignoringUpdates=e=>{let t=this._undos.get(),n=this._redos.get();this._undos.set(as()),this._redos.set(as());try{({undos:t,redos:n}=ee(()=>e(t,n)))}finally{this._undos.set(t),this._redos.set(n)}};_undo=({pushToRedoStack:e,toMark:t})=>(this.ignoringUpdates((n,r)=>{if(0===n.length)return{undos:n,redos:r};for(;n.head?.type==="STOP";){let i=n.head;if(n=n.tail,e&&(r=r.push(i)),i.id===t)return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:n,redos:r}}if(0===n.length)return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:n,redos:r};for(;n.head;){let i=n.head;if(n=n.tail,e&&(r=r.push(i)),"STOP"===i.type){if(i.onUndo&&(!t||i.id===t))break}else this._commands[i.name].undo(i.data)}return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:n,redos:r}}),this);undo=()=>(this._undo({pushToRedoStack:!0}),this);redo=()=>(this.ignoringUpdates((e,t)=>{if(0===t.length)return{undos:e,redos:t};for(;t.head?.type==="STOP";)e=e.push(t.head),t=t.tail;if(0===t.length)return this.ctx.emit("change-history",{reason:"redo"}),{undos:e,redos:t};for(;t.head;){let n=t.head;if(e=e.push(t.head),t=t.tail,"STOP"===n.type){if(n.onRedo)break}else{let e=this._commands[n.name];e.redo?e.redo(n.data):e.do(n.data)}}return this.ctx.emit("change-history",{reason:"redo"}),{undos:e,redos:t}}),this);bail=()=>(this._undo({pushToRedoStack:!1}),this);bailToMark=e=>(this._undo({pushToRedoStack:!1,toMark:e}),this);mark=(e=ss(),t=!0,n=!0)=>{let r=this._undos.get().head;return r&&"STOP"===r.type&&r.id===e&&r.onUndo===t&&r.onRedo===n?r.id:(this._undos.update(r=>r.push({type:"STOP",id:e,onUndo:t,onRedo:n})),this.ctx.emit("mark-history",{id:e}),e)};clear(){this._undos.set(as()),this._redos.set(as())}}class au{constructor(e){this.editor=e}scribbleItems=new Map;state="paused";addScribble=(e,t=ss())=>{let n={id:t,scribble:{id:t,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:e.delay??0,prev:null,next:null};return this.scribbleItems.set(t,n),"paused"===this.state&&this.resume(),n};resume(){this.state="running",this.editor.addListener("tick",this.tick)}pause(){this.editor.removeListener("tick",this.tick),this.state="paused"}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear(),this.pause()}stop=e=>{let t=this.scribbleItems.get(e);if(!t)throw Error(`Scribble with id ${e} not found`);return t.delayRemaining=Math.min(t.delayRemaining,200),t.scribble.state="stopping",t};addPoint=(e,t,n)=>{let r=this.scribbleItems.get(e);if(!r)throw Error(`Scribble with id ${e} not found`);let{prev:i}=r,o={x:t,y:n,z:.5};return(!i||rG.Dist(i,o)>=1)&&(r.next=o),r};tick=e=>{this.editor.batch(()=>{this.scribbleItems.forEach(t=>{if("starting"===t.scribble.state){let{next:e,prev:n}=t;e&&e!==n&&(t.prev=e,t.scribble.points.push(e)),t.scribble.points.length>8&&(t.scribble.state="active");return}t.delayRemaining>0&&(t.delayRemaining=Math.max(0,t.delayRemaining-e)),t.timeoutMs+=e,t.timeoutMs>=16&&(t.timeoutMs=0);let{delayRemaining:n,timeoutMs:r,prev:i,next:o,scribble:s}=t;switch(s.state){case"active":o&&o!==i?(t.prev=o,s.points.push(o),0===n&&s.points.length>8&&s.points.shift()):0===r&&(s.points.length>1?s.points.shift():t.delayRemaining=s.delay);break;case"stopping":if(0===t.delayRemaining&&0===r){if(1===s.points.length){this.scribbleItems.delete(t.id);return}s.shrink&&(s.size=Math.max(1,s.size*(1-s.shrink))),s.points.shift()}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:e})=>({...e,points:[...e.points]})).slice(-5)}),0===this.scribbleItems.size&&this.pause()})}}class ah{constructor(e){this.editor=e,e.store.onBeforeCreate=(e,t)=>{let n=this._beforeCreateHandlers[e.typeName];if(n){let r=e;for(let e of n)r=e(r,t);return r}return e},e.store.onAfterCreate=(e,t)=>{let n=this._afterCreateHandlers[e.typeName];if(n)for(let r of n)r(e,t)},e.store.onBeforeChange=(e,t,n)=>{let r=this._beforeChangeHandlers[t.typeName];if(r){let i=t;for(let t of r)i=t(e,i,n);return i}return t};let t=0;e.store.onAfterChange=(e,n,r)=>{if(++t>1e3)console.error("[CleanupManager.onAfterChange] Maximum update depth exceeded, bailing out.");else{let t=this._afterChangeHandlers[n.typeName];if(t)for(let i of t)i(e,n,r)}t--},e.store.onBeforeDelete=(e,t)=>{let n=this._beforeDeleteHandlers[e.typeName];if(n){for(let r of n)if(!1===r(e,t))return!1}},e.store.onAfterDelete=(e,t)=>{let n=this._afterDeleteHandlers[e.typeName];if(n)for(let r of n)r(e,t)},e.history.onBatchComplete=()=>{this._batchCompleteHandlers.forEach(e=>e())}}_beforeCreateHandlers={};_afterCreateHandlers={};_beforeChangeHandlers={};_afterChangeHandlers={};_beforeDeleteHandlers={};_afterDeleteHandlers={};_batchCompleteHandlers=[];registerBeforeCreateHandler(e,t){return this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(t),()=>ap(this._beforeCreateHandlers[e],t)}registerAfterCreateHandler(e,t){return this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(t),()=>ap(this._afterCreateHandlers[e],t)}registerBeforeChangeHandler(e,t){return this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(t),()=>ap(this._beforeChangeHandlers[e],t)}registerAfterChangeHandler(e,t){return this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(t),()=>ap(this._afterChangeHandlers[e],t)}registerBeforeDeleteHandler(e,t){return this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(t),()=>ap(this._beforeDeleteHandlers[e],t)}registerAfterDeleteHandler(e,t){return this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(t),()=>ap(this._afterDeleteHandlers[e],t)}registerBatchCompleteHandler(e){return this._batchCompleteHandlers.push(e),()=>ap(this._batchCompleteHandlers,e)}}function ap(e,t){let n=e.indexOf(t);n>=0&&e.splice(n,1)}var ag=Object.defineProperty,af=Object.getOwnPropertyDescriptor,am=(e,t,n,r)=>{for(var i,o=r>1?void 0:r?af(t,n):t,s=e.length-1;s>=0;s--)(i=e[s])&&(o=(r?i(t,n,o):i(o))||o);return r&&o&&ag(t,n,o),o};let ay=e=>Math.round(1e8*e)/1e8;function ab(e,t,n,r,i){let o=e.filter(e=>("forward"===r?e.startNode.id===t:e.endNode.id===t)&&ay(e.length)===ay(n)&&ir(e.breadthIntersection[0],e.breadthIntersection[1],i[0],i[1]));if(0===o.length)return[];let s=new Set;return o.forEach(t=>{let a="forward"===r?t.endNode.id:t.startNode.id;if(!s.has(a)){s.add(a);let l=ab(e,a,n,r,ir(t.breadthIntersection[0],t.breadthIntersection[1],i[0],i[1]));o.push(...l)}}),o}class av{constructor(e){this.editor=e}_snapLines=er("snapLines",void 0);getLines(){return this._snapLines.get()??N}clear(){this.getLines().length&&this._snapLines.set(void 0)}setLines(e){this._snapLines.set(e)}getSnapPointsCache(){let{editor:e}=this;return e.store.createComputedCache("snapPoints",t=>{let n=e.getShapePageTransform(t.id);if(n)return this.editor.getShapeGeometry(t).snapPoints.map((e,r)=>{let{x:i,y:o}=oj.applyToPoint(n,e);return{x:i,y:o,id:`${t.id}:${r}`}})})}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){let{editor:e}=this,t=e.getRenderingBounds(),n=e.getSelectedShapeIds(),r=[],i=o=>{if(nF(o)){let t=e.getShape(o);t&&e.isShapeOfType(t,"frame")&&r.push({id:o,pageBounds:e.getShapePageBounds(o),isClosed:e.getShapeGeometry(t).isClosed})}for(let s of e.getSortedChildIdsForParent(o)){if(n.includes(s))continue;let o=e.getShape(s);if(!o||!e.getShapeUtil(o).canSnap(o))continue;let a=e.getShapePageBounds(s);if(a&&t.includes(a)){if(e.isShapeOfType(o,"group")){i(s);continue}r.push({id:s,pageBounds:a,isClosed:e.getShapeGeometry(o).isClosed})}}};return i(this.getCurrentCommonAncestor()??e.getCurrentPageId()),r}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}getSnappablePoints(){let e=this.getSnapPointsCache(),t=this.getSnappableShapes(),n=[];return t.forEach(t=>{let r=e.get(t.id);r&&n.push(...r)}),n}getVisibleGaps(){var e,t,n,r,i,o;let s,a;let l=[],d=[],c=this.getSnappableShapes().sort((e,t)=>e.pageBounds.minX-t.pageBounds.minX);for(let r=0;r<c.length;r++){s=c[r];for(let i=r+1;i<c.length;i++)a=c[i],s.pageBounds.maxX<a.pageBounds.minX&&(e=s.pageBounds.minY,t=s.pageBounds.maxY,n=a.pageBounds.minY,e<a.pageBounds.maxY&&n<t)&&l.push({startNode:s,endNode:a,startEdge:[new rG(s.pageBounds.maxX,s.pageBounds.minY),new rG(s.pageBounds.maxX,s.pageBounds.maxY)],endEdge:[new rG(a.pageBounds.minX,a.pageBounds.minY),new rG(a.pageBounds.minX,a.pageBounds.maxY)],length:a.pageBounds.minX-s.pageBounds.maxX,breadthIntersection:ir(s.pageBounds.minY,s.pageBounds.maxY,a.pageBounds.minY,a.pageBounds.maxY)})}let u=c.sort((e,t)=>e.pageBounds.minY-t.pageBounds.minY);for(let e=0;e<u.length;e++){s=u[e];for(let t=e+1;t<u.length;t++)a=u[t],s.pageBounds.maxY<a.pageBounds.minY&&(r=s.pageBounds.minX,i=s.pageBounds.maxX,o=a.pageBounds.minX,r<a.pageBounds.maxX&&o<i)&&d.push({startNode:s,endNode:a,startEdge:[new rG(s.pageBounds.minX,s.pageBounds.maxY),new rG(s.pageBounds.maxX,s.pageBounds.maxY)],endEdge:[new rG(a.pageBounds.minX,a.pageBounds.minY),new rG(a.pageBounds.maxX,a.pageBounds.minY)],length:a.pageBounds.minY-s.pageBounds.maxY,breadthIntersection:ir(s.pageBounds.minX,s.pageBounds.maxX,a.pageBounds.minX,a.pageBounds.maxX)})}return{horizontal:l,vertical:d}}snapTranslate({lockedAxis:e,initialSelectionPageBounds:t,initialSelectionSnapPoints:n,dragDelta:r}){let i=this.getSnapThreshold(),o=this.getSnappablePoints(),s=t.clone().translate(r),a=n.map(({x:e,y:t},n)=>({id:"selection:"+n,x:e+r.x,y:t+r.y})),l=[],d=[],c=new rG(i,i);this.collectPointSnaps({minOffset:c,nearestSnapsX:l,nearestSnapsY:d,otherNodeSnapPoints:o,selectionSnapPoints:a}),this.collectGapSnaps({selectionPageBounds:s,nearestSnapsX:l,nearestSnapsY:d,minOffset:c});let u=new rG("x"===e?0:l[0]?.nudge??0,"y"===e?0:d[0]?.nudge??0);c.x=0,c.y=0,l.length=0,d.length=0,a.forEach(e=>{e.x+=u.x,e.y+=u.y}),s.translate(u),this.collectPointSnaps({minOffset:c,nearestSnapsX:l,nearestSnapsY:d,otherNodeSnapPoints:o,selectionSnapPoints:a}),this.collectGapSnaps({selectionPageBounds:s,nearestSnapsX:l,nearestSnapsY:d,minOffset:c});let h=this.getPointSnapLines({nearestSnapsX:l,nearestSnapsY:d}),p=this.getGapSnapLines({selectionPageBounds:s,nearestSnapsX:l,nearestSnapsY:d});return this._snapLines.set([...p,...h]),{nudge:u}}getOutlinesInPageSpace(){return this.getSnappableShapes().map(({id:e,isClosed:t})=>{let n=eU(this.editor.getShapeGeometry(e).vertices);t&&n.push(n[0]);let r=this.editor.getShapePageTransform(e);if(!r)throw Error("No page transform");return oj.applyToPoints(r,n)})}getSnappingHandleDelta({handlePoint:e,additionalSegments:t}){let n,r,i,o;let s=this.getSnapThreshold(),a=this.getOutlinesInPageSpace(),l=s,d=null;for(let s of[...a,...t])for(let t=0;t<s.length-1;t++)n=s[t],r=s[t+1],i=rG.NearestPointOnLineSegment(n,r,e),!isNaN(o=rG.Dist(e,i))&&o<l&&(l=o,d=i);return d?(this._snapLines.set([{id:ss(),type:"points",points:[d]}]),rG.Sub(d,e)):null}snapResize({initialSelectionPageBounds:e,dragDelta:t,handle:n,isAspectRatioLocked:r,isResizingFromCenter:i}){var o;let s=this.getSnapThreshold(),{box:a,scaleX:l,scaleY:d}=oE.Resize(e,n,i?2*t.x:t.x,i?2*t.y:t.y,r),c=n;l<0&&(c=function(e){switch(e){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return e}}(c)),d<0&&(c=function(e){switch(e){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return e}}(c)),i&&(a.center=e.center);let u="top"===c||"bottom"===c,h="left"===c||"right"===c,p=ax(c,a),g=this.getSnappablePoints(),f=[],m=[],y=new rG(s,s);this.collectPointSnaps({minOffset:y,nearestSnapsX:f,nearestSnapsY:m,otherNodeSnapPoints:g,selectionSnapPoints:p});let b=new rG(u?0:f[0]?.nudge??0,h?0:m[0]?.nudge??0);if(r&&("top_left"===(o=c)||"top_right"===o||"bottom_right"===o||"bottom_left"===o)&&0!==b.len()){let t=f.length&&m.length?Math.abs(b.x)<Math.abs(b.y)?"x":"y":f.length?"x":"y",n=e.aspectRatio;"x"===t?(m.length=0,b.y=b.x/n,("bottom_left"===c||"top_right"===c)&&(b.y=-b.y)):(f.length=0,b.x=b.y*n,("bottom_left"===c||"top_right"===c)&&(b.x=-b.x))}let v=rG.Add(t,b),{box:x}=oE.Resize(e,n,i?2*v.x:v.x,i?2*v.y:v.y,r);i&&(x.center=e.center);let S=ax("any",x);f.length=0,m.length=0,y.x=0,y.y=0,this.collectPointSnaps({minOffset:y,nearestSnapsX:f,nearestSnapsY:m,otherNodeSnapPoints:g,selectionSnapPoints:S});let w=this.getPointSnapLines({nearestSnapsX:f,nearestSnapsY:m});return this._snapLines.set([...w]),{nudge:b}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:t,minOffset:n,nearestSnapsX:r,nearestSnapsY:i}){for(let o of e)for(let e of t){let t=rG.Sub(o,e),s=Math.abs(t.x),a=Math.abs(t.y);ay(s)<=ay(n.x)&&(ay(s)<ay(n.x)&&(r.length=0),r.push({type:"points",points:{thisPoint:o,otherPoint:e},nudge:e.x-o.x}),n.x=s),ay(a)<=ay(n.y)&&(ay(a)<ay(n.y)&&(i.length=0),i.push({type:"points",points:{thisPoint:o,otherPoint:e},nudge:e.y-o.y}),n.y=a)}}collectGapSnaps({selectionPageBounds:e,minOffset:t,nearestSnapsX:n,nearestSnapsY:r}){var i,o,s,a,l,d,c,u,h;let{horizontal:p,vertical:g}=this.getVisibleGaps();for(let r of p){if(i=r.breadthIntersection[0],o=r.breadthIntersection[1],s=e.minY,!(i<e.maxY)||!(s<o))continue;let a=r.startEdge[0].x+r.length/2-e.center.x;if(r.length>e.width&&ay(Math.abs(a))<=ay(t.x)){ay(Math.abs(a))<ay(t.x)&&(n.length=0),t.x=Math.abs(a);let e={type:"gap_center",gap:r,nudge:a},i=n.find(({type:e})=>"gap_center"===e),o=i&&ir(r.breadthIntersection[0],r.breadthIntersection[1],i.gap.breadthIntersection[0],i.gap.breadthIntersection[1]);i&&i.gap.length>r.length&&o?n[n.indexOf(i)]=e:i&&o||n.push(e)}let l=r.startNode.pageBounds.minX-r.length-e.maxX;ay(Math.abs(l))<=ay(t.x)&&(ay(Math.abs(l))<ay(t.x)&&(n.length=0),t.x=Math.abs(l),n.push({type:"gap_duplicate",gap:r,protrusionDirection:"left",nudge:l}));let d=r.endNode.pageBounds.maxX+r.length-e.minX;ay(Math.abs(d))<=ay(t.x)&&(ay(Math.abs(d))<ay(t.x)&&(n.length=0),t.x=Math.abs(d),n.push({type:"gap_duplicate",gap:r,protrusionDirection:"right",nudge:d}))}for(let n of g){if(a=n.breadthIntersection[0],l=n.breadthIntersection[1],d=e.minX,!(a<e.maxX)||!(d<l))continue;let i=n.startEdge[0].y+n.length/2-e.center.y;if(n.length>e.height&&ay(Math.abs(i))<=ay(t.y)){ay(Math.abs(i))<ay(t.y)&&(r.length=0),t.y=Math.abs(i);let e={type:"gap_center",gap:n,nudge:i},o=r.find(({type:e})=>"gap_center"===e),s=o&&(c=o.gap.breadthIntersection[0],u=o.gap.breadthIntersection[1],h=n.breadthIntersection[0],c<n.breadthIntersection[1]&&h<u);o&&o.gap.length>n.length&&s?r[r.indexOf(o)]=e:o&&s||r.push(e);continue}let o=n.startNode.pageBounds.minY-n.length-e.maxY;ay(Math.abs(o))<=ay(t.y)&&(ay(Math.abs(o))<ay(t.y)&&(r.length=0),t.y=Math.abs(o),r.push({type:"gap_duplicate",gap:n,protrusionDirection:"top",nudge:o}));let s=n.endNode.pageBounds.maxY+n.length-e.minY;ay(Math.abs(s))<=ay(t.y)&&(ay(Math.abs(s))<ay(t.y)&&(r.length=0),t.y=Math.abs(s),r.push({type:"gap_duplicate",gap:n,protrusionDirection:"bottom",nudge:s}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:t}){let n={},r={};if(e.length>0){for(let t of e)if("points"===t.type){let e=ay(t.points.otherPoint.x);n[e]||(n[e]=[]),n[e].push(t.points)}}if(t.length>0){for(let e of t)if("points"===e.type){let t=ay(e.points.otherPoint.y);r[t]||(r[t]=[]),r[t].push(e.points)}}return Object.values(n).concat(Object.values(r)).map(e=>({id:ss(),type:"points",points:eP(e.map(e=>rG.From(e.otherPoint)).concat(e.map(e=>rG.From(e.thisPoint))),(e,t)=>e.equals(t))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:t,nearestSnapsY:n}){let{vertical:r,horizontal:i}=this.getVisibleGaps(),o={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},s=[];if(t.length>0)for(let n of t){if("points"===n.type)continue;let{gap:{breadthIntersection:t,startEdge:r,startNode:a,endNode:l,length:d,endEdge:c}}=n;switch(n.type){case"gap_center":{let n=(d-e.width)/2,u=ir(t[0],t[1],e.minY,e.maxY);s.push({type:"gaps",direction:"horizontal",id:ss(),gaps:[...ab(i,a.id,n,"backward",u),{startEdge:r,endEdge:o.left},{startEdge:o.right,endEdge:c},...ab(i,l.id,n,"forward",u)]});break}case"gap_duplicate":{let u=ir(t[0],t[1],e.minY,e.maxY);s.push({type:"gaps",direction:"horizontal",id:ss(),gaps:"left"===n.protrusionDirection?[{startEdge:o.right,endEdge:r.map(e=>e.clone().addXY(-a.pageBounds.width,0))},{startEdge:r,endEdge:c},...ab(i,l.id,d,"forward",u)]:[...ab(i,a.id,d,"backward",u),{startEdge:r,endEdge:c},{startEdge:c.map(e=>e.clone().addXY(n.gap.endNode.pageBounds.width,0)),endEdge:o.left}]})}}}if(n.length>0)for(let t of n){if("points"===t.type)continue;let{gap:{breadthIntersection:n,startEdge:i,startNode:a,endNode:l,length:d,endEdge:c}}=t;switch(t.type){case"gap_center":{let l=(d-e.height)/2,u=ir(n[0],n[1],e.minX,e.maxX);s.push({type:"gaps",direction:"vertical",id:ss(),gaps:[...ab(r,a.id,l,"backward",u),{startEdge:i,endEdge:o.top},{startEdge:o.bottom,endEdge:c},...ab(r,t.gap.endNode.id,l,"forward",u)]});break}case"gap_duplicate":{let u=ir(n[0],n[1],e.minX,e.maxX);s.push({type:"gaps",direction:"vertical",id:ss(),gaps:"top"===t.protrusionDirection?[{startEdge:o.bottom,endEdge:i.map(e=>e.clone().addXY(0,-a.pageBounds.height))},{startEdge:i,endEdge:c},...ab(r,l.id,d,"forward",u)]:[...ab(r,a.id,d,"backward",u),{startEdge:i,endEdge:c},{startEdge:c.map(e=>e.clone().addXY(0,l.pageBounds.height)),endEdge:o.top}]})}}}return function(e){e.sort((e,t)=>t.gaps.length-e.gaps.length);for(let t=e.length-1;t>0;t--){let n=e[t];for(let r=t-1;r>=0;r--){let i=e[r];if(i.direction===n.direction&&n.gaps.every(e=>i.gaps.some(t=>ay(e.startEdge[0].x)===ay(t.startEdge[0].x)&&ay(e.startEdge[0].y)===ay(t.startEdge[0].y)&&ay(e.startEdge[1].x)===ay(t.startEdge[1].x)&&ay(e.startEdge[1].y)===ay(t.startEdge[1].y))&&i.gaps.some(t=>ay(e.endEdge[0].x)===ay(t.endEdge[0].x)&&ay(e.endEdge[0].y)===ay(t.endEdge[0].y)&&ay(e.endEdge[1].x)===ay(t.endEdge[1].x)&&ay(e.endEdge[1].y)===ay(t.endEdge[1].y)))){e.splice(t,1);break}}}}(s),s}}function ax(e,t){let{minX:n,maxX:r,minY:i,maxY:o}=t,s=[];switch(e){case"top":case"left":case"top_left":case"any":s.push({id:"top_left",handle:"top_left",x:n,y:i})}switch(e){case"top":case"right":case"top_right":case"any":s.push({id:"top_right",handle:"top_right",x:r,y:i})}switch(e){case"bottom":case"right":case"bottom_right":case"any":s.push({id:"bottom_right",handle:"bottom_right",x:r,y:o})}switch(e){case"bottom":case"left":case"bottom_left":case"any":s.push({id:"bottom_left",handle:"bottom_left",x:n,y:o})}return s}am([ep],av.prototype,"getSnapPointsCache",1),am([ep],av.prototype,"getSnapThreshold",1),am([ep],av.prototype,"getSnappableShapes",1),am([ep],av.prototype,"getCurrentCommonAncestor",1),am([ep],av.prototype,"getSnappablePoints",1),am([ep],av.prototype,"getVisibleGaps",1),am([ep],av.prototype,"getOutlinesInPageSpace",1);let aS=/\r?\n|\r/g;function aw(e){return e.replace(aS,"\n").split("\n").map(e=>e||" ").join("\n")}let aC={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},a_=/\s/;class ak{constructor(e){this.editor=e;let t=document.createElement("div");t.id="tldraw_text_measure",t.classList.add("tl-text"),t.classList.add("tl-text-measure"),t.tabIndex=-1,this.editor.getContainer().appendChild(t),this.baseElm=t}baseElm;measureText=(e,t)=>{let n=this.baseElm?.cloneNode();this.baseElm.insertAdjacentElement("afterend",n),n.setAttribute("dir","ltr"),n.style.setProperty("font-family",t.fontFamily),n.style.setProperty("font-style",t.fontStyle),n.style.setProperty("font-weight",t.fontWeight),n.style.setProperty("font-size",t.fontSize+"px"),n.style.setProperty("line-height",t.lineHeight*t.fontSize+"px"),n.style.setProperty("max-width",null===t.maxWidth?null:t.maxWidth+"px"),n.style.setProperty("min-width",t.minWidth??null),n.style.setProperty("padding",t.padding),n.textContent=aw(e);let r=n.getBoundingClientRect();return n.remove(),{x:0,y:0,w:r.width,h:r.height}};measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:t=!1}={}){let n=[],r=e.getBoundingClientRect(),i=-r.left,o=-r.top,s=new Range,a=e.childNodes[0],l=0,d=null,c=null,u=0,h=!1;for(let r of e.childNodes)if(r.nodeType===Node.TEXT_NODE)for(let e of r.textContent??""){s.setStart(a,l),s.setEnd(a,l+e.length);let r=s.getClientRects(),p=r[r.length-1],g=p.top+o,f=p.left+i,m=p.right+i,y=a_.test(e);if(y===c&&g===u&&d)d.box.w=m-d.box.x,d.text+=e;else{if(d){if(t&&g!==u){h=!0;break}n.push(d)}d={box:{x:f,y:g,w:p.width,h:p.height},text:e}}c=y,u=g,l+=e.length}return d&&n.push(d),{spans:n,didTruncate:h}}measureTextSpans(e,t){if(""===e)return[];let n=this.baseElm?.cloneNode();this.baseElm.insertAdjacentElement("afterend",n);let r=Math.ceil(t.width-2*t.padding);n.style.setProperty("width",`${r}px`),n.style.setProperty("height","min-content"),n.style.setProperty("dir","ltr"),n.style.setProperty("font-size",`${t.fontSize}px`),n.style.setProperty("font-family",t.fontFamily),n.style.setProperty("font-weight",t.fontWeight),n.style.setProperty("line-height",`${t.lineHeight*t.fontSize}px`),n.style.setProperty("text-align",aC[t.textAlign]);let i="truncate-ellipsis"===t.overflow||"truncate-clip"===t.overflow;i&&(n.style.setProperty("overflow-wrap","anywhere"),n.style.setProperty("word-break","break-all"));let o=aw(e);n.textContent=o;let{spans:s,didTruncate:a}=this.measureElementTextNodeSpans(n,{shouldTruncateToFirstLine:i});if("truncate-ellipsis"===t.overflow&&a){n.textContent="";let e=Math.ceil(this.measureElementTextNodeSpans(n).spans[0].box.w);n.style.setProperty("width",`${r-e}px`),n.textContent=o;let i=this.measureElementTextNodeSpans(n,{shouldTruncateToFirstLine:!0}).spans,s=i[i.length-1];return i.push({text:"",box:{x:Math.min(s.box.x+s.box.w,t.width-t.padding-e),y:s.box.y,w:e,h:s.box.h}}),i}return n.remove(),s}}class aP{constructor(e){this.editor=e,this.editor.disposables.add(this.dispose),this.start()}raf;isPaused=!0;last=0;t=0;start=()=>{this.isPaused=!1,cancelAnimationFrame(this.raf),this.raf=requestAnimationFrame(this.tick),this.last=Date.now()};tick=()=>{if(this.isPaused)return;let e=Date.now(),t=e-this.last;if(this.last=e,this.t+=t,this.editor.emit("frame",t),this.t<16){this.raf=requestAnimationFrame(this.tick);return}this.t-=16,this.updatePointerVelocity(t),this.editor.emit("tick",t),this.raf=requestAnimationFrame(this.tick)};dispose=()=>{this.isPaused=!0,cancelAnimationFrame(this.raf)};prevPoint=new rG;updatePointerVelocity=e=>{let{prevPoint:t,editor:{inputs:{currentScreenPoint:n,pointerVelocity:r}}}=this;if(0===e)return;let i=rG.Sub(n,t);this.prevPoint=n.clone();let o=i.len(),s=o?i.div(o):new rG(0,0),a=r.clone().lrp(s.mul(o/e),.5);.01>Math.abs(a.x)&&(a.x=0),.01>Math.abs(a.y)&&(a.y=0),r.equals(a)||(this.editor.inputs.pointerVelocity=a)}}var aI=Object.defineProperty,aE=Object.getOwnPropertyDescriptor,aj=(e,t,n,r)=>{for(var i,o=r>1?void 0:r?aE(t,n):t,s=e.length-1;s>=0;s--)(i=e[s])&&(o=(r?i(t,n,o):i(o))||o);return r&&o&&aI(t,n,o),o};class aM{constructor(e,t){this.user=e,this.inferDarkMode=t}updateUserPreferences=e=>{this.user.setUserPreferences({...this.user.userPreferences.get(),...e})};getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),isDarkMode:this.getIsDarkMode(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode()}}getIsDarkMode(){return this.user.userPreferences.get().isDarkMode??(!!this.inferDarkMode&&"undefined"!=typeof window&&(window.matchMedia?.("(prefers-color-scheme: dark)")?.matches??!1))}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??sh.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??sh.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name??sh.name}getLocale(){return this.user.userPreferences.get().locale??sh.locale}getColor(){return this.user.userPreferences.get().color??sh.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??sh.isSnapMode}}function aT(e){return 8>Math.abs(e.props.bend)}function aA(e,t){if("point"===t.type)return;let n=e.getShape(t.boundShapeId),r=e.getShapePageTransform(n),i=e.getShapeGeometry(n),o=i instanceof oT?i.children[0].vertices:i.vertices;return{shape:n,transform:r,isClosed:i.isClosed,isExact:t.isExact,didIntersect:!1,outline:o}}function aO(e,t,n,r){if("point"===n.type)return rG.From(n);let i=e.getShape(n.boundShapeId);if(!i)return new rG(0,0);{let{point:o,size:s}=e.getShapeGeometry(i).bounds,a=rG.Add(o,rG.MulV(n.isPrecise||r?n.normalizedAnchor:{x:.5,y:.5},s)),l=oj.applyToPoint(e.getShapePageTransform(i),a);return oj.applyToPoint(oj.Inverse(t),l)}}function aR(e,t){let n,r;let i=e.getShapePageTransform(t);"binding"===t.props.start.type&&"binding"===t.props.end.type&&(n=t.props.start.boundShapeId,r=t.props.end.boundShapeId);let o=aD(e,n,r);return{start:aO(e,i,t.props.start,"double-bound"===o||"start-contains-end"===o),end:aO(e,i,t.props.end,"double-bound"===o||"end-contains-start"===o)}}aj([ep],aM.prototype,"getUserPreferences",1),aj([ep],aM.prototype,"getIsDarkMode",1),aj([ep],aM.prototype,"getEdgeScrollSpeed",1),aj([ep],aM.prototype,"getAnimationSpeed",1),aj([ep],aM.prototype,"getId",1),aj([ep],aM.prototype,"getName",1),aj([ep],aM.prototype,"getLocale",1),aj([ep],aM.prototype,"getColor",1),aj([ep],aM.prototype,"getIsSnapMode",1);let aL={s:2,m:3.5,l:5,xl:10};function aD(e,t,n){if(!t||!n)return"safe";if(t===n)return"double-bound";let r=e.getShapePageBounds(t),i=e.getShapePageBounds(n);if(r&&i){if(r.contains(i))return"start-contains-end";if(i.contains(r))return"end-contains-start"}return"safe"}function az(e,t){let{start:n,end:r,arrowheadStart:i,arrowheadEnd:o}=t.props,s=aR(e,t),a=s.start.clone(),l=s.end.clone(),d=rG.Med(a,l);if(rG.Equals(a,l))return{isStraight:!0,start:{handle:a,point:a,arrowhead:t.props.arrowheadStart},end:{handle:l,point:l,arrowhead:t.props.arrowheadEnd},middle:d,isValid:!1,length:0};let c=rG.Sub(l,a).uni(),u=aA(e,n),h=aA(e,r),p=e.getShapePageTransform(t);aN(l,s.start,p,h),aN(a,s.end,p,u);let g=0,f=0,m=0,y=0,b=10,v=u&&h&&u.shape===h.shape,x=u&&h?aD(e,u.shape.id,h.shape.id):"safe";"safe"===x&&u&&h&&!v&&!u.isExact&&!h.isExact&&(h.didIntersect&&!u.didIntersect?u.isClosed&&a.setTo(l.clone().add(c.clone().mul(10))):!h.didIntersect&&h.isClosed&&l.setTo(a.clone().sub(c.clone().mul(10))));let S=rG.Sub(l,a).uni(),w=!rG.Equals(S,c);v||("start-contains-end"!==x&&u&&"none"!==i&&!u.isExact&&(g=10+(m=aL[t.props.size]/2+("size"in u.shape.props?aL[u.shape.props.size]/2:0)),b+=m),"end-contains-start"===x||!h||"none"===o||h.isExact||(f=10+(y=aL[t.props.size]/2+("size"in h.shape.props?aL[h.shape.props.size]/2:0)),b+=y));let C=a.clone().add(S.clone().mul(g*(w?-1:1))),_=l.clone().sub(S.clone().mul(f*(w?-1:1)));rG.Dist(C,_)<b&&(0!==g&&0!==f?(g*=-1.5,f*=-1.5):0!==g?g*=-1:0!==f&&(f*=-1)),a.add(S.clone().mul(g*(w?-1:1))),l.sub(S.clone().mul(f*(w?-1:1))),w?(u&&h&&l.setTo(rG.Add(a,S.clone().mul(-10))),d.setTo(rG.Med(s.start,s.end))):d.setTo(rG.Med(a,l));let k=rG.Dist(a,l);return{isStraight:!0,start:{handle:s.start,point:a,arrowhead:t.props.arrowheadStart},end:{handle:s.end,point:l,arrowhead:t.props.arrowheadEnd},middle:d,isValid:k>0,length:k}}function aN(e,t,n,r){let i;if(void 0===r||r.isExact)return;let o=oj.applyToPoint(n,t),s=oj.applyToPoint(n,e),a=oj.applyToPoint(oj.Inverse(r.transform),o),l=oj.applyToPoint(oj.Inverse(r.transform),s),d=r.isClosed,c=(d?function(e,t,n){let r;let i=[];for(let o=1,s=n.length;o<s+1;o++)(r=s_(e,t,n[o-1],n[o%n.length]))&&i.push(r);return 0===i.length?null:i}:sP)(a,l,r.outline);if(null!==c&&(i=c.sort((e,t)=>rG.Dist(e,a)-rG.Dist(t,a))[0]??(d?void 0:l)),void 0===i)return;let u=oj.applyToPoint(r.transform,i),h=oj.applyToPoint(oj.Inverse(n),u);e.setTo(h),r.didIntersect=!0}function a$(e,t,n=0){let{arrowheadEnd:r,arrowheadStart:i}=t.props,o=t.props.bend+n;if(Math.abs(o)>Math.abs(10*t.props.bend))return az(e,t);let s=aR(e,t),a=rG.Med(s.start,s.end),l=rG.Sub(s.end,s.start).uni(),d=rG.Add(a,l.per().mul(-o)),c=aA(e,t.props.start),u=aA(e,t.props.end),h=s.start.clone(),p=s.end.clone(),g=d.clone();if(rG.Equals(h,p))return{isStraight:!0,start:{handle:h,point:h,arrowhead:t.props.arrowheadStart},end:{handle:p,point:p,arrowhead:t.props.arrowheadEnd},middle:g,isValid:!1,length:0};let f=t.props.bend<0,m=f?r9:r7,y=aF(h,p,g),b=rG.Angle(y.center,h),v=m(b,rG.Angle(y.center,p));if(0===y.length||0===y.size||!il(y.length)||!il(y.size))return az(e,t);let x=h.clone(),S=p.clone(),w=g.clone(),C=e.getShapePageTransform(t),_=0,k=0,P=10;if(c&&!c.isExact){let n;let r=oj.applyToPoint(C,x),o=oj.applyToPoint(C,y.center),s=oj.applyToPoint(C,S),a=oj.Inverse(c.transform),l=oj.applyToPoint(a,r),d=oj.applyToPoint(a,o),u=oj.applyToPoint(a,s),{isClosed:h}=c,p=(h?sI:sE)(d,y.radius,c.outline);if(p){let e=d.angle(l),t=m(e,d.angle(u));p=p.filter(n=>m(e,d.angle(n))<=t);let r=.25*t;p.sort(h?(t,n)=>Math.abs(m(e,d.angle(t))-r)<Math.abs(m(e,d.angle(n))-r)?-1:1:(t,n)=>m(e,d.angle(t))<m(e,d.angle(n))?-1:1),n=p[0]??(h?void 0:l)}else n=h?void 0:l;if(n&&(x.setTo(e.getPointInShapeSpace(t,oj.applyToPoint(c.transform,n))),c.didIntersect=!0,"none"!==i)){let e=aL[t.props.size]/2+("size"in c.shape.props?aL[c.shape.props.size]/2:0);_=10+e,P+=e}}if(u&&!u.isExact){let n;let i=oj.applyToPoint(C,x),o=oj.applyToPoint(C,S),s=oj.applyToPoint(C,y.center),a=oj.Inverse(u.transform),l=oj.applyToPoint(a,i),d=oj.applyToPoint(a,s),c=oj.applyToPoint(a,o),h=u.isClosed,p=(h?sI:sE)(d,y.radius,u.outline);if(p){let e=d.angle(l),t=m(e,d.angle(c)),r=.75*t;(p=p.filter(n=>m(e,d.angle(n))<=t)).sort(h?(t,n)=>Math.abs(m(e,d.angle(t))-r)<Math.abs(m(e,d.angle(n))-r)?-1:1:(t,n)=>m(e,d.angle(t))<m(e,d.angle(n))?-1:1),n=p[0]?p[0]:h?void 0:c}else n=h?void 0:c;if(n&&(S.setTo(e.getPointInShapeSpace(t,oj.applyToPoint(u.transform,n))),u.didIntersect=!0,"none"!==r)){let e=aL[t.props.size]/2+("size"in u.shape.props?aL[u.shape.props.size]/2:0);k=10+e,P+=e}}let I=rG.Angle(y.center,x),E=rG.Angle(y.center,S),j=m(I,E),M=j*y.radius,T=x.clone(),A=S.clone();if(0!==_){let e=_/M*(f?1:-1),t=rG.FromAngle(I+j*e);T.setTo(y.center).add(t.mul(y.radius))}if(0!==k){let e=k/M*(f?-1:1),t=rG.FromAngle(E+j*e);A.setTo(y.center).add(t.mul(y.radius))}if(rG.Dist(T,A)<P&&(0!==_&&0!==k?(_*=-1.5,k*=-1.5):0!==_?_*=-2:0!==k&&(k*=-2)),0!==_){let e=_/M*(f?1:-1),t=rG.FromAngle(I+j*e);x.setTo(y.center).add(t.mul(y.radius))}if(0!==k){let e=k/M*(f?-1:1),t=rG.FromAngle(E+j*e);S.setTo(y.center).add(t.mul(y.radius))}if(c&&u&&!c.isExact&&!u.isExact){M=(j=m(I=rG.Angle(y.center,x),E=rG.Angle(y.center,S)))*y.radius;let t=aD(e,c.shape.id,u.shape.id);if("double-bound"===t&&M<30)x.setTo(h),S.setTo(p),w.setTo(g);else if("safe"===t&&(c&&!c.didIntersect&&x.setTo(h),u&&!u.didIntersect||m(b,I)>m(b,E))){let e=Math.min(.9,10/M)*(f?1:-1),t=rG.FromAngle(I+j*e);S.setTo(y.center).add(t.mul(y.radius))}}(function(e,t,n,r,i,o,s){let a=rG.Angle(e,n),l=r9(a,rG.Angle(e,r));s||(l=r1-l);let d=rG.FromAngle(a+.5*(s?1:-1)*l);if(i.setTo(e).add(d.mul(t)),l>o){i.rotWith(e,rQ);let t=r.clone();r.setTo(n),n.setTo(t)}})(y.center,y.radius,x,S,w,v,f),x.equals(S)&&(x.setTo(w.clone().addXY(1,1)),S.setTo(w.clone().subXY(1,1))),h.setTo(x),p.setTo(S),g.setTo(w);let O=aF(h,p,g);return{isStraight:!1,start:{point:h,handle:s.start,arrowhead:t.props.arrowheadStart},end:{point:p,handle:s.end,arrowhead:t.props.arrowheadEnd},middle:g,handleArc:y,bodyArc:O,isValid:0!==O.length&&isFinite(O.center.x)&&isFinite(O.center.y)}}function aF(e,t,n){let r=-2*(e.x*(t.y-n.y)-e.y*(t.x-n.x)+t.x*n.y-n.x*t.y),i={x:((e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y)+(n.x*n.x+n.y*n.y)*(t.y-e.y))/r,y:((e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x)+(n.x*n.x+n.y*n.y)*(e.x-t.x))/r},o=rG.Dist(i,e),s=+rG.Clockwise(e,n,t),a=Math.hypot(e.y-t.y,e.x-t.x),l=Math.hypot(t.y-n.y,t.x-n.x),d=Math.hypot(n.y-e.y,n.x-e.x),c=2*Math.acos((l*l+d*d-a*a)/(2*l*d)),u=+(rQ>c),h=(r1-c)*(s?1:-1);return{center:i,radius:o,size:h,length:h*o,largeArcFlag:u,sweepFlag:s}}let aB={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick"};class aV{constructor(e,t){this.editor=e;let{id:n,children:r,initial:i}=this.constructor;this.id=n,this._isActive=er("toolIsActive"+this.id,!1),this._current=er("toolState"+this.id,void 0),this._path=ep("toolPath"+this.id,()=>{let e=this.getCurrent();return this.id+(e?`.${e.getPath()}`:"")}),this.parent=t??{},this.parent?r&&i?(this.type="branch",this.initial=i,this.children=Object.fromEntries(r().map(e=>[e.id,new e(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",r&&i&&(this.initial=i,this.children=Object.fromEntries(r().map(e=>[e.id,new e(this.editor,this)])),this._current.set(this.children[this.initial])))}static id;static initial;static children;id;type;shapeType;initial;children;parent;getPath(){return this._path.get()}_path;getCurrent(){return this._current.get()}_current;getIsActive(){return this._isActive.get()}_isActive;transition=(e,t={})=>{let n=e.split("."),r=this;for(let e=0;e<n.length;e++){let i=n[e],o=r.getCurrent(),s=r.children?.[i];if(!s)throw Error(`${r.id} - no child state exists with the id ${i}.`);if(o?.id!==s.id&&(o?.exit(t,i),r._current.set(s),s.enter(t,o?.id||"initial"),!s.getIsActive()))break;r=s}return this};handleEvent=e=>{let t=aB[e.name],n=this.getCurrent();this[t]?.(e),this.getCurrent()===n&&this.getIsActive()&&n?.handleEvent(e)};enter=(e,t)=>{if(this._isActive.set(!0),this.onEnter?.(e,t),this.onTick&&this.editor.on("tick",this.onTick),this.children&&this.initial&&this.getIsActive()){let n=this.children[this.initial];this._current.set(n),n.enter(e,t)}};exit=(e,t)=>{this._isActive.set(!1),this.onTick&&this.editor.off("tick",this.onTick),this.onExit?.(e,t),this.getIsActive()||this.getCurrent()?.exit(e,t)};_currentToolIdMask=er("curent tool id mask",void 0);getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}onWheel;onPointerDown;onPointerMove;onPointerUp;onDoubleClick;onTripleClick;onQuadrupleClick;onRightClick;onMiddleClick;onKeyDown;onKeyUp;onKeyRepeat;onCancel;onComplete;onInterrupt;onEnter;onExit;onTick}class aU extends aV{static id="root";static initial="";static children=()=>[];onKeyDown=e=>{if("KeyZ"===e.code&&!(e.shiftKey||e.ctrlKey)){let t=this.getCurrent();t&&t.getCurrent()?.id==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...e,onInteractionEnd:t.id})}}}var aK=Object.defineProperty,aH=Object.getOwnPropertyDescriptor,aY=(e,t,n,r)=>{for(var i,o=r>1?void 0:r?aH(t,n):t,s=e.length-1;s>=0;s--)(i=e[s])&&(o=(r?i(t,n,o):i(o))||o);return r&&o&&aK(t,n,o),o};class aW extends sw.EventEmitter{constructor({store:e,user:t,shapeUtils:n,tools:r,getContainer:i,initialState:o,inferDarkMode:s}){super(),this.store=e,this.snaps=new av(this),this.user=new aM(t??sS(),s??!1),this.getContainer=i??(()=>document.body),this.textMeasure=new ak(this);class a extends aU{static initial=o??""}this.root=new a(this),this.root.children={};let l=sV(n),d=new Set(Object.keys(e.schema.types.shape.migrations.subTypeMigrations));for(let e of l){if(!d.has(e.type))throw Error(`Editor and store have different shapes: "${e.type}" was passed into the editor but not the schema`);d.delete(e.type)}if(d.size>0)throw Error(`Editor and store have different shapes: "${[...d][0]}" is present in the store schema but not provided to the editor`);let c={},u={},h=new Map;for(let e of l){let t=new e(this);c[e.type]=t;let n=nV(e.props??{});for(let t of(u[e.type]=n,n.keys()))if(h.has(t.id)){if(h.get(t.id)!==t)throw Error(`Multiple style props with id "${t.id}" in use. Style prop IDs must be unique.`)}else h.set(t.id,t)}for(let e of(this.shapeUtils=c,this.styleProps=u,[...r])){if(eB(this.root.children,e.id))throw Error(`Can't override tool with id "${e.id}"`);this.root.children[e.id]=new e(this,this.root)}this.environment=new ao(this),this.scribbles=new au(this);let p=new Set,g=e=>{let t,n,r;let i=this.getShape(e);if(!i)return;let{start:o,end:s}=i.props,a="binding"===o.type?this.getShape(o.boundShapeId):void 0,l="binding"===s.type?this.getShape(s.boundShapeId):void 0,d=this.getAncestorPageId(i);if(!d)return;if(a&&l)t=this.findCommonAncestor([a,l])??d;else{if(!a&&!l)return;let e=(a||l)?.parentId;t=e&&e===i.parentId?i.parentId:d}t&&t!==i.parentId&&this.reparentShapes([e],t);let c=this.getShape(e);if(!c)throw Error("no reparented arrow");let u=this.getShapeNearestSibling(c,a),h=this.getShapeNearestSibling(c,l);if(u&&h)n=u.index>h.index?u:h;else if(u&&!h)n=u;else{if(!h||u)return;n=h}let p=this.getSortedChildIdsForParent(n.parentId).map(e=>this.getShape(e)).filter(e=>e.index>n.index);if(p.length){let e=p.find(e=>"arrow"!==e.type);if(c.index>n.index&&(!e||c.index<e.index))return;r=s4(n.index,p[0].index)}else r=s6(n.index);r!==c.index&&this.updateShapes([{id:e,type:"arrow",index:r}])},f=(e,t)=>{let{x:n,y:r}=aR(this,e)[t];this.store.put([{...e,props:{...e.props,[t]:{type:"point",x:n,y:r}}}])},m=e=>{for(let t of["start","end"]){let n=e.props[t];if("binding"!==n.type)continue;let r=this.getShape(n.boundShapeId),i=this.getAncestorPageId(e)===this.getAncestorPageId(r);r&&i||f(e,t)}g(e.id)},y=(e,t)=>{let n=null,r=e.selectedShapeIds.filter(e=>!t.has(e));r.length!==e.selectedShapeIds.length&&(n||(n={...e}),n.selectedShapeIds=r);let i=e.erasingShapeIds.filter(e=>!t.has(e));i.length!==e.erasingShapeIds.length&&(n||(n={...e}),n.erasingShapeIds=i),e.hoveredShapeId&&t.has(e.hoveredShapeId)&&(n||(n={...e}),n.hoveredShapeId=null),e.editingShapeId&&t.has(e.editingShapeId)&&(n||(n={...e}),n.editingShapeId=null);let o=e.hintingShapeIds.filter(e=>!t.has(e));return o.length!==e.hintingShapeIds.length&&(n||(n={...e}),n.hintingShapeIds=o),e.focusedGroupId&&t.has(e.focusedGroupId)&&(n||(n={...e}),n.focusedGroupId=null),n};if(this.sideEffects=new ah(this),this.sideEffects.registerBatchCompleteHandler(()=>{for(let e of p){p.delete(e);let t=this.getShape(e);if(!t)continue;let n=this.getShapeUtil(t),r=n.onChildrenChange?.(t);r?.length&&this.updateShapes(r,{squashing:!0})}this.emit("update")}),this.sideEffects.registerBeforeDeleteHandler("shape",e=>{e.parentId&&nF(e.parentId)&&p.add(e.parentId);let t=this._getArrowBindingsIndex().get()[e.id];if(t?.length)for(let{arrowId:e,handleId:n}of t){let t=this.getShape(e);t&&f(t,n)}let n=new Set([e.id]),r=eI(this.getPageStates().map(e=>y(e,n)));r.length&&this.store.put(r)}),this.sideEffects.registerBeforeDeleteHandler("page",e=>{if(this.getInstanceState().currentPageId!==e.id)return;let t=this.getPages().find(t=>t.id!==e.id)?.id;if(!t)return;this.store.put([{...this.getInstanceState(),currentPageId:t}]);let n=tX.createId(e.id),r=no.createId(e.id);this.store.remove([n,r])}),this.sideEffects.registerAfterChangeHandler("shape",(e,t)=>{if(this.isShapeOfType(t,"arrow")&&m(t),e.parentId!==t.parentId){let e=e=>{let t=this._getArrowBindingsIndex().get()[e];if(t?.length)for(let e of t)g(e.arrowId)};e(t.id),this.visitDescendants(t.id,e)}if(e.parentId!==t.parentId&&t8(t.parentId)){let n=new Set([e.id]);for(let r of(this.visitDescendants(e.id,e=>{n.add(e)}),this.getPageStates())){if(r.pageId===t.parentId)continue;let e=y(r,n);e&&this.store.put([e])}}e.parentId&&nF(e.parentId)&&p.add(e.parentId),t.parentId!==e.parentId&&nF(t.parentId)&&p.add(t.parentId)}),this.sideEffects.registerAfterChangeHandler("instance_page_state",(e,t)=>{if(e?.selectedShapeIds!==t?.selectedShapeIds){let e=t.selectedShapeIds.filter(e=>{let n=this.getShape(e)?.parentId;for(;nF(n);){if(t.selectedShapeIds.includes(n))return!1;n=this.getShape(n)?.parentId}return!0}),n=null;if(e.length>0){let t=this.findCommonAncestor(eI(e.map(e=>this.getShape(e))),e=>this.isShapeOfType(e,"group"));t&&(n=t)}else t?.focusedGroupId&&(n=t.focusedGroupId);(e.length!==t.selectedShapeIds.length||n!==t.focusedGroupId)&&this.store.put([{...t,selectedShapeIds:e,focusedGroupId:n??null}])}}),this.sideEffects.registerAfterCreateHandler("shape",e=>{this.isShapeOfType(e,"arrow")&&m(e)}),this.sideEffects.registerAfterCreateHandler("page",e=>{let t=tX.createId(e.id),n=no.createId(e.id);this.store.has(t)||this.store.put([tX.create({id:t})]),this.store.has(n)||this.store.put([no.create({id:n,pageId:e.id})])}),this._currentPageShapeIds=ar(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=at(this.store),this.disposables.add(this.store.listen(e=>{this.emit("change",e)})),this.store.ensureStoreIsUsable(),this._setInstancePageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]},{ephemeral:!0}),o&&void 0===this.root.children[o])throw Error(`No state found for initialState "${o}".`);this.root.enter(void 0,"initial"),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.updateRenderingBounds(),requestAnimationFrame(()=>{this._tickManager.start()})}store;root;disposables=new Set;_tickManager=new aP(this);snaps;user;textMeasure;environment;scribbles;getContainer;sideEffects;dispose(){this.disposables.forEach(e=>e()),this.disposables.clear()}shapeUtils;styleProps;getShapeUtil(e){let t="string"==typeof e?e:e.type,n=eV(this.shapeUtils,t);return eT(n,`No shape util found for type "${t}"`),n}history=new ac(this,e=>{this.annotateError(e,{origin:"history.batch",willCrashApp:!0}),this.crash(e)});undo(){return this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this.history.redo(),this}getCanRedo(){return this.history.getNumRedos()>0}mark(e,t,n){return this.history.mark(e,t,n),this}bail(){return this.history.bail(),this}bailToMark(e){return this.history.bailToMark(e),this}batch(e){return this.history.batch(e),this}_getArrowBindingsIndex(){return ae(this)}getArrowsBoundTo(e){return this._getArrowBindingsIndex().get()[e]||N}getArrowInfoCache(){return this.store.createComputedCache("arrow infoCache",e=>aT(e)?az(this,e):a$(this,e))}getArrowInfo(e){let t="string"==typeof e?e:e.id;return this.getArrowInfoCache().get(t)}annotateError(e,{origin:t,willCrashApp:n,tags:r,extras:i}){let o=this.createErrorAnnotations(t,n);return eL(e,{tags:{...o.tags,...r},extras:{...o.extras,...i}}),n&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(e,t){try{let n=this.getEditingShapeId();return{tags:{origin:e,willCrashApp:t},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes(),editingShape:n?this.getShape(n):void 0,inputs:this.inputs}}}catch{return{tags:{origin:e,willCrashApp:t},extras:{}}}}_crashingError=null;getCrashingError(){return this._crashingError}crash(e){return this._crashingError=e,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:e}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(e){let t=e.split(".").reverse(),n=this.root;for(;t.length>0;){let e=t.pop();if(!e)return!0;let r=n.getCurrent();if(r?.id===e){if(0===t.length)return!0;n=r;continue}break}return!1}isInAny(...e){return e.some(e=>this.isIn(e))}setCurrentTool(e,t={}){return this.root.transition(e,t),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){let e=this.getCurrentTool();return e?e.getCurrentToolIdMask()??e.id:""}getStateDescendant(e){let t=e.split(".").reverse(),n=this.root;for(;t.length>0;){let e=t.pop();if(!e)break;let r=n.children?.[e];if(!r)return;n=r}return n}getDocumentSettings(){return this.store.get(nm)}updateDocumentSettings(e){return this.store.put([{...this.getDocumentSettings(),...e}]),this}getInstanceState(){return this.store.get(ne)}updateInstanceState(e,t){return this._updateInstanceState(e,{ephemeral:!0,squashing:!0,...t}),void 0!==e.isChangingStyle&&(clearTimeout(this._isChangingStyleTimeout),!0===e.isChangingStyle&&(this._isChangingStyleTimeout=setTimeout(()=>{this.updateInstanceState({isChangingStyle:!1})},2e3))),this}_updateInstanceState=this.history.createCommand("updateInstanceState",(e,t)=>{let n=this.store.get(this.getInstanceState().id),r={...n,...e};return{data:{prev:n,next:r},ephemeral:!1,squashing:!1,...t}},{do:({next:e})=>{this.store.put([e])},undo:({prev:e})=>{this.store.put([e])},squash:({prev:e},{next:t})=>({prev:e,next:t})});_isChangingStyleTimeout=-1;getOpenMenus(){return this.getInstanceState().openMenus}addOpenMenu(e){let t=new Set(this.getOpenMenus());return t.has(e)||(t.add(e),this.updateInstanceState({openMenus:[...t]})),this}deleteOpenMenu(e){let t=new Set(this.getOpenMenus());return t.has(e)&&(t.delete(e),this.updateInstanceState({openMenus:[...t]})),this}clearOpenMenus(){return this.getOpenMenus().length&&this.updateInstanceState({openMenus:[]}),this}getIsMenuOpen(){return this.getOpenMenus().length>0}setCursor=e=>(this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...e}},{ephemeral:!0}),this);getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return no.createId(this.getCurrentPageId())}updateCurrentPageState(e,t){return this._setInstancePageState(e,t),this}_setInstancePageState=this.history.createCommand("setInstancePageState",(e,t)=>({data:{prev:this.store.get(e.id??this.getCurrentPageState().id),partial:e},...t}),{do:({prev:e,partial:t})=>{this.store.update(e.id,e=>({...e,...t}))},undo:({prev:e})=>{this.store.update(e.id,()=>e)}});getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){let{selectedShapeIds:e}=this.getCurrentPageState();return eI(e.map(e=>this.store.get(e)))}setSelectedShapes(e,t){let n=e.map(e=>"string"==typeof e?e:e.id);return this._setSelectedShapes(n,t),this}_setSelectedShapes=this.history.createCommand("setSelectedShapes",(e,t)=>{let{selectedShapeIds:n}=this.getCurrentPageState(),r=new Set(n);return e.length===r.size&&e.every(e=>r.has(e))?null:{data:{selectedShapeIds:e,prevSelectedShapeIds:n},preservesRedoStack:!0,...t}},{do:({selectedShapeIds:e})=>{this.store.put([{...this.getCurrentPageState(),selectedShapeIds:e}])},undo:({prevSelectedShapeIds:e})=>{this.store.put([{...this.getCurrentPageState(),selectedShapeIds:e}])},squash:({prevSelectedShapeIds:e},{selectedShapeIds:t})=>({selectedShapeIds:t,prevSelectedShapeIds:e})});isAncestorSelected(e){let t="string"==typeof e?e:e?.id??null,n=this.getShape(t);if(!n)return!1;let r=this.getSelectedShapeIds();return!!this.findShapeAncestor(n,e=>r.includes(e.id))}select(...e){let t="string"==typeof e[0]?e:e.map(e=>e.id);return this.setSelectedShapes(t),this}deselect(...e){let t="string"==typeof e[0]?e:e.map(e=>e.id),n=this.getSelectedShapeIds();return n.length>0&&t.length>0&&this.setSelectedShapes(n.filter(e=>!t.includes(e))),this}selectAll(){let e=this.getSortedChildIdsForParent(this.getCurrentPageId());return e.length<=0||this.setSelectedShapes(this._getUnlockedShapeIds(e)),this}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShape(){let e=this.getSelectedShapes();return 1===e.length?e[0]:null}getSelectionPageBounds(){let e=this.getCurrentPageState().selectedShapeIds;return 0===e.length?null:oE.Common(eI(e.map(e=>this.getShapePageBounds(e))))}getSelectionRotation(){let e=this.getSelectedShapeIds();if(0===e.length)return 0;if(1===e.length)return this.getShapePageTransform(this.getSelectedShapeIds()[0]).rotation();let t=e.map(e=>this.getShapePageTransform(e).rotation());return t.every(e=>Math.abs(e-t[0])<Math.PI/180)?this.getShapePageTransform(e[0]).rotation():0}getSelectionRotatedPageBounds(){let e=this.getSelectedShapeIds();if(0===e.length)return;let t=this.getSelectionRotation();if(0===t)return this.getSelectionPageBounds();if(1===e.length){let t=this.getShapeGeometry(e[0]).bounds.clone(),n=this.getShapePageTransform(e[0]);return t.point=n.applyToPoint(t.point),t}let n=oE.FromPoints(this.getSelectedShapeIds().flatMap(e=>{let t=this.getShapePageTransform(e);return t?t.applyToPoints(this.getShapeGeometry(e).vertices):[]}).map(e=>rG.Rot(e,-t)));return n.point=n.point.rot(t),n}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){let e=this.getFocusedGroupId();return e?this.getShape(e):void 0}setFocusedGroup(e){let t="string"==typeof e?e:e?.id??null;if(null!==t){let e=this.getShape(t);if(!e)throw Error(`Editor.setFocusedGroup: Shape with id ${t} does not exist`);if(!this.isShapeOfType(e,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${e.type}`)}return t===this.getFocusedGroupId()||this._setFocusedGroupId(t),this}_setFocusedGroupId=this.history.createCommand("setFocusedGroupId",e=>{let t=this.getCurrentPageState().focusedGroupId;if(t!==e)return{data:{prev:t,next:e},preservesRedoStack:!0,squashing:!0}},{do:({next:e})=>{this.store.update(this.getCurrentPageState().id,t=>({...t,focusedGroupId:e}))},undo:({prev:e})=>{this.store.update(this.getCurrentPageState().id,t=>({...t,focusedGroupId:e}))},squash:({prev:e},{next:t})=>({prev:e,next:t})});popFocusedGroupId(){let e=this.getFocusedGroup();if(e){let t=this.findShapeAncestor(e,e=>this.isShapeOfType(e,"group"));this.setFocusedGroup(t?.id??null),this.select(e.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){let e=this.getEditingShapeId();return e?this.getShape(e):void 0}setEditingShape(e){let t="string"==typeof e?e:e?.id??null;if(t!==this.getEditingShapeId()){if(t){let e=this.getShape(t);if(e&&this.getShapeUtil(e).canEdit(e))return this._setInstancePageState({editingShapeId:t}),this}this._setInstancePageState({editingShapeId:null})}return this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){let e=this.getHoveredShapeId();return e?this.getShape(e):void 0}setHoveredShape(e){let t="string"==typeof e?e:e?.id??null;return t===this.getHoveredShapeId()||this.updateCurrentPageState({hoveredShapeId:t},{ephemeral:!0}),this}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){return eI(this.getHintingShapeIds().map(e=>this.getShape(e)))}setHintingShapes(e){let t="string"==typeof e[0]?e:e.map(e=>e.id);return this.updateCurrentPageState({hintingShapeIds:eP(t)},{ephemeral:!0}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){return eI(this.getErasingShapeIds().map(e=>this.getShape(e)))}setErasingShapes(e){let t="string"==typeof e[0]?e:e.map(e=>e.id);t.sort();let n=this.getErasingShapeIds();if(t.length===n.length){for(let e=0;e<t.length;e++)if(t[e]!==n[e]){this._setInstancePageState({erasingShapeIds:t},{ephemeral:!0});break}}else this._setInstancePageState({erasingShapeIds:t},{ephemeral:!0});return this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(e){let t="string"==typeof e?e:e?.id??null;if(t!==this.getCroppingShapeId()){if(t){let e=this.getShape(t),n=this.getShapeUtil(e);e&&n.canCrop(e)&&this.updateCurrentPageState({croppingShapeId:t})}else this.updateCurrentPageState({croppingShapeId:null})}return this}getCameraId(){return tX.createId(this.getCurrentPageId())}getCamera(){return this.store.get(this.getCameraId())}getZoomLevel(){return this.getCamera().z}_setCamera(e){let t=this.getCamera();return t.x===e.x&&t.y===e.y&&t.z===e.z||this.batch(()=>{this.store.put([{...t,...e}]);let{currentScreenPoint:n}=this.inputs;this.dispatch({type:"pointer",target:"canvas",name:"pointer_move",point:n,pointerId:rw.CAMERA_MOVE,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,button:0,isPen:this.getInstanceState().isPenMode??!1}),this._tickCameraState()}),this}setCamera(e,t){let n=Number.isFinite(e.x)?e.x:0,r=Number.isFinite(e.y)?e.y:0,i=Number.isFinite(e.z)?e.z:this.getZoomLevel();if(this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),t){let{width:e,height:o}=this.getViewportScreenBounds();return this._animateToViewport(new oE(-n,-r,e/i,o/i),t)}return this._setCamera({x:n,y:r,z:i}),this}centerOnPoint(e,t){if(!this.getInstanceState().canMoveCamera)return this;let{width:n,height:r}=this.getViewportPageBounds();return this.setCamera({x:-(e.x-n/2),y:-(e.y-r/2),z:this.getCamera().z},t),this}zoomToContent(){let e=this.getSelectionPageBounds()??this.getCurrentPageBounds();return e&&this.zoomToBounds(e,Math.min(1,this.getZoomLevel()),{duration:220}),this}zoomToFit(e){if(!this.getInstanceState().canMoveCamera)return this;let t=[...this.getCurrentPageShapeIds()];if(t.length<=0)return this;let n=oE.Common(eI(t.map(e=>this.getShapePageBounds(e))));return this.zoomToBounds(n,void 0,e),this}resetZoom(e=this.getViewportScreenCenter(),t){if(!this.getInstanceState().canMoveCamera)return this;let{x:n,y:r,z:i}=this.getCamera(),{x:o,y:s}=e;return this.setCamera({x:n+(o/1-o)-(o/i-o),y:r+(s/1-s)-(s/i-s),z:1},t),this}zoomIn(e=this.getViewportScreenCenter(),t){if(!this.getInstanceState().canMoveCamera)return this;let{x:n,y:r,z:i}=this.getCamera(),o=8;for(let e=1;e<rb.length;e++){let t=rb[e-1],n=rb[e];if(!(n-i<=(n-t)/2)){o=n;break}}let{x:s,y:a}=e;return this.setCamera({x:n+(s/o-s)-(s/i-s),y:r+(a/o-a)-(a/i-a),z:o},t),this}zoomOut(e=this.getViewportScreenCenter(),t){if(!this.getInstanceState().canMoveCamera)return this;let{x:n,y:r,z:i}=this.getCamera(),o=.1;for(let e=rb.length-1;e>0;e--){let t=rb[e-1],n=rb[e];if(!(n-i>=(n-t)/2)){o=t;break}}let{x:s,y:a}=e;return this.setCamera({x:n+(s/o-s)-(s/i-s),y:r+(a/o-a)-(a/i-a),z:o},t),this}zoomToSelection(e){if(!this.getInstanceState().canMoveCamera)return this;let t=this.getSelectionPageBounds();return t&&this.zoomToBounds(t,Math.max(1,this.getZoomLevel()),e),this}panZoomIntoView(e,t){if(!this.getInstanceState().canMoveCamera||e.length<=0)return this;let n=oE.Common(eI(e.map(e=>this.getShapePageBounds(e)))),r=this.getViewportPageBounds();if(r.h<n.h||r.w<n.w)this.zoomToBounds(n,this.getCamera().z,t);else{let e=this.getViewportPageBounds().clone().expandBy(-32/this.getZoomLevel()),r=0,i=0;e.maxY<n.maxY?i=e.maxY-n.maxY:e.minY>n.minY&&(i=e.minY-n.minY),e.maxX<n.maxX?r=e.maxX-n.maxX:e.minX>n.minX&&(r=e.minX-n.minX);let o=this.getCamera();this.setCamera({x:o.x+r,y:o.y+i,z:o.z},t)}return this}zoomToBounds(e,t,n){if(!this.getInstanceState().canMoveCamera)return this;let r=this.getViewportScreenBounds(),i=Math.min(256,.28*r.width),o=r5(Math.min((r.width-i)/e.width,(r.height-i)/e.height),.1,8);return void 0!==t&&(o=Math.min(t,o)),this.setCamera({x:-e.minX+(r.width-e.width*o)/2/o,y:-e.minY+(r.height-e.height*o)/2/o,z:o},n),this}pan(e,t){if(!this.getInstanceState().canMoveCamera)return this;let{x:n,y:r,z:i}=this.getCamera();return this.setCamera({x:n+e.x/i,y:r+e.y/i,z:i},t),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_viewportAnimation=null;_animateViewport(e){if(!this._viewportAnimation)return;let t=()=>{this.removeListener("tick",this._animateViewport),this.removeListener("stop-camera-animation",t),this._viewportAnimation=null};this.once("stop-camera-animation",t),this._viewportAnimation.elapsed+=e;let{elapsed:n,easing:r,duration:i,start:o,end:s}=this._viewportAnimation;if(n>i){this._setCamera({x:-s.x,y:-s.y,z:this.getViewportScreenBounds().width/s.width}),t();return}let a=r(1-(i-n)/i),l=o.minX+(s.minX-o.minX)*a,d=o.minY+(s.minY-o.minY)*a,c=o.maxX+(s.maxX-o.maxX)*a;this._setCamera({x:-l,y:-d,z:this.getViewportScreenBounds().width/(c-l)})}_animateToViewport(e,t={}){let{duration:n=0,easing:r=ry.easeInOutCubic}=t,i=this.user.getAnimationSpeed(),o=this.getViewportPageBounds();return(this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),0===n||0===i)?this._setCamera({x:-e.x,y:-e.y,z:this.getViewportScreenBounds().width/e.width}):(this._viewportAnimation={elapsed:0,duration:n/i,easing:r,start:o.clone(),end:e.clone()},this.addListener("tick",this._animateViewport),this)}slideCamera(e={}){if(!this.getInstanceState().canMoveCamera||(this.stopCameraAnimation(),0===this.user.getAnimationSpeed()))return this;let{speed:t,friction:n,direction:r,speedThreshold:i=.01}=e,o=Math.min(t,1),s=()=>{this.removeListener("tick",a),this.removeListener("stop-camera-animation",s)};this.once("stop-camera-animation",s);let a=e=>{let{x:t,y:a,z:l}=this.getCamera(),d=rG.Mul(r,o*e/l);(o*=1-n)<i?s():this._setCamera({x:t+d.x,y:a+d.y,z:l})};return this.addListener("tick",a),this}animateToUser(e){let t=[...this.store.query.records("instance_presence",()=>({userId:{eq:e}})).get()].sort((e,t)=>e.lastActivityTimestamp-t.lastActivityTimestamp).pop();return t&&this.batch(()=>{null!==this.getInstanceState().followingUserId&&this.stopFollowingUser();let n=t.currentPageId===this.getCurrentPageId();n||this.setCurrentPage(t.currentPageId),this.centerOnPoint(t.cursor,n?{duration:500}:void 0);let{highlightedUserIds:r}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...r,e]}),setTimeout(()=>{let t=[...this.getInstanceState().highlightedUserIds],n=t.indexOf(e);n<0||(t.splice(n,1),this.updateInstanceState({highlightedUserIds:t}))},3e3)}),this}animateToShape(e,t=rx){if(!this.getInstanceState().canMoveCamera)return this;let n=this.getViewportScreenBounds().clone().expandBy(-32),r=n.width/n.height,i=this.getShapePageBounds(e);if(!i)return this;let o=i.width/i.height,s=i.clone(),a=i.width/n.width;return s.width+=(n.minX+n.maxX)*a,s.height+=(n.minY+n.maxY)*a,s.x-=n.minX*a,s.y-=n.minY*a,o>r?(s.height=i.width/r,s.y-=(s.height-i.height)/2):(s.width=i.height*r,s.x-=(s.width-i.width)/2),this._animateToViewport(s,t)}_willSetInitialBounds=!0;_wasInset=!1;updateViewportScreenBounds(e=!1){let t=this.getContainer();if(!t)return this;let n=t.getBoundingClientRect(),r=new oE(n.left||n.x,n.top||n.y,Math.max(n.width,1),Math.max(n.height,1)),i=[0!==r.minY,document.body.scrollWidth!==r.maxX,document.body.scrollHeight!==r.maxY,0!==r.minX],o=r.equals(this.getViewportScreenBounds()),{_willSetInitialBounds:s}=this;if(o)this._willSetInitialBounds=!1;else if(s)this._willSetInitialBounds=!1,this.updateInstanceState({screenBounds:r.toJson(),insets:i},{squashing:!0,ephemeral:!0});else if(e&&!this.getInstanceState().followingUserId){let e=this.getViewportPageCenter();this.updateInstanceState({screenBounds:r.toJson(),insets:i},{squashing:!0,ephemeral:!0}),this.centerOnPoint(e)}else this.updateInstanceState({screenBounds:r.toJson(),insets:i},{squashing:!0,ephemeral:!0});return this._tickCameraState(),this.updateRenderingBounds(),this}getViewportScreenBounds(){let{x:e,y:t,w:n,h:r}=this.getInstanceState().screenBounds;return new oE(e,t,n,r)}getViewportScreenCenter(){return this.getViewportScreenBounds().center}getViewportPageBounds(){let{w:e,h:t}=this.getViewportScreenBounds(),{x:n,y:r,z:i}=this.getCamera();return new oE(-n,-r,e/i,t/i)}getViewportPageCenter(){return this.getViewportPageBounds().center}screenToPage(e){let{screenBounds:t}=this.store.unsafeGetWithoutCapture(ne),{x:n,y:r,z:i=1}=this.getCamera();return{x:(e.x-t.x)/i-n,y:(e.y-t.y)/i-r,z:e.z??.5}}pageToScreen(e){let{screenBounds:t}=this.store.unsafeGetWithoutCapture(ne),{x:n,y:r,z:i=1}=this.getCamera();return{x:(e.x+n)*i+t.x,y:(e.y+r)*i+t.y,z:e.z??.5}}startFollowingUser(e){let t=this.store.query.records("instance_presence",()=>({userId:{eq:e}})),n=this.user.getId();if(n||console.warn("You should set the userId for the current instance before following a user"),t.get().some(e=>e.followingUserId===n))return this;ee(()=>{this.stopFollowingUser(),this.updateInstanceState({followingUserId:e},{ephemeral:!0})});let r=()=>{this.removeListener("frame",o),this.removeListener("stop-following",r)},i=!1,o=()=>{let r=[...t.get()].sort((e,t)=>e.lastActivityTimestamp-t.lastActivityTimestamp).pop();if(!r){this.stopFollowingUser();return}let o=r.currentPageId===this.getCurrentPageId(),s=o?.5:1;if(!o){this.stopFollowingUser(),this.setCurrentPage(r.currentPageId),this.startFollowingUser(e);return}let{center:a,width:l,height:d}=this.getViewportPageBounds(),c=oE.From(r.screenBounds),u=c.width/r.camera.z,h=c.height/r.camera.z,p=new rG(u/2-r.camera.x,h/2-r.camera.y),g=r.followingUserId===n,f=l+(u-l)*s,m=d+(h-d)*s,y=r5(this.getCamera().z*(g?d/m:Math.min(l/f,d/m)),.1,8),b=this.getViewportScreenBounds().w/y,v=this.getViewportScreenBounds().h/y,x=p.sub(a),S=rG.Add(a,rG.Mul(x,s)),w=rG.Sub(S,a).len(),C=Math.abs(y-this.getCamera().z);if(w<.1&&C<.005){i=!0;return}i&&w<.2&&C<.05||(i=!1,this.stopCameraAnimation(),this._setCamera({x:-(S.x-b/2),y:-(S.y-v/2),z:y}))};return this.once("stop-following",r),this.addListener("frame",o),this}stopFollowingUser(){return this.updateInstanceState({followingUserId:null},{ephemeral:!0}),this.emit("stop-following"),this}_cameraState=er("camera state","idle");getCameraState(){return this._cameraState.get()}_cameraStateTimeoutRemaining=0;_lastUpdateRenderingBoundsTimestamp=Date.now();_decayCameraStateTimeout=e=>{this._cameraStateTimeoutRemaining-=e,this._cameraStateTimeoutRemaining<=0&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"),this.updateRenderingBounds())};_tickCameraState=()=>{this._cameraStateTimeoutRemaining=64;let e=Date.now();"idle"===this._cameraState.__unsafe__getWithoutCapture()?(this._lastUpdateRenderingBoundsTimestamp=e,this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout)):e-this._lastUpdateRenderingBoundsTimestamp>620&&this.updateRenderingBounds()};getUnorderedRenderingShapes(e){let t=[],n=4e3,r=2e3,i=this.getEditingShapeId(),o=this.getSelectedShapeIds(),s=this.getErasingShapeIds(),a=this.getRenderingBoundsExpanded(),l=Number.isFinite(this.renderingBoundsMargin),d=(c,u,h)=>{let p=this.getShape(c);if(!p)return;u*=p.opacity;let g=!1,f=!1,m=this.getShapeUtil(p),y=this.getShapeMaskedPageBounds(c);e&&((f=!h&&s.includes(c))&&(u*=.32),g=l&&m.canUnmount(p)&&i!==c&&(void 0===y||!a.includes(y)&&!o.includes(c))),t.push({id:c,shape:p,util:m,index:n,backgroundIndex:r,opacity:u,isCulled:g,maskedPageBounds:y}),n+=1,r+=1;let b=this.getSortedChildIdsForParent(c);if(!b.length)return;let v=null;for(let e of(m.providesBackgroundForChildren(p)&&(v=r,r=n,n+=2e3),b))d(e,u,h||f);null!==v&&(r=v)};for(let e of this.getSortedChildIdsForParent(this.getCurrentPageId()))d(e,1,!1);return t}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(eQ)}getRenderingBounds(){return this._renderingBounds.get()}_renderingBounds=er("rendering viewport",new oE);getRenderingBoundsExpanded(){return this._renderingBoundsExpanded.get()}_renderingBoundsExpanded=er("rendering viewport expanded",new oE);updateRenderingBounds(){let e=this.getViewportPageBounds();return e.equals(this._renderingBounds.__unsafe__getWithoutCapture())||(this._renderingBounds.set(e.clone()),Number.isFinite(this.renderingBoundsMargin)?this._renderingBoundsExpanded.set(e.clone().expandBy(this.renderingBoundsMargin/this.getZoomLevel())):this._renderingBoundsExpanded.set(e)),this}renderingBoundsMargin=100;_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return this._getAllPagesQuery().get().sort(s9)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(e){return this.store.get("string"==typeof e?e:e.id)}_currentPageShapeIds;getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getPageShapeIds(e){let t="string"==typeof e?e:e.id,n=this.store.query.exec("shape",{parentId:{eq:t}});return this.getShapeAndDescendantIds(n.map(e=>e.id))}setCurrentPage(e,t){let n="string"==typeof e?e:e.id;return this._setCurrentPageId(n,t),this}_setCurrentPageId=this.history.createCommand("setCurrentPage",(e,t)=>{if(!this.store.has(e)){console.error("Tried to set the current page id to a page that doesn't exist.");return}return this.stopFollowingUser(),{data:{toId:e,fromId:this.getCurrentPageId()},squashing:!0,preservesRedoStack:!0,...t}},{do:({toId:e})=>{if(this.store.has(e)){if(!this.getPageStates().find(t=>t.pageId===e)){let t=tX.create({id:tX.createId(e)});this.store.put([t,no.create({id:no.createId(e),pageId:e})])}this.store.put([{...this.getInstanceState(),currentPageId:e}]),this.updateRenderingBounds()}},undo:({fromId:e})=>{this.store.has(e)&&(this.store.put([{...this.getInstanceState(),currentPageId:e}]),this.updateRenderingBounds())},squash:({fromId:e},{toId:t})=>({toId:t,fromId:e})});updatePage(e,t){return this._updatePage(e,t),this}_updatePage=this.history.createCommand("updatePage",(e,t)=>{if(this.getInstanceState().isReadonly)return null;let n=this.getPage(e.id);return n?{data:{prev:n,partial:e},...t}:null},{do:({partial:e})=>{this.store.update(e.id,t=>({...t,...e}))},undo:({prev:e,partial:t})=>{this.store.update(t.id,()=>e)},squash:(e,t)=>({prev:{...e.prev,...t.prev},partial:t.partial})});createPage(e){return this._createPage(e),this}_createPage=this.history.createCommand("createPage",e=>{if(this.getInstanceState().isReadonly||this.getPages().length>=40)return null;let t=this.getPages(),n=function(e,t){let n=e,r=new Set(t);for(;r.has(n);)n=/^.*(\d+)$/.exec(n)?.[1]?n.replace(/(\d+)(?=\D?)$/,e=>(+e+1).toString()):`${n} 1`;return n}(e.name??"Page 1",t.map(e=>e.name)),r=e.index;(!r||t.some(e=>e.index===r))&&(r=s6(t[t.length-1].index));let i=t6.create({meta:{},...e,name:n,index:r}),o=tX.create({id:tX.createId(i.id)}),s=no.create({id:no.createId(i.id),pageId:i.id});return{data:{newPage:i,newTabPageState:s,newCamera:o}}},{do:({newPage:e,newTabPageState:t,newCamera:n})=>{this.store.put([e,n,t])},undo:({newPage:e,newTabPageState:t,newCamera:n})=>{1!==this.getPages().length&&this.store.remove([t.id,e.id,n.id])}});deletePage(e){let t="string"==typeof e?e:e.id;return this._deletePage(t),this}_deletePage=this.history.createCommand("delete_page",e=>{if(this.getInstanceState().isReadonly)return null;let t=this.getPages();if(1===t.length)return null;let n=this.getPage(e),r=this.getPageStates().filter(t=>t.pageId===e);if(!n)return null;if(e===this.getCurrentPageId()){let n=t.findIndex(t=>t.id===e),r=t[n-1]??t[n+1];this.setCurrentPage(r.id)}return{data:{id:e,deletedPage:n,deletedPageStates:r}}},{do:({deletedPage:e,deletedPageStates:t})=>{let n=this.getPages();if(1!==n.length){if(e.id===this.getCurrentPageId()){let t=n.findIndex(t=>t.id===e.id),r=n[t-1]??n[t+1];this.setCurrentPage(r.id)}this.store.remove(t.map(e=>e.id)),this.store.remove([e.id]),this.updateRenderingBounds()}},undo:({deletedPage:e,deletedPageStates:t})=>{this.store.put([e]),this.store.put(t),this.updateRenderingBounds()}});duplicatePage(e,t=t6.createId()){if(this.getPages().length>=40)return this;let n="string"==typeof e?e:e.id,r=this.getPage(n);if(!r)return this;let i={...this.getCamera()},o=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(r.id));return this.batch(()=>{let e=this.getPages(),n=s4(r.index,e[e.indexOf(r)+1]?.index);if(this.createPage({name:r.name+" Copy",id:t,index:n}),this.setCurrentPage(t),this.setCamera(i),o)return this.putContentOntoCurrentPage(o)}),this}renamePage(e,t,n){let r="string"==typeof e?e:e.id;return this.getInstanceState().isReadonly||this.updatePage({id:r,name:t},n),this}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(e){return this._createAssets(e),this}_createAssets=this.history.createCommand("createAssets",e=>this.getInstanceState().isReadonly||e.length<=0?null:{data:{assets:e}},{do:({assets:e})=>{this.store.put(e)},undo:({assets:e})=>{this.store.remove(e.map(e=>e.id))}});updateAssets(e){return this._updateAssets(e),this}_updateAssets=this.history.createCommand("updateAssets",e=>{if(!this.getInstanceState().isReadonly&&!(e.length<=0))return{data:{snapshots:{},assets:e}}},{do:({assets:e,snapshots:t})=>{this.store.put(e.map(e=>{let n=this.store.get(e.id);return t[e.id]=n,{...n,...e}}))},undo:({snapshots:e})=>{this.store.put(Object.values(e))}});deleteAssets(e){let t="string"==typeof e[0]?e:e.map(e=>e.id);return this._deleteAssets(t),this}_deleteAssets=this.history.createCommand("deleteAssets",e=>{if(this.getInstanceState().isReadonly||e.length<=0)return;let t=eI(e.map(e=>this.store.get(e)));return{data:{ids:e,prev:t}}},{do:({ids:e})=>{this.store.remove(e)},undo:({prev:e})=>{this.store.put(e)}});getAsset(e){return this.store.get("string"==typeof e?e:e.id)}_getShapeGeometryCache(){return this.store.createComputedCache("bounds",e=>this.getShapeUtil(e).getGeometry(e),(e,t)=>e.props===t.props)}getShapeGeometry(e){return this._getShapeGeometryCache().get("string"==typeof e?e:e.id)}_getShapeOutlineSegmentsCache(){return this.store.createComputedCache("outline-segments",e=>this.getShapeUtil(e).getOutlineSegments(e))}getShapeOutlineSegments(e){return this._getShapeOutlineSegmentsCache().get("string"==typeof e?e:e.id)??N}_getShapeHandlesCache(){return this.store.createComputedCache("handles",e=>this.getShapeUtil(e).getHandles?.(e))}getShapeHandles(e){return this._getShapeHandlesCache().get("string"==typeof e?e:e.id)}getShapeLocalTransform(e){let t="string"==typeof e?e:e.id,n=this.getShape(t);if(!n)throw Error("Editor.getTransform: shape not found");return oj.Identity().translate(n.x,n.y).rotate(n.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",e=>{if(t8(e.parentId))return this.getShapeLocalTransform(e);let t=this._getShapePageTransformCache().get(e.parentId)??oj.Identity();return oj.Compose(t,this.getShapeLocalTransform(e))})}getShapeParentTransform(e){let t="string"==typeof e?e:e.id,n=this.getShape(t);return!n||t8(n.parentId)?oj.Identity():this._getShapePageTransformCache().get(n.parentId)??oj.Identity()}getShapePageTransform(e){let t="string"==typeof e?e:this.getShape(e).id;return this._getShapePageTransformCache().get(t)??oj.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",e=>{let t=this._getShapePageTransformCache().get(e.id);return t?oE.FromPoints(oj.applyToPoints(t,this.getShapeGeometry(e).vertices)):new oE})}getShapePageBounds(e){return this._getShapePageBoundsCache().get("string"==typeof e?e:e.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",e=>{let t=this._getShapeMaskCache().get(e.id);if(!t)return;if(0===t.length)return"polygon(0px 0px, 0px 0px, 0px 0px)";let n=this._getShapePageTransformCache().get(e.id);if(!n)return;let r=oj.applyToPoints(oj.Inverse(n),t);return`polygon(${r.map(e=>`${e.x}px ${e.y}px`).join(",")})`})}getShapeClipPath(e){return this._getShapeClipPathCache().get("string"==typeof e?e:e.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",e=>{if(t8(e.parentId))return;let t=this.getShapeAncestors(e.id).filter(e=>this.isShapeOfType(e,"frame"));if(0!==t.length)return t.map(e=>this._getShapePageTransformCache().get(e.id).applyToPoints(this.getShapeGeometry(e).vertices)).reduce((e,t)=>{if(!(t&&e))return;let n=sT(e,t);return n?n.map(rG.Cast):[]})})}getShapeMask(e){return this._getShapeMaskCache().get("string"==typeof e?e:e.id)}getShapeMaskedPageBounds(e){"string"!=typeof e&&(e=e.id);let t=this._getShapePageBoundsCache().get(e);if(!t)return;let n=this._getShapeMaskCache().get(e);if(n){if(0===n.length)return;let{corners:e}=t;if(e.every((e,t)=>e&&rG.Equals(e,n[t])))return t.clone();let r=sT(n,e);if(!r)return;return oE.FromPoints(r)}return t}getShapeAncestors(e,t=[]){let n="string"==typeof e?e:e.id,r=this.getShape(n);if(!r)return t;let i=r.parentId;if(t8(i))return t.reverse(),t;let o=this.store.get(i);return o?(t.push(o),this.getShapeAncestors(o,t)):t}findShapeAncestor(e,t){let n="string"==typeof e?e:e.id,r=this.getShape(n);if(!r)return;let i=r.parentId;if(t8(i))return;let o=this.getShape(i);if(o)return t(o)?o:this.findShapeAncestor(o,t)}hasAncestor(e,t){let n="string"==typeof e?e:e?.id,r=n&&this.getShape(n);return!!r&&(r.parentId===t||this.hasAncestor(this.getShapeParent(r),t))}findCommonAncestor(e,t){if(0===e.length)return;let n=eI(("string"==typeof e[0]?e:e.map(e=>e.id)).map(e=>this.getShape(e)));if(1===n.length){let e=n[0].parentId;if(t8(e))return;return t?this.findShapeAncestor(n[0],t)?.id:e}let[r,...i]=n,o=this.getShapeParent(r);for(;o;){if(t&&!t(o)){o=this.getShapeParent(o);continue}if(i.every(e=>this.hasAncestor(e,o.id)))return o.id;o=this.getShapeParent(o)}}isShapeOrAncestorLocked(e){let t="string"==typeof e?this.getShape(e):e;return void 0!==t&&(!!t.isLocked||this.isShapeOrAncestorLocked(this.getShapeParent(t)))}getCurrentPageBounds(){let e;return this.getCurrentPageShapeIds().forEach(t=>{let n=this.getShapeMaskedPageBounds(t);n&&(e=e?e.expand(n):n.clone())}),e}getSelectedShapeAtPoint(e){let t=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(e=>"group"!==e.type&&t.includes(e.id)).reverse().find(t=>this.isPointInShape(t,e,{hitInside:!0,margin:0}))}getShapeAtPoint(e,t={}){let n=this.getZoomLevel(),r=this.getViewportPageBounds(),{filter:i,margin:o=0,hitLabels:s=!1,hitInside:a=!1,hitFrameInside:l=!1}=t,d=1/0,c=null,u=1/0,h=null,p=(t.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(t=>{if(this.isShapeOfType(t,"group"))return!1;let n=this.getShapeMask(t);return(!n||!!io(e,n))&&(!i||i(t))});for(let t=p.length-1;t>=0;t--){let i;let g=p[t],f=this.getShapeGeometry(g),m=f instanceof oT,y=this.getPointInShapeSpace(g,e);if((this.isShapeOfType(g,"arrow")||this.isShapeOfType(g,"geo")&&"none"===g.props.fill)&&g.props.text.trim()){for(let e of f.children)if(e.isLabel&&e.isPointInBounds(y))return g}if(this.isShapeOfType(g,"frame")){if(Math.abs(f.distanceToPoint(y,a))<=o)return h||g;if(f.hitTestPoint(y,0,!0))return h||c||(l?g:void 0);continue}if(m){let e=1/0;for(let t of f.children){if(t.isLabel&&!s)continue;let n=t.distanceToPoint(y,a);n<e&&(e=n)}i=e}else i=0===o&&(f.bounds.w<1||f.bounds.h<1)?f.distanceToPoint(y,a):f.bounds.containsPoint(y,o)?f.distanceToPoint(y,a):1/0;if(f.isClosed){if(i<=o){if(f.isFilled||m&&f.children[0].isFilled)return h||g;if(this.getShapePageBounds(g).contains(r))continue;if(Math.abs(i)<o)Math.abs(i)<u&&(u=Math.abs(i),h=g);else if(!h){let{area:e}=f;e<d&&(d=e,c=g)}}}else if(i<8/n)return g}return h||c||void 0}getShapesAtPoint(e,t={}){return this.getCurrentPageShapes().filter(n=>this.isPointInShape(n,e,t))}isPointInShape(e,t,n={}){let{hitInside:r=!1,margin:i=0}=n,o="string"==typeof e?e:e.id,s=this.getShapeMask(o);return(!s||!!io(t,s))&&this.getShapeGeometry(o).hitTestPoint(this.getPointInShapeSpace(e,t),i,r)}getPointInShapeSpace(e,t){let n="string"==typeof e?e:e.id;return this._getShapePageTransformCache().get(n).clone().invert().applyToPoint(t)}getPointInParentSpace(e,t){let n="string"==typeof e?e:e.id,r=this.getShape(n);if(!r)return new rG(0,0);if(t8(r.parentId))return rG.From(t);let i=this.getShapePageTransform(r.parentId);return i?i.clone().invert().applyToPoint(t):rG.From(t)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),e=>this.store.get(e))}getCurrentPageShapesSorted(){let e=new Set(this.getCurrentPageShapes().sort(s9)),t=[];return e.forEach(n=>{n$(this.getShape(n.parentId))||function n(r){t.push(r),e.delete(r),e.forEach(e=>{e.parentId===r.id&&n(e)})}(n)}),t}getCurrentPageRenderingShapesSorted(){return this.getRenderingShapes().filter(({isCulled:e})=>!e).sort((e,t)=>e.index-t.index).map(({shape:e})=>e)}isShapeOfType(e,t){return("string"==typeof e?this.getShape(e):e).type===t}getShape(e){let t="string"==typeof e?e:e.id;if(nF(t))return this.store.get(t)}getShapeParent(e){let t="string"==typeof e?e:e?.id;if(!t)return;let n=this.getShape(t);if(void 0!==n&&nF(n.parentId))return this.store.get(n.parentId)}getShapeNearestSibling(e,t){return t?t.parentId===e.parentId?t:this.findShapeAncestor(t,t=>t.parentId===e.parentId):void 0}isShapeInPage(e,t=this.getCurrentPageId()){let n="string"==typeof e?e:e.id,r=this.getShape(n);if(!r)return!1;let i=!1;if(r.parentId===t)i=!0;else{let e=this.getShape(r.parentId);for(;e;){if(e.parentId===t){i=!0;break}e=this.getShape(e.parentId)}}return i}getAncestorPageId(e){let t="string"==typeof e?e:e?.id,n=t&&this.getShape(t);if(n)return t8(n.parentId)?n.parentId:this.getAncestorPageId(this.getShape(n.parentId))}_parentIdsToChildIds;reparentShapes(e,t,n){let r="string"==typeof e[0]?e:e.map(e=>e.id);if(0===r.length)return this;let i=[],o=t8(t)?oj.Identity():this.getShapePageTransform(t),s=o.rotation(),a=[],l=eI(this.getSortedChildIdsForParent(t).map(e=>this.getShape(e)));if(n){let e=l.find(e=>e.index===n);if(e){let t=l[l.indexOf(e)+1];a=t?s5(n,t.index,r.length):s3(n,r.length)}else{let e=l.sort(s9).find(e=>e.index>n);a=e?s5(n,e.index,r.length):s3(n,r.length)}}else{let e=l.length&&l[l.length-1];a=e?s3(e.index,r.length):s8(r.length)}let d=o.clone().invert(),c=eI(r.map(e=>this.getShape(e))),u=c.filter(e=>e.isLocked);u.length&&this.updateShapes(u.map(({id:e,type:t})=>({id:e,type:t,isLocked:!1})));for(let e=0;e<c.length;e++){let n=c[e],r=this.getShapePageTransform(n);if(!r)continue;let o=r.point();if(!o)continue;let l=d.applyToPoint(o),u=r.rotation()-s;i.push({id:n.id,type:n.type,parentId:t,x:l.x,y:l.y,rotation:u,index:a[e],isLocked:n.isLocked})}return this.updateShapes(i),this}getHighestIndexForParent(e){let t="string"==typeof e?e:e.id,n=this._parentIdsToChildIds.get()[t];return n&&0!==n.length?s6(this.getShape(n[n.length-1]).index):"a1"}_childIdsCache=new sY;getSortedChildIdsForParent(e){let t="string"==typeof e?e:e.id,n=this._parentIdsToChildIds.get()[t];return n?this._childIdsCache.get(n,()=>n):N}visitDescendants(e,t){let n="string"==typeof e?e:e.id;for(let e of this.getSortedChildIdsForParent(n))!1!==t(e)&&this.visitDescendants(e,t);return this}getShapeAndDescendantIds(e){let t=new Set,n=[...e];for(;n.length>0;){let e=n.pop();if(!e)break;if(!t.has(e))for(let r of(t.add(e),this.getSortedChildIdsForParent(e)))n.push(r)}return t}getDroppingOverShape(e,t=[]){let n=this.getCurrentPageShapesSorted();for(let r=n.length-1;r>=0;r--){let i=n[r];if(!this.getShapeUtil(i).canDropShapes(i,t)||t.find(e=>e.id===i.id||this.hasAncestor(i,e.id)))continue;let o=this.getShapeMaskedPageBounds(i.id);if(o&&o.containsPoint(e)&&this.getShapeGeometry(i).hitTestPoint(this.getPointInShapeSpace(i,e),0,!0))return i}}getOutermostSelectableShape(e,t){let n="string"==typeof e?e:e.id,r=this.getShape(n),i=r,o=r,s=this.getFocusedGroup();for(;o;){if(this.isShapeOfType(o,"group")&&s?.id!==o.id&&!this.hasAncestor(s,o.id)&&(t?.(o)??!0))i=o;else if(s?.id===o.id)break;o=this.getShapeParent(o)}return i}rotateShapesBy(e,t){if(("string"==typeof e[0]?e:e.map(e=>e.id)).length<=0)return this;let n=function({editor:e}){let t=e.getSelectedShapes(),n=e.getSelectionRotation(),r=e.getSelectionRotatedPageBounds(),{inputs:{originPagePoint:i}}=e;if(!r)return null;let o=r.center.clone().rotWith(r.point,n);return{selectionPageCenter:o,initialCursorAngle:o.angle(i),initialSelectionRotation:n,shapeSnapshots:t.map(t=>({shape:e1(t),initialPagePoint:e.getShapePageTransform(t.id).point()}))}}({editor:this});return n&&function({delta:e,editor:t,snapshot:n,stage:r}){let{selectionPageCenter:i,shapeSnapshots:o}=n;t.updateShapes(o.map(({shape:n,initialPagePoint:r})=>{let o=nF(n.parentId)?t.getShapePageTransform(n.parentId):oj.Identity(),s=rG.RotWith(r,i,e),a=oj.applyToPoint(oj.Inverse(o),s),l=r8(n.rotation+e);return{id:n.id,type:n.type,x:a.x,y:a.y,rotation:l}}));let s=[];o.forEach(({shape:e})=>{let n=t.getShape(e.id);if(!n)return;let i=t.getShapeUtil(e);if("start"===r||"one-off"===r){let t=i.onRotateStart?.(e);t&&s.push(t)}let o=i.onRotate?.(e,n);if(o&&s.push(o),"end"===r||"one-off"===r){let t=i.onRotateEnd?.(e,n);t&&s.push(t)}}),s.length>0&&t.updateShapes(s)}({delta:t,snapshot:n,editor:this,stage:"one-off"}),this}getChangesToTranslateShape(e,t){let n=e,r=this.getShapeUtil(e);return n=aG(n,r.onTranslateStart?.(n)??void 0),n=aG(n,{id:e.id,type:e.type,x:t.x,y:t.y}),n=aG(n,r.onTranslate?.(e,n)??void 0),n=aG(n,r.onTranslateEnd?.(e,n)??void 0)}nudgeShapes(e,t,n){let r="string"==typeof e[0]?e:e.map(e=>e.id);if(r.length<=0)return this;let i=[];for(let e of r){let n=this.getShape(e),r=rG.From(t),o=this.getShapeParentTransform(n);o&&r.rot(-o.rotation()),i.push(this.getChangesToTranslateShape(n,r.add(n)))}return this.updateShapes(i,{squashing:!0,...n}),this}duplicateShapes(e,t){let n="string"==typeof e[0]?e:e.map(e=>e.id);if(n.length<=0)return this;let r=new Set(n),i=[],o=[...n];for(;o.length>0;){let e=o.pop();if(!e)break;i.push(e),this.getSortedChildIdsForParent(e).forEach(e=>o.push(e))}i.reverse();let s=new Map(i.map(e=>[e,nB()])),a=eI(i.map(e=>{let n=this.getShape(e);if(!n)return null;let i=s.get(e),o=0,a=0;if(t&&r.has(e)){let e=this.getShapeParentTransform(n),r=new rG(t.x,t.y).rot(-e.rotation());o=r.x,a=r.y}let l=n.parentId??this.getCurrentPageId(),d=this.getSortedChildIdsForParent(l),c=d.indexOf(n.id),u=d[c+1],h=u?this.getShape(u):null,p=h?s4(n.index,h.index):s6(n.index),g=eU(n);if(this.isShapeOfType(n,"arrow")&&this.isShapeOfType(g,"arrow")){let e,t;let r=this.getArrowInfo(n);if("binding"===n.props.start.type&&!(e=s.get(n.props.start.boundShapeId))){if(r?.isValid){let{x:e,y:t}=r.start.point;g.props.start={type:"point",x:e,y:t}}else{let{start:e}=aR(this,n);g.props.start={type:"point",x:e.x,y:e.y}}}if("binding"===n.props.end.type&&!(t=s.get(n.props.end.boundShapeId))){if(r?.isValid){let{x:e,y:t}=r.end.point;g.props.end={type:"point",x:e,y:t}}else{let{end:e}=aR(this,n);g.props.start={type:"point",x:e.x,y:e.y}}}let i=aT(g)?az(this,g):a$(this,g);if(r?.isValid&&i?.isValid&&!aT(n)){let e=rG.Med(r.start.handle,r.end.handle),t=rG.Dist(r.middle,e),n=rG.Dist(i.middle,e);g.props.bend<0?g.props.bend+=n-t:g.props.bend-=n-t}"binding"===g.props.start.type&&e&&(g.props.start.boundShapeId=e),"binding"===g.props.end.type&&t&&(g.props.end.boundShapeId=t)}return{...g,id:i,x:n.x+o,y:n.y+a,index:p}}));return a.forEach(e=>{nF(e.parentId)&&s.has(e.parentId)&&(e.parentId=s.get(e.parentId))}),this.history.batch(()=>{let e=a.length+this.getCurrentPageShapeIds().size>2e3;e&&aX(this);let n=e?a.slice(0,2e3-this.getCurrentPageShapeIds().size):a,r=n.map(e=>e.id);if(this.createShapes(n),this.setSelectedShapes(r),void 0!==t){let e=this.getSelectionPageBounds(),t=this.getViewportPageBounds();e&&!t.contains(e)&&this.centerOnPoint(e.center,{duration:320})}}),this}moveShapesToPage(e,t){let n="string"==typeof e[0]?e:e.map(e=>e.id);if(0===n.length||this.getInstanceState().isReadonly||t===this.getCurrentPageId()||!this.store.has(t))return this;let r=this.getContentFromCurrentPage(n);if(!r)return this;if(this.getPageShapeIds(t).size+r.shapes.length>2e3)return aX(this,t),this;let i=this.getCamera().z;return this.history.batch(()=>{this.deleteShapes(n),this.setCurrentPage(t),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(r,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:i}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(e){let t="string"==typeof e[0]?e:e.map(e=>e.id);if(this.getInstanceState().isReadonly||0===t.length)return this;let n=!0,r=!0,i=[];for(let e of t){let t=this.getShape(e);t&&(i.push(t),t.isLocked?r=!1:n=!1)}return this.batch(()=>{r?(this.updateShapes(i.map(e=>({id:e.id,type:e.type,isLocked:!0}))),this.setSelectedShapes([])):n?this.updateShapes(i.map(e=>({id:e.id,type:e.type,isLocked:!1}))):this.updateShapes(i.map(e=>({id:e.id,type:e.type,isLocked:!0})))}),this}sendToBack(e){let t=s7(this,"toBack","string"==typeof e[0]?e:e.map(e=>e.id));return t&&this.updateShapes(t),this}sendBackward(e){let t=s7(this,"backward","string"==typeof e[0]?e:e.map(e=>e.id));return t&&this.updateShapes(t),this}bringForward(e){let t=s7(this,"forward","string"==typeof e[0]?e:e.map(e=>e.id));return t&&this.updateShapes(t),this}bringToFront(e){let t=s7(this,"toFront","string"==typeof e[0]?e:e.map(e=>e.id));return t&&this.updateShapes(t),this}flipShapes(e,t){let n="string"==typeof e[0]?e:e.map(e=>e.id);if(this.getInstanceState().isReadonly)return this;let r=eI(n.map(e=>this.getShape(e)));if(!r.length)return this;r=eI(r.map(e=>this.isShapeOfType(e,"group")?this.getSortedChildIdsForParent(e.id).map(e=>this.getShape(e)):e).flat());let i=oE.Common(eI(r.map(e=>this.getShapePageBounds(e)))).center;return this.batch(()=>{for(let e of r){let n=this.getShapeGeometry(e).bounds,r=this.getShapePageTransform(e.id);r&&this.resizeShape(e.id,{x:"horizontal"===t?-1:1,y:"vertical"===t?-1:1},{initialBounds:n,initialPageTransform:r,initialShape:e,mode:"scale_shape",scaleOrigin:i,scaleAxisRotation:0})}}),this}stackShapes(e,t,n){let r,i,o,s,a;let l="string"==typeof e[0]?e:e.map(e=>e.id);if(this.getInstanceState().isReadonly)return this;let d=eI(l.map(e=>this.getShape(e)).filter(e=>!(!e||this.isShapeOfType(e,"arrow")&&("binding"===e.props.start.type||"binding"===e.props.end.type)))),c=d.length;if(0===n&&c<3||c<2)return this;let u=Object.fromEntries(d.map(e=>[e.id,this.getShapePageBounds(e)]));if("horizontal"===t?(r="x",i="minX",o="maxX",s="width"):(r="y",i="minY",o="maxY",s="height"),0===n){let e=[];d.sort((e,t)=>u[e.id][i]-u[t.id][i]);for(let t=0;t<c-1;t++){let n=d[t],r=d[t+1],s=u[n.id],a=u[r.id][i]-s[o],l=e.find(e=>e.gap===a);l?l.count++:e.push({gap:a,count:1})}let t=0;e.forEach(e=>{e.count>t&&(t=e.count,a=e.gap)}),1===t&&(a=Math.max(0,e.reduce((e,t)=>e+t.gap*t.count,0)/(c-1)))}else a=n;let h=[],p=u[d[0].id][o];return d.forEach((e,t)=>{if(0===t)return;let n={x:0,y:0};n[r]=p+a-u[e.id][r];let i=this.getShapeParent(e),o=i?rG.Rot(n,-this.getShapePageTransform(i).decompose().rotation):n,l=this.getShapeUtil(e).onTranslateStart?.(e);h.push(l?{...l,[r]:e[r]+o[r]}:{id:e.id,type:e.type,[r]:e[r]+o[r]}),p+=u[e.id][s]+a}),this.updateShapes(h),this}packShapes(e,t){let n,r,i;let o="string"==typeof e[0]?e:e.map(e=>e.id);if(this.getInstanceState().isReadonly||o.length<2)return this;let s=eI(o.map(e=>this.getShape(e)).filter(e=>!(!e||this.isShapeOfType(e,"arrow")&&("binding"===e.props.start.type||"binding"===e.props.end.type)))),a={},l={},d,c,u=0;for(let e=0;e<s.length;e++)d=s[e],c=this.getShapePageBounds(d),a[d.id]=c,l[d.id]=c.clone(),u+=c.width*c.height;let h=oE.Common(eI(Object.values(a))),p=h.width;s.sort((e,t)=>a[t.id].height-a[e.id].height);let g=Math.max(Math.ceil(Math.sqrt(u/.95)),p),f=[new oE(h.x,h.y,g,1/0)],m=0,y=0;for(let e=0;e<s.length;e++){c=l[(d=s[e]).id];for(let e=f.length-1;e>=0;e--)if(n=f[e],!(c.width>n.width)&&!(c.height>n.height)){c.x=n.x,c.y=n.y,y=Math.max(y,c.maxY),m=Math.max(m,c.maxX),c.width===n.width&&c.height===n.height?(r=f.pop(),e<f.length&&(f[e]=r)):c.height===n.height?(n.x+=c.width+t,n.width-=c.width+t):(c.width===n.width||f.push(new oE(n.x+(c.width+t),n.y,n.width-(c.width+t),c.height)),n.y+=c.height+t,n.height-=c.height+t);break}}let b=oE.Common(Object.values(l)),v=rG.Sub(h.center,b.center),x=[];for(let e=0;e<s.length;e++){c=a[(d=s[e]).id],i=l[d.id];let t=rG.Sub(i.point,c.point).add(v),n=this.getShapeParentTransform(d);n&&t.rot(-n.rotation());let r={id:d.id,type:d.type,x:d.x+t.x,y:d.y+t.y},o=this.getShapeUtil(d).onTranslateStart?.({...d,...r});o?x.push({...r,...o}):x.push(r)}return x.length&&this.updateShapes(x),this}alignShapes(e,t){let n="string"==typeof e[0]?e:e.map(e=>e.id);if(this.getInstanceState().isReadonly||n.length<2)return this;let r=eI(n.map(e=>this.getShape(e))),i=Object.fromEntries(r.map(e=>[e.id,this.getShapePageBounds(e)])),o=oE.Common(eI(Object.values(i))),s=[];return r.forEach(e=>{let n=i[e.id];if(!n)return;let r={x:0,y:0};switch(t){case"top":r.y=o.minY-n.minY;break;case"center-vertical":r.y=o.midY-n.minY-n.height/2;break;case"bottom":r.y=o.maxY-n.minY-n.height;break;case"left":r.x=o.minX-n.minX;break;case"center-horizontal":r.x=o.midX-n.minX-n.width/2;break;case"right":r.x=o.maxX-n.minX-n.width}let a=this.getShapeParent(e),l=a?rG.Rot(r,-this.getShapePageTransform(a).decompose().rotation):r;s.push(this.getChangesToTranslateShape(e,rG.Add(e,l)))}),this.updateShapes(s),this}distributeShapes(e,t){let n,r,i,o,s;let a="string"==typeof e[0]?e:e.map(e=>e.id);if(this.getInstanceState().isReadonly||a.length<3)return this;let l=a.length,d=eI(a.map(e=>this.getShape(e))),c=Object.fromEntries(d.map(e=>[e.id,this.getShapePageBounds(e)]));"horizontal"===t?(n="x",r="minX",i="maxX",o="midX",s="width"):(n="y",r="minY",i="maxY",o="midY",s="height");let u=[],h=d.sort((e,t)=>c[e.id][r]-c[t.id][r])[0],p=d.sort((e,t)=>c[t.id][i]-c[e.id][i])[0],g=c[h.id][o],f=(c[p.id][o]-g)/(l-1),m=g+f;return d.filter(e=>e!==h&&e!==p).sort((e,t)=>c[e.id][o]-c[t.id][o]).forEach((e,t)=>{let r={x:0,y:0};r[n]=m+f*t-c[e.id][s]/2-c[e.id][n];let i=this.getShapeParent(e),o=i?rG.Rot(r,-this.getShapePageTransform(i).rotation()):r;u.push(this.getChangesToTranslateShape(e,rG.Add(e,o)))}),this.updateShapes(u),this}stretchShapes(e,t){let n="string"==typeof e[0]?e:e.map(e=>e.id);if(this.getInstanceState().isReadonly||n.length<2)return this;let r=eI(n.map(e=>this.getShape(e))),i=Object.fromEntries(n.map(e=>[e,this.getShapeGeometry(e).bounds])),o=Object.fromEntries(n.map(e=>[e,this.getShapePageBounds(e)])),s=oE.Common(eI(Object.values(o)));switch(t){case"vertical":this.batch(()=>{for(let e of r){if(this.getShapePageTransform(e).rotation()%r1)continue;let t=i[e.id],n=o[e.id],r=new rG(0,s.minY-n.minY),a=this.getShapeParentTransform(e);a&&r.rot(-a.rotation());let{x:l,y:d}=rG.Add(r,e);this.updateShapes([{id:e.id,type:e.type,x:l,y:d}],{squashing:!0});let c=new rG(1,s.height/n.height);this.resizeShape(e.id,c,{initialBounds:t,scaleOrigin:new rG(n.center.x,s.minY),scaleAxisRotation:0})}});break;case"horizontal":this.batch(()=>{for(let e of r){let t=i[e.id],n=o[e.id];if(this.getShapePageTransform(e).rotation()%r1)continue;let r=new rG(s.minX-n.minX,0),a=this.getShapeParentTransform(e);a&&r.rot(-a.rotation());let{x:l,y:d}=rG.Add(r,e);this.updateShapes([{id:e.id,type:e.type,x:l,y:d}],{squashing:!0});let c=new rG(s.width/n.width,1);this.resizeShape(e.id,c,{initialBounds:t,scaleOrigin:new rG(s.minX,n.center.y),scaleAxisRotation:0})}})}return this}resizeShape(e,t,n={}){let r="string"==typeof e?e:e.id;if(this.getInstanceState().isReadonly)return this;Number.isFinite(t.x)||(t=new rG(1,t.y)),Number.isFinite(t.y)||(t=new rG(t.x,1));let i=n.initialShape??this.getShape(r);if(!i)return this;let o=n.scaleOrigin??this.getShapePageBounds(r)?.center;if(!o)return this;let s=n.initialPageTransform?oj.Cast(n.initialPageTransform):this.getShapePageTransform(r);if(!s)return this;let a=s.rotation();if(null==a)return this;let l=n.scaleAxisRotation??a,d=n.initialBounds??this.getShapeGeometry(r).bounds;if(!d)return this;if(!(a===l||r4(a%(Math.PI/2)-l%(Math.PI/2),0)))return this._resizeUnalignedShape(r,t,{...n,initialBounds:d,scaleOrigin:o,scaleAxisRotation:l,initialPageTransform:s,initialShape:i});let c=this.getShapeUtil(i);if(c.isAspectRatioLocked(i)&&(t=Math.abs(t.x)>Math.abs(t.y)?new rG(t.x,Math.sign(t.y)*Math.abs(t.x)):new rG(Math.sign(t.x)*Math.abs(t.y),t.y)),c.onResize&&c.canResize(i)){let e=this._scalePagePoint(oj.applyToPoint(s,new rG(0,0)),o,t,l),u=this.getPointInParentSpace(i.id,e),h=new rG(t.x,t.y),p=r4((a-l)%Math.PI,0);h.x=p?t.x:t.y,h.y=p?t.y:t.x;let g=oj.applyToPoint(s,new rG),{x:f,y:m}=this.getPointInParentSpace(i.id,g);this.updateShapes([{id:r,type:i.type,x:u.x,y:u.y,...c.onResize({...i,x:f,y:m},{newPoint:u,handle:n.dragHandle??"bottom_right",mode:n.mode??"scale_shape",scaleX:h.x,scaleY:h.y,initialBounds:d,initialShape:i})}],{squashing:!0})}else{let e=oj.applyToPoint(s,d.center),n=this._scalePagePoint(e,o,t,l),a=this.getPointInParentSpace(i.id,e),c=this.getPointInParentSpace(i.id,n),u=rG.Sub(c,a);this.updateShapes([{id:r,type:i.type,x:i.x+u.x,y:i.y+u.y}],{squashing:!0})}return this}_scalePagePoint(e,t,n,r){let i=rG.RotWith(e,t,-r).sub(t),o=rG.MulV(i,n);return rG.Add(o,t).rotWith(t,r)}_resizeUnalignedShape(e,t,n){let{type:r}=n.initialShape,i=new rG(t.x,t.y);if(Math.abs(t.x)>Math.abs(t.y)?i.x=Math.sign(t.x)*Math.abs(t.y):i.y=Math.sign(t.y)*Math.abs(t.x),this.resizeShape(e,i,{initialShape:n.initialShape,initialBounds:n.initialBounds}),Math.sign(t.x)*Math.sign(t.y)<0){let{rotation:t}=oj.Decompose(n.initialPageTransform);t-=2*t,this.updateShapes([{id:e,type:r,rotation:t}],{squashing:!0})}let o=oj.applyToPoint(n.initialPageTransform,n.initialBounds.center),s=this._scalePagePoint(o,n.scaleOrigin,t,n.scaleAxisRotation),a=this.getShapePageBounds(e),l=this.getShapePageTransform(e),d=a.center,c=l.point();if(!d||!c)return this;let u=rG.Sub(s,d),h=rG.Add(c,u),{x:p,y:g}=this.getPointInParentSpace(e,h);return this.updateShapes([{id:e,type:r,x:p,y:g}],{squashing:!0}),this}getInitialMetaForShape(e){return{}}createShape(e){return this._createShapes([e]),this}createShapes(e){if(!Array.isArray(e))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");return this._createShapes(e),this}_createShapes=this.history.createCommand("createShapes",e=>{if(this.getInstanceState().isReadonly||e.length<=0)return null;let t=this.getCurrentPageShapeIds();if(e.length+t.size>2e3){aX(this);return}return 0===e.length?null:{data:{currentPageId:this.getCurrentPageId(),partials:e.map(e=>e.id?e:{...e,id:nB()})}}},{do:({partials:e})=>{let t=this.getFocusedGroupId(),n=this.getCurrentPageShapesSorted();e=e.map(r=>{if(!r.parentId||!(this.store.has(r.parentId)||e.some(e=>e.id===r.parentId))){let e=this.getFocusedGroupId();for(let t=n.length-1;t>=0;t--){let i=n[t];if(this.getShapeUtil(i).canReceiveNewChildrenOfType(i,r.type)&&this.isPointInShape(i,{x:r.x??0,y:r.y??0},{margin:0,hitInside:!0})){e=i.id;break}}let i=r.parentId;if(e===r.id&&(e=t),e!==i&&((r={...r}).parentId=e,nF(e))){let t=this.getPointInShapeSpace(this.getShape(e),{x:r.x??0,y:r.y??0});r.x=t.x,r.y=t.y,r.rotation=-this.getShapePageTransform(e).rotation()+(r.rotation??0)}}return r});let r=new Map,i=[];for(let n of e){let e=this.getShapeUtil(n),o=n.index;if(!o){let e=n.parentId??t;r.has(e)||r.set(e,this.getHighestIndexForParent(e)),o=r.get(e),r.set(e,s6(o))}let s=e.getDefaultProps();for(let[e,t]of this.styleProps[n.type])s[t]=this.getStyleForNextShape(e);let a=this.store.schema.types.shape.create({...n,index:o,opacity:n.opacity??this.getInstanceState().opacityForNextShape,parentId:n.parentId??t,props:"props"in n?{...s,...n.props}:s});if(void 0===a.index)throw Error("no index!");let l=this.getShapeUtil(a).onBeforeCreate?.(a);l&&(a=l),i.push(a)}i.forEach(e=>{e.meta={...this.getInitialMetaForShape(e),...e.meta}}),this.store.put(i)},undo:({partials:e})=>{this.store.remove(e.map(e=>e.id))}});animatingShapes=new Map;animateShape(e,t){return this.animateShapes([e],t)}animateShapes(e,t={}){let n,r;let{duration:i=500,easing:o=ry.linear}=t,s=ss(),a=i,l=[];e.forEach(e=>{if(!e)return;let t={partial:e,values:[]},n=this.getShape(e.id);if(n){for(let r of["x","y","rotation"])void 0!==e[r]&&n[r]!==e[r]&&t.values.push({prop:r,from:n[r],to:e[r]});l.push(t),this.animatingShapes.set(n.id,s)}});let d=t=>{if((a-=t)<0){let{animatingShapes:t}=this,n=e.filter(e=>e&&t.get(e.id)===s);n.length&&this.updateShapes(n,{squashing:!1}),this.removeListener("tick",d);return}n=o(1-a/i);let{animatingShapes:c}=this;try{let e=[];for(let t=0;t<l.length;t++)r=l[t],c.get(r.partial.id)===s&&e.push({id:r.partial.id,type:r.partial.type,...r.values.reduce((e,{prop:t,from:r,to:i})=>(e[t]=r+(i-r)*n,e),{})});this._updateShapes(e,{squashing:!0})}catch(e){}};return this.addListener("tick",d),this}groupShapes(e,t=nB()){if(!Array.isArray(e))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getInstanceState().isReadonly)return this;let n="string"==typeof e[0]?e:e.map(e=>e.id);if(n.length<=1)return this;let r=eI(this._getUnlockedShapeIds(n).map(e=>this.getShape(e))),i=r.sort(s9).map(e=>e.id),{x:o,y:s}=oE.Common(eI(r.map(e=>this.getShapePageBounds(e)))).point,a=this.findCommonAncestor(r)??this.getCurrentPageId();if("select"!==this.getCurrentToolId())return this;this.isIn("select.idle")||this.cancel();let l=r.filter(e=>e.parentId===a).sort(s9),d=l[l.length-1]?.index;return this.batch(()=>{this.createShapes([{id:t,type:"group",parentId:a,index:d,x:o,y:s,opacity:1,props:{}}]),this.reparentShapes(i,t),this.select(t)}),this}ungroupShapes(e){let t="string"==typeof e[0]?e:e.map(e=>e.id);if(this.getInstanceState().isReadonly||0===t.length||"select"!==this.getCurrentToolId())return this;this.isIn("select.idle")||this.cancel();let n=new Set,r=eI(t.map(e=>this.getShape(e))),i=[];return r.forEach(e=>{this.isShapeOfType(e,"group")?i.push(e):n.add(e.id)}),0===i.length||this.batch(()=>{let e;for(let t=0,r=i.length;t<r;t++){e=i[t];let r=this.getSortedChildIdsForParent(e.id);for(let e=0,t=r.length;e<t;e++)n.add(r[e]);this.reparentShapes(r,e.parentId,e.index)}this.deleteShapes(i.map(e=>e.id)),this.select(...n)}),this}updateShape(e,t){return this.updateShapes([e],t),this}updateShapes(e,t){let n=eI(e);return this.animatingShapes.size>0&&n.forEach(e=>this.animatingShapes.delete(e.id)),n=n.filter(e=>{let t=this.getShape(e.id);return!(!t||this.isShapeOrAncestorLocked(t)&&!Object.hasOwn(e,"isLocked"))}),this._updateShapes(n,t),this}_updateShapes=this.history.createCommand("updateShapes",(e,t)=>{if(this.getInstanceState().isReadonly)return null;let n=eI(e),r=Object.fromEntries(eI(n.map(({id:e})=>this.getShape(e))).map(e=>[e.id,e]));if(n.length<=0)return null;let i=Object.fromEntries(eI(n.map(e=>{let t=r[e.id];return t?aG(t,e):null})).map(e=>[e.id,e]));return{data:{snapshots:r,updates:i},...t}},{do:({updates:e})=>{let t=Object.values(e);for(let e=0;e<t.length;e++){let n=t[e],r=this.store.get(n.id);if(!r)continue;let i=this.getShapeUtil(n).onBeforeUpdate?.(r,n);i&&(t[e]=i)}this.store.put(t)},undo:({snapshots:e})=>{this.store.put(Object.values(e))},squash:(e,t)=>({snapshots:{...t.snapshots,...e.snapshots},updates:{...e.updates,...t.updates}})});_getUnlockedShapeIds(e){return e.filter(e=>!this.getShape(e)?.isLocked)}deleteShapes(e){if(!Array.isArray(e))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");return this._deleteShapes(this._getUnlockedShapeIds("string"==typeof e[0]?e:e.map(e=>e.id))),this}deleteShape(e){return this.deleteShapes(["string"==typeof e?e:e.id]),this}_deleteShapes=this.history.createCommand("delete_shapes",e=>{if(this.getInstanceState().isReadonly||0===e.length)return null;let t=[...this.getCurrentPageState().selectedShapeIds],n=new Set(e);for(let t of e)this.visitDescendants(t,e=>{n.add(e)});let r=[...n],i=this._getArrowBindingsIndex().get(),o=eI(r.flatMap(e=>{let t=this.getShape(e),n=i[e];return n&&n.length>0?n.map(({arrowId:e})=>this.getShape(e)).concat(t):t})),s=t.filter(e=>!n.has(e));return{data:{deletedIds:r,snapshots:o,prevSelectedShapeIds:t,postSelectedShapeIds:s}}},{do:({deletedIds:e,postSelectedShapeIds:t})=>{this.store.remove(e),this.store.update(this.getCurrentPageState().id,e=>({...e,selectedShapeIds:t}))},undo:({snapshots:e,prevSelectedShapeIds:t})=>{this.store.put(e),this.store.update(this.getCurrentPageState().id,e=>({...e,selectedShapeIds:t}))}});_extractSharedStyles(e,t){if(this.isShapeOfType(e,"group")){let n=this._parentIdsToChildIds.get()[e.id];if(n)for(let e=0,r=n.length;e<r;e++)this._extractSharedStyles(this.getShape(n[e]),t)}else for(let[n,r]of this.styleProps[e.type])t.applyValue(n,eV(e.props,r))}_selectionSharedStyles=ep("_selectionSharedStyles",()=>{let e=this.getSelectedShapes(),t=new sH;for(let n of e)this._extractSharedStyles(n,t);return t});getStyleForNextShape(e){let t=this.getInstanceState().stylesForNextShape[e.id];return void 0===t?e.defaultValue:t}getShapeStyleIfExists(e,t){let n=this.styleProps[e.type].get(t);if(void 0!==n)return eV(e.props,n)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._selectionSharedStyles.get();let e=this.root.getCurrent(),t=new sH;if(!e)return t;if(e.shapeType)for(let n of this.styleProps[e.shapeType].keys())t.applyValue(n,this.getStyleForNextShape(n));return t}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){let e=[],t=n=>{let r=this.getShape(n);if(r){if(this.isShapeOfType(r,"group"))for(let e of this.getSortedChildIdsForParent(r.id))t(e);else e.push(r)}};for(let e of this.getSelectedShapeIds())t(e);let n=null;for(let t of e)if(null===n)n=t.opacity;else if(n!==t.opacity)return{type:"mixed"};if(null!==n)return{type:"shared",value:n}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(e,t){return this.updateInstanceState({opacityForNextShape:e},t),this}setOpacityForSelectedShapes(e,t){let n=this.getSelectedShapes();if(n.length>0){let r=[],i=e=>{if(this.isShapeOfType(e,"group"))for(let t of this.getSortedChildIdsForParent(e))i(this.getShape(t));else r.push(e)};for(let e of n)i(e);this.updateShapes(r.map(t=>({id:t.id,type:t.type,opacity:e})),t)}return this}setStyleForNextShapes(e,t,n){let r=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...r,[e.id]:t}},n),this}setStyleForSelectedShapes(e,t,n){let r=this.getSelectedShapes();if(r.length>0){let i=[],o=n=>{if(this.isShapeOfType(n,"group"))for(let e of this.getSortedChildIdsForParent(n.id))o(this.getShape(e));else{let r=this.getShapeUtil(n),o=this.styleProps[n.type].get(e);if(o){let e={id:n.id,type:n.type,props:{[o]:t}};i.push({util:r,originalShape:n,updatePartial:e})}}};for(let e of r)o(e);this.updateShapes(i.map(({updatePartial:e})=>e),n)}return this}externalAssetContentHandlers={file:null,url:null};registerExternalAssetHandler(e,t){return this.externalAssetContentHandlers[e]=t,this}async getAssetForExternalContent(e){return await this.externalAssetContentHandlers[e.type]?.(e)}externalContentHandlers={text:null,files:null,embed:null,"svg-text":null,url:null};registerExternalContentHandler(e,t){return this.externalContentHandlers[e]=t,this}async putExternalContent(e){return this.externalContentHandlers[e.type]?.(e)}getContentFromCurrentPage(e){let t="string"==typeof e[0]?e:e.map(e=>e.id);if(!t||0===t.length)return;let n={},r=eP(t.map(e=>this.getShape(e)).sort(s9).flatMap(e=>{let t=[e];return this.visitDescendants(e.id,e=>{t.push(this.getShape(e))}),t}));r=r.map(e=>{if(n[e.id]=this.getShapePageTransform(e.id),e=e1(e),this.isShapeOfType(e,"arrow")){let t="binding"===e.props.start.type?e.props.start.boundShapeId:void 0,n="binding"===e.props.end.type?e.props.end.boundShapeId:void 0,i=this.getArrowInfo(e);if("binding"===e.props.start.type&&!r.some(e=>e.id===t)){if(i?.isValid){let{x:t,y:n}=i.start.point;e.props.start={type:"point",x:t,y:n}}else{let{start:t}=aR(this,e);e.props.start={type:"point",x:t.x,y:t.y}}}if("binding"===e.props.end.type&&!r.some(e=>e.id===n)){if(i?.isValid){let{x:t,y:n}=i.end.point;e.props.end={type:"point",x:t,y:n}}else{let{end:t}=aR(this,e);e.props.end={type:"point",x:t.x,y:t.y}}}let o=aT(e)?az(this,e):a$(this,e);if(i?.isValid&&o?.isValid&&!aT(e)){let t=rG.Med(i.start.handle,i.end.handle),n=rG.Dist(i.middle,t),r=rG.Dist(o.middle,t);e.props.bend<0?e.props.bend+=r-n:e.props.bend-=r-n}}return e});let i=[];r.forEach(e=>{if(void 0===r.find(t=>t.id===e.parentId)){let t=this.getShapePageTransform(e.id),n=t.point(),r=t.rotation();e.x=n.x,e.y=n.y,e.rotation=r,e.parentId=this.getCurrentPageId(),i.push(e.id)}});let o=new Set;return r.forEach(e=>{"assetId"in e.props&&null!==e.props.assetId&&o.add(e.props.assetId)}),{shapes:r,rootShapeIds:i,schema:this.store.schema.serialize(),assets:eI(Array.from(o).map(e=>this.getAsset(e)))}}putContentOntoCurrentPage(e,t={}){if(this.getInstanceState().isReadonly)return this;if(!e.schema)throw Error("Could not put content:\ncontent is missing a schema.");let{select:n=!1,preserveIds:r=!1,preservePosition:i=!1}=t,{point:o}=t,s=this.getCurrentPageId(),{assets:a,shapes:l,rootShapeIds:d}=e,c=new Map(l.map(e=>[e.id,nB()])),u=this.getCurrentPageId(),h=1/0,p=[];for(let e of this.getSelectedShapes()){if(0===h)break;let t=this.isShapeOfType(e,"frame"),n=this.getShapeAncestors(e);t&&n.push(e);let r=t?n.length+1:n.length;if(r<h)h=r,p=n,u=t?e.id:e.parentId;else if(r===h){if(p.length!==n.length)throw Error(`Ancestors: ${p.length} !== ${n.length}`);if(0===p.length){u=s;break}u=s;for(let e=0;e<p.length&&n[e]===p[e];e++)u=n[e].id}}let g=!1;if(!t8(u)){let e=this.getShape(u);if(e){if(this.getViewportPageBounds().includes(this.getShapePageBounds(e))){if(1===d.length){let t=l.find(e=>e.id===d[0]);this.isShapeOfType(e,"frame")&&this.isShapeOfType(t,"frame")&&t.props.w===e?.props.w&&t.props.h===e?.props.h&&(g=!0)}}else u=s}else u=s}g||(g=c.has(u)),g&&(u=this.getShape(u).parentId);let f=this.getHighestIndexForParent(u),m=[],y=l.map(e=>{let t;if(r)t=eU(e),c.set(e.id,e.id);else{let n=c.get(e.id);t=eU({...e,id:n})}if(d.includes(e.id)&&(t.parentId=s,m.push(t)),c.has(t.parentId)?t.parentId=c.get(e.parentId):(d.push(t.id),t.index=f,f=s6(f)),this.isShapeOfType(t,"arrow")){if("binding"===t.props.start.type){let e=c.get(t.props.start.boundShapeId);t.props.start=e?{...t.props.start,boundShapeId:e}:{type:"point",x:0,y:0}}if("binding"===t.props.end.type){let e=c.get(t.props.end.boundShapeId);t.props.end=e?{...t.props.end,boundShapeId:e}:{type:"point",x:0,y:0}}}return t});if(y.length+this.getCurrentPageShapeIds().size>2e3)return aX(this),this;let b=[];if(a){for(let t=0;t<a.length;t++){let n=a[t],r=this.store.schema.migratePersistedRecord(n,e.schema);if("success"===r.type)a[t]=r.value;else throw Error(`Could not put content:
could not migrate content for asset:
${n.id}
${n.type}
reason:${r.reason}`)}let t=[];b=a.filter(e=>!this.store.has(e.id)).map(e=>(("image"===e.type||"video"===e.type)&&(e.props.src&&e.props.src?.startsWith("data:image")?(t.push(e1(e)),e.props.src=null):t.push(e1(e))),e)),Promise.allSettled(t.map(async e=>{var t,n,r;let i=await (t=e.props.src,n=e.props.name,r=e.props.mimeType??"image/png",fetch(t).then(function(e){return e.arrayBuffer()}).then(function(e){return new File([e],n,{type:r})})),o=await this.getAssetForExternalContent({type:"file",file:i});return o?[e,o]:null})).then(e=>{this.updateAssets(eI(e.map(e=>"fulfilled"===e.status&&e.value?{...e.value[1],id:e.value[0].id}:void 0)))})}for(let t=0;t<y.length;t++){let n=y[t],r=this.store.schema.migratePersistedRecord(n,e.schema);if("success"===r.type)y[t]=r.value;else throw Error(`Could not put content:
could not migrate content for shape:
${n.id}, ${n.type}
reason:${r.reason}`)}return this.batch(()=>{b.length>0&&this.createAssets(b),this.createShapes(y),n&&this.select(...m.map(e=>e.id)),u!==s&&this.reparentShapes(m.map(e=>e.id),u);let e=y.map(e=>this.getShape(e.id)),t=oE.Common(e.map(e=>this.getShapePageBounds(e)));if(void 0===o){if(t8(u)){let e=this.getViewportPageBounds();o=i||e.includes(oE.From(t))?t.center:e.center}else{let e=this.getShape(u);o=oj.applyToPoint(this.getShapePageTransform(e),this.getShapeGeometry(e).bounds.center)}}if(1===m.length){let e=m[0];if(this.isShapeOfType(e,"frame"))for(;this.getShapesAtPoint(o).some(t=>this.isShapeOfType(t,"frame")&&t.props.w===e.props.w&&t.props.h===e.props.h);)o.x+=t.w+16}let r=oE.Common(eI(m.map(({id:e})=>this.getShapePageBounds(e)))).center,a=rG.Sub(o,r);this.updateShapes(m.map(({id:e})=>{let t=this.getShape(e),n=this.getShapeParentTransform(e).decompose().rotation,r=rG.Rot(a,-n);return{id:t.id,type:t.type,x:t.x+r.x,y:t.y+r.y}}))}),this}async getSvg(e,t={}){let n="string"==typeof e[0]?e:e.map(e=>e.id);if(0===n.length)return;if(!window.document)throw Error("No document");let{scale:r=1,background:i=!1,padding:o=32,preserveAspectRatio:s=!1}=t,a=nW({isDarkMode:this.user.getIsDarkMode()}),l=this.getShapeAndDescendantIds(n),d=this.getUnorderedRenderingShapes(!1).filter(({id:e})=>l.has(e)),c=null;if(t.bounds)c=t.bounds;else for(let{maskedPageBounds:e}of d)e&&(c?c.union(e):c=e.clone());if(!c)return;let u=1===n.length&&this.isShapeOfType(this.getShape(n[0]),"frame")?n[0]:null;u||c.expandBy(o);let h=c.width*r,p=c.height*r,g=window.document.createElementNS("http://www.w3.org/2000/svg","svg");s&&g.setAttribute("preserveAspectRatio",s),g.setAttribute("direction","ltr"),g.setAttribute("width",h+""),g.setAttribute("height",p+""),g.setAttribute("viewBox",`${c.minX} ${c.minY} ${c.width} ${c.height}`),g.setAttribute("stroke-linecap","round"),g.setAttribute("stroke-linejoin","round"),i?u?g.style.setProperty("background",a.solid):g.style.setProperty("background-color",a.background):g.style.setProperty("background-color","transparent");try{document.body.focus?.()}catch(e){}let f=window.document.createElementNS("http://www.w3.org/2000/svg","defs");g.append(f);let m=new Map,y={addExportDef:e=>{if(m.has(e.key))return;let t=(async()=>{let t=await e.getElement();if(!t)return;let n=document.createComment(`def: ${e.key}`);for(let e of(f.appendChild(n),Array.isArray(t)?t:[t]))f.appendChild(e)})();m.set(e.key,t)}},b=(await Promise.all(d.map(async({id:e,opacity:t,index:n,backgroundIndex:r})=>{if(e===u)return[];let i=this.getShape(e);if(this.isShapeOfType(i,"group"))return[];let o=this.getShapeUtil(i),s=await o.toSvg?.(i,y),l=await o.toBackgroundSvg?.(i,y);if(s){let e=document.createElementNS("http://www.w3.org/2000/svg","g");e.appendChild(s),s=e}if(l){let e=document.createElementNS("http://www.w3.org/2000/svg","g");e.appendChild(l),l=e}if(!s&&!l){let e=this.getShapePageBounds(i),t=window.document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("width",e.width+""),t.setAttribute("height",e.height+""),t.setAttribute("fill",a.solid),t.setAttribute("stroke",a.grey.pattern),t.setAttribute("stroke-width","1"),s=t}let d=this.getShapePageTransform(i).toCssString();"scale"in i.props&&1!==i.props.scale&&(d=`${d} scale(${i.props.scale}, ${i.props.scale})`),s?.setAttribute("transform",d),l?.setAttribute("transform",d),s?.setAttribute("opacity",t+""),l?.setAttribute("opacity",t+"");let c=this.getShapeMask(i.id);if(c){let e=document.createElementNS("http://www.w3.org/2000/svg","clipPath");f.appendChild(e);let t=ss();e.id=t;let n=document.createElementNS("http://www.w3.org/2000/svg","path");if(n.setAttribute("d",`M${c.map(({x:e,y:t})=>`${e},${t}`).join("L")}Z`),e.appendChild(n),s){let e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttribute("clip-path",`url(#${t})`),e.appendChild(s),s=e}if(l){let e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttribute("clip-path",`url(#${t})`),e.appendChild(l),l=e}}let h=[];return s&&h.push({zIndex:n,element:s}),l&&h.push({zIndex:r,element:l}),h}))).flat();for(let{element:e}of(await Promise.all(m.values()),b.sort((e,t)=>e.zIndex-t.zIndex)))g.appendChild(e);return g}inputs={originPagePoint:new rG,originScreenPoint:new rG,previousPagePoint:new rG,previousScreenPoint:new rG,currentPagePoint:new rG,currentScreenPoint:new rG,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,pointerVelocity:new rG};_updateInputsFromEvent(e){let{previousScreenPoint:t,previousPagePoint:n,currentScreenPoint:r,currentPagePoint:i}=this.inputs,{screenBounds:o}=this.store.unsafeGetWithoutCapture(ne),{x:s,y:a,z:l}=e.point,{x:d,y:c,z:u}=this.getCamera();t.setTo(r),n.setTo(i),r.set(s,a),i.set((s-o.x)/u-d,(a-o.y)/u-c,l??.5),this.inputs.isPen="pointer"===e.type&&e.isPen,"pointer_down"===e.name&&this.inputs.pointerVelocity.set(0,0),this.store.put([{id:nd,typeName:"pointer",x:i.x,y:i.y,lastActivityTimestamp:"pointer"===e.type&&e.pointerId===rw.CAMERA_MOVE?this.store.get(nd)?.lastActivityTimestamp??Date.now():Date.now(),meta:{}}])}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}_clickManager=new ai(this);cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}_prevCursor="default";_shiftKeyTimeout=-1;_setShiftKeyTimeout=()=>{this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ShiftLeft"})};_altKeyTimeout=-1;_setAltKeyTimeout=()=>{this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"AltLeft"})};_ctrlKeyTimeout=-1;_setCtrlKeyTimeout=()=>{this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ControlLeft"})};_restoreToolId="select";_pinchStart=1;_didPinch=!1;_selectedShapeIdsAtPointerDown=[];capturedPointerId=null;dispatch=e=>{if(this.getCrashingError())return this;let{inputs:t}=this,{type:n}=e;return this.batch(()=>{if("misc"===e.type){("cancel"===e.name||"complete"===e.name)&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}}))),this.root.handleEvent(e);return}e.shiftKey?(clearInterval(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,t.shiftKey=!0):!e.shiftKey&&t.shiftKey&&-1===this._shiftKeyTimeout&&(this._shiftKeyTimeout=setTimeout(this._setShiftKeyTimeout,150)),e.altKey?(clearInterval(this._altKeyTimeout),this._altKeyTimeout=-1,t.altKey=!0):!e.altKey&&t.altKey&&-1===this._altKeyTimeout&&(this._altKeyTimeout=setTimeout(this._setAltKeyTimeout,150)),e.ctrlKey?(clearInterval(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,t.ctrlKey=!0):!e.ctrlKey&&t.ctrlKey&&-1===this._ctrlKeyTimeout&&(this._ctrlKeyTimeout=setTimeout(this._setCtrlKeyTimeout,150));let{originPagePoint:r,originScreenPoint:i,currentPagePoint:o,currentScreenPoint:s}=t;switch(t.isPointing||(t.isDragging=!1),n){case"pinch":if(!this.getInstanceState().canMoveCamera)return;switch(this._updateInputsFromEvent(e),e.name){case"pinch_start":if(t.isPinching)return;t.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds()),this._didPinch=!0,t.isPinching=!0,this.interrupt());return;case"pinch":{if(!t.isPinching)return;let{point:{x:n,y:r,z:i=1},delta:{x:o,y:s}}=e,{x:a,y:l,z:d}=this.getCamera(),c=Math.min(8,Math.max(.1,i));this.setCamera({x:a+o/d-n/d+n/c,y:l+s/d-r/d+r/c,z:c});return}case"pinch_end":{if(!t.isPinching)return this;t.isPinching=!1;let{_selectedShapeIdsAtPointerDown:e}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown,{squashing:!0}),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,requestAnimationFrame(()=>{this._didPinch||this.setSelectedShapes(e,{squashing:!0})}));return}}case"wheel":if(!this.getInstanceState().canMoveCamera)return;if(this._updateInputsFromEvent(e),this.getIsMenuOpen());else{if(t.ctrlKey){let{x:t,y:n}=this.inputs.currentScreenPoint,{x:r,y:i,z:o}=this.getCamera(),s=Math.min(8,Math.max(.1,o+(e.delta.z??0)*o));this.setCamera({x:r+(t/s-t)-(t/o-t),y:i+(n/s-n)-(n/o-n),z:s});return}this.pan(e.delta),!t.isDragging&&t.isPointing&&r.dist(o)>(this.getInstanceState().isCoarsePointer?6:4)/this.getZoomLevel()&&(t.isDragging=!0)}break;case"pointer":{if(t.isPinching)return;this._updateInputsFromEvent(e);let{isPen:n}=e;switch(e.name){case"pointer_down":if(this.clearOpenMenus(),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),0===e.button&&(this.capturedPointerId=e.pointerId),t.buttons.add(e.button),t.isPointing=!0,t.isDragging=!1,this.getInstanceState().isPenMode){if(!n)return}else n&&this.updateInstanceState({isPenMode:!0});if(5===e.button?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):1===e.button&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0),this.inputs.isPanning)return this.stopCameraAnimation(),this.updateInstanceState({cursor:{type:"grabbing",rotation:0}}),this;i.setTo(s),r.setTo(o);break;case"pointer_move":if(!n&&this.getInstanceState().isPenMode)return;if(this.inputs.isPanning&&this.inputs.isPointing){let{currentScreenPoint:e,previousScreenPoint:t}=this.inputs;this.pan(rG.Sub(e,t));return}!t.isDragging&&t.isPointing&&r.dist(o)>(this.getInstanceState().isCoarsePointer?6:4)/this.getZoomLevel()&&(t.isDragging=!0);break;case"pointer_up":if(t.buttons.delete(e.button),t.isPointing=!1,t.isDragging=!1,this.getIsMenuOpen()||!n&&this.getInstanceState().isPenMode)return;this.capturedPointerId===e.pointerId&&(this.capturedPointerId=null,e.button=0),t.isPanning?1===e.button?this.inputs.keys.has(" ")?(this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:.09}),this.updateInstanceState({cursor:{type:"grab",rotation:0}})):(t.isPanning=!1,this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:.09}),this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}})):0===e.button&&(this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:.09}),this.updateInstanceState({cursor:{type:"grab",rotation:0}})):5===e.button&&(this.complete(),this.setCurrentTool(this._restoreToolId))}break}case"keyboard":switch("ShiftRight"===e.key&&(e.key="ShiftLeft"),"AltRight"===e.key&&(e.key="AltLeft"),"ControlRight"===e.code&&(e.code="ControlLeft"),e.name){case"key_down":t.keys.add(e.code),e.ctrlKey||"Space"!==e.code||(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,this.updateInstanceState({cursor:{type:this.inputs.isPointing?"grabbing":"grab",rotation:0}}));break;case"key_up":t.keys.delete(e.code),"Space"!==e.code||this.inputs.buttons.has(1)||(this.inputs.isPanning=!1,this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}}))}}if("pointer"===e.type&&(1===e.button?e.name="middle_click":2===e.button&&(e.name="right_click"),e.isPen===this.getInstanceState().isPenMode))switch(e.name){case"pointer_down":{let t=this._clickManager.transformPointerDownEvent(e);if(e.name!==t.name){this.root.handleEvent(e),this.emit("event",e),this.root.handleEvent(t),this.emit("event",t);return}break}case"pointer_up":{let t=this._clickManager.transformPointerUpEvent(e);if(e.name!==t.name){this.root.handleEvent(e),this.emit("event",e),this.root.handleEvent(t),this.emit("event",t);return}break}case"pointer_move":this._clickManager.handleMove()}this.root.handleEvent(e),this.emit("event",e)}),this}}function aX(e,t=e.getCurrentPageId()){let n=e.getPage(t).name;e.emit("max-shapes",{name:n,pageId:t,count:2e3})}function aG(e,t){if(!t)return e;let n=null;for(let[r,i]of Object.entries(t))if(void 0!==i)switch(r){case"id":case"type":continue;default:if(i!==e[r]){if(n||(n={...e}),"props"===r){let t={...e.props};for(let[e,n]of Object.entries(i))void 0!==n&&(t[e]=n);n.props=t}else if("meta"===r){let t={...e.meta};for(let[e,n]of Object.entries(i))void 0!==n&&(t[e]=n);n.meta=t}else n[r]=i}}return n??e}function aq(){let e=rR();return e_("isDarkMode",()=>e.user.getIsDarkMode(),[e])}aY([ep],aW.prototype,"getCanUndo",1),aY([ep],aW.prototype,"getCanRedo",1),aY([ep],aW.prototype,"_getArrowBindingsIndex",1),aY([ep],aW.prototype,"getArrowInfoCache",1),aY([ep],aW.prototype,"getPath",1),aY([ep],aW.prototype,"getCurrentTool",1),aY([ep],aW.prototype,"getCurrentToolId",1),aY([ep],aW.prototype,"getDocumentSettings",1),aY([ep],aW.prototype,"getInstanceState",1),aY([ep],aW.prototype,"getOpenMenus",1),aY([ep],aW.prototype,"getIsMenuOpen",1),aY([ep],aW.prototype,"getPageStates",1),aY([ep],aW.prototype,"_getPageStatesQuery",1),aY([ep],aW.prototype,"getCurrentPageState",1),aY([ep],aW.prototype,"_getCurrentPageStateId",1),aY([ep],aW.prototype,"getSelectedShapeIds",1),aY([ep],aW.prototype,"getSelectedShapes",1),aY([ep],aW.prototype,"getOnlySelectedShape",1),aY([ep],aW.prototype,"getSelectionPageBounds",1),aY([ep],aW.prototype,"getSelectionRotation",1),aY([ep],aW.prototype,"getSelectionRotatedPageBounds",1),aY([ep],aW.prototype,"getFocusedGroupId",1),aY([ep],aW.prototype,"getFocusedGroup",1),aY([ep],aW.prototype,"getEditingShapeId",1),aY([ep],aW.prototype,"getEditingShape",1),aY([ep],aW.prototype,"getHoveredShapeId",1),aY([ep],aW.prototype,"getHoveredShape",1),aY([ep],aW.prototype,"getHintingShapeIds",1),aY([ep],aW.prototype,"getHintingShape",1),aY([ep],aW.prototype,"getErasingShapeIds",1),aY([ep],aW.prototype,"getErasingShapes",1),aY([ep],aW.prototype,"getCameraId",1),aY([ep],aW.prototype,"getCamera",1),aY([ep],aW.prototype,"getZoomLevel",1),aY([ep],aW.prototype,"getViewportScreenBounds",1),aY([ep],aW.prototype,"getViewportScreenCenter",1),aY([ep],aW.prototype,"getViewportPageBounds",1),aY([ep],aW.prototype,"getViewportPageCenter",1),aY([ep],aW.prototype,"getRenderingShapes",1),aY([ep],aW.prototype,"_getAllPagesQuery",1),aY([ep],aW.prototype,"getPages",1),aY([ep],aW.prototype,"_getAllAssetsQuery",1),aY([ep],aW.prototype,"_getShapeGeometryCache",1),aY([ep],aW.prototype,"_getShapeOutlineSegmentsCache",1),aY([ep],aW.prototype,"_getShapeHandlesCache",1),aY([ep],aW.prototype,"_getShapePageTransformCache",1),aY([ep],aW.prototype,"_getShapePageBoundsCache",1),aY([ep],aW.prototype,"_getShapeClipPathCache",1),aY([ep],aW.prototype,"_getShapeMaskCache",1),aY([ep],aW.prototype,"getCurrentPageBounds",1),aY([ep],aW.prototype,"getCurrentPageShapes",1),aY([ep],aW.prototype,"getCurrentPageShapesSorted",1),aY([ep],aW.prototype,"getCurrentPageRenderingShapesSorted",1),aY([ep({isEqual:(e,t)=>e.equals(t)})],aW.prototype,"getSharedStyles",1),aY([ep],aW.prototype,"getSharedOpacity",1);let aZ="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",aJ="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",aQ='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function a0(e,t,n,r,i,o=16,s=16){let a=rQ/180*(-n-t),l=Math.sin(a),d=Math.cos(a);return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${i};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${1*d-1*l}' dy='${1*l+1*d}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${t+n} 16 16)${r?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+e.replaceAll('"',"'")+`</g></svg>") ${o} ${s}, pointer`}let a1=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],a2={none:()=>"none","ew-resize":(e,t,n)=>a0(aJ,e,0,t,n),"ns-resize":(e,t,n)=>a0(aJ,e,90,t,n),"nesw-resize":(e,t,n)=>a0(aZ,e,0,t,n),"nwse-resize":(e,t,n)=>a0(aZ,e,90,t,n),"nwse-rotate":(e,t,n)=>a0(aQ,e,0,t,n),"nesw-rotate":(e,t,n)=>a0(aQ,e,90,t,n),"senw-rotate":(e,t,n)=>a0(aQ,e,180,t,n),"swne-rotate":(e,t,n)=>a0(aQ,e,270,t,n)};function a5(e,t=0,n="black"){return a2[e](180*t/rQ,!1,n)}let a3="TLDRAW_TAB_ID_v2",a4=globalThis.window,a6=a4?.[a3]??a4?.sessionStorage[a3]??"TLDRAW_INSTANCE_STATE_V1_"+ss();a4&&(a4[a3]=a6,a4&&(["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(a4.navigator.platform)||a4.navigator.userAgent.includes("Mac")&&"ontouchend"in document)?a4.sessionStorage[a3]=a6:delete a4.sessionStorage[a3]),a4?.addEventListener("beforeunload",()=>{a4.sessionStorage[a3]=a6});let a8=tT({version:tw,currentPageId:t5,isFocusMode:tI,exportBackground:tI,isDebugMode:tI,isToolLocked:tI,isGridMode:tI,pageStates:tM(tT({pageId:t5,camera:tT({x:tw,y:tw,z:tw}),selectedShapeIds:tM(nn),focusedGroupId:nn.nullable()}))}),a9=to({currentVersion:0}),a7=(e,t)=>t.some(t=>e instanceof t),le=new WeakMap,lt=new WeakMap,ln=new WeakMap,lr=new WeakMap,li=new WeakMap,lo={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return lt.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ln.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ls(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function ls(e){var t;if(e instanceof IDBRequest)return function(e){let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{t(ls(e.result)),r()},o=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",o)});return t.then(t=>{t instanceof IDBCursor&&le.set(t,e)}).catch(()=>{}),li.set(t,e),t}(e);if(lr.has(e))return lr.get(e);let n="function"==typeof(t=e)?t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(u||(u=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(la(this),e),ls(le.get(this))}:function(...e){return ls(t.apply(la(this),e))}:function(e,...n){let r=t.call(la(this),e,...n);return ln.set(r,e.sort?e.sort():[e]),ls(r)}:(t instanceof IDBTransaction&&function(e){if(lt.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=()=>{t(),r()},o=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)});lt.set(e,t)}(t),a7(t,c||(c=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(t,lo):t;return n!==e&&(lr.set(e,n),li.set(n,e)),n}let la=e=>li.get(e),ll=["get","getKey","getAll","getAllKeys","count"],ld=["put","add","delete","clear"],lc=new Map;function lu(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(lc.get(t))return lc.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=ld.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||ll.includes(n)))return;let o=async function(e,...t){let o=this.transaction(e,i?"readwrite":"readonly"),s=o.store;return r&&(s=s.index(t.shift())),(await Promise.all([s[n](...t),i&&o.done]))[0]};return lc.set(t,o),o}lo={...f=lo,get:(e,t,n)=>lu(e,t)||f.get(e,t,n),has:(e,t)=>!!lu(e,t)||f.has(e,t)};let lh="TLDRAW_DOCUMENT_v2",lp="TLDRAW_DB_NAME_INDEX_v2",lg={Records:"records",Schema:"schema",SessionState:"session_state"};async function lf(e,t){(function(e){let t=new Set(lx());t.add(e),window?.localStorage.setItem(lp,JSON.stringify([...t]))})(e);let n=await function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){let s=indexedDB.open(e,3),a=ls(s);return r&&s.addEventListener("upgradeneeded",e=>{r(ls(s.result),e.oldVersion,e.newVersion,ls(s.transaction),e)}),n&&s.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{o&&e.addEventListener("close",()=>o()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a}(e,0,{upgrade(e){e.objectStoreNames.contains(lg.Records)||e.createObjectStore(lg.Records),e.objectStoreNames.contains(lg.Schema)||e.createObjectStore(lg.Schema),e.objectStoreNames.contains(lg.SessionState)||e.createObjectStore(lg.SessionState)}});try{return await t(n)}finally{n.close()}}async function lm({persistenceKey:e,sessionId:t,didCancel:n}){let r=lh+e;if(lx().includes(r))return await lv({persistenceKey:e,didCancel:n}),await lf(r,async e=>{if(n?.())return;let r=e.transaction([lg.Records,lg.Schema,lg.SessionState],"readonly"),i=r.objectStore(lg.Records),o=r.objectStore(lg.Schema),s=r.objectStore(lg.SessionState),a=t?(await s.get(t))?.snapshot:null;if(!a){let e=await s.getAll();a=e.sort((e,t)=>e.updatedAt-t.updatedAt).pop()?.snapshot}let l={records:await i.getAll(),schema:await o.get(lg.Schema),sessionStateSnapshot:a};if(n?.()){r.abort();return}return await r.done,l})}async function ly({persistenceKey:e,schema:t,changes:n,sessionId:r,sessionStateSnapshot:i,didCancel:o}){await lf(lh+e,async e=>{let s=e.transaction([lg.Records,lg.Schema,lg.SessionState],"readwrite"),a=s.objectStore(lg.Records),l=s.objectStore(lg.Schema),d=s.objectStore(lg.SessionState);for(let[e,t]of Object.entries(n.added))await a.put(t,e);for(let[e,t]of Object.values(n.updated))await a.put(t,t.id);for(let e of Object.keys(n.removed))await a.delete(e);if(l.put(t.serialize(),lg.Schema),i&&r?d.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together"),o?.())return s.abort();await s.done})}async function lb({persistenceKey:e,schema:t,snapshot:n,sessionId:r,sessionStateSnapshot:i,didCancel:o}){await lf(lh+e,async e=>{let s=e.transaction([lg.Records,lg.Schema,lg.SessionState],"readwrite"),a=s.objectStore(lg.Records),l=s.objectStore(lg.Schema),d=s.objectStore(lg.SessionState);for(let[e,t]of(await a.clear(),Object.entries(n)))await a.put(t,e);if(l.put(t.serialize(),lg.Schema),i&&r?d.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together"),o?.())return s.abort();await s.done})}async function lv({persistenceKey:e,didCancel:t}){await lf(lh+e,async e=>{let n=e.transaction([lg.SessionState],"readwrite"),r=n.objectStore(lg.SessionState),i=(await r.getAll()).sort((e,t)=>e.updatedAt-t.updatedAt);if(i.length<10){await n.done;return}for(let{id:e}of i.slice(0,i.length-10))await r.delete(e);if(t?.())return n.abort();await n.done})}function lx(){let e=JSON.parse(window?.localStorage.getItem(lp)||"[]")??[];return Array.isArray(e)?e:[]}let lS=Symbol("UPDATE_INSTANCE_STATE"),lw=e=>e;class lC{onmessage;constructor(e){}postMessage(e){}close(){}}let l_="undefined"==typeof BroadcastChannel?lC:BroadcastChannel;class lk{constructor(e,{persistenceKey:t,sessionId:n=a6,onLoad:r,onLoadError:i},o=new l_(`tldraw-tab-sync-${t}`)){this.store=e,this.channel=o,"undefined"!=typeof window&&(window.tlsync=this),this.persistenceKey=t,this.sessionId=n,this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=function(e){let t=e.query.ids("page");return ep("sessionStateSnapshot",()=>{let n=e.get(ne);if(!n)return null;let r=[...t.get()];return{version:0,currentPageId:n.currentPageId,exportBackground:n.exportBackground,isFocusMode:n.isFocusMode,isDebugMode:n.isDebugMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,pageStates:r.map(t=>{let n=e.get(no.createId(t)),r=e.get(tX.createId(t));return{pageId:t,camera:{x:r?.x??0,y:r?.y??0,z:r?.z??1},selectedShapeIds:n?.selectedShapeIds??[],focusedGroupId:n?.focusedGroupId??null}})}})}(this.store),this.disposables.add(e.listen(({changes:e})=>{this.diffQueue.push(e),this.channel.postMessage(lw({type:"diff",storeId:this.store.id,changes:e,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(lS),this.schedulePersist()},{scope:"session"})),this.connect(r,i),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(e=>"document"===e.scope).map(e=>e.typeName))}disposables=new Set;diffQueue=[];didDispose=!1;shouldDoFullDBWrite=!0;isReloading=!1;persistenceKey;sessionId;serializedSchema;isDebugging=!1;documentTypes;$sessionStateSnapshot;initTime=Date.now();debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,t){let n;this.debug("connecting");try{n=await lm({persistenceKey:this.persistenceKey,sessionId:this.sessionId,didCancel:()=>this.didDispose})}catch(e){t(e),window.alert(`Oops! We could not access your browser's storage\u2014and the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`),"undefined"!=typeof window&&window.location.reload();return}if(this.debug("loaded data from store",n,"didDispose",this.didDispose),!this.didDispose)try{if(n){let e=Object.fromEntries(n.records.map(e=>[e.id,e])),r=n.sessionStateSnapshot??function(e){let t=[];for(let n of Object.values(e))n.typeName?.match(/^(instance.*|pointer|camera)$/)&&t.push(n);let n=t.filter(e=>"instance"===e.typeName&&e.id!==ne)[0];if(!n)return null;let r={version:0,currentPageId:n.currentPageId,exportBackground:!!n.exportBackground,isFocusMode:!!n.isFocusMode,isDebugMode:!!n.isDebugMode,isToolLocked:!!n.isToolLocked,isGridMode:!1,pageStates:t.filter(e=>"instance_page_state"===e.typeName&&e.instanceId===n.id).map(t=>{let n=e[t.cameraId]??{x:0,y:0,z:1};return{pageId:t.pageId,camera:{x:n.x,y:n.y,z:n.z},selectedShapeIds:t.selectedShapeIds,focusedGroupId:t.focusedGroupId}})};try{return a8.validate(r),r}catch(e){return null}}(e),i=this.store.schema.migrateStoreSnapshot({store:e,schema:n.schema??this.store.schema.serializeEarliestVersion()});if("error"===i.type){console.error("failed to migrate store",i),t(Error(`Failed to migrate store: ${i.reason}`));return}this.store.mergeRemoteChanges(()=>{this.store.put(Object.values(i.value).filter(e=>this.documentTypes.has(e.typeName)),"initialize")}),r&&function(e,t){let n=function(e){if(!e||"object"!=typeof e)return console.warn("Invalid instance state"),null;if(!("version"in e)||"number"!=typeof e.version)return console.warn("No version in instance state"),null;let t=tl({value:e,fromVersion:e.version,toVersion:0,migrations:a9});if("error"===t.type)return console.warn(t.reason),null;let n={...t.value,version:0};try{a8.validate(n)}catch(e){return console.warn(e),null}return n}(t);if(!n)return;let r={added:{},updated:{},removed:{...eW(e.allRecords().filter(e=>"instance_page_state"===e.typeName||"camera"===e.typeName).map(e=>[e.id,e]))}};e.has(ne)&&(r.removed[ne]=e.get(ne));let i={removed:{},updated:{},added:{[ne]:e.schema.types.instance.create({id:ne,currentPageId:n.currentPageId,isDebugMode:n.isDebugMode,isFocusMode:n.isFocusMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,exportBackground:n.exportBackground})}};for(let e of n.pageStates){let t=tX.createId(e.pageId),n=no.createId(e.pageId);i.added[t]=tX.create({id:tX.createId(e.pageId),x:e.camera.x,y:e.camera.y,z:e.camera.z}),i.added[n]=no.create({id:no.createId(e.pageId),pageId:e.pageId,selectedShapeIds:e.selectedShapeIds,focusedGroupId:e.focusedGroupId})}ee(()=>{e.applyDiff(tr([r,i])),e.ensureStoreIsUsable()})}(this.store,r)}this.channel.onmessage=({data:e})=>{this.debug("got message",e);let n=tc(this.serializedSchema,e.schema??this.store.schema.serializeEarliestVersion());if(-1===n){if(Date.now()-this.initTime<5e3){t(Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,window?.location?.reload?.();return}if(1===n){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}"diff"===e.type&&(this.debug("applying diff"),ee(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(e.changes),this.store.ensureStoreIsUsable()})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(e){if(this.debug("error loading data from store",e),this.didDispose)return;t(e);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}isPersisting=!1;didLastWriteError=!1;scheduledPersistTimeout=null;schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),this.scheduledPersistTimeout||(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?1e4:350))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),this.isPersisting||this.isReloading||this.store.isPossiblyCorrupted()||!this.shouldDoFullDBWrite&&!(this.diffQueue.length>0)||this.doPersist()}async doPersist(){eT(!this.isPersisting,"persist already in progress"),this.isPersisting=!0,this.debug("doPersist start");let e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await lb({persistenceKey:this.persistenceKey,schema:this.store.schema,snapshot:this.store.serialize(),didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{let t=tr(e.filter(e=>e!==lS));await ly({persistenceKey:this.persistenceKey,changes:t,schema:this.store.schema,didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(e){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",e),window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
\u2022 If your hard disk is full, try clearing up some space and then reload the page.`),"undefined"!=typeof window&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function lP(e){let t=function({initialData:e,defaultName:t="",...n}){return new tn({schema:"schema"in n&&n.schema?n.schema:function({shapes:e}){let t=new Map;for(let n of eH(e))for(let e of nV(n.props??{}).keys()){if(t.has(e.id)&&t.get(e.id)!==e)throw Error(`Multiple StyleProp instances with the same id: ${e.id}`);t.set(e.id,e)}let n=e6("shape",{migrations:to({currentVersion:nN.currentVersion,firstVersion:nN.firstVersion,migrators:nN.migrators,subTypeKey:"type",subTypeMigrations:eG(e,(e,t)=>t.migrations??to({}))}),scope:"document",validator:tR("shape",tO("type",eG(e,(e,{props:t,meta:n})=>tT({id:nn,typeName:tE("shape"),x:tw,y:tw,rotation:tw,index:tS,parentId:nt,type:tE(e),isLocked:tI,opacity:tQ,props:t?tT(t):tA,meta:n?tT(n):tA}))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}})),r=function(e){let t={};for(let[n,r]of e)t[n]=tD(r);return e6("instance",{migrations:t7,validator:tR("instance",tT({typeName:tE("instance"),id:tU("instance"),currentPageId:t5,followingUserId:tS.nullable(),brush:tq.nullable(),opacityForNextShape:tQ,stylesForNextShape:tT(t),cursor:tJ,scribbles:tM(t2),isFocusMode:tI,isDebugMode:tI,isToolLocked:tI,exportBackground:tI,screenBounds:tq,insets:tM(tI),zoomBrush:tq.nullable(),isPenMode:tI,isGridMode:tI,chatMessage:tS,isChatting:tI,highlightedUserIds:tM(tS),canMoveCamera:tI,isFocused:tI,devicePixelRatio:tw,isCoarsePointer:tI,isHoveringCanvas:tI.nullable(),openMenus:tM(tS),isChangingStyle:tI,isReadonly:tI,meta:tA,duplicateProps:tT({shapeIds:tM(tU("shape")),offset:tT({x:tw,y:tw})}).nullable()})),scope:"session"}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],canMoveCamera:!0,isFocused:!1,devicePixelRatio:"undefined"==typeof window?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null}))}(t);return td.create({asset:nA,camera:tX,document:nf,instance:r,instance_page_state:no,page:t6,shape:n,instance_presence:nh,pointer:nl},{snapshotMigrations:nK,onValidationFailure:nv,createIntegrityChecker:nx})}({shapes:Object.fromEntries(sV("shapeUtils"in n&&n.shapeUtils?n.shapeUtils:[]).map(e=>[e.type,{props:e.props,migrations:e.migrations}]))}),initialData:e,props:{defaultName:t}})}(e);return e.snapshot&&t.loadSnapshot(e.snapshot),{store:t,opts:e}}let lI=!1;if("undefined"!=typeof window){let e=window.navigator.userAgent,t=!!e.match(/iPad/i)||!!e.match(/iPhone/i),n=!!e.match(/WebKit/i);lI=t&&n&&!e.match(/CriOS/i)}let lE=[],lj=[];function lM(e){let{defaultName:t,snapshot:n,initialData:r,shapeUtils:i,persistenceKey:o,sessionId:s,user:a}=e,l=function({persistenceKey:e,sessionId:t,...n}){let[r,i]=(0,eg.useState)(null),o=function(e){let[t,n]=(0,eg.useState)(()=>lP(e));if(!function(e,t){if(e===t)return!0;let n=new Set(Object.keys(e)),r=new Set(Object.keys(t));if(n.size!==r.size)return!1;for(let i of n)if(!r.has(i)||!Object.is(e[i],t[i]))return!1;return!0}(t.opts,e)){let t=lP(e);return n(t),t.store}return t.store}(n);return(0,eg.useEffect)(()=>{let n=ss();if(!e){i({id:n,storeWithStatus:{status:"not-synced",store:o}});return}i({id:n,storeWithStatus:{status:"loading"}});let r=e=>{i(t=>t?.id===n?{id:n,storeWithStatus:e}:t)},s=new lk(o,{sessionId:t,persistenceKey:e,onLoad(){r({store:o,status:"synced-local"})},onLoadError(e){r({status:"error",error:e})}});return()=>{i(e=>e?.id===n?null:e),s.close()}},[e,o,t]),r?.storeWithStatus??{status:"loading"}}({shapeUtils:i,initialData:r,persistenceKey:o,sessionId:s,defaultName:t,snapshot:n});return(0,j.jsx)(lT,{...e,store:l,user:a})}(0,eg.memo)(function({store:e,components:t,className:n,user:r,...i}){let[o,s]=eg.useState(null),a=(0,eg.useMemo)(()=>r??sS(),[r]),l=t?.ErrorFallback===void 0?iy:t?.ErrorFallback,d={...i,shapeUtils:i.shapeUtils??lE,tools:i.tools??lj,components:t};return(0,j.jsx)("div",{ref:s,draggable:!1,className:rm("tl-container tl-theme__light",n),onPointerDown:rT,tabIndex:-1,children:(0,j.jsx)(rV,{fallback:l,onError:e=>eL(e,{tags:{origin:"react.tldraw-before-app"}}),children:o&&(0,j.jsx)(rD,{container:o,children:(0,j.jsx)(iR,{overrides:t,children:e?e instanceof tn?(0,j.jsx)(lA,{...d,store:e,user:a}):(0,j.jsx)(lT,{...d,store:e,user:a}):(0,j.jsx)(lM,{...d,store:e,user:a})})})})})});let lT=(0,eg.memo)(function({store:e,user:t,...n}){let r=rz();switch((0,eg.useLayoutEffect)(()=>{t.userPreferences.get().isDarkMode&&(r.classList.remove("tl-theme__light"),r.classList.add("tl-theme__dark"))},[r,t]),e.status){case"error":throw e.error;case"loading":{let e=n.components?.LoadingScreen??sr;return(0,j.jsx)(e,{})}}return(0,j.jsx)(lA,{...n,store:e.store,user:t})});function lA({onMount:e,children:t,store:n,tools:r,shapeUtils:i,user:o,initialState:s,autoFocus:a=!0,inferDarkMode:l}){let{ErrorFallback:d}=iL(),c=rz(),[u,h]=(0,eg.useState)(null);(0,eg.useLayoutEffect)(()=>{let e=new aW({store:n,shapeUtils:i,tools:r,getContainer:()=>c,user:o,initialState:s,inferDarkMode:l});return window.app=e,window.editor=e,h(e),()=>{e.dispose()}},[c,i,r,n,o,s,l]);let p=(0,eg.useSyncExternalStore)((0,eg.useCallback)(e=>u?(u.on("crash",e),()=>u.off("crash",e)):()=>{},[u]),()=>u?.getCrashingError()??null);return u?(0,j.jsx)(rV,{fallback:d,onError:e=>u.annotateError(e,{origin:"react.tldraw",willCrashApp:!0}),children:p?(0,j.jsx)(lR,{crashingError:p}):(0,j.jsx)(rO.Provider,{value:u,children:(0,j.jsx)(lO,{autoFocus:a,onMount:e,children:t})})}):null}function lO({children:e,onMount:t,autoFocus:n}){return function(){let e=rR(),t=rz();eg.useEffect(()=>{let n=e=>t.style.setProperty("--tl-zoom",e.toString()),r=eO(n,100),i=new X("useZoomCss",()=>{e.getCurrentPageShapeIds().size<300?n(e.getZoomLevel()):r(e.getZoomLevel())});return i.attach(),i.execute(),()=>{i.detach()}},[e,t])}(),function(){let e=rR(),t=rz(),n=aq();eC("useCursor",()=>{let{type:r,rotation:i}=e.getInstanceState().cursor;if(a1.includes(r)){t.style.setProperty("--tl-cursor",`var(--tl-cursor-${r})`);return}t.style.setProperty("--tl-cursor",a5(r,i,n?"white":"black"))},[e,t,n])}(),function(){let e=rR(),t=rz(),n=aq(),r=e_(r_.forceSrgb);eg.useEffect(()=>{n?(t.setAttribute("data-color-mode","dark"),t.classList.remove("tl-theme__light"),t.classList.add("tl-theme__dark")):(t.setAttribute("data-color-mode","light"),t.classList.remove("tl-theme__dark"),t.classList.add("tl-theme__light")),r?t.classList.add("tl-theme__force-sRGB"):t.classList.remove("tl-theme__force-sRGB")},[e,t,r,n])}(),function(){let e=rR();eg.useEffect(()=>{if(lI)return document.addEventListener("focusout",t),()=>document.removeEventListener("focusout",t);function t(t){(t.target instanceof HTMLInputElement&&"text"===t.target.type||t.target instanceof HTMLTextAreaElement)&&e.complete()}},[e])}(),function(){let[e,t]=(0,eg.useState)(0);(0,eg.useEffect)(()=>t(e=>e+1),[])}(),function(e){let t=rR(),n=rz();(0,eg.useLayoutEffect)(()=>{e?(t.getInstanceState().isFocused||t.updateInstanceState({isFocused:!0}),t.getContainer().focus()):t.getInstanceState().isFocused&&t.updateInstanceState({isFocused:!1})},[t,n,e])}(n),function(e){let t=rR(),n=function(e){let t=(0,eg.useRef)();return(0,eg.useLayoutEffect)(()=>{t.current=e}),(0,eg.useDebugValue)(e),(0,eg.useCallback)((...e)=>{let n=t.current;return eT(n,"fn does not exist"),n(...e)},[])}(t=>{let n=e?.(t);return t.emit("mount"),window.tldrawReady=!0,n});eg.useLayoutEffect(()=>{if(t)return n?.(t)},[t,n])}(t),rR().updateViewportScreenBounds(),e??(0,j.jsx)(oK,{})}function lR({crashingError:e}){throw e}function lL({children:e}){let{Spinner:t}=iL();return(0,j.jsxs)("div",{className:"tl-loading",children:[t?(0,j.jsx)(t,{}):null,e]})}function lD({children:e,className:t="",...n}){return(0,j.jsx)("div",{...n,className:`tl-html-container ${t}`,children:e})}eS(function({x:e=0,y:t=0,rotation:n=0,...r}){let i=rR(),o=(0,eg.useRef)(null),s=i.getCamera();return(0,eg.useLayoutEffect)(()=>{let{x:r,y:s,z:a}=i.getCamera(),l=o.current;l&&void 0!==r&&(l.style.transform=`translate(${r}px, ${s}px) scale(${a}) rotate(${n}rad) translate(${e}px, ${t}px)`)},[s,i,e,t,n]),(0,j.jsx)("div",{ref:o,...r,className:rm("tl-positioned",r.className)})});class lz extends sz{getGeometry(e){return new sD({width:e.props.w,height:e.props.h,isFilled:!0})}onResize=(e,t)=>(function(e,t,n={}){let{newPoint:r,handle:i,scaleX:o,scaleY:s}=t,{minWidth:a=1,maxWidth:l=1/0,minHeight:d=1,maxHeight:c=1/0}=n,u=e.props.w*o,h=e.props.h*s,p=new rG(0,0);if(u>0){if(u<a){switch(i){case"top_left":case"left":case"bottom_left":p.x=u-a;break;case"top":case"bottom":p.x=(u-a)/2;break;default:p.x=0}u=a}}else if(p.x=u,(u=-u)<a){switch(i){case"top_left":case"left":case"bottom_left":p.x=-u;break;default:p.x=-a}u=a}if(h>0){if(h<d){switch(i){case"top_left":case"top":case"top_right":p.y=h-d;break;case"right":case"left":p.y=(h-d)/2;break;default:p.y=0}h=d}}else if(p.y=h,(h=-h)<d){switch(i){case"top_left":case"top":case"top_right":p.y=-h;break;default:p.y=-d}h=d}let{x:g,y:f}=p.rot(e.rotation).add(r);return{x:g,y:f,props:{w:Math.min(l,u),h:Math.min(c,h)}}})(e,t)}function lN(e){let t=rR();return e_("isEditing",()=>t.getEditingShapeId()===e,[t,e])}function l$(e){let t=rR();return(0,eg.useMemo)(function(){let n,r;return{onPointerDown:n=>{if(n.isKilled)return;if(2===n.button){t.dispatch({type:"pointer",target:"selection",handle:e,name:"right_click",...rA(n)});return}if(0!==n.button)return;let r=rI(n.currentTarget);rj(r,n),r.addEventListener("pointerup",function e(){r.removeEventListener("pointerup",e),rM(r,n)}),t.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:e,...rA(n)}),rT(n)},onPointerMove:function(i){i.isKilled||0!==i.button||i.clientX===n&&i.clientY===r||(n=i.clientX,r=i.clientY,t.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:e,...rA(i)}))},onPointerUp:n=>{n.isKilled||0!==n.button||t.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:e,...rA(n)})}}},[t,e])}function lF(e,t,n,r,i){let o=n?12:0,s=e-o,a=e+o,l=r?0:8,d=i?t:t-8;return s<l?Math.min(1,(l-s)/8):a>d?-Math.min(1,(a-d)/8):0}function lB(e){if(!e.inputs.isDragging||e.inputs.isPanning)return;let{inputs:{currentScreenPoint:{x:t,y:n}}}=e,r=e.getZoomLevel(),i=e.getViewportScreenBounds(),o=i.w<1e3?.612:1,s=i.h<1e3?.612:1,{isCoarsePointer:a,insets:[l,d,c,u]}=e.getInstanceState(),h=lF(t-i.x,i.w,a,u,d),p=lF(n-i.y,i.h,a,l,c);if(0===h&&0===p)return;let g=20*e.user.getEdgeScrollSpeed(),f=e.getCamera();e.setCamera({x:f.x+g*h*o/r,y:f.y+g*p*s/r})}async function lV({shouldReload:e=!0}={}){sessionStorage.clear(),await Promise.all(lx().map(e=>(function(e,{blocked:t}={}){let n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",e=>t(e.oldVersion,e)),ls(n).then(()=>void 0)})(e))),localStorage.clear(),e&&window.location.reload()}"undefined"!=typeof window&&(window.__tldraw__hardReset=lV),n(9280),n(1482),n(1837),n(9338),n(1465);let{PI:lU}=Math,lK=lU+1e-4,{min:lH}=Math;function lY(){let e=rR();return e_("isReadonlyMode",()=>e.getInstanceState().isReadonly,[e])}function lW({size:e,width:t,height:n,hideAlternateHandles:r}){let i=is(e/3),o=i/2;return(0,j.jsxs)("svg",{className:"tl-overlays__item",children:[(0,j.jsx)("polyline",{className:"tl-corner-crop-handle",points:`
						${is(0-o)},${is(e)} 
						${is(0-o)},${is(0-o)} 
						${is(e)},${is(0-o)}`,strokeWidth:i,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),(0,j.jsx)("line",{className:rm("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:is(t/2-e),y1:is(0-o),x2:is(t/2+e),y2:is(0-o),strokeWidth:i,"data-testid":"selection.crop.top","aria-label":"top handle"}),(0,j.jsx)("polyline",{className:rm("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${is(t-e)},${is(0-o)} 
						${is(t+o)},${is(0-o)} 
						${is(t+o)},${is(e)}`,strokeWidth:i,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),(0,j.jsx)("line",{className:rm("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:is(t+o),y1:is(n/2-e),x2:is(t+o),y2:is(n/2+e),strokeWidth:i,"data-testid":"selection.crop.right","aria-label":"right handle"}),(0,j.jsx)("polyline",{className:"tl-corner-crop-handle",points:`
						${is(t+o)},${is(n-e)} 
						${is(t+o)},${is(n+o)}
						${is(t-e)},${is(n+o)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),(0,j.jsx)("line",{className:rm("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:is(t/2-e),y1:is(n+o),x2:is(t/2+e),y2:is(n+o),strokeWidth:i,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),(0,j.jsx)("polyline",{className:rm("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${is(0+e)},${is(n+o)} 
						${is(0-o)},${is(n+o)}
						${is(0-o)},${is(n-e)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),(0,j.jsx)("line",{className:rm("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:is(0-o),y1:is(n/2-e),x2:is(0-o),y2:is(n/2+e),strokeWidth:i,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}eS(function({bounds:e,rotation:t}){let n=rR(),r=(0,eg.useRef)(null),i=lY(),o=l$("top"),s=l$("right"),a=l$("bottom"),l=l$("left"),d=l$("top_left"),c=l$("top_right"),u=l$("bottom_right"),h=l$("bottom_left"),p=!n.getIsMenuOpen()&&"default"===n.getInstanceState().cursor.type,g=n.getInstanceState().isCoarsePointer,f=n.getOnlySelectedShape(),m=f&&n.isShapeOrAncestorLocked(f),y=f?n.getShapeUtil(f).expandSelectionOutlinePx(f):0;if(rX(r,e?.x,e?.y,1,n.getSelectionRotation(),{x:-y,y:-y}),!e)return null;e=e.clone().expandBy(y).zeroFix();let b=n.getZoomLevel(),v=n.getInstanceState().isChangingStyle,x=e.width,S=e.height,w=8/b,C=x<2*w,_=S<2*w,k=x<4*w,P=S<4*w,I=x<5*w,E=S<5*w,M=g?1.75:1,T=6/b*M,A=.75*M*(k?T/2:T),O=.75*M*(P?T/2:T),R=(!f||!n.getShapeUtil(f).hideSelectionBoundsFg(f))&&!v,L=R&&n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.pointing_resize_handle","select.pointing_crop_handle")||R&&n.isIn("select.resizing")&&f&&n.isShapeOfType(f,"text");f&&L&&n.environment.isFirefox&&n.isShapeOfType(f,"embed")&&(L=!1);let D=n.isInAny("select.pointing_crop_handle","select.crop.idle","select.crop.pointing_crop")&&!v&&!i,z=n.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!v&&!i,N=!g&&!(C||_)&&(z||D)&&(!f||!n.getShapeUtil(f).hideRotateHandle(f))&&!m,$=g&&(!k||!P)&&(z||D)&&(!f||!n.getShapeUtil(f).hideRotateHandle(f))&&!m,F=z&&(!f||n.getShapeUtil(f).canResize(f)&&!n.getShapeUtil(f).hideResizeHandles(f))&&!D&&!m,B=C||_,V=C&&_,U=I||E,K=F||D,H=!N,Y=!z||!$,W=!z||!K,X=!z||!K||B,G=!z||!K||B,q=!z||!K||V&&!D,Z=!0,J=!0;if(D)Z=U,J=U;else if(F){Z=B||V||g;let e=g&&f&&"text"===f.type;J=Z&&!e}let Q=Math.min(24/b,S-3*O),ee=z&&g&&f&&n.isShapeOfType(f,"text")&&Q*b>=4;return(0,j.jsx)("svg",{className:"tl-overlays__item tl-selection__fg tl-svg-context","data-testid":"selection-foreground",children:(0,j.jsxs)("g",{ref:r,children:[L&&(0,j.jsx)("rect",{className:rm("tl-selection__fg__outline"),width:is(x),height:is(S)}),(0,j.jsx)(lX,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:T,corner:"top_left_rotate",cursor:p?a5("nwse-rotate",t):void 0,isHidden:H}),(0,j.jsx)(lX,{"data-testid":"selection.rotate.top-right",cx:x+3*T,cy:0,targetSize:T,corner:"top_right_rotate",cursor:p?a5("nesw-rotate",t):void 0,isHidden:H}),(0,j.jsx)(lX,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:S+3*T,targetSize:T,corner:"bottom_left_rotate",cursor:p?a5("swne-rotate",t):void 0,isHidden:H}),(0,j.jsx)(lX,{"data-testid":"selection.rotate.bottom-right",cx:x+3*T,cy:S+3*T,targetSize:T,corner:"bottom_right_rotate",cursor:p?a5("senw-rotate",t):void 0,isHidden:H}),(0,j.jsx)(lq,{"data-testid":"selection.rotate.mobile",cx:k?-(1.5*T):x/2,cy:k?S/2:-(1.5*T),size:w,isHidden:Y}),(0,j.jsx)("rect",{className:rm("tl-transparent",{"tl-hidden":Z}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:is(0-(P?2*O:O)),width:is(x),height:is(Math.max(1,2*O)),style:p?{cursor:a5("ns-resize",t)}:void 0,...o}),(0,j.jsx)("rect",{className:rm("tl-transparent",{"tl-hidden":J}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:is(x-(k?0:A)),y:0,height:is(S),width:is(Math.max(1,2*A)),style:p?{cursor:a5("ew-resize",t)}:void 0,...s}),(0,j.jsx)("rect",{className:rm("tl-transparent",{"tl-hidden":Z}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:is(S-(P?0:O)),width:is(x),height:is(Math.max(1,2*O)),style:p?{cursor:a5("ns-resize",t)}:void 0,...a}),(0,j.jsx)("rect",{className:rm("tl-transparent",{"tl-hidden":J}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:is(0-(k?2*A:A)),y:0,height:is(S),width:is(Math.max(1,2*A)),style:p?{cursor:a5("ew-resize",t)}:void 0,...l}),(0,j.jsx)("rect",{className:rm("tl-transparent",{"tl-hidden":W}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:is(0-(k?2*A:1.5*A)),y:is(0-(P?2*O:1.5*O)),width:is(3*A),height:is(3*O),style:p?{cursor:a5("nwse-resize",t)}:void 0,...d}),(0,j.jsx)("rect",{className:rm("tl-transparent",{"tl-hidden":X}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:is(x-(k?0:1.5*A)),y:is(0-(P?2*O:1.5*O)),width:is(3*A),height:is(3*O),style:p?{cursor:a5("nesw-resize",t)}:void 0,...c}),(0,j.jsx)("rect",{className:rm("tl-transparent",{"tl-hidden":q}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:is(x-(k?A:1.5*A)),y:is(S-(P?O:1.5*O)),width:is(3*A),height:is(3*O),style:p?{cursor:a5("nwse-resize",t)}:void 0,...u}),(0,j.jsx)("rect",{className:rm("tl-transparent",{"tl-hidden":G}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:is(0-(k?3*A:1.5*A)),y:is(S-(P?0:1.5*O)),width:is(3*A),height:is(3*O),style:p?{cursor:a5("nesw-resize",t)}:void 0,...h}),F&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("rect",{"data-testid":"selection.resize.top-left",className:rm("tl-corner-handle",{"tl-hidden":W}),"aria-label":"top_left handle",x:is(0-w/2),y:is(0-w/2),width:is(w),height:is(w)}),(0,j.jsx)("rect",{"data-testid":"selection.resize.top-right",className:rm("tl-corner-handle",{"tl-hidden":X}),"aria-label":"top_right handle",x:is(x-w/2),y:is(0-w/2),width:is(w),height:is(w)}),(0,j.jsx)("rect",{"data-testid":"selection.resize.bottom-right",className:rm("tl-corner-handle",{"tl-hidden":q}),"aria-label":"bottom_right handle",x:is(x-w/2),y:is(S-w/2),width:is(w),height:is(w)}),(0,j.jsx)("rect",{"data-testid":"selection.resize.bottom-left",className:rm("tl-corner-handle",{"tl-hidden":G}),"aria-label":"bottom_left handle",x:is(0-w/2),y:is(S-w/2),width:is(w),height:is(w)})]}),ee&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:is(0-w/4),y:is(S/2-Q/2),rx:w/4,width:is(w/2),height:is(Q)}),(0,j.jsx)("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:w/4,x:is(x-w/4),y:is(S/2-Q/2),width:is(w/2),height:is(Q)})]}),D&&(0,j.jsx)(lW,{size:w,width:x,height:S,hideAlternateHandles:U})]})})});let lX=function({cx:e,cy:t,targetSize:n,corner:r,cursor:i,isHidden:o,"data-testid":s}){let a=l$(r);return(0,j.jsx)("rect",{className:rm("tl-transparent","tl-rotate-corner",{"tl-hidden":o}),"data-testid":s,"aria-label":`${r} target`,pointerEvents:"all",x:is(e-3*n),y:is(t-3*n),width:is(Math.max(1,3*n)),height:is(Math.max(1,3*n)),cursor:i,...a})},lG=Math.sqrt(Math.PI),lq=function({cx:e,cy:t,size:n,isHidden:r,"data-testid":i}){let o=l$("mobile_rotate"),s=rR(),a=e_("zoom level",()=>s.getZoomLevel(),[s]);return(0,j.jsxs)("g",{children:[(0,j.jsx)("circle",{"data-testid":i,pointerEvents:"all",className:rm("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":r}),cx:e,cy:t,r:Math.max(1/a*14,20/Math.max(1,a)),...o}),(0,j.jsx)("circle",{className:rm("tl-mobile-rotate__fg",{"tl-hidden":r}),cx:e,cy:t,r:n/lG})]})},lZ={lineHeight:1.35},lJ={s:2,m:3.5,l:5,xl:10},lQ={s:18,m:22,l:26,xl:32},l0={s:18,m:20,l:24,xl:28};function l1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function l2(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l1(Object(n),!0).forEach(function(t){var r,i;r=t,i=n[t],(r=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l1(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function l5(e,t){return function(e){if(Array.isArray(e))return e}(e)||/*!
 * canvas-size
 * v1.2.6
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,s,a=[],l=!0,d=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(a.push(r.value),a.length!==t);l=!0);}catch(e){d=!0,i=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(d)throw i}}return a}}(e,t)||l4(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l3(e){return function(e){if(Array.isArray(e))return l6(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||l4(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l4(e,t){if(e){if("string"==typeof e)return l6(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l6(e,t)}}function l6(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function l8(e){var t,n,r=e.sizes.shift(),i=Math.max(Math.ceil(r[0]),1),o=Math.max(Math.ceil(r[1]),1),s=Date.now(),a="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope;a?(t=new OffscreenCanvas(1,1),n=new OffscreenCanvas(i,o)):((t=document.createElement("canvas")).width=1,t.height=1,(n=document.createElement("canvas")).width=i,n.height=o);var l=t.getContext("2d"),d=n.getContext("2d");d&&(d.fillRect.apply(d,[i-1,o-1,1,1]),l.drawImage(n,i-1,o-1,1,1,0,0,1,1));var c=l&&0!==l.getImageData(0,0,1,1).data[3],u=Date.now()-s;return[t,n].forEach(function(e){e.height=0,e.width=0}),a?(postMessage({width:i,height:o,benchmark:u,isTestPass:c}),!c&&e.sizes.length&&l8(e)):c?e.onSuccess(i,o,u):(e.onError(i,o,u),e.sizes.length&&l8(e)),c}var l9={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},l7=["onError","onSuccess"],de={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},dt={};function dn(e){var t=e.width===e.height,n=1===e.height,r=1===e.width,i=[];if(e.width&&e.height)for(var o=e.min||de.min,s=e.step||de.step,a=Math.max(e.width,e.height);a>=o;){var l=t||n?a:1,d=t||r?a:1;i.push([l,d]),a-=s}else e.sizes.forEach(function(e){var o=t||n?e:1,s=t||r?e:1;i.push([o,s])});return i}function dr(e){var t=window&&"HTMLCanvasElement"in window,n=window&&"OffscreenCanvas"in window,r=Date.now(),i=e.onError,o=e.onSuccess,s=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,l7),a=null;if(!t)return!1;if(e.useWorker&&n){var l=new Blob(["\n            var canvasTest = ".concat(l8.toString(),";\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        ")],{type:"application/javascript"}),d=URL.createObjectURL(l);a=new Worker(d),URL.revokeObjectURL(d),a.onmessage=function(e){var t=e.data,n=t.width,i=t.height,o=t.benchmark;t.isTestPass?(dt[r].onSuccess(n,i,o),delete dt[r]):dt[r].onError(n,i,o)}}return e.usePromise?new Promise(function(t,n){var l=l2(l2({},e),{},{onError:function(t,r,o){var s;if(0===e.sizes.length)s=!0;else{var a=l5(e.sizes.slice(-1),1),l=l5(a[0],2),d=l[0],c=l[1];s=t===d&&r===c}i(t,r,o),s&&n({width:t,height:r,benchmark:o})},onSuccess:function(e,n,r){o(e,n,r),t({width:e,height:n,benchmark:r})}});if(a){var d=l.onError,c=l.onSuccess;dt[r]={onError:d,onSuccess:c},a.postMessage(s)}else l8(l)}):a?void(dt[r]={onError:i,onSuccess:o},a.postMessage(s)):l8(e)}var di={maxArea:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=dn({width:e.max,height:e.max,min:e.min,step:e.step,sizes:l3(l9.area)});return dr(l2(l2(l2({},de),e),{},{sizes:t}))},maxHeight:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=dn({width:1,height:e.max,min:e.min,step:e.step,sizes:l3(l9.height)});return dr(l2(l2(l2({},de),e),{},{sizes:t}))},maxWidth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=dn({width:e.max,height:1,min:e.min,step:e.step,sizes:l3(l9.width)});return dr(l2(l2(l2({},de),e),{},{sizes:t}))}};let ds=null;async function da(){let e=await di.maxWidth({usePromise:!0}),t=await di.maxHeight({usePromise:!0}),n=await di.maxArea({usePromise:!0});return{maxWidth:e.width,maxHeight:t.height,maxArea:n.width*n.height}}async function dl(e,t){if(e<=8192&&t<=8192&&e*t<=16777216)return[e,t];let{maxWidth:n,maxHeight:r,maxArea:i}=await (ds||(ds=da()),ds),o=e/t;if(e>n&&(t=(e=n)/o),t>r&&(e=(t=r)*o),e*t>i){let n=Math.sqrt(i/(e*t));e*=n,t*=n}return[e,t]}let dd=e=>e.split("*").map(e=>(function(e){if("string"!=typeof e)throw TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")})(e)).join(".+"),dc=(e,t)=>!!e.find(e=>{let n=new RegExp(dd(e));return t.match(n)});function du(e){try{return function(e){let t=new URL(e).host.replace("www.","");for(let n of n9)if(dc(n.hostnames,t)){let t=n.toEmbedUrl(e);if(t)return{definition:n,embedUrl:t,url:e}}}(e)??function(e){let t=new URL(e).host.replace("www.","");for(let n of n9)if(dc(n.hostnames,t)){let t=n.fromEmbedUrl(e);if(t)return{definition:n,url:t,embedUrl:e}}}(e)}catch(e){console.error(e)}}class dh extends aV{static id="drawing";info={};initialShape;shapeType="highlight"===this.parent.id?"highlight":"draw";util=this.editor.getShapeUtil(this.shapeType);isPen=!1;segmentMode="free";didJustShiftClickToExtendPreviousShapeLine=!1;pagePointWhereCurrentSegmentChanged={};pagePointWhereNextSegmentChanged=null;lastRecordedPoint={};mergeNextPoint=!1;currentLineLength=0;canDraw=!1;markId=null;onEnter=e=>{this.markId=null,this.info=e,this.canDraw=!this.editor.getIsMenuOpen(),this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.canDraw&&this.startShape()};onPointerMove=()=>{let{editor:{inputs:e}}=this;if(this.isPen!==e.isPen){if(this.markId){this.editor.bailToMark(this.markId),this.startShape();return}}else!this.canDraw&&e.isDragging&&(this.startShape(),this.canDraw=!0);this.canDraw&&(e.isPen?rG.Dist(e.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=e.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateShapes())};onKeyDown=e=>{if("Shift"===e.key)switch(this.segmentMode){case"free":this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break;case"starting_free":this.segmentMode="starting_straight"}this.updateShapes()};onKeyUp=e=>{if("Shift"===e.key)switch(this.editor.snaps.clear(),this.segmentMode){case"straight":this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break;case"starting_straight":this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free"}this.updateShapes()};onExit=()=>{this.editor.snaps.clear(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()};canClose(){return"highlight"!==this.shapeType}getIsClosed(e,t){if(!this.canClose())return!1;let n=lJ[t],r=e[0].points[0],i=e[e.length-1],o=i.points[i.points.length-1];return r!==o&&this.currentLineLength>4*n&&rG.Dist(r,o)<2*n}startShape(){let{inputs:{originPagePoint:e,isPen:t}}=this.editor;this.markId="draw start "+ss(),this.editor.mark(this.markId),this.isPen=t;let n=this.isPen?1.25*this.info.point.z:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=e.clone(),this.initialShape){let t=this.editor.getShape(this.initialShape.id);if(t&&"straight"===this.segmentMode){this.didJustShiftClickToExtendPreviousShapeLine=!0;let n=eE(t.props.segments);if(!n)throw Error("Expected a previous segment!");let r=eE(n.points);if(!r)throw Error("Expected a previous point!");let{x:i,y:o}=this.editor.getPointInShapeSpace(t,e).toFixed(),s=this.isPen?1.25*this.info.point.z:.5,a={type:this.segmentMode,points:[{x:r.x,y:r.y,z:+s.toFixed(2)},{x:i,y:o,z:+s.toFixed(2)}]},l=oj.applyToPoint(this.editor.getShapePageTransform(t.id),r);this.pagePointWhereCurrentSegmentChanged=l,this.pagePointWhereNextSegmentChanged=null;let d=[...t.props.segments,a];this.currentLineLength=this.getLineLength(d);let c={id:t.id,type:this.shapeType,props:{segments:d}};this.canClose()&&(c.props.isClosed=this.getIsClosed(d,t.props.size)),this.editor.updateShapes([c]);return}}this.pagePointWhereCurrentSegmentChanged=e.clone();let r=nB();this.editor.createShapes([{id:r,type:this.shapeType,x:e.x,y:e.y,props:{isPen:this.isPen,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+n.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(r)}updateShapes(){let{inputs:e}=this.editor,{initialShape:t}=this;if(!t)return;let{id:n,props:{size:r}}=t,i=this.editor.getShape(n);if(!i)return;let{segments:o}=i.props,{x:s,y:a,z:l}=this.editor.getPointInShapeSpace(i,e.currentPagePoint).toFixed(),d={x:s,y:a,z:this.isPen?+(1.25*l).toFixed(2):.5};switch(this.segmentMode){case"starting_straight":{let{pagePointWhereNextSegmentChanged:t}=this;if(null===t)throw Error("We should have a point where the segment changed");if(rG.Dist(t,e.currentPagePoint)>4){let e;this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";let t=eE(o);if(!t)throw Error("Expected a previous segment!");let s=eE(t.points);if(!s)throw Error("Expected a previous last point!");let a=this.editor.getPointInShapeSpace(i,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if("straight"===t.type){this.currentLineLength+=rG.Dist(s,a),e={type:"straight",points:[{...s},a]};let t=this.editor.getShapePageTransform(i);this.pagePointWhereCurrentSegmentChanged=oj.applyToPoint(t,s)}else e={type:"straight",points:[a,d]};let l={id:n,type:this.shapeType,props:{segments:[...o,e]}};this.canClose()&&(l.props.isClosed=this.getIsClosed(o,r)),this.editor.updateShapes([l],{squashing:!0})}break}case"starting_free":{let{pagePointWhereNextSegmentChanged:t}=this;if(null===t)throw Error("We should have a point where the segment changed");if(rG.Dist(t,e.currentPagePoint)>4){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";let e=o.slice(),t=eE(e[e.length-1].points);if(!t)throw Error("No previous point!");let i=[...e,{type:"free",points:[...rG.PointsBetween(t,d,6).map(e=>e.toFixed().toJson())]}];this.currentLineLength=this.getLineLength(i);let s={id:n,type:this.shapeType,props:{segments:i}};this.canClose()&&(s.props.isClosed=this.getIsClosed(i,r)),this.editor.updateShapes([s],{squashing:!0})}break}case"straight":{let e,t;let s=o.slice(),a=s[s.length-1],{pagePointWhereCurrentSegmentChanged:l}=this,{currentPagePoint:d,ctrlKey:c}=this.editor.inputs;if(!l)throw Error("We should have a point where the segment changed");let u=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(u=!c,this.didJustShiftClickToExtendPreviousShapeLine=!1):u=!c;let h=this.editor.getPointInShapeSpace(i,d).toFixed().toJson(),p=!1;if((this.editor.user.getIsSnapMode()?!c:c)&&s.length>2){let e;let n=8/this.editor.getZoomLevel();for(let r=0,i=o.length-2;r<i;r++){let i=o[r];if(!i)break;if("free"===i.type)continue;let s=i.points[0],a=eE(i.points);if(!(s&&a))continue;let l=rG.NearestPointOnLineSegment(s,a,h),d=rG.Dist(l,h);if(d<n){e=l.toFixed().toJson(),n=d,t=i;break}}e&&(p=!0,h=e)}if(p&&t){let e=this.editor.getShapePageTransform(i),n=t.points[0],r=eE(t.points);if(!r)throw Error("Expected a last point!");let o=oj.applyToPoint(e,n),s=oj.applyToPoint(e,r),a=oj.applyToPoint(e,h);this.editor.snaps.setLines([{id:ss(),type:"points",points:[o,a,s]}])}else{if(this.editor.snaps.clear(),u){let t=rG.Angle(l,d),n=function(e,t){let n=r1/24,r=Math.floor(((r1+e)%r1+n/2)/n)*n%r1;return r<rQ&&(r+=r1),r>rQ&&(r-=r1),r}(t,0);e=rG.RotWith(d,l,n-t)}else e=d;h=this.editor.getPointInShapeSpace(i,e).toFixed().toJson()}this.currentLineLength+=rG.Dist(a.points[0],h),s[s.length-1]={...a,type:"straight",points:[a.points[0],h]};let g={id:n,type:this.shapeType,props:{segments:s}};this.canClose()&&(g.props.isClosed=this.getIsClosed(o,r)),this.editor.updateShapes([g],{squashing:!0});break}case"free":{let e=o.slice(),t=e[e.length-1],i=[...t.points];if(i.length&&this.mergeNextPoint){let{z:e}=i[i.length-1];i[i.length-1]={x:d.x,y:d.y,z:e?Math.max(e,d.z):d.z}}else this.currentLineLength+=rG.Dist(i[i.length-1],d),i.push(d);e[e.length-1]={...t,points:i},this.currentLineLength=this.getLineLength(e);let s={id:n,type:this.shapeType,props:{segments:e}};if(this.canClose()&&(s.props.isClosed=this.getIsClosed(e,r)),this.editor.updateShapes([s],{squashing:!0}),i.length>500){this.editor.updateShapes([{id:n,type:this.shapeType,props:{isComplete:!0}}]);let{currentPagePoint:e}=this.editor.inputs,t=nB();this.editor.createShapes([{id:t,type:this.shapeType,x:ia(e.x),y:ia(e.y),props:{isPen:this.isPen,segments:[{type:"free",points:[{x:0,y:0,z:this.isPen?+(1.25*l).toFixed():.5}]}]}}]),this.initialShape=structuredClone(this.editor.getShape(t)),this.mergeNextPoint=!1,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.currentLineLength=0}}}}getLineLength(e){let t=0;for(let n of e)for(let e=0;e<n.points.length-1;e++){let r=n.points[e],i=n.points[e+1];t+=rG.Sub(i,r).len2()}return Math.sqrt(t)}onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())};complete(){if(!this.canDraw){this.cancel();return}let{initialShape:e}=this;e&&(this.editor.updateShapes([{id:e.id,type:e.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}function dp(e){let t;let n=e.getShapeAtPoint(e.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:8/e.getZoomLevel(),renderingOnly:!0});if(!n)return e.setHoveredShape(null);let r=e.getOutermostSelectableShape(n);return t=r===n?n:r.id===e.getFocusedGroupId()||e.getSelectedShapeIds().includes(r.id)?n:r,e.setHoveredShape(t.id)}function dg(){return nW({isDarkMode:aq()})}let df=eg.memo(function({theme:e,d:t,color:n,fill:r}){switch(r){case"none":return null;case"solid":return(0,j.jsx)("path",{fill:e[n].semi,d:t});case"semi":return(0,j.jsx)("path",{fill:e.solid,d:t});case"pattern":return(0,j.jsx)(dm,{theme:e,color:n,fill:r,d:t})}}),dm=function({d:e,color:t,theme:n}){let r=rR(),i=e_("zoomLevel",()=>r.getZoomLevel(),[r]),o=.18>=r.getZoomLevel();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("path",{fill:n[t].pattern,d:e}),(0,j.jsx)("path",{fill:o?n[t].semi:`url(#${rv[`${Math.ceil(i)}_${n.id}`]})`,d:e})]})},dy=(e,t)=>{let n=document.createElement("canvas");n.width=e[0],n.height=e[1];let r=n.getContext("2d");return r?(t(r),n.toDataURL()):""};function db(e,t,n={}){let{closed:r=!1,snap:i=1,start:o="outset",end:s="outset",lengthRatio:a=2,style:l="dashed"}=n,d=0,c=0,u=1,h=0,p=0;switch(l){case"dashed":u=1,d=Math.min(t*a,e/4);break;case"dotted":d=t/(u=100);break;default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||("outset"===o?(e+=d/2,p+=d/2):"skip"===o&&(e-=d,p-=d),"outset"===s?e+=d/2:"skip"!==s||(e-=d)),c=Math.floor(e/d/(2*u)),(c-=c%i)<3&&"dashed"===l?e/t<5?(d=e,c=1,h=0):(d=.333*e,h=.333*e):(d=e/(c=Math.max(c,3))/(2*u),r?(p=d/2,h=(e-c*d)/c):h=(e-c*d)/Math.max(1,c-1)),{strokeDasharray:[d,h].join(" "),strokeDashoffset:p.toString()}}class dv{static insertTextFirefox(e,t){e.setRangeText(t,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:t,inputType:"insertText",isComposing:!1}))}static insert(e,t){let n=e.ownerDocument,r=n.activeElement;r!==e&&e.focus(),n.execCommand("insertText",!1,t)||dv.insertTextFirefox(e,t),r===n.body?e.blur():r instanceof HTMLElement&&r!==e&&r.focus()}static set(e,t){e.select(),dv.insert(e,t)}static getSelection(e){let{selectionStart:t,selectionEnd:n}=e;return e.value.slice(t||void 0,n||void 0)}static wrapSelection(e,t,n){let{selectionStart:r,selectionEnd:i}=e,o=dv.getSelection(e);dv.insert(e,t+o+(n??t)),e.selectionStart=(r||0)+t.length,e.selectionEnd=(i||0)+t.length}static replace(e,t,n){let r=0;e.value.replace(t,(...t)=>{let i=r+t[t.length-2],o=t[0].length;e.selectionStart=i,e.selectionEnd=i+o;let s="string"==typeof n?n:n(...t);return dv.insert(e,s),e.selectionStart=i,r+=s.length-o,s})}static findLineEnd(e,t){let n=e.lastIndexOf("\n",t-1)+1;return"	"!==e.charAt(n)?t:n+1}static indent(e){let{selectionStart:t,selectionEnd:n,value:r}=e,i=r.slice(t,n),o=/\n/g.exec(i)?.length;if(o&&o>0){let i=r.lastIndexOf("\n",t-1)+1,o=e.value.slice(i,n-1),s=o.replace(/^|\n/g,"$&  "),a=s.length-o.length;e.setSelectionRange(i,n-1),dv.insert(e,s),e.setSelectionRange(t+1,n+a)}else dv.insert(e,"  ")}static unindent(e){let{selectionStart:t,selectionEnd:n,value:r}=e,i=r.lastIndexOf("\n",t-1)+1,o=dv.findLineEnd(r,n),s=e.value.slice(i,o),a=s.replace(/(^|\n)(\t| {1,2})/g,"$1"),l=s.length-a.length;e.setSelectionRange(i,o),dv.insert(e,a);let d=/\t| {1,2}/.exec(r.slice(i,t)),c=d?d[0].length:0,u=t-c;e.setSelectionRange(t-c,Math.max(u,n-l))}static indentCE(e){let t=window.getSelection(),n=e.innerText,r=dx(e)??0,i=dx(e)??0,o=n.slice(r,i),s=/\n/g.exec(o)?.length;if(s&&s>0){let o=n.lastIndexOf("\n",r-1)+1,s=n.slice(o,i-1),a=s.replace(/^|\n/g,"$&  ").length-s.length;t&&t.setBaseAndExtent(e,r+1,e,i+a)}else{let t=window.getSelection();e.innerText=n.slice(0,r)+"  "+n.slice(r),t?.setBaseAndExtent(e,r+1,e,r+2)}}static unindentCE(e){let t=window.getSelection(),n=e.innerText,r=dx(e)??0,i=dx(e)??0,o=n.lastIndexOf("\n",r-1)+1,s=dv.findLineEnd(n,i),a=n.slice(o,s),l=a.replace(/(^|\n)(\t| {1,2})/g,"$1"),d=a.length-l.length;if(t){t.setBaseAndExtent(e,o,e,s);let a=/\t| {1,2}/.exec(n.slice(o,r)),l=a?a[0].length:0,c=r-l;t.setBaseAndExtent(e,r-l,e,Math.max(c,i-d))}}static fixNewLines=/\r?\n|\r/g;static normalizeText(e){return e.replace(dv.fixNewLines,"\n")}static normalizeTextForDom(e){return e.replace(dv.fixNewLines,"\n").split("\n").map(e=>e||" ").join("\n")}}function dx(e){if(void 0===window.getSelection)return;let t=window.getSelection();if(!t)return;let n=0;if(0!==t.rangeCount){let r=t.getRangeAt(0),i=r.cloneRange();i.selectNodeContents(e),i.setEnd(r.endContainer,r.endOffset),n=i.toString().length}return n}function dS(e,t,n){let r=rR(),i=(0,eg.useRef)(null),o=(0,eg.useRef)(!1),s=(0,eg.useRef)(),a=e_("isEditing",()=>r.getEditingShapeId()===e,[r,e]);(0,eg.useEffect)(()=>{let e=i.current;e&&a&&document.activeElement!==e&&e.focus()},[a]);let l=(0,eg.useCallback)(()=>{let t=o.current;o.current=!1,requestAnimationFrame(()=>{let n=i.current;if(!n)return;let o=r.getShape(e);o&&(n.value=o.props.text,n.value.length&&!t&&n.select())})},[r,e]),d=(0,eg.useCallback)(()=>{let t=s.current;requestAnimationFrame(()=>{let n=i.current,s=r.getEditingShapeId();if(n&&s){if(s===e){if(t){if(t.length){o.current=!0,n.focus();let e=window.getSelection();e&&t.forEach(t=>e.addRange(t))}else n.focus()}else n.focus()}}else window.getSelection()?.removeAllRanges(),r.complete()})},[r,e]),c=(0,eg.useCallback)(e=>{if(a)switch((e.ctrlKey||e.metaKey)&&rT(e),e.key){case"Enter":(e.ctrlKey||e.metaKey)&&r.complete();break;case"Tab":rE(e),e.shiftKey?dv.unindent(e.currentTarget):dv.indent(e.currentTarget)}},[r,a]),u=(0,eg.useCallback)(n=>{if(!a)return;let i=dv.normalizeText(n.currentTarget.value),o=i.replace(/\t/g,"  ");if(o!==i){let e=n.currentTarget.selectionStart;n.currentTarget.value=o,n.currentTarget.selectionStart=e+(o.length-i.length),n.currentTarget.selectionEnd=e+(o.length-i.length),i=o}r.updateShapes([{id:e,type:t,props:{text:i}}])},[r,e,t,a]),h=0===n.trim().length;return(0,eg.useEffect)(()=>{if(a&&i.current){let e=function(){let e=window.getSelection?.();if(e&&"None"!==e.type){let t=[];if(e)for(let n=0;n<e.rangeCount;n++)t.push(e.getRangeAt?.(n));s.current=t}};return document.addEventListener("selectionchange",e),()=>{document.removeEventListener("selectionchange",e)}}},[a]),{rInput:i,isEditing:a,handleFocus:l,handleBlur:d,handleKeyDown:c,handleChange:u,handleInputPointerDown:(0,eg.useCallback)(t=>{r.dispatch({...rA(t),type:"pointer",name:"pointer_down",target:"shape",shape:r.getShape(e)}),rT(t)},[r,e]),handleDoubleClick:rT,isEmpty:h}}eg.memo(function({id:e,text:t,size:n,font:r,position:i,width:o,labelColor:s}){let{rInput:a,isEditing:l,handleFocus:d,handleBlur:c,handleKeyDown:u,handleChange:h,isEmpty:p,handleInputPointerDown:g,handleDoubleClick:f}=dS(e,"arrow",t),m=dv.normalizeTextForDom(t).trim().length>0;return l||m?(0,j.jsx)("div",{className:"tl-arrow-label","data-font":r,"data-align":"center","data-hastext":!p,"data-isediting":l,style:{textAlign:"center",fontSize:l0[n],lineHeight:l0[n]*lZ.lineHeight+"px",transform:`translate(${i.x}px, ${i.y}px)`,color:s},children:(0,j.jsxs)("div",{className:"tl-arrow-label__inner",children:[(0,j.jsx)("p",{style:{width:o||"9px"},children:t?dv.normalizeTextForDom(t):" "}),l&&(0,j.jsx)("textarea",{ref:a,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:t,onFocus:d,onChange:h,onKeyDown:u,onBlur:c,onContextMenu:rT,onPointerDown:g,onDoubleClick:f})]})}):null});var dw=((m=dw||{}).START="start",m.MIDDLE="middle",m.END="end",m);let dC="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function d_({url:e,zoomLevel:t}){return(0,j.jsx)("a",{className:rm("tl-hyperlink-button",{"tl-hyperlink-button__hidden":t<.32}),href:e,target:"_blank",rel:"noopener noreferrer",onPointerDown:rT,onPointerUp:rT,title:e,draggable:!1,children:(0,j.jsx)("div",{className:"tl-hyperlink-button__icon",style:{mask:`url("${dC}") center 100% / 100% no-repeat`,WebkitMask:`url("${dC}") center 100% / 100% no-repeat`}})})}eO(async(e,t)=>{let{url:n}=t.props,r=await e.getAssetForExternalContent({type:"url",url:n});r&&e.batch(()=>{e.createAssets([r]),e.updateShapes([{id:t.id,type:t.type,props:{assetId:r.id}}])})},500);function dk(e){return`${is(e.x)},${is(e.y)} `}function dP(e){let t,n,r,i="M",o=e.length;for(let s=0;s<o;s+=3)t=e[s],n=e[s+1],r=e[s+2],i+=`${dk(t)}L${dk(n)}Q${dk(r)}`;return i+`${dk(e[0])}`}function dI(e,t,n,r,i){let o;let s=[],a=function(e=""){let t=0,n=0,r=0,i=0;function o(){let e=t^t<<11;return t=n,n=r,r=i,(i^=(i>>>19^e^e>>>8)>>>0)/4294967296*2}for(let n=0;n<e.length+64;n++)t^=0|e.charCodeAt(n),o();return o}(e),l=t[0],d=t.length;for(let e=0,c=d*i;e<c;e++){o=rG.AddXY(t[(e+1)%d],a()*n,a()*n);let i=rG.Sub(o,l),c=rG.Len(i),u=rG.Div(i,c).mul(Math.min(c/4,r));s.push(rG.Add(l,u),rG.Add(o,u.neg()),o),l=o}return s}function dE(e,t){let n=Math.min(e,t)/2;return 2*n*Math.PI+2*(Math.max(e,t)-2*n)}(0,eg.forwardRef)(({id:e,name:t,isEditing:n},r)=>{let i=rR(),o=(0,eg.useCallback)(e=>{"Enter"!==e.key||e.nativeEvent.isComposing||(rT(e),e.currentTarget.blur(),i.setEditingShape(null))},[i]),s=(0,eg.useCallback)(t=>{let n=i.getShape(e);if(!n)return;let r=n.props.name,o=t.currentTarget.value.trim();r!==o&&i.updateShapes([{id:e,type:"frame",props:{name:o}}],{squashing:!0})},[e,i]),a=(0,eg.useCallback)(t=>{let n=i.getShape(e);if(!n)return;let r=n.props.name,o=t.currentTarget.value;r!==o&&i.updateShapes([{id:e,type:"frame",props:{name:o}}],{squashing:!0})},[e,i]);return(0,j.jsxs)("div",{className:`tl-frame-label ${n?"tl-frame-label__editing":""}`,children:[(0,j.jsx)("input",{className:"tl-frame-name-input",ref:r,style:{display:n?void 0:"none"},value:t,autoFocus:!0,onKeyDown:o,onBlur:s,onChange:a}),function(e,t){return e.match(/^\s*$/)?t:e}(t,"Frame")+String.fromCharCode(8203)]})}),eg.memo(function({id:e,type:t,text:n,size:r,labelColor:i,font:o,align:s,verticalAlign:a,wrap:l,bounds:d}){let{rInput:c,isEmpty:u,isEditing:h,handleFocus:p,handleChange:g,handleKeyDown:f,handleBlur:m,handleInputPointerDown:y,handleDoubleClick:b}=dS(e,t,n),v=dv.normalizeTextForDom(n),x=v.length>0,S="start-legacy"===s||"middle-legacy"===s||"end-legacy"===s,w=dg();return h||x?(0,j.jsx)("div",{className:"tl-text-label","data-font":o,"data-align":s,"data-hastext":!u,"data-isediting":h,"data-textwrap":!!l,style:{justifyContent:"middle"===s||S?"center":s,alignItems:"middle"===a?"center":a,...d?{top:d.minY,left:d.minX,width:d.width,height:d.height,position:"absolute"}:{}},children:(0,j.jsxs)("div",{className:"tl-text-label__inner",style:{fontSize:lQ[r],lineHeight:lQ[r]*lZ.lineHeight+"px",minHeight:lZ.lineHeight+32,minWidth:0,color:w[i].solid},children:[(0,j.jsx)("div",{className:"tl-text tl-text-content",dir:"ltr",children:v}),h&&(0,j.jsx)("textarea",{ref:c,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:n,onFocus:p,onChange:g,onKeyDown:f,onBlur:m,onContextMenu:rT,onPointerDown:y,onDoubleClick:b})]})}):null});let dj=(e,t,n,r,i)=>{switch(e){case"s":return t;case"m":return n;case"l":return r;case"xl":return i}};function dM(e,t,n,r){let i=e$(n),o=dE(e,t),s=Math.max(Math.ceil(o/dj(r,50,70,100,130)),6,Math.ceil(o/Math.min(e,t))),a=o/s*.2,l=Math.max(e-2*a,1),d=Math.max(t-2*a,1),c=(e-l)/2,u=(t-d)/2,h=dE(l,d)/s,p=(function(e,t,n){let r=Math.min(e,t)/2,i=Math.max(e,t)-2*r,o=(2*r*Math.PI+2*i)/n,s=e>t?[{type:"straight",start:new rG(r,0),delta:new rG(1,0)},{type:"arc",center:new rG(e-r,r),startAngle:-rQ/2},{type:"straight",start:new rG(e-r,t),delta:new rG(-1,0)},{type:"arc",center:new rG(r,r),startAngle:rQ/2}]:[{type:"straight",start:new rG(e,r),delta:new rG(0,1)},{type:"arc",center:new rG(r,t-r),startAngle:0},{type:"straight",start:new rG(0,t-r),delta:new rG(0,-1)},{type:"arc",center:new rG(r,r),startAngle:rQ}],a=0,l=[];for(let e=0;e<n;e++){let e=s[0];"straight"===e.type?l.push(rG.Add(e.start,rG.Mul(e.delta,a))):l.push(it(e.center,r,e.startAngle+a/r)),a+=o;let t="straight"===e.type?i:rQ*r;for(;a>t;)a-=t,s.push(s.shift()),t="straight"===s[0].type?i:rQ*r}return l})(l,d,s).map(e=>e.addXY(c,u)),g=e<20?0:.3*a,f=t<20?0:.3*a,m=p.slice(0);for(let e=0;e<Math.floor(s/2);e++)m[e]=rG.AddXY(m[e],i()*g,i()*f),m[s-e-1]=rG.AddXY(m[s-e-1],i()*g,i()*f);let y=[];for(let n=0;n<m.length;n++){let r=n===m.length-1?0:n+1,i=m[n],o=m[r],s=p[n],a=p[r],l=rG.Average([s,a]),d=rG.Angle(s,a)-Math.PI/2,g=rG.Dist(s,a),f=rG.Dist(i,o)/g*(Math.max(c,u)+(h-g)),b=rG.Add(l,rG.FromAngle(d,f));b.x<0?b.x=0:b.x>e&&(b.x=e),b.y<0?b.y=0:b.y>t&&(b.y=t);let v=dT(i,o,b),x=rG.Dist(v||rG.Average([i,o]),i);y.push({leftPoint:i,rightPoint:o,arcPoint:b,center:v,radius:x})}return y}function dT(e,t,n){let r=e.x*(t.y-n.y)-e.y*(t.x-n.x)+t.x*n.y-n.x*t.y,i=(e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y)+(n.x*n.x+n.y*n.y)*(t.y-e.y),o=(e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x)+(n.x*n.x+n.y*n.y)*(e.x-t.x),s=-i/(2*r),a=-o/(2*r);return Number.isFinite(s)&&Number.isFinite(a)?new rG(s,a):null}function dA(e,t,n,r){let i=dM(e,t,n,r),o=`M${is(i[0].leftPoint.x)},${is(i[0].leftPoint.y)}`;for(let{leftPoint:e,rightPoint:t,radius:n,center:r}of i){if(null===r){o+=` L${is(t.x)},${is(t.y)}`;continue}let i=dO(e,t,r)?"0":"1";o+=` A${is(n)},${is(n)} 0 ${i},1 ${is(t.x)},${is(t.y)}`}return o+" Z"}function dO(e,t,n){return(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)>0}function dR(e){return{size:1+e,thinning:.25,end:{taper:e},start:{taper:e},streamline:0,smoothing:1,simulatePressure:!1}}function dL(e,t,n,r){let i=e$(e),o=t/2,s=n/2,a=r6(o,s),l=[],d=r1*i(),c=r1+r0/2+Math.abs(i())*r0,u=Math.max(16,a/10);for(let e=0;e<u;e++){let r=e/(u-1),a=d+r*c,h=Math.cos(a),p=Math.sin(a);l.push(new rG(o*h+.5*t+.05*i(),s*p+n/2+.05*i(),Math.min(1,.5+Math.abs(.5-(i()>0?ry.easeInOutSine(r):ry.easeInExpo(r)))/2)))}return function(e,t={}){let n,r;let{streamline:i=.5,size:o=16,simulatePressure:s=!1}=t;if(0===e.length)return[];let a=.15+(1-i)*.85,l=e.map(rG.From),d=0;if(!s){let e=l[0];for(;e&&!(e.z>=.025);)l.shift(),e=l[0]}if(!s){let e=l[l.length-1];for(;e&&!(e.z>=.01);)l.pop(),e=l[l.length-1]}if(0===l.length)return[{point:rG.From(e[0]),input:rG.From(e[0]),pressure:s?.5:.15,vector:new rG(1,1),distance:0,runningLength:0,radius:1}];let c=l[1];for(;c&&!(rG.Dist(c,l[0])>o/3);)l[0].z=Math.max(l[0].z,c.z),l.splice(1,1),c=l[1];let u=l.pop();for(c=l[l.length-1];c&&!(rG.Dist(c,u)>o/3);)l.pop(),c=l[l.length-1],d++;l.push(u);let h=t.last||!t.simulatePressure||l.length>1&&rG.Dist(l[l.length-1],l[l.length-2])<o||d>0;if(2===l.length&&t.simulatePressure){let e=l[1];l=l.slice(0,-1);for(let t=1;t<5;t++){let n=rG.Lrp(l[0],e,t/4);n.z=(l[0].z+(e.z-l[0].z))*t/4,l.push(n)}}let p=[{point:l[0],input:l[0],pressure:s?.5:l[0].z,vector:new rG(1,1),distance:0,runningLength:0,radius:1}],g=0,f=p[0];h&&i>0&&l.push(l[l.length-1].clone());for(let e=1,i=l.length;e<i;e++)if(n=!a||t.last&&e===i-1?l[e].clone():l[e].clone().lrp(f.point,1-a),!f.point.equals(n)){if(g+=r=rG.Dist(n,f.point),e<4&&g<o)continue;f={input:l[e],point:n,pressure:s?.5:l[e].z,vector:rG.Sub(f.point,n).uni(),distance:r,runningLength:g,radius:1},p.push(f)}if(p[1]?.vector&&(p[0].vector=p[1].vector.clone()),g<1){let e=Math.max(.5,...p.map(e=>e.pressure));p.forEach(t=>t.pressure=e)}return p}(l,dR(r))}eg.memo(function({dash:e,fill:t,color:n,strokeWidth:r,w:i,h:o,id:s,size:a}){let l=dg(),d=dA(i,o,s,a),c=dM(i,o,s,a);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(df,{theme:l,d:d,fill:t,color:n}),(0,j.jsx)("g",{strokeWidth:r,stroke:l[n].solid,fill:"none",pointerEvents:"all",children:c.map(({leftPoint:t,rightPoint:n,center:i,radius:o},s)=>{let{strokeDasharray:a,strokeDashoffset:l}=db(i?o*r8(r8(rG.Angle(i,n))-r8(rG.Angle(i,t))):rG.Dist(t,n),r,{style:e,start:"outset",end:"outset"});return(0,j.jsx)("path",{d:i?`M${t.x},${t.y}A${o},${o},0,0,1,${n.x},${n.y}`:`M${t.x},${t.y}L${n.x},${n.y}`,strokeDasharray:a,strokeDashoffset:l},s)})})]})}),eg.memo(function({w:e,h:t,strokeWidth:n,dash:r,color:i,fill:o}){let s=dg(),a=e/2,l=t/2,d=Math.max(0,a),c=Math.max(0,l),u=r6(d,c),{strokeDasharray:h,strokeDashoffset:p}=db(u<64?2*u:u,n,{style:r,snap:4,closed:!0}),g=`M${a-d},${l}a${d},${c},0,1,1,${2*d},0a${d},${c},0,1,1,-${2*d},0`;return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(df,{theme:s,d:g,color:i,fill:o}),(0,j.jsx)("path",{d:g,strokeWidth:n,width:is(e),height:is(t),fill:"none",stroke:s[i].solid,strokeDasharray:h,strokeDashoffset:p,pointerEvents:"all"})]})}),eg.memo(function({w:e,h:t,strokeWidth:n,dash:r,color:i,fill:o}){let s=dg(),a=function(e,t){if(t>e){let n=e/2;return`
    M0,${n}
    a${n},${n},0,1,1,${2*n},0
    L${e},${t-n}
    a${n},${n},0,1,1,-${2*n},0
    Z`}let n=t/2;return`
    M${n},0
    L${e-n},0
    a${n},${n},0,1,1,0,${2*n}
    L${n},${t}
    a${n},${n},0,1,1,0,${-(2*n)}
    Z`}(e,t),l=function(e,t){if(e>t){let n=t/2;return r6(n,n)+(e-2*n)*2}let n=e/2;return r6(n,n)+(t-2*n)*2}(e,t),{strokeDasharray:d,strokeDashoffset:c}=db(l<64?2*l:l,n,{style:r,snap:4,start:"outset",end:"outset",closed:!0});return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(df,{theme:s,d:a,color:i,fill:o}),(0,j.jsx)("path",{d:a,strokeWidth:n,width:is(e),height:is(t),fill:"none",stroke:s[i].solid,strokeDasharray:d,strokeDashoffset:c,pointerEvents:"all"})]})}),eg.memo(function({dash:e,fill:t,color:n,strokeWidth:r,outline:i,lines:o}){let s=dg(),a="M"+i[0]+"L"+i.slice(1)+"Z";return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(df,{theme:s,d:a,fill:t,color:n}),(0,j.jsxs)("g",{strokeWidth:r,stroke:s[n].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(i.length)).map((t,n)=>{let o=i[n],s=i[(n+1)%i.length],{strokeDasharray:a,strokeDashoffset:l}=db(rG.Dist(o,s),r,{style:e,start:"outset",end:"outset"});return(0,j.jsx)("line",{x1:o.x,y1:o.y,x2:s.x,y2:s.y,strokeDasharray:a,strokeDashoffset:l},n)}),o&&o.map(([t,i],o)=>{let{strokeDasharray:a,strokeDashoffset:l}=db(rG.Dist(t,i),r,{style:e,start:"skip",end:"outset",snap:"dotted"===e?4:void 0});return(0,j.jsx)("path",{d:`M${t.x},${t.y}L${i.x},${i.y}`,stroke:s[n].solid,strokeWidth:r,fill:"none",strokeDasharray:a,strokeDashoffset:l},`line_fg_${o}`)})]})]})}),eg.memo(function({fill:e,color:t,strokeWidth:n,w:r,h:i,id:o,size:s}){let a=dg(),l=function(e,t,n,r){let i=e$(n),o="s"===r?.5:"m"===r?.7:"l"===r?.9:1.6,s=e=>e+i()*o*2,a=dM(e,t,n,r),l=a.reduce((e,t)=>e+rG.Dist(t.leftPoint,t.rightPoint),0)/a.length>15*o?e=>new rG(s(e.x),s(e.y)):e=>e,d=`M${is(a[0].leftPoint.x)},${is(a[0].leftPoint.y)}`,c=l(a[0].leftPoint),u=`M${is(c.x)},${is(c.y)}`;for(let{leftPoint:e,center:t,rightPoint:n,radius:r,arcPoint:i}of a){if(null===t){d+=` L${is(n.x)},${is(n.y)}`;let e=l(n);u+=` L${is(e.x)},${is(e.y)}`,c=e;continue}let o=dO(e,n,t)?"0":"1";d+=` A${is(r)},${is(r)} 0 ${o},1 ${is(n.x)},${is(n.y)}`;let s=l(n),a=dT(c,s,l(i));if(!a){u+=` L${is(s.x)},${is(s.y)}`,c=s;continue}let h=Math.abs(rG.Dist(a,c));u+=` A${is(h)},${is(h)} 0 ${o},1 ${is(s.x)},${is(s.y)}`,c=s}return d+u+" Z"}(r,i,o,s);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(df,{theme:a,d:l,fill:e,color:t}),(0,j.jsx)("path",{d:l,stroke:a[t].solid,strokeWidth:n,fill:"none"})]})}),eg.memo(function({id:e,w:t,h:n,strokeWidth:r,fill:i,color:o}){let s=dg(),a=function(e,t=!1){let n=e.length;if(n<2)return"";let r=e[0].point,i=e[1].point;if(2===n)return`M${rZ(r)}L${rZ(i)}`;let o="";for(let t=2,s=n-1;t<s;t++)o+=rJ(r=e[t].point,i=e[t+1].point);return t?`M${rJ(e[0].point,e[1].point)}Q${rZ(e[1].point)}${rJ(e[1].point,e[2].point)}T${o}${rJ(e[n-1].point,e[0].point)}${rJ(e[0].point,e[1].point)}Z`:`M${rZ(e[0].point)}Q${rZ(e[1].point)}${rJ(e[1].point,e[2].point)}${e.length>3?"T":""}${o}L${rZ(e[n-1].point)}`}(dL(e,t,n,r)),l=function(e,t,n,r){let i=dR(r);return iw(function(e,t={}){let{size:n=16,start:r={},end:i={},last:o=!1}=t,{cap:s=!0}=r,{cap:a=!0}=i;if(0===e.length||n<=0)return[];let l=e[0],d=e[e.length-1],c=d.runningLength,u=!1===r.taper?0:!0===r.taper?Math.max(n,c):r.taper,h=!1===i.taper?0:!0===i.taper?Math.max(n,c):i.taper,{left:p,right:g}=function(e,t={}){let n;let{size:r=16,smoothing:i=.5}=t;if(0===e.length||r<=0)return{left:[],right:[]};let o=e[0],s=e[e.length-1],a=s.runningLength,l=Math.pow(r*i,2),d=[],c=[],u=e[0].vector,h=e[0].point,p=h,g=h,f=p,m=!1;for(let t=0;t<e.length;t++){n=e[t];let{point:r,vector:i}=e[t],y=n.vector.dpr(u),b=(t<e.length-1?e[t+1]:e[t]).vector,v=t<e.length-1?b.dpr(n.vector):1,x=null!==v&&v<.2;if(y<0&&!m||x){if(v>-.62&&a-n.runningLength>n.radius){let e=u.clone().mul(n.radius);0>u.clone().cpr(b)?(g=rG.Add(r,e),f=rG.Sub(r,e)):(g=rG.Sub(r,e),f=rG.Add(r,e)),d.push(g),c.push(f)}else{let e=u.clone().mul(n.radius).per(),t=rG.Sub(n.input,e);for(let e=1/13,r=0;r<1;r+=e)g=rG.RotWith(t,n.input,lK*r),d.push(g),f=rG.RotWith(t,n.input,lK+-(lK*r)),c.push(f)}h=g,p=f,x&&(m=!0);continue}if(m=!1,n===o||n===s){let e=rG.Per(i).mul(n.radius);d.push(rG.Sub(r,e)),c.push(rG.Add(r,e));continue}let S=rG.Lrp(b,i,v).per().mul(n.radius);g=rG.Sub(r,S),(t<=1||rG.Dist2(h,g)>l)&&(d.push(g),h=g),f=rG.Add(r,S),(t<=1||rG.Dist2(p,f)>l)&&(c.push(f),p=f),u=i}return{left:d,right:c}}(e,t),f=l.point,m=e.length>1?e[e.length-1].point:rG.AddXY(l.point,1,1);if(1===e.length&&(!(u||h)||o)){let e=rG.Add(f,rG.Sub(f,m).uni().per().mul(-l.radius)),t=[];for(let n=1/13,r=n;r<=1;r+=n)t.push(rG.RotWith(e,f,2*lK*r));return t}let y=[];if(u||h&&1===e.length);else if(s)for(let e=1/8,t=e;t<=1;t+=e){let e=rG.RotWith(g[0],f,lK*t);y.push(e)}else{let e=rG.Sub(p[0],g[0]),t=rG.Mul(e,.5),n=rG.Mul(e,.51);y.push(rG.Sub(f,t),rG.Sub(f,n),rG.Add(f,n),rG.Add(f,t))}let b=[],v=d.vector.clone().per().neg();if(h||u&&1===e.length)b.push(m);else if(a){let e=rG.Add(m,rG.Mul(v,d.radius));for(let t=1/29,n=t;n<1;n+=t)b.push(rG.RotWith(e,m,3*lK*n))}else b.push(rG.Add(m,rG.Mul(v,d.radius)),rG.Add(m,rG.Mul(v,.99*d.radius)),rG.Sub(m,rG.Mul(v,.99*d.radius)),rG.Sub(m,rG.Mul(v,d.radius)));return p.concat(b,g.reverse(),y)}(function(e,t){let n,r;let{size:i=16,thinning:o=.5,simulatePressure:s=!0,easing:a=e=>e,start:l={},end:d={}}=t,{easing:c=ry.easeOutQuad}=l,{easing:u=ry.easeOutCubic}=d,h=e[e.length-1].runningLength,p=e[0].pressure;if(!s&&h<i){let t=e.reduce((e,t)=>Math.max(e,t.pressure),.5);return e.forEach(e=>{e.pressure=t,e.radius=i*a(.5-o*(.5-e.pressure))}),e}{let t;for(let n=0,o=e.length;n<o&&!((r=e[n]).runningLength>5*i);n++){let e=lH(1,r.distance/i);if(s){let n=lH(1,1-e);t=lH(1,p+.275*e*(n-p))}else t=lH(1,p+(r.pressure-p)*.5);p+=(t-p)*.5}for(let t=0;t<e.length;t++){if(r=e[t],o){let{pressure:e}=r,t=lH(1,r.distance/i);if(s){let n=lH(1,1-t);e=lH(1,p+.275*t*(n-p))}else e=lH(1,p+.275*t*(e-p));r.radius=i*a(.5-o*(.5-e)),p=e}else r.radius=i/2;void 0===n&&(n=r.radius)}}let g=!1===l.taper?0:!0===l.taper?Math.max(i,h):l.taper,f=!1===d.taper?0:!0===d.taper?Math.max(i,h):d.taper;if(g||f)for(let t=0;t<e.length;t++){let{runningLength:n}=r=e[t],i=n<g?c(n/g):1,o=h-n<f?u((h-n)/f):1;r.radius=Math.max(.01,r.radius*Math.min(i,o))}return e}(dL(e,t,n,r),i),i))}(e,t,n,r);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(df,{theme:s,d:a,color:o,fill:i}),(0,j.jsx)("path",{d:l,fill:s[o].solid,strokeWidth:0,pointerEvents:"all"})]})}),eg.memo(function({id:e,outline:t,lines:n,fill:r,color:i,strokeWidth:o}){let s=dg(),a=dP(dI(e,t,o/3,2*o,2));if(n)for(let[e,t]of n)a+=`M${e.x},${e.y}L${t.x},${t.y}`;let l=dP(dI(e,t,0,2*o,1));return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(df,{d:l,fill:r,color:i,theme:s}),(0,j.jsx)("path",{d:a,stroke:s[i].solid,strokeWidth:o,fill:"none"})]})}),eg.memo(function({fill:e,color:t,strokeWidth:n,w:r,h:i,id:o,size:s}){let a=dg(),l=dA(r,i,o,s);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(df,{theme:a,d:l,fill:e,color:t}),(0,j.jsx)("path",{d:l,stroke:a[t].solid,strokeWidth:n,fill:"none"})]})}),eg.memo(function({w:e,h:t,strokeWidth:n,fill:r,color:i}){let o=dg(),s=e/2,a=t/2,l=Math.max(0,s),d=Math.max(0,a),c=`M${s-l},${a}a${l},${d},0,1,1,${2*l},0a${l},${d},0,1,1,-${2*l},0`;return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(df,{d:c,color:i,fill:r,theme:o}),(0,j.jsx)("path",{d:c,stroke:o[i].solid,strokeWidth:n,fill:"none"})]})}),eg.memo(function({w:e,h:t,strokeWidth:n,fill:r,color:i}){let o=dg(),s=function(e,t){let n;if(t>e){let r=e/2;n=`
    M0,${r}
    a${r},${r},0,1,1,${2*r},0
    L${e},${t-r}
    a${r},${r},0,1,1,-${2*r},0
    Z`}else{let r=t/2;n=`
    M${r},0
    L${e-r},0
    a${r},${r},0,1,1,0,${2*r}
    L${r},${t}
    a${r},${r},0,1,1,0,${-(2*r)}
    Z`}return n}(e,t);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(df,{d:s,color:i,fill:r,theme:o}),(0,j.jsx)("path",{d:s,stroke:o[i].solid,strokeWidth:n,fill:"none"})]})}),eg.memo(function({outline:e,lines:t,fill:n,color:r,strokeWidth:i}){let o=dg(),s="M"+e[0]+"L"+e.slice(1)+"Z";if(t)for(let[e,n]of t)s+=`M${e.x},${e.y}L${n.x},${n.y}`;return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(df,{d:s,fill:n,color:r,theme:o}),(0,j.jsx)("path",{d:s,stroke:o[r].solid,strokeWidth:i,fill:"none"})]})}),new sY,new sY,eS(function(e){let{shape:t,videoUtil:n}=e,r=n.editor.getShapeGeometry(t).bounds.w*n.editor.getZoomLevel()>=110,i=t.props.assetId?n.editor.getAsset(t.props.assetId):null,{time:o,playing:s}=t.props,a=lN(t.id),l=function(){let[e,t]=(0,eg.useState)(!1);return(0,eg.useEffect)(()=>{let e=window.matchMedia("(prefers-reduced-motion: reduce)"),n=()=>{t(e.matches)};return n(),e.addEventListener("change",n),()=>e.removeEventListener("change",n)},[]),e}(),d=eg.useRef(null),c=eg.useCallback(e=>{let r=e.currentTarget;n.editor.updateShapes([{type:"video",id:t.id,props:{playing:!0,time:r.currentTime}}])},[t.id,n.editor]),u=eg.useCallback(e=>{let r=e.currentTarget;n.editor.updateShapes([{type:"video",id:t.id,props:{playing:!1,time:r.currentTime}}])},[t.id,n.editor]),h=eg.useCallback(e=>{let r=e.currentTarget;a&&n.editor.updateShapes([{type:"video",id:t.id,props:{time:r.currentTime}}])},[a,t.id,n.editor]),[p,g]=eg.useState(!1),f=eg.useCallback(e=>{let t=e.currentTarget;o!==t.currentTime&&(t.currentTime=o),s||t.pause(),g(!0)},[s,o]);return eg.useEffect(()=>{let e=d.current;e&&(p&&!a&&o!==e.currentTime&&(e.currentTime=o),a&&document.activeElement!==e&&e.focus())},[a,p,o]),eg.useEffect(()=>{if(l){let e=d.current;e.pause(),e.currentTime=0}},[d,l]),(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(lD,{id:t.id,children:(0,j.jsx)("div",{className:"tl-counter-scaled",children:i?.props.src?(0,j.jsx)("video",{ref:d,style:a?{pointerEvents:"all"}:void 0,className:`tl-video tl-video-shape-${t.id.split(":")[1]}`,width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:a&&r,onPlay:c,onPause:u,onTimeUpdate:h,onLoadedData:f,hidden:!p,children:(0,j.jsx)("source",{src:i.props.src})}):null})}),"url"in t.props&&t.props.url&&(0,j.jsx)(d_,{url:t.props.url,zoomLevel:n.editor.getZoomLevel()})]})});class dD extends aV{static id="erasing";info={};scribbleId="id";markId="";excludedShapeIds=new Set;onEnter=e=>{this.markId="erase scribble begin",this.editor.mark(this.markId),this.info=e;let{originPagePoint:t}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(e=>{if(this.editor.isShapeOrAncestorLocked(e))return!0;if(this.editor.isShapeOfType(e,"group")||this.editor.isShapeOfType(e,"frame")){let n=this.editor.getPointInShapeSpace(e,t);return this.editor.getShapeGeometry(e).bounds.containsPoint(n)}return!1}).map(e=>e.id));let n=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=n.id,this.update()};pushPointToScribble=()=>{let{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)};onExit=()=>{this.editor.scribbles.stop(this.scribbleId)};onPointerMove=()=>{this.update()};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};update(){let e=this.editor.getErasingShapeIds(),t=this.editor.getZoomLevel(),n=this.editor.getCurrentPageShapes(),{inputs:{currentPagePoint:r,previousPagePoint:i}}=this.editor,{excludedShapeIds:o}=this;this.pushPointToScribble();let s=new Set(e);for(let e of n){if(this.editor.isShapeOfType(e,"group"))continue;let n=this.editor.getShapeMask(e.id);if(n&&!io(r,n))continue;let o=this.editor.getShapeGeometry(e),a=this.editor.getPointInShapeSpace(e,i),l=this.editor.getPointInShapeSpace(e,r);o.hitTestLineSegment(a,l,8/t)&&s.add(this.editor.getOutermostSelectableShape(e).id)}this.editor.setErasingShapes([...s].filter(e=>!o.has(e)))}complete(){this.editor.deleteShapes(this.editor.getCurrentPageState().erasingShapeIds),this.editor.setErasingShapes([]),this.parent.transition("idle")}cancel(){this.editor.setErasingShapes([]),this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}}class dz extends aV{static id="brushing";info={};brush=new oE;initialSelectedShapeIds=[];excludedShapeIds=new Set;initialStartShape=null;onEnter=e=>{let{altKey:t,currentPagePoint:n}=this.editor.inputs;if(t){this.parent.transition("scribble_brushing",e);return}this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(e=>this.editor.isShapeOfType(e,"group")||this.editor.isShapeOrAncestorLocked(e)).map(e=>e.id)),this.info=e,this.initialSelectedShapeIds=this.editor.getSelectedShapeIds().slice(),this.initialStartShape=this.editor.getShapesAtPoint(n)[0],this.onPointerMove()};onExit=()=>{this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})};onTick=()=>{lB(this.editor)};onPointerMove=()=>{this.hitTestShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=e=>{this.editor.setSelectedShapes(this.initialSelectedShapeIds,{squashing:!0}),this.parent.transition("idle",e)};onKeyDown=e=>{this.editor.inputs.altKey?this.parent.transition("scribble_brushing",e):this.hitTestShapes()};onKeyUp=()=>{this.hitTestShapes()};complete(){this.parent.transition("idle")}hitTestShapes(){let e,t,n,r,i,o;let s=this.editor.getZoomLevel(),a=this.editor.getCurrentPageShapes(),l=this.editor.getCurrentPageId(),{inputs:{originPagePoint:d,currentPagePoint:c,shiftKey:u,ctrlKey:h}}=this.editor;this.brush.setTo(oE.FromPoints([d,c]));let p=new Set(u?this.initialSelectedShapeIds:[]),{corners:g}=this.brush,{excludedShapeIds:f}=this;for(let d=0,u=a.length;d<u;d++)if(n=a[d],!(f.has(n.id)||p.has(n.id))&&(r=this.editor.getShapePageBounds(n))){if(this.brush.contains(r)){this.handleHit(n,c,l,p,g);continue}if(!(h||this.editor.isShapeOfType(n,"frame"))&&this.brush.collides(r)){let r=this.editor.getShapeGeometry(n);if(!(i=this.editor.getShapePageTransform(n)))continue;o=i.clone().invert().applyToPoints(g);for(let i=0;i<o.length;i++)if(e=o[i],t=o[(i+1)%o.length],r.hitTestLineSegment(e,t,8/s)){this.handleHit(n,c,l,p,g);break}}}this.editor.updateInstanceState({brush:{...this.brush.toJson()}}),this.editor.setSelectedShapes(Array.from(p),{squashing:!0})}onInterrupt=()=>{this.editor.updateInstanceState({brush:null})};handleHit(e,t,n,r,i){if(e.parentId===n){r.add(e.id);return}let o=this.editor.getOutermostSelectableShape(e),s=this.editor.getShapeMask(o.id);(!s||function(e,t){let n,r;for(let i=0,o=e.length;i<o;i++){n=e[i],r=e[(i+1)%o];for(let e=0,i=t.length;e<i;e++)if(sM(n,r,t[e],t[(e+1)%i]))return!0}return!1}(s,i)||io(t,s))&&r.add(o.id)}}function dN(e){let t=e.getOnlySelectedShape();return!!(t&&!e.isShapeOrAncestorLocked(t)&&e.getShapeUtil(t).canCrop(t))}function d$(e){let t=e.getSelectedShapeIds(),{shiftKey:n,altKey:r,currentPagePoint:i}=e.inputs,o=e.getShapeAtPoint(i,{hitInside:!1,margin:8/e.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:e=>!e.isLocked});if(o){let i=e.getOutermostSelectableShape(o);if(n&&!r)e.cancelDoubleClick(),t.includes(i.id)?(e.mark("deselecting shape"),e.deselect(i)):(e.mark("shift selecting shape"),e.setSelectedShapes([...t,i.id]));else{let n;(n=i===o?o:i.id===e.getFocusedGroupId()||t.includes(i.id)?o:i)&&!t.includes(n.id)&&(e.mark("selecting shape"),e.select(n.id))}}else{if(n)return;{t.length>0&&(e.mark("selecting none"),e.selectNone());let n=e.getFocusedGroupId();if(nF(n)){let t=e.getShape(n);e.isPointInShape(t,i,{margin:0,hitInside:!0})||e.setFocusedGroup(null)}}}}class dF extends aV{static id="idle";onEnter=()=>{this.parent.setCurrentToolIdMask(void 0),dp(this.editor),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})};onPointerMove=()=>{dp(this.editor)};onPointerDown=e=>{if(this.editor.getIsMenuOpen())return;let t=e.ctrlKey&&dN(this.editor);if(e.ctrlKey&&!t){if("shape"===e.target&&this.isDarwin&&this.editor.inputs.keys.has("ControlLeft")&&!this.editor.isShapeOrAncestorLocked(e.shape)){this.parent.transition("pointing_shape",e);return}this.parent.transition("brushing",e);return}switch(e.target){case"canvas":{let t=function(e){let t=e.getZoomLevel(),{inputs:{currentPagePoint:n}}=e;return e.getShapeAtPoint(n,{hitInside:!1,hitLabels:!1,margin:8/t,renderingOnly:!0})??e.getSelectedShapeAtPoint(n)}(this.editor);if(t&&!t.isLocked){this.onPointerDown({...e,shape:t,target:"shape"});return}let n=this.editor.getSelectedShapeIds(),r=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:i}}=this.editor;if((n.length>1||r&&!this.editor.getShapeUtil(r).hideSelectionBoundsBg(r))&&dK(this.editor,i)){this.onPointerDown({...e,target:"selection"});return}this.parent.transition("pointing_canvas",e);break}case"shape":{let{shape:t}=e,n=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint);if(this.editor.isShapeOfType(t,"arrow")){let r=this.editor.getShapeGeometry(t).children[1];if(r&&io(n,r.vertices)){this.parent.transition("pointing_arrow_label",e);break}}if(this.editor.isShapeOrAncestorLocked(t)){this.parent.transition("pointing_canvas",e);break}this.parent.transition("pointing_shape",e);break}case"handle":if(this.editor.getInstanceState().isReadonly)break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break;case"selection":switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":this.parent.transition("pointing_rotate_handle",e);break;case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":t?this.parent.transition("pointing_crop_handle",e):this.parent.transition("pointing_resize_handle",e);break;default:{let t=this.editor.getHoveredShape();if(t&&!this.editor.getSelectedShapeIds().includes(t.id)&&!t.isLocked){this.onPointerDown({...e,shape:t,target:"shape"});return}this.parent.transition("pointing_selection",e)}}}};onDoubleClick=e=>{if(!this.editor.inputs.shiftKey&&"up"===e.phase)switch(e.target){case"canvas":{let t=this.editor.getHoveredShape(),n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:8/this.editor.getZoomLevel(),hitInside:!1}),r=this.editor.getFocusedGroupId();if(n){if(this.editor.isShapeOfType(n,"group")){d$(this.editor);return}{let e=this.editor.getShape(n.parentId);if(e&&this.editor.isShapeOfType(e,"group")){if(r&&e.id===r);else{d$(this.editor);return}}}this.onDoubleClick({...e,shape:n,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.getInstanceState().isReadonly)break;let t=this.editor.getOnlySelectedShape();if(t){let n=this.editor.getShapeUtil(t);if(!this.canInteractWithShapeInReadOnly(t))return;if("right"===e.handle||"left"===e.handle||"top"===e.handle||"bottom"===e.handle){let e=n.onDoubleClickEdge?.(t);if(e){this.editor.mark("double click edge"),this.editor.updateShapes([e]);return}}if(n.canCrop(t)&&!this.editor.isShapeOrAncestorLocked(t)){this.parent.transition("crop",e);return}this.shouldStartEditingShape(t)&&this.startEditingShape(t,e)}break}case"shape":{let{shape:t}=e,n=this.editor.getShapeUtil(t);if("video"!==t.type&&"embed"!==t.type&&this.editor.getInstanceState().isReadonly)break;if(n.onDoubleClick){let r=n.onDoubleClick?.(t);if(r){this.editor.updateShapes([r]);return}if(n.canCrop(t)&&!this.editor.isShapeOrAncestorLocked(t)){this.editor.mark("select and crop"),this.editor.select(e.shape?.id),this.parent.transition("crop",e);return}}this.shouldStartEditingShape(t)?this.startEditingShape(t,e):this.handleDoubleClickOnCanvas(e);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;let{shape:t,handle:n}=e,r=this.editor.getShapeUtil(t),i=r.onDoubleClickHandle?.(t,n);i?this.editor.updateShapes([i]):this.shouldStartEditingShape(t)&&this.startEditingShape(t,e)}}};onRightClick=e=>{switch(e.target){case"canvas":{let t=this.editor.getHoveredShape(),n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:8/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitFrameInside:!1,renderingOnly:!0});if(n){this.onRightClick({...e,shape:n,target:"shape"});return}let r=this.editor.getSelectedShapeIds(),i=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:o}}=this.editor;if((r.length>1||i&&!this.editor.getShapeUtil(i).hideSelectionBoundsBg(i))&&dK(this.editor,o)){this.onRightClick({...e,target:"selection"});return}this.editor.selectNone();break}case"shape":{let{selectedShapeIds:t}=this.editor.getCurrentPageState(),{shape:n}=e,r=this.editor.getOutermostSelectableShape(n,e=>!t.includes(e.id));t.includes(r.id)||(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([r.id]))}}};onCancel=()=>{this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.mark("clearing selection"),this.editor.selectNone())};onKeyDown=e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":this.nudgeSelectedShapes(!1)}};onKeyRepeat=e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":this.nudgeSelectedShapes(!0)}};onKeyUp=e=>{if("Enter"===e.code){let t=this.editor.getSelectedShapes();if(t.every(e=>this.editor.isShapeOfType(e,"group"))){this.editor.setSelectedShapes(t.flatMap(e=>this.editor.getSortedChildIdsForParent(e.id)));return}let n=this.editor.getOnlySelectedShape();if(n&&this.shouldStartEditingShape(n)){this.startEditingShape(n,{...e,target:"shape",shape:n});return}dN(this.editor)&&this.parent.transition("crop",e)}};shouldStartEditingShape(e=this.editor.getOnlySelectedShape()){return!(!e||this.editor.isShapeOrAncestorLocked(e)&&"embed"!==e.type)&&!!this.canInteractWithShapeInReadOnly(e)&&this.editor.getShapeUtil(e).canEdit(e)}startEditingShape(e,t){this.editor.isShapeOrAncestorLocked(e)&&"embed"!==e.type||(this.editor.mark("editing shape"),this.editor.setEditingShape(e.id),this.parent.transition("editing_shape",t))}isDarwin=window.navigator.userAgent.toLowerCase().indexOf("mac")>-1;handleDoubleClickOnCanvas(e){if(this.editor.getInstanceState().isReadonly)return;this.editor.mark("creating text shape");let t=nB(),{x:n,y:r}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:t,type:"text",x:n,y:r,props:{text:"",autoSize:!0}}]);let i=this.editor.getShape(t);if(!i)return;let o=this.editor.getShapeUtil(i);(!this.editor.getInstanceState().isReadonly||o.canEditInReadOnly(i))&&(this.editor.setEditingShape(t),this.editor.select(t),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(e=!1){let{editor:{inputs:{keys:t}}}=this,n=t.has("ShiftLeft"),r=new rG(0,0);if(t.has("ArrowLeft")&&(r.x-=1),t.has("ArrowRight")&&(r.x+=1),t.has("ArrowUp")&&(r.y-=1),t.has("ArrowDown")&&(r.y+=1),r.equals(new rG(0,0)))return;e||this.editor.mark("nudge shapes");let{gridSize:i}=this.editor.getDocumentSettings(),o=this.editor.getInstanceState().isGridMode?n?i*dU:i:n?dB:dV;this.editor.nudgeShapes(this.editor.getSelectedShapeIds(),r.mul(o))}canInteractWithShapeInReadOnly(e){return!!(!this.editor.getInstanceState().isReadonly||this.editor.getShapeUtil(e).canEditInReadOnly(e))}}let dB=10,dV=1,dU=5;function dK(e,t){let n=e.getSelectionRotatedPageBounds();if(!n)return!1;let r=e.getSelectionRotation();return r?io(t,n.corners.map(e=>rG.RotWith(e,n.point,r))):n.containsPoint(t)}class dH extends aV{static id="pointing_arrow_label";shapeId="";markId="";info={};updateCursor(){this.editor.updateInstanceState({cursor:{type:"grabbing",rotation:0}})}onEnter=e=>{let{shape:t}=e;this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.shapeId=t.id,this.updateCursor();let n=this.editor.getShapeGeometry(t).children[1];if(!n)throw Error(`Expected to find an arrow label geometry for shape: ${t.id}`);let{currentPagePoint:r}=this.editor.inputs,i=this.editor.getPointInShapeSpace(t,r);this._labelDragOffset=rG.Sub(n.center,i),this.markId="label-drag start",this.editor.mark(this.markId),this.editor.setSelectedShapes([this.shapeId])};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})};_labelDragOffset=new rG(0,0);onPointerMove=()=>{let e;let{isDragging:t}=this.editor.inputs;if(!t)return;let n=this.editor.getShape(this.shapeId);if(!n)return;let r=this.editor.getArrowInfo(n),i=this.editor.getShapeGeometry(n),o=i.children[0],s=this.editor.getPointInShapeSpace(n,this.editor.inputs.currentPagePoint),a=o.nearestPoint(rG.Add(s,this._labelDragOffset));if(r.isStraight){let t=rG.Dist(r.start.point,r.end.point);e=1-rG.Dist(r.end.point,a)/t}else{let{_center:t,measure:n,angleEnd:r,angleStart:o}=i.children[0];e=id(n,o,r,t.angle(a))}this.editor.updateShape({id:n.id,type:n.type,props:{labelPosition:e}},{squashing:!0})};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}class dY extends aV{static id="scribble_brushing";hits=new Set;size=0;scribbleId="id";initialSelectedShapeIds=new Set;newlySelectedShapeIds=new Set;onEnter=()=>{this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();let e=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=e.id,this.updateScribbleSelection(!0),requestAnimationFrame(()=>{this.editor.updateInstanceState({brush:null})})};onExit=()=>{this.editor.scribbles.stop(this.scribbleId)};onPointerMove=()=>{this.updateScribbleSelection(!0)};onPointerUp=()=>{this.complete()};onKeyDown=()=>{this.updateScribbleSelection(!1)};onKeyUp=()=>{this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};pushPointToScribble=()=>{let{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)};updateScribbleSelection(e){let t,n,r,i;let o=this.editor.getZoomLevel(),s=this.editor.getCurrentPageShapes(),{inputs:{shiftKey:a,originPagePoint:l,previousPagePoint:d,currentPagePoint:c}}=this.editor,{newlySelectedShapeIds:u,initialSelectedShapeIds:h}=this;e&&this.pushPointToScribble();for(let e=0,a=s.length;e<a;e++)if(t=s[e],n=this.editor.getShapeGeometry(t),!(this.editor.isShapeOfType(t,"group")||u.has(t.id)||this.editor.isShapeOrAncestorLocked(t))){if(this.editor.isShapeOfType(t,"frame")){let e=this.editor.getPointInShapeSpace(t,l);if(n.bounds.containsPoint(e))continue}if(r=this.editor.getPointInShapeSpace(t,d),i=this.editor.getPointInShapeSpace(t,c),n.hitTestLineSegment(r,i,8/o)){let e=this.editor.getOutermostSelectableShape(t),n=this.editor.getShapeMask(e.id);if(n&&null!==sP(d,c,n)&&!io(c,n))continue;u.add(e.id)}}this.editor.setSelectedShapes([...new Set(a?[...u,...h]:[...u])],{squashing:!0})}complete(){this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds],{squashing:!0}),this.parent.transition("idle")}}class dW{constructor(e){this.editor=e,e.disposables.add(this.dispose)}prevDroppingShapeId=null;droppingNodeTimer=null;first=!0;updateDroppingNode(e,t){this.first&&(this.prevDroppingShapeId=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,e)?.id??null,this.first=!1),null===this.droppingNodeTimer?this.setDragTimer(e,1e3,t):this.editor.inputs.pointerVelocity.len()>.5&&(clearInterval(this.droppingNodeTimer),this.setDragTimer(e,100,t))}setDragTimer(e,t,n){this.droppingNodeTimer=setTimeout(()=>{this.editor.batch(()=>{this.handleDrag(this.editor.inputs.currentPagePoint,e,n)}),this.droppingNodeTimer=null},t)}handleDrag(e,t,n){t=eI(t.map(e=>this.editor.getShape(e.id)));let r=this.editor.getDroppingOverShape(e,t)?.id??null;if(r===this.prevDroppingShapeId)return;let{prevDroppingShapeId:i}=this,o=i&&this.editor.getShape(i),s=r&&this.editor.getShape(r);if(o&&this.editor.getShapeUtil(o).onDragShapesOut?.(o,t),s){let e=this.editor.getShapeUtil(s).onDragShapesOver?.(s,t);e&&e.shouldHint&&this.editor.setHintingShapes([s.id])}else this.editor.setHintingShapes([]);n?.(),this.prevDroppingShapeId=r}dropShapes(e){let{prevDroppingShapeId:t}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,e),t){let n=this.editor.getShape(t);if(!n)return;this.editor.getShapeUtil(n).onDropShapesOver?.(n,e)}}clear(){this.prevDroppingShapeId=null,null!==this.droppingNodeTimer&&clearInterval(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}dispose=()=>{this.clear()}}class dX extends aV{static id="translating";info={};selectionSnapshot={};snapshot={};markId="";isCloning=!1;isCreating=!1;onCreate=()=>void 0;dragAndDropManager=new dW(this.editor);onEnter=e=>{let{isCreating:t=!1,onCreate:n=()=>void 0}=e;if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.isCreating=t,this.onCreate=n,t?this.markId=`creating:${this.editor.getOnlySelectedShape().id}`:(this.markId="translating",this.editor.mark(this.markId)),this.isCloning=!1,this.info=e,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=dG(this.editor),!this.isCreating&&this.editor.inputs.altKey){this.startCloning();return}this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clear(),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.dragAndDropManager.clear()};onTick=()=>{this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),lB(this.editor)};onPointerMove=()=>{this.updateShapes()};onKeyDown=()=>{if(this.editor.inputs.altKey&&!this.isCloning){this.startCloning();return}this.updateShapes()};onKeyUp=()=>{if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=dG(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?this.onCreate?.(this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){let{movingShapes:e}=this.snapshot,t=[];e.forEach(e=>{let n=this.editor.getShapeUtil(e),r=n.onTranslateStart?.(e);r&&t.push(r)}),t.length>0&&this.editor.updateShapes(t),this.editor.setHoveredShape(null)}handleEnd(){let{movingShapes:e}=this.snapshot;if(this.isCloning){let t=rG.Average(e.map(e=>this.editor.getShapePageTransform(e.id).point())),n=rG.Sub(t,this.selectionSnapshot.averagePagePoint);this.editor.updateInstanceState({duplicateProps:{shapeIds:e.map(e=>e.id),offset:{x:n.x,y:n.y}}})}let t=[];e.forEach(e=>{let n=this.editor.getShape(e.id),r=this.editor.getShapeUtil(e),i=r.onTranslateEnd?.(e,n);i&&t.push(i)}),t.length>0&&this.editor.updateShapes(t)}handleChange(){let{movingShapes:e}=this.snapshot,t=[];e.forEach(e=>{let n=this.editor.getShape(e.id),r=this.editor.getShapeUtil(e),i=r.onTranslate?.(e,n);i&&t.push(i)}),t.length>0&&this.editor.updateShapes(t)}updateShapes(){let{snapshot:e}=this;this.dragAndDropManager.updateDroppingNode(e.movingShapes,this.updateParentTransforms),function({editor:e,shapeSnapshots:t,averagePagePoint:n,initialSelectionPageBounds:r,initialSelectionSnapPoints:i}){let{inputs:o}=e,s=e.getInstanceState().isGridMode,a=e.getDocumentSettings().gridSize,l=rG.Sub(o.currentPagePoint,o.originPagePoint),d=e.inputs.shiftKey?Math.abs(l.x)<Math.abs(l.y)?"x":"y":null;if("x"===d?l.x=0:"y"===d&&(l.y=0),e.snaps.clear(),(e.user.getIsSnapMode()?!o.ctrlKey:o.ctrlKey)&&.5>e.inputs.pointerVelocity.len()){let{nudge:t}=e.snaps.snapTranslate({dragDelta:l,initialSelectionPageBounds:r,lockedAxis:d,initialSelectionSnapPoints:i});l.add(t)}let c=rG.Add(n,l);s&&!o.ctrlKey&&c.snapToGrid(a);let u=rG.Sub(c,n);e.updateShapes(eI(t.map(({shape:e,pagePoint:t,parentTransform:n})=>{let r=rG.Add(t,u),i=n?oj.applyToPoint(n,r):r;return{id:e.id,type:e.type,x:i.x,y:i.y}})),{squashing:!0})}({editor:this.editor,shapeSnapshots:e.shapeSnapshots,averagePagePoint:e.averagePagePoint,initialSelectionPageBounds:e.initialPageBounds,initialSelectionSnapPoints:e.initialSnapPoints}),this.handleChange()}updateParentTransforms=()=>{let{editor:e,snapshot:{shapeSnapshots:t}}=this,n=[];t.forEach(t=>{let r=e.getShape(t.shape.id);if(!r)return null;n.push(r);let i=t8(r.parentId)?null:oj.Inverse(e.getShapePageTransform(r.parentId));t.parentTransform=i})}}function dG(e){let t=[],n=[],r=eI(e.getSelectedShapeIds().map(r=>{let i=e.getShape(r);if(!i)return null;t.push(i);let o=e.getShapePageTransform(r).point();if(!o)return null;n.push(o);let s=t6.isId(i.parentId)?null:oj.Inverse(e.getShapePageTransform(i.parentId));return{shape:i,pagePoint:o,parentTransform:s}})),i=[];if(1===e.getSelectedShapeIds().length)i=e.snaps.getSnapPointsCache().get(e.getSelectedShapeIds()[0]);else{let t=e.getSelectionPageBounds();t&&(i=t.snapPoints.map((e,t)=>({id:"selection:"+t,x:e.x,y:e.y})))}return{averagePagePoint:rG.Average(n),movingShapes:t,shapeSnapshots:r,initialPageBounds:e.getSelectionPageBounds(),initialSnapPoints:i}}class dq extends aV{static id="zoom_brushing";info={};zoomBrush=new oE;onEnter=e=>{this.info=e,this.update()};onExit=()=>{this.editor.updateInstanceState({zoomBrush:null})};onPointerMove=()=>{this.update()};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};update(){let{inputs:{originPagePoint:e,currentPagePoint:t}}=this.editor;this.zoomBrush.setTo(oE.FromPoints([e,t])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){let{zoomBrush:e}=this,t=8/this.editor.getZoomLevel();if(e.width<t&&e.height<t){let e=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(e,{duration:220}):this.editor.zoomIn(e,{duration:220})}else{let t=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(e,t,{duration:220})}this.parent.transition("idle",this.info)}}function dZ(){return(dZ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var dJ=n(962);function dQ(e,t,{checkForDefaultPrevented:n=!0}={}){return function(r){if(null==e||e(r),!1===n||!r.defaultPrevented)return null==t?void 0:t(r)}}function d0(...e){return t=>e.forEach(e=>{"function"==typeof e?e(t):null!=e&&(e.current=t)})}function d1(...e){return(0,eg.useCallback)(d0(...e),e)}function d2(e,t=[]){let n=[],r=()=>{let t=n.map(e=>(0,eg.createContext)(e));return function(n){let r=(null==n?void 0:n[e])||t;return(0,eg.useMemo)(()=>({[`__scope${e}`]:{...n,[e]:r}}),[n,r])}};return r.scopeName=e,[function(t,r){let i=(0,eg.createContext)(r),o=n.length;function s(t){let{scope:n,children:r,...s}=t,a=(null==n?void 0:n[e][o])||i,l=(0,eg.useMemo)(()=>s,Object.values(s));return(0,eg.createElement)(a.Provider,{value:l},r)}return n=[...n,r],s.displayName=t+"Provider",[s,function(n,s){let a=(null==s?void 0:s[e][o])||i,l=(0,eg.useContext)(a);if(l)return l;if(void 0!==r)return r;throw Error(`\`${n}\` must be used within \`${t}\``)}]},function(...e){let t=e[0];if(1===e.length)return t;let n=()=>{let n=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let r=n.reduce((t,{useScope:n,scopeName:r})=>{let i=n(e)[`__scope${r}`];return{...t,...i}},{});return(0,eg.useMemo)(()=>({[`__scope${t.scopeName}`]:r}),[r])}};return n.scopeName=t.scopeName,n}(r,...t)]}let d5=(0,eg.forwardRef)((e,t)=>{let{children:n,...r}=e,i=eg.Children.toArray(n),o=i.find(d6);if(o){let e=o.props.children,n=i.map(t=>t!==o?t:eg.Children.count(e)>1?eg.Children.only(null):(0,eg.isValidElement)(e)?e.props.children:null);return(0,eg.createElement)(d3,dZ({},r,{ref:t}),(0,eg.isValidElement)(e)?(0,eg.cloneElement)(e,void 0,n):null)}return(0,eg.createElement)(d3,dZ({},r,{ref:t}),n)});d5.displayName="Slot";let d3=(0,eg.forwardRef)((e,t)=>{let{children:n,...r}=e;return(0,eg.isValidElement)(n)?(0,eg.cloneElement)(n,{...function(e,t){let n={...t};for(let r in t){let i=e[r],o=t[r];/^on[A-Z]/.test(r)?i&&o?n[r]=(...e)=>{o(...e),i(...e)}:i&&(n[r]=i):"style"===r?n[r]={...i,...o}:"className"===r&&(n[r]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}(r,n.props),ref:t?d0(t,n.ref):n.ref}):eg.Children.count(n)>1?eg.Children.only(null):null});d3.displayName="SlotClone";let d4=({children:e})=>(0,eg.createElement)(eg.Fragment,null,e);function d6(e){return(0,eg.isValidElement)(e)&&e.type===d4}function d8(e){let t=e+"CollectionProvider",[n,r]=d2(t),[i,o]=n(t,{collectionRef:{current:null},itemMap:new Map}),s=e+"CollectionSlot",a=eg.forwardRef((e,t)=>{let{scope:n,children:r}=e,i=d1(t,o(s,n).collectionRef);return eg.createElement(d5,{ref:i},r)}),l=e+"CollectionItemSlot",d="data-radix-collection-item";return[{Provider:e=>{let{scope:t,children:n}=e,r=eg.useRef(null),o=eg.useRef(new Map).current;return eg.createElement(i,{scope:t,itemMap:o,collectionRef:r},n)},Slot:a,ItemSlot:eg.forwardRef((e,t)=>{let{scope:n,children:r,...i}=e,s=eg.useRef(null),a=d1(t,s),c=o(l,n);return eg.useEffect(()=>(c.itemMap.set(s,{ref:s,...i}),()=>void c.itemMap.delete(s))),eg.createElement(d5,{[d]:"",ref:a},r)})},function(t){let n=o(e+"CollectionConsumer",t);return eg.useCallback(()=>{let e=n.collectionRef.current;if(!e)return[];let t=Array.from(e.querySelectorAll(`[${d}]`));return Array.from(n.itemMap.values()).sort((e,n)=>t.indexOf(e.ref.current)-t.indexOf(n.ref.current))},[n.collectionRef,n.itemMap])},r]}let d9=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce((e,t)=>{let n=(0,eg.forwardRef)((e,n)=>{let{asChild:r,...i}=e,o=r?d5:t;return(0,eg.useEffect)(()=>{window[Symbol.for("radix-ui")]=!0},[]),(0,eg.createElement)(o,dZ({},i,{ref:n}))});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function d7(e,t){e&&(0,dJ.flushSync)(()=>e.dispatchEvent(t))}function ce(e){let t=(0,eg.useRef)(e);return(0,eg.useEffect)(()=>{t.current=e}),(0,eg.useMemo)(()=>(...e)=>{var n;return null===(n=t.current)||void 0===n?void 0:n.call(t,...e)},[])}let ct="dismissableLayer.update",cn=(0,eg.createContext)({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),cr=(0,eg.forwardRef)((e,t)=>{var n;let{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:a,onDismiss:l,...d}=e,c=(0,eg.useContext)(cn),[u,p]=(0,eg.useState)(null),g=null!==(n=null==u?void 0:u.ownerDocument)&&void 0!==n?n:null==globalThis?void 0:globalThis.document,[,f]=(0,eg.useState)({}),m=d1(t,e=>p(e)),y=Array.from(c.layers),[b]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),v=y.indexOf(b),x=u?y.indexOf(u):-1,S=c.layersWithOutsidePointerEventsDisabled.size>0,w=x>=v,C=function(e,t=null==globalThis?void 0:globalThis.document){let n=ce(e),r=(0,eg.useRef)(!1),i=(0,eg.useRef)(()=>{});return(0,eg.useEffect)(()=>{let e=e=>{if(e.target&&!r.current){let r={originalEvent:e};function o(){cs("dismissableLayer.pointerDownOutside",n,r,{discrete:!0})}"touch"===e.pointerType?(t.removeEventListener("click",i.current),i.current=o,t.addEventListener("click",i.current,{once:!0})):o()}else t.removeEventListener("click",i.current);r.current=!1},o=window.setTimeout(()=>{t.addEventListener("pointerdown",e)},0);return()=>{window.clearTimeout(o),t.removeEventListener("pointerdown",e),t.removeEventListener("click",i.current)}},[t,n]),{onPointerDownCapture:()=>r.current=!0}}(e=>{let t=e.target,n=[...c.branches].some(e=>e.contains(t));!w||n||(null==o||o(e),null==a||a(e),e.defaultPrevented||null==l||l())},g),_=function(e,t=null==globalThis?void 0:globalThis.document){let n=ce(e),r=(0,eg.useRef)(!1);return(0,eg.useEffect)(()=>{let e=e=>{e.target&&!r.current&&cs("dismissableLayer.focusOutside",n,{originalEvent:e},{discrete:!1})};return t.addEventListener("focusin",e),()=>t.removeEventListener("focusin",e)},[t,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}(e=>{let t=e.target;[...c.branches].some(e=>e.contains(t))||(null==s||s(e),null==a||a(e),e.defaultPrevented||null==l||l())},g);return function(e,t=null==globalThis?void 0:globalThis.document){let n=ce(e);(0,eg.useEffect)(()=>{let e=e=>{"Escape"===e.key&&n(e)};return t.addEventListener("keydown",e),()=>t.removeEventListener("keydown",e)},[n,t])}(e=>{x!==c.layers.size-1||(null==i||i(e),!e.defaultPrevented&&l&&(e.preventDefault(),l()))},g),(0,eg.useEffect)(()=>{if(u)return r&&(0===c.layersWithOutsidePointerEventsDisabled.size&&(h=g.body.style.pointerEvents,g.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),co(),()=>{r&&1===c.layersWithOutsidePointerEventsDisabled.size&&(g.body.style.pointerEvents=h)}},[u,g,r,c]),(0,eg.useEffect)(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),co())},[u,c]),(0,eg.useEffect)(()=>{let e=()=>f({});return document.addEventListener(ct,e),()=>document.removeEventListener(ct,e)},[]),(0,eg.createElement)(d9.div,dZ({},d,{ref:m,style:{pointerEvents:S?w?"auto":"none":void 0,...e.style},onFocusCapture:dQ(e.onFocusCapture,_.onFocusCapture),onBlurCapture:dQ(e.onBlurCapture,_.onBlurCapture),onPointerDownCapture:dQ(e.onPointerDownCapture,C.onPointerDownCapture)}))}),ci=(0,eg.forwardRef)((e,t)=>{let n=(0,eg.useContext)(cn),r=(0,eg.useRef)(null),i=d1(t,r);return(0,eg.useEffect)(()=>{let e=r.current;if(e)return n.branches.add(e),()=>{n.branches.delete(e)}},[n.branches]),(0,eg.createElement)(d9.div,dZ({},e,{ref:i}))});function co(){let e=new CustomEvent(ct);document.dispatchEvent(e)}function cs(e,t,n,{discrete:r}){let i=n.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&i.addEventListener(e,t,{once:!0}),r?d7(i,o):i.dispatchEvent(o)}let ca=(0,eg.forwardRef)((e,t)=>{var n;let{container:r=null==globalThis?void 0:null===(n=globalThis.document)||void 0===n?void 0:n.body,...i}=e;return r?dJ.createPortal((0,eg.createElement)(d9.div,dZ({},i,{ref:t})),r):null}),cl=(null==globalThis?void 0:globalThis.document)?eg.useLayoutEffect:()=>{},cd=e=>{let{present:t,children:n}=e,r=function(e){var t,n;let[r,i]=(0,eg.useState)(),o=(0,eg.useRef)({}),s=(0,eg.useRef)(e),a=(0,eg.useRef)("none"),[l,d]=(t=e?"mounted":"unmounted",n={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},(0,eg.useReducer)((e,t)=>{let r=n[e][t];return null!=r?r:e},t));return(0,eg.useEffect)(()=>{let e=cc(o.current);a.current="mounted"===l?e:"none"},[l]),cl(()=>{let t=o.current,n=s.current;if(n!==e){let r=a.current,i=cc(t);e?d("MOUNT"):"none"===i||(null==t?void 0:t.display)==="none"?d("UNMOUNT"):n&&r!==i?d("ANIMATION_OUT"):d("UNMOUNT"),s.current=e}},[e,d]),cl(()=>{if(r){let e=e=>{let t=cc(o.current).includes(e.animationName);e.target===r&&t&&(0,dJ.flushSync)(()=>d("ANIMATION_END"))},t=e=>{e.target===r&&(a.current=cc(o.current))};return r.addEventListener("animationstart",t),r.addEventListener("animationcancel",e),r.addEventListener("animationend",e),()=>{r.removeEventListener("animationstart",t),r.removeEventListener("animationcancel",e),r.removeEventListener("animationend",e)}}d("ANIMATION_END")},[r,d]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:(0,eg.useCallback)(e=>{e&&(o.current=getComputedStyle(e)),i(e)},[])}}(t),i="function"==typeof n?n({present:r.isPresent}):eg.Children.only(n),o=d1(r.ref,i.ref);return"function"==typeof n||r.isPresent?(0,eg.cloneElement)(i,{ref:o}):null};function cc(e){return(null==e?void 0:e.animationName)||"none"}function cu({prop:e,defaultProp:t,onChange:n=()=>{}}){let[r,i]=function({defaultProp:e,onChange:t}){let n=(0,eg.useState)(e),[r]=n,i=(0,eg.useRef)(r),o=ce(t);return(0,eg.useEffect)(()=>{i.current!==r&&(o(r),i.current=r)},[r,i,o]),n}({defaultProp:t,onChange:n}),o=void 0!==e,s=o?e:r,a=ce(n);return[s,(0,eg.useCallback)(t=>{if(o){let n="function"==typeof t?t(e):t;n!==e&&a(n)}else i(t)},[o,e,i,a])]}cd.displayName="Presence";let ch=(0,eg.forwardRef)((e,t)=>(0,eg.createElement)(d9.span,dZ({},e,{ref:t,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...e.style}}))),cp="ToastProvider",[cg,cf,cm]=d8("Toast"),[cy,cb]=d2("Toast",[cm]),[cv,cx]=cy(cp),cS=e=>{let{__scopeToast:t,label:n="Notification",duration:r=5e3,swipeDirection:i="right",swipeThreshold:o=50,children:s}=e,[a,l]=(0,eg.useState)(null),[d,c]=(0,eg.useState)(0),u=(0,eg.useRef)(!1),h=(0,eg.useRef)(!1);return(0,eg.createElement)(cg.Provider,{scope:t},(0,eg.createElement)(cv,{scope:t,label:n,duration:r,swipeDirection:i,swipeThreshold:o,toastCount:d,viewport:a,onViewportChange:l,onToastAdd:(0,eg.useCallback)(()=>c(e=>e+1),[]),onToastRemove:(0,eg.useCallback)(()=>c(e=>e-1),[]),isFocusedToastEscapeKeyDownRef:u,isClosePausedRef:h},s))};cS.propTypes={label:e=>e.label&&"string"==typeof e.label&&!e.label.trim()?Error(`Invalid prop \`label\` supplied to \`${cp}\`. Expected non-empty \`string\`.`):null};let cw=["F8"],cC="toast.viewportPause",c_="toast.viewportResume",ck=(0,eg.forwardRef)((e,t)=>{let{__scopeToast:n,hotkey:r=cw,label:i="Notifications ({hotkey})",...o}=e,s=cx("ToastViewport",n),a=cf(n),l=(0,eg.useRef)(null),d=(0,eg.useRef)(null),c=(0,eg.useRef)(null),u=(0,eg.useRef)(null),h=d1(t,u,s.onViewportChange),p=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),g=s.toastCount>0;(0,eg.useEffect)(()=>{let e=e=>{var t;r.every(t=>e[t]||e.code===t)&&(null===(t=u.current)||void 0===t||t.focus())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[r]),(0,eg.useEffect)(()=>{let e=l.current,t=u.current;if(g&&e&&t){let n=()=>{if(!s.isClosePausedRef.current){let e=new CustomEvent(cC);t.dispatchEvent(e),s.isClosePausedRef.current=!0}},r=()=>{if(s.isClosePausedRef.current){let e=new CustomEvent(c_);t.dispatchEvent(e),s.isClosePausedRef.current=!1}},i=t=>{e.contains(t.relatedTarget)||r()},o=()=>{e.contains(document.activeElement)||r()};return e.addEventListener("focusin",n),e.addEventListener("focusout",i),e.addEventListener("pointermove",n),e.addEventListener("pointerleave",o),window.addEventListener("blur",n),window.addEventListener("focus",r),()=>{e.removeEventListener("focusin",n),e.removeEventListener("focusout",i),e.removeEventListener("pointermove",n),e.removeEventListener("pointerleave",o),window.removeEventListener("blur",n),window.removeEventListener("focus",r)}}},[g,s.isClosePausedRef]);let f=(0,eg.useCallback)(({tabbingDirection:e})=>{let t=a().map(t=>{let n=t.ref.current,r=[n,...function(e){let t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{let t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}(n)];return"forwards"===e?r:r.reverse()});return("forwards"===e?t.reverse():t).flat()},[a]);return(0,eg.useEffect)(()=>{let e=u.current;if(e){let t=t=>{let n=t.altKey||t.ctrlKey||t.metaKey;if("Tab"===t.key&&!n){var r,i,o;let n=document.activeElement,s=t.shiftKey;if(t.target===e&&s){null===(r=d.current)||void 0===r||r.focus();return}let a=f({tabbingDirection:s?"backwards":"forwards"}),l=a.findIndex(e=>e===n);cF(a.slice(l+1))?t.preventDefault():s?null===(i=d.current)||void 0===i||i.focus():null===(o=c.current)||void 0===o||o.focus()}};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)}},[a,f]),(0,eg.createElement)(ci,{ref:l,role:"region","aria-label":i.replace("{hotkey}",p),tabIndex:-1,style:{pointerEvents:g?void 0:"none"}},g&&(0,eg.createElement)(cP,{ref:d,onFocusFromOutsideViewport:()=>{cF(f({tabbingDirection:"forwards"}))}}),(0,eg.createElement)(cg.Slot,{scope:n},(0,eg.createElement)(d9.ol,dZ({tabIndex:-1},o,{ref:h}))),g&&(0,eg.createElement)(cP,{ref:c,onFocusFromOutsideViewport:()=>{cF(f({tabbingDirection:"backwards"}))}}))}),cP=(0,eg.forwardRef)((e,t)=>{let{__scopeToast:n,onFocusFromOutsideViewport:r,...i}=e,o=cx("ToastFocusProxy",n);return(0,eg.createElement)(ch,dZ({"aria-hidden":!0,tabIndex:0},i,{ref:t,style:{position:"fixed"},onFocus:e=>{var t;let n=e.relatedTarget;null!==(t=o.viewport)&&void 0!==t&&t.contains(n)||r()}}))}),cI="Toast",cE=(0,eg.forwardRef)((e,t)=>{let{forceMount:n,open:r,defaultOpen:i,onOpenChange:o,...s}=e,[a=!0,l]=cu({prop:r,defaultProp:i,onChange:o});return(0,eg.createElement)(cd,{present:n||a},(0,eg.createElement)(cT,dZ({open:a},s,{ref:t,onClose:()=>l(!1),onPause:ce(e.onPause),onResume:ce(e.onResume),onSwipeStart:dQ(e.onSwipeStart,e=>{e.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:dQ(e.onSwipeMove,e=>{let{x:t,y:n}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","move"),e.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${n}px`)}),onSwipeCancel:dQ(e.onSwipeCancel,e=>{e.currentTarget.setAttribute("data-swipe","cancel"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:dQ(e.onSwipeEnd,e=>{let{x:t,y:n}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","end"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${n}px`),l(!1)})})))}),[cj,cM]=cy(cI,{onClose(){}}),cT=(0,eg.forwardRef)((e,t)=>{let{__scopeToast:n,type:r="foreground",duration:i,open:o,onClose:s,onEscapeKeyDown:a,onPause:l,onResume:d,onSwipeStart:c,onSwipeMove:u,onSwipeCancel:h,onSwipeEnd:p,...g}=e,f=cx(cI,n),[m,y]=(0,eg.useState)(null),b=d1(t,e=>y(e)),v=(0,eg.useRef)(null),x=(0,eg.useRef)(null),S=i||f.duration,w=(0,eg.useRef)(0),C=(0,eg.useRef)(S),_=(0,eg.useRef)(0),{onToastAdd:k,onToastRemove:P}=f,I=ce(()=>{var e;(null==m?void 0:m.contains(document.activeElement))&&(null===(e=f.viewport)||void 0===e||e.focus()),s()}),E=(0,eg.useCallback)(e=>{e&&e!==1/0&&(window.clearTimeout(_.current),w.current=new Date().getTime(),_.current=window.setTimeout(I,e))},[I]);(0,eg.useEffect)(()=>{let e=f.viewport;if(e){let t=()=>{E(C.current),null==d||d()},n=()=>{let e=new Date().getTime()-w.current;C.current=C.current-e,window.clearTimeout(_.current),null==l||l()};return e.addEventListener(cC,n),e.addEventListener(c_,t),()=>{e.removeEventListener(cC,n),e.removeEventListener(c_,t)}}},[f.viewport,S,l,d,E]),(0,eg.useEffect)(()=>{o&&!f.isClosePausedRef.current&&E(S)},[o,S,f.isClosePausedRef,E]),(0,eg.useEffect)(()=>(k(),()=>P()),[k,P]);let j=(0,eg.useMemo)(()=>m?function e(t){let n=[];return Array.from(t.childNodes).forEach(t=>{if(t.nodeType===t.TEXT_NODE&&t.textContent&&n.push(t.textContent),t.nodeType===t.ELEMENT_NODE){let r=t.ariaHidden||t.hidden||"none"===t.style.display,i=""===t.dataset.radixToastAnnounceExclude;if(!r){if(i){let e=t.dataset.radixToastAnnounceAlt;e&&n.push(e)}else n.push(...e(t))}}}),n}(m):null,[m]);return f.viewport?(0,eg.createElement)(eg.Fragment,null,j&&(0,eg.createElement)(cA,{__scopeToast:n,role:"status","aria-live":"foreground"===r?"assertive":"polite","aria-atomic":!0},j),(0,eg.createElement)(cj,{scope:n,onClose:I},(0,dJ.createPortal)((0,eg.createElement)(cg.ItemSlot,{scope:n},(0,eg.createElement)(cr,{asChild:!0,onEscapeKeyDown:dQ(a,()=>{f.isFocusedToastEscapeKeyDownRef.current||I(),f.isFocusedToastEscapeKeyDownRef.current=!1})},(0,eg.createElement)(d9.li,dZ({role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":o?"open":"closed","data-swipe-direction":f.swipeDirection},g,{ref:b,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:dQ(e.onKeyDown,e=>{"Escape"!==e.key||(null==a||a(e.nativeEvent),e.nativeEvent.defaultPrevented||(f.isFocusedToastEscapeKeyDownRef.current=!0,I()))}),onPointerDown:dQ(e.onPointerDown,e=>{0===e.button&&(v.current={x:e.clientX,y:e.clientY})}),onPointerMove:dQ(e.onPointerMove,e=>{if(!v.current)return;let t=e.clientX-v.current.x,n=e.clientY-v.current.y,r=!!x.current,i=["left","right"].includes(f.swipeDirection),o=["left","up"].includes(f.swipeDirection)?Math.min:Math.max,s=i?o(0,t):0,a=i?0:o(0,n),l="touch"===e.pointerType?10:2,d={x:s,y:a},h={originalEvent:e,delta:d};r?(x.current=d,cN("toast.swipeMove",u,h,{discrete:!1})):c$(d,f.swipeDirection,l)?(x.current=d,cN("toast.swipeStart",c,h,{discrete:!1}),e.target.setPointerCapture(e.pointerId)):(Math.abs(t)>l||Math.abs(n)>l)&&(v.current=null)}),onPointerUp:dQ(e.onPointerUp,e=>{let t=x.current,n=e.target;if(n.hasPointerCapture(e.pointerId)&&n.releasePointerCapture(e.pointerId),x.current=null,v.current=null,t){let n=e.currentTarget,r={originalEvent:e,delta:t};c$(t,f.swipeDirection,f.swipeThreshold)?cN("toast.swipeEnd",p,r,{discrete:!0}):cN("toast.swipeCancel",h,r,{discrete:!0}),n.addEventListener("click",e=>e.preventDefault(),{once:!0})}})})))),f.viewport))):null});cT.propTypes={type:e=>e.type&&!["foreground","background"].includes(e.type)?Error(`Invalid prop \`type\` supplied to \`${cI}\`. Expected \`foreground | background\`.`):null};let cA=e=>{let{__scopeToast:t,children:n,...r}=e,i=cx(cI,t),[o,s]=(0,eg.useState)(!1),[a,l]=(0,eg.useState)(!1);return function(e=()=>{}){let t=ce(e);cl(()=>{let e=0,n=0;return e=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(e),window.cancelAnimationFrame(n)}},[t])}(()=>s(!0)),(0,eg.useEffect)(()=>{let e=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(e)},[]),a?null:(0,eg.createElement)(ca,{asChild:!0},(0,eg.createElement)(ch,r,o&&(0,eg.createElement)(eg.Fragment,null,i.label," ",n)))},cO=(0,eg.forwardRef)((e,t)=>{let{__scopeToast:n,...r}=e;return(0,eg.createElement)(d9.div,dZ({},r,{ref:t}))}),cR=(0,eg.forwardRef)((e,t)=>{let{__scopeToast:n,...r}=e;return(0,eg.createElement)(d9.div,dZ({},r,{ref:t}))}),cL=(0,eg.forwardRef)((e,t)=>{let{altText:n,...r}=e;return n?(0,eg.createElement)(cz,{altText:n,asChild:!0},(0,eg.createElement)(cD,dZ({},r,{ref:t}))):null});cL.propTypes={altText:e=>e.altText?null:Error("Missing prop `altText` expected on `ToastAction`")};let cD=(0,eg.forwardRef)((e,t)=>{let{__scopeToast:n,...r}=e,i=cM("ToastClose",n);return(0,eg.createElement)(cz,{asChild:!0},(0,eg.createElement)(d9.button,dZ({type:"button"},r,{ref:t,onClick:dQ(e.onClick,i.onClose)})))}),cz=(0,eg.forwardRef)((e,t)=>{let{__scopeToast:n,altText:r,...i}=e;return(0,eg.createElement)(d9.div,dZ({"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0},i,{ref:t}))});function cN(e,t,n,{discrete:r}){let i=n.originalEvent.currentTarget,o=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n});t&&i.addEventListener(e,t,{once:!0}),r?d7(i,o):i.dispatchEvent(o)}let c$=(e,t,n=0)=>{let r=Math.abs(e.x),i=Math.abs(e.y),o=r>i;return"left"===t||"right"===t?o&&r>n:!o&&i>n};function cF(e){let t=document.activeElement;return e.some(e=>e===t||(e.focus(),document.activeElement!==t))}let cB="2.0.0-canary.d0f6ef80fcf9",cV={fonts:{draw:`https://unpkg.com/@tldraw/assets@${cB}/fonts/Shantell_Sans-Tldrawish.woff2`,serif:`https://unpkg.com/@tldraw/assets@${cB}/fonts/IBMPlexSerif-Medium.woff2`,sansSerif:`https://unpkg.com/@tldraw/assets@${cB}/fonts/IBMPlexSans-Medium.woff2`,monospace:`https://unpkg.com/@tldraw/assets@${cB}/fonts/IBMPlexMono-Medium.woff2`},icons:Object.fromEntries(["align-bottom-center","align-bottom-left","align-bottom-right","align-bottom","align-center-center","align-center-horizontal","align-center-left","align-center-right","align-center-vertical","align-left","align-right","align-top-center","align-top-left","align-top-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","aspect-ratio","avatar","blob","bring-forward","bring-to-front","check","checkbox-checked","checkbox-empty","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","code","collab","color","comment","cross-2","cross","dash-dashed","dash-dotted","dash-draw","dash-solid","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","file","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","hidden","image","info-circle","leading","link","lock-small","lock","menu","minus","mixed","pack","page","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","ruler","search","send-backward","send-to-back","settings-horizontal","settings-vertical-1","settings-vertical","share-1","share-2","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","status-online","stretch-horizontal","stretch-vertical","text-align-center","text-align-justify","text-align-left","text-align-right","tool-arrow","tool-embed","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-text","trash","triangle-down","triangle-up","twitter","undo","ungroup","unlock-small","unlock","vertical-align-center","vertical-align-end","vertical-align-start","visible","warning-triangle","zoom-in","zoom-out"].map(e=>[e,`https://unpkg.com/@tldraw/assets@${cB}/icons/icon/${e}.svg`])),translations:Object.fromEntries(rg.map(e=>[e.locale,`https://unpkg.com/@tldraw/assets@${cB}/translations/${e.locale}.json`])),embedIcons:Object.fromEntries(n9.map(e=>[e.type,`https://unpkg.com/@tldraw/assets@${cB}/embed-icons/${e.type}.png`]))},cU=(0,eg.createContext)(null);function cK({assetUrls:e,children:t}){return(0,j.jsx)(cU.Provider,{value:e,children:t})}function cH(){let e=(0,eg.useContext)(cU);if(!e)throw Error("useAssetUrls must be used within an AssetUrlsProvider");return e}let cY={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","menu.title":"Menu","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.view":"View","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy share link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy read-only link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to view (but not edit) this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.title":"Help and resources","help-menu.about":"About","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},cW={locale:"en",label:"English",messages:cY};async function cX(e,t){if(!(await fetch(t.translations.en)).ok)return console.warn("No main translations found."),cW;if("en"===e)return cW;let n=rg.find(t=>t.locale===e);if(!n)return console.warn(`No translation found for locale ${e}`),cW;let r=await fetch(t.translations[n.locale]),i=await r.json();if(!i)return console.warn(`No messages found for locale ${e}`),cW;let o=[];for(let e in cW.messages)i[e]||o.push(e);return o.length,{locale:e,label:n.label,messages:{...cW.messages,...i}}}let cG=eg.createContext({}),cq=()=>eg.useContext(cG),cZ=eS(function({overrides:e,children:t}){let n=rR().user.getLocale(),r=cH(),[i,o]=eg.useState(()=>e&&e.en?{locale:"en",label:"English",messages:{...cY,...e.en}}:{locale:"en",label:"English",messages:cY});return eg.useEffect(()=>{let t=!1;return async function(){let i=await cX(n,r);i&&!t&&(e&&e[n]?o({...i,messages:{...i.messages,...e[n]}}):o(i))}(),()=>{t=!0}},[r,n,e]),(0,j.jsx)(cG.Provider,{value:i,children:t})});function cJ(){let e=cq();return eg.useCallback(function(t){return e.messages[t]??t},[e])}function cQ(e){return(0,j.jsx)("svg",{width:16,height:16,viewBox:"0 0 16 16",...e,children:(0,j.jsxs)("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[(0,j.jsx)("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),(0,j.jsx)("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:(0,j.jsx)("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}let c0=(0,eg.memo)(function({small:e,invertIcon:t,icon:n,color:r,className:i,...o}){let s=cH(),a=s.icons[n]??s.icons["question-mark-circle"],l=(0,eg.useRef)(null);return(0,eg.useLayoutEffect)(()=>{a||console.error(`Icon not found: ${n}. Add it to the assetUrls.icons object.`),l?.current&&(l.current.style.webkitMask=`url(${a}) center 100% / 100% no-repeat`)},[l,a,n]),(0,j.jsx)("div",{...o,ref:l,className:rm("tlui-icon",{"tlui-icon__small":e},i),style:{color:r,mask:`url(${a}) center 100% / 100% no-repeat`,transform:t?"scale(-1, 1)":void 0}})}),c1="undefined"!=typeof window&&window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,c2=c1?"":"Ctrl",c5=c1?"":"Alt";function c3(e){return" "+e.split(",")[0].split("").map(e=>{let t=e.replace(/\$/g,c2).replace(/\?/g,c5).replace(/!/g,"");return t[0].toUpperCase()+t.slice(1)}).join("")}function c4({children:e}){return(0,j.jsx)("kbd",{className:"tlui-kbd",children:e.split(",")[0].split("").map(e=>{let t=e.replace(/\$/g,c2).replace(/\?/g,c5).replace(/!/g,"");return t[0].toUpperCase()+t.slice(1)}).map((e,t)=>(0,j.jsx)("span",{children:e},t))})}let c6=eg.forwardRef(function({label:e,icon:t,invertIcon:n,iconLeft:r,smallIcon:i,kbd:o,isChecked:s=!1,type:a,children:l,spinner:d,disabled:c,...u},h){let p=cJ(),g=e?p(e):"",f=rR(),m=h?.current;return c&&m===document.activeElement&&f.getContainer().focus(),(0,j.jsxs)("button",{ref:h,draggable:!1,type:"button",disabled:c,...u,title:u.title??g,className:rm("tlui-button",`tlui-button__${a}`,u.className),children:[r&&(0,j.jsx)(c0,{icon:r,className:"tlui-button__icon-left",small:!0}),l,e&&(0,j.jsxs)("span",{className:"tlui-button__label",draggable:!1,children:[g,s&&(0,j.jsx)(c0,{icon:"check"})]}),o&&(0,j.jsx)(c4,{children:o}),t&&!d&&(0,j.jsx)(c0,{icon:t,small:!!e||i,invertIcon:n}),d&&(0,j.jsx)(cQ,{})]})}),c8=ef["useId".toString()]||(()=>void 0),c9=0;function c7(e){let[t,n]=eg.useState(c8());return cl(()=>{e||n(e=>null!=e?e:String(c9++))},[e]),e||(t?`radix-${t}`:"")}let ue="focusScope.autoFocusOnMount",ut="focusScope.autoFocusOnUnmount",un={bubbles:!1,cancelable:!0},ur=(0,eg.forwardRef)((e,t)=>{let{loop:n=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:o,...s}=e,[a,l]=(0,eg.useState)(null),d=ce(i),c=ce(o),u=(0,eg.useRef)(null),h=d1(t,e=>l(e)),p=(0,eg.useRef)({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;(0,eg.useEffect)(()=>{if(r){function e(e){if(p.paused||!a)return;let t=e.target;a.contains(t)?u.current=t:us(u.current,{select:!0})}function t(e){if(p.paused||!a)return;let t=e.relatedTarget;null===t||a.contains(t)||us(u.current,{select:!0})}document.addEventListener("focusin",e),document.addEventListener("focusout",t);let n=new MutationObserver(function(e){if(document.activeElement===document.body)for(let t of e)t.removedNodes.length>0&&us(a)});return a&&n.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",e),document.removeEventListener("focusout",t),n.disconnect()}}},[r,a,p.paused]),(0,eg.useEffect)(()=>{if(a){ua.add(p);let e=document.activeElement;if(!a.contains(e)){let t=new CustomEvent(ue,un);a.addEventListener(ue,d),a.dispatchEvent(t),t.defaultPrevented||(function(e,{select:t=!1}={}){let n=document.activeElement;for(let r of e)if(us(r,{select:t}),document.activeElement!==n)return}(ui(a).filter(e=>"A"!==e.tagName),{select:!0}),document.activeElement===e&&us(a))}return()=>{a.removeEventListener(ue,d),setTimeout(()=>{let t=new CustomEvent(ut,un);a.addEventListener(ut,c),a.dispatchEvent(t),t.defaultPrevented||us(null!=e?e:document.body,{select:!0}),a.removeEventListener(ut,c),ua.remove(p)},0)}}},[a,d,c,p]);let g=(0,eg.useCallback)(e=>{if(!n&&!r||p.paused)return;let t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,i=document.activeElement;if(t&&i){let t=e.currentTarget,[r,o]=function(e){let t=ui(e);return[uo(t,e),uo(t.reverse(),e)]}(t);r&&o?e.shiftKey||i!==o?e.shiftKey&&i===r&&(e.preventDefault(),n&&us(o,{select:!0})):(e.preventDefault(),n&&us(r,{select:!0})):i===t&&e.preventDefault()}},[n,r,p.paused]);return(0,eg.createElement)(d9.div,dZ({tabIndex:-1},s,{ref:h,onKeyDown:g}))});function ui(e){let t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{let t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function uo(e,t){for(let n of e)if(!function(e,{upTo:t}){if("hidden"===getComputedStyle(e).visibility)return!0;for(;e&&(void 0===t||e!==t);){if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}(n,{upTo:t}))return n}function us(e,{select:t=!1}={}){if(e&&e.focus){var n;let r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&(n=e)instanceof HTMLInputElement&&"select"in n&&t&&e.select()}}let ua=function(){let e=[];return{add(t){let n=e[0];t!==n&&(null==n||n.pause()),(e=ul(e,t)).unshift(t)},remove(t){var n;null===(n=(e=ul(e,t))[0])||void 0===n||n.resume()}}}();function ul(e,t){let n=[...e],r=n.indexOf(t);return -1!==r&&n.splice(r,1),n}let ud=0;function uc(){(0,eg.useEffect)(()=>{var e,t;let n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",null!==(e=n[0])&&void 0!==e?e:uu()),document.body.insertAdjacentElement("beforeend",null!==(t=n[1])&&void 0!==t?t:uu()),ud++,()=>{1===ud&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),ud--}},[])}function uu(){let e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",e}var uh=function(){return(uh=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function up(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)0>t.indexOf(r[i])&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var ug="right-scroll-bar-position",uf="width-before-scroll-bar";function um(e){return e}var uy=function(e){void 0===e&&(e={});var t,n,r,i=(void 0===t&&(t=um),n=[],r=!1,{read:function(){if(r)throw Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:null},useMedium:function(e){var i=t(e,r);return n.push(i),function(){n=n.filter(function(e){return e!==i})}},assignSyncMedium:function(e){for(r=!0;n.length;){var t=n;n=[],t.forEach(e)}n={push:function(t){return e(t)},filter:function(){return n}}},assignMedium:function(e){r=!0;var t=[];if(n.length){var i=n;n=[],i.forEach(e),t=n}var o=function(){var n=t;t=[],n.forEach(e)},s=function(){return Promise.resolve().then(o)};s(),n={push:function(e){t.push(e),s()},filter:function(e){return t=t.filter(e),n}}}});return i.options=uh({async:!0,ssr:!1},e),i}(),ub=function(){},uv=eg.forwardRef(function(e,t){var n,r,i,o=eg.useRef(null),s=eg.useState({onScrollCapture:ub,onWheelCapture:ub,onTouchMoveCapture:ub}),a=s[0],l=s[1],d=e.forwardProps,c=e.children,u=e.className,h=e.removeScrollBar,p=e.enabled,g=e.shards,f=e.sideCar,m=e.noIsolation,y=e.inert,b=e.allowPinchZoom,v=e.as,x=up(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),S=(n=[o,t],r=function(e){return n.forEach(function(t){return"function"==typeof t?t(e):t&&(t.current=e),t})},(i=(0,eg.useState)(function(){return{value:null,callback:r,facade:{get current(){return i.value},set current(value){var e=i.value;e!==value&&(i.value=value,i.callback(value,e))}}}})[0]).callback=r,i.facade),w=uh(uh({},x),a);return eg.createElement(eg.Fragment,null,p&&eg.createElement(f,{sideCar:uy,removeScrollBar:h,shards:g,noIsolation:m,inert:y,setCallbacks:l,allowPinchZoom:!!b,lockRef:o}),d?eg.cloneElement(eg.Children.only(c),uh(uh({},w),{ref:S})):eg.createElement(void 0===v?"div":v,uh({},w,{className:u,ref:S}),c))});uv.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},uv.classNames={fullWidth:uf,zeroRight:ug};var ux=function(e){var t=e.sideCar,n=up(e,["sideCar"]);if(!t)throw Error("Sidecar: please provide `sideCar` property to import the right car");var r=t.read();if(!r)throw Error("Sidecar medium not found");return eg.createElement(r,uh({},n))};ux.isSideCarExport=!0;var uS=function(){var e=0,t=null;return{add:function(r){if(0==e&&(t=function(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=E||n.nc;return t&&e.setAttribute("nonce",t),e}())){var i,o;(i=t).styleSheet?i.styleSheet.cssText=r:i.appendChild(document.createTextNode(r)),o=t,(document.head||document.getElementsByTagName("head")[0]).appendChild(o)}e++},remove:function(){--e||!t||(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},uw=function(){var e=uS();return function(t,n){eg.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},uC=function(){var e=uw();return function(t){return e(t.styles,t.dynamic),null}},u_={left:0,top:0,right:0,gap:0},uk=function(e){return parseInt(e||"",10)||0},uP=function(e){var t=window.getComputedStyle(document.body),n=t["padding"===e?"paddingLeft":"marginLeft"],r=t["padding"===e?"paddingTop":"marginTop"],i=t["padding"===e?"paddingRight":"marginRight"];return[uk(n),uk(r),uk(i)]},uI=function(e){if(void 0===e&&(e="margin"),"undefined"==typeof window)return u_;var t=uP(e),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-n+t[2]-t[0])}},uE=uC(),uj=function(e,t,n,r){var i=e.left,o=e.top,s=e.right,a=e.gap;return void 0===n&&(n="margin"),"\n  .".concat("with-scroll-bars-hidden"," {\n   overflow: hidden ").concat(r,";\n   padding-right: ").concat(a,"px ").concat(r,";\n  }\n  body {\n    overflow: hidden ").concat(r,";\n    overscroll-behavior: contain;\n    ").concat([t&&"position: relative ".concat(r,";"),"margin"===n&&"\n    padding-left: ".concat(i,"px;\n    padding-top: ").concat(o,"px;\n    padding-right: ").concat(s,"px;\n    margin-left:0;\n    margin-top:0;\n    margin-right: ").concat(a,"px ").concat(r,";\n    "),"padding"===n&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),"\n  }\n  \n  .").concat(ug," {\n    right: ").concat(a,"px ").concat(r,";\n  }\n  \n  .").concat(uf," {\n    margin-right: ").concat(a,"px ").concat(r,";\n  }\n  \n  .").concat(ug," .").concat(ug," {\n    right: 0 ").concat(r,";\n  }\n  \n  .").concat(uf," .").concat(uf," {\n    margin-right: 0 ").concat(r,";\n  }\n  \n  body {\n    ").concat("--removed-body-scroll-bar-size",": ").concat(a,"px;\n  }\n")},uM=function(e){var t=e.noRelative,n=e.noImportant,r=e.gapMode,i=void 0===r?"margin":r,o=eg.useMemo(function(){return uI(i)},[i]);return eg.createElement(uE,{styles:uj(o,!t,i,n?"":"!important")})},uT=!1;if("undefined"!=typeof window)try{var uA=Object.defineProperty({},"passive",{get:function(){return uT=!0,!0}});window.addEventListener("test",uA,uA),window.removeEventListener("test",uA,uA)}catch(e){uT=!1}var uO=!!uT&&{passive:!1},uR=function(e,t){var n=window.getComputedStyle(e);return"hidden"!==n[t]&&!(n.overflowY===n.overflowX&&"TEXTAREA"!==e.tagName&&"visible"===n[t])},uL=function(e,t){var n=t;do{if("undefined"!=typeof ShadowRoot&&n instanceof ShadowRoot&&(n=n.host),uD(e,n)){var r=uz(e,n);if(r[1]>r[2])return!0}n=n.parentNode}while(n&&n!==document.body);return!1},uD=function(e,t){return"v"===e?uR(t,"overflowY"):uR(t,"overflowX")},uz=function(e,t){return"v"===e?[t.scrollTop,t.scrollHeight,t.clientHeight]:[t.scrollLeft,t.scrollWidth,t.clientWidth]},uN=function(e,t,n,r,i){var o,s=(o=window.getComputedStyle(t).direction,"h"===e&&"rtl"===o?-1:1),a=s*r,l=n.target,d=t.contains(l),c=!1,u=a>0,h=0,p=0;do{var g=uz(e,l),f=g[0],m=g[1]-g[2]-s*f;(f||m)&&uD(e,l)&&(h+=m,p+=f),l=l.parentNode}while(!d&&l!==document.body||d&&(t.contains(l)||t===l));return u&&(i&&0===h||!i&&a>h)?c=!0:!u&&(i&&0===p||!i&&-a>p)&&(c=!0),c},u$=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},uF=function(e){return[e.deltaX,e.deltaY]},uB=function(e){return e&&"current"in e?e.current:e},uV=0,uU=[];let uK=(I=function(e){var t=eg.useRef([]),n=eg.useRef([0,0]),r=eg.useRef(),i=eg.useState(uV++)[0],o=eg.useState(function(){return uC()})[0],s=eg.useRef(e);eg.useEffect(function(){s.current=e},[e]),eg.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(i));var t=(function(e,t,n){if(n||2==arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))})([e.lockRef.current],(e.shards||[]).map(uB),!0).filter(Boolean);return t.forEach(function(e){return e.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),t.forEach(function(e){return e.classList.remove("allow-interactivity-".concat(i))})}}},[e.inert,e.lockRef.current,e.shards]);var a=eg.useCallback(function(e,t){if("touches"in e&&2===e.touches.length)return!s.current.allowPinchZoom;var i,o=u$(e),a=n.current,l="deltaX"in e?e.deltaX:a[0]-o[0],d="deltaY"in e?e.deltaY:a[1]-o[1],c=e.target,u=Math.abs(l)>Math.abs(d)?"h":"v";if("touches"in e&&"h"===u&&"range"===c.type)return!1;var h=uL(u,c);if(!h)return!0;if(h?i=u:(i="v"===u?"h":"v",h=uL(u,c)),!h)return!1;if(!r.current&&"changedTouches"in e&&(l||d)&&(r.current=i),!i)return!0;var p=r.current||i;return uN(p,t,e,"h"===p?l:d,!0)},[]),l=eg.useCallback(function(e){if(uU.length&&uU[uU.length-1]===o){var n="deltaY"in e?uF(e):u$(e),r=t.current.filter(function(t){var r;return t.name===e.type&&t.target===e.target&&(r=t.delta)[0]===n[0]&&r[1]===n[1]})[0];if(r&&r.should){e.cancelable&&e.preventDefault();return}if(!r){var i=(s.current.shards||[]).map(uB).filter(Boolean).filter(function(t){return t.contains(e.target)});(i.length>0?a(e,i[0]):!s.current.noIsolation)&&e.cancelable&&e.preventDefault()}}},[]),d=eg.useCallback(function(e,n,r,i){var o={name:e,delta:n,target:r,should:i};t.current.push(o),setTimeout(function(){t.current=t.current.filter(function(e){return e!==o})},1)},[]),c=eg.useCallback(function(e){n.current=u$(e),r.current=void 0},[]),u=eg.useCallback(function(t){d(t.type,uF(t),t.target,a(t,e.lockRef.current))},[]),h=eg.useCallback(function(t){d(t.type,u$(t),t.target,a(t,e.lockRef.current))},[]);eg.useEffect(function(){return uU.push(o),e.setCallbacks({onScrollCapture:u,onWheelCapture:u,onTouchMoveCapture:h}),document.addEventListener("wheel",l,uO),document.addEventListener("touchmove",l,uO),document.addEventListener("touchstart",c,uO),function(){uU=uU.filter(function(e){return e!==o}),document.removeEventListener("wheel",l,uO),document.removeEventListener("touchmove",l,uO),document.removeEventListener("touchstart",c,uO)}},[]);var p=e.removeScrollBar,g=e.inert;return eg.createElement(eg.Fragment,null,g?eg.createElement(o,{styles:"\n  .block-interactivity-".concat(i," {pointer-events: none;}\n  .allow-interactivity-").concat(i," {pointer-events: all;}\n")}):null,p?eg.createElement(uM,{gapMode:"margin"}):null)},uy.useMedium(I),ux);var uH=eg.forwardRef(function(e,t){return eg.createElement(uv,uh({},e,{ref:t,sideCar:uK}))});uH.classNames=uv.classNames;var uY=new WeakMap,uW=new WeakMap,uX={},uG=0,uq=function(e){return e&&(e.host||uq(e.parentNode))},uZ=function(e,t,n,r){var i=(Array.isArray(e)?e:[e]).map(function(e){if(t.contains(e))return e;var n=uq(e);return n&&t.contains(n)?n:(console.error("aria-hidden",e,"in not contained inside",t,". Doing nothing"),null)}).filter(function(e){return!!e});uX[n]||(uX[n]=new WeakMap);var o=uX[n],s=[],a=new Set,l=new Set(i),d=function(e){!e||a.has(e)||(a.add(e),d(e.parentNode))};i.forEach(d);var c=function(e){!e||l.has(e)||Array.prototype.forEach.call(e.children,function(e){if(a.has(e))c(e);else{var t=e.getAttribute(r),i=null!==t&&"false"!==t,l=(uY.get(e)||0)+1,d=(o.get(e)||0)+1;uY.set(e,l),o.set(e,d),s.push(e),1===l&&i&&uW.set(e,!0),1===d&&e.setAttribute(n,"true"),i||e.setAttribute(r,"true")}})};return c(t),a.clear(),uG++,function(){s.forEach(function(e){var t=uY.get(e)-1,i=o.get(e)-1;uY.set(e,t),o.set(e,i),t||(uW.has(e)||e.removeAttribute(r),uW.delete(e)),i||e.removeAttribute(n)}),--uG||(uY=new WeakMap,uY=new WeakMap,uW=new WeakMap,uX={})}},uJ=function(e,t,n){void 0===n&&(n="data-aria-hidden");var r,i=Array.from(Array.isArray(e)?e:[e]),o=t||(r=e,"undefined"==typeof document?null:(Array.isArray(r)?r[0]:r).ownerDocument.body);return o?(i.push.apply(i,Array.from(o.querySelectorAll("[aria-live]"))),uZ(i,o,n,"aria-hidden")):function(){return null}};let uQ="Dialog",[u0,u1]=d2(uQ),[u2,u5]=u0(uQ),u3="DialogPortal",[u4,u6]=u0(u3,{forceMount:void 0}),u8="DialogOverlay",u9=(0,eg.forwardRef)((e,t)=>{let n=u6(u8,e.__scopeDialog),{forceMount:r=n.forceMount,...i}=e,o=u5(u8,e.__scopeDialog);return o.modal?(0,eg.createElement)(cd,{present:r||o.open},(0,eg.createElement)(u7,dZ({},i,{ref:t}))):null}),u7=(0,eg.forwardRef)((e,t)=>{let{__scopeDialog:n,...r}=e,i=u5(u8,n);return(0,eg.createElement)(uH,{as:d5,allowPinchZoom:!0,shards:[i.contentRef]},(0,eg.createElement)(d9.div,dZ({"data-state":hl(i.open)},r,{ref:t,style:{pointerEvents:"auto",...r.style}})))}),he="DialogContent",ht=(0,eg.forwardRef)((e,t)=>{let n=u6(he,e.__scopeDialog),{forceMount:r=n.forceMount,...i}=e,o=u5(he,e.__scopeDialog);return(0,eg.createElement)(cd,{present:r||o.open},o.modal?(0,eg.createElement)(hn,dZ({},i,{ref:t})):(0,eg.createElement)(hr,dZ({},i,{ref:t})))}),hn=(0,eg.forwardRef)((e,t)=>{let n=u5(he,e.__scopeDialog),r=(0,eg.useRef)(null),i=d1(t,n.contentRef,r);return(0,eg.useEffect)(()=>{let e=r.current;if(e)return uJ(e)},[]),(0,eg.createElement)(hi,dZ({},e,{ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:dQ(e.onCloseAutoFocus,e=>{var t;e.preventDefault(),null===(t=n.triggerRef.current)||void 0===t||t.focus()}),onPointerDownOutside:dQ(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey;(2===t.button||n)&&e.preventDefault()}),onFocusOutside:dQ(e.onFocusOutside,e=>e.preventDefault())}))}),hr=(0,eg.forwardRef)((e,t)=>{let n=u5(he,e.__scopeDialog),r=(0,eg.useRef)(!1),i=(0,eg.useRef)(!1);return(0,eg.createElement)(hi,dZ({},e,{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var o,s;null===(o=e.onCloseAutoFocus)||void 0===o||o.call(e,t),t.defaultPrevented||(r.current||null===(s=n.triggerRef.current)||void 0===s||s.focus(),t.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:t=>{var o,s;null===(o=e.onInteractOutside)||void 0===o||o.call(e,t),t.defaultPrevented||(r.current=!0,"pointerdown"!==t.detail.originalEvent.type||(i.current=!0));let a=t.target;(null===(s=n.triggerRef.current)||void 0===s?void 0:s.contains(a))&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&i.current&&t.preventDefault()}}))}),hi=(0,eg.forwardRef)((e,t)=>{let{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,...s}=e,a=u5(he,n),l=d1(t,(0,eg.useRef)(null));return uc(),(0,eg.createElement)(eg.Fragment,null,(0,eg.createElement)(ur,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:o},(0,eg.createElement)(cr,dZ({role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":hl(a.open)},s,{ref:l,onDismiss:()=>a.onOpenChange(!1)}))),!1)}),ho="DialogTitle",hs=(0,eg.forwardRef)((e,t)=>{let{__scopeDialog:n,...r}=e,i=u5(ho,n);return(0,eg.createElement)(d9.h2,dZ({id:i.titleId},r,{ref:t}))}),ha=(0,eg.forwardRef)((e,t)=>{let{__scopeDialog:n,...r}=e,i=u5("DialogClose",n);return(0,eg.createElement)(d9.button,dZ({type:"button"},r,{ref:t,onClick:dQ(e.onClick,()=>i.onOpenChange(!1))}))});function hl(e){return e?"open":"closed"}let[hd,hc]=function(e,t){let n=(0,eg.createContext)(t);function r(e){let{children:t,...r}=e,i=(0,eg.useMemo)(()=>r,Object.values(r));return(0,eg.createElement)(n.Provider,{value:i},t)}return r.displayName=e+"Provider",[r,function(r){let i=(0,eg.useContext)(n);if(i)return i;if(void 0!==t)return t;throw Error(`\`${r}\` must be used within \`${e}\``)}]}("DialogTitleWarning",{contentName:he,titleName:ho,docsSlug:"dialog"}),hu=e=>{let{__scopeDialog:t,children:n,open:r,defaultOpen:i,onOpenChange:o,modal:s=!0}=e,a=(0,eg.useRef)(null),l=(0,eg.useRef)(null),[d=!1,c]=cu({prop:r,defaultProp:i,onChange:o});return(0,eg.createElement)(u2,{scope:t,triggerRef:a,contentRef:l,contentId:c7(),titleId:c7(),descriptionId:c7(),open:d,onOpenChange:c,onOpenToggle:(0,eg.useCallback)(()=>c(e=>!e),[c]),modal:s},n)},hh=e=>{let{__scopeDialog:t,forceMount:n,children:r,container:i}=e,o=u5(u3,t);return(0,eg.createElement)(u4,{scope:t,forceMount:n},eg.Children.map(r,e=>(0,eg.createElement)(cd,{present:n||o.open},(0,eg.createElement)(ca,{asChild:!0,container:i},e))))};function hp({className:e,children:t}){return(0,j.jsx)("div",{className:rm("tlui-dialog__header",e),children:t})}function hg({className:e,children:t}){return(0,j.jsx)(hs,{dir:"ltr",className:rm("tlui-dialog__header__title",e),children:t})}function hf(){return(0,j.jsx)("div",{className:"tlui-dialog__header__close",children:(0,j.jsx)(ha,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:(0,j.jsx)(c6,{type:"icon","aria-label":"Close",onTouchEnd:e=>e.target.click(),children:(0,j.jsx)(c0,{small:!0,icon:"cross-2"})})})})}function hm({className:e,children:t,style:n}){return(0,j.jsx)("div",{className:rm("tlui-dialog__body",e),style:n,children:t})}function hy({className:e,children:t}){return(0,j.jsx)("div",{className:rm("tlui-dialog__footer",e),children:t})}let hb=eg.forwardRef(function({className:e,label:t,icon:n,iconLeft:r,autoselect:i=!1,autofocus:o=!1,defaultValue:s,placeholder:a,onComplete:l,onValueChange:d,onCancel:c,onBlur:u,shouldManuallyMaintainScrollPositionWhenFocused:h=!1,children:p,value:g},f){let m=rR(),y=eg.useRef(null);eg.useImperativeHandle(f,()=>y.current);let b=cJ(),v=eg.useRef(s??""),x=eg.useRef(s??""),[S,w]=eg.useState(!1),C=eg.useCallback(e=>{w(!0);let t=e.currentTarget;x.current=t.value,requestAnimationFrame(()=>{i&&t.select()})},[i]),_=eg.useCallback(e=>{let t=e.currentTarget.value;x.current=t,d?.(t)},[d]),k=eg.useCallback(e=>{switch(e.key){case"Enter":e.currentTarget.blur(),rT(e),l?.(e.currentTarget.value);break;case"Escape":e.currentTarget.value=v.current,e.currentTarget.blur(),rT(e),c?.(e.currentTarget.value)}},[l,c]),P=eg.useCallback(e=>{w(!1);let t=e.currentTarget.value;u?.(t)},[u]);return eg.useEffect(()=>{if(!m.environment.isIos)return;let e=window.visualViewport;if(S&&h&&e){let t=()=>{y.current?.scrollIntoView({block:"center"})};return e.addEventListener("resize",t),e.addEventListener("scroll",t),requestAnimationFrame(()=>{y.current?.scrollIntoView({block:"center"})}),()=>{e.removeEventListener("resize",t),e.removeEventListener("scroll",t)}}},[m,S,h]),(0,j.jsxs)("div",{draggable:!1,className:"tlui-input__wrapper",children:[p,t&&(0,j.jsx)("label",{children:b(t)}),r&&(0,j.jsx)(c0,{icon:r,className:"tlui-icon-left",small:!0}),(0,j.jsx)("input",{ref:y,className:rm("tlui-input",e),type:"text",defaultValue:s,onKeyUp:k,onChange:_,onFocus:C,onBlur:P,autoFocus:o,placeholder:a,value:g}),n&&(0,j.jsx)(c0,{icon:n,small:!!t})]})});function hv(e){return tF.isValid(e)?{isValid:!0,hasProtocol:!0}:tF.isValid("https://"+e)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}let hx=eS(function({onClose:e}){let t=rR().getOnlySelectedShape();return t&&"url"in t.props&&"string"==typeof t.props.url?(0,j.jsx)(hS,{onClose:e,selectedShape:t}):null}),hS=eS(function({onClose:e,selectedShape:t}){let n=rR(),r=cJ(),i=(0,eg.useRef)(null);(0,eg.useEffect)(()=>{requestAnimationFrame(()=>i.current?.focus())},[]);let o=(0,eg.useRef)(t.props.url),[s,a]=(0,eg.useState)(()=>{let e=hv(t.props.url),n=!0===e.isValid?e.hasProtocol?t.props.url:"https://"+t.props.url:"https://";return{actual:n,safe:n,valid:!0}}),l=(0,eg.useCallback)(e=>{let t=e.replace(/https?:\/\/(https?:\/\/)/,(e,t)=>t),n=hv(t),r=!0===n.isValid?n.hasProtocol?t:"https://"+t:"https://";a({actual:t,safe:r,valid:n.isValid})},[]),d=(0,eg.useCallback)(()=>{let t=n.getOnlySelectedShape();t&&(n.updateShapes([{id:t.id,type:t.type,props:{url:""}}]),e())},[n,e]),c=(0,eg.useCallback)(()=>{let t=n.getOnlySelectedShape();t&&(t&&"url"in t.props&&t.props.url!==s.safe&&n.updateShapes([{id:t.id,type:t.type,props:{url:s.safe}}]),e())},[n,e,s]),u=(0,eg.useCallback)(()=>{e()},[e]);if(!t)return e(),null;let h=o.current&&!s.valid;return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(hp,{children:[(0,j.jsx)(hg,{children:r("edit-link-dialog.title")}),(0,j.jsx)(hf,{})]}),(0,j.jsx)(hm,{children:(0,j.jsxs)("div",{className:"tlui-edit-link-dialog",children:[(0,j.jsx)(hb,{ref:i,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autofocus:!0,value:s.actual,onValueChange:l,onComplete:c,onCancel:u}),(0,j.jsx)("div",{children:r(s.valid?"edit-link-dialog.detail":"edit-link-dialog.invalid-url")})]})}),(0,j.jsxs)(hy,{className:"tlui-dialog__footer__actions",children:[(0,j.jsx)(c6,{type:"normal",onClick:u,onTouchEnd:u,children:r("edit-link-dialog.cancel")}),h?(0,j.jsx)(c6,{type:"danger",onTouchEnd:d,onClick:d,children:r("edit-link-dialog.clear")}):(0,j.jsx)(c6,{type:"primary",disabled:!s.valid,onTouchEnd:c,onClick:c,children:r("edit-link-dialog.save")})]})]})}),hw=eS(function({onClose:e}){let t=rR(),n=cJ(),r=cH(),[i,o]=(0,eg.useState)(null),[s,a]=(0,eg.useState)(""),[l,d]=(0,eg.useState)(null),[c,u]=(0,eg.useState)(!1),h=(0,eg.useRef)(-1);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(hp,{children:[(0,j.jsx)(hg,{children:i?`${n("embed-dialog.title")} \u2014 ${i.title}`:n("embed-dialog.title")}),(0,j.jsx)(hf,{})]}),i?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(hm,{className:"tlui-embed-dialog__enter",children:[(0,j.jsx)(hb,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"http://example.com",autofocus:!0,onValueChange:e=>{a(e);let t=du(e);d(t&&t.definition.type===i.type?t:null),u(!1),clearTimeout(h.current),h.current=setTimeout(()=>u(!t),320)}}),""===s?(0,j.jsxs)("div",{className:"tlui-embed-dialog__instruction",children:[(0,j.jsx)("span",{children:n("embed-dialog.instruction")})," ",i.instructionLink&&(0,j.jsxs)("a",{target:"_blank",rel:"noopener noreferrer",href:i.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",(0,j.jsx)(c0,{icon:"external-link",small:!0})]})]}):(0,j.jsx)("div",{className:"tlui-embed-dialog__warning",children:c?n("embed-dialog.invalid-url"):"\xa0"})]}),(0,j.jsxs)(hy,{className:"tlui-dialog__footer__actions",children:[(0,j.jsx)(c6,{type:"normal",onClick:()=>{o(null),d(null),a("")},label:"embed-dialog.back"}),(0,j.jsx)("div",{className:"tlui-embed__spacer"}),(0,j.jsx)(c6,{type:"normal",label:"embed-dialog.cancel",onClick:e}),(0,j.jsx)(c6,{type:"primary",disabled:!l,label:"embed-dialog.create",onClick:()=>{l&&(t.putExternalContent({type:"embed",url:s,point:t.getViewportPageCenter(),embed:l.definition}),e())}})]})]}):(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(hm,{className:"tlui-embed-dialog__list",children:n9.map(e=>(0,j.jsx)(c6,{type:"menu",onClick:()=>o(e),label:e.title,children:(0,j.jsx)("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${r.embedIcons[e.type]})`}})},e.type))})})]})});var hC=n(6169);async function h_(e,t,n){let{elements:r,files:i}=t,o={shapes:[],rootShapeIds:[],assets:[],schema:e.store.schema.serialize()},s=new Map,a=new Map,l=e.getCurrentPageId(),d=new Map,c=[],u=new Set;r.forEach(e=>{if(d.set(e.id,nB()),null!==e.boundElements)for(let t of e.boundElements)"text"===t.type&&u.add(t.id)});let h="a1";for(let e of r){if(u.has(e.id))continue;let t=d.get(e.id),n={id:t,typeName:"shape",parentId:l,index:h,x:e.x,y:e.y,rotation:0,isLocked:e.locked,opacity:hk(e.opacity),meta:{}};switch(0!==e.angle&&a.set(t,e.angle),e.groupIds&&e.groupIds.length>0?s.has(e.groupIds[0])?s.get(e.groupIds[0])?.push(t):s.set(e.groupIds[0],[t]):c.push(t),e.type){case"rectangle":case"ellipse":case"diamond":{let t="",i="middle";if(null!==e.boundElements){for(let n of e.boundElements)if("text"===n.type){let e=r.find(e=>e.id===n.id);e&&(t=e.text,i=hA[e.textAlign])}}let s="transparent"===e.backgroundColor?e.strokeColor:e.backgroundColor;o.shapes.push({...n,type:"geo",props:{geo:e.type,url:e.link??"",w:e.width,h:e.height,size:hP[e.strokeWidth]??"draw",color:hj[s]??"black",text:t,align:i,dash:hR(e),fill:hL(e)}});break}case"freedraw":o.shapes.push({...n,type:"draw",props:{dash:hR(e),size:hP[e.strokeWidth],color:hj[e.strokeColor]??"black",segments:[{type:"free",points:e.points.map(([e,t,n=.5])=>({x:e,y:t,z:n}))}]}});break;case"line":{let t=e.points[0],r=e.points[e.points.length-1],i=s8(e.points.length);o.shapes.push({...n,type:"line",props:{dash:hR(e),size:hP[e.strokeWidth],color:hj[e.strokeColor]??"black",spline:e.roundness?"cubic":"line",handles:{start:{id:"start",type:"vertex",index:i[0],x:t[0],y:t[1]},end:{id:"end",type:"vertex",index:i[i.length-1],x:r[0],y:r[1]},...Object.fromEntries(e.points.slice(1,-1).map(([e,t],n)=>{let r=ss();return[r,{id:r,type:"vertex",index:i[n+1],x:e,y:t}]}))}}});break}case"arrow":{let t="";if(null!==e.boundElements){for(let n of e.boundElements)if("text"===n.type){let e=r.find(e=>e.id===n.id);e&&(t=e.text)}}let i=e.points[0],s=e.points[e.points.length-1],a=d.get(e.startBinding?.elementId),l=d.get(e.endBinding?.elementId);o.shapes.push({...n,type:"arrow",props:{text:t,bend:function(e,t,n){let r=0;if(e.points.length>2){let i=new rG(t[0],t[1]),o=new rG(n[0],n[1]),s=new rG(e.points[1][0],e.points[1][1]),a=rG.Sub(o,i),l=rG.Per(a),d=rG.Med(o,i),c=rG.Sub(d,l),u=rG.Add(d,l),h=rG.NearestPointOnLineSegment(c,u,s,!1);r=rG.Dist(h,d),rG.Clockwise(h,o,d)&&(r*=-1)}return r}(e,i,s),dash:hR(e),size:hP[e.strokeWidth]??"m",color:hj[e.strokeColor]??"black",start:a?{type:"binding",boundShapeId:a,normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1}:{type:"point",x:i[0],y:i[1]},end:l?{type:"binding",boundShapeId:l,normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1}:{type:"point",x:s[0],y:s[1]},arrowheadEnd:hO[e.endArrowhead]??"none",arrowheadStart:hO[e.startArrowhead]??"none"}});break}case"text":{let{size:t,scale:r}=function(e){let t=hI[e];return t?{size:t,scale:1}:e<16?{size:"s",scale:e/16}:e>36?{size:"xl",scale:e/36}:{size:"m",scale:1}}(e.fontSize);o.shapes.push({...n,type:"text",props:{size:t,scale:r,font:hE[e.fontFamily]??"draw",color:hj[e.strokeColor]??"black",text:e.text,align:hA[e.textAlign]}});break}case"image":{let t=i[e.fileId];if(!t)break;let r=nA.createId();o.assets.push({id:r,typeName:"asset",type:"image",props:{w:e.width,h:e.height,name:e.id??"Untitled",isAnimated:!1,mimeType:t.mimeType,src:t.dataURL},meta:{}}),o.shapes.push({...n,type:"image",props:{w:e.width,h:e.height,assetId:r}})}}h=s6(h)}let p=n??(e.inputs.shiftKey?e.inputs.currentPagePoint:void 0);for(let t of(e.mark("paste"),e.putContentOntoCurrentPage(o,{point:p,select:!1,preserveIds:!0}),s.values()))if(t.length>1){e.groupShapes(t);let n=e.getShape(t[0]);n?.parentId&&nF(n.parentId)&&c.push(n.parentId)}for(let[t,n]of a)e.select(t),e.rotateShapesBy([t],n);let g=eI(c.map(t=>e.getShape(t))),f=oE.Common(g.map(t=>e.getShapePageBounds(t))),m=e.getViewportPageBounds().center;e.updateShapes(g.map(e=>{let t={x:(e.x??0)-(f.x+f.w/2),y:(e.y??0)-(f.y+f.h/2)};return{id:e.id,type:e.type,x:m.x+t.x,y:m.y+t.y}})),e.setSelectedShapes(c)}let hk=e=>{let t=e/100;return t<.2?.1:t<.4?.25:t<.6?.5:t<.8?.75:1},hP={1:"s",2:"m",3:"l",4:"xl"},hI={16:"s",20:"m",28:"l",36:"xl"},hE={1:"draw",2:"sans",3:"mono"},hj={"#ffffff":"grey","#000000":"black","#343a40":"black","#495057":"grey","#c92a2a":"red","#a61e4d":"light-red","#862e9c":"violet","#5f3dc4":"light-violet","#364fc7":"blue","#1864ab":"light-blue","#0b7285":"light-green","#087f5b":"light-green","#2b8a3e":"green","#5c940d":"light-green","#e67700":"yellow","#d9480f":"orange","#ced4da":"grey","#868e96":"grey","#fa5252":"light-red","#e64980":"red","#be4bdb":"light-violet","#7950f2":"violet","#4c6ef5":"blue","#228be6":"light-blue","#15aabf":"light-green","#12b886":"green","#40c057":"green","#82c91e":"light-green","#fab005":"yellow","#fd7e14":"orange","#212529":"grey"},hM={solid:"draw",dashed:"dashed",dotted:"dotted"},hT={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},hA={left:"start",center:"middle",right:"end"},hO={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"},hR=e=>{let t=hM[e.strokeStyle]??"draw";return"draw"===t&&0===e.roughness&&(t="solid"),t},hL=e=>"transparent"===e.backgroundColor?"none":hT[e.fillStyle]??"solid";async function hD(e,t,n,r){let i=(await Promise.all(t.map(async e=>await (await fetch(e)).blob()))).map(e=>new File([e],"tldrawFile",{type:e.type}));e.mark("paste"),await e.putExternalContent({type:"files",files:i,point:n,ignoreParent:!1,sources:r}),t.forEach(e=>URL.revokeObjectURL(e))}async function hz(e,t,n,r){try{if(new URL(t).pathname.match(/\.(png|jpe?g|gif|svg|webp)$/i)){let n=await fetch(t,{method:"HEAD"});if(n.headers.get("content-type")?.match(/^image\//)){e.mark("paste"),hD(e,[t]);return}}}catch(e){"Failed to fetch"!==e.message&&console.error(e)}return e.mark("paste"),await e.putExternalContent({type:"url",point:n,url:t,sources:r})}let hN=()=>void 0,h$=eg.createContext({});function hF({onEvent:e,children:t}){return(0,j.jsx)(h$.Provider,{value:e??hN,children:t})}function hB(){return eg.useContext(h$)??hN}let hV=e=>{try{let t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch(e){return!1}},hU=e=>{let t=e.split(/[\n\s]/);for(let e of t)try{let t=new URL(e);if(!("http:"===t.protocol||"https:"===t.protocol))return}catch(e){return}return oR(t)},hK=e=>/^<svg/.test(e),hH=["input","select","textarea"];function hY(e){let{activeElement:t}=document;return e.getIsMenuOpen()||t&&(t.getAttribute("contenteditable")||hH.indexOf(t.tagName.toLowerCase())>-1)}async function hW(e){return new Promise((t,n)=>{let r=new FileReader;r.addEventListener("loadend",()=>{t(r.result)}),r.addEventListener("error",()=>{n(r.error)}),r.readAsText(e)})}let hX=e=>e.types.find(e=>e.match(/^image\//)),hG=(e,t,n,r)=>{let i=hU(t);if(i)for(let t of i)hz(e,t,n);else hV(t)?hz(e,t,n):hK(t)?(e.mark("paste"),e.putExternalContent({type:"svg-text",text:t,point:n,sources:r})):(e.mark("paste"),e.putExternalContent({type:"text",text:t,point:n,sources:r}))},hq=async(e,t,n)=>{if(null!==e.getEditingShapeId())return;if(!t)throw Error("No clipboard data");let r=[];for(let e of Object.values(t.items))switch(e.kind){case"file":r.push({type:"file",source:new Promise(t=>t(e.getAsFile()))});break;case"string":"text/html"===e.type?r.push({type:"html",source:new Promise(t=>e.getAsString(t))}):"text/plain"===e.type?r.push({type:"text",source:new Promise(t=>e.getAsString(t))}):r.push({type:e.type,source:new Promise(t=>e.getAsString(t))})}hJ(e,r,n)},hZ=async(e,t,n)=>{let r=[];for(let e of t){if(hX(e))for(let t of e.types)t.match(/^image\//)&&r.push({type:"blob",source:e.getType(t)});e.types.includes("text/html")&&r.push({type:"html",source:new Promise(t=>e.getType("text/html").then(e=>hW(e).then(t)))}),e.types.includes("text/uri-list")&&r.push({type:"url",source:new Promise(t=>e.getType("text/uri-list").then(e=>hW(e).then(t)))}),e.types.includes("text/plain")&&r.push({type:"text",source:new Promise(t=>e.getType("text/plain").then(e=>hW(e).then(t)))})}return await hJ(e,r,n)};async function hJ(e,t,n){let r=t.filter(e=>("file"===e.type||"blob"===e.type)&&null!==e.source);if(r.length){let t=(await Promise.all(r.map(e=>e.source))).filter(Boolean).map(e=>URL.createObjectURL(e));return await hD(e,t,n)}let i=await Promise.all(t.filter(e=>"file"!==e.type).map(e=>new Promise(t=>{if("file"===e.type){t({type:"error",data:null,reason:"unexpected file"});return}e.source.then(n=>{let r=n.match(/<tldraw[^>]*>(.*)<\/tldraw>/)?.[1];if(r)try{let e=(0,hC.decompressFromBase64)(r);if(null===e){t({type:"error",data:e,reason:"found tldraw data comment but could not parse base64"});return}{let n=JSON.parse(e);if("application/tldraw"!==n.type&&t({type:"error",data:n,reason:`found tldraw data comment but JSON was of a different type: ${n.type}`}),"string"==typeof n.data){t({type:"error",data:n,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}t({type:"tldraw",data:n.data});return}}catch(e){t({type:"error",data:r,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if("html"===e.type){t({type:"text",data:n,subtype:"html"});return}if("url"===e.type){t({type:"text",data:n,subtype:"url"});return}try{let e=JSON.parse(n);if("excalidraw/clipboard"===e.type){t({type:"excalidraw",data:e});return}t({type:"text",data:n,subtype:"json"});return}catch(e){t({type:"text",data:n,subtype:"text"});return}}t({type:"error",data:n,reason:"unhandled case"})})})));for(let t of i)if("tldraw"===t.type){!function(e,t,n){let r=n??(e.inputs.shiftKey?e.inputs.currentPagePoint:void 0);e.mark("paste"),e.putContentOntoCurrentPage(t,{point:r,select:!0})}(e,t.data,n);return}for(let t of i)if("excalidraw"===t.type){h_(e,t.data,n);return}for(let t of i)if("text"===t.type&&"html"===t.subtype){let r=new DOMParser().parseFromString(t.data,"text/html").querySelector("body");if(r&&1===Array.from(r.children).filter(e=>1===e.nodeType).length&&r.firstElementChild&&"A"===r.firstElementChild.tagName&&r.firstElementChild.hasAttribute("href")&&""!==r.firstElementChild.getAttribute("href")){hG(e,r.firstElementChild.getAttribute("href"),n,i);return}if(!i.some(e=>"text"===e.type&&"html"!==e.subtype)&&t.data.trim()){hG(e,function(e){let t=document.implementation.createHTMLDocument("");return t.documentElement.innerHTML=e.trim(),t.body.textContent||t.body.innerText||""}(t.data),n,i);return}}for(let t of i)if("text"===t.type&&"url"===t.subtype){hz(e,t.data,n,i);return}for(let t of i)if("text"===t.type&&"text"===t.subtype&&t.data.trim()){hG(e,t.data,n,i);return}}let hQ=e=>{let t=e.getContentFromCurrentPage(e.getSelectedShapeIds());if(!t){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}let n=(0,hC.compressToBase64)(JSON.stringify({type:"application/tldraw",kind:"content",data:t}));if("undefined"!=typeof navigator){let r=t.shapes.map(t=>e.isShapeOfType(t,"text")||e.isShapeOfType(t,"geo")||e.isShapeOfType(t,"arrow")?t.props.text:e.isShapeOfType(t,"bookmark")||e.isShapeOfType(t,"embed")?t.props.url:null).filter(e0);if(navigator.clipboard?.write){let e=new Blob([`<tldraw>${n}</tldraw>`],{type:"text/html"}),t=r.join(" ");""===t&&(t=" "),navigator.clipboard.write([new ClipboardItem({"text/html":e,"text/plain":new Blob([t],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<tldraw>${n}</tldraw>`)}};async function h0(e,t,n){let{type:r,quality:i,scale:o}=n,s=+e.getAttribute("width"),a=+e.getAttribute("height"),[l,d]=await dl(s*o,a*o);l=Math.floor(l),d=Math.floor(d);let c=l/s,u=await h1(e),h=URL.createObjectURL(new Blob([u],{type:"image/svg+xml"})),p=await new Promise(e=>{let n=new Image;n.crossOrigin="anonymous",n.onload=async()=>{t&&await new Promise(e=>setTimeout(e,250));let r=document.createElement("canvas"),i=r.getContext("2d");r.width=l,r.height=d,i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(n,0,0,l,d),URL.revokeObjectURL(h),e(r)},n.onerror=()=>{e(null)},n.src=h});if(!p)return null;let g=await new Promise(e=>p.toBlob(t=>{(!t||r_.throwToBlob.get())&&e(null),e(t)},"image/"+r,i));if(!g)return null;let f=new DataView(await g.arrayBuffer());return eN.setPhysChunk(f,c,{type:"image/"+r})}async function h1(e){let t=e.cloneNode(!0);e.setAttribute("width",+e.getAttribute("width")+""),e.setAttribute("height",+e.getAttribute("height")+"");let n=new FileReader;for(let e of Array.from(t.querySelectorAll("image"))){let t=e.getAttribute("xlink:href");if(t&&!t.startsWith("data:")){let r=await (await fetch(t)).blob(),i=await new Promise((e,t)=>{n.onload=()=>e(n.result),n.onerror=()=>t(n.error),n.readAsDataURL(r)});e.setAttribute("xlink:href",i)}}return new XMLSerializer().serializeToString(t).replaceAll("&#10;      ","").replaceAll(/((\s|")[0-9]*\.[0-9]{2})([0-9]*)(\b|"|\))/g,"$1")}async function h2(e,t,n){let r=await e.getSvg(t?.length?t:[...e.getCurrentPageShapeIds()],{scale:1,background:e.getInstanceState().exportBackground,...n});if(!r)throw Error("Could not construct SVG.");return r}async function h5(e,t,n,r={}){switch(n){case"svg":return h1(await h2(e,t,r));case"json":return JSON.stringify(e.getContentFromCurrentPage(t));default:eM(n)}}async function h3(e,t,n,r={}){switch(n){case"svg":return new Blob([await h5(e,t,"svg",r)],{type:"text/plain"});case"json":return new Blob([await h5(e,t,"json",r)],{type:"text/plain"});case"jpeg":case"png":case"webp":{let i=await h0(await h2(e,t,r),e.environment.isSafari,{type:n,quality:1,scale:2});if(!i)throw Error("Could not construct image.");return i}default:eM(n)}}let h4={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",json:"text/plain",svg:"text/plain"};async function h6(e){await navigator.clipboard?.writeText?.(await e())}let h8=(0,eg.createContext)({});function h9({children:e}){let[t,n]=(0,eg.useState)([]),r=(0,eg.useCallback)(e=>{let t=e.id??ss();return n(n=>[...n.filter(t=>t.id!==e.id),{...e,id:t}]),t},[]),i=(0,eg.useCallback)(e=>(n(t=>t.filter(t=>t.id!==e)),e),[]),o=(0,eg.useCallback)(()=>{n(()=>[])},[]);return(0,j.jsx)(h8.Provider,{value:{toasts:t,addToast:r,removeToast:i,clearToasts:o},children:e})}function h7(){let e=(0,eg.useContext)(h8);if(!e)throw Error("useToasts must be used within a ToastsProvider");return e}let pe=(0,eg.createContext)({});function pt({children:e}){let t=rR(),n=hB(),[r,i]=(0,eg.useState)([]),o=(0,eg.useCallback)(e=>{let r=e.id??ss();return i(t=>[...t.filter(t=>t.id!==e.id),{...e,id:r}]),n("open-menu",{source:"dialog",id:r}),t.addOpenMenu(r),r},[t,n]),s=(0,eg.useCallback)((e,r)=>(i(t=>t.map(t=>t.id===e?{...t,...r}:t)),n("open-menu",{source:"dialog",id:e}),t.addOpenMenu(e),e),[t,n]),a=(0,eg.useCallback)(e=>(i(t=>t.filter(t=>t.id!==e||(t.onClose?.(),!1))),n("close-menu",{source:"dialog",id:e}),t.deleteOpenMenu(e),e),[t,n]),l=(0,eg.useCallback)(()=>{i(e=>(e.forEach(e=>{e.onClose?.(),n("close-menu",{source:"dialog",id:e.id}),t.deleteOpenMenu(e.id)}),[]))},[t,n]);return(0,j.jsx)(pe.Provider,{value:{dialogs:r,addDialog:o,removeDialog:a,clearDialogs:l,updateDialog:s},children:e})}function pn(){let e=(0,eg.useContext)(pe);if(!e)throw Error("useDialogs must be used within a DialogsProvider");return e}async function pr(e,t,n="png",r={}){let i=`shapes at ${pi()}`;if(1===t.length){let n=e.getShape(t[0]);i=e.isShapeOfType(n,"frame")?n.props.name??"frame":`${n.id.replace(/:/,"_")} at ${pi()}`}i+=`.${n}`;let o=await h3(e,t,n,r);(function(e){let t=document.createElement("a"),n=URL.createObjectURL(e);t.href=n,t.download=e.name,t.click(),URL.revokeObjectURL(n)})(new File([o],i,{type:o.type}))}function pi(){let e=new Date,t=String(e.getFullYear()).slice(2),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),s=String(e.getSeconds()).padStart(2,"0");return`${t}-${n}-${r} ${i}.${o}.${s}`}function po(){let e=rR(),t=(0,eg.useRef)();return(0,eg.useEffect)(()=>{let n=window.document.createElement("input");async function r(t){let r=t.target.files;r&&0!==r.length&&(await e.putExternalContent({type:"files",files:Array.from(r),point:e.getViewportPageBounds().center,ignoreParent:!1}),n.value="")}return n.type="file",n.accept="image/jpeg,image/png,image/gif,image/svg+xml,video/mp4,video/quicktime",n.multiple=!0,t.current=n,n.addEventListener("change",r),()=>{t.current=void 0,n.removeEventListener("change",r)}},[e]),(0,eg.useCallback)(()=>{t.current?.click()},[t])}let ps=eg.createContext({});function pa({overrides:e,children:t}){let n=rR(),{addDialog:r,clearDialogs:i}=pn(),{clearToasts:o}=h7(),s=po(),a=function(){let e=rR(),t=(0,eg.useRef)(null),n=(0,eg.useRef)(null);return(0,eg.useCallback)(async function(){let r=document.createElement("div"),i=document.createElement("style"),o=(e,t)=>{e&&(e.innerHTML=""),t&&document.head.contains(t)&&document.head.removeChild(t),e&&document.body.contains(e)&&document.body.removeChild(e)};o(t.current,n.current),t.current=r,n.current=i;let s=`tl-print-surface-${ss()}`;r.className=s,i.innerHTML=`
			.${s} {
				display: none;
			}

			.${s} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${s} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${s}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${s}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${s}__item__header {
					display: none;
				}

				.${s}__item__footer {
					display: none;
					text-align: right;
				}

				.${s}__item__footer__hide {
					display: none;
				}

				
			}

		`;let a=()=>{document.head.appendChild(i),document.body.appendChild(r)},l=()=>{e.once("change-history",()=>{o(r,i)})};function d(e,t,n){try{r.innerHTML+=`<div class="${s}__item">
        <div class="${s}__item__header">
          ${e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${s}__item__main">
          ${n.outerHTML}
        </div>
        <div class="${s}__item__footer ${s}__item__footer__${t?"":"hide"}">
          ${t??""}
        </div>
      </div>`}catch(e){console.error(e)}}function c(){e.environment.isChromeForIos?(a(),window.print()):e.environment.isSafari?(a(),document.execCommand("print",!1)):window.print()}window.addEventListener("beforeprint",a),window.addEventListener("afterprint",l);let u=e.getSelectedShapeIds(),h=e.getCurrentPageId(),p=e.getPages(),g={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(e.getSelectedShapeIds().length>0){let t=await e.getSvg(u,g);if(t){let e=p.find(e=>e.id===h);d(`tldraw \u2014 ${e?.name}`,null,t),c()}}else{let t=e.getCurrentPage(),n=await e.getSvg(e.getSortedChildIdsForParent(t.id),g);n&&(d(`tldraw \u2014 ${t.name}`,null,n),c())}window.removeEventListener("beforeprint",a),window.removeEventListener("afterprint",l)},[e])}(),{cut:l,copy:d,paste:c}=function(){let e=rR(),t=hB(),n=(0,eg.useCallback)(function(n){0!==e.getSelectedShapeIds().length&&(hQ(e),t("copy",{source:n}))},[e,t]),r=(0,eg.useCallback)(function(n){0!==e.getSelectedShapeIds().length&&(hQ(e),e.deleteShapes(e.getSelectedShapeIds()),t("cut",{source:n}))},[e,t]),i=(0,eg.useCallback)(async function(n,r,o){null!==e.getEditingShapeId()||hY(e)||(Array.isArray(n)&&n[0]instanceof ClipboardItem?(hZ(e,n,o),t("paste",{source:"menu"})):navigator.clipboard.read().then(e=>{i(e,r,o)}))},[e,t]);return{copy:n,cut:r,paste:i}}(),u=function(){let e=rR(),{addToast:t}=h7(),n=cJ();return(0,eg.useCallback)((r,i="svg")=>{(function(e,t,n="svg",r={}){if(!window.navigator.clipboard)return Promise.reject(Error("Copy not supported"));if(window.navigator.clipboard.write){let{blobPromise:i,mimeType:o}=function(e,t,n,r={}){return{blobPromise:h3(e,t,n,r),mimeType:h4[n]}}(e,t,n,r);return window.navigator.clipboard.write([new ClipboardItem({[o]:i})]).catch(e=>(console.error(e),i.then(e=>window.navigator.clipboard.write([new ClipboardItem({[o]:e})]))))}switch(n){case"json":case"svg":return h6(async()=>h5(e,t,n,r));case"jpeg":case"png":throw Error("Copy not supported");default:eM(n)}})(e,r,i).catch(()=>{t({id:"copy-fail",icon:"warning-triangle",title:n("toast.error.copy-fail.title"),description:n("toast.error.copy-fail.desc")})})},[e,t,n])}(),h=function(){let e=rR(),{addToast:t}=h7(),n=cJ();return(0,eg.useCallback)((r,i="png")=>{pr(e,r,i,{scale:1,background:e.getInstanceState().exportBackground}).catch(e=>{console.error(e.message),t({id:"export-fail",title:n("toast.error.export-fail.title"),description:n("toast.error.export-fail.desc")})})},[e,t,n])}(),p=hB(),g=eg.useMemo(()=>{function t(){return n.isIn("select")||(n.complete(),n.setCurrentTool("select")),!1}function g(){return n.isIn("select")&&n.getSelectedShapeIds().length>0}let f=Object.fromEntries([{id:"edit-link",label:"action.edit-link",icon:"link",readonlyOk:!1,onSelect(e){g()&&(t()||(p("edit-link",{source:e}),n.mark("edit-link"),r({component:hx})))}},{id:"insert-embed",label:"action.insert-embed",readonlyOk:!1,kbd:"$i",onSelect(e){p("insert-embed",{source:e}),r({component:hw})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",readonlyOk:!1,onSelect(e){p("insert-media",{source:e}),s()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",readonlyOk:!1,onSelect(e){p("undo",{source:e}),n.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",readonlyOk:!1,onSelect(e){p("redo",{source:e}),n.redo()}},{id:"export-as-svg",label:"action.export-as-svg",menuLabel:"action.export-as-svg.short",contextMenuLabel:"action.export-as-svg.short",readonlyOk:!0,onSelect(e){p("export-as",{format:"svg",source:e}),h(n.getSelectedShapeIds(),"svg")}},{id:"export-as-png",label:"action.export-as-png",menuLabel:"action.export-as-png.short",contextMenuLabel:"action.export-as-png.short",readonlyOk:!0,onSelect(e){p("export-as",{format:"png",source:e}),h(n.getSelectedShapeIds(),"png")}},{id:"export-as-json",label:"action.export-as-json",menuLabel:"action.export-as-json.short",contextMenuLabel:"action.export-as-json.short",readonlyOk:!0,onSelect(e){p("export-as",{format:"json",source:e}),h(n.getSelectedShapeIds(),"json")}},{id:"copy-as-svg",label:"action.copy-as-svg",menuLabel:"action.copy-as-svg.short",contextMenuLabel:"action.copy-as-svg.short",kbd:"$!c",readonlyOk:!0,onSelect(e){p("copy-as",{format:"svg",source:e}),u(n.getSelectedShapeIds(),"svg")}},{id:"copy-as-png",label:"action.copy-as-png",menuLabel:"action.copy-as-png.short",contextMenuLabel:"action.copy-as-png.short",readonlyOk:!0,onSelect(e){p("copy-as",{format:"png",source:e}),u(n.getSelectedShapeIds(),"png")}},{id:"copy-as-json",label:"action.copy-as-json",menuLabel:"action.copy-as-json.short",contextMenuLabel:"action.copy-as-json.short",readonlyOk:!0,onSelect(e){p("copy-as",{format:"json",source:e}),u(n.getSelectedShapeIds(),"json")}},{id:"toggle-auto-size",label:"action.toggle-auto-size",readonlyOk:!1,onSelect(e){g()&&(t()||(p("toggle-auto-size",{source:e}),n.mark("toggling auto size"),n.updateShapes(n.getSelectedShapes().filter(e=>n.isShapeOfType(e,"text")&&!1===e.props.autoSize).map(e=>({id:e.id,type:e.type,props:{...e.props,w:8,autoSize:!0}})))))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(e){p("open-embed-link",{source:e});let t=n.getSelectedShapeIds(),r="No embed shapes selected";if(1!==t.length){console.error(r);return}let i=n.getShape(t[0]);if(!i||!n.isShapeOfType(i,"embed")){console.error(r);return}!function(e,t="_blank"){ip.openWindow(e,t)}(i.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(e){if(n.root.getCurrent()?.id!=="zoom"&&(p("zoom-tool",{source:e}),!(n.inputs.shiftKey||n.inputs.ctrlKey))){let e=n.root.getCurrent();e&&e.getCurrent()?.id==="idle"&&n.setCurrentTool("zoom",{onInteractionEnd:e.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",readonlyOk:!1,onSelect(e){g()&&(t()||n.batch(()=>{p("convert-to-bookmark",{source:e});let t=n.getSelectedShapes(),r=[],i=[];for(let e of t){if(!e||!n.isShapeOfType(e,"embed")||!e.props.url)continue;let t=new rG(e.x,e.y);t.rot(-e.rotation),t.add(new rG(e.props.w/2-150,e.props.h/2-160)),t.rot(e.rotation);let o={id:nB(),type:"bookmark",rotation:e.rotation,x:t.x,y:t.y,opacity:1,props:{url:e.props.url}};r.push(o),i.push(e.id)}n.mark("convert shapes to bookmark"),n.deleteShapes(i),n.createShapes(r)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",readonlyOk:!1,onSelect(e){g()&&(t()||(p("convert-to-embed",{source:e}),n.batch(()=>{let e=eI(n.getSelectedShapeIds().map(e=>n.getShape(e))),t=[],r=[];for(let i of e){if(!n.isShapeOfType(i,"bookmark"))continue;let{url:e}=i.props,o=du(i.props.url);if(!o||!o.definition)continue;let{width:s,height:a}=o.definition,l=new rG(i.x,i.y);l.rot(-i.rotation),l.add(new rG(i.props.w/2-s/2,i.props.h/2-a/2)),l.rot(i.rotation);let d={id:nB(),type:"embed",x:l.x,y:l.y,rotation:i.rotation,props:{url:e,w:s,h:a}};t.push(d),r.push(i.id)}n.mark("convert shapes to embed"),n.deleteShapes(r),n.createShapes(t)})))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",readonlyOk:!1,onSelect(e){let r,i;if(!g()||t())return;p("duplicate-shapes",{source:e});let o=n.getInstanceState();if(o.duplicateProps)r=o.duplicateProps.shapeIds,i=o.duplicateProps.offset;else{r=n.getSelectedShapeIds();let e=oE.Common(eI(r.map(e=>n.getShapePageBounds(e))));i=o.canMoveCamera?{x:e.width+10,y:0}:{x:16/n.getZoomLevel(),y:16/n.getZoomLevel()}}n.mark("duplicate shapes"),n.duplicateShapes(r,i),o.duplicateProps&&n.updateInstanceState({duplicateProps:{...o.duplicateProps,shapeIds:n.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",readonlyOk:!1,onSelect(e){g()&&(t()||(p("ungroup-shapes",{source:e}),n.mark("ungroup"),n.ungroupShapes(n.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",readonlyOk:!1,onSelect(e){if(!g()||t())return;p("group-shapes",{source:e});let r=n.getOnlySelectedShape();r&&n.isShapeOfType(r,"group")?(n.mark("ungroup"),n.ungroupShapes(n.getSelectedShapeIds())):(n.mark("group"),n.groupShapes(n.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",readonlyOk:!1,onSelect(e){if(!g())return;p("remove-frame",{source:e});let t=n.getSelectedShapes();t.length>0&&t.every(e=>n.isShapeOfType(e,"frame"))&&(n.mark("remove-frame"),function(e,t){let n=eI(t.map(t=>e.getShape(t)).filter(t=>t&&e.isShapeOfType(t,"frame")));if(!n.length)return;let r=[];e.batch(()=>{n.map(t=>{let n=e.getSortedChildIdsForParent(t.id);n.length&&(e.reparentShapes(n,t.parentId,t.index),r.push(...n))}),e.setSelectedShapes(r),e.deleteShapes(t)})}(n,t.map(e=>e.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",readonlyOk:!1,onSelect(e){if(!g())return;p("fit-frame-to-content",{source:e});let t=n.getOnlySelectedShape();t&&n.isShapeOfType(t,"frame")&&(n.mark("fit-frame-to-content"),function(e,t,n={}){let r=e.getShape(t);if(!r)return;let i=e.getSortedChildIdsForParent(r.id),o=eI(i.map(t=>e.getShape(t)));if(!o.length)return;let s=oE.FromPoints(o.flatMap(t=>{let n=e.getShapeGeometry(t.id);return e.getShapeLocalTransform(t).applyToPoints(n.vertices)})),{padding:a=50}=n,l=s.w+2*a,d=s.h+2*a,c=a-s.minX,u=a-s.minY;if(0===c&&0===u&&r.props.w===l&&r.props.h===d)return;let h=new rG(c,u).rot(r.rotation);e.batch(()=>{let t=i.map(t=>{let n=e.getShape(t);return{id:n.id,type:n.type,x:n.x+c,y:n.y+u}});t.push({id:r.id,type:r.type,x:r.x-h.x,y:r.y-h.y,props:{w:l,h:d}}),e.updateShapes(t)})}(n,t.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",readonlyOk:!1,onSelect(e){g()&&(t()||(p("align-shapes",{operation:"left",source:e}),n.mark("align left"),n.alignShapes(n.getSelectedShapeIds(),"left")))}},{id:"align-center-horizontal",label:"action.align-center-horizontal",contextMenuLabel:"action.align-center-horizontal.short",kbd:"?H",icon:"align-center-horizontal",readonlyOk:!1,onSelect(e){g()&&(t()||(p("align-shapes",{operation:"center-horizontal",source:e}),n.mark("align center horizontal"),n.alignShapes(n.getSelectedShapeIds(),"center-horizontal")))}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",readonlyOk:!1,onSelect(e){g()&&(t()||(p("align-shapes",{operation:"right",source:e}),n.mark("align right"),n.alignShapes(n.getSelectedShapeIds(),"right")))}},{id:"align-center-vertical",label:"action.align-center-vertical",contextMenuLabel:"action.align-center-vertical.short",kbd:"?V",icon:"align-center-vertical",readonlyOk:!1,onSelect(e){g()&&(t()||(p("align-shapes",{operation:"center-vertical",source:e}),n.mark("align center vertical"),n.alignShapes(n.getSelectedShapeIds(),"center-vertical")))}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",readonlyOk:!1,onSelect(e){g()&&(t()||(p("align-shapes",{operation:"top",source:e}),n.mark("align top"),n.alignShapes(n.getSelectedShapeIds(),"top")))}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",readonlyOk:!1,onSelect(e){g()&&(t()||(p("align-shapes",{operation:"bottom",source:e}),n.mark("align bottom"),n.alignShapes(n.getSelectedShapeIds(),"bottom")))}},{id:"distribute-horizontal",label:"action.distribute-horizontal",contextMenuLabel:"action.distribute-horizontal.short",icon:"distribute-horizontal",kbd:"?!h",readonlyOk:!1,onSelect(e){g()&&(t()||(p("distribute-shapes",{operation:"horizontal",source:e}),n.mark("distribute horizontal"),n.distributeShapes(n.getSelectedShapeIds(),"horizontal")))}},{id:"distribute-vertical",label:"action.distribute-vertical",contextMenuLabel:"action.distribute-vertical.short",icon:"distribute-vertical",kbd:"?!V",readonlyOk:!1,onSelect(e){g()&&(t()||(p("distribute-shapes",{operation:"vertical",source:e}),n.mark("distribute vertical"),n.distributeShapes(n.getSelectedShapeIds(),"vertical")))}},{id:"stretch-horizontal",label:"action.stretch-horizontal",contextMenuLabel:"action.stretch-horizontal.short",icon:"stretch-horizontal",readonlyOk:!1,onSelect(e){g()&&(t()||(p("stretch-shapes",{operation:"horizontal",source:e}),n.mark("stretch horizontal"),n.stretchShapes(n.getSelectedShapeIds(),"horizontal")))}},{id:"stretch-vertical",label:"action.stretch-vertical",contextMenuLabel:"action.stretch-vertical.short",icon:"stretch-vertical",readonlyOk:!1,onSelect(e){g()&&(t()||(p("stretch-shapes",{operation:"vertical",source:e}),n.mark("stretch vertical"),n.stretchShapes(n.getSelectedShapeIds(),"vertical")))}},{id:"flip-horizontal",label:"action.flip-horizontal",contextMenuLabel:"action.flip-horizontal.short",kbd:"!h",readonlyOk:!1,onSelect(e){g()&&(t()||(p("flip-shapes",{operation:"horizontal",source:e}),n.mark("flip horizontal"),n.flipShapes(n.getSelectedShapeIds(),"horizontal")))}},{id:"flip-vertical",label:"action.flip-vertical",contextMenuLabel:"action.flip-vertical.short",kbd:"!v",readonlyOk:!1,onSelect(e){g()&&(t()||(p("flip-shapes",{operation:"vertical",source:e}),n.mark("flip vertical"),n.flipShapes(n.getSelectedShapeIds(),"vertical")))}},{id:"pack",label:"action.pack",icon:"pack",readonlyOk:!1,onSelect(e){g()&&(t()||(p("pack-shapes",{source:e}),n.mark("pack"),n.packShapes(n.getSelectedShapeIds(),16)))}},{id:"stack-vertical",label:"action.stack-vertical",contextMenuLabel:"action.stack-vertical.short",icon:"stack-vertical",readonlyOk:!1,onSelect(e){g()&&(t()||(p("stack-shapes",{operation:"vertical",source:e}),n.mark("stack-vertical"),n.stackShapes(n.getSelectedShapeIds(),"vertical",16)))}},{id:"stack-horizontal",label:"action.stack-horizontal",contextMenuLabel:"action.stack-horizontal.short",icon:"stack-horizontal",readonlyOk:!1,onSelect(e){g()&&(t()||(p("stack-shapes",{operation:"horizontal",source:e}),n.mark("stack-horizontal"),n.stackShapes(n.getSelectedShapeIds(),"horizontal",16)))}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",readonlyOk:!1,onSelect(e){g()&&(t()||(p("reorder-shapes",{operation:"toFront",source:e}),n.mark("bring to front"),n.bringToFront(n.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",readonlyOk:!1,onSelect(e){g()&&(t()||(p("reorder-shapes",{operation:"forward",source:e}),n.mark("bring forward"),n.bringForward(n.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",readonlyOk:!1,onSelect(e){g()&&(t()||(p("reorder-shapes",{operation:"backward",source:e}),n.mark("send backward"),n.sendBackward(n.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",readonlyOk:!1,onSelect(e){g()&&(t()||(p("reorder-shapes",{operation:"toBack",source:e}),n.mark("send to back"),n.sendToBack(n.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",readonlyOk:!1,onSelect(e){g()&&(t()||(n.mark("cut"),l(e)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(e){g()&&(t()||d(e))}},{id:"paste",label:"action.paste",kbd:"$v",readonlyOk:!1,onSelect(e){navigator.clipboard?.read().then(t=>{c(t,e,"context-menu"===e?n.inputs.currentPagePoint:void 0)})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(e){n.batch(()=>{t()||(p("select-all-shapes",{source:e}),n.mark("select all kbd"),n.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(e){g()&&(t()||(p("select-none-shapes",{source:e}),n.mark("select none"),n.selectNone()))}},{id:"delete",label:"action.delete",kbd:",del,backspace",icon:"trash",readonlyOk:!1,onSelect(e){g()&&(t()||(p("delete-shapes",{source:e}),n.mark("delete"),n.deleteShapes(n.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",readonlyOk:!1,onSelect(e){if(!g()||t())return;p("rotate-cw",{source:e}),n.mark("rotate-cw");let r=n.getSelectionRotation()%(r0/2),i=r4(r,0)||r4(r,r0/2);n.rotateShapesBy(n.getSelectedShapeIds(),r0/2-(i?0:r))}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",readonlyOk:!1,onSelect(e){if(!g()||t())return;p("rotate-ccw",{source:e}),n.mark("rotate-ccw");let r=n.getSelectionRotation()%(r0/2),i=r4(r,0);n.rotateShapesBy(n.getSelectedShapeIds(),i?-(r0/2):-r)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(e){p("zoom-in",{source:e}),n.zoomIn(n.getViewportScreenCenter(),{duration:320})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(e){p("zoom-out",{source:e}),n.zoomOut(n.getViewportScreenCenter(),{duration:320})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(e){p("reset-zoom",{source:e}),n.resetZoom(n.getViewportScreenCenter(),{duration:320})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(e){p("zoom-to-fit",{source:e}),n.zoomToFit({duration:320})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(e){g()&&(t()||(p("zoom-to-selection",{source:e}),n.zoomToSelection({duration:320})))}},{id:"toggle-snap-mode",label:"action.toggle-snap-mode",menuLabel:"action.toggle-snap-mode.menu",readonlyOk:!1,onSelect(e){p("toggle-snap-mode",{source:e}),n.user.updateUserPreferences({isSnapMode:!n.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:"action.toggle-dark-mode",menuLabel:"action.toggle-dark-mode.menu",kbd:"$/",readonlyOk:!0,onSelect(e){p("toggle-dark-mode",{source:e}),n.user.updateUserPreferences({isDarkMode:!n.user.getIsDarkMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:"action.toggle-reduce-motion",menuLabel:"action.toggle-reduce-motion.menu",readonlyOk:!0,onSelect(e){p("toggle-reduce-motion",{source:e}),n.user.updateUserPreferences({animationSpeed:0===n.user.getAnimationSpeed()?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:"action.toggle-edge-scrolling",menuLabel:"action.toggle-edge-scrolling.menu",readonlyOk:!0,onSelect(e){p("toggle-edge-scrolling",{source:e}),n.user.updateUserPreferences({edgeScrollSpeed:0===n.user.getEdgeScrollSpeed()?1:0})},checkbox:!0},{id:"toggle-transparent",label:"action.toggle-transparent",menuLabel:"action.toggle-transparent.menu",contextMenuLabel:"action.toggle-transparent.context-menu",readonlyOk:!0,onSelect(e){p("toggle-transparent",{source:e}),n.updateInstanceState({exportBackground:!n.getInstanceState().exportBackground},{ephemeral:!0})},checkbox:!0},{id:"toggle-tool-lock",label:"action.toggle-tool-lock",menuLabel:"action.toggle-tool-lock.menu",readonlyOk:!1,kbd:"q",onSelect(e){p("toggle-tool-lock",{source:e}),n.updateInstanceState({isToolLocked:!n.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",readonlyOk:!1,onSelect(e){p("unlock-all",{source:e});let t=[];for(let e of n.getCurrentPageShapes())e.isLocked&&t.push({id:e.id,type:e.type,isLocked:!1});t.length>0&&n.updateShapes(t)}},{id:"toggle-focus-mode",label:"action.toggle-focus-mode",menuLabel:"action.toggle-focus-mode.menu",readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(e){requestAnimationFrame(()=>{n.batch(()=>{p("toggle-focus-mode",{source:e}),i(),o(),n.updateInstanceState({isFocusMode:!n.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:"action.toggle-grid",menuLabel:"action.toggle-grid.menu",readonlyOk:!0,kbd:"$'",onSelect(e){p("toggle-grid-mode",{source:e}),n.updateInstanceState({isGridMode:!n.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:"action.toggle-debug-mode",menuLabel:"action.toggle-debug-mode.menu",readonlyOk:!0,onSelect(e){p("toggle-debug-mode",{source:e}),n.updateInstanceState({isDebugMode:!n.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(e){p("print",{source:e}),a()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(e){p("exit-pen-mode",{source:e}),n.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(e){p("stop-following",{source:e}),n.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(e){p("zoom-to-content",{source:e}),n.zoomToContent()}},{id:"toggle-lock",label:"action.toggle-lock",readonlyOk:!1,kbd:"!l",onSelect(e){n.mark("locking"),p("toggle-lock",{source:e}),n.toggleLock(n.getSelectedShapeIds())}}].map(e=>[e.id,e]));return e?e(n,f,void 0):f},[n,p,e,r,s,h,u,l,d,c,i,o,a]);return(0,j.jsx)(ps.Provider,{value:g,children:t})}function pl(){let e=eg.useContext(ps);if(!e)throw Error("useTools must be used within a ToolProvider");return e}function pd(e){return e.filter(e=>null!=e&&!1!==e)}function pc(e,...t){let n=pd(t);return 0===n.length?null:{id:e,type:"group",checkbox:n.every(e=>"item"===e.type&&e.actionItem.checkbox),disabled:n.every(e=>e.disabled),readonlyOk:n.some(e=>e.readonlyOk),children:n}}function pu(e,t,...n){let r=pd(n);return 0===r.length?null:{id:e,type:"submenu",label:t,children:r,disabled:r.every(e=>e.disabled),readonlyOk:r.some(e=>e.readonlyOk)}}function ph(e,t={}){let{readonlyOk:n=!0,disabled:r=!1}=t;return{id:e,type:"custom",disabled:r,readonlyOk:n}}function pp(e,t={}){if(!e)throw Error("No action item provided to menuItem");if(!e.label)throw Error("Trying to create menu item for action item that doesn't have a label");let{checked:n=!1,disabled:r=!1}=t;return{id:e.id,type:"item",actionItem:e,disabled:r,checked:n,readonlyOk:e.readonlyOk}}let pg=()=>{let e=rR();return e_("threeStackableItems",()=>(function(e){return e.getSelectedShapeIds().map(t=>e.getShape(t)).filter(t=>!(!t||e.isShapeOfType(t,"arrow")&&"binding"===t.props.start.type||e.isShapeOfType(t,"arrow")&&"binding"===t.props.end.type))})(e).length>2,[e])},pf=()=>{let e=rR();return e_("allowGroup",()=>(function(e){let t=e.getSelectedShapes(),n=[],r=new Map;t.forEach(e=>{"arrow"===e.type?n.push(e):r.set(e.id,e)});let i=n.filter(e=>!!(("binding"!==e.props.start.type||r.has(e.props.start.boundShapeId))&&("binding"!==e.props.end.type||r.has(e.props.end.boundShapeId))));return Array.from(r.values()).concat(i)})(e).length>1,[e])},pm=()=>{let e=rR();return e_("allowUngroup",()=>e.getSelectedShapeIds().some(t=>e.getShape(t)?.type==="group"),[e])},py="undefined"!=typeof window&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read,pb=[0,390,428,468,580,640,840,1023],pv=eg.createContext(0);function px({forceMobile:e=!1,children:t}){let n=rR(),r=e_("breakpoint",()=>{let{width:t}=n.getViewportScreenBounds(),r=e?3:pb.length-1;for(let e=0;e<r;e++)if(t>pb[e]&&t<=pb[e+1])return e;return r},[n]);return(0,j.jsx)(pv.Provider,{value:r,children:t})}function pS(){return(0,eg.useContext)(pv)}function pw(){let e=rR();return e_("hasLinkShapeSelected",()=>{let t=e.getSelectedShapes();return 1===t.length&&"url"in t[0].props&&"embed"!==t[0].type},[e])}let pC=eg.createContext({}),p_=({overrides:e,children:t})=>{let n=rR(),r=pl(),i=e_("selected count",()=>n.getSelectedShapeIds().length,[n]),o=i>0,s=i>1,a=i>2,l=pg(),d=pf(),c=pm(),u=pw(),h=pS(),p=e_("zoom is 1",()=>1===n.getZoomLevel(),[n]),g=(0,eg.useMemo)(()=>{let t=[pp(r["align-left"],{disabled:!s}),pp(r["align-center-horizontal"],{disabled:!s}),pp(r["align-right"],{disabled:!s}),pp(r["stretch-horizontal"],{disabled:!s}),pp(r["align-top"],{disabled:!s}),pp(r["align-center-vertical"],{disabled:!s}),pp(r["align-bottom"],{disabled:!s}),pp(r["stretch-vertical"],{disabled:!s}),pp(r["distribute-horizontal"],{disabled:!a}),pp(r["distribute-vertical"],{disabled:!a}),pp(r["stack-horizontal"],{disabled:!l}),pp(r["stack-vertical"],{disabled:!l}),pp(r["send-to-back"],{disabled:!o}),pp(r["send-backward"],{disabled:!o}),pp(r["bring-forward"],{disabled:!o}),pp(r["bring-to-front"],{disabled:!o}),h<5?pp(r["zoom-to-100"],{disabled:!!p}):pp(r["rotate-ccw"],{disabled:!o}),pp(r["rotate-cw"],{disabled:!o}),pp(r["edit-link"],{disabled:!u}),d?pp(r.group,{disabled:!s}):c?pp(r.ungroup):pp(r.group,{disabled:!s})];return e?e(n,t,{actions:r,oneSelected:o,twoSelected:s,threeSelected:a}):t},[n,p,d,e,r,o,s,a,l,c,u,h]);return(0,j.jsx)(pC.Provider,{value:g,children:t})};function pk(){let e=rR();return e_("showAutoSizeToggle",()=>{let t=e.getSelectedShapes();return 1===t.length&&e.isShapeOfType(t[0],"text")&&!1===t[0].props.autoSize},[e])}let pP=eg.createContext({}),pI=eS(function({overrides:e,children:t}){let n=rR(),r=pl(),i=pk(),o=function(){let e=rR();return e_("onlyFlippableShape",()=>{let t=e.getSelectedShapes();return 1===t.length&&t.every(t=>e.isShapeOfType(t,"group")||e.isShapeOfType(t,"arrow")||e.isShapeOfType(t,"line")||e.isShapeOfType(t,"draw"))},[e])}(),s=n.getSelectedShapes(),a=s.length,l=a>0,d=a>1,c=a>2,u=pg(),h=e_("atLeastOneShapeOnPage",()=>n.getCurrentPageShapeIds().size>0,[]),p=e_("isTransparentBg",()=>n.getInstanceState().exportBackground,[]),g=pf(),f=pm(),m=!!window.navigator.clipboard?.write,y=pw(),b=n.getOnlySelectedShape(),v=l&&s.every(e=>n.isShapeOfType(e,"frame")),x=b&&n.isShapeOfType(b,"frame")&&n.getSortedChildIdsForParent(b).length>0,S=b&&n.isShapeOrAncestorLocked(b),w=(0,eg.useMemo)(()=>pd([pc("selection",i&&pp(r["toggle-auto-size"]),y&&!S&&pp(r["edit-link"]),l&&!S&&pp(r.duplicate),g&&!S&&pp(r.group),f&&!S&&pp(r.ungroup),v&&!S&&pp(r["remove-frame"]),x&&!S&&pp(r["fit-frame-to-content"]),l&&pp(r["toggle-lock"])),pc("modify",(d||o)&&pu("arrange","context-menu.arrange",d&&pc("align",pp(r["align-left"]),pp(r["align-center-horizontal"]),pp(r["align-right"]),pp(r["align-top"]),pp(r["align-center-vertical"]),pp(r["align-bottom"])),c&&pc("distribute",pp(r["distribute-horizontal"]),pp(r["distribute-vertical"])),d&&pc("stretch",pp(r["stretch-horizontal"]),pp(r["stretch-vertical"])),o&&!S&&pc("flip",pp(r["flip-horizontal"]),pp(r["flip-vertical"])),d&&pc("order",pp(r.pack,{disabled:!d}),u&&pp(r["stack-vertical"]),u&&pp(r["stack-horizontal"]))),l&&!S&&pu("reorder","context-menu.reorder",pc("reorder",pp(r["bring-to-front"]),pp(r["bring-forward"]),pp(r["send-backward"]),pp(r["send-to-back"]))),l&&!S&&ph("MOVE_TO_PAGE_MENU",{readonlyOk:!1})),pc("clipboard-group",l&&!S&&pp(r.cut),l&&pp(r.copy),py&&pp(r.paste)),h&&pc("conversions",pu("copy-as","context-menu.copy-as",pc("copy-as-group",pp(r["copy-as-svg"]),m&&pp(r["copy-as-png"]),pp(r["copy-as-json"])),pc("export-bg",pp(r["toggle-transparent"],{checked:!p}))),pu("export-as","context-menu.export-as",pc("export-as-group",pp(r["export-as-svg"]),pp(r["export-as-png"]),pp(r["export-as-json"])),pc("export-bg,",pp(r["toggle-transparent"],{checked:!p})))),h&&pc("set-selection-group",pp(r["select-all"]),l&&pp(r["select-none"])),l&&!S&&pc("delete-group",pp(r.delete))]),[r,l,d,c,i,o,h,u,g,f,v,x,m,y,p,S]),C=e_("overrides",()=>e?e(n,w,{actions:r,oneSelected:l,twoSelected:d,threeSelected:c,showAutoSizeToggle:i,showUngroup:f,onlyFlippableShapeSelected:o}):w,[r,f,w,n,l,o,e,i,c,d]);return(0,j.jsx)(pP.Provider,{value:C,children:t})}),pE=eg.createContext({});function pj({overrides:e,children:t}){let n=rR(),r=hB(),{addDialog:i}=pn(),o=po(),s=eg.useMemo(()=>{let t=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(e){n.setCurrentTool("select"),r("select-tool",{source:e,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(e){n.setCurrentTool("hand"),r("select-tool",{source:e,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",readonlyOk:!1,onSelect(e){n.setCurrentTool("eraser"),r("select-tool",{source:e,id:"eraser"})}},{id:"draw",label:"tool.draw",readonlyOk:!1,icon:"tool-pencil",kbd:"d,b,x",onSelect(e){n.setCurrentTool("draw"),r("select-tool",{source:e,id:"draw"})}},...[...rn.values].map(e=>({id:e,label:`tool.${e}`,readonlyOk:!1,meta:{geo:e},kbd:"rectangle"===e?"r":"ellipse"===e?"o":void 0,icon:"geo-"+e,onSelect(t){n.batch(()=>{n.updateInstanceState({stylesForNextShape:{...n.getInstanceState().stylesForNextShape,[rn.id]:e}},{ephemeral:!0}),n.setCurrentTool("geo"),r("select-tool",{source:t,id:`geo-${e}`})})}})),{id:"arrow",label:"tool.arrow",readonlyOk:!1,icon:"tool-arrow",kbd:"a",onSelect(e){n.setCurrentTool("arrow"),r("select-tool",{source:e,id:"arrow"})}},{id:"line",label:"tool.line",readonlyOk:!1,icon:"tool-line",kbd:"l",onSelect(e){n.setCurrentTool("line"),r("select-tool",{source:e,id:"line"})}},{id:"frame",label:"tool.frame",readonlyOk:!1,icon:"tool-frame",kbd:"f",onSelect(e){n.setCurrentTool("frame"),r("select-tool",{source:e,id:"frame"})}},{id:"text",label:"tool.text",readonlyOk:!1,icon:"tool-text",kbd:"t",onSelect(e){n.setCurrentTool("text"),r("select-tool",{source:e,id:"text"})}},{id:"asset",label:"tool.asset",readonlyOk:!1,icon:"tool-media",kbd:"$u",onSelect(e){o(),r("select-tool",{source:e,id:"media"})}},{id:"note",label:"tool.note",readonlyOk:!1,icon:"tool-note",kbd:"n",onSelect(e){n.setCurrentTool("note"),r("select-tool",{source:e,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(e){n.setCurrentTool("laser"),r("select-tool",{source:e,id:"laser"})}},{id:"embed",label:"tool.embed",readonlyOk:!1,icon:"tool-embed",onSelect(e){i({component:hw}),r("select-tool",{source:e,id:"embed"})}}];t.push({id:"highlight",label:"tool.highlight",readonlyOk:!1,icon:"tool-highlight",kbd:"!d",onSelect(e){n.setCurrentTool("highlight"),r("select-tool",{source:e,id:"highlight"})}});let s=Object.fromEntries(t.map(e=>[e.id,e]));return e?e(n,s,{insertMedia:o}):s},[e,n,r,o,i]);return(0,j.jsx)(pE.Provider,{value:s,children:t})}function pM(){let e=eg.useContext(pE);if(!e)throw Error("useTools must be used within a ToolProvider");return e}let pT=eg.createContext({}),pA=eS(function({overrides:e,children:t}){let n=rR(),r=pM(),i=pl(),o=(0,eg.useMemo)(()=>{let t=eI([pc("shortcuts-dialog.tools",pp(i["toggle-tool-lock"]),pp(r.select),pp(r.draw),pp(r.eraser),pp(r.hand),pp(r.rectangle),pp(r.ellipse),pp(r.arrow),pp(r.line),pp(r.text),pp(r.frame),pp(r.note),pp(r.laser)),pc("shortcuts-dialog.file",pp(i["insert-media"]),pp(i.print)),pc("shortcuts-dialog.preferences",pp(i["toggle-dark-mode"]),pp(i["toggle-focus-mode"]),pp(i["toggle-grid"])),pc("shortcuts-dialog.edit",pp(i.undo),pp(i.redo),pp(i.cut),pp(i.copy),pp(i.paste),pp(i["select-all"]),pp(i.delete),pp(i.duplicate),pp(i["export-as-svg"]),pp(i["export-as-png"])),pc("shortcuts-dialog.view",pp(i["zoom-in"]),pp(i["zoom-out"]),pp(i["zoom-to-100"]),pp(i["zoom-to-fit"]),pp(i["zoom-to-selection"])),pc("shortcuts-dialog.transform",pp(i["bring-to-front"]),pp(i["bring-forward"]),pp(i["send-backward"]),pp(i["send-to-back"]),pp(i.group),pp(i.ungroup),pp(i["flip-horizontal"]),pp(i["flip-vertical"]),pp(i["align-top"]),pp(i["align-center-vertical"]),pp(i["align-bottom"]),pp(i["align-left"]),pp(i["align-center-horizontal"]),pp(i["align-right"]))]);return e?e(n,t,{tools:r,actions:i}):t},[n,e,i,r]);return(0,j.jsx)(pT.Provider,{value:o,children:t})}),pO=()=>{let e=cJ(),t=lY(),n=function(){let e=eg.useContext(pT);if(!e)throw Error("Shortcuts must be used inside of a ShortcutsProvider.");return e}();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(hp,{className:"tlui-shortcuts-dialog__header",children:[(0,j.jsx)(hg,{children:e("shortcuts-dialog.title")}),(0,j.jsx)(hf,{})]}),(0,j.jsx)(hm,{className:"tlui-shortcuts-dialog__body",children:n.map(function n(r){if(!r||t&&!r.readonlyOk)return null;switch(r.type){case"group":return(0,j.jsxs)("div",{className:"tlui-shortcuts-dialog__group",children:[(0,j.jsx)("h2",{className:"tlui-shortcuts-dialog__group__title",children:e(r.id)}),(0,j.jsx)("div",{className:"tlui-shortcuts-dialog__group__content",children:r.children.filter(e=>e&&"item"===e.type&&e.actionItem.kbd).map(n)})]},r.id);case"item":{let{id:t,label:n,shortcutsLabel:i,kbd:o}=r.actionItem;return(0,j.jsxs)("div",{className:"tlui-shortcuts-dialog__key-pair",children:[(0,j.jsx)("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:e(i??n)}),(0,j.jsx)("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:(0,j.jsx)(c4,{children:o})})]},t)}}})}),(0,j.jsx)("div",{className:"tlui-dialog__scrim"})]})};function pR(){return{languages:rg,currentLanguage:rR().user.getLocale()}}let pL=eg.createContext({}),pD=eS(function({overrides:e,children:t}){let n=rR(),r=pl(),i=n.getSelectedShapeIds().length,o=i>0,s=i>1,a=i>2,{languages:l,currentLanguage:d}=pR(),{addDialog:c}=pn(),u=(0,eg.useMemo)(()=>{let t=eI([pc("top",ph("LANGUAGE_MENU",{readonlyOk:!0}),pp({id:"keyboard-shortcuts",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect(){c({component:pO})}}))]);return e?e(n,t,{actions:r,currentLanguage:d,languages:l,oneSelected:o,twoSelected:s,threeSelected:a}):t},[n,e,l,r,o,s,a,d,c]);return(0,j.jsx)(pL.Provider,{value:u,children:t})});function pz(){let e=rR();return e_("useCanRedo",()=>e.getCanRedo(),[e])}function pN(){let e=rR();return e_("useCanUndo",()=>e.getCanUndo(),[e])}let p$=eg.createContext({});function pF({overrides:e,children:t}){let n=rR(),r=pl(),i=5>pS(),o=e_("isDarkMode",()=>n.user.getIsDarkMode(),[n]),s=e_("animationSpeed",()=>n.user.getAnimationSpeed(),[n]),a=e_("edgeScrollSpeed",()=>n.user.getEdgeScrollSpeed(),[n]),l=e_("isGridMode",()=>n.getInstanceState().isGridMode,[n]),d=e_("isSnapMode",()=>n.user.getIsSnapMode(),[n]),c=e_("isToolLock",()=>n.getInstanceState().isToolLocked,[n]),u=e_("isFocusMode",()=>n.getInstanceState().isFocusMode,[n]),h=e_("isDebugMode",()=>n.getInstanceState().isDebugMode,[n]),p=e_("exportBackground",()=>n.getInstanceState().exportBackground,[n]),g=e_("emptyPage",()=>0===n.getCurrentPageShapeIds().size,[n]),f=e_("selectedCount",()=>n.getSelectedShapeIds().length,[n]),m=0===f,y=f>0,b=f>1,v=f>2,x=!!window.navigator.clipboard?.write,S=pw(),w=pk(),C=pf(),_=pm(),k=pN(),P=pz(),I=e_("isZoomedTo100",()=>1===n.getZoomLevel(),[n]),E=e_("oneEmbedSelected",()=>{let e=n.getOnlySelectedShape();return!!e&&!!(n.isShapeOfType(e,"embed")&&e.props.url&&!n.isShapeOrAncestorLocked(e))},[]),M=e_("oneEmbeddableBookmarkSelected",()=>{let e=n.getOnlySelectedShape();return!!e&&!!(n.isShapeOfType(e,"bookmark")&&e.props.url&&du(e.props.url)&&!n.isShapeOrAncestorLocked(e))},[]),T=(0,eg.useMemo)(()=>{let t=pd([pc("menu",pu("file","menu.file",pc("print",pp(r.print,{disabled:g}))),pu("edit","menu.edit",pc("undo-actions",pp(r.undo,{disabled:!k}),pp(r.redo,{disabled:!P})),pc("clipboard-actions",pp(r.cut,{disabled:m}),pp(r.copy,{disabled:m}),pp(r.paste,{disabled:!py})),pc("conversions",pu("copy-as","menu.copy-as",pc("copy-as-group",pp(r["copy-as-svg"],{disabled:g}),pp(r["copy-as-png"],{disabled:g||!x}),pp(r["copy-as-json"],{disabled:g})),pc("export-bg",pp(r["toggle-transparent"],{checked:!p}))),pu("export-as","menu.export-as",pc("export-as-group",pp(r["export-as-svg"],{disabled:g}),pp(r["export-as-png"],{disabled:g}),pp(r["export-as-json"],{disabled:g})),pc("export-bg",pp(r["toggle-transparent"],{checked:!p})))),pc("set-selection-group",pp(r["select-all"],{disabled:g}),pp(r["select-none"],{disabled:!y})),pc("selection",w&&pp(r["toggle-auto-size"]),S&&pp(r["edit-link"]),pp(r.duplicate,{disabled:!y}),C&&pp(r.group),_&&pp(r.ungroup),pp(r["unlock-all"],{disabled:g})),pc("delete-group",pp(r.delete,{disabled:!y})),pc("embeds",E&&pp(r["open-embed-link"]),E&&pp(r["convert-to-bookmark"]),M&&pp(r["convert-to-embed"]))),pu("view","menu.view",pc("view-actions",pp(r["zoom-in"]),pp(r["zoom-out"]),pp(r["zoom-to-100"],{disabled:I}),pp(r["zoom-to-fit"],{disabled:g}),pp(r["zoom-to-selection"],{disabled:g||!y})))),pc("extras",pp(r["insert-embed"]),pp(r["insert-media"])),pc("preferences",pu("preferences","menu.preferences",pc("preferences-actions",pp(r["toggle-snap-mode"],{checked:d}),pp(r["toggle-tool-lock"],{checked:c}),pp(r["toggle-grid"],{checked:l}),pp(r["toggle-dark-mode"],{checked:o}),pp(r["toggle-focus-mode"],{checked:u}),pp(r["toggle-edge-scrolling"],{checked:1===a}),pp(r["toggle-reduce-motion"],{checked:0===s}),pp(r["toggle-debug-mode"],{checked:h}))),i&&ph("LANGUAGE_MENU",{readonlyOk:!0}))]);return e?e(n,t,{actions:r,noneSelected:m,oneSelected:y,twoSelected:b,threeSelected:v}):t},[n,e,r,y,b,v,g,i,C,_,S,x,w,m,k,P,s,o,l,d,c,u,p,h,a,I,M,E]);return(0,j.jsx)(p$.Provider,{value:T,children:t})}function pB(e){return{id:e.id,type:"item",readonlyOk:e.readonlyOk,toolItem:e}}let pV=eg.createContext([]);function pU({overrides:e,children:t}){let n=rR(),r=pM(),i=eg.useMemo(()=>{let t=eI([pB(r.select),pB(r.hand),pB(r.draw),pB(r.eraser),pB(r.arrow),pB(r.text),pB(r.note),pB(r.asset),pB(r.rectangle),pB(r.ellipse),pB(r.diamond),pB(r.triangle),pB(r.trapezoid),pB(r.rhombus),pB(r.hexagon),pB(r.cloud),pB(r.star),pB(r.oval),pB(r["x-box"]),pB(r["check-box"]),pB(r["arrow-left"]),pB(r["arrow-up"]),pB(r["arrow-down"]),pB(r["arrow-right"]),pB(r.line),pB(r.highlight),pB(r.frame),pB(r.laser)]);return e?e(n,t,{tools:r}):t},[n,e,r]);return(0,j.jsx)(pV.Provider,{value:i,children:t})}function pK(){let e=eg.useContext(pV);if(!e)throw Error("useToolbarSchema must be used within a ToolbarSchemaProvider");return e}function pH(e){return(0,eg.useMemo)(()=>e,e)}function pY({overrides:e,assetUrls:t,onUiEvent:n,forceMobile:r,children:i}){return(0,j.jsx)(cK,{assetUrls:t?{fonts:Object.assign({...cV.fonts},{...t?.fonts}),icons:Object.assign({...cV.icons},{...t?.icons}),embedIcons:Object.assign({...cV.embedIcons},{...t?.embedIcons}),translations:Object.assign({...cV.translations},{...t?.translations})}:cV,children:(0,j.jsx)(cZ,{overrides:function(e){let t=pH(null==e?[]:Array.isArray(e)?e:[e]);return(0,eg.useMemo)(()=>{let e={};for(let n of t)if(n.translations)for(let[t,r]of eY(n.translations)){let n=e[t];n||(n=e[t]={}),Object.assign(n,r)}return e},[t])}(e),children:(0,j.jsx)(hF,{onEvent:n,children:(0,j.jsx)(h9,{children:(0,j.jsx)(pt,{children:(0,j.jsx)(px,{forceMobile:r,children:(0,j.jsx)(pW,{overrides:e,children:i})})})})})})})}function pW({overrides:e,children:t}){let n=function(e){let t=function(){let{addToast:e,removeToast:t,clearToasts:n}=h7(),{addDialog:r,clearDialogs:i,removeDialog:o,updateDialog:s}=pn(),a=5>pS(),l=cJ();return(0,eg.useMemo)(()=>({addToast:e,removeToast:t,clearToasts:n,addDialog:r,clearDialogs:i,removeDialog:o,updateDialog:s,msg:l,isMobile:a}),[r,e,i,n,l,o,t,s,a])}(),n=pH(null==e?[]:Array.isArray(e)?e:[e]);return(0,eg.useMemo)(()=>(function(e,t){let n={};for(let t of e)if(t.translations)for(let[e,r]of eY(t.translations)){let t=n[e];t||(t=n[e]={}),Object.assign(t,r)}return{actionsMenu:(n,r,i)=>{for(let o of e)o.actionsMenu&&(r=o.actionsMenu(n,r,{...t,...i}));return r},actions:(n,r)=>{for(let i of e)i.actions&&(r=i.actions(n,r,t));return r},contextMenu:(n,r,i)=>{for(let o of e)o.contextMenu&&(r=o.contextMenu(n,r,{...t,...i}));return r},helpMenu:(n,r,i)=>{for(let o of e)o.helpMenu&&(r=o.helpMenu(n,r,{...t,...i}));return r},menu:(n,r,i)=>{for(let o of e)o.menu&&(r=o.menu(n,r,{...t,...i}));return r},toolbar:(n,r,i)=>{for(let o of e)o.toolbar&&(r=o.toolbar(n,r,{...t,...i}));return r},keyboardShortcutsMenu:(n,r,i)=>{for(let o of e)o.keyboardShortcutsMenu&&(r=o.keyboardShortcutsMenu(n,r,{...t,...i}));return r},tools:(n,r,i)=>{for(let o of e)o.tools&&(r=o.tools(n,r,{...t,...i}));return r},translations:n}})(n,t),[n,t])}(e);return(0,j.jsx)(pa,{overrides:n.actions,children:(0,j.jsx)(pj,{overrides:n.tools,children:(0,j.jsx)(pU,{overrides:n.toolbar,children:(0,j.jsx)(p_,{overrides:n.actionsMenu,children:(0,j.jsx)(pA,{overrides:n.keyboardShortcutsMenu,children:(0,j.jsx)(pI,{overrides:n.contextMenu,children:(0,j.jsx)(pD,{overrides:n.helpMenu,children:(0,j.jsx)(pF,{overrides:n.menu,children:t})})})})})})})})}function pX(){let e=rR(),t=pl()["back-to-content"],[n,r]=(0,eg.useState)(!1);return((0,eg.useEffect)(()=>{let t=!1,n=setInterval(()=>{let n=e.getRenderingShapes(),i=e.getRenderingBounds(),o=0===n.filter(e=>e.maskedPageBounds&&i.includes(e.maskedPageBounds)).length&&e.getCurrentPageShapes().length>0;t!==o&&(r(o),t=o)},1e3);return()=>{clearInterval(n)}},[e]),n)?(0,j.jsx)(c6,{iconLeft:t.icon,label:t.label,type:"low",onClick:()=>{t.onSelect("helper-buttons"),r(!1)}}):null}let pG=(0,eg.createContext)(void 0);function pq(e){let t=(0,eg.useContext)(pG);return e||t||"ltr"}let pZ=["top","right","bottom","left"],pJ=Math.min,pQ=Math.max,p0=Math.round,p1=Math.floor,p2=e=>({x:e,y:e}),p5={left:"right",right:"left",bottom:"top",top:"bottom"},p3={start:"end",end:"start"};function p4(e,t){return"function"==typeof e?e(t):e}function p6(e){return e.split("-")[0]}function p8(e){return e.split("-")[1]}function p9(e){return"x"===e?"y":"x"}function p7(e){return"y"===e?"height":"width"}function ge(e){return["top","bottom"].includes(p6(e))?"y":"x"}function gt(e){return e.replace(/start|end/g,e=>p3[e])}function gn(e){return e.replace(/left|right|bottom|top/g,e=>p5[e])}function gr(e){return"number"!=typeof e?{top:0,right:0,bottom:0,left:0,...e}:{top:e,right:e,bottom:e,left:e}}function gi(e){return{...e,top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}function go(e,t,n){let r,{reference:i,floating:o}=e,s=ge(t),a=p9(ge(t)),l=p7(a),d=p6(t),c="y"===s,u=i.x+i.width/2-o.width/2,h=i.y+i.height/2-o.height/2,p=i[l]/2-o[l]/2;switch(d){case"top":r={x:u,y:i.y-o.height};break;case"bottom":r={x:u,y:i.y+i.height};break;case"right":r={x:i.x+i.width,y:h};break;case"left":r={x:i.x-o.width,y:h};break;default:r={x:i.x,y:i.y}}switch(p8(t)){case"start":r[a]-=p*(n&&c?-1:1);break;case"end":r[a]+=p*(n&&c?-1:1)}return r}let gs=async(e,t,n)=>{let{placement:r="bottom",strategy:i="absolute",middleware:o=[],platform:s}=n,a=o.filter(Boolean),l=await (null==s.isRTL?void 0:s.isRTL(t)),d=await s.getElementRects({reference:e,floating:t,strategy:i}),{x:c,y:u}=go(d,r,l),h=r,p={},g=0;for(let n=0;n<a.length;n++){let{name:o,fn:f}=a[n],{x:m,y:y,data:b,reset:v}=await f({x:c,y:u,initialPlacement:r,placement:h,strategy:i,middlewareData:p,rects:d,platform:s,elements:{reference:e,floating:t}});if(c=null!=m?m:c,u=null!=y?y:u,p={...p,[o]:{...p[o],...b}},v&&g<=50){g++,"object"==typeof v&&(v.placement&&(h=v.placement),v.rects&&(d=!0===v.rects?await s.getElementRects({reference:e,floating:t,strategy:i}):v.rects),{x:c,y:u}=go(d,h,l)),n=-1;continue}}return{x:c,y:u,placement:h,strategy:i,middlewareData:p}};async function ga(e,t){var n;void 0===t&&(t={});let{x:r,y:i,platform:o,rects:s,elements:a,strategy:l}=e,{boundary:d="clippingAncestors",rootBoundary:c="viewport",elementContext:u="floating",altBoundary:h=!1,padding:p=0}=p4(t,e),g=gr(p),f=a[h?"floating"===u?"reference":"floating":u],m=gi(await o.getClippingRect({element:null==(n=await (null==o.isElement?void 0:o.isElement(f)))||n?f:f.contextElement||await (null==o.getDocumentElement?void 0:o.getDocumentElement(a.floating)),boundary:d,rootBoundary:c,strategy:l})),y="floating"===u?{...s.floating,x:r,y:i}:s.reference,b=await (null==o.getOffsetParent?void 0:o.getOffsetParent(a.floating)),v=await (null==o.isElement?void 0:o.isElement(b))&&await (null==o.getScale?void 0:o.getScale(b))||{x:1,y:1},x=gi(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({rect:y,offsetParent:b,strategy:l}):y);return{top:(m.top-x.top+g.top)/v.y,bottom:(x.bottom-m.bottom+g.bottom)/v.y,left:(m.left-x.left+g.left)/v.x,right:(x.right-m.right+g.right)/v.x}}let gl=e=>({name:"arrow",options:e,async fn(t){let{x:n,y:r,placement:i,rects:o,platform:s,elements:a,middlewareData:l}=t,{element:d,padding:c=0}=p4(e,t)||{};if(null==d)return{};let u=gr(c),h={x:n,y:r},p=p9(ge(i)),g=p7(p),f=await s.getDimensions(d),m="y"===p,y=m?"clientHeight":"clientWidth",b=o.reference[g]+o.reference[p]-h[p]-o.floating[g],v=h[p]-o.reference[p],x=await (null==s.getOffsetParent?void 0:s.getOffsetParent(d)),S=x?x[y]:0;S&&await (null==s.isElement?void 0:s.isElement(x))||(S=a.floating[y]||o.floating[g]);let w=S/2-f[g]/2-1,C=pJ(u[m?"top":"left"],w),_=pJ(u[m?"bottom":"right"],w),k=S-f[g]-_,P=S/2-f[g]/2+(b/2-v/2),I=pQ(C,pJ(P,k)),E=!l.arrow&&null!=p8(i)&&P!=I&&o.reference[g]/2-(P<C?C:_)-f[g]/2<0,j=E?P<C?P-C:P-k:0;return{[p]:h[p]+j,data:{[p]:I,centerOffset:P-I-j,...E&&{alignmentOffset:j}},reset:E}}});function gd(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function gc(e){return pZ.some(t=>e[t]>=0)}async function gu(e,t){let{placement:n,platform:r,elements:i}=e,o=await (null==r.isRTL?void 0:r.isRTL(i.floating)),s=p6(n),a=p8(n),l="y"===ge(n),d=["left","top"].includes(s)?-1:1,c=o&&l?-1:1,u=p4(t,e),{mainAxis:h,crossAxis:p,alignmentAxis:g}="number"==typeof u?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...u};return a&&"number"==typeof g&&(p="end"===a?-1*g:g),l?{x:p*c,y:h*d}:{x:h*d,y:p*c}}function gh(e){return gf(e)?(e.nodeName||"").toLowerCase():"#document"}function gp(e){var t;return(null==e?void 0:null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function gg(e){var t;return null==(t=(gf(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function gf(e){return e instanceof Node||e instanceof gp(e).Node}function gm(e){return e instanceof Element||e instanceof gp(e).Element}function gy(e){return e instanceof HTMLElement||e instanceof gp(e).HTMLElement}function gb(e){return"undefined"!=typeof ShadowRoot&&(e instanceof ShadowRoot||e instanceof gp(e).ShadowRoot)}function gv(e){let{overflow:t,overflowX:n,overflowY:r,display:i}=gC(e);return/auto|scroll|overlay|hidden|clip/.test(t+r+n)&&!["inline","contents"].includes(i)}function gx(e){let t=gS(),n=gC(e);return"none"!==n.transform||"none"!==n.perspective||!!n.containerType&&"normal"!==n.containerType||!t&&!!n.backdropFilter&&"none"!==n.backdropFilter||!t&&!!n.filter&&"none"!==n.filter||["transform","perspective","filter"].some(e=>(n.willChange||"").includes(e))||["paint","layout","strict","content"].some(e=>(n.contain||"").includes(e))}function gS(){return"undefined"!=typeof CSS&&!!CSS.supports&&CSS.supports("-webkit-backdrop-filter","none")}function gw(e){return["html","body","#document"].includes(gh(e))}function gC(e){return gp(e).getComputedStyle(e)}function g_(e){return gm(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function gk(e){if("html"===gh(e))return e;let t=e.assignedSlot||e.parentNode||gb(e)&&e.host||gg(e);return gb(t)?t.host:t}function gP(e,t,n){var r;void 0===t&&(t=[]),void 0===n&&(n=!0);let i=function e(t){let n=gk(t);return gw(n)?t.ownerDocument?t.ownerDocument.body:t.body:gy(n)&&gv(n)?n:e(n)}(e),o=i===(null==(r=e.ownerDocument)?void 0:r.body),s=gp(i);return o?t.concat(s,s.visualViewport||[],gv(i)?i:[],s.frameElement&&n?gP(s.frameElement):[]):t.concat(i,gP(i,[],n))}function gI(e){let t=gC(e),n=parseFloat(t.width)||0,r=parseFloat(t.height)||0,i=gy(e),o=i?e.offsetWidth:n,s=i?e.offsetHeight:r,a=p0(n)!==o||p0(r)!==s;return a&&(n=o,r=s),{width:n,height:r,$:a}}function gE(e){return gm(e)?e:e.contextElement}function gj(e){let t=gE(e);if(!gy(t))return p2(1);let n=t.getBoundingClientRect(),{width:r,height:i,$:o}=gI(t),s=(o?p0(n.width):n.width)/r,a=(o?p0(n.height):n.height)/i;return s&&Number.isFinite(s)||(s=1),a&&Number.isFinite(a)||(a=1),{x:s,y:a}}let gM=p2(0);function gT(e){let t=gp(e);return gS()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:gM}function gA(e,t,n,r){var i;void 0===t&&(t=!1),void 0===n&&(n=!1);let o=e.getBoundingClientRect(),s=gE(e),a=p2(1);t&&(r?gm(r)&&(a=gj(r)):a=gj(e));let l=(void 0===(i=n)&&(i=!1),r&&(!i||r===gp(s))&&i)?gT(s):p2(0),d=(o.left+l.x)/a.x,c=(o.top+l.y)/a.y,u=o.width/a.x,h=o.height/a.y;if(s){let e=gp(s),t=r&&gm(r)?gp(r):r,n=e.frameElement;for(;n&&r&&t!==e;){let e=gj(n),t=n.getBoundingClientRect(),r=gC(n),i=t.left+(n.clientLeft+parseFloat(r.paddingLeft))*e.x,o=t.top+(n.clientTop+parseFloat(r.paddingTop))*e.y;d*=e.x,c*=e.y,u*=e.x,h*=e.y,d+=i,c+=o,n=gp(n).frameElement}}return gi({width:u,height:h,x:d,y:c})}function gO(e){return gA(gg(e)).left+g_(e).scrollLeft}function gR(e,t,n){let r;if("viewport"===t)r=function(e,t){let n=gp(e),r=gg(e),i=n.visualViewport,o=r.clientWidth,s=r.clientHeight,a=0,l=0;if(i){o=i.width,s=i.height;let e=gS();(!e||e&&"fixed"===t)&&(a=i.offsetLeft,l=i.offsetTop)}return{width:o,height:s,x:a,y:l}}(e,n);else if("document"===t)r=function(e){let t=gg(e),n=g_(e),r=e.ownerDocument.body,i=pQ(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),o=pQ(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight),s=-n.scrollLeft+gO(e),a=-n.scrollTop;return"rtl"===gC(r).direction&&(s+=pQ(t.clientWidth,r.clientWidth)-i),{width:i,height:o,x:s,y:a}}(gg(e));else if(gm(t))r=function(e,t){let n=gA(e,!0,"fixed"===t),r=n.top+e.clientTop,i=n.left+e.clientLeft,o=gy(e)?gj(e):p2(1),s=e.clientWidth*o.x;return{width:s,height:e.clientHeight*o.y,x:i*o.x,y:r*o.y}}(t,n);else{let n=gT(e);r={...t,x:t.x-n.x,y:t.y-n.y}}return gi(r)}function gL(e,t){return gy(e)&&"fixed"!==gC(e).position?t?t(e):e.offsetParent:null}function gD(e,t){let n=gp(e);if(!gy(e))return n;let r=gL(e,t);for(;r&&["table","td","th"].includes(gh(r))&&"static"===gC(r).position;)r=gL(r,t);return r&&("html"===gh(r)||"body"===gh(r)&&"static"===gC(r).position&&!gx(r))?n:r||function(e){let t=gk(e);for(;gy(t)&&!gw(t);){if(gx(t))return t;t=gk(t)}return null}(e)||n}let gz=async function(e){let{reference:t,floating:n,strategy:r}=e,i=this.getOffsetParent||gD,o=this.getDimensions;return{reference:function(e,t,n){let r=gy(t),i=gg(t),o="fixed"===n,s=gA(e,!0,o,t),a={scrollLeft:0,scrollTop:0},l=p2(0);if(r||!r&&!o){if(("body"!==gh(t)||gv(i))&&(a=g_(t)),r){let e=gA(t,!0,o,t);l.x=e.x+t.clientLeft,l.y=e.y+t.clientTop}else i&&(l.x=gO(i))}return{x:s.left+a.scrollLeft-l.x,y:s.top+a.scrollTop-l.y,width:s.width,height:s.height}}(t,await i(n),r),floating:{x:0,y:0,...await o(n)}}},gN={convertOffsetParentRelativeRectToViewportRelativeRect:function(e){let{rect:t,offsetParent:n,strategy:r}=e,i=gy(n),o=gg(n);if(n===o)return t;let s={scrollLeft:0,scrollTop:0},a=p2(1),l=p2(0);if((i||!i&&"fixed"!==r)&&(("body"!==gh(n)||gv(o))&&(s=g_(n)),gy(n))){let e=gA(n);a=gj(n),l.x=e.x+n.clientLeft,l.y=e.y+n.clientTop}return{width:t.width*a.x,height:t.height*a.y,x:t.x*a.x-s.scrollLeft*a.x+l.x,y:t.y*a.y-s.scrollTop*a.y+l.y}},getDocumentElement:gg,getClippingRect:function(e){let{element:t,boundary:n,rootBoundary:r,strategy:i}=e,o=[..."clippingAncestors"===n?function(e,t){let n=t.get(e);if(n)return n;let r=gP(e,[],!1).filter(e=>gm(e)&&"body"!==gh(e)),i=null,o="fixed"===gC(e).position,s=o?gk(e):e;for(;gm(s)&&!gw(s);){let t=gC(s),n=gx(s);n||"fixed"!==t.position||(i=null),(o?!n&&!i:!n&&"static"===t.position&&!!i&&["absolute","fixed"].includes(i.position)||gv(s)&&!n&&function e(t,n){let r=gk(t);return!(r===n||!gm(r)||gw(r))&&("fixed"===gC(r).position||e(r,n))}(e,s))?r=r.filter(e=>e!==s):i=t,s=gk(s)}return t.set(e,r),r}(t,this._c):[].concat(n),r],s=o[0],a=o.reduce((e,n)=>{let r=gR(t,n,i);return e.top=pQ(r.top,e.top),e.right=pJ(r.right,e.right),e.bottom=pJ(r.bottom,e.bottom),e.left=pQ(r.left,e.left),e},gR(t,s,i));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}},getOffsetParent:gD,getElementRects:gz,getClientRects:function(e){return Array.from(e.getClientRects())},getDimensions:function(e){return gI(e)},getScale:gj,isElement:gm,isRTL:function(e){return"rtl"===gC(e).direction}},g$=(e,t,n)=>{let r=new Map,i={platform:gN,...n},o={...i.platform,_c:r};return gs(e,t,{...i,platform:o})},gF=e=>({name:"arrow",options:e,fn(t){let{element:n,padding:r}="function"==typeof e?e(t):e;if(n&&({}).hasOwnProperty.call(n,"current")){if(null!=n.current)return gl({element:n.current,padding:r}).fn(t)}else if(n)return gl({element:n,padding:r}).fn(t);return{}}});var gB="undefined"!=typeof document?eg.useLayoutEffect:eg.useEffect;function gV(e,t){let n,r,i;if(e===t)return!0;if(typeof e!=typeof t)return!1;if("function"==typeof e&&e.toString()===t.toString())return!0;if(e&&t&&"object"==typeof e){if(Array.isArray(e)){if((n=e.length)!=t.length)return!1;for(r=n;0!=r--;)if(!gV(e[r],t[r]))return!1;return!0}if((n=(i=Object.keys(e)).length)!==Object.keys(t).length)return!1;for(r=n;0!=r--;)if(!({}).hasOwnProperty.call(t,i[r]))return!1;for(r=n;0!=r--;){let n=i[r];if(("_owner"!==n||!e.$$typeof)&&!gV(e[n],t[n]))return!1}return!0}return e!=e&&t!=t}function gU(e){return"undefined"==typeof window?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function gK(e,t){let n=gU(e);return Math.round(t*n)/n}function gH(e){let t=eg.useRef(e);return gB(()=>{t.current=e}),t}let gY=(0,eg.forwardRef)((e,t)=>{let{children:n,width:r=10,height:i=5,...o}=e;return(0,eg.createElement)(d9.svg,dZ({},o,{ref:t,width:r,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),e.asChild?n:(0,eg.createElement)("polygon",{points:"0,0 30,0 15,10"}))});function gW(e){let[t,n]=(0,eg.useState)(void 0);return cl(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});let t=new ResizeObserver(t=>{let r,i;if(!Array.isArray(t)||!t.length)return;let o=t[0];if("borderBoxSize"in o){let e=o.borderBoxSize,t=Array.isArray(e)?e[0]:e;r=t.inlineSize,i=t.blockSize}else r=e.offsetWidth,i=e.offsetHeight;n({width:r,height:i})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}n(void 0)},[e]),t}let gX="Popper",[gG,gq]=d2(gX),[gZ,gJ]=gG(gX),gQ=(0,eg.forwardRef)((e,t)=>{let{__scopePopper:n,virtualRef:r,...i}=e,o=gJ("PopperAnchor",n),s=(0,eg.useRef)(null),a=d1(t,s);return(0,eg.useEffect)(()=>{o.onAnchorChange((null==r?void 0:r.current)||s.current)}),r?null:(0,eg.createElement)(d9.div,dZ({},i,{ref:a}))}),g0="PopperContent",[g1,g2]=gG(g0),g5=(0,eg.forwardRef)((e,t)=>{var n,r,i,o,s,a,l,d;let{__scopePopper:c,side:u="bottom",sideOffset:h=0,align:p="center",alignOffset:g=0,arrowPadding:f=0,avoidCollisions:m=!0,collisionBoundary:y=[],collisionPadding:b=0,sticky:v="partial",hideWhenDetached:x=!1,updatePositionStrategy:S="optimized",onPlaced:w,...C}=e,_=gJ(g0,c),[k,P]=(0,eg.useState)(null),I=d1(t,e=>P(e)),[E,j]=(0,eg.useState)(null),M=gW(E),T=null!==(n=null==M?void 0:M.width)&&void 0!==n?n:0,A=null!==(r=null==M?void 0:M.height)&&void 0!==r?r:0,O="number"==typeof b?b:{top:0,right:0,bottom:0,left:0,...b},R=Array.isArray(y)?y:[y],L=R.length>0,D={padding:O,boundary:R.filter(g6),altBoundary:L},{refs:z,floatingStyles:N,placement:$,isPositioned:F,middlewareData:B}=function(e){void 0===e&&(e={});let{placement:t="bottom",strategy:n="absolute",middleware:r=[],platform:i,elements:{reference:o,floating:s}={},transform:a=!0,whileElementsMounted:l,open:d}=e,[c,u]=eg.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[h,p]=eg.useState(r);gV(h,r)||p(r);let[g,f]=eg.useState(null),[m,y]=eg.useState(null),b=eg.useCallback(e=>{e!=w.current&&(w.current=e,f(e))},[f]),v=eg.useCallback(e=>{e!==C.current&&(C.current=e,y(e))},[y]),x=o||g,S=s||m,w=eg.useRef(null),C=eg.useRef(null),_=eg.useRef(c),k=gH(l),P=gH(i),I=eg.useCallback(()=>{if(!w.current||!C.current)return;let e={placement:t,strategy:n,middleware:h};P.current&&(e.platform=P.current),g$(w.current,C.current,e).then(e=>{let t={...e,isPositioned:!0};E.current&&!gV(_.current,t)&&(_.current=t,dJ.flushSync(()=>{u(t)}))})},[h,t,n,P]);gB(()=>{!1===d&&_.current.isPositioned&&(_.current.isPositioned=!1,u(e=>({...e,isPositioned:!1})))},[d]);let E=eg.useRef(!1);gB(()=>(E.current=!0,()=>{E.current=!1}),[]),gB(()=>{if(x&&(w.current=x),S&&(C.current=S),x&&S){if(k.current)return k.current(x,S,I);I()}},[x,S,I,k]);let j=eg.useMemo(()=>({reference:w,floating:C,setReference:b,setFloating:v}),[b,v]),M=eg.useMemo(()=>({reference:x,floating:S}),[x,S]),T=eg.useMemo(()=>{let e={position:n,left:0,top:0};if(!M.floating)return e;let t=gK(M.floating,c.x),r=gK(M.floating,c.y);return a?{...e,transform:"translate("+t+"px, "+r+"px)",...gU(M.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:t,top:r}},[n,a,M.floating,c.x,c.y]);return eg.useMemo(()=>({...c,update:I,refs:j,elements:M,floatingStyles:T}),[c,I,j,M,T])}({strategy:"fixed",placement:u+("center"!==p?"-"+p:""),whileElementsMounted:(...e)=>(function(e,t,n,r){let i;void 0===r&&(r={});let{ancestorScroll:o=!0,ancestorResize:s=!0,elementResize:a="function"==typeof ResizeObserver,layoutShift:l="function"==typeof IntersectionObserver,animationFrame:d=!1}=r,c=gE(e),u=o||s?[...c?gP(c):[],...gP(t)]:[];u.forEach(e=>{o&&e.addEventListener("scroll",n,{passive:!0}),s&&e.addEventListener("resize",n)});let h=c&&l?function(e,t){let n,r=null,i=gg(e);function o(){clearTimeout(n),r&&r.disconnect(),r=null}return function s(a,l){void 0===a&&(a=!1),void 0===l&&(l=1),o();let{left:d,top:c,width:u,height:h}=e.getBoundingClientRect();if(a||t(),!u||!h)return;let p=p1(c),g=p1(i.clientWidth-(d+u)),f={rootMargin:-p+"px "+-g+"px "+-p1(i.clientHeight-(c+h))+"px "+-p1(d)+"px",threshold:pQ(0,pJ(1,l))||1},m=!0;function y(e){let t=e[0].intersectionRatio;if(t!==l){if(!m)return s();t?s(!1,t):n=setTimeout(()=>{s(!1,1e-7)},100)}m=!1}try{r=new IntersectionObserver(y,{...f,root:i.ownerDocument})}catch(e){r=new IntersectionObserver(y,f)}r.observe(e)}(!0),o}(c,n):null,p=-1,g=null;a&&(g=new ResizeObserver(e=>{let[r]=e;r&&r.target===c&&g&&(g.unobserve(t),cancelAnimationFrame(p),p=requestAnimationFrame(()=>{g&&g.observe(t)})),n()}),c&&!d&&g.observe(c),g.observe(t));let f=d?gA(e):null;return d&&function t(){let r=gA(e);f&&(r.x!==f.x||r.y!==f.y||r.width!==f.width||r.height!==f.height)&&n(),f=r,i=requestAnimationFrame(t)}(),n(),()=>{u.forEach(e=>{o&&e.removeEventListener("scroll",n),s&&e.removeEventListener("resize",n)}),h&&h(),g&&g.disconnect(),g=null,d&&cancelAnimationFrame(i)}})(...e,{animationFrame:"always"===S}),elements:{reference:_.anchor},middleware:[function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(t){let{x:n,y:r}=t,i=await gu(t,e);return{x:n+i.x,y:r+i.y,data:i}}}}({mainAxis:h+A,alignmentAxis:g}),m&&function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(t){let{x:n,y:r,placement:i}=t,{mainAxis:o=!0,crossAxis:s=!1,limiter:a={fn:e=>{let{x:t,y:n}=e;return{x:t,y:n}}},...l}=p4(e,t),d={x:n,y:r},c=await ga(t,l),u=ge(p6(i)),h=p9(u),p=d[h],g=d[u];if(o){let e="y"===h?"top":"left",t="y"===h?"bottom":"right",n=p+c[e],r=p-c[t];p=pQ(n,pJ(p,r))}if(s){let e="y"===u?"top":"left",t="y"===u?"bottom":"right",n=g+c[e],r=g-c[t];g=pQ(n,pJ(g,r))}let f=a.fn({...t,[h]:p,[u]:g});return{...f,data:{x:f.x-n,y:f.y-r}}}}}({mainAxis:!0,crossAxis:!1,limiter:"partial"===v?function(e){return void 0===e&&(e={}),{options:e,fn(t){let{x:n,y:r,placement:i,rects:o,middlewareData:s}=t,{offset:a=0,mainAxis:l=!0,crossAxis:d=!0}=p4(e,t),c={x:n,y:r},u=ge(i),h=p9(u),p=c[h],g=c[u],f=p4(a,t),m="number"==typeof f?{mainAxis:f,crossAxis:0}:{mainAxis:0,crossAxis:0,...f};if(l){let e="y"===h?"height":"width",t=o.reference[h]-o.floating[e]+m.mainAxis,n=o.reference[h]+o.reference[e]-m.mainAxis;p<t?p=t:p>n&&(p=n)}if(d){var y,b;let e="y"===h?"width":"height",t=["top","left"].includes(p6(i)),n=o.reference[u]-o.floating[e]+(t&&(null==(y=s.offset)?void 0:y[u])||0)+(t?0:m.crossAxis),r=o.reference[u]+o.reference[e]+(t?0:(null==(b=s.offset)?void 0:b[u])||0)-(t?m.crossAxis:0);g<n?g=n:g>r&&(g=r)}return{[h]:p,[u]:g}}}}():void 0,...D}),m&&function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(t){var n,r,i,o,s;let{placement:a,middlewareData:l,rects:d,initialPlacement:c,platform:u,elements:h}=t,{mainAxis:p=!0,crossAxis:g=!0,fallbackPlacements:f,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:b=!0,...v}=p4(e,t);if(null!=(n=l.arrow)&&n.alignmentOffset)return{};let x=p6(a),S=p6(c)===c,w=await (null==u.isRTL?void 0:u.isRTL(h.floating)),C=f||(S||!b?[gn(c)]:function(e){let t=gn(e);return[gt(e),t,gt(t)]}(c));f||"none"===y||C.push(...function(e,t,n,r){let i=p8(e),o=function(e,t,n){let r=["left","right"],i=["right","left"];switch(e){case"top":case"bottom":if(n)return t?i:r;return t?r:i;case"left":case"right":return t?["top","bottom"]:["bottom","top"];default:return[]}}(p6(e),"start"===n,r);return i&&(o=o.map(e=>e+"-"+i),t&&(o=o.concat(o.map(gt)))),o}(c,b,y,w));let _=[c,...C],k=await ga(t,v),P=[],I=(null==(r=l.flip)?void 0:r.overflows)||[];if(p&&P.push(k[x]),g){let e=function(e,t,n){void 0===n&&(n=!1);let r=p8(e),i=p9(ge(e)),o=p7(i),s="x"===i?r===(n?"end":"start")?"right":"left":"start"===r?"bottom":"top";return t.reference[o]>t.floating[o]&&(s=gn(s)),[s,gn(s)]}(a,d,w);P.push(k[e[0]],k[e[1]])}if(I=[...I,{placement:a,overflows:P}],!P.every(e=>e<=0)){let e=((null==(i=l.flip)?void 0:i.index)||0)+1,t=_[e];if(t)return{data:{index:e,overflows:I},reset:{placement:t}};let n=null==(o=I.filter(e=>e.overflows[0]<=0).sort((e,t)=>e.overflows[1]-t.overflows[1])[0])?void 0:o.placement;if(!n)switch(m){case"bestFit":{let e=null==(s=I.map(e=>[e.placement,e.overflows.filter(e=>e>0).reduce((e,t)=>e+t,0)]).sort((e,t)=>e[1]-t[1])[0])?void 0:s[0];e&&(n=e);break}case"initialPlacement":n=c}if(a!==n)return{reset:{placement:n}}}return{}}}}({...D}),function(e){return void 0===e&&(e={}),{name:"size",options:e,async fn(t){let n,r;let{placement:i,rects:o,platform:s,elements:a}=t,{apply:l=()=>{},...d}=p4(e,t),c=await ga(t,d),u=p6(i),h=p8(i),p="y"===ge(i),{width:g,height:f}=o.floating;"top"===u||"bottom"===u?(n=u,r=h===(await (null==s.isRTL?void 0:s.isRTL(a.floating))?"start":"end")?"left":"right"):(r=u,n="end"===h?"top":"bottom");let m=f-c[n],y=g-c[r],b=!t.middlewareData.shift,v=m,x=y;if(p){let e=g-c.left-c.right;x=h||b?pJ(y,e):e}else{let e=f-c.top-c.bottom;v=h||b?pJ(m,e):e}if(b&&!h){let e=pQ(c.left,0),t=pQ(c.right,0),n=pQ(c.top,0),r=pQ(c.bottom,0);p?x=g-2*(0!==e||0!==t?e+t:pQ(c.left,c.right)):v=f-2*(0!==n||0!==r?n+r:pQ(c.top,c.bottom))}await l({...t,availableWidth:x,availableHeight:v});let S=await s.getDimensions(a.floating);return g!==S.width||f!==S.height?{reset:{rects:!0}}:{}}}}({...D,apply:({elements:e,rects:t,availableWidth:n,availableHeight:r})=>{let{width:i,height:o}=t.reference,s=e.floating.style;s.setProperty("--radix-popper-available-width",`${n}px`),s.setProperty("--radix-popper-available-height",`${r}px`),s.setProperty("--radix-popper-anchor-width",`${i}px`),s.setProperty("--radix-popper-anchor-height",`${o}px`)}}),E&&gF({element:E,padding:f}),g8({arrowWidth:T,arrowHeight:A}),x&&function(e){return void 0===e&&(e={}),{name:"hide",options:e,async fn(t){let{rects:n}=t,{strategy:r="referenceHidden",...i}=p4(e,t);switch(r){case"referenceHidden":{let e=gd(await ga(t,{...i,elementContext:"reference"}),n.reference);return{data:{referenceHiddenOffsets:e,referenceHidden:gc(e)}}}case"escaped":{let e=gd(await ga(t,{...i,altBoundary:!0}),n.floating);return{data:{escapedOffsets:e,escaped:gc(e)}}}default:return{}}}}}({strategy:"referenceHidden",...D})]}),[V,U]=g9($),K=ce(w);cl(()=>{F&&(null==K||K())},[F,K]);let H=null===(i=B.arrow)||void 0===i?void 0:i.x,Y=null===(o=B.arrow)||void 0===o?void 0:o.y,W=(null===(s=B.arrow)||void 0===s?void 0:s.centerOffset)!==0,[X,G]=(0,eg.useState)();return cl(()=>{k&&G(window.getComputedStyle(k).zIndex)},[k]),(0,eg.createElement)("div",{ref:z.setFloating,"data-radix-popper-content-wrapper":"",style:{...N,transform:F?N.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:X,"--radix-popper-transform-origin":[null===(a=B.transformOrigin)||void 0===a?void 0:a.x,null===(l=B.transformOrigin)||void 0===l?void 0:l.y].join(" ")},dir:e.dir},(0,eg.createElement)(g1,{scope:c,placedSide:V,onArrowChange:j,arrowX:H,arrowY:Y,shouldHideArrow:W},(0,eg.createElement)(d9.div,dZ({"data-side":V,"data-align":U},C,{ref:I,style:{...C.style,animation:F?void 0:"none",opacity:null!==(d=B.hide)&&void 0!==d&&d.referenceHidden?0:void 0}}))))}),g3={top:"bottom",right:"left",bottom:"top",left:"right"},g4=(0,eg.forwardRef)(function(e,t){let{__scopePopper:n,...r}=e,i=g2("PopperArrow",n),o=g3[i.placedSide];return(0,eg.createElement)("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0}},(0,eg.createElement)(gY,dZ({},r,{ref:t,style:{...r.style,display:"block"}})))});function g6(e){return null!==e}let g8=e=>({name:"transformOrigin",options:e,fn(t){var n,r,i,o,s;let{placement:a,rects:l,middlewareData:d}=t,c=(null===(n=d.arrow)||void 0===n?void 0:n.centerOffset)!==0,u=c?0:e.arrowWidth,h=c?0:e.arrowHeight,[p,g]=g9(a),f={start:"0%",center:"50%",end:"100%"}[g],m=(null!==(r=null===(i=d.arrow)||void 0===i?void 0:i.x)&&void 0!==r?r:0)+u/2,y=(null!==(o=null===(s=d.arrow)||void 0===s?void 0:s.y)&&void 0!==o?o:0)+h/2,b="",v="";return"bottom"===p?(b=c?f:`${m}px`,v=`${-h}px`):"top"===p?(b=c?f:`${m}px`,v=`${l.floating.height+h}px`):"right"===p?(b=`${-h}px`,v=c?f:`${y}px`):"left"===p&&(b=`${l.floating.width+h}px`,v=c?f:`${y}px`),{data:{x:b,y:v}}}});function g9(e){let[t,n="center"]=e.split("-");return[t,n]}let g7=e=>{let{__scopePopper:t,children:n}=e,[r,i]=(0,eg.useState)(null);return(0,eg.createElement)(gZ,{scope:t,anchor:r,onAnchorChange:i},n)},fe="rovingFocusGroup.onEntryFocus",ft={bubbles:!1,cancelable:!0},fn="RovingFocusGroup",[fr,fi,fo]=d8(fn),[fs,fa]=d2(fn,[fo]),[fl,fd]=fs(fn),fc=(0,eg.forwardRef)((e,t)=>(0,eg.createElement)(fr.Provider,{scope:e.__scopeRovingFocusGroup},(0,eg.createElement)(fr.Slot,{scope:e.__scopeRovingFocusGroup},(0,eg.createElement)(fu,dZ({},e,{ref:t}))))),fu=(0,eg.forwardRef)((e,t)=>{let{__scopeRovingFocusGroup:n,orientation:r,loop:i=!1,dir:o,currentTabStopId:s,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:d,...c}=e,u=(0,eg.useRef)(null),h=d1(t,u),p=pq(o),[g=null,f]=cu({prop:s,defaultProp:a,onChange:l}),[m,y]=(0,eg.useState)(!1),b=ce(d),v=fi(n),x=(0,eg.useRef)(!1),[S,w]=(0,eg.useState)(0);return(0,eg.useEffect)(()=>{let e=u.current;if(e)return e.addEventListener(fe,b),()=>e.removeEventListener(fe,b)},[b]),(0,eg.createElement)(fl,{scope:n,orientation:r,dir:p,loop:i,currentTabStopId:g,onItemFocus:(0,eg.useCallback)(e=>f(e),[f]),onItemShiftTab:(0,eg.useCallback)(()=>y(!0),[]),onFocusableItemAdd:(0,eg.useCallback)(()=>w(e=>e+1),[]),onFocusableItemRemove:(0,eg.useCallback)(()=>w(e=>e-1),[])},(0,eg.createElement)(d9.div,dZ({tabIndex:m||0===S?-1:0,"data-orientation":r},c,{ref:h,style:{outline:"none",...e.style},onMouseDown:dQ(e.onMouseDown,()=>{x.current=!0}),onFocus:dQ(e.onFocus,e=>{let t=!x.current;if(e.target===e.currentTarget&&t&&!m){let t=new CustomEvent(fe,ft);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){let e=v().filter(e=>e.focusable);fg([e.find(e=>e.active),e.find(e=>e.id===g),...e].filter(Boolean).map(e=>e.ref.current))}}x.current=!1}),onBlur:dQ(e.onBlur,()=>y(!1))})))}),fh=(0,eg.forwardRef)((e,t)=>{let{__scopeRovingFocusGroup:n,focusable:r=!0,active:i=!1,tabStopId:o,...s}=e,a=c7(),l=o||a,d=fd("RovingFocusGroupItem",n),c=d.currentTabStopId===l,u=fi(n),{onFocusableItemAdd:h,onFocusableItemRemove:p}=d;return(0,eg.useEffect)(()=>{if(r)return h(),()=>p()},[r,h,p]),(0,eg.createElement)(fr.ItemSlot,{scope:n,id:l,focusable:r,active:i},(0,eg.createElement)(d9.span,dZ({tabIndex:c?0:-1,"data-orientation":d.orientation},s,{ref:t,onMouseDown:dQ(e.onMouseDown,e=>{r?d.onItemFocus(l):e.preventDefault()}),onFocus:dQ(e.onFocus,()=>d.onItemFocus(l)),onKeyDown:dQ(e.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey){d.onItemShiftTab();return}if(e.target!==e.currentTarget)return;let t=function(e,t,n){var r;let i=(r=e.key,"rtl"!==n?r:"ArrowLeft"===r?"ArrowRight":"ArrowRight"===r?"ArrowLeft":r);if(!("vertical"===t&&["ArrowLeft","ArrowRight"].includes(i))&&!("horizontal"===t&&["ArrowUp","ArrowDown"].includes(i)))return fp[i]}(e,d.orientation,d.dir);if(void 0!==t){e.preventDefault();let n=u().filter(e=>e.focusable).map(e=>e.ref.current);if("last"===t)n.reverse();else if("prev"===t||"next"===t){"prev"===t&&n.reverse();let r=n.indexOf(e.currentTarget);n=d.loop?function(e,t){return e.map((n,r)=>e[(t+r)%e.length])}(n,r+1):n.slice(r+1)}setTimeout(()=>fg(n))}})})))}),fp={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function fg(e){let t=document.activeElement;for(let n of e)if(n===t||(n.focus(),document.activeElement!==t))return}let ff=["Enter"," "],fm=["ArrowUp","PageDown","End"],fy=["ArrowDown","PageUp","Home",...fm],fb={ltr:[...ff,"ArrowRight"],rtl:[...ff,"ArrowLeft"]},fv={ltr:["ArrowLeft"],rtl:["ArrowRight"]},fx="Menu",[fS,fw,fC]=d8(fx),[f_,fk]=d2(fx,[fC,gq,fa]),fP=gq(),fI=fa(),[fE,fj]=f_(fx),[fM,fT]=f_(fx),fA=(0,eg.forwardRef)((e,t)=>{let{__scopeMenu:n,...r}=e,i=fP(n);return(0,eg.createElement)(gQ,dZ({},i,r,{ref:t}))}),fO="MenuPortal",[fR,fL]=f_(fO,{forceMount:void 0}),fD="MenuContent",[fz,fN]=f_(fD),f$=(0,eg.forwardRef)((e,t)=>{let n=fL(fD,e.__scopeMenu),{forceMount:r=n.forceMount,...i}=e,o=fj(fD,e.__scopeMenu),s=fT(fD,e.__scopeMenu);return(0,eg.createElement)(fS.Provider,{scope:e.__scopeMenu},(0,eg.createElement)(cd,{present:r||o.open},(0,eg.createElement)(fS.Slot,{scope:e.__scopeMenu},s.modal?(0,eg.createElement)(fF,dZ({},i,{ref:t})):(0,eg.createElement)(fB,dZ({},i,{ref:t})))))}),fF=(0,eg.forwardRef)((e,t)=>{let n=fj(fD,e.__scopeMenu),r=(0,eg.useRef)(null),i=d1(t,r);return(0,eg.useEffect)(()=>{let e=r.current;if(e)return uJ(e)},[]),(0,eg.createElement)(fV,dZ({},e,{ref:i,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:dQ(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)}))}),fB=(0,eg.forwardRef)((e,t)=>{let n=fj(fD,e.__scopeMenu);return(0,eg.createElement)(fV,dZ({},e,{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)}))}),fV=(0,eg.forwardRef)((e,t)=>{let{__scopeMenu:n,loop:r=!1,trapFocus:i,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:a,onEntryFocus:l,onEscapeKeyDown:d,onPointerDownOutside:c,onFocusOutside:u,onInteractOutside:h,onDismiss:p,disableOutsideScroll:g,...f}=e,m=fj(fD,n),y=fT(fD,n),b=fP(n),v=fI(n),x=fw(n),[S,w]=(0,eg.useState)(null),C=(0,eg.useRef)(null),_=d1(t,C,m.onContentChange),k=(0,eg.useRef)(0),P=(0,eg.useRef)(""),I=(0,eg.useRef)(0),E=(0,eg.useRef)(null),j=(0,eg.useRef)("right"),M=(0,eg.useRef)(0),T=g?uH:eg.Fragment,A=g?{as:d5,allowPinchZoom:!0}:void 0,O=e=>{var t,n;let r=P.current+e,i=x().filter(e=>!e.disabled),o=document.activeElement,s=null===(t=i.find(e=>e.ref.current===o))||void 0===t?void 0:t.textValue,a=function(e,t,n){var r;let i=t.length>1&&Array.from(t).every(e=>e===t[0])?t[0]:t,o=(r=Math.max(n?e.indexOf(n):-1,0),e.map((t,n)=>e[(r+n)%e.length]));1===i.length&&(o=o.filter(e=>e!==n));let s=o.find(e=>e.toLowerCase().startsWith(i.toLowerCase()));return s!==n?s:void 0}(i.map(e=>e.textValue),r,s),l=null===(n=i.find(e=>e.textValue===a))||void 0===n?void 0:n.ref.current;(function e(t){P.current=t,window.clearTimeout(k.current),""!==t&&(k.current=window.setTimeout(()=>e(""),1e3))})(r),l&&setTimeout(()=>l.focus())};(0,eg.useEffect)(()=>()=>window.clearTimeout(k.current),[]),uc();let R=(0,eg.useCallback)(e=>{var t,n;return j.current===(null===(t=E.current)||void 0===t?void 0:t.side)&&function(e,t){return!!t&&function(e,t){let{x:n,y:r}=e,i=!1;for(let e=0,o=t.length-1;e<t.length;o=e++){let s=t[e].x,a=t[e].y,l=t[o].x,d=t[o].y;a>r!=d>r&&n<(l-s)*(r-a)/(d-a)+s&&(i=!i)}return i}({x:e.clientX,y:e.clientY},t)}(e,null===(n=E.current)||void 0===n?void 0:n.area)},[]);return(0,eg.createElement)(fz,{scope:n,searchRef:P,onItemEnter:(0,eg.useCallback)(e=>{R(e)&&e.preventDefault()},[R]),onItemLeave:(0,eg.useCallback)(e=>{var t;R(e)||(null===(t=C.current)||void 0===t||t.focus(),w(null))},[R]),onTriggerLeave:(0,eg.useCallback)(e=>{R(e)&&e.preventDefault()},[R]),pointerGraceTimerRef:I,onPointerGraceIntentChange:(0,eg.useCallback)(e=>{E.current=e},[])},(0,eg.createElement)(T,A,(0,eg.createElement)(ur,{asChild:!0,trapped:i,onMountAutoFocus:dQ(o,e=>{var t;e.preventDefault(),null===(t=C.current)||void 0===t||t.focus()}),onUnmountAutoFocus:s},(0,eg.createElement)(cr,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:d,onPointerDownOutside:c,onFocusOutside:u,onInteractOutside:h,onDismiss:p},(0,eg.createElement)(fc,dZ({asChild:!0},v,{dir:y.dir,orientation:"vertical",loop:r,currentTabStopId:S,onCurrentTabStopIdChange:w,onEntryFocus:dQ(l,e=>{y.isUsingKeyboardRef.current||e.preventDefault()})}),(0,eg.createElement)(g5,dZ({role:"menu","aria-orientation":"vertical","data-state":f8(m.open),"data-radix-menu-content":"",dir:y.dir},b,f,{ref:_,style:{outline:"none",...f.style},onKeyDown:dQ(f.onKeyDown,e=>{let t=e.target.closest("[data-radix-menu-content]")===e.currentTarget,n=e.ctrlKey||e.altKey||e.metaKey,r=1===e.key.length;t&&("Tab"===e.key&&e.preventDefault(),!n&&r&&O(e.key));let i=C.current;if(e.target!==i||!fy.includes(e.key))return;e.preventDefault();let o=x().filter(e=>!e.disabled).map(e=>e.ref.current);fm.includes(e.key)&&o.reverse(),function(e){let t=document.activeElement;for(let n of e)if(n===t||(n.focus(),document.activeElement!==t))return}(o)}),onBlur:dQ(e.onBlur,e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(k.current),P.current="")}),onPointerMove:dQ(e.onPointerMove,me(e=>{let t=e.target,n=M.current!==e.clientX;if(e.currentTarget.contains(t)&&n){let t=e.clientX>M.current?"right":"left";j.current=t,M.current=e.clientX}}))})))))))}),fU=(0,eg.forwardRef)((e,t)=>{let{__scopeMenu:n,...r}=e;return(0,eg.createElement)(d9.div,dZ({role:"group"},r,{ref:t}))}),fK=((e,t)=>{let{__scopeMenu:n,...r}=e;return(0,eg.createElement)(d9.div,dZ({},r,{ref:t}))},"MenuItem"),fH="menu.itemSelect",fY=(0,eg.forwardRef)((e,t)=>{let{disabled:n=!1,onSelect:r,...i}=e,o=(0,eg.useRef)(null),s=fT(fK,e.__scopeMenu),a=fN(fK,e.__scopeMenu),l=d1(t,o),d=(0,eg.useRef)(!1);return(0,eg.createElement)(fW,dZ({},i,{ref:l,disabled:n,onClick:dQ(e.onClick,()=>{let e=o.current;if(!n&&e){let t=new CustomEvent(fH,{bubbles:!0,cancelable:!0});e.addEventListener(fH,e=>null==r?void 0:r(e),{once:!0}),d7(e,t),t.defaultPrevented?d.current=!1:s.onClose()}}),onPointerDown:t=>{var n;null===(n=e.onPointerDown)||void 0===n||n.call(e,t),d.current=!0},onPointerUp:dQ(e.onPointerUp,e=>{var t;d.current||null===(t=e.currentTarget)||void 0===t||t.click()}),onKeyDown:dQ(e.onKeyDown,e=>{let t=""!==a.searchRef.current;!n&&(!t||" "!==e.key)&&ff.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())})}))}),fW=(0,eg.forwardRef)((e,t)=>{let{__scopeMenu:n,disabled:r=!1,textValue:i,...o}=e,s=fN(fK,n),a=fI(n),l=(0,eg.useRef)(null),d=d1(t,l),[c,u]=(0,eg.useState)(!1),[h,p]=(0,eg.useState)("");return(0,eg.useEffect)(()=>{let e=l.current;if(e){var t;p((null!==(t=e.textContent)&&void 0!==t?t:"").trim())}},[o.children]),(0,eg.createElement)(fS.ItemSlot,{scope:n,disabled:r,textValue:null!=i?i:h},(0,eg.createElement)(fh,dZ({asChild:!0},a,{focusable:!r}),(0,eg.createElement)(d9.div,dZ({role:"menuitem","data-highlighted":c?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0},o,{ref:d,onPointerMove:dQ(e.onPointerMove,me(e=>{r?s.onItemLeave(e):(s.onItemEnter(e),e.defaultPrevented||e.currentTarget.focus())})),onPointerLeave:dQ(e.onPointerLeave,me(e=>s.onItemLeave(e))),onFocus:dQ(e.onFocus,()=>u(!0)),onBlur:dQ(e.onBlur,()=>u(!1))}))))}),fX=(0,eg.forwardRef)((e,t)=>{let{checked:n=!1,onCheckedChange:r,...i}=e;return(0,eg.createElement)(fJ,{scope:e.__scopeMenu,checked:n},(0,eg.createElement)(fY,dZ({role:"menuitemcheckbox","aria-checked":f9(n)?"mixed":n},i,{ref:t,"data-state":f7(n),onSelect:dQ(i.onSelect,()=>null==r?void 0:r(!!f9(n)||!n),{checkForDefaultPrevented:!1})})))}),[fG,fq]=f_("MenuRadioGroup",{value:void 0,onValueChange:()=>{}}),fZ=((e,t)=>{let{value:n,onValueChange:r,...i}=e,o=ce(r);return(0,eg.createElement)(fG,{scope:e.__scopeMenu,value:n,onValueChange:o},(0,eg.createElement)(fU,dZ({},i,{ref:t})))},"MenuItemIndicator"),[fJ,fQ]=f_(fZ,{checked:!1}),f0=(0,eg.forwardRef)((e,t)=>{let{__scopeMenu:n,forceMount:r,...i}=e,o=fQ(fZ,n);return(0,eg.createElement)(cd,{present:r||f9(o.checked)||!0===o.checked},(0,eg.createElement)(d9.span,dZ({},i,{ref:t,"data-state":f7(o.checked)})))}),f1=((e,t)=>{let{__scopeMenu:n,...r}=e;return(0,eg.createElement)(d9.div,dZ({role:"separator","aria-orientation":"horizontal"},r,{ref:t}))},"MenuSub"),[f2,f5]=f_(f1),f3="MenuSubTrigger",f4=(0,eg.forwardRef)((e,t)=>{let n=fj(f3,e.__scopeMenu),r=fT(f3,e.__scopeMenu),i=f5(f3,e.__scopeMenu),o=fN(f3,e.__scopeMenu),s=(0,eg.useRef)(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:l}=o,d={__scopeMenu:e.__scopeMenu},c=(0,eg.useCallback)(()=>{s.current&&window.clearTimeout(s.current),s.current=null},[]);return(0,eg.useEffect)(()=>c,[c]),(0,eg.useEffect)(()=>{let e=a.current;return()=>{window.clearTimeout(e),l(null)}},[a,l]),(0,eg.createElement)(fA,dZ({asChild:!0},d),(0,eg.createElement)(fW,dZ({id:i.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":i.contentId,"data-state":f8(n.open)},e,{ref:d0(t,i.onTriggerChange),onClick:t=>{var r;null===(r=e.onClick)||void 0===r||r.call(e,t),e.disabled||t.defaultPrevented||(t.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:dQ(e.onPointerMove,me(t=>{o.onItemEnter(t),t.defaultPrevented||e.disabled||n.open||s.current||(o.onPointerGraceIntentChange(null),s.current=window.setTimeout(()=>{n.onOpenChange(!0),c()},100))})),onPointerLeave:dQ(e.onPointerLeave,me(e=>{var t,r;c();let i=null===(t=n.content)||void 0===t?void 0:t.getBoundingClientRect();if(i){let t=null===(r=n.content)||void 0===r?void 0:r.dataset.side,s="right"===t,l=i[s?"left":"right"],d=i[s?"right":"left"];o.onPointerGraceIntentChange({area:[{x:e.clientX+(s?-5:5),y:e.clientY},{x:l,y:i.top},{x:d,y:i.top},{x:d,y:i.bottom},{x:l,y:i.bottom}],side:t}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(e),e.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:dQ(e.onKeyDown,t=>{let i=""!==o.searchRef.current;if(!e.disabled&&(!i||" "!==t.key)&&fb[r.dir].includes(t.key)){var s;n.onOpenChange(!0),null===(s=n.content)||void 0===s||s.focus(),t.preventDefault()}})})))}),f6=(0,eg.forwardRef)((e,t)=>{let n=fL(fD,e.__scopeMenu),{forceMount:r=n.forceMount,...i}=e,o=fj(fD,e.__scopeMenu),s=fT(fD,e.__scopeMenu),a=f5("MenuSubContent",e.__scopeMenu),l=(0,eg.useRef)(null),d=d1(t,l);return(0,eg.createElement)(fS.Provider,{scope:e.__scopeMenu},(0,eg.createElement)(cd,{present:r||o.open},(0,eg.createElement)(fS.Slot,{scope:e.__scopeMenu},(0,eg.createElement)(fV,dZ({id:a.contentId,"aria-labelledby":a.triggerId},i,{ref:d,align:"start",side:"rtl"===s.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{var t;s.isUsingKeyboardRef.current&&(null===(t=l.current)||void 0===t||t.focus()),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:dQ(e.onFocusOutside,e=>{e.target!==a.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:dQ(e.onEscapeKeyDown,e=>{s.onClose(),e.preventDefault()}),onKeyDown:dQ(e.onKeyDown,e=>{let t=e.currentTarget.contains(e.target),n=fv[s.dir].includes(e.key);if(t&&n){var r;o.onOpenChange(!1),null===(r=a.trigger)||void 0===r||r.focus(),e.preventDefault()}})})))))});function f8(e){return e?"open":"closed"}function f9(e){return"indeterminate"===e}function f7(e){return f9(e)?"indeterminate":e?"checked":"unchecked"}function me(e){return t=>"mouse"===t.pointerType?e(t):void 0}let mt=e=>{let{__scopeMenu:t,open:n=!1,children:r,dir:i,onOpenChange:o,modal:s=!0}=e,a=fP(t),[l,d]=(0,eg.useState)(null),c=(0,eg.useRef)(!1),u=ce(o),h=pq(i);return(0,eg.useEffect)(()=>{let e=()=>{c.current=!0,document.addEventListener("pointerdown",t,{capture:!0,once:!0}),document.addEventListener("pointermove",t,{capture:!0,once:!0})},t=()=>c.current=!1;return document.addEventListener("keydown",e,{capture:!0}),()=>{document.removeEventListener("keydown",e,{capture:!0}),document.removeEventListener("pointerdown",t,{capture:!0}),document.removeEventListener("pointermove",t,{capture:!0})}},[]),(0,eg.createElement)(g7,a,(0,eg.createElement)(fE,{scope:t,open:n,onOpenChange:u,content:l,onContentChange:d},(0,eg.createElement)(fM,{scope:t,onClose:(0,eg.useCallback)(()=>u(!1),[u]),isUsingKeyboardRef:c,dir:h,modal:s},r)))},mn=e=>{let{__scopeMenu:t,forceMount:n,children:r,container:i}=e,o=fj(fO,t);return(0,eg.createElement)(fR,{scope:t,forceMount:n},(0,eg.createElement)(cd,{present:n||o.open},(0,eg.createElement)(ca,{asChild:!0,container:i},r)))},mr=e=>{let{__scopeMenu:t,children:n,open:r=!1,onOpenChange:i}=e,o=fj(f1,t),s=fP(t),[a,l]=(0,eg.useState)(null),[d,c]=(0,eg.useState)(null),u=ce(i);return(0,eg.useEffect)(()=>(!1===o.open&&u(!1),()=>u(!1)),[o.open,u]),(0,eg.createElement)(g7,s,(0,eg.createElement)(fE,{scope:t,open:r,onOpenChange:u,content:d,onContentChange:c},(0,eg.createElement)(f2,{scope:t,contentId:c7(),triggerId:c7(),trigger:a,onTriggerChange:l},n)))},mi="DropdownMenu",[mo,ms]=d2(mi,[fk]),ma=fk(),[ml,md]=mo(mi),mc=(0,eg.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,disabled:r=!1,...i}=e,o=md("DropdownMenuTrigger",n),s=ma(n);return(0,eg.createElement)(fA,dZ({asChild:!0},s),(0,eg.createElement)(d9.button,dZ({type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":r?"":void 0,disabled:r},i,{ref:d0(t,o.triggerRef),onPointerDown:dQ(e.onPointerDown,e=>{r||0!==e.button||!1!==e.ctrlKey||(o.onOpenToggle(),o.open||e.preventDefault())}),onKeyDown:dQ(e.onKeyDown,e=>{!r&&(["Enter"," "].includes(e.key)&&o.onOpenToggle(),"ArrowDown"===e.key&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())})})))}),mu=(0,eg.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=md("DropdownMenuContent",n),o=ma(n),s=(0,eg.useRef)(!1);return(0,eg.createElement)(f$,dZ({id:i.contentId,"aria-labelledby":i.triggerId},o,r,{ref:t,onCloseAutoFocus:dQ(e.onCloseAutoFocus,e=>{var t;s.current||null===(t=i.triggerRef.current)||void 0===t||t.focus(),s.current=!1,e.preventDefault()}),onInteractOutside:dQ(e.onInteractOutside,e=>{let t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,r=2===t.button||n;(!i.modal||r)&&(s.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),mh=(0,eg.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=ma(n);return(0,eg.createElement)(fU,dZ({},i,r,{ref:t}))}),mp=(0,eg.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=ma(n);return(0,eg.createElement)(fY,dZ({},i,r,{ref:t}))}),mg=(0,eg.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=ma(n);return(0,eg.createElement)(fX,dZ({},i,r,{ref:t}))}),mf=(0,eg.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=ma(n);return(0,eg.createElement)(f0,dZ({},i,r,{ref:t}))}),mm=(0,eg.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=ma(n);return(0,eg.createElement)(f4,dZ({},i,r,{ref:t}))}),my=(0,eg.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=ma(n);return(0,eg.createElement)(f6,dZ({},i,r,{ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),mb=e=>{let{__scopeDropdownMenu:t,children:n,dir:r,open:i,defaultOpen:o,onOpenChange:s,modal:a=!0}=e,l=ma(t),d=(0,eg.useRef)(null),[c=!1,u]=cu({prop:i,defaultProp:o,onChange:s});return(0,eg.createElement)(ml,{scope:t,triggerId:c7(),triggerRef:d,contentId:c7(),open:c,onOpenChange:u,onOpenToggle:(0,eg.useCallback)(()=>u(e=>!e),[u]),modal:a},(0,eg.createElement)(mt,dZ({},l,{open:c,onOpenChange:u,dir:r,modal:a}),n))},mv=e=>{let{__scopeDropdownMenu:t,...n}=e,r=ma(t);return(0,eg.createElement)(mn,dZ({},r,n))},mx=e=>{let{__scopeDropdownMenu:t,children:n,open:r,onOpenChange:i,defaultOpen:o}=e,s=ma(t),[a=!1,l]=cu({prop:r,defaultProp:o,onChange:i});return(0,eg.createElement)(mr,dZ({},s,{open:a,onOpenChange:l}),n)};function mS(e,t){let n=rR(),r=(0,eg.useRef)(!1),i=hB(),o=(0,eg.useCallback)(i=>{r.current=i,n.batch(()=>{i?(n.complete(),n.addOpenMenu(e)):n.updateInstanceState({openMenus:n.getOpenMenus().filter(t=>!t.startsWith(e))}),t?.(i)})},[n,e,t]),s=e_("is menu open",()=>n.getOpenMenus().includes(e),[n,e]);return(0,eg.useEffect)(()=>(r.current&&(i("open-menu",{source:"unknown",id:e}),n.addOpenMenu(e)),()=>{r.current&&(n.deleteOpenMenu(e),n.getOpenMenus().forEach(t=>{t.startsWith(e)&&(i("close-menu",{source:"unknown",id:e}),n.deleteOpenMenu(t))}),r.current=!1)}),[n,e,i]),[s,o]}function mw({id:e,children:t,modal:n=!1,debugOpen:r=!1}){let[i,o]=mS(e);return(0,j.jsx)(mb,{open:r||i,dir:"ltr",modal:n,onOpenChange:o,children:t})}function mC({children:e,"data-testid":t}){return(0,j.jsx)(mc,{dir:"ltr","data-testid":t,asChild:!0,onTouchEnd:e=>rE(e),children:e})}function m_({side:e="bottom",align:t="start",sideOffset:n=8,alignOffset:r=8,children:i}){let o=rz();return(0,j.jsx)(mv,{container:o,children:(0,j.jsx)(mu,{className:"tlui-menu",align:t,sideOffset:n,side:e,alignOffset:r,collisionPadding:4,children:i})})}function mk({id:e,children:t}){let[n,r]=mS(e);return(0,j.jsx)(mx,{open:n,onOpenChange:r,children:t})}function mP({label:e,"data-testid":t,"data-direction":n}){return(0,j.jsx)(mm,{dir:"ltr","data-direction":n,"data-testid":t,asChild:!0,children:(0,j.jsx)(c6,{type:"menu",className:"tlui-menu__submenu__trigger",label:e,icon:"chevron-right"})})}function mI({alignOffset:e=0,sideOffset:t=5,children:n}){let r=rz();return(0,j.jsx)(mv,{container:r,children:(0,j.jsx)(my,{className:"tlui-menu tlui-menu__submenu__content",alignOffset:e,sideOffset:t,collisionPadding:4,children:n})})}function mE({children:e,size:t="medium"}){return(0,j.jsx)(mh,{dir:"ltr",className:"tlui-menu__group","data-size":t,children:e})}function mj({noClose:e,...t}){return(0,j.jsx)(mp,{dir:"ltr",asChild:!0,onClick:e||void 0!==t.isChecked?rE:void 0,children:(0,j.jsx)(c6,{...t})})}function mM({children:e,onSelect:t,...n}){return(0,j.jsxs)(mg,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",onSelect:e=>{t?.(e),rE(e)},...n,children:[(0,j.jsx)(c0,{small:!0,icon:n.checked?"check":"checkbox-empty"}),e]})}function mT({children:e,onSelect:t,...n}){return(0,j.jsxs)(mg,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",onSelect:e=>{t?.(e),rE(e)},...n,children:[(0,j.jsx)("div",{className:"tlui-button__checkbox__indicator",children:(0,j.jsx)(mf,{dir:"ltr",children:(0,j.jsx)(c0,{icon:"check",small:!0})})}),e]})}let mA=0,mO=eg.memo(function({renderDebugMenuItems:e}){let t=cJ(),n=e_("show_fps",()=>r_.showFps.get(),[r_]);return(0,j.jsxs)("div",{className:"tlui-debug-panel",children:[(0,j.jsx)(mR,{}),n&&(0,j.jsx)(mL,{}),(0,j.jsx)(mD,{}),(0,j.jsxs)(mw,{id:"debug",children:[(0,j.jsx)(mC,{children:(0,j.jsx)(c6,{type:"icon",icon:"dots-horizontal",title:t("debug-panel.more")})}),(0,j.jsx)(m_,{side:"top",align:"end",alignOffset:0,children:(0,j.jsx)(mz,{renderDebugMenuItems:e})})]})]})}),mR=eS(function(){!function(e=!0){let[t,n]=eg.useState(0),r=rR();eg.useEffect(()=>{if(!e)return;let t=()=>n(e=>e+1);return r.on("tick",t),()=>{r.off("tick",t)}},[r,e])}();let e=rR(),t=e.getPath(),n=e.getHoveredShape(),r=e.getOnlySelectedShape(),i="select.idle"!==t&&t.includes("select.")?r:n,o=i&&t.includes("select.")?` / ${i.type||""}${"geo"in i.props?" / "+i.props.geo:""} / [${rG.ToFixed(e.getPointInShapeSpace(i,e.inputs.currentPagePoint),0)}]`:"",s=t.startsWith("select.")&&!t.includes(".idle")?` / [${rG.ToFixed(e.inputs.originPagePoint,0)}] \u2192 [${rG.ToFixed(e.inputs.currentPagePoint,0)}] = ${rG.Dist(e.inputs.originPagePoint,e.inputs.currentPagePoint).toFixed(0)}`:"";return(0,j.jsx)("div",{className:"tlui-debug-panel__current-state",children:`${t}${o}${s}`})});function mL(){let e=eg.useRef(null);return eg.useEffect(()=>{let t=0,n=!1,r=performance.now(),i=0,o=0,s=!1;return function a(){if(!n){if(o++,(i=performance.now()-r)>250){let n=Math.round(250/i*o*4);n>t&&(t=n);let a=.75*t;(n<a&&!s||n>=a&&s)&&(s=!s),e.current.innerHTML=`FPS ${n.toString()}`,e.current.className="tlui-debug-panel__fps"+(s?" tlui-debug-panel__fps__slow":""),i-=250,o=0,r=performance.now()}requestAnimationFrame(a)}}(),()=>{n=!0}},[]),(0,j.jsx)("div",{ref:e})}let mD=function(){let e=rR(),t=e_("rendering shapes count",()=>e.getRenderingShapes().length,[e]);return(0,j.jsxs)("div",{children:[t," Shapes"]})},mz=eS(function({renderDebugMenuItems:e}){let t=rR(),{addToast:n}=h7(),{addDialog:r}=pn(),[i,o]=eg.useState(!1);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(mE,{children:[(0,j.jsx)(mj,{type:"menu",onClick:()=>{n({id:ss(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0}),n({id:ss(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),n({id:ss(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,icon:"twitter",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]})},label:"Show toast"}),(0,j.jsx)(mj,{type:"menu",onClick:()=>{r({component:({onClose:e})=>(0,j.jsx)(mF,{displayDontShowAgain:!0,onCancel:()=>{e()},onContinue:()=>{e()}}),onClose:()=>{}})},label:"Show dialog"}),(0,j.jsx)(mj,{type:"menu",onClick:()=>(function(e,t){let n=Array(100),r=Math.floor(Math.sqrt(100));for(let e=0;e<100;e++)mA++,n[e]={id:nB("box"+mA),type:"geo",x:e%r*132,y:132*Math.floor(e/r)};e.batch(()=>{e.createShapes(n).setSelectedShapes(n.map(e=>e.id))})})(t,100),label:"Create 100 shapes"}),(0,j.jsx)(mj,{type:"menu",onClick:()=>{let e=t.getSelectedShapes(),n=0===e.length?t.getRenderingShapes():e,r=n.map(e=>document.getElementById(e.id).parentElement),i=r.length;for(let e of r)i+=function e({children:t}){let n=0;if(!t.length)return 0;for(let r of[...t])n++,n+=e(r);return n}(e);window.alert(`Shapes ${n.length}, DOM nodes:${i}`)},label:"Count shapes / nodes"}),(()=>{if(i)throw Error("oh no!")})(),(0,j.jsx)(mj,{type:"menu",onClick:()=>{o(!0)},label:"Throw error"}),(0,j.jsx)(mj,{type:"menu",onClick:()=>{ig()},label:"Hard reset"})]}),(0,j.jsxs)(mE,{children:[(0,j.jsx)(m$,{flag:r_.debugSvg}),(0,j.jsx)(m$,{flag:r_.showFps}),(0,j.jsx)(m$,{flag:r_.forceSrgb}),(0,j.jsx)(m$,{flag:r_.debugGeometry}),(0,j.jsx)(m$,{flag:r_.hideShapes})]}),(0,j.jsx)(mE,{children:Object.values(rC).map(e=>(0,j.jsx)(m$,{flag:e},e.name))}),e?.()]})});function mN({label:e,value:t,onChange:n}){return(0,j.jsx)(mM,{title:e,checked:t,onSelect:()=>n(!t),children:(0,j.jsx)("span",{className:"tlui-button__label",draggable:!1,children:e})})}let m$=eS(function({flag:e,onChange:t}){return(0,j.jsx)(mN,{label:e.name.replace(/([a-z0-9])([A-Z])/g,e=>`${e[0]} ${e[1].toLowerCase()}`).replace(/^[a-z]/,e=>e.toUpperCase()),value:e.get(),onChange:n=>{e.set(n),t?.(n)}})});function mF({title:e="title",body:t="hello hello hello",cancel:n="Cancel",confirm:r="Continue",displayDontShowAgain:i=!1,onCancel:o,onContinue:s}){let[a,l]=eg.useState(!1);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(hp,{children:[(0,j.jsx)(hg,{children:e}),(0,j.jsx)(hf,{})]}),(0,j.jsx)(hm,{style:{maxWidth:350},children:t}),(0,j.jsxs)(hy,{className:"tlui-dialog__footer__actions",children:[i&&(0,j.jsx)(c6,{type:"normal",onClick:()=>l(!a),iconLeft:a?"check":"checkbox-empty",style:{marginRight:"auto"},children:"Don't show again"}),(0,j.jsx)(c6,{type:"normal",onClick:o,children:n}),(0,j.jsx)(c6,{type:"primary",onClick:async()=>s(),children:r})]})]})}let mB=({id:e,component:t,onClose:n})=>{let{removeDialog:r}=pn(),i=rz(),o=(0,eg.useCallback)(t=>{if(!t){if(n)try{n()}catch(e){console.warn(e)}r(e)}},[e,n,r]);return(0,j.jsx)(hu,{onOpenChange:o,defaultOpen:!0,children:(0,j.jsx)(hh,{container:i,children:(0,j.jsx)(u9,{dir:"ltr",className:"tlui-dialog__overlay",onClick:e=>{e.target===e.currentTarget&&o(!1)},children:(0,j.jsx)(ht,{dir:"ltr",className:"tlui-dialog__content",children:(0,j.jsx)(t,{onClose:()=>o(!1)})})})})})},mV=eg.memo(function(){let{dialogs:e}=pn();return(0,j.jsx)(j.Fragment,{children:e.map(e=>(0,j.jsx)(mB,{...e},e.id))})});function mU(){let e=rR(),t=e_("follow",()=>e.getInstanceState().followingUserId,[e]);return t?(0,j.jsx)(mK,{userId:t}):null}function mK({userId:e}){let t=oL(e);return t?(0,j.jsx)("div",{className:"tlui-following-indicator",style:{borderColor:t.color}}):null}function mH(){let e=rR(),{languages:t,currentLanguage:n}=pR(),r=(0,eg.useCallback)(t=>e.user.updateUserPreferences({locale:t}),[e]);return(0,j.jsxs)(mk,{id:"help menu language",children:[(0,j.jsx)(mP,{label:"menu.language","data-direction":"left"}),(0,j.jsx)(mI,{sideOffset:-4,children:(0,j.jsx)(mE,{children:t.map(({locale:e,label:t})=>(0,j.jsx)(mT,{title:e,checked:e===n,onSelect:()=>r(e),children:(0,j.jsx)("span",{className:"tlui-button__label",children:t})},e))})})]})}let mY=eg.memo(function(){let e=rz(),t=cJ(),[n,r]=mS("help menu");return(0,j.jsx)("div",{className:"tlui-help-menu",children:(0,j.jsxs)(mb,{dir:"ltr",open:n,onOpenChange:r,modal:!1,children:[(0,j.jsx)(mc,{asChild:!0,dir:"ltr",children:(0,j.jsx)(c6,{type:"help",className:"tlui-button",smallIcon:!0,title:t("help-menu.title"),icon:"question-mark"})}),(0,j.jsx)(mv,{container:e,children:(0,j.jsx)(mu,{className:"tlui-menu",side:"top",sideOffset:8,align:"end",alignOffset:0,collisionPadding:4,children:(0,j.jsx)(mW,{})})})]})})});function mW(){let e=function(){let e=eg.useContext(pL);if(!e)throw Error("useHelpMenuSchema must be used inside of a helpTLUiMenuSchemaProvider.");return e}(),t=lY();return(0,j.jsx)(j.Fragment,{children:e.map(function e(n){if(!n||t&&!n.readonlyOk)return null;switch(n.type){case"custom":if("LANGUAGE_MENU"===n.id)return(0,j.jsx)(mH,{},"item");break;case"group":return(0,j.jsx)(mE,{size:"small",children:n.children.map(e)},n.id);case"submenu":return(0,j.jsxs)(mk,{id:`help menu ${n.id}`,children:[(0,j.jsx)(mP,{label:n.label}),(0,j.jsx)(mI,{children:n.children.map(e)})]},n.id);case"item":{let{id:e,kbd:t,label:r,onSelect:i,icon:o}=n.actionItem;return(0,j.jsx)(mj,{type:"menu",kbd:t,label:r,onClick:()=>i("help-menu"),iconLeft:o},e)}}})})}let mX="Popover",[mG,mq]=d2(mX,[gq]),mZ=gq(),[mJ,mQ]=mG(mX),m0=(0,eg.forwardRef)((e,t)=>{let{__scopePopover:n,...r}=e,i=mQ("PopoverTrigger",n),o=mZ(n),s=d1(t,i.triggerRef),a=(0,eg.createElement)(d9.button,dZ({type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":m7(i.open)},r,{ref:s,onClick:dQ(e.onClick,i.onOpenToggle)}));return i.hasCustomAnchor?a:(0,eg.createElement)(gQ,dZ({asChild:!0},o),a)}),m1="PopoverPortal",[m2,m5]=mG(m1,{forceMount:void 0}),m3="PopoverContent",m4=(0,eg.forwardRef)((e,t)=>{let n=m5(m3,e.__scopePopover),{forceMount:r=n.forceMount,...i}=e,o=mQ(m3,e.__scopePopover);return(0,eg.createElement)(cd,{present:r||o.open},o.modal?(0,eg.createElement)(m6,dZ({},i,{ref:t})):(0,eg.createElement)(m8,dZ({},i,{ref:t})))}),m6=(0,eg.forwardRef)((e,t)=>{let n=mQ(m3,e.__scopePopover),r=(0,eg.useRef)(null),i=d1(t,r),o=(0,eg.useRef)(!1);return(0,eg.useEffect)(()=>{let e=r.current;if(e)return uJ(e)},[]),(0,eg.createElement)(uH,{as:d5,allowPinchZoom:!0},(0,eg.createElement)(m9,dZ({},e,{ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:dQ(e.onCloseAutoFocus,e=>{var t;e.preventDefault(),o.current||null===(t=n.triggerRef.current)||void 0===t||t.focus()}),onPointerDownOutside:dQ(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,r=2===t.button||n;o.current=r},{checkForDefaultPrevented:!1}),onFocusOutside:dQ(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1})})))}),m8=(0,eg.forwardRef)((e,t)=>{let n=mQ(m3,e.__scopePopover),r=(0,eg.useRef)(!1),i=(0,eg.useRef)(!1);return(0,eg.createElement)(m9,dZ({},e,{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var o,s;null===(o=e.onCloseAutoFocus)||void 0===o||o.call(e,t),t.defaultPrevented||(r.current||null===(s=n.triggerRef.current)||void 0===s||s.focus(),t.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:t=>{var o,s;null===(o=e.onInteractOutside)||void 0===o||o.call(e,t),t.defaultPrevented||(r.current=!0,"pointerdown"!==t.detail.originalEvent.type||(i.current=!0));let a=t.target;(null===(s=n.triggerRef.current)||void 0===s?void 0:s.contains(a))&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&i.current&&t.preventDefault()}}))}),m9=(0,eg.forwardRef)((e,t)=>{let{__scopePopover:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,disableOutsidePointerEvents:s,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:d,onInteractOutside:c,...u}=e,h=mQ(m3,n),p=mZ(n);return uc(),(0,eg.createElement)(ur,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:o},(0,eg.createElement)(cr,{asChild:!0,disableOutsidePointerEvents:s,onInteractOutside:c,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:d,onDismiss:()=>h.onOpenChange(!1)},(0,eg.createElement)(g5,dZ({"data-state":m7(h.open),role:"dialog",id:h.contentId},p,u,{ref:t,style:{...u.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}}))))});function m7(e){return e?"open":"closed"}let ye=e=>{let{__scopePopover:t,children:n,open:r,defaultOpen:i,onOpenChange:o,modal:s=!1}=e,a=mZ(t),l=(0,eg.useRef)(null),[d,c]=(0,eg.useState)(!1),[u=!1,h]=cu({prop:r,defaultProp:i,onChange:o});return(0,eg.createElement)(g7,a,(0,eg.createElement)(mJ,{scope:t,contentId:c7(),triggerRef:l,open:u,onOpenChange:h,onOpenToggle:(0,eg.useCallback)(()=>h(e=>!e),[h]),hasCustomAnchor:d,onCustomAnchorAdd:(0,eg.useCallback)(()=>c(!0),[]),onCustomAnchorRemove:(0,eg.useCallback)(()=>c(!1),[]),modal:s},n))},yt=e=>{let{__scopePopover:t,forceMount:n,children:r,container:i}=e,o=mQ(m1,t);return(0,eg.createElement)(m2,{scope:t,forceMount:n},(0,eg.createElement)(cd,{present:n||o.open},(0,eg.createElement)(ca,{asChild:!0,container:i},r)))},yn=({id:e,children:t,onOpenChange:n,open:r})=>{let[i,o]=mS(e,n);return(0,j.jsx)(ye,{onOpenChange:o,open:r||i,children:(0,j.jsx)("div",{className:"tlui-popover",children:t})})},yr=({children:e,disabled:t,"data-testid":n})=>(0,j.jsx)(m0,{"data-testid":n,disabled:t,asChild:!0,dir:"ltr",children:e}),yi=({side:e,children:t,align:n="center",sideOffset:r=8,alignOffset:i=0})=>{let o=rz();return(0,j.jsx)(yt,{container:o,children:(0,j.jsx)(m4,{className:"tlui-popover__content",side:e,sideOffset:r,align:n,alignOffset:i,dir:"ltr",children:t})})},yo=(0,eg.memo)(function(){let e=cJ(),t=rz(),n=function(){let e=eg.useContext(pC);if(!e)throw Error("useActionsMenuSchema must be used inside of a ActionsMenuSchemaProvider.");return e}(),r=lY();return(0,j.jsxs)(yn,{id:"actions-menu",children:[(0,j.jsx)(yr,{children:(0,j.jsx)(c6,{className:"tlui-menu__trigger","data-testid":"main.action-menu",icon:"dots-vertical",title:e("actions-menu.title"),type:"icon",smallIcon:!0})}),(0,j.jsx)(yt,{container:t,children:(0,j.jsx)(m4,{className:"tlui-popover__content",side:"bottom",dir:"ltr",sideOffset:6,children:(0,j.jsx)("div",{className:"tlui-actions-menu tlui-buttons__grid",children:n.map(function(t){if(!t||r&&!t.readonlyOk)return null;if("item"===t.type){let{id:n,icon:r,label:i,kbd:o,onSelect:s}=t.actionItem;return(0,j.jsx)(c6,{"data-testid":`menu-item.${t.id}`,icon:r,type:"icon",title:i?o?`${e(i)} ${c3(o)}`:`${e(i)}`:o?`${c3(o)}`:"",onClick:()=>s("actions-menu"),disabled:t.disabled},n)}})})})})]})}),ys=eS(function(){let e=rR(),t=pl(),n=cJ(),r=t.duplicate,i=(0,eg.useRef)(null);return(0,j.jsx)(c6,{icon:r.icon,type:"icon",onClick:()=>r.onSelect("quick-actions"),disabled:!(e.isIn("select")&&e.getSelectedShapeIds().length>0),title:`${n(r.label)} ${c3(r.kbd)}`,smallIcon:!0,ref:i})}),ya=eg.memo(function(){let e=cJ();return(0,j.jsxs)(mw,{id:"main menu",children:[(0,j.jsx)(mC,{children:(0,j.jsx)(c6,{type:"icon",className:"tlui-menu__trigger","data-testid":"main.menu",title:e("menu.title"),icon:"menu",smallIcon:!0})}),(0,j.jsx)(m_,{alignOffset:0,sideOffset:6,children:(0,j.jsx)(yl,{})})]})});function yl(){let e=rR(),t=cJ(),n=function(){let e=eg.useContext(p$);if(!e)throw Error("useMenuSchema must be used inside of a TLUiMenuSchemaProvider.");return e}(),r=pS(),i=lY();return(0,j.jsx)(j.Fragment,{children:n.map(n=>(function e(n,o,s,a){if(!o)return null;switch(o.type){case"custom":if(i&&!o.readonlyOk)return null;if("LANGUAGE_MENU"===o.id)return(0,j.jsx)(mH,{},"item");return null;case"group":if(i&&!o.readonlyOk)return null;return(0,j.jsx)(mE,{size:a<=1?"medium":r<3||s?.type==="submenu"&&a>2?"tiny":"medium",children:o.children.map(t=>e(n,t,o,a+1))},o.id);case"submenu":if(i&&!o.readonlyOk)return null;return(0,j.jsxs)(mk,{id:`main menu ${s?s.id+" ":""}${o.id}`,children:[(0,j.jsx)(mP,{label:o.label,"data-testid":`menu-item.${o.id}`}),(0,j.jsx)(mI,{sideOffset:-4,alignOffset:-1,children:o.children.map(t=>e(n,t,o,a+1))})]},o.id);case"item":{if(i&&!o.readonlyOk)return null;let{id:e,checkbox:n,menuLabel:r,label:s,onSelect:a,kbd:l}=o.actionItem,d=r??s,c=d?t(d):void 0;if(n)return(0,j.jsxs)(mM,{onSelect:()=>a("menu"),title:c||"",checked:o.checked,disabled:o.disabled,children:[c&&(0,j.jsx)("span",{className:"tlui-button__label",children:c}),l&&(0,j.jsx)(c4,{children:l})]},e);return(0,j.jsx)(mj,{type:"menu","data-testid":`menu-item.${o.id}`,kbd:l,label:d,onClick:()=>a("menu"),disabled:o.disabled},e)}}})(e,n,null,0))})}let yd=function({name:e,id:t,isCurrentPage:n}){let r=rR(),i=(0,eg.useRef)(null),o=(0,eg.useCallback)(e=>{r.renamePage(t,e||"New Page",{ephemeral:!0})},[r,t]),s=(0,eg.useCallback)(e=>{r.mark("rename page"),r.renamePage(t,e||"New Page",{ephemeral:!1})},[r,t]);return(0,j.jsx)(hb,{className:"tlui-page-menu__item__input",ref:e=>i.current=e,defaultValue:e,onValueChange:o,onComplete:s,onCancel:s,shouldManuallyMaintainScrollPositionWhenFocused:!0,autofocus:n,autoselect:!0})},yc=(e,t,n,r)=>{let i;let o=e.getPages(),s=n>r?o[r-1]:o[r],a=n>r?o[r]:o[r+1];(i=s&&!a?s6(s.index):!s&&a?s5(void 0,o[0].index,1)[0]:s4(s.index,a.index))!==o[n].index&&(e.mark("moving page"),e.updatePage({id:t,index:i}))},yu=eS(function({index:e,listSize:t,item:n,onRename:r}){let i=rR(),o=cJ(),s=i.getPages(),a=(0,eg.useCallback)(()=>{i.mark("creating page");let e=t6.createId();i.duplicatePage(n.id,e)},[i,n]),l=(0,eg.useCallback)(()=>{yc(i,n.id,e,e-1)},[i,n,e]),d=(0,eg.useCallback)(()=>{yc(i,n.id,e,e+1)},[i,n,e]),c=(0,eg.useCallback)(()=>{i.mark("deleting page"),i.deletePage(n.id)},[i,n]);return(0,j.jsxs)(mw,{id:`page item submenu ${e}`,children:[(0,j.jsx)(mC,{children:(0,j.jsx)(c6,{type:"icon",title:o("page-menu.submenu.title"),icon:"dots-vertical"})}),(0,j.jsxs)(m_,{alignOffset:0,children:[(0,j.jsxs)(mE,{children:[r&&(0,j.jsx)(mp,{dir:"ltr",onSelect:r,asChild:!0,children:(0,j.jsx)(c6,{type:"menu",label:"page-menu.submenu.rename"})}),(0,j.jsx)(mp,{dir:"ltr",onSelect:a,disabled:s.length>=40,asChild:!0,children:(0,j.jsx)(c6,{type:"menu",label:"page-menu.submenu.duplicate-page"})}),e>0&&(0,j.jsx)(mp,{dir:"ltr",onSelect:l,asChild:!0,children:(0,j.jsx)(c6,{type:"menu",label:"page-menu.submenu.move-up"})}),e<t-1&&(0,j.jsx)(mp,{dir:"ltr",onSelect:d,asChild:!0,children:(0,j.jsx)(c6,{type:"menu",label:"page-menu.submenu.move-down"})})]}),t>1&&(0,j.jsx)(mE,{children:(0,j.jsx)(mp,{dir:"ltr",onSelect:c,asChild:!0,children:(0,j.jsx)(c6,{type:"menu",label:"page-menu.submenu.delete"})})})]})]})}),yh=function(){let e=rR(),t=cJ(),n=pS(),[r,i]=mS("page-menu",(0,eg.useCallback)(()=>p(!1),[])),o=(0,eg.useRef)(null),s=e_("pages",()=>e.getPages(),[e]),a=e_("currentPage",()=>e.getCurrentPage(),[e]),l=e_("currentPageId",()=>e.getCurrentPageId(),[e]),d=lY(),c=e_("maxPageCountReached",()=>e.getPages().length>=40,[e]),u=e_("isCoarsePointer",()=>e.getInstanceState().isCoarsePointer,[e]),[h,p]=(0,eg.useState)(!1),g=(0,eg.useCallback)(()=>{d||p(e=>!e)},[d]),f=(0,eg.useRef)({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[m,y]=(0,eg.useState)(Object.fromEntries(s.map((e,t)=>[e.id,{y:36*t,offsetY:0,isSelected:!1}])));(0,eg.useLayoutEffect)(()=>{y(Object.fromEntries(s.map((e,t)=>[e.id,{y:36*t,offsetY:0,isSelected:!1}])))},[36,s]),(0,eg.useEffect)(()=>{r&&requestAnimationFrame(()=>{let e=document.querySelector(`[data-testid="page-menu-item-${l}"]`);if(e){let t=o.current;if(!t)return;let n=e.offsetTop;n<t.scrollTop&&t.scrollTo({top:n});let r=n+36;r>t.scrollTop+t.offsetHeight&&t.scrollTo({top:r-t.offsetHeight})}})},[36,l,r]);let b=(0,eg.useCallback)(e=>{let{clientY:t,currentTarget:n}=e,{dataset:{id:r,index:i}}=n;if(!r||!i)return;let o=f.current;rj(e.currentTarget,e),o.status="pointing",o.pointing={id:r,index:+i};let a=m[r].y;o.startY=t,o.startIndex=Math.max(0,Math.min(Math.round(a/36),s.length-1))},[36,s.length,m]),v=(0,eg.useCallback)(e=>{let t=f.current;if("pointing"===t.status){let{clientY:n}=e;Math.abs(n-t.startY)>5&&(t.status="dragging")}if("dragging"===t.status){let{clientY:n}=e,r=n-t.startY,i=m[t.pointing.id],{startIndex:o,pointing:a}=t,l=Math.max(0,Math.min(Math.round((i.y+r)/36),s.length-1)),d={...m};if(d[a.id]={y:i.y,offsetY:r,isSelected:!0},l!==t.dragIndex){t.dragIndex=l;for(let e=0;e<s.length;e++){let n=s[e];if(n.id===t.pointing.id)continue;let{y:r}=d[n.id];l===o?r=36*e:l<o?r=l<=e&&e<o?(e+1)*36:36*e:l>o&&(r=l>=e&&e>o?(e-1)*36:36*e),r!==d[n.id].y&&(d[n.id]={y:r,offsetY:0,isSelected:!0})}}y(d)}},[36,s,m]),x=(0,eg.useCallback)(t=>{let n=f.current;if("dragging"===n.status){let{id:t,index:r}=n.pointing;yc(e,t,r,n.dragIndex)}rM(t.currentTarget,t),n.status="idle"},[e]),S=(0,eg.useCallback)(e=>{let t=f.current;"Escape"===e.key&&("dragging"===t.status&&y(Object.fromEntries(s.map((e,t)=>[e.id,{y:36*t,offsetY:0,isSelected:!1}]))),t.status="idle")},[36,s]),w=(0,eg.useCallback)(()=>{d||e.batch(()=>{e.mark("creating page");let n=t6.createId();e.createPage({name:t("page-menu.new-page-initial-name"),id:n}),e.setCurrentPage(n),p(!0)})},[e,t,d]);return(0,j.jsxs)(yn,{id:"pages",onOpenChange:i,open:r,children:[(0,j.jsx)(yr,{children:(0,j.jsx)(c6,{className:"tlui-page-menu__trigger tlui-menu__trigger","data-testid":"main.page-menu",icon:"chevron-down",type:"menu",title:a.name,children:(0,j.jsx)("div",{className:"tlui-page-menu__name",children:a.name})})}),(0,j.jsx)(yi,{side:"bottom",align:"start",sideOffset:6,children:(0,j.jsxs)("div",{className:"tlui-page-menu__wrapper",children:[(0,j.jsxs)("div",{className:"tlui-page-menu__header",children:[(0,j.jsx)("div",{className:"tlui-page-menu__header__title",children:t("page-menu.title")}),!d&&(0,j.jsxs)("div",{className:"tlui-buttons__horizontal",children:[(0,j.jsx)(c6,{type:"icon","data-testid":"page-menu.edit",title:t(h?"page-menu.edit-done":"page-menu.edit-start"),icon:h?"check":"edit",onClick:g}),(0,j.jsx)(c6,{type:"icon","data-testid":"page-menu.create",icon:"plus",title:t(c?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:c,onClick:w})]})]}),(0,j.jsx)("div",{className:"tlui-page-menu__list tlui-menu__group",style:{height:36*s.length+4},ref:o,children:s.map((r,i)=>{let o=m[r.id]??{position:40*i,offsetY:0};return h?(0,j.jsxs)("div",{"data-testid":`page-menu-item-${r.id}`,className:"tlui-page_menu__item__sortable",style:{zIndex:r.id===a.id?888:i,transform:`translate(0px, ${o.y+o.offsetY}px)`},children:[(0,j.jsx)(c6,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",icon:"drag-handle-dots",onPointerDown:b,onPointerUp:x,onPointerMove:v,onKeyDown:S,"data-id":r.id,"data-index":i}),n<5&&u?(0,j.jsx)(c6,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{let t=window.prompt("Rename page",r.name);t&&t!==r.name&&e.renamePage(r.id,t)},onDoubleClick:g,isChecked:r.id===a.id,children:(0,j.jsx)("span",{children:r.name})}):(0,j.jsx)("div",{className:"tlui-page_menu__item__sortable__title",style:{height:36},children:(0,j.jsx)(yd,{id:r.id,name:r.name,isCurrentPage:r.id===a.id})}),!d&&(0,j.jsx)("div",{className:"tlui-page_menu__item__submenu","data-isediting":h,children:(0,j.jsx)(yu,{index:i,item:r,listSize:s.length})})]},r.id+"_editing"):(0,j.jsxs)("div",{"data-testid":`page-menu-item-${r.id}`,className:"tlui-page-menu__item",children:[(0,j.jsxs)(c6,{type:"normal",className:"tlui-page-menu__item__button tlui-page-menu__item__button__checkbox",onClick:()=>e.setCurrentPage(r.id),onDoubleClick:g,isChecked:r.id===a.id,title:t("page-menu.go-to-page"),children:[(0,j.jsx)("div",{className:"tlui-page-menu__item__button__check",children:r.id===a.id&&(0,j.jsx)(c0,{icon:"check"})}),(0,j.jsx)("span",{children:r.name})]}),!d&&(0,j.jsx)("div",{className:"tlui-page_menu__item__submenu",children:(0,j.jsx)(yu,{index:i,item:r,listSize:s.length,onRename:()=>{if(e.environment.isIos){let t=window.prompt("Rename page",r.name);t&&t!==r.name&&e.renamePage(r.id,t)}else e.batch(()=>{p(!0),e.setCurrentPage(r.id)})}})})]},r.id)})})]})})]})},yp=(0,eg.memo)(function(){let e=cJ(),t=pz(),n=pl().redo,r=(0,eg.useRef)(null);return(0,j.jsx)(c6,{"data-testid":"main.redo",icon:n.icon,type:"icon",title:`${e(n.label)} ${c3(n.kbd)}`,disabled:!t,onClick:()=>n.onSelect("quick-actions"),smallIcon:!0,ref:r})}),yg=eS(function(){let e=rR(),t=pl(),n=cJ(),r=t.delete,i=lY(),o=(0,eg.useRef)(null);return i?null:(0,j.jsx)(c6,{icon:r.icon,type:"icon",onClick:()=>{r.onSelect("quick-actions"),e.getContainer().focus()},disabled:!(e.isIn("select")&&e.getSelectedShapeIds().length>0),title:`${n(r.label)} ${c3(r.kbd)}`,smallIcon:!0,ref:o})}),yf=(0,eg.memo)(function(){let e=cJ(),t=pN(),n=pl(),r=(0,eg.useRef)(null),i=n.undo;return(0,j.jsx)(c6,{"data-testid":"main.undo",icon:i.icon,type:"icon",title:`${e(i.label)} ${c3(i.kbd)}`,disabled:!t,onClick:()=>i.onSelect("quick-actions"),smallIcon:!0,ref:r})}),ym=eS(function(){let e=rR(),t=pS(),n=lY();return(0,j.jsx)("div",{className:"tlui-menu-zone",children:(0,j.jsxs)("div",{className:"tlui-buttons__horizontal",children:[(0,j.jsx)(ya,{}),(0,j.jsx)(yh,{}),t>=6&&!n&&!e.isInAny("hand","zoom")&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(yf,{}),(0,j.jsx)(yp,{}),(0,j.jsx)(yg,{}),(0,j.jsx)(ys,{}),(0,j.jsx)(yo,{})]})]})})});class yy{constructor(e){this.editor=e}dpr=1;colors={shapeFill:"rgba(144, 144, 144, .1)",selectFill:"#2f80ed",viewportFill:"rgba(144, 144, 144, .1)"};id=ss();cvs=null;pageBounds=[];collaborators=[];canvasScreenBounds=new oE;canvasPageBounds=new oE;contentPageBounds=new oE;contentScreenBounds=new oE;originPagePoint=new rG;originPageCenter=new rG;isInViewport=!1;debug=!1;setDpr(e){this.dpr=+e.toFixed(2)}updateContentScreenBounds=()=>{let{contentScreenBounds:e,contentPageBounds:t,canvasScreenBounds:n}=this,{x:r,y:i,w:o,h:s}=e;if(t.w>t.h){let e=n.w/(t.w/t.h);e>n.h?(r=(n.w-n.w*(n.h/e))/2,i=0,o=n.w*(n.h/e),s=n.h):(r=0,i=(n.h-e)/2,o=n.w,s=e)}else if(t.w<t.h){let e=n.h/(t.h/t.w);r=(n.w-e)/2,i=0,o=e,s=n.h}else r=n.h/2,i=0,o=n.h,s=n.h;e.set(r,i,o,s)};updateCanvasPageBounds=()=>{let{canvasPageBounds:e,canvasScreenBounds:t,contentPageBounds:n,contentScreenBounds:r}=this;e.set(0,0,n.width/(r.width/t.width),n.height/(r.height/t.height)),e.center=n.center};getScreenPoint=(e,t)=>{let{canvasScreenBounds:n}=this;return{x:(e-n.minX)*this.dpr,y:(t-n.minY)*this.dpr}};getPagePoint=(e,t)=>{let{contentPageBounds:n,contentScreenBounds:r,canvasPageBounds:i}=this,{x:o,y:s}=this.getScreenPoint(e,t);return new rG(i.minX+o*n.width/r.width,i.minY+s*n.height/r.height,1)};minimapScreenPointToPagePoint=(e,t,n=!1,r=!1)=>{let{editor:i}=this,o=i.getViewportPageBounds(),{x:s,y:a}=this.getPagePoint(e,t);if(r){let e=this.editor.getCurrentPageBounds(),t=(e?.minX??0)-o.width/2,n=(e?.maxX??0)+o.width/2,r=(e?.minY??0)-o.height/2,i=(e?.maxY??0)+o.height/2,l=Math.max(0,t+o.width-s),d=Math.max(0,-(n-o.width-s)),c=Math.max(0,r+o.height-a),u=Math.max(0,-(i-o.height-a)),h=Math.max(0,l-d),p=Math.max(0,d-l),g=Math.max(0,c-u),f=Math.max(0,u-c);h&&h>p?s+=h/2:p&&(s-=p/2),g&&g>f?a+=g/2:f&&(a-=f/2),s=r5(s,t,n),a=r5(a,r,i)}if(n){let{originPagePoint:e}=this;Math.abs(s-e.x)>Math.abs(a-e.y)?a=e.y:s=e.x}return new rG(s,a)};render=()=>{let e,t;let{cvs:n,pageBounds:r}=this;this.updateCanvasPageBounds();let{editor:i,canvasScreenBounds:o,canvasPageBounds:s,contentPageBounds:a,contentScreenBounds:l}=this,{width:d,height:c}=o,u=i.getSelectedShapeIds(),h=i.getViewportPageBounds();if(!n||!r)return;let p=n.getContext("2d");if(!p)throw Error("Minimap (shapes): Could not get context");p.resetTransform(),p.globalAlpha=1,p.clearRect(0,0,d,c);let g=l.width/a.width,f=l.height/a.height;p.translate((d-l.width)/2,(c-l.height)/2),p.scale(g,f),p.translate(-a.minX,-a.minY);let m=8/g,y=8/g,b=1/g,v=1/g,x=m/4,S=y/4,w=new Path2D,C=new Path2D,{shapeFill:_,selectFill:k,viewportFill:P}=this.colors;for(let t=0,n=r.length;t<n;t++)e=r[t],yy.roundedRect(u.includes(e.id)?C:w,e.minX,e.minY,e.width,e.height,r5(m,b,e.width/x),r5(y,v,e.height/S));if(p.fillStyle=_,p.fill(w),p.fillStyle=k,p.fill(C),this.debug){let{minX:e,minY:t,width:n,height:i}=oE.Common(r);p.strokeStyle="green",p.lineWidth=2/g,p.strokeRect(e+1/g,t+1/f,n-2/g,i-2/f)}{let{brush:e}=i.getInstanceState();if(e){let{x:t,y:n,w:r,h:i}=e;p.beginPath(),yy.sharpRect(p,t,n,r,i),p.closePath(),p.fillStyle=P,p.fill()}}{let{minX:e,minY:t,width:n,height:r}=h;p.beginPath();let i=12/g,o=12/g;yy.roundedRect(p,e,t,n,r,Math.min(n/4,i),Math.min(r/4,o)),p.closePath(),p.fillStyle=P,p.fill(),this.debug&&(p.strokeStyle="orange",p.strokeRect(e+1/g,t+1/f,n-2/g,r-2/f))}let I=2.5/g,E=2.5/f,j=i.getCurrentPageId();for(let e=0;e<this.collaborators.length;e++)(t=this.collaborators[e]).currentPageId===j&&(p.beginPath(),p.ellipse(r5(t.cursor.x,s.minX+I,s.maxX-I),r5(t.cursor.y,s.minY+E,s.maxY-E),5/g,5/f,0,0,r1),p.fillStyle=t.color,p.fill());if(this.debug){p.lineWidth=2/g;{let{minX:e,minY:t,width:n,height:r}=a;p.strokeStyle="red",p.strokeRect(e+1/g,t+1/f,n-2/g,r-2/f)}{let{minX:e,minY:t,width:n,height:r}=s;p.strokeStyle="blue",p.strokeRect(e+1/g,t+1/f,n-2/g,r-2/f)}}};static roundedRect(e,t,n,r,i,o,s){if(o<1&&s<1){e.rect(t,n,r,i);return}e.moveTo(t+o,n),e.lineTo(t+r-o,n),e.quadraticCurveTo(t+r,n,t+r,n+s),e.lineTo(t+r,n+i-s),e.quadraticCurveTo(t+r,n+i,t+r-o,n+i),e.lineTo(t+o,n+i),e.quadraticCurveTo(t,n+i,t,n+i-s),e.lineTo(t,n+s),e.quadraticCurveTo(t,n,t+o,n)}static sharpRect(e,t,n,r,i,o,s){e.rect(t,n,r,i)}}function yb({shapeFill:e,selectFill:t,viewportFill:n}){let r=rR(),i=eg.useRef(null),o=eg.useRef(!1),s=aq(),a=ew("dpr",()=>r.getInstanceState().devicePixelRatio,[r]),l=eg.useMemo(()=>r.store.query.records("instance_presence"),[r]),d=eg.useMemo(()=>new yy(r),[r]);eg.useEffect(()=>{let i=requestAnimationFrame(()=>{let i=getComputedStyle(r.getContainer());d.colors={shapeFill:i.getPropertyValue(e).trim(),selectFill:i.getPropertyValue(t).trim(),viewportFill:i.getPropertyValue(n).trim()},d.render()});return()=>{cancelAnimationFrame(i)}},[r,t,e,n,d,s]);let c=eg.useCallback(e=>{if(!r.getCurrentPageShapeIds().size)return;let t=d.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!1),n=d.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!0);d.originPagePoint.setTo(n),d.originPageCenter.setTo(r.getViewportPageBounds().center),r.centerOnPoint(t,{duration:320})},[r,d]),u=eg.useCallback(e=>{let t=e.currentTarget;if(rj(t,e),!r.getCurrentPageShapeIds().size)return;o.current=!0,d.isInViewport=!1;let n=d.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!1),i=d.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!0),s=r.getViewportPageBounds();if(d.isInViewport=s.containsPoint(i),d.isInViewport)d.originPagePoint.setTo(i),d.originPageCenter.setTo(s.center);else{let e=rG.Sub(s.center,s.point),t=rG.Add(n,e);d.originPagePoint.setTo(t),d.originPageCenter.setTo(n),r.centerOnPoint(n,{duration:320})}document.body.addEventListener("pointerup",function e(n){t&&rM(t,n),o.current=!1,document.body.removeEventListener("pointerup",e)})},[r,d]),h=eg.useCallback(e=>{let t=d.minimapScreenPointToPagePoint(e.clientX,e.clientY,e.shiftKey,!0);if(o.current){if(d.isInViewport){let e=d.originPagePoint.clone().sub(d.originPageCenter);r.centerOnPoint(rG.Sub(t,e));return}r.centerOnPoint(t)}let n=d.getPagePoint(e.clientX,e.clientY),i=r.pageToScreen(n),s={type:"pointer",target:"canvas",name:"pointer_move",...rA(e),point:i,isPen:r.getInstanceState().isPenMode};r.dispatch(s)},[r,d]),p=eg.useCallback(e=>{let t=oC(e);r.dispatch({type:"wheel",name:"wheel",delta:t,point:new rG(e.clientX,e.clientY),shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey})},[r]);return eC("update when dpr changes",()=>{let e=a.get();d.setDpr(e);let t=i.current,n=t.getBoundingClientRect(),r=n.width*e,o=n.height*e;t.width=r,t.height=o,d.canvasScreenBounds.set(n.x,n.y,r,o),d.cvs=i.current},[a,d]),eC("minimap render when pagebounds or collaborators changes",()=>{let e=r.getCurrentPageShapeIds(),t=r.getCurrentPageBounds(),n=r.getViewportPageBounds();a.get(),d.contentPageBounds=t?oE.Expand(t,n):n,d.updateContentScreenBounds();let i=[];e.forEach(e=>{let t=r.getShapePageBounds(e);if(!t)return;let n=r.getShapeMask(e);if(n){let e=sT(n,t.corners);if(!e)return;t=oE.FromPoints(e)}t&&(t.id=e,i.push(t))}),d.pageBounds=i,d.collaborators=l.get(),d.render()},[r,d]),(0,j.jsx)("div",{className:"tlui-minimap",children:(0,j.jsx)("canvas",{ref:i,className:"tlui-minimap__canvas",onDoubleClick:c,onPointerMove:h,onPointerDown:u,onWheel:p})})}let yv=eS(function(){let e=rR(),t=cJ(),n=pS(),r=e.getZoomLevel(),i=e.getCurrentPageShapeIds().size>0,o=e.getSelectedShapeIds().length>0,s=1===e.getZoomLevel(),a=eg.useCallback(()=>{e.resetZoom(e.getViewportScreenCenter(),{duration:320})},[e]);return(0,j.jsxs)(mw,{id:"zoom",children:[(0,j.jsx)(mC,{children:(0,j.jsx)(c6,{type:"icon",title:`${t("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu",className:n<5?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:a,icon:n<4?"zoom-in":void 0,children:n<4?null:(0,j.jsxs)("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(100*r),"%"]})})}),(0,j.jsx)(m_,{side:"top",align:"start",alignOffset:0,children:(0,j.jsxs)(mE,{children:[(0,j.jsx)(yx,{action:"zoom-in","data-testid":"minimap.zoom-menu.zoom-in",noClose:!0}),(0,j.jsx)(yx,{action:"zoom-out","data-testid":"minimap.zoom-menu.zoom-out",noClose:!0}),(0,j.jsx)(yx,{action:"zoom-to-100","data-testid":"minimap.zoom-menu.zoom-to-100",noClose:!0,disabled:s}),(0,j.jsx)(yx,{action:"zoom-to-fit",disabled:!i,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0}),(0,j.jsx)(yx,{action:"zoom-to-selection",disabled:!o,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})]})})]})});function yx(e){let{action:t,disabled:n=!1,noClose:r=!1}=e,i=pl();return(0,j.jsx)(mj,{type:"menu",label:i[t].label,kbd:i[t].kbd,"data-testid":e["data-testid"],onClick:()=>i[t].onSelect("zoom-menu"),noClose:r,disabled:n})}let yS=(0,eg.memo)(function(){let e=pl(),t=cJ(),n=pS(),[r,i]=function(e,t){let[n,r]=eg.useState(t);return eg.useLayoutEffect(()=>{let t=localStorage.getItem(e);if(t)try{r(JSON.parse(t))}catch(t){console.error(`Could not restore value ${e} from local storage.`)}},[e]),[n,eg.useCallback(t=>{r(n=>{let r="function"==typeof t?t(n):t;return localStorage.setItem(e,JSON.stringify(r)),r})},[e])]}("minimap",!0),o=(0,eg.useCallback)(()=>{i(e=>!e)},[i]);return n<4?null:(0,j.jsxs)("div",{className:"tlui-navigation-zone",children:[(0,j.jsx)("div",{className:"tlui-buttons__horizontal",children:n<6?(0,j.jsx)(yv,{}):r?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(yv,{}),(0,j.jsx)(c6,{type:"icon",icon:r?"chevrons-ne":"chevrons-sw","data-testid":"minimap.toggle",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-zone__toggle",onClick:o})]}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(c6,{type:"icon",icon:"minus","data-testid":"minimap.zoom-out",title:`${t(e["zoom-out"].label)} ${c3(e["zoom-out"].kbd)}`,onClick:()=>e["zoom-out"].onSelect("navigation-zone")}),(0,j.jsx)(yv,{}),(0,j.jsx)(c6,{type:"icon",icon:"plus","data-testid":"minimap.zoom-in",title:`${t(e["zoom-in"].label)} ${c3(e["zoom-in"].kbd)}`,onClick:()=>e["zoom-in"].onSelect("navigation-zone")}),(0,j.jsx)(c6,{type:"icon",icon:r?"chevrons-ne":"chevrons-sw","data-testid":"minimap.toggle",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-zone__toggle",onClick:o})]})}),n>=6&&!r&&(0,j.jsx)(yb,{viewportFill:"--color-muted-1",selectFill:"--color-selected",shapeFill:"--color-text-3"})]})}),yw=eS(function(){let e=rR().getInstanceState().isPenMode,t=pl();if(!e)return null;let n=t["exit-pen-mode"];return(0,j.jsx)(c6,{type:"normal",label:n.label,iconLeft:n.icon,onClick:()=>n.onSelect("helper-buttons")})}),yC=eS(function(){let e=rR(),t=pl();if(!e.getInstanceState().followingUserId)return null;let n=t["stop-following"];return(0,j.jsx)(c6,{type:"normal",label:n.label,iconLeft:n.icon,onClick:()=>n.onSelect("people-menu")})}),y_=[nX,nG,nq,nJ];function yk(){let e=rR();return e_("getRelevantStyles",()=>{let t=new sH(e.getSharedStyles()),n=e.getSelectedShapeIds().length>0||!!e.root.getCurrent()?.shapeType;if(0===t.size&&e.isIn("select")&&0===e.getSelectedShapeIds().length)for(let n of y_)t.applyValue(n,e.getStyleForNextShape(n));return 0!==t.size||n?{styles:t,opacity:e.getSharedOpacity()}:null},[e])}let yP=eg.memo(function(e){let{uiType:t,items:n,title:r,style:i,value:o,onValueChange:s}=e,a=rR(),l=cJ(),d=(0,eg.useRef)(!1),{handleButtonClick:c,handleButtonPointerDown:u,handleButtonPointerEnter:h,handleButtonPointerUp:p}=eg.useMemo(()=>{let e=()=>{d.current=!1,window.removeEventListener("pointerup",e)};return{handleButtonClick:e=>{let{id:t}=e.currentTarget.dataset;("shared"!==o.type||o.value!==t)&&(a.mark("point picker item"),s(i,t,!1))},handleButtonPointerDown:t=>{let{id:n}=t.currentTarget.dataset;a.mark("point picker item"),s(i,n,!0),d.current=!0,window.addEventListener("pointerup",e)},handleButtonPointerEnter:e=>{if(!d.current)return;let{id:t}=e.currentTarget.dataset;s(i,t,!0)},handleButtonPointerUp:e=>{let{id:t}=e.currentTarget.dataset;s(i,t,!1)}}},[o,a,s,i]),g=e_("theme",()=>nW({isDarkMode:a.user.getIsDarkMode()}),[a]);return(0,j.jsx)("div",{className:rm("tlui-buttons__grid"),children:n.map(e=>(0,j.jsx)(c6,{type:"icon","data-id":e.value,"data-testid":`style.${t}.${e.value}`,"aria-label":e.value,"data-state":"shared"===o.type&&o.value===e.value?"hinted":void 0,title:r+"  "+l(`${t}-style.${e.value}`),className:rm("tlui-button-grid__button"),style:i===nX?{color:g[e.value].solid}:void 0,onPointerEnter:h,onPointerDown:u,onPointerUp:p,onClick:c,icon:e.icon},e.value))})});function yI(e,[t,n]){return Math.min(n,Math.max(t,e))}let yE=["PageUp","PageDown"],yj=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],yM={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},yT="Slider",[yA,yO,yR]=d8(yT),[yL,yD]=d2(yT,[yR]),[yz,yN]=yL(yT),y$=(0,eg.forwardRef)((e,t)=>{let{name:n,min:r=0,max:i=100,step:o=1,orientation:s="horizontal",disabled:a=!1,minStepsBetweenThumbs:l=0,defaultValue:d=[r],value:c,onValueChange:u=()=>{},onValueCommit:h=()=>{},inverted:p=!1,...g}=e,[f,m]=(0,eg.useState)(null),y=d1(t,e=>m(e)),b=(0,eg.useRef)(new Set),v=(0,eg.useRef)(0),x="horizontal"===s,S=!f||!!f.closest("form"),[w=[],C]=cu({prop:c,defaultProp:d,onChange:e=>{var t;null===(t=[...b.current][v.current])||void 0===t||t.focus(),u(e)}}),_=(0,eg.useRef)(w);function k(e,t,{commit:n}={commit:!1}){let s=(String(o).split(".")[1]||"").length,a=yI(function(e,t){let n=Math.pow(10,t);return Math.round(e*n)/n}(Math.round((e-r)/o)*o+r,s),[r,i]);C((e=[])=>{var r,i;let s=function(e=[],t,n){let r=[...e];return r[n]=t,r.sort((e,t)=>e-t)}(e,a,t);if(r=s,!(!((i=l*o)>0)||Math.min(...r.slice(0,-1).map((e,t)=>r[t+1]-e))>=i))return e;{v.current=s.indexOf(a);let t=String(s)!==String(e);return t&&n&&h(s),t?s:e}})}return(0,eg.createElement)(yz,{scope:e.__scopeSlider,disabled:a,min:r,max:i,valueIndexToChangeRef:v,thumbs:b.current,values:w,orientation:s},(0,eg.createElement)(yA.Provider,{scope:e.__scopeSlider},(0,eg.createElement)(yA.Slot,{scope:e.__scopeSlider},(0,eg.createElement)(x?yV:yU,dZ({"aria-disabled":a,"data-disabled":a?"":void 0},g,{ref:y,onPointerDown:dQ(g.onPointerDown,()=>{a||(_.current=w)}),min:r,max:i,inverted:p,onSlideStart:a?void 0:function(e){let t=function(e,t){if(1===e.length)return 0;let n=e.map(e=>Math.abs(e-t));return n.indexOf(Math.min(...n))}(w,e);k(e,t)},onSlideMove:a?void 0:function(e){k(e,v.current)},onSlideEnd:a?void 0:function(){let e=_.current[v.current];w[v.current]!==e&&h(w)},onHomeKeyDown:()=>!a&&k(r,0,{commit:!0}),onEndKeyDown:()=>!a&&k(i,w.length-1,{commit:!0}),onStepKeyDown:({event:e,direction:t})=>{if(!a){let n=yE.includes(e.key)||e.shiftKey&&yj.includes(e.key),r=v.current;k(w[r]+o*(n?10:1)*t,r,{commit:!0})}}})))),S&&w.map((e,t)=>(0,eg.createElement)(yZ,{key:t,name:n?n+(w.length>1?"[]":""):void 0,value:e})))}),[yF,yB]=yL(yT,{startEdge:"left",endEdge:"right",size:"width",direction:1}),yV=(0,eg.forwardRef)((e,t)=>{let{min:n,max:r,dir:i,inverted:o,onSlideStart:s,onSlideMove:a,onSlideEnd:l,onStepKeyDown:d,...c}=e,[u,h]=(0,eg.useState)(null),p=d1(t,e=>h(e)),g=(0,eg.useRef)(),f=pq(i),m="ltr"===f,y=m&&!o||!m&&o;function b(e){let t=g.current||u.getBoundingClientRect(),i=yQ([0,t.width],y?[n,r]:[r,n]);return g.current=t,i(e-t.left)}return(0,eg.createElement)(yF,{scope:e.__scopeSlider,startEdge:y?"left":"right",endEdge:y?"right":"left",direction:y?1:-1,size:"width"},(0,eg.createElement)(yK,dZ({dir:f,"data-orientation":"horizontal"},c,{ref:p,style:{...c.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:e=>{let t=b(e.clientX);null==s||s(t)},onSlideMove:e=>{let t=b(e.clientX);null==a||a(t)},onSlideEnd:()=>{g.current=void 0,null==l||l()},onStepKeyDown:e=>{let t=yM[y?"from-left":"from-right"].includes(e.key);null==d||d({event:e,direction:t?-1:1})}})))}),yU=(0,eg.forwardRef)((e,t)=>{let{min:n,max:r,inverted:i,onSlideStart:o,onSlideMove:s,onSlideEnd:a,onStepKeyDown:l,...d}=e,c=(0,eg.useRef)(null),u=d1(t,c),h=(0,eg.useRef)(),p=!i;function g(e){let t=h.current||c.current.getBoundingClientRect(),i=yQ([0,t.height],p?[r,n]:[n,r]);return h.current=t,i(e-t.top)}return(0,eg.createElement)(yF,{scope:e.__scopeSlider,startEdge:p?"bottom":"top",endEdge:p?"top":"bottom",size:"height",direction:p?1:-1},(0,eg.createElement)(yK,dZ({"data-orientation":"vertical"},d,{ref:u,style:{...d.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:e=>{let t=g(e.clientY);null==o||o(t)},onSlideMove:e=>{let t=g(e.clientY);null==s||s(t)},onSlideEnd:()=>{h.current=void 0,null==a||a()},onStepKeyDown:e=>{let t=yM[p?"from-bottom":"from-top"].includes(e.key);null==l||l({event:e,direction:t?-1:1})}})))}),yK=(0,eg.forwardRef)((e,t)=>{let{__scopeSlider:n,onSlideStart:r,onSlideMove:i,onSlideEnd:o,onHomeKeyDown:s,onEndKeyDown:a,onStepKeyDown:l,...d}=e,c=yN(yT,n);return(0,eg.createElement)(d9.span,dZ({},d,{ref:t,onKeyDown:dQ(e.onKeyDown,e=>{"Home"===e.key?(s(e),e.preventDefault()):"End"===e.key?(a(e),e.preventDefault()):yE.concat(yj).includes(e.key)&&(l(e),e.preventDefault())}),onPointerDown:dQ(e.onPointerDown,e=>{let t=e.target;t.setPointerCapture(e.pointerId),e.preventDefault(),c.thumbs.has(t)?t.focus():r(e)}),onPointerMove:dQ(e.onPointerMove,e=>{e.target.hasPointerCapture(e.pointerId)&&i(e)}),onPointerUp:dQ(e.onPointerUp,e=>{let t=e.target;t.hasPointerCapture(e.pointerId)&&(t.releasePointerCapture(e.pointerId),o(e))})}))}),yH=(0,eg.forwardRef)((e,t)=>{let{__scopeSlider:n,...r}=e,i=yN("SliderTrack",n);return(0,eg.createElement)(d9.span,dZ({"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation},r,{ref:t}))}),yY="SliderRange",yW=(0,eg.forwardRef)((e,t)=>{let{__scopeSlider:n,...r}=e,i=yN(yY,n),o=yB(yY,n),s=d1(t,(0,eg.useRef)(null)),a=i.values.length,l=i.values.map(e=>yJ(e,i.min,i.max));return(0,eg.createElement)(d9.span,dZ({"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0},r,{ref:s,style:{...e.style,[o.startEdge]:(a>1?Math.min(...l):0)+"%",[o.endEdge]:100-Math.max(...l)+"%"}}))}),yX="SliderThumb",yG=(0,eg.forwardRef)((e,t)=>{let n=yO(e.__scopeSlider),[r,i]=(0,eg.useState)(null),o=d1(t,e=>i(e)),s=(0,eg.useMemo)(()=>r?n().findIndex(e=>e.ref.current===r):-1,[n,r]);return(0,eg.createElement)(yq,dZ({},e,{ref:o,index:s}))}),yq=(0,eg.forwardRef)((e,t)=>{let{__scopeSlider:n,index:r,...i}=e,o=yN(yX,n),s=yB(yX,n),[a,l]=(0,eg.useState)(null),d=d1(t,e=>l(e)),c=gW(a),u=o.values[r],h=void 0===u?0:yJ(u,o.min,o.max),p=function(e,t){return t>2?`Value ${e+1} of ${t}`:2===t?["Minimum","Maximum"][e]:void 0}(r,o.values.length),g=null==c?void 0:c[s.size],f=g?function(e,t,n){let r=e/2,i=yQ([0,50],[0,r]);return(r-i(t)*n)*n}(g,h,s.direction):0;return(0,eg.useEffect)(()=>{if(a)return o.thumbs.add(a),()=>{o.thumbs.delete(a)}},[a,o.thumbs]),(0,eg.createElement)("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[s.startEdge]:`calc(${h}% + ${f}px)`}},(0,eg.createElement)(yA.ItemSlot,{scope:e.__scopeSlider},(0,eg.createElement)(d9.span,dZ({role:"slider","aria-label":e["aria-label"]||p,"aria-valuemin":o.min,"aria-valuenow":u,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0},i,{ref:d,style:void 0===u?{display:"none"}:e.style,onFocus:dQ(e.onFocus,()=>{o.valueIndexToChangeRef.current=r})}))))}),yZ=e=>{let{value:t,...n}=e,r=(0,eg.useRef)(null),i=function(e){let t=(0,eg.useRef)({value:e,previous:e});return(0,eg.useMemo)(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}(t);return(0,eg.useEffect)(()=>{let e=r.current,n=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set;if(i!==t&&n){let r=new Event("input",{bubbles:!0});n.call(e,t),e.dispatchEvent(r)}},[i,t]),(0,eg.createElement)("input",dZ({style:{display:"none"}},n,{ref:r,defaultValue:t}))};function yJ(e,t,n){return yI(100/(n-t)*(e-t),[0,100])}function yQ(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];let r=(t[1]-t[0])/(e[1]-e[0]);return t[0]+r*(n-e[0])}}let y0=(0,eg.memo)(function(e){let{title:t,steps:n,value:r,label:i,onValueChange:o}=e,s=rR(),a=cJ(),l=(0,eg.useCallback)(e=>{o(e[0],!0)},[o]),d=(0,eg.useCallback)(()=>{s.mark("click slider")},[s]),c=(0,eg.useCallback)(()=>{r&&o(r,!1)},[r,o]);return(0,j.jsx)("div",{className:"tlui-slider__container",children:(0,j.jsxs)(y$,{"data-testid":e["data-testid"],className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:n,step:1,value:r?[r]:void 0,onPointerDown:d,onValueChange:l,onPointerUp:c,title:t+"  "+a(i),children:[(0,j.jsx)(yH,{className:"tlui-slider__track",dir:"ltr",children:null!==r&&(0,j.jsx)(yW,{className:"tlui-slider__range",dir:"ltr"})}),null!==r&&(0,j.jsx)(yG,{className:"tlui-slider__thumb",dir:"ltr"})]})})}),y1=eg.memo(function({label:e,uiTypeA:t,uiTypeB:n,labelA:r,labelB:i,itemsA:o,itemsB:s,styleA:a,styleB:l,valueA:d,valueB:c,onValueChange:u}){let h=cJ(),p=eg.useMemo(()=>o.find(e=>"shared"===d.type&&d.value===e.value)?.icon??"mixed",[o,d]),g=eg.useMemo(()=>s.find(e=>"shared"===c.type&&c.value===e.value)?.icon??"mixed",[s,c]);return void 0===d&&void 0===c?null:(0,j.jsxs)("div",{className:"tlui-style-panel__double-select-picker",children:[(0,j.jsx)("div",{title:h(e),className:"tlui-style-panel__double-select-picker-label",children:h(e)}),(0,j.jsxs)("div",{className:"tlui-buttons__horizontal",children:[(0,j.jsxs)(mw,{id:`style panel ${t} A`,children:[(0,j.jsx)(mc,{asChild:!0,onTouchEnd:e=>rE(e),children:(0,j.jsx)(c6,{type:"icon","data-testid":`style.${t}`,title:h(r)+"  "+(null===d||"mixed"===d.type?h("style-panel.mixed"):h(`${t}-style.${d.value}`)),icon:p,invertIcon:!0,smallIcon:!0})}),(0,j.jsx)(m_,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:(0,j.jsx)("div",{className:"tlui-buttons__grid",children:o.map(e=>(0,j.jsx)(mj,{type:"icon",title:h(r)+"  "+h(`${t}-style.${e.value}`),"data-testid":`style.${t}.${e.value}`,icon:e.icon,onClick:()=>u(a,e.value,!1),invertIcon:!0},e.value))})})]}),(0,j.jsxs)(mw,{id:`style panel ${n}`,children:[(0,j.jsx)(mc,{asChild:!0,onTouchEnd:e=>rE(e),children:(0,j.jsx)(c6,{type:"icon","data-testid":`style.${n}`,title:h(i)+"  "+(null===c||"mixed"===c.type?h("style-panel.mixed"):h(`${n}-style.${c.value}`)),icon:g,smallIcon:!0})}),(0,j.jsx)(m_,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:(0,j.jsx)("div",{className:"tlui-buttons__grid",children:s.map(e=>(0,j.jsx)(mj,{type:"icon",title:h(i)+"  "+h(`${n}-style.${e.value}`),"data-testid":`style.${n}.${e.value}`,icon:e.icon,onClick:()=>u(l,e.value,!1)},e.value))})})]})]})]})}),y2=eg.memo(function({id:e,label:t,uiType:n,style:r,items:i,type:o,value:s,onValueChange:a}){let l=cJ(),d=eg.useMemo(()=>i.find(e=>"shared"===s.type&&e.value===s.value)?.icon,[i,s]);return(0,j.jsxs)(mw,{id:`style panel ${e}`,children:[(0,j.jsx)(mc,{asChild:!0,onTouchEnd:e=>rE(e),children:(0,j.jsx)(c6,{type:o,"data-testid":`style.${n}`,title:"mixed"===s.type?l("style-panel.mixed"):l(`${n}-style.${s.value}`),label:t,icon:d??"mixed"})}),(0,j.jsx)(m_,{side:"left",align:"center",alignOffset:0,children:(0,j.jsx)("div",{className:"tlui-buttons__grid",children:i.map(e=>(0,j.jsx)(mj,{type:"icon","data-testid":`style.${n}.${e.value}`,title:l(`${n}-style.${e.value}`),icon:e.icon,onClick:()=>a(r,e.value,!1)},e.value))})})]})}),y5={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],horizontalAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-center"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"cloud",icon:"geo-cloud"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"star",icon:"geo-star"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},y3=function({isMobile:e}){let t=rR(),n=yk(),r=(0,eg.useCallback)(()=>{e||t.updateInstanceState({isChangingStyle:!1})},[t,e]);if(!n)return null;let{styles:i,opacity:o}=n,s=i.get(rn),a=i.get(n1),l=i.get(n0),d=i.get(rd),c=i.get(nZ);return(0,j.jsxs)("div",{className:"tlui-style-panel","data-ismobile":e,onPointerLeave:r,children:[(0,j.jsx)(y8,{styles:i,opacity:o}),void 0!==c&&(0,j.jsx)(y9,{styles:i}),!(void 0===s&&void 0===a&&void 0===l&&void 0===d)&&(0,j.jsxs)("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[(0,j.jsx)(y7,{styles:i}),(0,j.jsx)(bt,{styles:i}),(0,j.jsx)(be,{styles:i})]})]})};function y4(){let e=rR();return eg.useMemo(()=>function(t,n,r){e.batch(()=>{e.isIn("select")&&e.setStyleForSelectedShapes(t,n,{squashing:r}),e.setStyleForNextShapes(t,n,{squashing:r}),e.updateInstanceState({isChangingStyle:!0})})},[e])}let y6=[.1,.25,.5,.75,1];function y8({styles:e,opacity:t}){let n=rR(),r=cJ(),i=y4(),o=eg.useCallback((e,t)=>{let r=y6[e];n.batch(()=>{n.isIn("select")&&n.setOpacityForSelectedShapes(r,{ephemeral:t}),n.setOpacityForNextShapes(r,{ephemeral:t}),n.updateInstanceState({isChangingStyle:!0})})},[n]),s=e.get(nX),a=e.get(nq),l=e.get(nG),d=e.get(nJ),c="mixed"===t.type?-1:y6.indexOf(function(e,t){let n;let r=1/0;for(let i of e){let e=t(i);e<r&&(n=i,r=e)}return n}(y6,e=>Math.abs(e-t.value)));return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles",children:[void 0===s?null:(0,j.jsx)(yP,{title:r("style-panel.color"),uiType:"color",style:nX,items:y5.color,value:s,onValueChange:i}),void 0===t?null:(0,j.jsx)(y0,{"data-testid":"style.opacity",value:c>=0?c:y6.length-1,label:"mixed"===t.type?"style-panel.mixed":`opacity-style.${t.value}`,onValueChange:o,steps:y6.length-1,title:r("style-panel.opacity")})]}),(void 0!==a||void 0!==l||void 0!==d)&&(0,j.jsxs)("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[void 0===a?null:(0,j.jsx)(yP,{title:r("style-panel.fill"),uiType:"fill",style:nq,items:y5.fill,value:a,onValueChange:i}),void 0===l?null:(0,j.jsx)(yP,{title:r("style-panel.dash"),uiType:"dash",style:nG,items:y5.dash,value:l,onValueChange:i}),void 0===d?null:(0,j.jsx)(yP,{title:r("style-panel.size"),uiType:"size",style:nJ,items:y5.size,value:d,onValueChange:i})]})]})}function y9({styles:e}){let t=cJ(),n=y4(),r=e.get(nZ),i=e.get(re),o=e.get(rt);return void 0===r&&void 0===i?null:(0,j.jsxs)("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[void 0===r?null:(0,j.jsx)(yP,{title:t("style-panel.font"),uiType:"font",style:nZ,items:y5.font,value:r,onValueChange:n}),void 0===i?null:(0,j.jsxs)("div",{className:"tlui-style-panel__row",children:[(0,j.jsx)(yP,{title:t("style-panel.align"),uiType:"align",style:re,items:y5.horizontalAlign,value:i,onValueChange:n}),(0,j.jsx)("div",{className:"tlui-style-panel__row__extra-button",children:void 0===o?(0,j.jsx)(c6,{type:"icon",title:t("style-panel.vertical-align"),"data-testid":"vertical-align",icon:"vertical-align-center",disabled:!0}):(0,j.jsx)(y2,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",style:rt,items:y5.verticalAlign,value:o,onValueChange:n})})]})]})}function y7({styles:e}){let t=y4(),n=e.get(rn);return void 0===n?null:(0,j.jsx)(y2,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",style:rn,items:y5.geo,value:n,onValueChange:t})}function be({styles:e}){let t=y4(),n=e.get(rd);return void 0===n?null:(0,j.jsx)(y2,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",style:rd,items:y5.spline,value:n,onValueChange:t})}function bt({styles:e}){let t=y4(),n=e.get(n1),r=e.get(n0);return n&&r?(0,j.jsx)(y1,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:n0,itemsA:y5.arrowheadStart,valueA:r,uiTypeB:"arrowheadEnd",styleB:n1,itemsB:y5.arrowheadEnd,valueB:n,onValueChange:t,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"}):null}function bn({toast:e}){let{removeToast:t}=h7(),n=cJ(),r=e.actions&&e.actions.length>0;return(0,j.jsxs)(cE,{onOpenChange:n=>{n||t(e.id)},className:"tlui-toast__container",duration:e.keepOpen?1/0:5e3,children:[e.icon&&(0,j.jsx)("div",{className:"tlui-toast__icon",children:(0,j.jsx)(c0,{icon:e.icon})}),(0,j.jsxs)("div",{className:"tlui-toast__main",children:[(0,j.jsxs)("div",{className:"tlui-toast__content",children:[e.title&&(0,j.jsx)(cO,{className:"tlui-toast__title",children:e.title}),e.description&&(0,j.jsx)(cR,{className:"tlui-toast__description",children:e.description})]}),e.actions&&(0,j.jsxs)("div",{className:"tlui-toast__actions",children:[e.actions.map((e,t)=>(0,j.jsx)(cL,{altText:e.label,asChild:!0,onClick:e.onClick,children:(0,j.jsx)(c6,{type:e.type,children:e.label})},t)),(0,j.jsx)(cD,{asChild:!0,children:(0,j.jsx)(c6,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:e.closeLabel??n("toast.close")})})]})]}),!r&&(0,j.jsx)(cD,{asChild:!0,children:(0,j.jsx)(c6,{type:"normal",className:"tlui-toast__close",children:e.closeLabel??n("toast.close")})})]})}let br=eg.memo(function(){let{toasts:e}=h7();return(0,j.jsx)(j.Fragment,{children:e.map(e=>(0,j.jsx)(bn,{toast:e},e.id))})});function bi(){let{toasts:e}=h7(),[t,n]=eg.useState(!1);return(eg.useEffect(()=>{let t=!1;return e.length?n(!0):setTimeout(()=>{t||n(!1)},1e3),()=>{t=!0}},[e.length,n]),t)?(0,j.jsx)(ck,{className:"tlui-toast__viewport"}):null}var bo="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;function bs(e,t,n,r){e.addEventListener?e.addEventListener(t,n,r):e.attachEvent&&e.attachEvent("on".concat(t),function(){n(window.event)})}function ba(e,t){for(var n=t.slice(0,t.length-1),r=0;r<n.length;r++)n[r]=e[n[r].toLowerCase()];return n}function bl(e){"string"!=typeof e&&(e="");for(var t=(e=e.replace(/\s/g,"")).split(","),n=t.lastIndexOf("");n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}for(var bd={backspace:8,"":8,tab:9,clear:12,enter:13,"":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"":20,",":188,".":190,"/":191,"`":192,"-":bo?173:189,"=":bo?61:187,";":bo?59:186,"'":222,"[":219,"]":221,"\\":220},bc={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,cmd:91,command:91},bu={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},bh={16:!1,18:!1,17:!1,91:!1},bp={},bg=1;bg<20;bg++)bd["f".concat(bg)]=111+bg;var bf=[],bm=!1,by="all",bb=[],bv=function(e){return bd[e.toLowerCase()]||bc[e.toLowerCase()]||e.toUpperCase().charCodeAt(0)};function bx(e){by=e||"all"}function bS(){return by||"all"}var bw=function(e){var t=e.key,n=e.scope,r=e.method,i=e.splitKey,o=void 0===i?"+":i;bl(t).forEach(function(e){var t=e.split(o),i=t.length,s=t[i-1],a="*"===s?"*":bv(s);if(bp[a]){n||(n=bS());var l=i>1?ba(bc,t):[];bp[a]=bp[a].filter(function(e){return!((!r||e.method===r)&&e.scope===n&&function(e,t){for(var n=e.length>=t.length?e:t,r=e.length>=t.length?t:e,i=!0,o=0;o<n.length;o++)-1===r.indexOf(n[o])&&(i=!1);return i}(e.mods,l))})}})};function bC(e,t,n,r){var i;if(t.element===r&&(t.scope===n||"all"===t.scope)){for(var o in i=t.mods.length>0,bh)Object.prototype.hasOwnProperty.call(bh,o)&&(!bh[o]&&t.mods.indexOf(+o)>-1||bh[o]&&-1===t.mods.indexOf(+o))&&(i=!1);(0!==t.mods.length||bh[16]||bh[18]||bh[17]||bh[91])&&!i&&"*"!==t.shortcut||(t.keys=[],t.keys=t.keys.concat(bf),!1===t.method(e,t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0)))}}function b_(e,t){var n=bp["*"],r=e.keyCode||e.which||e.charCode;if(bk.filter.call(this,e)){if((93===r||224===r)&&(r=91),-1===bf.indexOf(r)&&229!==r&&bf.push(r),["ctrlKey","altKey","shiftKey","metaKey"].forEach(function(t){var n=bu[t];e[t]&&-1===bf.indexOf(n)?bf.push(n):!e[t]&&bf.indexOf(n)>-1?bf.splice(bf.indexOf(n),1):"metaKey"===t&&e[t]&&3===bf.length&&!(e.ctrlKey||e.shiftKey||e.altKey)&&(bf=bf.slice(bf.indexOf(n)))}),r in bh){for(var i in bh[r]=!0,bc)bc[i]===r&&(bk[i]=!0);if(!n)return}for(var o in bh)Object.prototype.hasOwnProperty.call(bh,o)&&(bh[o]=e[bu[o]]);e.getModifierState&&!(e.altKey&&!e.ctrlKey)&&e.getModifierState("AltGraph")&&(-1===bf.indexOf(17)&&bf.push(17),-1===bf.indexOf(18)&&bf.push(18),bh[17]=!0,bh[18]=!0);var s=bS();if(n)for(var a=0;a<n.length;a++)n[a].scope===s&&("keydown"===e.type&&n[a].keydown||"keyup"===e.type&&n[a].keyup)&&bC(e,n[a],s,t);if(r in bp){for(var l=0;l<bp[r].length;l++)if(("keydown"===e.type&&bp[r][l].keydown||"keyup"===e.type&&bp[r][l].keyup)&&bp[r][l].key){for(var d=bp[r][l],c=d.splitKey,u=d.key.split(c),h=[],p=0;p<u.length;p++)h.push(bv(u[p]));h.sort().join("")===bf.sort().join("")&&bC(e,d,s,t)}}}}function bk(e,t,n){bf=[];var r,i=bl(e),o=[],s="all",a=document,l=0,d=!1,c=!0,u="+",h=!1;for(void 0===n&&"function"==typeof t&&(n=t),"[object Object]"===Object.prototype.toString.call(t)&&(t.scope&&(s=t.scope),t.element&&(a=t.element),t.keyup&&(d=t.keyup),void 0!==t.keydown&&(c=t.keydown),void 0!==t.capture&&(h=t.capture),"string"==typeof t.splitKey&&(u=t.splitKey)),"string"==typeof t&&(s=t);l<i.length;l++)e=i[l].split(u),o=[],e.length>1&&(o=ba(bc,e)),(e="*"===(e=e[e.length-1])?"*":bv(e))in bp||(bp[e]=[]),bp[e].push({keyup:d,keydown:c,scope:s,mods:o,shortcut:i[l],method:n,key:i[l],splitKey:u,element:a});void 0!==a&&(r=a,!(bb.indexOf(r)>-1))&&window&&(bb.push(a),bs(a,"keydown",function(e){b_(e,a)},h),bm||(bm=!0,bs(window,"focus",function(){bf=[]},h)),bs(a,"keyup",function(e){b_(e,a),function(e){var t=e.keyCode||e.which||e.charCode,n=bf.indexOf(t);if(n>=0&&bf.splice(n,1),e.key&&"meta"===e.key.toLowerCase()&&bf.splice(0,bf.length),(93===t||224===t)&&(t=91),t in bh)for(var r in bh[t]=!1,bc)bc[r]===t&&(bk[r]=!1)}(e)},h))}var bP={getPressedKeyString:function(){return bf.map(function(e){return Object.keys(bd).find(function(t){return bd[t]===e})||Object.keys(bc).find(function(t){return bc[t]===e})||String.fromCharCode(e)})},setScope:bx,getScope:bS,deleteScope:function(e,t){var n,r;for(var i in e||(e=bS()),bp)if(Object.prototype.hasOwnProperty.call(bp,i))for(r=0,n=bp[i];r<n.length;)n[r].scope===e?n.splice(r,1):r++;bS()===e&&bx(t||"all")},getPressedKeyCodes:function(){return bf.slice(0)},getAllKeyCodes:function(){var e=[];return Object.keys(bp).forEach(function(t){bp[t].forEach(function(t){var n=t.key,r=t.scope,i=t.mods,o=t.shortcut;e.push({scope:r,shortcut:o,mods:i,keys:n.split("+").map(function(e){return bv(e)})})})}),e},isPressed:function(e){return"string"==typeof e&&(e=bv(e)),-1!==bf.indexOf(e)},filter:function(e){var t=e.target||e.srcElement,n=t.tagName,r=!0;return(t.isContentEditable||("INPUT"===n||"TEXTAREA"===n||"SELECT"===n)&&!t.readOnly)&&(r=!1),r},trigger:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";Object.keys(bp).forEach(function(n){bp[n].filter(function(n){return n.scope===t&&n.shortcut===e}).forEach(function(e){e&&e.method&&e.method()})})},unbind:function(e){if(void 0===e)Object.keys(bp).forEach(function(e){return delete bp[e]});else if(Array.isArray(e))e.forEach(function(e){e.key&&bw(e)});else if("object"==typeof e)e.key&&bw(e);else if("string"==typeof e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n[0],o=n[1];"function"==typeof i&&(o=i,i=""),bw({key:e,scope:i,method:o,splitKey:"+"})}},keyMap:bd,modifier:bc,modifierMap:bu};for(var bI in bP)Object.prototype.hasOwnProperty.call(bP,bI)&&(bk[bI]=bP[bI]);if("undefined"!=typeof window){var bE=window.hotkeys;bk.noConflict=function(e){return e&&window.hotkeys===bk&&(window.hotkeys=bE),bk},window.hotkeys=bk}let bj=["copy","cut","paste","asset"];function bM(e){return(function(e){"string"!=typeof e&&(e="");let t=(e=e.replace(/\s/g,"")).split(","),n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t})(e).map(e=>{let t=e.split("");return 1===t.length?t[0]:"!"===t[0]?`shift+${t[1]}`:"?"===t[0]?3===t.length&&"!"===t[1]?`alt+shift+${t[2]}`:`alt+${t[1]}`:"$"===t[0]?"!"===t[1]?`cmd+shift+${t[2]},ctrl+shift+${t[2]}`:"?"===t[1]?`cmd+\u2325+${t[2]},ctrl+alt+${t[2]}`:`cmd+${t[1]},ctrl+${t[1]}`:e}).join(",")}function bT(e){return e.getIsMenuOpen()||null!==e.getEditingShapeId()||e.getCrashingError()}function bA(){let e=rR(),t=cJ(),n=yk(),r=n?.styles.get(nX),i=nW({isDarkMode:e.user.getIsDarkMode()}),o=(r?.type==="shared"?i[r.value]:i.black).solid,s=e_("isHandOrEraserToolActive",()=>e.isInAny("hand","zoom","eraser","laser"),[e]),a=(0,eg.useCallback)(t=>{t||e.updateInstanceState({isChangingStyle:!1})},[e]);return(0,j.jsxs)(yn,{id:"style menu",onOpenChange:a,children:[(0,j.jsx)(yr,{disabled:s,children:(0,j.jsx)(c6,{type:"tool","data-testid":"mobile.styles",style:{color:s?"var(--color-muted-1)":o},title:t("style-panel.title"),children:(0,j.jsx)(c0,{icon:s?"blob":r?.type==="mixed"?"mixed":"blob"})})}),(0,j.jsx)(yi,{side:"top",align:"end",children:(0,j.jsx)(y3,{isMobile:!0})})]})}let bO=["select","hand","draw","eraser","text","zoom","laser","highlight"];function bR({activeToolId:e}){let t=rR(),n=pS(),r=cJ(),i=e_("is tool locked",()=>t.getInstanceState().isToolLocked,[t]);return!e||bO.includes(e)?null:(0,j.jsx)(c6,{type:"normal",title:r("action.toggle-tool-lock"),className:rm("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":n<5}),icon:i?"lock":"unlock",onClick:()=>t.updateInstanceState({isToolLocked:!i}),smallIcon:!0})}let bL=(0,eg.memo)(function(){let e=rR(),t=cJ(),n=pS(),r=eg.useRef(void 0),i=lY(),o=pK(),s=e_("current tool id",()=>e.getCurrentToolId(),[e]),a=e_("geo",()=>e.getSharedStyles().getAsKnownValue(rn),[e]),l=e=>e.label?`${t(e.label)} ${e.kbd?c3(e.kbd):""}`:"",d=o.find(e=>bN(e.toolItem,s,a)),{itemsInPanel:c,itemsInDropdown:u}=b$(),h=(0,eg.useMemo)(()=>{let e=u.find(e=>e===d);return e||(r.current||(r.current=u[0]),e=r.current,u.includes(e)||(e=u[0])),r.current=e,e},[d,u]);return(0,eg.useEffect)(()=>{let t=[...c,h];for(let n=0;n<Math.min(10,t.length);n++)bk(`${n+1}`.slice(-1),r=>{bT(e)||(rE(r),t[n].toolItem.onSelect("kbd"))});return()=>{bk.unbind("1,2,3,4,5,6,7,8,9,0")}},[h,e,c]),(0,j.jsx)("div",{className:"tlui-toolbar",children:(0,j.jsxs)("div",{className:"tlui-toolbar__inner",children:[(0,j.jsxs)("div",{className:"tlui-toolbar__left",children:[!i&&(0,j.jsxs)("div",{className:"tlui-toolbar__extras",children:[n<6&&!("hand"===s||"zoom"===s)&&(0,j.jsxs)("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[(0,j.jsx)(yf,{}),(0,j.jsx)(yp,{}),(0,j.jsx)(yg,{}),(0,j.jsx)(ys,{}),(0,j.jsx)(yo,{})]}),(0,j.jsx)(bR,{activeToolId:s})]}),(0,j.jsxs)("div",{className:rm("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":n<5}),children:[c.map(({toolItem:e})=>(0,j.jsx)(bz,{item:e,title:l(e),isSelected:bN(e,s,a)},e.id)),u.length?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(bz,{item:h.toolItem,title:l(h.toolItem),isSelected:bN(h.toolItem,s,a)},h.toolItem.id),(0,j.jsxs)(mw,{id:"toolbar overflow",modal:!1,children:[(0,j.jsx)(mC,{children:(0,j.jsx)(c6,{className:"tlui-toolbar__overflow",icon:"chevron-up",type:"tool","data-testid":"tools.more",title:t("tool-panel.more")})}),(0,j.jsx)(m_,{side:"top",align:"center",children:(0,j.jsx)(bD,{toolbarItems:u})})]})]}):null]})]}),n<5&&!i&&(0,j.jsx)("div",{className:"tlui-toolbar__tools",children:(0,j.jsx)(bA,{})})]})})}),bD=eS(function({toolbarItems:e}){let t=cJ();return(0,j.jsx)("div",{className:"tlui-buttons__grid",children:e.map(({toolItem:{id:e,meta:n,kbd:r,label:i,onSelect:o,icon:s}})=>(0,j.jsx)(mj,{type:"icon",className:"tlui-button-grid__button","data-testid":`tools.more.${e}`,"data-tool":e,"data-geo":n?.geo??"","aria-label":i,onClick:()=>o("toolbar"),title:i?`${t(i)} ${r?c3(r):""}`:"",icon:s},e))})});function bz({item:e,title:t,isSelected:n}){return(0,j.jsx)(c6,{type:"tool","data-testid":`tools.${e.id}`,"data-tool":e.id,"data-geo":e.meta?.geo??"","aria-label":e.label,title:t,icon:e.icon,"data-state":n?"selected":void 0,onClick:()=>e.onSelect("toolbar"),onTouchStart:t=>{rE(t),e.onSelect("toolbar")}})}let bN=(e,t,n)=>e.meta?.geo?"geo"===t&&n===e.meta?.geo:t===e.id;function b$(){let e=pS(),t=pK(),n=lY();return(0,eg.useMemo)(()=>{let r=t.filter(e=>!n||e.readonlyOk),i=Math.min(8,5+e),o=r.slice(0,i),s=r.slice(i);return s.length<=2?{itemsInPanel:r,itemsInDropdown:[]}:{itemsInPanel:o,itemsInDropdown:s}},[t,e,n])}eg.memo(function({shareZone:e,topZone:t,renderDebugMenuItems:n,children:r,hideUi:i,...o}){return(0,j.jsx)(pY,{...o,children:(0,j.jsx)(bF,{hideUi:i,shareZone:e,topZone:t,renderDebugMenuItems:n,children:r})})});let bF=eg.memo(function({children:e,hideUi:t,...n}){return(0,j.jsxs)(j.Fragment,{children:[e,t?null:(0,j.jsx)(bB,{...n})]})}),bB=eg.memo(function({shareZone:e,topZone:t,renderDebugMenuItems:n}){let r=rR(),i=cJ(),o=pS(),s=e_("isReadonlyMode",()=>r.getInstanceState().isReadonly,[r]),a=e_("focus",()=>r.getInstanceState().isFocusMode,[r]),l=e_("debug",()=>r.getInstanceState().isDebugMode,[r]);(function(){let e=rR(),t=lY(),n=pl(),r=pM(),i=e_("is focused",()=>e.getInstanceState().isFocused,[e]),{itemsInPanel:o}=b$();(0,eg.useEffect)(()=>{var o;if(!i)return;let s=e.getContainer();bk.setScope(e.store.id);let a=(t,n)=>{bk(t,{element:s,scope:e.store.id},n)};for(let r of Object.values(n))r.kbd&&(!t||r.readonlyOk)&&(bj.includes(r.id)||a(bM(r.kbd),t=>{bT(e)||(rE(t),r.onSelect("kbd"))}));for(let t of Object.values(r))t.kbd&&(t.readonlyOk||!e.getInstanceState().isReadonly)&&(bj.includes(t.id)||a(bM(t.kbd),n=>{bT(e)||(rE(n),t.onSelect("kbd"))}));return a(",",t=>{if(bT(e)||e.inputs.keys.has("Comma"))return;rE(t),s.focus(),e.inputs.keys.add("Comma");let{x:n,y:r,z:i}=e.inputs.currentScreenPoint,o={type:"pointer",name:"pointer_down",point:{x:n,y:r,z:i},shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey,pointerId:0,button:0,isPen:e.getInstanceState().isPenMode,target:"canvas"};e.dispatch(o)}),o=t=>{if(bT(e)||!e.inputs.keys.has("Comma"))return;e.inputs.keys.delete("Comma");let{x:n,y:r,z:i}=e.inputs.currentScreenPoint,o={type:"pointer",name:"pointer_up",point:{x:n,y:r,z:i},shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey,pointerId:0,button:0,isPen:e.getInstanceState().isPenMode,target:"canvas"};e.dispatch(o)},bk(",",{element:s,keyup:!0,keydown:!1,scope:e.store.id},o),()=>{bk.deleteScope(e.store.id)}},[n,r,t,e,i,o])})(),function(){let e=rR(),t=hB(),n=e_("editor.isFocused",()=>e.getInstanceState().isFocused,[e]);(0,eg.useEffect)(()=>{if(!n)return;let r=()=>{0===e.getSelectedShapeIds().length||null!==e.getEditingShapeId()||hY(e)||(hQ(e),t("copy",{source:"kbd"}))};function i(){0===e.getSelectedShapeIds().length||null!==e.getEditingShapeId()||hY(e)||(hQ(e),e.deleteShapes(e.getSelectedShapeIds()),t("cut",{source:"kbd"}))}let o=!1,s=e=>{1===e.button&&(o=!0,requestAnimationFrame(()=>{o=!1}))},a=n=>{if(o){n.stopPropagation();return}null!==e.getEditingShapeId()||hY(e)||(n.clipboardData&&!e.inputs.shiftKey?hq(e,n.clipboardData):navigator.clipboard.read().then(t=>{Array.isArray(t)&&t[0]instanceof ClipboardItem&&hZ(e,t,e.inputs.currentPagePoint)}),t("paste",{source:"kbd"}))};return document.addEventListener("copy",r),document.addEventListener("cut",i),document.addEventListener("paste",a),document.addEventListener("pointerup",s),()=>{document.removeEventListener("copy",r),document.removeEventListener("cut",i),document.removeEventListener("paste",a),document.removeEventListener("pointerup",s)}},[e,t,n])}(),function(){let e=rR(),{addToast:t}=h7();(0,eg.useEffect)(()=>{function n({name:e,count:n}){t({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${e} (${n}). Please delete some shapes or move to a different page to continue.`})}return e.addListener("max-shapes",n),()=>{e.removeListener("max-shapes",n)}},[e,t])}();let{"toggle-focus-mode":d}=pl();return(0,j.jsx)(cS,{children:(0,j.jsxs)("div",{className:rm("tlui-layout",{"tlui-layout__mobile":o<5}),"data-breakpoint":o,children:[a?(0,j.jsx)("div",{className:"tlui-layout__top",children:(0,j.jsx)(c6,{type:"icon",className:"tlui-focus-button",title:`${i("focus-mode.toggle-focus-mode")}`,icon:"dot",onClick:()=>d.onSelect("menu")})}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("div",{className:"tlui-layout__top",children:[(0,j.jsxs)("div",{className:"tlui-layout__top__left",children:[(0,j.jsx)(ym,{}),(0,j.jsxs)("div",{className:"tlui-helper-buttons",children:[(0,j.jsx)(yw,{}),(0,j.jsx)(pX,{}),(0,j.jsx)(yC,{})]})]}),(0,j.jsx)("div",{className:"tlui-layout__top__center",children:t}),(0,j.jsxs)("div",{className:"tlui-layout__top__right",children:[e,o>=5&&!s&&(0,j.jsx)("div",{className:"tlui-style-panel__wrapper",children:(0,j.jsx)(y3,{})})]})]}),(0,j.jsxs)("div",{className:"tlui-layout__bottom",children:[(0,j.jsxs)("div",{className:"tlui-layout__bottom__main",children:[(0,j.jsx)(yS,{}),(0,j.jsx)(bL,{}),o>=4&&(0,j.jsx)(mY,{})]}),l&&(0,j.jsx)(mO,{renderDebugMenuItems:n??null})]})]}),(0,j.jsx)(br,{}),(0,j.jsx)(mV,{}),(0,j.jsx)(bi,{}),(0,j.jsx)(mU,{})]})})}),bV="ContextMenu",[bU,bK]=d2(bV,[fk]),bH=fk(),[bY,bW]=bU(bV),bX=(0,eg.forwardRef)((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=bW("ContextMenuContent",n),o=bH(n),s=(0,eg.useRef)(!1);return(0,eg.createElement)(f$,dZ({},o,r,{ref:t,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:t=>{var n;null===(n=e.onCloseAutoFocus)||void 0===n||n.call(e,t),!t.defaultPrevented&&s.current&&t.preventDefault(),s.current=!1},onInteractOutside:t=>{var n;null===(n=e.onInteractOutside)||void 0===n||n.call(e,t),t.defaultPrevented||i.modal||(s.current=!0)},style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),bG=(0,eg.forwardRef)((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=bH(n);return(0,eg.createElement)(fU,dZ({},i,r,{ref:t}))}),bq=(0,eg.forwardRef)((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=bH(n);return(0,eg.createElement)(fY,dZ({},i,r,{ref:t}))}),bZ=(0,eg.forwardRef)((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=bH(n);return(0,eg.createElement)(fX,dZ({},i,r,{ref:t}))}),bJ=(0,eg.forwardRef)((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=bH(n);return(0,eg.createElement)(f4,dZ({},i,r,{ref:t}))}),bQ=(0,eg.forwardRef)((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=bH(n);return(0,eg.createElement)(f6,dZ({},i,r,{ref:t,style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),b0=e=>{let{__scopeContextMenu:t,...n}=e,r=bH(t);return(0,eg.createElement)(mn,dZ({},r,n))},b1=e=>{let{__scopeContextMenu:t,children:n,onOpenChange:r,open:i,defaultOpen:o}=e,s=bH(t),[a,l]=cu({prop:i,defaultProp:o,onChange:r});return(0,eg.createElement)(mr,dZ({},s,{open:a,onOpenChange:l}),n)},b2=eS(function(){let e=rR(),t=rz(),n=e.getPages(),r=e.getCurrentPageId(),i=cJ(),{addToast:o}=h7();return(0,j.jsxs)(b1,{children:[(0,j.jsx)(bJ,{dir:"ltr",asChild:!0,children:(0,j.jsx)(c6,{type:"menu",label:"context-menu.move-to-page","data-testid":"menu-item.move-to-page",icon:"chevron-right"})}),(0,j.jsx)(b0,{container:t,children:(0,j.jsxs)(bQ,{className:"tlui-menu",sideOffset:-4,collisionPadding:4,children:[(0,j.jsx)(bG,{dir:"ltr",className:"tlui-menu__group","data-testid":"menu-item.pages",children:n.map(t=>(0,j.jsx)(bq,{disabled:r===t.id,onSelect:()=>{e.mark("move_shapes_to_page"),e.moveShapesToPage(e.getSelectedShapeIds(),t.id);let n=e.getPage(t.id);n&&o({title:"Changed Page",description:`Moved to ${n.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{e.mark("change-page"),e.setCurrentPage(r)}}]})},asChild:!0,children:(0,j.jsx)(c6,{type:"menu",title:t.name,className:"tlui-context-menu__move-to-page__name",children:(0,j.jsx)("span",{className:"tlui-button__label",children:t.name})})},t.id))},"pages"),(0,j.jsx)(bG,{dir:"ltr",className:"tlui-menu__group","data-testid":"menu-item.new-page",children:(0,j.jsx)(bq,{onSelect:()=>{let t=t6.createId(),n=e.getSelectedShapeIds();e.batch(()=>{e.mark("move_shapes_to_page"),e.createPage({name:i("page-menu.new-page-initial-name"),id:t}),e.moveShapesToPage(n,t)})},asChild:!0,children:(0,j.jsx)(c6,{type:"menu",title:i("context.pages.new-page"),className:"tlui-context-menu__move-to-page__name",children:(0,j.jsx)("span",{className:"tlui-button__label",children:i("context.pages.new-page")})})},"new-page")},"new-page")]})})]})});(0,eg.forwardRef)(function(){let e=rR(),t=cJ(),n=function(){let e=eg.useContext(pP);if(!e)throw Error("useContextMenuSchema must be used inside of a TLUiContextMenuSchemaProvider.");return e}(),[r,i]=mS("context menu sub"),o=lY(),s=pS(),a=rz(),[l,d]=(0,eg.useState)(!1);return(0,j.jsx)(b0,{container:a,children:(0,j.jsx)(bX,{className:"tlui-menu scrollable","data-testid":"context-menu",alignOffset:-4,collisionPadding:4,onContextMenu:rE,children:n.map(n=>(function e(n,r,c,u){if(!r||o&&!r.readonlyOk)return null;switch(r.type){case"custom":if("MOVE_TO_PAGE_MENU"===r.id)return(0,j.jsx)(b2,{},r.id);break;case"group":return(0,j.jsx)(bG,{dir:"ltr",className:rm("tlui-menu__group",{"tlui-menu__group__small":c?.type==="submenu"}),"data-testid":`menu-item.${r.id}`,children:r.children.map(t=>e(n,t,r,u+1))},r.id);case"submenu":return(0,j.jsxs)(b1,{onOpenChange:i,children:[(0,j.jsx)(bJ,{dir:"ltr",disabled:r.disabled,asChild:!0,children:(0,j.jsx)(c6,{type:"menu",label:r.label,"data-testid":`menu-item.${r.id}`,icon:"chevron-right"})}),(0,j.jsx)(b0,{container:a,children:(0,j.jsx)(bQ,{className:"tlui-menu",sideOffset:-4,collisionPadding:4,children:r.children.map(t=>e(n,t,r,u+1))})})]},r.id);case"item":{if(o&&!r.readonlyOk)return null;let{id:e,checkbox:n,contextMenuLabel:i,label:a,onSelect:c,kbd:h,icon:p}=r.actionItem,g=i??a,f=g?t(g):void 0;if(n)return(0,j.jsxs)(bZ,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",disabled:r.disabled,onSelect:e=>{c("context-menu"),rE(e)},title:f||void 0,checked:r.checked,children:[(0,j.jsx)(c0,{small:!0,icon:r.checked?"check":"checkbox-empty"}),f&&(0,j.jsx)("span",{className:"tlui-button__label",draggable:!1,children:f}),h&&(0,j.jsx)(c4,{children:h})]},e);return(0,j.jsx)(bq,{dir:"ltr",asChild:!0,children:(0,j.jsx)(c6,{type:"menu","data-testid":`menu-item.${e}`,kbd:h,label:g,disabled:r.disabled,iconLeft:s<3&&u>2?p:void 0,onClick:()=>{l?d(!1):c("context-menu")}})},e)}}})(e,n,null,0))})})});var b5=((y=b5||{})[y.SUCCESS=0]="SUCCESS",y[y.FAILED=1]="FAILED",y[y.WAITING=2]="WAITING",y),b3=((b=b3||{}).Sticky="sticky",b.Ellipse="ellipse",b.Rectangle="rectangle",b.Triangle="triangle",b.Draw="draw",b.Arrow="arrow",b.Text="text",b.Group="group",b.Image="image",b.Video="video",b),b4=((v=b4||{}).White="white",v.LightGray="lightGray",v.Gray="gray",v.Black="black",v.Green="green",v.Cyan="cyan",v.Blue="blue",v.Indigo="indigo",v.Violet="violet",v.Red="red",v.Orange="orange",v.Yellow="yellow",v),b6=((x=b6||{}).Small="small",x.Medium="medium",x.Large="large",x),b8=((S=b8||{}).Draw="draw",S.Solid="solid",S.Dashed="dashed",S.Dotted="dotted",S),b9=((w=b9||{}).Start="start",w.Middle="middle",w.End="end",w.Justify="justify",w),b7=((C=b7||{}).Script="script",C.Sans="sans",C.Serif="serif",C.Mono="mono",C),ve=((_=ve||{}).Arrow="arrow",_),vt=((k=vt||{}).Image="image",k.Video="video",k);tT({tldrawFileFormatVersion:tP,schema:tT({schemaVersion:tk,storeVersion:tk,recordVersions:(P=tT({version:tk,subTypeVersions:new tb(tS,tk).optional(),subTypeKey:tS.optional()}),new tb(tS,P))}),records:tM(tT({id:tS,typeName:tS}).allowUnknownProperties())});let vn=`You are an expert web developer who has spent the last twelve thousand years building functional website prototypes for designers. You are a wise and ancient developer. You are the best at what you do. Your total compensation is $1.2m with annual refreshers. You've just drank three cups of coffee and are laser focused. Welcome to a new day at your job!

# Working from wireframes

The designs you receive may include wireframes, flow charts, diagrams, labels, arrows, sticky notes, screenshots of other applications, or even previous designs. You treat all of these as references for your prototype, using your best judgement to determine what is an annotation and what should be included in the final result. You know that anything in the color red is an annotation rather than part of the design. 

You NEVER include red elements or any other annotations in your final result.

# Building your prototype

When provided with low-fidelity designs, you first think about what you see: what are the design elements? What are the different screens? What are the sections? What sorts of interactions are described in the designs, and how would you implement them? Are there icons, images, or drawings in the designs? This phase is essential in coming up with your plan for the prototype.

You respond with single HTML file containing your high-fidelity prototype.

- You use tailwind CSS for styling. If you must use other CSS, you place it in a style tag.
- You write excellent JavaScript. You put any JavaScript you need in a script tag.
- If you require any external dependencies, you import them from Unpkg.
- You use Google fonts to pull in any open source fonts you require.
- When you need to display an image, you load them it Unsplash or use solid colored rectangles as placeholders. 

If there are any questions or underspecified features, you rely on your extensive knowledge of user experience and website design patterns to "fill in the blanks". You know that a good guess is better than an incomplete prototype.

Above all, you love your designers and want them to be happy. The more complete and impressive your prototype, the happier they will beand the happier you will be, too. Good luck! You've got this! Age quod agis! Virtute et armis!   !`;async function vr({image:e,apiKey:t,text:n,grid:r,theme:i="light",previousPreviews:o=[]}){if(!t)throw Error("You need to provide an API key (sorry)");let s=[{role:"system",content:vn},{role:"user",content:[]}],a=s[1].content;a.push({type:"text",text:o?.length>0?"Your designers have just requested a wireframe for these designs. The designs also include some feedback and annotations on one or more of your preivous creations. Respond the COMPLETE prototype as a single HTML file beginning with ```html and ending with ```":"Your designers have just requested a wireframe for these designs. Respond the COMPLETE prototype as a single HTML file beginning with ```html and ending with ```"}),a.push({type:"image_url",image_url:{url:e,detail:"high"}}),n&&a.push({type:"text",text:`Here's a list of text that we found in the design:
${n}`}),r&&a.push({type:"text",text:`The designs have a ${r.color} grid overlaid on top. Each cell of the grid is ${r.size}x${r.size}px.`});for(let e=0;e<o.length;e++){let t=o[e];a.push({type:"text",text:"The designs also included one of your previous result. Here's the image that you used as its source:"},{type:"text",text:`And here's the HTML you came up with for it: ${t.props.html}`})}a.push({type:"text",text:`Please make your result use the ${i} theme.`});let l=null;try{let e=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({model:"gpt-4o-mini",max_tokens:4096,temperature:0,messages:s,seed:42,n:1})});l=await e.json()}catch(e){throw Error(`Could not contact OpenAI: ${e.message}`)}return l}async function vi(e,t){let n=e.getSelectedShapes();if(0===n.length)throw Error("First select something to make real.");let{maxX:r,midY:i}=e.getSelectionPageBounds(),o=nB();e.createShape({id:o,type:"response",x:r+60,y:i-180,props:{html:""}});let s=await e.getSvg(n,{scale:1,background:!0});if(!s)return;let a={color:"red",size:100,labels:!0};if(function(e,t={}){let{color:n="#00F",size:r=100,labels:i=!0}=t,[o,s,a,l]=e.getAttribute("viewBox").split(" ").map(e=>+e),d=document.createElementNS("http://www.w3.org/2000/svg","g");d.setAttribute("transform",`translate(${o}, ${s})`),d.setAttribute("id","grid"),d.setAttribute("stroke",n),d.setAttribute("stroke-width","1"),i&&(d.setAttribute("font","10px/10px normal Serif"),d.setAttribute("fill",n),d.setAttribute("text-anchor","middle"));for(let e=0;e<Math.ceil(a/r);e++){if(e>0){let t=document.createElementNS("http://www.w3.org/2000/svg","line");t.setAttribute("x1",`${e*r}`),t.setAttribute("y1","0"),t.setAttribute("x2",`${e*r}`),t.setAttribute("y2",`${l}`),d.appendChild(t)}if(i){let t=document.createElementNS("http://www.w3.org/2000/svg","text");t.setAttribute("x",`${100*e+50}`),t.setAttribute("y","16"),t.textContent=String.fromCharCode(97+e).toUpperCase(),d.appendChild(t)}}for(let e=0;e<Math.ceil(l/r);e++){let t=document.createElementNS("http://www.w3.org/2000/svg","line");if(t.setAttribute("x1","0"),t.setAttribute("y1",`${e*r}`),t.setAttribute("x2",`${a}`),t.setAttribute("y2",`${e*r}`),d.appendChild(t),i){let t=document.createElementNS("http://www.w3.org/2000/svg","text");t.setAttribute("x","12"),t.setAttribute("y",`${100*e+50}`),t.textContent=`${e}`,d.appendChild(t)}}e.appendChild(d)}(s,a),!s)throw Error("Could not get the SVG.");let l=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),d=await h0(s,l,{type:"png",quality:.8,scale:1}),c=await new Promise((e,t)=>{let n=new FileReader;n.onloadend=()=>e(n.result),n.readAsDataURL(d)}),u=n.filter(e=>"response"===e.type);try{let n=await vr({image:c,apiKey:t,text:function(e){let t=e.getSelectedShapeIds();return Array.from(e.getShapeAndDescendantIds(t)).map(t=>e.getShape(t)).filter(e=>"text"===e.type||"geo"===e.type||"arrow"===e.type||"note"===e.type).sort((t,n)=>{let r=e.getShapePageBounds(t),i=e.getShapePageBounds(n);return r.y===i.y?r.x<i.x?-1:1:r.y<i.y?-1:1}).map(e=>{if(!e)return null;let t=e.props.text??null;return"red"===e.props.color?`Annotation: ${t}`:t}).filter(e=>!!e).join("\n")}(e),previousPreviews:u,grid:a,theme:e.user.getUserPreferences().isDarkMode?"dark":"light"});if(!n)throw Error("Could not contact OpenAI.");if(n?.error)throw Error(`${n.error.message?.slice(0,128)}...`);let r=n.choices[0].message.content,i=r.indexOf("<!DOCTYPE html>"),s=r.indexOf("</html>"),l=r.slice(i,s+7);if(l.length<100)throw console.warn(r),Error("Could not generate a design from those wireframes.");e.updateShape({id:o,type:"response",props:{html:l}}),console.log(`Response: ${r}`)}catch(t){throw e.deleteShape(o),t}}function vo(){let e=rR(),{addToast:t}=h7(),n=(0,eg.useCallback)(async()=>{try{let t=document.getElementById("openai_key_risky_but_cool"),n=t?.value??null;if(!n)throw Error("Make sure the input includes your API Key!");await vi(e,n)}catch(e){console.error(e),t({icon:"cross-2",title:"Something went wrong",description:e.message.slice(0,100)})}},[e,t]);return j.jsx("button",{className:"makeRealButton",onClick:n,children:"Make Real"})}function vs(){let e=pS();return j.jsx("a",{className:`tldrawLogo ${e<5?"tldrawLogo__mobile":""}`,href:"https://www.tldraw.dev",children:(0,j.jsxs)("svg",{width:"110",height:"40",viewBox:"0 0 71 18",fill:"none",style:{padding:8},children:[j.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0 1.97802C0 0.88559 0.848303 0 1.89474 0H16.1053C17.1517 0 18 0.885591 18 1.97802V16.022C18 17.1144 17.1517 18 16.1053 18H1.89474C0.848303 18 0 17.1144 0 16.022V1.97802ZM10.6264 5.14801C10.6264 5.58302 10.4777 5.95212 10.1803 6.25531C9.88296 6.5585 9.52095 6.71009 9.0943 6.71009C8.65471 6.71009 8.28624 6.5585 7.98888 6.25531C7.69151 5.95212 7.54283 5.58302 7.54283 5.14801C7.54283 4.71301 7.69151 4.34391 7.98888 4.04072C8.28624 3.73753 8.65471 3.58594 9.0943 3.58594C9.52095 3.58594 9.88296 3.73753 10.1803 4.04072C10.4777 4.34391 10.6264 4.71301 10.6264 5.14801ZM7.52344 10.6224C7.52344 10.1874 7.67212 9.81831 7.96948 9.51512C8.27978 9.19875 8.65471 9.04056 9.0943 9.04056C9.50802 9.04056 9.87003 9.19875 10.1803 9.51512C10.4906 9.81831 10.6716 10.161 10.7233 10.5433C10.8268 11.2552 10.6975 11.9604 10.3355 12.659C9.98639 13.3577 9.48216 13.8916 8.82279 14.2607C8.46078 14.4716 8.16342 14.465 7.9307 14.2409C7.71091 14.03 7.77555 13.7795 8.12463 13.4895C8.31856 13.3445 8.48017 13.16 8.60946 12.9359C8.73875 12.7118 8.82279 12.4811 8.86158 12.2438C8.87451 12.1384 8.82925 12.0856 8.72582 12.0856C8.46725 12.0724 8.2022 11.9274 7.9307 11.6506C7.65919 11.3738 7.52344 11.0311 7.52344 10.6224Z",fill:"#000000"}),j.jsx("path",{d:"M34.156 14.5761C34.2636 14.5761 34.3174 14.5223 34.3174 14.4147V12.2234C34.3174 12.0073 34.1422 11.8321 33.9261 11.8321H33.6424C33.5543 11.8321 33.4859 11.8076 33.437 11.7587C33.3978 11.7196 33.3783 11.6609 33.3783 11.5826V3.73207C33.3783 3.62446 33.3245 3.57065 33.2168 3.57065H30.7467C30.5306 3.57065 30.3554 3.74585 30.3554 3.96196V12.463C30.3554 13.1674 30.556 13.6957 30.9571 14.0478C31.3582 14.4 31.8717 14.5761 32.4978 14.5761H34.156Z",fill:"#000000"}),j.jsx("path",{d:"M29.0935 12.2087C29.0935 11.9926 28.9183 11.8174 28.7022 11.8174H27.6701C27.3375 11.8174 27.1125 11.7587 26.9951 11.6413C26.8484 11.5043 26.775 11.2842 26.775 10.981V9.68478C26.775 9.46867 26.9502 9.29348 27.1663 9.29348H28.7022C28.9183 9.29348 29.0935 9.11829 29.0935 8.90217V6.71087C29.0935 6.60326 29.0397 6.54946 28.9321 6.54946H27.1663C26.9502 6.54946 26.775 6.37426 26.775 6.15815V4.46576C26.775 4.35815 26.7212 4.30435 26.6136 4.30435H24.2315C24.0154 4.30435 23.8402 4.47954 23.8402 4.69565V6.15815C23.8402 6.37426 23.665 6.54946 23.4489 6.54946H23.087C22.8708 6.54946 22.6957 6.72465 22.6957 6.94076V9.13207C22.6957 9.23967 22.7495 9.29348 22.8571 9.29348H23.4489C23.665 9.29348 23.8402 9.46867 23.8402 9.68478V11.2011C23.8402 12.3359 24.1386 13.1821 24.7353 13.7397C25.3321 14.2973 26.1978 14.5761 27.3326 14.5761H28.9321C29.0397 14.5761 29.0935 14.5223 29.0935 14.4147V12.2087Z",fill:"#000000"}),j.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M37.6867 6.40272C38.1367 6.40272 38.5231 6.51522 38.8459 6.74022C39.1499 6.94586 39.4008 7.21279 39.5985 7.54101C39.6332 7.59855 39.6947 7.63533 39.7619 7.63533C39.8638 7.63533 39.9464 7.55268 39.9464 7.45074V3.96196C39.9464 3.74584 40.1216 3.57065 40.3377 3.57065H42.7198C42.8274 3.57065 42.8812 3.62446 42.8812 3.73207V14.1848C42.8812 14.4009 42.706 14.5761 42.4899 14.5761H40.1079C40.0002 14.5761 39.9464 14.5223 39.9464 14.4147V13.5333C39.9464 13.4285 39.8614 13.3435 39.7566 13.3435C39.692 13.3435 39.6321 13.3765 39.596 13.4301C39.3462 13.8013 39.0668 14.1051 38.7579 14.3413C38.4252 14.5957 38.0095 14.7228 37.5106 14.7228C36.8356 14.7228 36.3024 14.4929 35.9111 14.0332C35.5198 13.5734 35.3242 12.9571 35.3242 12.1842V9.10272C35.3242 8.26141 35.5247 7.60109 35.9258 7.12174C36.3367 6.64239 36.9236 6.40272 37.6867 6.40272ZM38.4204 11.9348C38.528 12.0522 38.7187 12.1109 38.9926 12.1109C39.2693 12.1109 39.5126 12.0774 39.7224 12.0105C39.8636 11.9655 39.9464 11.8265 39.9464 11.6783V9.35616C39.9464 9.22533 39.8827 9.09961 39.7647 9.04299C39.6723 8.9986 39.5763 8.9647 39.4769 8.94131C39.3106 8.89239 39.1492 8.86793 38.9926 8.86793C38.4937 8.86793 38.2443 9.11739 38.2443 9.6163V11.3772C38.2443 11.6413 38.303 11.8272 38.4204 11.9348Z",fill:"#000000"}),j.jsx("path",{d:"M47.1839 14.5761C47.4001 14.5761 47.5752 14.4009 47.5752 14.1848V10.0559C47.5752 9.91955 47.6451 9.79072 47.7678 9.73131C47.8883 9.67299 48.0148 9.62487 48.1475 9.58696C48.353 9.51848 48.5829 9.48424 48.8372 9.48424C49.0231 9.48424 49.1992 9.49891 49.3655 9.52826C49.5291 9.55553 49.6884 9.59123 49.8436 9.63539C49.8671 9.64209 49.8915 9.64565 49.916 9.64565C50.0577 9.64565 50.1725 9.5308 50.1725 9.38912V6.71087C50.1725 6.64239 50.1481 6.5837 50.0992 6.53478C50.0698 6.50544 50.016 6.47609 49.9378 6.44674C49.8595 6.41739 49.7421 6.40272 49.5856 6.40272C49.1258 6.40272 48.7589 6.54457 48.485 6.82826C48.2423 7.07994 48.0533 7.44725 47.918 7.93019C47.8966 8.00665 47.8277 8.06087 47.7483 8.06087C47.6527 8.06087 47.5752 7.9834 47.5752 7.88783V6.71087C47.5752 6.60326 47.5214 6.54946 47.4138 6.54946H44.9878C44.7716 6.54946 44.5964 6.72465 44.5964 6.94076V14.4147C44.5964 14.5223 44.6502 14.5761 44.7579 14.5761H47.1839Z",fill:"#000000"}),j.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M58.368 9.41087V11.788C58.368 11.9085 58.4096 11.9874 58.4929 12.0246C58.5165 12.0351 58.5407 12.0441 58.5651 12.0526C58.5923 12.0621 58.6196 12.0668 58.6468 12.0668H58.6664C58.8825 12.0668 59.0577 12.242 59.0577 12.4582V14.4147C59.0577 14.5223 59.0039 14.5761 58.8963 14.5761H57.9131C57.4338 14.5761 56.9936 14.4783 56.5925 14.2826C56.2443 14.1085 55.9774 13.857 55.7919 13.528C55.7494 13.4526 55.6716 13.4022 55.585 13.4022C55.5009 13.4022 55.4244 13.4497 55.3826 13.5227C55.1746 13.8859 54.9029 14.1735 54.5675 14.3853C54.2055 14.6103 53.7408 14.7228 53.1734 14.7228C52.4887 14.7228 51.9457 14.537 51.5446 14.1652C51.1436 13.7935 50.943 13.2897 50.943 12.6538V12.0815C50.943 11.3967 51.1436 10.8587 51.5446 10.4674C51.9555 10.0761 52.5327 9.88044 53.2762 9.88044H55.3305C55.444 9.88044 55.5359 9.78846 55.5359 9.675C55.5359 9.33261 55.443 9.10272 55.2571 8.98533C55.0811 8.85815 54.7387 8.79457 54.23 8.79457C53.3815 8.79457 52.5424 8.91812 51.7129 9.16522C51.6889 9.17237 51.664 9.17609 51.6389 9.17609C51.4977 9.17609 51.3832 9.06162 51.3832 8.92041V7.0337C51.3832 6.96522 51.3979 6.9163 51.4273 6.88696C51.4957 6.81848 51.6816 6.74511 51.9849 6.66685C52.2979 6.58859 52.6745 6.52011 53.1148 6.46141C53.5647 6.39294 54.0245 6.3587 54.4941 6.3587C55.8343 6.3587 56.8126 6.60326 57.4289 7.09239C58.055 7.57174 58.368 8.34457 58.368 9.41087ZM54.1566 12.6098C54.5823 12.6098 54.9796 12.5136 55.3484 12.3213C55.4677 12.259 55.5359 12.1319 55.5359 11.9972V11.6951C55.5359 11.479 55.3608 11.3038 55.1446 11.3038H54.1859C54.0196 11.3038 53.8925 11.3478 53.8044 11.4359C53.7262 11.5337 53.687 11.6511 53.687 11.788V12.1402C53.687 12.4533 53.8436 12.6098 54.1566 12.6098Z",fill:"#000000"}),j.jsx("path",{d:"M64.2831 6.54946C64.1006 6.54946 63.9423 6.67566 63.9017 6.85362C63.6938 7.76648 63.5017 8.62378 63.3255 9.42554C63.1518 10.2575 63.0208 11.0466 62.9326 11.7931C62.922 11.8821 62.8468 11.9495 62.7573 11.9495C62.6585 11.9495 62.5792 11.8681 62.5807 11.7694C62.5921 11.0174 62.5616 10.2655 62.4891 9.51359C62.4206 8.70163 62.3326 7.79674 62.225 6.79891C62.2152 6.69131 62.1956 6.62283 62.1663 6.59348C62.1369 6.56413 62.0929 6.54946 62.0342 6.54946H59.9316C59.6887 6.54946 59.5045 6.76857 59.5457 7.008C59.7421 8.14646 59.9308 9.28491 60.1119 10.4234C60.3271 11.7147 60.5424 12.9571 60.7576 14.1505C60.7911 14.3014 60.8282 14.4092 60.8689 14.4739C60.8815 14.4939 60.8984 14.5108 60.918 14.5242C60.9687 14.5588 61.0228 14.5761 61.0804 14.5761H63.6985C63.8764 14.5761 64.032 14.456 64.0769 14.2839C64.1528 13.9935 64.2202 13.7339 64.2793 13.5049C64.3576 13.2016 64.426 12.9033 64.4847 12.6098C64.5434 12.3163 64.6021 11.9935 64.6608 11.6413C64.7227 11.3145 64.7885 10.9198 64.8583 10.4574C64.8714 10.3704 64.9461 10.306 65.034 10.306C65.1228 10.306 65.1979 10.3717 65.2098 10.4597C65.2695 10.902 65.3213 11.2812 65.3652 11.5973C65.4239 11.9397 65.4777 12.2429 65.5266 12.5071C65.5853 12.7614 65.644 13.0207 65.7027 13.2848C65.7614 13.5391 65.8299 13.8326 65.9081 14.1652C65.95 14.3076 65.9919 14.4106 66.0338 14.4741C66.0468 14.4939 66.0637 14.5108 66.0832 14.5242C66.1339 14.5588 66.188 14.5761 66.2456 14.5761H68.9092C69.0998 14.5761 69.2627 14.4388 69.2949 14.251L69.9141 10.6435C70.1391 9.33261 70.3592 8.03152 70.5744 6.74022C70.5842 6.61304 70.5402 6.54946 70.4424 6.54946H68.1855C67.9841 6.54946 67.8155 6.70245 67.7962 6.90299C67.712 7.77975 67.6353 8.61081 67.5663 9.3962C67.5027 10.2129 67.4729 11.0044 67.4767 11.7706C67.4772 11.8691 67.3978 11.9495 67.2993 11.9495C67.2091 11.9495 67.1334 11.8815 67.123 11.7918C67.0341 11.0294 66.8982 10.2455 66.7152 9.44022C66.5293 8.57935 66.3239 7.66957 66.0989 6.71087C66.0695 6.60326 66.0108 6.54946 65.9228 6.54946H64.2831Z",fill:"#000000"})]})})}function va(){let e=pS(),t=(0,eg.useCallback)(e=>{localStorage.setItem("makeitreal_key",e.target.value)},[]),n=(0,eg.useCallback)(()=>{window.alert(`If you have an OpenAI developer key, you can put it in this input and it will be used when posting to OpenAI.

See https://platform.openai.com/api-keys to get a key.

Putting API keys into boxes is generally a bad idea! If you have any concerns, create an API key and then revoke it after using this site.`)},[]);return j.jsx("div",{className:`your-own-api-key ${e<5?"your-own-api-key__mobile":""}`,children:(0,j.jsxs)("div",{className:"your-own-api-key__inner",children:[j.jsx("div",{className:"input__wrapper",children:j.jsx("input",{id:"openai_key_risky_but_cool",defaultValue:localStorage.getItem("makeitreal_key")??process.env.OPENAI_API_KEY??"",onChange:t,spellCheck:!1,autoCapitalize:"off"})}),j.jsx("button",{className:"question__button",onClick:n,children:j.jsx(c0,{icon:"question"})})]})})}class vl extends lz{static{this.type="response"}getDefaultProps(){return{html:"",w:640,h:360}}component(e){let t=lN(e.id),n=h7(),r=e_("box shadow",()=>{var t;return t=this.editor.getShapePageTransform(e).rotation(),vd.map(e=>{let{offsetX:n,offsetY:r,blur:i,spread:o,color:s}=e,{x:a,y:l}=new rG(n,r).rot(-t);return`${a}px ${l}px ${i}px ${o}px ${s}`}).join(", ")},[this.editor]),i=e.props.html.replace("</body>",`<script src="https://unpkg.com/html2canvas"></script><script>
			// send the screenshot to the parent window
  			window.addEventListener('message', function(event) {
    		if (event.data.action === 'take-screenshot' && event.data.shapeid === "${e.id}") {
      		html2canvas(document.body, {useCors : true}).then(function(canvas) {
        		const data = canvas.toDataURL('image/png');
        		window.parent.postMessage({screenshot: data, shapeid: "${e.id}"}, "*");
      		});
    		}
  			}, false);
			document.body.addEventListener('wheel', e => { if (!e.ctrlKey) return; e.preventDefault(); return }, { passive: false })</script>
</body>`);return(0,j.jsxs)(lD,{className:"tl-embed-container",id:e.id,children:[i?j.jsx("iframe",{id:`iframe-1-${e.id}`,srcDoc:i,width:is(e.props.w),height:is(e.props.h),draggable:!1,style:{pointerEvents:t?"auto":"none",boxShadow:r,border:"1px solid var(--color-panel-contrast)",borderRadius:"var(--radius-2)"}}):j.jsx("div",{style:{width:"100%",height:"100%",backgroundColor:"var(--color-muted-2)",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid var(--color-muted-1)"},children:j.jsx(iT,{})}),j.jsx("div",{style:{position:"absolute",top:0,right:-40,height:40,width:40,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",pointerEvents:"all"},onClick:()=>{navigator&&navigator.clipboard&&(navigator.clipboard.writeText(e.props.html),n.addToast({icon:"duplicate",title:"Copied to clipboard"}))},onPointerDown:rT,children:j.jsx(c0,{icon:"duplicate"})}),i&&j.jsx("div",{style:{textAlign:"center",position:"absolute",bottom:t?-40:0,padding:4,fontFamily:"inherit",fontSize:12,left:0,width:"100%",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:j.jsx("span",{style:{background:"var(--color-panel)",padding:"4px 12px",borderRadius:99,border:"1px solid var(--color-muted-1)"},children:t?"Click the canvas to exit":"Double click to interact"})})]})}toSvg(e,t){let n=document.createElementNS("http://www.w3.org/2000/svg","g");return new Promise((t,r)=>{if(void 0===window)return t(n);let i=r=>{if(r.data.screenshot&&r.data?.shapeid===e.id){let s=document.createElementNS("http://www.w3.org/2000/svg","image");s.setAttributeNS("http://www.w3.org/1999/xlink","href",r.data.screenshot),s.setAttribute("width",e.props.w.toString()),s.setAttribute("height",e.props.h.toString()),n.appendChild(s),window.removeEventListener("message",i),clearTimeout(o),t(n)}},o=setTimeout(()=>{t(n),window.removeEventListener("message",i)},2e3);window.addEventListener("message",i);let s=document.getElementById(`iframe-1-${e.id}`);s?s.contentWindow.postMessage({action:"take-screenshot",shapeid:e.id},"*"):console.log("first level iframe not found or not accessible")})}indicator(e){return j.jsx("rect",{width:e.props.w,height:e.props.h})}constructor(...e){super(...e),this.canEdit=()=>!0,this.isAspectRatioLocked=()=>!1,this.canResize=()=>!0,this.canBind=()=>!1,this.canUnmount=()=>!1}}let vd=[{offsetX:0,offsetY:2,blur:4,spread:-1,color:"#0000003a"},{offsetX:0,offsetY:3,blur:12,spread:-2,color:"#0000001f"}],vc=T()(async()=>{},{loadableGenerated:{modules:["app/page.tsx -> @tldraw/tldraw"]},ssr:!1}),vu=[vl];function vh(){return j.jsx("div",{className:"editor",children:(0,j.jsxs)(vc,{persistenceKey:"make-real",shareZone:j.jsx(vo,{}),shapeUtils:vu,children:[j.jsx(vs,{}),j.jsx(va,{})]})})}},37:()=>{},1028:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,s){if("function"!=typeof r)throw TypeError("The listener must be a function");var a=new i(r,o||e,s),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1)),a.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,s=Array(o);i<o;i++)s[i]=r[i].fn;return s},a.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,i,o,s){var a=n?n+e:e;if(!this._events[a])return!1;var l,d,c=this._events[a],u=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,o),!0;case 6:return c.fn.call(c.context,t,r,i,o,s),!0}for(d=1,l=Array(u-1);d<u;d++)l[d-1]=arguments[d];c.fn.apply(c.context,l)}else{var h,p=c.length;for(d=0;d<p;d++)switch(c[d].once&&this.removeListener(e,c[d].fn,void 0,!0),u){case 1:c[d].fn.call(c[d].context);break;case 2:c[d].fn.call(c[d].context,t);break;case 3:c[d].fn.call(c[d].context,t,r);break;case 4:c[d].fn.call(c[d].context,t,r,i);break;default:if(!l)for(h=1,l=Array(u-1);h<u;h++)l[h-1]=arguments[h];c[d].fn.apply(c[d].context,l)}}return!0},a.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return s(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||i&&!a.once||r&&a.context!==r||s(this,o);else{for(var l=0,d=[],c=a.length;l<c;l++)(a[l].fn!==t||i&&!a[l].once||r&&a[l].context!==r)&&d.push(a[l]);d.length?this._events[o]=1===d.length?d[0]:d:s(this,o)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&s(this,t)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a},5575:(e,t,n)=>{e=n.nmd(e);var r,i,o="__lodash_hash_undefined__",s="[object Arguments]",a="[object Array]",l="[object Boolean]",d="[object Date]",c="[object Error]",u="[object Function]",h="[object Map]",p="[object Number]",g="[object Object]",f="[object Promise]",m="[object RegExp]",y="[object Set]",b="[object String]",v="[object WeakMap]",x="[object ArrayBuffer]",S="[object DataView]",w=/^\[object .+?Constructor\]$/,C=/^(?:0|[1-9]\d*)$/,_={};_["[object Float32Array]"]=_["[object Float64Array]"]=_["[object Int8Array]"]=_["[object Int16Array]"]=_["[object Int32Array]"]=_["[object Uint8Array]"]=_["[object Uint8ClampedArray]"]=_["[object Uint16Array]"]=_["[object Uint32Array]"]=!0,_[s]=_[a]=_[x]=_[l]=_[S]=_[d]=_[c]=_[u]=_[h]=_[p]=_[g]=_[m]=_[y]=_[b]=_[v]=!1;var k="object"==typeof global&&global&&global.Object===Object&&global,P="object"==typeof self&&self&&self.Object===Object&&self,I=k||P||Function("return this")(),E=t&&!t.nodeType&&t,j=E&&e&&!e.nodeType&&e,M=j&&j.exports===E,T=M&&k.process,A=function(){try{return T&&T.binding&&T.binding("util")}catch(e){}}(),O=A&&A.isTypedArray;function R(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function L(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var D=Array.prototype,z=Function.prototype,N=Object.prototype,$=I["__core-js_shared__"],F=z.toString,B=N.hasOwnProperty,V=function(){var e=/[^.]+$/.exec($&&$.keys&&$.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),U=N.toString,K=RegExp("^"+F.call(B).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),H=M?I.Buffer:void 0,Y=I.Symbol,W=I.Uint8Array,X=N.propertyIsEnumerable,G=D.splice,q=Y?Y.toStringTag:void 0,Z=Object.getOwnPropertySymbols,J=H?H.isBuffer:void 0,Q=(r=Object.keys,i=Object,function(e){return r(i(e))}),ee=e_(I,"DataView"),et=e_(I,"Map"),en=e_(I,"Promise"),er=e_(I,"Set"),ei=e_(I,"WeakMap"),eo=e_(Object,"create"),es=eI(ee),ea=eI(et),el=eI(en),ed=eI(er),ec=eI(ei),eu=Y?Y.prototype:void 0,eh=eu?eu.valueOf:void 0;function ep(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function eg(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ef(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function em(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new ef;++t<n;)this.add(e[t])}function ey(e){var t=this.__data__=new eg(e);this.size=t.size}function eb(e,t){for(var n=e.length;n--;)if(eE(e[n][0],t))return n;return -1}function ev(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":q&&q in Object(e)?function(e){var t=B.call(e,q),n=e[q];try{e[q]=void 0;var r=!0}catch(e){}var i=U.call(e);return r&&(t?e[q]=n:delete e[q]),i}(e):U.call(e)}function ex(e){return eL(e)&&ev(e)==s}function eS(e,t,n,r,i,o){var s=1&n,a=e.length,l=t.length;if(a!=l&&!(s&&l>a))return!1;var d=o.get(e);if(d&&o.get(t))return d==t;var c=-1,u=!0,h=2&n?new em:void 0;for(o.set(e,t),o.set(t,e);++c<a;){var p=e[c],g=t[c];if(r)var f=s?r(g,p,c,t,e,o):r(p,g,c,e,t,o);if(void 0!==f){if(f)continue;u=!1;break}if(h){if(!function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}(t,function(e,t){if(!h.has(t)&&(p===e||i(p,e,n,r,o)))return h.push(t)})){u=!1;break}}else if(!(p===g||i(p,g,n,r,o))){u=!1;break}}return o.delete(e),o.delete(t),u}function ew(e){var t;return t=function(e){return null!=e&&eO(e.length)&&!eA(e)?function(e,t){var n,r=eM(e),i=!r&&ej(e),o=!r&&!i&&eT(e),s=!r&&!i&&!o&&eD(e),a=r||i||o||s,l=a?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],d=l.length;for(var c in e)B.call(e,c)&&!(a&&("length"==c||o&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||(n=null==(n=d)?9007199254740991:n)&&("number"==typeof c||C.test(c))&&c>-1&&c%1==0&&c<n))&&l.push(c);return l}(e):function(e){if(t=e&&e.constructor,e!==("function"==typeof t&&t.prototype||N))return Q(e);var t,n=[];for(var r in Object(e))B.call(e,r)&&"constructor"!=r&&n.push(r);return n}(e)}(e),eM(e)?t:function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}(t,ek(e))}function eC(e,t){var n,r=e.__data__;return("string"==(n=typeof t)||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t)?r["string"==typeof t?"string":"hash"]:r.map}function e_(e,t){var n=null==e?void 0:e[t];return!(!eR(n)||V&&V in n)&&(eA(n)?K:w).test(eI(n))?n:void 0}ep.prototype.clear=function(){this.__data__=eo?eo(null):{},this.size=0},ep.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ep.prototype.get=function(e){var t=this.__data__;if(eo){var n=t[e];return n===o?void 0:n}return B.call(t,e)?t[e]:void 0},ep.prototype.has=function(e){var t=this.__data__;return eo?void 0!==t[e]:B.call(t,e)},ep.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=eo&&void 0===t?o:t,this},eg.prototype.clear=function(){this.__data__=[],this.size=0},eg.prototype.delete=function(e){var t=this.__data__,n=eb(t,e);return!(n<0)&&(n==t.length-1?t.pop():G.call(t,n,1),--this.size,!0)},eg.prototype.get=function(e){var t=this.__data__,n=eb(t,e);return n<0?void 0:t[n][1]},eg.prototype.has=function(e){return eb(this.__data__,e)>-1},eg.prototype.set=function(e,t){var n=this.__data__,r=eb(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},ef.prototype.clear=function(){this.size=0,this.__data__={hash:new ep,map:new(et||eg),string:new ep}},ef.prototype.delete=function(e){var t=eC(this,e).delete(e);return this.size-=t?1:0,t},ef.prototype.get=function(e){return eC(this,e).get(e)},ef.prototype.has=function(e){return eC(this,e).has(e)},ef.prototype.set=function(e,t){var n=eC(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},em.prototype.add=em.prototype.push=function(e){return this.__data__.set(e,o),this},em.prototype.has=function(e){return this.__data__.has(e)},ey.prototype.clear=function(){this.__data__=new eg,this.size=0},ey.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},ey.prototype.get=function(e){return this.__data__.get(e)},ey.prototype.has=function(e){return this.__data__.has(e)},ey.prototype.set=function(e,t){var n=this.__data__;if(n instanceof eg){var r=n.__data__;if(!et||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new ef(r)}return n.set(e,t),this.size=n.size,this};var ek=Z?function(e){return null==e?[]:function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var s=e[n];t(s,n,e)&&(o[i++]=s)}return o}(Z(e=Object(e)),function(t){return X.call(e,t)})}:function(){return[]},eP=ev;function eI(e){if(null!=e){try{return F.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function eE(e,t){return e===t||e!=e&&t!=t}(ee&&eP(new ee(new ArrayBuffer(1)))!=S||et&&eP(new et)!=h||en&&eP(en.resolve())!=f||er&&eP(new er)!=y||ei&&eP(new ei)!=v)&&(eP=function(e){var t=ev(e),n=t==g?e.constructor:void 0,r=n?eI(n):"";if(r)switch(r){case es:return S;case ea:return h;case el:return f;case ed:return y;case ec:return v}return t});var ej=ex(function(){return arguments}())?ex:function(e){return eL(e)&&B.call(e,"callee")&&!X.call(e,"callee")},eM=Array.isArray,eT=J||function(){return!1};function eA(e){if(!eR(e))return!1;var t=ev(e);return t==u||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function eO(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function eR(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function eL(e){return null!=e&&"object"==typeof e}var eD=O?function(e){return O(e)}:function(e){return eL(e)&&eO(e.length)&&!!_[ev(e)]};e.exports=function(e,t){return function e(t,n,r,i,o){return t===n||(null!=t&&null!=n&&(eL(t)||eL(n))?function(e,t,n,r,i,o){var u=eM(e),f=eM(t),v=u?a:eP(e),w=f?a:eP(t);v=v==s?g:v,w=w==s?g:w;var C=v==g,_=w==g,k=v==w;if(k&&eT(e)){if(!eT(t))return!1;u=!0,C=!1}if(k&&!C)return o||(o=new ey),u||eD(e)?eS(e,t,n,r,i,o):function(e,t,n,r,i,o,s){switch(n){case S:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case x:if(e.byteLength!=t.byteLength||!o(new W(e),new W(t)))break;return!0;case l:case d:case p:return eE(+e,+t);case c:return e.name==t.name&&e.message==t.message;case m:case b:return e==t+"";case h:var a=R;case y:var u=1&r;if(a||(a=L),e.size!=t.size&&!u)break;var g=s.get(e);if(g)return g==t;r|=2,s.set(e,t);var f=eS(a(e),a(t),r,i,o,s);return s.delete(e),f;case"[object Symbol]":if(eh)return eh.call(e)==eh.call(t)}return!1}(e,t,v,n,r,i,o);if(!(1&n)){var P=C&&B.call(e,"__wrapped__"),I=_&&B.call(t,"__wrapped__");if(P||I){var E=P?e.value():e,j=I?t.value():t;return o||(o=new ey),i(E,j,n,r,o)}}return!!k&&(o||(o=new ey),function(e,t,n,r,i,o){var s=1&n,a=ew(e),l=a.length;if(l!=ew(t).length&&!s)return!1;for(var d=l;d--;){var c=a[d];if(!(s?c in t:B.call(t,c)))return!1}var u=o.get(e);if(u&&o.get(t))return u==t;var h=!0;o.set(e,t),o.set(t,e);for(var p=s;++d<l;){var g=e[c=a[d]],f=t[c];if(r)var m=s?r(f,g,c,t,e,o):r(g,f,c,e,t,o);if(!(void 0===m?g===f||i(g,f,n,r,o):m)){h=!1;break}p||(p="constructor"==c)}if(h&&!p){var y=e.constructor,b=t.constructor;y!=b&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b)&&(h=!1)}return o.delete(e),o.delete(t),h}(e,t,n,r,i,o))}(t,n,r,i,e,o):t!=t&&n!=n)}(e,t)}},1594:e=>{var t="Expected a function",n=0/0,r=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,s=/^0o[0-7]+$/i,a=parseInt,l="object"==typeof global&&global&&global.Object===Object&&global,d="object"==typeof self&&self&&self.Object===Object&&self,c=l||d||Function("return this")(),u=Object.prototype.toString,h=Math.max,p=Math.min,g=function(){return c.Date.now()};function f(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function m(e){if("number"==typeof e)return e;if("symbol"==typeof(t=e)||t&&"object"==typeof t&&"[object Symbol]"==u.call(t))return n;if(f(e)){var t,l="function"==typeof e.valueOf?e.valueOf():e;e=f(l)?l+"":l}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(r,"");var d=o.test(e);return d||s.test(e)?a(e.slice(2),d?2:8):i.test(e)?n:+e}e.exports=function(e,n,r){var i=!0,o=!0;if("function"!=typeof e)throw TypeError(t);return f(r)&&(i="leading"in r?!!r.leading:i,o="trailing"in r?!!r.trailing:o),function(e,n,r){var i,o,s,a,l,d,c=0,u=!1,y=!1,b=!0;if("function"!=typeof e)throw TypeError(t);function v(t){var n=i,r=o;return i=o=void 0,c=t,a=e.apply(r,n)}function x(e){var t=e-d,r=e-c;return void 0===d||t>=n||t<0||y&&r>=s}function S(){var e,t,r,i=g();if(x(i))return w(i);l=setTimeout(S,(e=i-d,t=i-c,r=n-e,y?p(r,s-t):r))}function w(e){return(l=void 0,b&&i)?v(e):(i=o=void 0,a)}function C(){var e,t=g(),r=x(t);if(i=arguments,o=this,d=t,r){if(void 0===l)return c=e=d,l=setTimeout(S,n),u?v(e):a;if(y)return l=setTimeout(S,n),v(d)}return void 0===l&&(l=setTimeout(S,n)),a}return n=m(n)||0,f(r)&&(u=!!r.leading,s=(y="maxWait"in r)?h(m(r.maxWait)||0,n):s,b="trailing"in r?!!r.trailing:b),C.cancel=function(){void 0!==l&&clearTimeout(l),c=0,i=d=o=l=void 0},C.flush=function(){return void 0===l?a:w(g())},C}(e,n,{leading:i,maxWait:n,trailing:o})}},9402:e=>{var t="__lodash_hash_undefined__",n=/^\[object .+?Constructor\]$/,r="object"==typeof global&&global&&global.Object===Object&&global,i="object"==typeof self&&self&&self.Object===Object&&self,o=r||i||Function("return this")();function s(e,t){return!!(e?e.length:0)&&function(e,t,n){if(t!=t)return function(e,t,n,r){for(var i=e.length,o=-1;++o<i;)if(t(e[o],o,e))return o;return -1}(e,a,0);for(var r=-1,i=e.length;++r<i;)if(e[r]===t)return r;return -1}(e,t,0)>-1}function a(e){return e!=e}function l(e,t){return e.has(t)}function d(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var c=Array.prototype,u=Function.prototype,h=Object.prototype,p=o["__core-js_shared__"],g=function(){var e=/[^.]+$/.exec(p&&p.keys&&p.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),f=u.toString,m=h.hasOwnProperty,y=h.toString,b=RegExp("^"+f.call(m).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),v=c.splice,x=M(o,"Map"),S=M(o,"Set"),w=M(Object,"create");function C(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function _(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function k(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function P(e){var t=-1,n=e?e.length:0;for(this.__data__=new k;++t<n;)this.add(e[t])}function I(e,t){for(var n,r=e.length;r--;)if((n=e[r][0])===t||n!=n&&t!=t)return r;return -1}C.prototype.clear=function(){this.__data__=w?w(null):{}},C.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},C.prototype.get=function(e){var n=this.__data__;if(w){var r=n[e];return r===t?void 0:r}return m.call(n,e)?n[e]:void 0},C.prototype.has=function(e){var t=this.__data__;return w?void 0!==t[e]:m.call(t,e)},C.prototype.set=function(e,n){return this.__data__[e]=w&&void 0===n?t:n,this},_.prototype.clear=function(){this.__data__=[]},_.prototype.delete=function(e){var t=this.__data__,n=I(t,e);return!(n<0)&&(n==t.length-1?t.pop():v.call(t,n,1),!0)},_.prototype.get=function(e){var t=this.__data__,n=I(t,e);return n<0?void 0:t[n][1]},_.prototype.has=function(e){return I(this.__data__,e)>-1},_.prototype.set=function(e,t){var n=this.__data__,r=I(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},k.prototype.clear=function(){this.__data__={hash:new C,map:new(x||_),string:new C}},k.prototype.delete=function(e){return j(this,e).delete(e)},k.prototype.get=function(e){return j(this,e).get(e)},k.prototype.has=function(e){return j(this,e).has(e)},k.prototype.set=function(e,t){return j(this,e).set(e,t),this},P.prototype.add=P.prototype.push=function(e){return this.__data__.set(e,t),this},P.prototype.has=function(e){return this.__data__.has(e)};var E=S&&1/d(new S([,-0]))[1]==1/0?function(e){return new S(e)}:function(){};function j(e,t){var n,r=e.__data__;return("string"==(n=typeof t)||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t)?r["string"==typeof t?"string":"hash"]:r.map}function M(e,t){var r,i=null==e?void 0:e[t];return!(!T(i)||g&&g in i)&&("[object Function]"==(r=T(i)?y.call(i):"")||"[object GeneratorFunction]"==r||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(i)?b:n).test(function(e){if(null!=e){try{return f.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(i))?i:void 0}function T(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}e.exports=function(e){return e&&e.length?function(e,t,n){var r=-1,i=s,o=e.length,a=!0,c=[],u=c;if(o>=200){var h=E(e);if(h)return d(h);a=!1,i=l,u=new P}else u=c;t:for(;++r<o;){var p=e[r],g=p;if(p=0!==p?p:0,a&&g==g){for(var f=u.length;f--;)if(u[f]===g)continue t;t&&u.push(g),c.push(p)}else i(u,g,void 0)||(u!==c&&u.push(g),c.push(p))}return c}(e):[]}},6169:(e,t,n)=>{var r,i=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={};function i(e,t){if(!r[e]){r[e]={};for(var n=0;n<e.length;n++)r[e][e.charAt(n)]=n}return r[e][t]}var o={compressToBase64:function(e){if(null==e)return"";var n=o._compress(e,6,function(e){return t.charAt(e)});switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:o._decompress(e.length,32,function(n){return i(t,e.charAt(n))})},compressToUTF16:function(t){return null==t?"":o._compress(t,15,function(t){return e(t+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:o._decompress(e.length,16384,function(t){return e.charCodeAt(t)-32})},compressToUint8Array:function(e){for(var t=o.compress(e),n=new Uint8Array(2*t.length),r=0,i=t.length;r<i;r++){var s=t.charCodeAt(r);n[2*r]=s>>>8,n[2*r+1]=s%256}return n},decompressFromUint8Array:function(t){if(null==t)return o.decompress(t);for(var n=Array(t.length/2),r=0,i=n.length;r<i;r++)n[r]=256*t[2*r]+t[2*r+1];var s=[];return n.forEach(function(t){s.push(e(t))}),o.decompress(s.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":o._compress(e,6,function(e){return n.charAt(e)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),o._decompress(e.length,32,function(t){return i(n,e.charAt(t))}))},compress:function(t){return o._compress(t,16,function(t){return e(t)})},_compress:function(e,t,n){if(null==e)return"";var r,i,o,s={},a={},l="",d="",c="",u=2,h=3,p=2,g=[],f=0,m=0;for(o=0;o<e.length;o+=1)if(l=e.charAt(o),Object.prototype.hasOwnProperty.call(s,l)||(s[l]=h++,a[l]=!0),d=c+l,Object.prototype.hasOwnProperty.call(s,d))c=d;else{if(Object.prototype.hasOwnProperty.call(a,c)){if(256>c.charCodeAt(0)){for(r=0;r<p;r++)f<<=1,m==t-1?(m=0,g.push(n(f)),f=0):m++;for(r=0,i=c.charCodeAt(0);r<8;r++)f=f<<1|1&i,m==t-1?(m=0,g.push(n(f)),f=0):m++,i>>=1}else{for(r=0,i=1;r<p;r++)f=f<<1|i,m==t-1?(m=0,g.push(n(f)),f=0):m++,i=0;for(r=0,i=c.charCodeAt(0);r<16;r++)f=f<<1|1&i,m==t-1?(m=0,g.push(n(f)),f=0):m++,i>>=1}0==--u&&(u=Math.pow(2,p),p++),delete a[c]}else for(r=0,i=s[c];r<p;r++)f=f<<1|1&i,m==t-1?(m=0,g.push(n(f)),f=0):m++,i>>=1;0==--u&&(u=Math.pow(2,p),p++),s[d]=h++,c=String(l)}if(""!==c){if(Object.prototype.hasOwnProperty.call(a,c)){if(256>c.charCodeAt(0)){for(r=0;r<p;r++)f<<=1,m==t-1?(m=0,g.push(n(f)),f=0):m++;for(r=0,i=c.charCodeAt(0);r<8;r++)f=f<<1|1&i,m==t-1?(m=0,g.push(n(f)),f=0):m++,i>>=1}else{for(r=0,i=1;r<p;r++)f=f<<1|i,m==t-1?(m=0,g.push(n(f)),f=0):m++,i=0;for(r=0,i=c.charCodeAt(0);r<16;r++)f=f<<1|1&i,m==t-1?(m=0,g.push(n(f)),f=0):m++,i>>=1}0==--u&&(u=Math.pow(2,p),p++),delete a[c]}else for(r=0,i=s[c];r<p;r++)f=f<<1|1&i,m==t-1?(m=0,g.push(n(f)),f=0):m++,i>>=1;0==--u&&(u=Math.pow(2,p),p++)}for(r=0,i=2;r<p;r++)f=f<<1|1&i,m==t-1?(m=0,g.push(n(f)),f=0):m++,i>>=1;for(;;){if(f<<=1,m==t-1){g.push(n(f));break}m++}return g.join("")},decompress:function(e){return null==e?"":""==e?null:o._decompress(e.length,32768,function(t){return e.charCodeAt(t)})},_decompress:function(t,n,r){var i,o,s,a,l,d,c,u=[],h=4,p=4,g=3,f="",m=[],y={val:r(0),position:n,index:1};for(i=0;i<3;i+=1)u[i]=i;for(s=0,l=4,d=1;d!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*d,d<<=1;switch(s){case 0:for(s=0,l=256,d=1;d!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*d,d<<=1;c=e(s);break;case 1:for(s=0,l=65536,d=1;d!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*d,d<<=1;c=e(s);break;case 2:return""}for(u[3]=c,o=c,m.push(c);;){if(y.index>t)return"";for(s=0,l=Math.pow(2,g),d=1;d!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*d,d<<=1;switch(c=s){case 0:for(s=0,l=256,d=1;d!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*d,d<<=1;u[p++]=e(s),c=p-1,h--;break;case 1:for(s=0,l=65536,d=1;d!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*d,d<<=1;u[p++]=e(s),c=p-1,h--;break;case 2:return m.join("")}if(0==h&&(h=Math.pow(2,g),g++),u[c])f=u[c];else{if(c!==p)return null;f=o+o.charAt(0)}m.push(f),u[p++]=o+f.charAt(0),h--,o=f,0==h&&(h=Math.pow(2,g),g++)}}};return o}();void 0!==(r=(function(){return i}).call(t,n,t,e))&&(e.exports=r)},3353:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});let r=n(1174);n(326),n(7577);let i=r._(n(7028));function o(e,t){var n;let r={loading:e=>{let{error:t,isLoading:n,pastDelay:r}=e;return null}};"function"==typeof e&&(r.loader=e);let o={...r,...t};return(0,i.default)({...o,modules:null==(n=o.loadableGenerated)?void 0:n.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},933:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return i}});let r=n(4129);function i(e){let{reason:t,children:n}=e;throw new r.BailoutToCSRError(t)}},7028:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return d}});let r=n(326),i=n(7577),o=n(933),s=n(6618);function a(e){return{default:e&&"default"in e?e.default:e}}let l={loader:()=>Promise.resolve(a(()=>null)),loading:null,ssr:!0},d=function(e){let t={...l,...e},n=(0,i.lazy)(()=>t.loader().then(a)),d=t.loading;function c(e){let a=d?(0,r.jsx)(d,{isLoading:!0,pastDelay:!0,error:null}):null,l=t.ssr?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.PreloadCss,{moduleIds:t.modules}),(0,r.jsx)(n,{...e})]}):(0,r.jsx)(o.BailoutToCSR,{reason:"next/dynamic",children:(0,r.jsx)(n,{...e})});return(0,r.jsx)(i.Suspense,{fallback:a,children:l})}return c.displayName="LoadableComponent",c}},6618:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return o}});let r=n(326),i=n(5403);function o(e){let{moduleIds:t}=e,n=(0,i.getExpectedRequestStore)("next/dynamic css"),o=[];if(n.reactLoadableManifest&&t){let e=n.reactLoadableManifest;for(let n of t){if(!e[n])continue;let t=e[n].files.filter(e=>e.endsWith(".css"));o.push(...t)}}return 0===o.length?null:(0,r.jsx)(r.Fragment,{children:o.map(e=>(0,r.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:n.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}},1506:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a,metadata:()=>s});var r=n(9510),i=n(5384),o=n.n(i);n(7272);let s={title:"make real starter",description:"draw a website and make it real"};function a({children:e}){return r.jsx("html",{lang:"en",children:r.jsx("body",{className:o().className,children:e})})}},908:(e,t,n)=>{"use strict";n.r(t),n.d(t,{$$typeof:()=>s,__esModule:()=>o,default:()=>a});var r=n(8570);let i=(0,r.createProxy)(String.raw`/home/runner/canvasite/app/page.tsx`),{__esModule:o,$$typeof:s}=i;i.default;let a=(0,r.createProxy)(String.raw`/home/runner/canvasite/app/page.tsx#default`)},7272:()=>{},8582:()=>{},8029:(e,t)=>{var n;/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/!function(){"use strict";var r={}.hasOwnProperty;function i(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=o(e,function(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return i.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)r.call(e,n)&&e[n]&&(t=o(t,n));return t}(n)))}return e}function o(e,t){return t?e?e+" "+t:e+t:e}e.exports?(i.default=i,e.exports=i):void 0!==(n=(function(){return i}).apply(t,[]))&&(e.exports=n)}()},9835:(e,t,n)=>{"use strict";n(2373);var r=n(5366);e.exports=r("Array","at")},3136:(e,t,n)=>{"use strict";n(9590),n(2616);var r=n(5366);e.exports=r("Array","flatMap")},9091:(e,t,n)=>{"use strict";n(4940),n(5259);var r=n(5366);e.exports=r("Array","flat")},1316:(e,t,n)=>{"use strict";n(882);var r=n(5366);e.exports=r("String","at")},4015:(e,t,n)=>{"use strict";n(4669),n(1165),n(2982);var r=n(5366);e.exports=r("String","replaceAll")},6515:(e,t,n)=>{"use strict";var r=n(867),i=n(7799),o=TypeError;e.exports=function(e){if(r(e))return e;throw new o(i(e)+" is not a function")}},1691:(e,t,n)=>{"use strict";var r=n(6317),i=n(147),o=n(1059).f,s=r("unscopables"),a=Array.prototype;void 0===a[s]&&o(a,s,{configurable:!0,value:i(null)}),e.exports=function(e){a[s][e]=!0}},2281:(e,t,n)=>{"use strict";var r=n(8679).charAt;e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},5365:(e,t,n)=>{"use strict";var r=n(1665),i=String,o=TypeError;e.exports=function(e){if(r(e))return e;throw new o(i(e)+" is not an object")}},3958:(e,t,n)=>{"use strict";var r=n(1451),i=n(8483),o=n(2439),s=function(e){return function(t,n,s){var a,l=r(t),d=o(l),c=i(s,d);if(e&&n!=n){for(;d>c;)if((a=l[c++])!=a)return!0}else for(;d>c;c++)if((e||c in l)&&l[c]===n)return e||c||0;return!e&&-1}};e.exports={includes:s(!0),indexOf:s(!1)}},4043:(e,t,n)=>{"use strict";var r=n(4232),i=n(7030),o=n(1665),s=n(6317)("species"),a=Array;e.exports=function(e){var t;return r(e)&&(i(t=e.constructor)&&(t===a||r(t.prototype))?t=void 0:o(t)&&null===(t=t[s])&&(t=void 0)),void 0===t?a:t}},7678:(e,t,n)=>{"use strict";var r=n(4043);e.exports=function(e,t){return new(r(e))(0===t?0:t)}},7633:(e,t,n)=>{"use strict";var r=n(2611),i=r({}.toString),o=r("".slice);e.exports=function(e){return o(i(e),8,-1)}},5342:(e,t,n)=>{"use strict";var r=n(4483),i=n(867),o=n(7633),s=n(6317)("toStringTag"),a=Object,l="Arguments"===o(function(){return arguments}()),d=function(e,t){try{return e[t]}catch(e){}};e.exports=r?o:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=d(t=a(e),s))?n:l?o(t):"Object"===(r=o(t))&&i(t.callee)?"Arguments":r}},6821:(e,t,n)=>{"use strict";var r=n(7281),i=n(6967),o=n(225),s=n(1059);e.exports=function(e,t,n){for(var a=i(t),l=s.f,d=o.f,c=0;c<a.length;c++){var u=a[c];r(e,u)||n&&r(n,u)||l(e,u,d(t,u))}}},1914:(e,t,n)=>{"use strict";var r=n(8649),i=n(1059),o=n(6295);e.exports=r?function(e,t,n){return i.f(e,t,o(1,n))}:function(e,t,n){return e[t]=n,e}},6295:e=>{"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},9136:(e,t,n)=>{"use strict";var r=n(867),i=n(1059),o=n(3890),s=n(6026);e.exports=function(e,t,n,a){a||(a={});var l=a.enumerable,d=void 0!==a.name?a.name:t;if(r(n)&&o(n,d,a),a.global)l?e[t]=n:s(t,n);else{try{a.unsafe?e[t]&&(l=!0):delete e[t]}catch(e){}l?e[t]=n:i.f(e,t,{value:n,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return e}},6026:(e,t,n)=>{"use strict";var r=n(1748),i=Object.defineProperty;e.exports=function(e,t){try{i(r,e,{value:t,configurable:!0,writable:!0})}catch(n){r[e]=t}return t}},8649:(e,t,n)=>{"use strict";var r=n(5744);e.exports=!r(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})},6826:(e,t,n)=>{"use strict";var r=n(1748),i=n(1665),o=r.document,s=i(o)&&i(o.createElement);e.exports=function(e){return s?o.createElement(e):{}}},8279:e=>{"use strict";var t=TypeError;e.exports=function(e){if(e>9007199254740991)throw t("Maximum allowed index exceeded");return e}},6429:e=>{"use strict";e.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},9053:(e,t,n)=>{"use strict";var r,i,o=n(1748),s=n(6429),a=o.process,l=o.Deno,d=a&&a.versions||l&&l.version,c=d&&d.v8;c&&(i=(r=c.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!i&&s&&(!(r=s.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=s.match(/Chrome\/(\d+)/))&&(i=+r[1]),e.exports=i},5366:(e,t,n)=>{"use strict";var r=n(1748),i=n(2611);e.exports=function(e,t){return i(r[e].prototype[t])}},8813:e=>{"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},7184:(e,t,n)=>{"use strict";var r=n(1748),i=n(225).f,o=n(1914),s=n(9136),a=n(6026),l=n(6821),d=n(9497);e.exports=function(e,t){var n,c,u,h,p,g=e.target,f=e.global,m=e.stat;if(n=f?r:m?r[g]||a(g,{}):r[g]&&r[g].prototype)for(c in t){if(h=t[c],u=e.dontCallGetSet?(p=i(n,c))&&p.value:n[c],!d(f?c:g+(m?".":"#")+c,e.forced)&&void 0!==u){if(typeof h==typeof u)continue;l(h,u)}(e.sham||u&&u.sham)&&o(h,"sham",!0),s(n,c,h,e)}}},5744:e=>{"use strict";e.exports=function(e){try{return!!e()}catch(e){return!0}}},9882:(e,t,n)=>{"use strict";n(4669);var r=n(6809),i=n(9136),o=n(4887),s=n(5744),a=n(6317),l=n(1914),d=a("species"),c=RegExp.prototype;e.exports=function(e,t,n,u){var h=a(e),p=!s(function(){var t={};return t[h]=function(){return 7},7!==""[e](t)}),g=p&&!s(function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[d]=function(){return n},n.flags="",n[h]=/./[h]),n.exec=function(){return t=!0,null},n[h](""),!t});if(!p||!g||n){var f=/./[h],m=t(h,""[e],function(e,t,n,i,s){var a=t.exec;return a===o||a===c.exec?p&&!s?{done:!0,value:r(f,t,n,i)}:{done:!0,value:r(e,n,t,i)}:{done:!1}});i(String.prototype,e,m[0]),i(c,h,m[1])}u&&l(c[h],"sham",!0)}},3859:(e,t,n)=>{"use strict";var r=n(4232),i=n(2439),o=n(8279),s=n(5489),a=function(e,t,n,l,d,c,u,h){for(var p,g,f=d,m=0,y=!!u&&s(u,h);m<l;)m in n&&(p=y?y(n[m],m,t):n[m],c>0&&r(p)?(g=i(p),f=a(e,t,p,g,f,c-1)-1):(o(f+1),e[f]=p),f++),m++;return f};e.exports=a},5540:(e,t,n)=>{"use strict";var r=n(7219),i=Function.prototype,o=i.apply,s=i.call;e.exports="object"==typeof Reflect&&Reflect.apply||(r?s.bind(o):function(){return s.apply(o,arguments)})},5489:(e,t,n)=>{"use strict";var r=n(8221),i=n(6515),o=n(7219),s=r(r.bind);e.exports=function(e,t){return i(e),void 0===t?e:o?s(e,t):function(){return e.apply(t,arguments)}}},7219:(e,t,n)=>{"use strict";var r=n(5744);e.exports=!r(function(){var e=(function(){}).bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})},6809:(e,t,n)=>{"use strict";var r=n(7219),i=Function.prototype.call;e.exports=r?i.bind(i):function(){return i.apply(i,arguments)}},2054:(e,t,n)=>{"use strict";var r=n(8649),i=n(7281),o=Function.prototype,s=r&&Object.getOwnPropertyDescriptor,a=i(o,"name"),l=a&&(!r||r&&s(o,"name").configurable);e.exports={EXISTS:a,PROPER:a&&"something"===(function(){}).name,CONFIGURABLE:l}},8221:(e,t,n)=>{"use strict";var r=n(7633),i=n(2611);e.exports=function(e){if("Function"===r(e))return i(e)}},2611:(e,t,n)=>{"use strict";var r=n(7219),i=Function.prototype,o=i.call,s=r&&i.bind.bind(o,o);e.exports=r?s:function(e){return function(){return o.apply(e,arguments)}}},2545:(e,t,n)=>{"use strict";var r=n(1748),i=n(867);e.exports=function(e,t){var n;return arguments.length<2?i(n=r[e])?n:void 0:r[e]&&r[e][t]}},9923:(e,t,n)=>{"use strict";var r=n(6515),i=n(3531);e.exports=function(e,t){var n=e[t];return i(n)?void 0:r(n)}},1592:(e,t,n)=>{"use strict";var r=n(2611),i=n(1216),o=Math.floor,s=r("".charAt),a=r("".replace),l=r("".slice),d=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,c=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,t,n,r,u,h){var p=n+e.length,g=r.length,f=c;return void 0!==u&&(u=i(u),f=d),a(h,f,function(i,a){var d;switch(s(a,0)){case"$":return"$";case"&":return e;case"`":return l(t,0,n);case"'":return l(t,p);case"<":d=u[l(a,1,-1)];break;default:var c=+a;if(0===c)return i;if(c>g){var h=o(c/10);if(0===h)return i;if(h<=g)return void 0===r[h-1]?s(a,1):r[h-1]+s(a,1);return i}d=r[c-1]}return void 0===d?"":d})}},1748:function(e){"use strict";var t=function(e){return e&&e.Math===Math&&e};e.exports=t("object"==typeof globalThis&&globalThis)||t("object"==typeof window&&window)||t("object"==typeof self&&self)||t("object"==typeof global&&global)||t("object"==typeof this&&this)||function(){return this}()||Function("return this")()},7281:(e,t,n)=>{"use strict";var r=n(2611),i=n(1216),o=r({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(i(e),t)}},2959:e=>{"use strict";e.exports={}},4786:(e,t,n)=>{"use strict";var r=n(2545);e.exports=r("document","documentElement")},8900:(e,t,n)=>{"use strict";var r=n(8649),i=n(5744),o=n(6826);e.exports=!r&&!i(function(){return 7!==Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a})},5077:(e,t,n)=>{"use strict";var r=n(2611),i=n(5744),o=n(7633),s=Object,a=r("".split);e.exports=i(function(){return!s("z").propertyIsEnumerable(0)})?function(e){return"String"===o(e)?a(e,""):s(e)}:s},9605:(e,t,n)=>{"use strict";var r=n(2611),i=n(867),o=n(5826),s=r(Function.toString);i(o.inspectSource)||(o.inspectSource=function(e){return s(e)}),e.exports=o.inspectSource},2085:(e,t,n)=>{"use strict";var r,i,o,s=n(2518),a=n(1748),l=n(1665),d=n(1914),c=n(7281),u=n(5826),h=n(9496),p=n(2959),g="Object already initialized",f=a.TypeError,m=a.WeakMap;if(s||u.state){var y=u.state||(u.state=new m);y.get=y.get,y.has=y.has,y.set=y.set,r=function(e,t){if(y.has(e))throw new f(g);return t.facade=e,y.set(e,t),t},i=function(e){return y.get(e)||{}},o=function(e){return y.has(e)}}else{var b=h("state");p[b]=!0,r=function(e,t){if(c(e,b))throw new f(g);return t.facade=e,d(e,b,t),t},i=function(e){return c(e,b)?e[b]:{}},o=function(e){return c(e,b)}}e.exports={set:r,get:i,has:o,enforce:function(e){return o(e)?i(e):r(e,{})},getterFor:function(e){return function(t){var n;if(!l(t)||(n=i(t)).type!==e)throw new f("Incompatible receiver, "+e+" required");return n}}}},4232:(e,t,n)=>{"use strict";var r=n(7633);e.exports=Array.isArray||function(e){return"Array"===r(e)}},867:e=>{"use strict";var t="object"==typeof document&&document.all;e.exports=void 0===t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(e){return"function"==typeof e}},7030:(e,t,n)=>{"use strict";var r=n(2611),i=n(5744),o=n(867),s=n(5342),a=n(2545),l=n(9605),d=function(){},c=a("Reflect","construct"),u=/^\s*(?:class|function)\b/,h=r(u.exec),p=!u.test(d),g=function(e){if(!o(e))return!1;try{return c(d,[],e),!0}catch(e){return!1}},f=function(e){if(!o(e))return!1;switch(s(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return p||!!h(u,l(e))}catch(e){return!0}};f.sham=!0,e.exports=!c||i(function(){var e;return g(g.call)||!g(Object)||!g(function(){e=!0})||e})?f:g},9497:(e,t,n)=>{"use strict";var r=n(5744),i=n(867),o=/#|\.prototype\./,s=function(e,t){var n=l[a(e)];return n===c||n!==d&&(i(t)?r(t):!!t)},a=s.normalize=function(e){return String(e).replace(o,".").toLowerCase()},l=s.data={},d=s.NATIVE="N",c=s.POLYFILL="P";e.exports=s},3531:e=>{"use strict";e.exports=function(e){return null==e}},1665:(e,t,n)=>{"use strict";var r=n(867);e.exports=function(e){return"object"==typeof e?null!==e:r(e)}},4885:e=>{"use strict";e.exports=!1},6298:(e,t,n)=>{"use strict";var r=n(1665),i=n(7633),o=n(6317)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[o])?!!t:"RegExp"===i(e))}},2680:(e,t,n)=>{"use strict";var r=n(2545),i=n(867),o=n(1686),s=n(6230),a=Object;e.exports=s?function(e){return"symbol"==typeof e}:function(e){var t=r("Symbol");return i(t)&&o(t.prototype,a(e))}},2439:(e,t,n)=>{"use strict";var r=n(6846);e.exports=function(e){return r(e.length)}},3890:(e,t,n)=>{"use strict";var r=n(2611),i=n(5744),o=n(867),s=n(7281),a=n(8649),l=n(2054).CONFIGURABLE,d=n(9605),c=n(2085),u=c.enforce,h=c.get,p=String,g=Object.defineProperty,f=r("".slice),m=r("".replace),y=r([].join),b=a&&!i(function(){return 8!==g(function(){},"length",{value:8}).length}),v=String(String).split("String"),x=e.exports=function(e,t,n){"Symbol("===f(p(t),0,7)&&(t="["+m(p(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!s(e,"name")||l&&e.name!==t)&&(a?g(e,"name",{value:t,configurable:!0}):e.name=t),b&&n&&s(n,"arity")&&e.length!==n.arity&&g(e,"length",{value:n.arity});try{n&&s(n,"constructor")&&n.constructor?a&&g(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var r=u(e);return s(r,"source")||(r.source=y(v,"string"==typeof t?t:"")),e};Function.prototype.toString=x(function(){return o(this)&&h(this).source||d(this)},"toString")},7499:e=>{"use strict";var t=Math.ceil,n=Math.floor;e.exports=Math.trunc||function(e){var r=+e;return(r>0?n:t)(r)}},147:(e,t,n)=>{"use strict";var r,i=n(5365),o=n(883),s=n(8813),a=n(2959),l=n(4786),d=n(6826),c=n(9496),u="prototype",h="script",p=c("IE_PROTO"),g=function(){},f=function(e){return"<"+h+">"+e+"</"+h+">"},m=function(e){e.write(f("")),e.close();var t=e.parentWindow.Object;return e=null,t},y=function(){var e,t=d("iframe");return t.style.display="none",l.appendChild(t),t.src=String("java"+h+":"),(e=t.contentWindow.document).open(),e.write(f("document.F=Object")),e.close(),e.F},b=function(){try{r=new ActiveXObject("htmlfile")}catch(e){}b="undefined"!=typeof document?document.domain&&r?m(r):y():m(r);for(var e=s.length;e--;)delete b[u][s[e]];return b()};a[p]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(g[u]=i(e),n=new g,g[u]=null,n[p]=e):n=b(),void 0===t?n:o.f(n,t)}},883:(e,t,n)=>{"use strict";var r=n(8649),i=n(3791),o=n(1059),s=n(5365),a=n(1451),l=n(2183);t.f=r&&!i?Object.defineProperties:function(e,t){s(e);for(var n,r=a(t),i=l(t),d=i.length,c=0;d>c;)o.f(e,n=i[c++],r[n]);return e}},1059:(e,t,n)=>{"use strict";var r=n(8649),i=n(8900),o=n(3791),s=n(5365),a=n(1288),l=TypeError,d=Object.defineProperty,c=Object.getOwnPropertyDescriptor,u="enumerable",h="configurable",p="writable";t.f=r?o?function(e,t,n){if(s(e),t=a(t),s(n),"function"==typeof e&&"prototype"===t&&"value"in n&&p in n&&!n[p]){var r=c(e,t);r&&r[p]&&(e[t]=n.value,n={configurable:h in n?n[h]:r[h],enumerable:u in n?n[u]:r[u],writable:!1})}return d(e,t,n)}:d:function(e,t,n){if(s(e),t=a(t),s(n),i)try{return d(e,t,n)}catch(e){}if("get"in n||"set"in n)throw new l("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},225:(e,t,n)=>{"use strict";var r=n(8649),i=n(6809),o=n(1569),s=n(6295),a=n(1451),l=n(1288),d=n(7281),c=n(8900),u=Object.getOwnPropertyDescriptor;t.f=r?u:function(e,t){if(e=a(e),t=l(t),c)try{return u(e,t)}catch(e){}if(d(e,t))return s(!i(o.f,e,t),e[t])}},6705:(e,t,n)=>{"use strict";var r=n(7351),i=n(8813).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},1093:(e,t)=>{"use strict";t.f=Object.getOwnPropertySymbols},1686:(e,t,n)=>{"use strict";var r=n(2611);e.exports=r({}.isPrototypeOf)},7351:(e,t,n)=>{"use strict";var r=n(2611),i=n(7281),o=n(1451),s=n(3958).indexOf,a=n(2959),l=r([].push);e.exports=function(e,t){var n,r=o(e),d=0,c=[];for(n in r)!i(a,n)&&i(r,n)&&l(c,n);for(;t.length>d;)i(r,n=t[d++])&&(~s(c,n)||l(c,n));return c}},2183:(e,t,n)=>{"use strict";var r=n(7351),i=n(8813);e.exports=Object.keys||function(e){return r(e,i)}},1569:(e,t)=>{"use strict";var n={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,i=r&&!n.call({1:2},1);t.f=i?function(e){var t=r(this,e);return!!t&&t.enumerable}:n},2338:(e,t,n)=>{"use strict";var r=n(6809),i=n(867),o=n(1665),s=TypeError;e.exports=function(e,t){var n,a;if("string"===t&&i(n=e.toString)&&!o(a=r(n,e))||i(n=e.valueOf)&&!o(a=r(n,e))||"string"!==t&&i(n=e.toString)&&!o(a=r(n,e)))return a;throw new s("Can't convert object to primitive value")}},6967:(e,t,n)=>{"use strict";var r=n(2545),i=n(2611),o=n(6705),s=n(1093),a=n(5365),l=i([].concat);e.exports=r("Reflect","ownKeys")||function(e){var t=o.f(a(e)),n=s.f;return n?l(t,n(e)):t}},3529:(e,t,n)=>{"use strict";var r=n(6809),i=n(5365),o=n(867),s=n(7633),a=n(4887),l=TypeError;e.exports=function(e,t){var n=e.exec;if(o(n)){var d=r(n,e,t);return null!==d&&i(d),d}if("RegExp"===s(e))return r(a,e,t);throw new l("RegExp#exec called on incompatible receiver")}},4887:(e,t,n)=>{"use strict";var r=n(6809),i=n(2611),o=n(8234),s=n(429),a=n(3726),l=n(1208),d=n(147),c=n(2085).get,u=n(9626),h=n(3424),p=l("native-string-replace",String.prototype.replace),g=RegExp.prototype.exec,f=g,m=i("".charAt),y=i("".indexOf),b=i("".replace),v=i("".slice),x=function(){var e=/a/,t=/b*/g;return r(g,e,"a"),r(g,t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),S=a.BROKEN_CARET,w=void 0!==/()??/.exec("")[1];(x||w||S||u||h)&&(f=function(e){var t,n,i,a,l,u,h,C=c(this),_=o(e),k=C.raw;if(k)return k.lastIndex=this.lastIndex,t=r(f,k,_),this.lastIndex=k.lastIndex,t;var P=C.groups,I=S&&this.sticky,E=r(s,this),j=this.source,M=0,T=_;if(I&&(-1===y(E=b(E,"y",""),"g")&&(E+="g"),T=v(_,this.lastIndex),this.lastIndex>0&&(!this.multiline||this.multiline&&"\n"!==m(_,this.lastIndex-1))&&(j="(?: "+j+")",T=" "+T,M++),n=RegExp("^(?:"+j+")",E)),w&&(n=RegExp("^"+j+"$(?!\\s)",E)),x&&(i=this.lastIndex),a=r(g,I?n:this,T),I?a?(a.input=v(a.input,M),a[0]=v(a[0],M),a.index=this.lastIndex,this.lastIndex+=a[0].length):this.lastIndex=0:x&&a&&(this.lastIndex=this.global?a.index+a[0].length:i),w&&a&&a.length>1&&r(p,a[0],n,function(){for(l=1;l<arguments.length-2;l++)void 0===arguments[l]&&(a[l]=void 0)}),a&&P)for(l=0,a.groups=u=d(null);l<P.length;l++)u[(h=P[l])[0]]=a[h[1]];return a}),e.exports=f},429:(e,t,n)=>{"use strict";var r=n(5365);e.exports=function(){var e=r(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},4064:(e,t,n)=>{"use strict";var r=n(6809),i=n(7281),o=n(1686),s=n(429),a=RegExp.prototype;e.exports=function(e){var t=e.flags;return!(void 0===t&&!("flags"in a)&&!i(e,"flags")&&o(a,e))?t:r(s,e)}},3726:(e,t,n)=>{"use strict";var r=n(5744),i=n(1748).RegExp,o=r(function(){var e=i("a","y");return e.lastIndex=2,null!==e.exec("abcd")}),s=o||r(function(){return!i("a","y").sticky}),a=o||r(function(){var e=i("^r","gy");return e.lastIndex=2,null!==e.exec("str")});e.exports={BROKEN_CARET:a,MISSED_STICKY:s,UNSUPPORTED_Y:o}},9626:(e,t,n)=>{"use strict";var r=n(5744),i=n(1748).RegExp;e.exports=r(function(){var e=i(".","s");return!(e.dotAll&&e.test("\n")&&"s"===e.flags)})},3424:(e,t,n)=>{"use strict";var r=n(5744),i=n(1748).RegExp;e.exports=r(function(){var e=i("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})},5626:(e,t,n)=>{"use strict";var r=n(3531),i=TypeError;e.exports=function(e){if(r(e))throw new i("Can't call method on "+e);return e}},9496:(e,t,n)=>{"use strict";var r=n(1208),i=n(2147),o=r("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},5826:(e,t,n)=>{"use strict";var r=n(1748),i=n(6026),o="__core-js_shared__",s=r[o]||i(o,{});e.exports=s},1208:(e,t,n)=>{"use strict";var r=n(4885),i=n(5826);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.35.1",mode:r?"pure":"global",copyright:"\xa9 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.35.1/LICENSE",source:"https://github.com/zloirock/core-js"})},8679:(e,t,n)=>{"use strict";var r=n(2611),i=n(8011),o=n(8234),s=n(5626),a=r("".charAt),l=r("".charCodeAt),d=r("".slice),c=function(e){return function(t,n){var r,c,u=o(s(t)),h=i(n),p=u.length;return h<0||h>=p?e?"":void 0:(r=l(u,h))<55296||r>56319||h+1===p||(c=l(u,h+1))<56320||c>57343?e?a(u,h):r:e?d(u,h,h+2):(r-55296<<10)+(c-56320)+65536}};e.exports={codeAt:c(!1),charAt:c(!0)}},9418:(e,t,n)=>{"use strict";var r=n(9053),i=n(5744),o=n(1748).String;e.exports=!!Object.getOwnPropertySymbols&&!i(function(){var e=Symbol("symbol detection");return!o(e)||!(Object(e) instanceof Symbol)||!Symbol.sham&&r&&r<41})},8483:(e,t,n)=>{"use strict";var r=n(8011),i=Math.max,o=Math.min;e.exports=function(e,t){var n=r(e);return n<0?i(n+t,0):o(n,t)}},1451:(e,t,n)=>{"use strict";var r=n(5077),i=n(5626);e.exports=function(e){return r(i(e))}},8011:(e,t,n)=>{"use strict";var r=n(7499);e.exports=function(e){var t=+e;return t!=t||0===t?0:r(t)}},6846:(e,t,n)=>{"use strict";var r=n(8011),i=Math.min;e.exports=function(e){var t=r(e);return t>0?i(t,9007199254740991):0}},1216:(e,t,n)=>{"use strict";var r=n(5626),i=Object;e.exports=function(e){return i(r(e))}},2557:(e,t,n)=>{"use strict";var r=n(6809),i=n(1665),o=n(2680),s=n(9923),a=n(2338),l=n(6317),d=TypeError,c=l("toPrimitive");e.exports=function(e,t){if(!i(e)||o(e))return e;var n,l=s(e,c);if(l){if(void 0===t&&(t="default"),!i(n=r(l,e,t))||o(n))return n;throw new d("Can't convert object to primitive value")}return void 0===t&&(t="number"),a(e,t)}},1288:(e,t,n)=>{"use strict";var r=n(2557),i=n(2680);e.exports=function(e){var t=r(e,"string");return i(t)?t:t+""}},4483:(e,t,n)=>{"use strict";var r=n(6317)("toStringTag"),i={};i[r]="z",e.exports="[object z]"===String(i)},8234:(e,t,n)=>{"use strict";var r=n(5342),i=String;e.exports=function(e){if("Symbol"===r(e))throw TypeError("Cannot convert a Symbol value to a string");return i(e)}},7799:e=>{"use strict";var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},2147:(e,t,n)=>{"use strict";var r=n(2611),i=0,o=Math.random(),s=r(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++i+o,36)}},6230:(e,t,n)=>{"use strict";var r=n(9418);e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},3791:(e,t,n)=>{"use strict";var r=n(8649),i=n(5744);e.exports=r&&i(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})},2518:(e,t,n)=>{"use strict";var r=n(1748),i=n(867),o=r.WeakMap;e.exports=i(o)&&/native code/.test(String(o))},6317:(e,t,n)=>{"use strict";var r=n(1748),i=n(1208),o=n(7281),s=n(2147),a=n(9418),l=n(6230),d=r.Symbol,c=i("wks"),u=l?d.for||d:d&&d.withoutSetter||s;e.exports=function(e){return o(c,e)||(c[e]=a&&o(d,e)?d[e]:u("Symbol."+e)),c[e]}},2373:(e,t,n)=>{"use strict";var r=n(7184),i=n(1216),o=n(2439),s=n(8011),a=n(1691);r({target:"Array",proto:!0},{at:function(e){var t=i(this),n=o(t),r=s(e),a=r>=0?r:n+r;return a<0||a>=n?void 0:t[a]}}),a("at")},9590:(e,t,n)=>{"use strict";var r=n(7184),i=n(3859),o=n(6515),s=n(1216),a=n(2439),l=n(7678);r({target:"Array",proto:!0},{flatMap:function(e){var t,n=s(this),r=a(n);return o(e),(t=l(n,0)).length=i(t,n,n,r,0,1,e,arguments.length>1?arguments[1]:void 0),t}})},4940:(e,t,n)=>{"use strict";var r=n(7184),i=n(3859),o=n(1216),s=n(2439),a=n(8011),l=n(7678);r({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=o(this),n=s(t),r=l(t,0);return r.length=i(r,t,t,n,0,void 0===e?1:a(e)),r}})},2616:(e,t,n)=>{"use strict";n(1691)("flatMap")},5259:(e,t,n)=>{"use strict";n(1691)("flat")},4669:(e,t,n)=>{"use strict";var r=n(7184),i=n(4887);r({target:"RegExp",proto:!0,forced:/./.exec!==i},{exec:i})},882:(e,t,n)=>{"use strict";var r=n(7184),i=n(2611),o=n(5626),s=n(8011),a=n(8234),l=n(5744),d=i("".charAt);r({target:"String",proto:!0,forced:l(function(){return"\uD842"!=="\uD842\uDFB7".at(-2)})},{at:function(e){var t=a(o(this)),n=t.length,r=s(e),i=r>=0?r:n+r;return i<0||i>=n?void 0:d(t,i)}})},2982:(e,t,n)=>{"use strict";var r=n(7184),i=n(6809),o=n(2611),s=n(5626),a=n(867),l=n(3531),d=n(6298),c=n(8234),u=n(9923),h=n(4064),p=n(1592),g=n(6317),f=n(4885),m=g("replace"),y=TypeError,b=o("".indexOf),v=o("".replace),x=o("".slice),S=Math.max;r({target:"String",proto:!0},{replaceAll:function(e,t){var n,r,o,g,w,C,_,k,P=s(this),I=0,E=0,j="";if(!l(e)){if((n=d(e))&&!~b(c(s(h(e))),"g"))throw new y("`.replaceAll` does not allow non-global regexes");if(r=u(e,m))return i(r,e,P,t);if(f&&n)return v(c(P),e,t)}for(o=c(P),g=c(e),(w=a(t))||(t=c(t)),_=S(1,C=g.length),I=b(o,g);-1!==I;)k=w?c(t(g,I,o)):p(g,o,I,[],void 0,t),j+=x(o,E,I)+k,E=I+C,I=I+_>o.length?-1:b(o,g,I+_);return E<o.length&&(j+=x(o,E)),j}})},1165:(e,t,n)=>{"use strict";var r=n(5540),i=n(6809),o=n(2611),s=n(9882),a=n(5744),l=n(5365),d=n(867),c=n(3531),u=n(8011),h=n(6846),p=n(8234),g=n(5626),f=n(2281),m=n(9923),y=n(1592),b=n(3529),v=n(6317)("replace"),x=Math.max,S=Math.min,w=o([].concat),C=o([].push),_=o("".indexOf),k=o("".slice),P="$0"==="a".replace(/./,"$0"),I=!!/./[v]&&""===/./[v]("a","$0");s("replace",function(e,t,n){var o=I?"$":"$0";return[function(e,n){var r=g(this),o=c(e)?void 0:m(e,v);return o?i(o,e,r,n):i(t,p(r),e,n)},function(e,i){var s=l(this),a=p(e);if("string"==typeof i&&-1===_(i,o)&&-1===_(i,"$<")){var c=n(t,s,a,i);if(c.done)return c.value}var g=d(i);g||(i=p(i));var m=s.global;m&&(M=s.unicode,s.lastIndex=0);for(var v=[];null!==(T=b(s,a))&&(C(v,T),m);)""===p(T[0])&&(s.lastIndex=f(a,h(s.lastIndex),M));for(var P="",I=0,E=0;E<v.length;E++){for(var j,M,T,A,O=p((T=v[E])[0]),R=x(S(u(T.index),a.length),0),L=[],D=1;D<T.length;D++)C(L,void 0===(j=T[D])?j:String(j));var z=T.groups;if(g){var N=w([O],L,R,a);void 0!==z&&C(N,z),A=p(r(i,void 0,N))}else A=y(O,a,R,L,z,i);R>=I&&(P+=k(a,I,R)+A,I=R+O.length)}return P+k(a,I)}]},!!a(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})||!P||I)},9280:(e,t,n)=>{"use strict";var r=n(9835);e.exports=r},1837:(e,t,n)=>{"use strict";var r=n(3136);e.exports=r},1482:(e,t,n)=>{"use strict";var r=n(9091);e.exports=r},9338:(e,t,n)=>{"use strict";var r=n(1316);e.exports=r},1465:(e,t,n)=>{"use strict";var r=n(4015);e.exports=r}};var t=require("../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[734],()=>n(4596));module.exports=r})();