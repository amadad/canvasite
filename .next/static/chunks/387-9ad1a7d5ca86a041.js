(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[387],{2492:function(){},7836:function(e){"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,s){if("function"!=typeof r)throw TypeError("The listener must be a function");var a=new i(r,o||e,s),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1)),a.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,s=Array(o);i<o;i++)s[i]=r[i].fn;return s},a.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,i,o,s){var a=n?n+e:e;if(!this._events[a])return!1;var l,c,u=this._events[a],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,i),!0;case 5:return u.fn.call(u.context,t,r,i,o),!0;case 6:return u.fn.call(u.context,t,r,i,o,s),!0}for(c=1,l=Array(d-1);c<d;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var h,p=u.length;for(c=0;c<p;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),d){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,r);break;case 4:u[c].fn.call(u[c].context,t,r,i);break;default:if(!l)for(h=1,l=Array(d-1);h<d;h++)l[h-1]=arguments[h];u[c].fn.apply(u[c].context,l)}}return!0},a.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return s(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||i&&!a.once||r&&a.context!==r||s(this,o);else{for(var l=0,c=[],u=a.length;l<u;l++)(a[l].fn!==t||i&&!a[l].once||r&&a[l].context!==r)&&c.push(a[l]);c.length?this._events[o]=1===c.length?c[0]:c:s(this,o)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&s(this,t)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a},8355:function(e,t,n){e=n.nmd(e);var r,i,o,s="__lodash_hash_undefined__",a="[object Arguments]",l="[object Array]",c="[object Boolean]",u="[object Date]",d="[object Error]",h="[object Function]",p="[object Map]",f="[object Number]",g="[object Object]",m="[object Promise]",y="[object RegExp]",b="[object Set]",w="[object String]",x="[object WeakMap]",v="[object ArrayBuffer]",S="[object DataView]",k=/^\[object .+?Constructor\]$/,_=/^(?:0|[1-9]\d*)$/,E={};E["[object Float32Array]"]=E["[object Float64Array]"]=E["[object Int8Array]"]=E["[object Int16Array]"]=E["[object Int32Array]"]=E["[object Uint8Array]"]=E["[object Uint8ClampedArray]"]=E["[object Uint16Array]"]=E["[object Uint32Array]"]=!0,E[a]=E[l]=E[v]=E[c]=E[S]=E[u]=E[d]=E[h]=E[p]=E[f]=E[g]=E[y]=E[b]=E[w]=E[x]=!1;var C="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,P="object"==typeof self&&self&&self.Object===Object&&self,T=C||P||Function("return this")(),j=t&&!t.nodeType&&t,I=j&&e&&!e.nodeType&&e,M=I&&I.exports===j,A=M&&C.process,O=function(){try{return A&&A.binding&&A.binding("util")}catch(e){}}(),$=O&&O.isTypedArray;function B(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function D(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var L=Array.prototype,R=Function.prototype,z=Object.prototype,N=T["__core-js_shared__"],F=R.toString,U=z.hasOwnProperty,V=(r=/[^.]+$/.exec(N&&N.keys&&N.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"",H=z.toString,Z=RegExp("^"+F.call(U).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),K=M?T.Buffer:void 0,W=T.Symbol,Y=T.Uint8Array,G=z.propertyIsEnumerable,X=L.splice,q=W?W.toStringTag:void 0,J=Object.getOwnPropertySymbols,Q=K?K.isBuffer:void 0,ee=(i=Object.keys,o=Object,function(e){return i(o(e))}),et=eE(T,"DataView"),en=eE(T,"Map"),er=eE(T,"Promise"),ei=eE(T,"Set"),eo=eE(T,"WeakMap"),es=eE(Object,"create"),ea=eT(et),el=eT(en),ec=eT(er),eu=eT(ei),ed=eT(eo),eh=W?W.prototype:void 0,ep=eh?eh.valueOf:void 0;function ef(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function eg(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function em(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ey(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new em;++t<n;)this.add(e[t])}function eb(e){var t=this.__data__=new eg(e);this.size=t.size}function ew(e,t){for(var n=e.length;n--;)if(ej(e[n][0],t))return n;return -1}function ex(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":q&&q in Object(e)?function(e){var t=U.call(e,q),n=e[q];try{e[q]=void 0;var r=!0}catch(e){}var i=H.call(e);return r&&(t?e[q]=n:delete e[q]),i}(e):H.call(e)}function ev(e){return eD(e)&&ex(e)==a}function eS(e,t,n,r,i,o){var s=1&n,a=e.length,l=t.length;if(a!=l&&!(s&&l>a))return!1;var c=o.get(e);if(c&&o.get(t))return c==t;var u=-1,d=!0,h=2&n?new ey:void 0;for(o.set(e,t),o.set(t,e);++u<a;){var p=e[u],f=t[u];if(r)var g=s?r(f,p,u,t,e,o):r(p,f,u,e,t,o);if(void 0!==g){if(g)continue;d=!1;break}if(h){if(!function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}(t,function(e,t){if(!h.has(t)&&(p===e||i(p,e,n,r,o)))return h.push(t)})){d=!1;break}}else if(!(p===f||i(p,f,n,r,o))){d=!1;break}}return o.delete(e),o.delete(t),d}function ek(e){var t;return t=function(e){return null!=e&&e$(e.length)&&!eO(e)?function(e,t){var n,r=eM(e),i=!r&&eI(e),o=!r&&!i&&eA(e),s=!r&&!i&&!o&&eL(e),a=r||i||o||s,l=a?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],c=l.length;for(var u in e)U.call(e,u)&&!(a&&("length"==u||o&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||(n=null==(n=c)?9007199254740991:n)&&("number"==typeof u||_.test(u))&&u>-1&&u%1==0&&u<n))&&l.push(u);return l}(e):function(e){if(t=e&&e.constructor,e!==("function"==typeof t&&t.prototype||z))return ee(e);var t,n=[];for(var r in Object(e))U.call(e,r)&&"constructor"!=r&&n.push(r);return n}(e)}(e),eM(e)?t:function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}(t,eC(e))}function e_(e,t){var n,r=e.__data__;return("string"==(n=typeof t)||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t)?r["string"==typeof t?"string":"hash"]:r.map}function eE(e,t){var n=null==e?void 0:e[t];return!(!eB(n)||V&&V in n)&&(eO(n)?Z:k).test(eT(n))?n:void 0}ef.prototype.clear=function(){this.__data__=es?es(null):{},this.size=0},ef.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ef.prototype.get=function(e){var t=this.__data__;if(es){var n=t[e];return n===s?void 0:n}return U.call(t,e)?t[e]:void 0},ef.prototype.has=function(e){var t=this.__data__;return es?void 0!==t[e]:U.call(t,e)},ef.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=es&&void 0===t?s:t,this},eg.prototype.clear=function(){this.__data__=[],this.size=0},eg.prototype.delete=function(e){var t=this.__data__,n=ew(t,e);return!(n<0)&&(n==t.length-1?t.pop():X.call(t,n,1),--this.size,!0)},eg.prototype.get=function(e){var t=this.__data__,n=ew(t,e);return n<0?void 0:t[n][1]},eg.prototype.has=function(e){return ew(this.__data__,e)>-1},eg.prototype.set=function(e,t){var n=this.__data__,r=ew(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},em.prototype.clear=function(){this.size=0,this.__data__={hash:new ef,map:new(en||eg),string:new ef}},em.prototype.delete=function(e){var t=e_(this,e).delete(e);return this.size-=t?1:0,t},em.prototype.get=function(e){return e_(this,e).get(e)},em.prototype.has=function(e){return e_(this,e).has(e)},em.prototype.set=function(e,t){var n=e_(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},ey.prototype.add=ey.prototype.push=function(e){return this.__data__.set(e,s),this},ey.prototype.has=function(e){return this.__data__.has(e)},eb.prototype.clear=function(){this.__data__=new eg,this.size=0},eb.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},eb.prototype.get=function(e){return this.__data__.get(e)},eb.prototype.has=function(e){return this.__data__.has(e)},eb.prototype.set=function(e,t){var n=this.__data__;if(n instanceof eg){var r=n.__data__;if(!en||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new em(r)}return n.set(e,t),this.size=n.size,this};var eC=J?function(e){return null==e?[]:function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var s=e[n];t(s,n,e)&&(o[i++]=s)}return o}(J(e=Object(e)),function(t){return G.call(e,t)})}:function(){return[]},eP=ex;function eT(e){if(null!=e){try{return F.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function ej(e,t){return e===t||e!=e&&t!=t}(et&&eP(new et(new ArrayBuffer(1)))!=S||en&&eP(new en)!=p||er&&eP(er.resolve())!=m||ei&&eP(new ei)!=b||eo&&eP(new eo)!=x)&&(eP=function(e){var t=ex(e),n=t==g?e.constructor:void 0,r=n?eT(n):"";if(r)switch(r){case ea:return S;case el:return p;case ec:return m;case eu:return b;case ed:return x}return t});var eI=ev(function(){return arguments}())?ev:function(e){return eD(e)&&U.call(e,"callee")&&!G.call(e,"callee")},eM=Array.isArray,eA=Q||function(){return!1};function eO(e){if(!eB(e))return!1;var t=ex(e);return t==h||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function e$(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function eB(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function eD(e){return null!=e&&"object"==typeof e}var eL=$?function(e){return $(e)}:function(e){return eD(e)&&e$(e.length)&&!!E[ex(e)]};e.exports=function(e,t){return function e(t,n,r,i,o){return t===n||(null!=t&&null!=n&&(eD(t)||eD(n))?function(e,t,n,r,i,o){var s=eM(e),h=eM(t),m=s?l:eP(e),x=h?l:eP(t);m=m==a?g:m,x=x==a?g:x;var k=m==g,_=x==g,E=m==x;if(E&&eA(e)){if(!eA(t))return!1;s=!0,k=!1}if(E&&!k)return o||(o=new eb),s||eL(e)?eS(e,t,n,r,i,o):function(e,t,n,r,i,o,s){switch(n){case S:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case v:if(e.byteLength!=t.byteLength||!o(new Y(e),new Y(t)))break;return!0;case c:case u:case f:return ej(+e,+t);case d:return e.name==t.name&&e.message==t.message;case y:case w:return e==t+"";case p:var a=B;case b:var l=1&r;if(a||(a=D),e.size!=t.size&&!l)break;var h=s.get(e);if(h)return h==t;r|=2,s.set(e,t);var g=eS(a(e),a(t),r,i,o,s);return s.delete(e),g;case"[object Symbol]":if(ep)return ep.call(e)==ep.call(t)}return!1}(e,t,m,n,r,i,o);if(!(1&n)){var C=k&&U.call(e,"__wrapped__"),P=_&&U.call(t,"__wrapped__");if(C||P){var T=C?e.value():e,j=P?t.value():t;return o||(o=new eb),i(T,j,n,r,o)}}return!!E&&(o||(o=new eb),function(e,t,n,r,i,o){var s=1&n,a=ek(e),l=a.length;if(l!=ek(t).length&&!s)return!1;for(var c=l;c--;){var u=a[c];if(!(s?u in t:U.call(t,u)))return!1}var d=o.get(e);if(d&&o.get(t))return d==t;var h=!0;o.set(e,t),o.set(t,e);for(var p=s;++c<l;){var f=e[u=a[c]],g=t[u];if(r)var m=s?r(g,f,u,t,e,o):r(f,g,u,e,t,o);if(!(void 0===m?f===g||i(f,g,n,r,o):m)){h=!1;break}p||(p="constructor"==u)}if(h&&!p){var y=e.constructor,b=t.constructor;y!=b&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b)&&(h=!1)}return o.delete(e),o.delete(t),h}(e,t,n,r,i,o))}(t,n,r,i,e,o):t!=t&&n!=n)}(e,t)}},7701:function(e,t,n){var r="Expected a function",i=0/0,o=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,l=/^0o[0-7]+$/i,c=parseInt,u="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,d="object"==typeof self&&self&&self.Object===Object&&self,h=u||d||Function("return this")(),p=Object.prototype.toString,f=Math.max,g=Math.min,m=function(){return h.Date.now()};function y(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function b(e){if("number"==typeof e)return e;if("symbol"==typeof(t=e)||t&&"object"==typeof t&&"[object Symbol]"==p.call(t))return i;if(y(e)){var t,n="function"==typeof e.valueOf?e.valueOf():e;e=y(n)?n+"":n}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(o,"");var r=a.test(e);return r||l.test(e)?c(e.slice(2),r?2:8):s.test(e)?i:+e}e.exports=function(e,t,n){var i=!0,o=!0;if("function"!=typeof e)throw TypeError(r);return y(n)&&(i="leading"in n?!!n.leading:i,o="trailing"in n?!!n.trailing:o),function(e,t,n){var i,o,s,a,l,c,u=0,d=!1,h=!1,p=!0;if("function"!=typeof e)throw TypeError(r);function w(t){var n=i,r=o;return i=o=void 0,u=t,a=e.apply(r,n)}function x(e){var n=e-c,r=e-u;return void 0===c||n>=t||n<0||h&&r>=s}function v(){var e,n,r,i=m();if(x(i))return S(i);l=setTimeout(v,(e=i-c,n=i-u,r=t-e,h?g(r,s-n):r))}function S(e){return(l=void 0,p&&i)?w(e):(i=o=void 0,a)}function k(){var e,n=m(),r=x(n);if(i=arguments,o=this,c=n,r){if(void 0===l)return u=e=c,l=setTimeout(v,t),d?w(e):a;if(h)return l=setTimeout(v,t),w(c)}return void 0===l&&(l=setTimeout(v,t)),a}return t=b(t)||0,y(n)&&(d=!!n.leading,s=(h="maxWait"in n)?f(b(n.maxWait)||0,t):s,p="trailing"in n?!!n.trailing:p),k.cancel=function(){void 0!==l&&clearTimeout(l),u=0,i=c=o=l=void 0},k.flush=function(){return void 0===l?a:S(m())},k}(e,t,{leading:i,maxWait:t,trailing:o})}},4408:function(e,t,n){var r,i="__lodash_hash_undefined__",o=/^\[object .+?Constructor\]$/,s="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,a="object"==typeof self&&self&&self.Object===Object&&self,l=s||a||Function("return this")();function c(e,t){return!!(e?e.length:0)&&function(e,t,n){if(t!=t)return function(e,t,n,r){for(var i=e.length,o=-1;++o<i;)if(t(e[o],o,e))return o;return -1}(e,u,0);for(var r=-1,i=e.length;++r<i;)if(e[r]===t)return r;return -1}(e,t,0)>-1}function u(e){return e!=e}function d(e,t){return e.has(t)}function h(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var p=Array.prototype,f=Function.prototype,g=Object.prototype,m=l["__core-js_shared__"],y=(r=/[^.]+$/.exec(m&&m.keys&&m.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"",b=f.toString,w=g.hasOwnProperty,x=g.toString,v=RegExp("^"+b.call(w).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),S=p.splice,k=O(l,"Map"),_=O(l,"Set"),E=O(Object,"create");function C(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function P(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function T(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function j(e){var t=-1,n=e?e.length:0;for(this.__data__=new T;++t<n;)this.add(e[t])}function I(e,t){for(var n,r=e.length;r--;)if((n=e[r][0])===t||n!=n&&t!=t)return r;return -1}C.prototype.clear=function(){this.__data__=E?E(null):{}},C.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},C.prototype.get=function(e){var t=this.__data__;if(E){var n=t[e];return n===i?void 0:n}return w.call(t,e)?t[e]:void 0},C.prototype.has=function(e){var t=this.__data__;return E?void 0!==t[e]:w.call(t,e)},C.prototype.set=function(e,t){return this.__data__[e]=E&&void 0===t?i:t,this},P.prototype.clear=function(){this.__data__=[]},P.prototype.delete=function(e){var t=this.__data__,n=I(t,e);return!(n<0)&&(n==t.length-1?t.pop():S.call(t,n,1),!0)},P.prototype.get=function(e){var t=this.__data__,n=I(t,e);return n<0?void 0:t[n][1]},P.prototype.has=function(e){return I(this.__data__,e)>-1},P.prototype.set=function(e,t){var n=this.__data__,r=I(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},T.prototype.clear=function(){this.__data__={hash:new C,map:new(k||P),string:new C}},T.prototype.delete=function(e){return A(this,e).delete(e)},T.prototype.get=function(e){return A(this,e).get(e)},T.prototype.has=function(e){return A(this,e).has(e)},T.prototype.set=function(e,t){return A(this,e).set(e,t),this},j.prototype.add=j.prototype.push=function(e){return this.__data__.set(e,i),this},j.prototype.has=function(e){return this.__data__.has(e)};var M=_&&1/h(new _([,-0]))[1]==1/0?function(e){return new _(e)}:function(){};function A(e,t){var n,r=e.__data__;return("string"==(n=typeof t)||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t)?r["string"==typeof t?"string":"hash"]:r.map}function O(e,t){var n,r=null==e?void 0:e[t];return!(!$(r)||y&&y in r)&&("[object Function]"==(n=$(r)?x.call(r):"")||"[object GeneratorFunction]"==n||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(r)?v:o).test(function(e){if(null!=e){try{return b.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(r))?r:void 0}function $(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}e.exports=function(e){return e&&e.length?function(e,t,n){var r=-1,i=c,o=e.length,s=!0,a=[],l=a;if(o>=200){var u=M(e);if(u)return h(u);s=!1,i=d,l=new j}else l=a;e:for(;++r<o;){var p=e[r],f=p;if(p=0!==p?p:0,s&&f==f){for(var g=l.length;g--;)if(l[g]===f)continue e;t&&l.push(f),a.push(p)}else i(l,f,void 0)||(l!==a&&l.push(f),a.push(p))}return a}(e):[]}},6488:function(e,t,n){var r,i=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={};function i(e,t){if(!r[e]){r[e]={};for(var n=0;n<e.length;n++)r[e][e.charAt(n)]=n}return r[e][t]}var o={compressToBase64:function(e){if(null==e)return"";var n=o._compress(e,6,function(e){return t.charAt(e)});switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:o._decompress(e.length,32,function(n){return i(t,e.charAt(n))})},compressToUTF16:function(t){return null==t?"":o._compress(t,15,function(t){return e(t+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:o._decompress(e.length,16384,function(t){return e.charCodeAt(t)-32})},compressToUint8Array:function(e){for(var t=o.compress(e),n=new Uint8Array(2*t.length),r=0,i=t.length;r<i;r++){var s=t.charCodeAt(r);n[2*r]=s>>>8,n[2*r+1]=s%256}return n},decompressFromUint8Array:function(t){if(null==t)return o.decompress(t);for(var n=Array(t.length/2),r=0,i=n.length;r<i;r++)n[r]=256*t[2*r]+t[2*r+1];var s=[];return n.forEach(function(t){s.push(e(t))}),o.decompress(s.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":o._compress(e,6,function(e){return n.charAt(e)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),o._decompress(e.length,32,function(t){return i(n,e.charAt(t))}))},compress:function(t){return o._compress(t,16,function(t){return e(t)})},_compress:function(e,t,n){if(null==e)return"";var r,i,o,s={},a={},l="",c="",u="",d=2,h=3,p=2,f=[],g=0,m=0;for(o=0;o<e.length;o+=1)if(l=e.charAt(o),Object.prototype.hasOwnProperty.call(s,l)||(s[l]=h++,a[l]=!0),c=u+l,Object.prototype.hasOwnProperty.call(s,c))u=c;else{if(Object.prototype.hasOwnProperty.call(a,u)){if(256>u.charCodeAt(0)){for(r=0;r<p;r++)g<<=1,m==t-1?(m=0,f.push(n(g)),g=0):m++;for(r=0,i=u.charCodeAt(0);r<8;r++)g=g<<1|1&i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i>>=1}else{for(r=0,i=1;r<p;r++)g=g<<1|i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i=0;for(r=0,i=u.charCodeAt(0);r<16;r++)g=g<<1|1&i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i>>=1}0==--d&&(d=Math.pow(2,p),p++),delete a[u]}else for(r=0,i=s[u];r<p;r++)g=g<<1|1&i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i>>=1;0==--d&&(d=Math.pow(2,p),p++),s[c]=h++,u=String(l)}if(""!==u){if(Object.prototype.hasOwnProperty.call(a,u)){if(256>u.charCodeAt(0)){for(r=0;r<p;r++)g<<=1,m==t-1?(m=0,f.push(n(g)),g=0):m++;for(r=0,i=u.charCodeAt(0);r<8;r++)g=g<<1|1&i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i>>=1}else{for(r=0,i=1;r<p;r++)g=g<<1|i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i=0;for(r=0,i=u.charCodeAt(0);r<16;r++)g=g<<1|1&i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i>>=1}0==--d&&(d=Math.pow(2,p),p++),delete a[u]}else for(r=0,i=s[u];r<p;r++)g=g<<1|1&i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i>>=1;0==--d&&(d=Math.pow(2,p),p++)}for(r=0,i=2;r<p;r++)g=g<<1|1&i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i>>=1;for(;;){if(g<<=1,m==t-1){f.push(n(g));break}m++}return f.join("")},decompress:function(e){return null==e?"":""==e?null:o._decompress(e.length,32768,function(t){return e.charCodeAt(t)})},_decompress:function(t,n,r){var i,o,s,a,l,c,u,d=[],h=4,p=4,f=3,g="",m=[],y={val:r(0),position:n,index:1};for(i=0;i<3;i+=1)d[i]=i;for(s=0,l=4,c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*c,c<<=1;switch(s){case 0:for(s=0,l=256,c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*c,c<<=1;u=e(s);break;case 1:for(s=0,l=65536,c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*c,c<<=1;u=e(s);break;case 2:return""}for(d[3]=u,o=u,m.push(u);;){if(y.index>t)return"";for(s=0,l=Math.pow(2,f),c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*c,c<<=1;switch(u=s){case 0:for(s=0,l=256,c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*c,c<<=1;d[p++]=e(s),u=p-1,h--;break;case 1:for(s=0,l=65536,c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*c,c<<=1;d[p++]=e(s),u=p-1,h--;break;case 2:return m.join("")}if(0==h&&(h=Math.pow(2,f),f++),d[u])g=d[u];else{if(u!==p)return null;g=o+o.charAt(0)}m.push(g),d[p++]=o+g.charAt(0),h--,o=g,0==h&&(h=Math.pow(2,f),f++)}}};return o}();void 0!==(r=(function(){return i}).call(t,n,t,e))&&(e.exports=r)},7818:function(e,t,n){"use strict";n.d(t,{default:function(){return i.a}});var r=n(551),i=n.n(r)},357:function(e,t,n){"use strict";var r,i;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(i=n.g.process)?void 0:i.env)?n.g.process:n(8081)},8081:function(e){!function(){var t={229:function(e){var t,n,r,i=e.exports={};function o(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:o}catch(e){t=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var l=[],c=!1,u=-1;function d(){c&&r&&(c=!1,r.length?l=r.concat(l):u=-1,l.length&&h())}function h(){if(!c){var e=a(d);c=!0;for(var t=l.length;t;){for(r=l,l=[];++u<t;)r&&r[u].run();u=-1,t=l.length}r=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function f(){}i.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new p(e,t)),1!==l.length||c||a(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=f,i.addListener=f,i.once=f,i.off=f,i.removeListener=f,i.removeAllListeners=f,i.emit=f,i.prependListener=f,i.prependOnceListener=f,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var o=n[e]={exports:{}},s=!0;try{t[e](o,o.exports,r),s=!1}finally{s&&delete n[e]}return o.exports}r.ab="//";var i=r(229);e.exports=i}()},551:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});let r=n(9920);n(7437),n(2265);let i=r._(n(148));function o(e,t){var n;let r={loading:e=>{let{error:t,isLoading:n,pastDelay:r}=e;return null}};"function"==typeof e&&(r.loader=e);let o={...r,...t};return(0,i.default)({...o,modules:null==(n=o.loadableGenerated)?void 0:n.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},912:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return i}});let r=n(5592);function i(e){let{reason:t,children:n}=e;if("undefined"==typeof window)throw new r.BailoutToCSRError(t);return n}},148:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return c}});let r=n(7437),i=n(2265),o=n(912),s=n(1481);function a(e){return{default:e&&"default"in e?e.default:e}}let l={loader:()=>Promise.resolve(a(()=>null)),loading:null,ssr:!0},c=function(e){let t={...l,...e},n=(0,i.lazy)(()=>t.loader().then(a)),c=t.loading;function u(e){let a=c?(0,r.jsx)(c,{isLoading:!0,pastDelay:!0,error:null}):null,l=t.ssr?(0,r.jsxs)(r.Fragment,{children:["undefined"==typeof window?(0,r.jsx)(s.PreloadCss,{moduleIds:t.modules}):null,(0,r.jsx)(n,{...e})]}):(0,r.jsx)(o.BailoutToCSR,{reason:"next/dynamic",children:(0,r.jsx)(n,{...e})});return(0,r.jsx)(i.Suspense,{fallback:a,children:l})}return u.displayName="LoadableComponent",u}},1481:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return o}});let r=n(7437),i=n(8512);function o(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let n=(0,i.getExpectedRequestStore)("next/dynamic css"),o=[];if(n.reactLoadableManifest&&t){let e=n.reactLoadableManifest;for(let n of t){if(!e[n])continue;let t=e[n].files.filter(e=>e.endsWith(".css"));o.push(...t)}}return 0===o.length?null:(0,r.jsx)(r.Fragment,{children:o.map(e=>(0,r.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:n.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}},529:function(){},6800:function(e,t){var n;/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/!function(){"use strict";var r={}.hasOwnProperty;function i(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=o(e,function(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return i.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)r.call(e,n)&&e[n]&&(t=o(t,n));return t}(n)))}return e}function o(e,t){return t?e?e+" "+t:e+t:e}e.exports?(i.default=i,e.exports=i):void 0!==(n=(function(){return i}).apply(t,[]))&&(e.exports=n)}()},2587:function(e,t,n){"use strict";n(5943);var r=n(7569);e.exports=r("Array","at")},1139:function(e,t,n){"use strict";n(6158),n(507);var r=n(7569);e.exports=r("Array","flatMap")},8078:function(e,t,n){"use strict";n(5232),n(2458);var r=n(7569);e.exports=r("Array","flat")},1975:function(e,t,n){"use strict";n(7956);var r=n(7569);e.exports=r("String","at")},2422:function(e,t,n){"use strict";n(1571),n(5089),n(8560);var r=n(7569);e.exports=r("String","replaceAll")},5084:function(e,t,n){"use strict";var r=n(3385),i=n(648),o=TypeError;e.exports=function(e){if(r(e))return e;throw new o(i(e)+" is not a function")}},4479:function(e,t,n){"use strict";var r=n(8869),i=n(8472),o=n(7100).f,s=r("unscopables"),a=Array.prototype;void 0===a[s]&&o(a,s,{configurable:!0,value:i(null)}),e.exports=function(e){a[s][e]=!0}},2857:function(e,t,n){"use strict";var r=n(5418).charAt;e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},6188:function(e,t,n){"use strict";var r=n(2005),i=String,o=TypeError;e.exports=function(e){if(r(e))return e;throw new o(i(e)+" is not an object")}},7531:function(e,t,n){"use strict";var r=n(7905),i=n(141),o=n(5930),s=function(e){return function(t,n,s){var a,l=r(t),c=o(l),u=i(s,c);if(e&&n!=n){for(;c>u;)if((a=l[u++])!=a)return!0}else for(;c>u;u++)if((e||u in l)&&l[u]===n)return e||u||0;return!e&&-1}};e.exports={includes:s(!0),indexOf:s(!1)}},2485:function(e,t,n){"use strict";var r=n(1106),i=n(4379),o=n(2005),s=n(8869)("species"),a=Array;e.exports=function(e){var t;return r(e)&&(i(t=e.constructor)&&(t===a||r(t.prototype))?t=void 0:o(t)&&null===(t=t[s])&&(t=void 0)),void 0===t?a:t}},57:function(e,t,n){"use strict";var r=n(2485);e.exports=function(e,t){return new(r(e))(0===t?0:t)}},5877:function(e,t,n){"use strict";var r=n(9278),i=r({}.toString),o=r("".slice);e.exports=function(e){return o(i(e),8,-1)}},3851:function(e,t,n){"use strict";var r=n(6970),i=n(3385),o=n(5877),s=n(8869)("toStringTag"),a=Object,l="Arguments"===o(function(){return arguments}()),c=function(e,t){try{return e[t]}catch(e){}};e.exports=r?o:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=c(t=a(e),s))?n:l?o(t):"Object"===(r=o(t))&&i(t.callee)?"Arguments":r}},895:function(e,t,n){"use strict";var r=n(8417),i=n(8699),o=n(3314),s=n(7100);e.exports=function(e,t,n){for(var a=i(t),l=s.f,c=o.f,u=0;u<a.length;u++){var d=a[u];r(e,d)||n&&r(n,d)||l(e,d,c(t,d))}}},2063:function(e,t,n){"use strict";var r=n(7972),i=n(7100),o=n(5345);e.exports=r?function(e,t,n){return i.f(e,t,o(1,n))}:function(e,t,n){return e[t]=n,e}},5345:function(e){"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},4035:function(e,t,n){"use strict";var r=n(3385),i=n(7100),o=n(5114),s=n(8808);e.exports=function(e,t,n,a){a||(a={});var l=a.enumerable,c=void 0!==a.name?a.name:t;if(r(n)&&o(n,c,a),a.global)l?e[t]=n:s(t,n);else{try{a.unsafe?e[t]&&(l=!0):delete e[t]}catch(e){}l?e[t]=n:i.f(e,t,{value:n,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return e}},8808:function(e,t,n){"use strict";var r=n(6946),i=Object.defineProperty;e.exports=function(e,t){try{i(r,e,{value:t,configurable:!0,writable:!0})}catch(n){r[e]=t}return t}},7972:function(e,t,n){"use strict";var r=n(3958);e.exports=!r(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})},2415:function(e,t,n){"use strict";var r=n(6946),i=n(2005),o=r.document,s=i(o)&&i(o.createElement);e.exports=function(e){return s?o.createElement(e):{}}},4412:function(e){"use strict";var t=TypeError;e.exports=function(e){if(e>9007199254740991)throw t("Maximum allowed index exceeded");return e}},6797:function(e){"use strict";e.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},9220:function(e,t,n){"use strict";var r,i,o=n(6946),s=n(6797),a=o.process,l=o.Deno,c=a&&a.versions||l&&l.version,u=c&&c.v8;u&&(i=(r=u.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!i&&s&&(!(r=s.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=s.match(/Chrome\/(\d+)/))&&(i=+r[1]),e.exports=i},7569:function(e,t,n){"use strict";var r=n(6946),i=n(9278);e.exports=function(e,t){return i(r[e].prototype[t])}},3395:function(e){"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},7096:function(e,t,n){"use strict";var r=n(6946),i=n(3314).f,o=n(2063),s=n(4035),a=n(8808),l=n(895),c=n(2515);e.exports=function(e,t){var n,u,d,h,p,f=e.target,g=e.global,m=e.stat;if(n=g?r:m?r[f]||a(f,{}):r[f]&&r[f].prototype)for(u in t){if(h=t[u],d=e.dontCallGetSet?(p=i(n,u))&&p.value:n[u],!c(g?u:f+(m?".":"#")+u,e.forced)&&void 0!==d){if(typeof h==typeof d)continue;l(h,d)}(e.sham||d&&d.sham)&&o(h,"sham",!0),s(n,u,h,e)}}},3958:function(e){"use strict";e.exports=function(e){try{return!!e()}catch(e){return!0}}},5439:function(e,t,n){"use strict";n(1571);var r=n(5184),i=n(4035),o=n(6097),s=n(3958),a=n(8869),l=n(2063),c=a("species"),u=RegExp.prototype;e.exports=function(e,t,n,d){var h=a(e),p=!s(function(){var t={};return t[h]=function(){return 7},7!==""[e](t)}),f=p&&!s(function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[c]=function(){return n},n.flags="",n[h]=/./[h]),n.exec=function(){return t=!0,null},n[h](""),!t});if(!p||!f||n){var g=/./[h],m=t(h,""[e],function(e,t,n,i,s){var a=t.exec;return a===o||a===u.exec?p&&!s?{done:!0,value:r(g,t,n,i)}:{done:!0,value:r(e,n,t,i)}:{done:!1}});i(String.prototype,e,m[0]),i(u,h,m[1])}d&&l(u[h],"sham",!0)}},6487:function(e,t,n){"use strict";var r=n(1106),i=n(5930),o=n(4412),s=n(4346),a=function(e,t,n,l,c,u,d,h){for(var p,f,g=c,m=0,y=!!d&&s(d,h);m<l;)m in n&&(p=y?y(n[m],m,t):n[m],u>0&&r(p)?(f=i(p),g=a(e,t,p,f,g,u-1)-1):(o(g+1),e[g]=p),g++),m++;return g};e.exports=a},413:function(e,t,n){"use strict";var r=n(7195),i=Function.prototype,o=i.apply,s=i.call;e.exports="object"==typeof Reflect&&Reflect.apply||(r?s.bind(o):function(){return s.apply(o,arguments)})},4346:function(e,t,n){"use strict";var r=n(8394),i=n(5084),o=n(7195),s=r(r.bind);e.exports=function(e,t){return i(e),void 0===t?e:o?s(e,t):function(){return e.apply(t,arguments)}}},7195:function(e,t,n){"use strict";var r=n(3958);e.exports=!r(function(){var e=(function(){}).bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})},5184:function(e,t,n){"use strict";var r=n(7195),i=Function.prototype.call;e.exports=r?i.bind(i):function(){return i.apply(i,arguments)}},130:function(e,t,n){"use strict";var r=n(7972),i=n(8417),o=Function.prototype,s=r&&Object.getOwnPropertyDescriptor,a=i(o,"name"),l=a&&(!r||r&&s(o,"name").configurable);e.exports={EXISTS:a,PROPER:a&&"something"===(function(){}).name,CONFIGURABLE:l}},8394:function(e,t,n){"use strict";var r=n(5877),i=n(9278);e.exports=function(e){if("Function"===r(e))return i(e)}},9278:function(e,t,n){"use strict";var r=n(7195),i=Function.prototype,o=i.call,s=r&&i.bind.bind(o,o);e.exports=r?s:function(e){return function(){return o.apply(e,arguments)}}},9989:function(e,t,n){"use strict";var r=n(6946),i=n(3385);e.exports=function(e,t){var n;return arguments.length<2?i(n=r[e])?n:void 0:r[e]&&r[e][t]}},5107:function(e,t,n){"use strict";var r=n(5084),i=n(4642);e.exports=function(e,t){var n=e[t];return i(n)?void 0:r(n)}},3253:function(e,t,n){"use strict";var r=n(9278),i=n(232),o=Math.floor,s=r("".charAt),a=r("".replace),l=r("".slice),c=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,u=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,t,n,r,d,h){var p=n+e.length,f=r.length,g=u;return void 0!==d&&(d=i(d),g=c),a(h,g,function(i,a){var c;switch(s(a,0)){case"$":return"$";case"&":return e;case"`":return l(t,0,n);case"'":return l(t,p);case"<":c=d[l(a,1,-1)];break;default:var u=+a;if(0===u)return i;if(u>f){var h=o(u/10);if(0===h)return i;if(h<=f)return void 0===r[h-1]?s(a,1):r[h-1]+s(a,1);return i}c=r[u-1]}return void 0===c?"":c})}},6946:function(e,t,n){"use strict";var r=function(e){return e&&e.Math===Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof n.g&&n.g)||r("object"==typeof this&&this)||function(){return this}()||Function("return this")()},8417:function(e,t,n){"use strict";var r=n(9278),i=n(232),o=r({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(i(e),t)}},6390:function(e){"use strict";e.exports={}},7598:function(e,t,n){"use strict";var r=n(9989);e.exports=r("document","documentElement")},3039:function(e,t,n){"use strict";var r=n(7972),i=n(3958),o=n(2415);e.exports=!r&&!i(function(){return 7!==Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a})},9693:function(e,t,n){"use strict";var r=n(9278),i=n(3958),o=n(5877),s=Object,a=r("".split);e.exports=i(function(){return!s("z").propertyIsEnumerable(0)})?function(e){return"String"===o(e)?a(e,""):s(e)}:s},9307:function(e,t,n){"use strict";var r=n(9278),i=n(3385),o=n(6853),s=r(Function.toString);i(o.inspectSource)||(o.inspectSource=function(e){return s(e)}),e.exports=o.inspectSource},4101:function(e,t,n){"use strict";var r,i,o,s=n(1911),a=n(6946),l=n(2005),c=n(2063),u=n(8417),d=n(6853),h=n(3942),p=n(6390),f="Object already initialized",g=a.TypeError,m=a.WeakMap;if(s||d.state){var y=d.state||(d.state=new m);y.get=y.get,y.has=y.has,y.set=y.set,r=function(e,t){if(y.has(e))throw new g(f);return t.facade=e,y.set(e,t),t},i=function(e){return y.get(e)||{}},o=function(e){return y.has(e)}}else{var b=h("state");p[b]=!0,r=function(e,t){if(u(e,b))throw new g(f);return t.facade=e,c(e,b,t),t},i=function(e){return u(e,b)?e[b]:{}},o=function(e){return u(e,b)}}e.exports={set:r,get:i,has:o,enforce:function(e){return o(e)?i(e):r(e,{})},getterFor:function(e){return function(t){var n;if(!l(t)||(n=i(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return n}}}},1106:function(e,t,n){"use strict";var r=n(5877);e.exports=Array.isArray||function(e){return"Array"===r(e)}},3385:function(e){"use strict";var t="object"==typeof document&&document.all;e.exports=void 0===t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(e){return"function"==typeof e}},4379:function(e,t,n){"use strict";var r=n(9278),i=n(3958),o=n(3385),s=n(3851),a=n(9989),l=n(9307),c=function(){},u=a("Reflect","construct"),d=/^\s*(?:class|function)\b/,h=r(d.exec),p=!d.test(c),f=function(e){if(!o(e))return!1;try{return u(c,[],e),!0}catch(e){return!1}},g=function(e){if(!o(e))return!1;switch(s(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return p||!!h(d,l(e))}catch(e){return!0}};g.sham=!0,e.exports=!u||i(function(){var e;return f(f.call)||!f(Object)||!f(function(){e=!0})||e})?g:f},2515:function(e,t,n){"use strict";var r=n(3958),i=n(3385),o=/#|\.prototype\./,s=function(e,t){var n=l[a(e)];return n===u||n!==c&&(i(t)?r(t):!!t)},a=s.normalize=function(e){return String(e).replace(o,".").toLowerCase()},l=s.data={},c=s.NATIVE="N",u=s.POLYFILL="P";e.exports=s},4642:function(e){"use strict";e.exports=function(e){return null==e}},2005:function(e,t,n){"use strict";var r=n(3385);e.exports=function(e){return"object"==typeof e?null!==e:r(e)}},5045:function(e){"use strict";e.exports=!1},2107:function(e,t,n){"use strict";var r=n(2005),i=n(5877),o=n(8869)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[o])?!!t:"RegExp"===i(e))}},2135:function(e,t,n){"use strict";var r=n(9989),i=n(3385),o=n(2902),s=n(7757),a=Object;e.exports=s?function(e){return"symbol"==typeof e}:function(e){var t=r("Symbol");return i(t)&&o(t.prototype,a(e))}},5930:function(e,t,n){"use strict";var r=n(2967);e.exports=function(e){return r(e.length)}},5114:function(e,t,n){"use strict";var r=n(9278),i=n(3958),o=n(3385),s=n(8417),a=n(7972),l=n(130).CONFIGURABLE,c=n(9307),u=n(4101),d=u.enforce,h=u.get,p=String,f=Object.defineProperty,g=r("".slice),m=r("".replace),y=r([].join),b=a&&!i(function(){return 8!==f(function(){},"length",{value:8}).length}),w=String(String).split("String"),x=e.exports=function(e,t,n){"Symbol("===g(p(t),0,7)&&(t="["+m(p(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!s(e,"name")||l&&e.name!==t)&&(a?f(e,"name",{value:t,configurable:!0}):e.name=t),b&&n&&s(n,"arity")&&e.length!==n.arity&&f(e,"length",{value:n.arity});try{n&&s(n,"constructor")&&n.constructor?a&&f(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var r=d(e);return s(r,"source")||(r.source=y(w,"string"==typeof t?t:"")),e};Function.prototype.toString=x(function(){return o(this)&&h(this).source||c(this)},"toString")},4984:function(e){"use strict";var t=Math.ceil,n=Math.floor;e.exports=Math.trunc||function(e){var r=+e;return(r>0?n:t)(r)}},8472:function(e,t,n){"use strict";var r,i=n(6188),o=n(735),s=n(3395),a=n(6390),l=n(7598),c=n(2415),u=n(3942),d="prototype",h="script",p=u("IE_PROTO"),f=function(){},g=function(e){return"<"+h+">"+e+"</"+h+">"},m=function(e){e.write(g("")),e.close();var t=e.parentWindow.Object;return e=null,t},y=function(){var e,t=c("iframe");return t.style.display="none",l.appendChild(t),t.src=String("java"+h+":"),(e=t.contentWindow.document).open(),e.write(g("document.F=Object")),e.close(),e.F},b=function(){try{r=new ActiveXObject("htmlfile")}catch(e){}b="undefined"!=typeof document?document.domain&&r?m(r):y():m(r);for(var e=s.length;e--;)delete b[d][s[e]];return b()};a[p]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(f[d]=i(e),n=new f,f[d]=null,n[p]=e):n=b(),void 0===t?n:o.f(n,t)}},735:function(e,t,n){"use strict";var r=n(7972),i=n(3526),o=n(7100),s=n(6188),a=n(7905),l=n(5403);t.f=r&&!i?Object.defineProperties:function(e,t){s(e);for(var n,r=a(t),i=l(t),c=i.length,u=0;c>u;)o.f(e,n=i[u++],r[n]);return e}},7100:function(e,t,n){"use strict";var r=n(7972),i=n(3039),o=n(3526),s=n(6188),a=n(6690),l=TypeError,c=Object.defineProperty,u=Object.getOwnPropertyDescriptor,d="enumerable",h="configurable",p="writable";t.f=r?o?function(e,t,n){if(s(e),t=a(t),s(n),"function"==typeof e&&"prototype"===t&&"value"in n&&p in n&&!n[p]){var r=u(e,t);r&&r[p]&&(e[t]=n.value,n={configurable:h in n?n[h]:r[h],enumerable:d in n?n[d]:r[d],writable:!1})}return c(e,t,n)}:c:function(e,t,n){if(s(e),t=a(t),s(n),i)try{return c(e,t,n)}catch(e){}if("get"in n||"set"in n)throw new l("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},3314:function(e,t,n){"use strict";var r=n(7972),i=n(5184),o=n(8299),s=n(5345),a=n(7905),l=n(6690),c=n(8417),u=n(3039),d=Object.getOwnPropertyDescriptor;t.f=r?d:function(e,t){if(e=a(e),t=l(t),u)try{return d(e,t)}catch(e){}if(c(e,t))return s(!i(o.f,e,t),e[t])}},5959:function(e,t,n){"use strict";var r=n(3169),i=n(3395).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},8010:function(e,t){"use strict";t.f=Object.getOwnPropertySymbols},2902:function(e,t,n){"use strict";var r=n(9278);e.exports=r({}.isPrototypeOf)},3169:function(e,t,n){"use strict";var r=n(9278),i=n(8417),o=n(7905),s=n(7531).indexOf,a=n(6390),l=r([].push);e.exports=function(e,t){var n,r=o(e),c=0,u=[];for(n in r)!i(a,n)&&i(r,n)&&l(u,n);for(;t.length>c;)i(r,n=t[c++])&&(~s(u,n)||l(u,n));return u}},5403:function(e,t,n){"use strict";var r=n(3169),i=n(3395);e.exports=Object.keys||function(e){return r(e,i)}},8299:function(e,t){"use strict";var n={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,i=r&&!n.call({1:2},1);t.f=i?function(e){var t=r(this,e);return!!t&&t.enumerable}:n},1583:function(e,t,n){"use strict";var r=n(5184),i=n(3385),o=n(2005),s=TypeError;e.exports=function(e,t){var n,a;if("string"===t&&i(n=e.toString)&&!o(a=r(n,e))||i(n=e.valueOf)&&!o(a=r(n,e))||"string"!==t&&i(n=e.toString)&&!o(a=r(n,e)))return a;throw new s("Can't convert object to primitive value")}},8699:function(e,t,n){"use strict";var r=n(9989),i=n(9278),o=n(5959),s=n(8010),a=n(6188),l=i([].concat);e.exports=r("Reflect","ownKeys")||function(e){var t=o.f(a(e)),n=s.f;return n?l(t,n(e)):t}},3027:function(e,t,n){"use strict";var r=n(5184),i=n(6188),o=n(3385),s=n(5877),a=n(6097),l=TypeError;e.exports=function(e,t){var n=e.exec;if(o(n)){var c=r(n,e,t);return null!==c&&i(c),c}if("RegExp"===s(e))return r(a,e,t);throw new l("RegExp#exec called on incompatible receiver")}},6097:function(e,t,n){"use strict";var r,i,o=n(5184),s=n(9278),a=n(3281),l=n(9206),c=n(5722),u=n(4305),d=n(8472),h=n(4101).get,p=n(3065),f=n(9659),g=u("native-string-replace",String.prototype.replace),m=RegExp.prototype.exec,y=m,b=s("".charAt),w=s("".indexOf),x=s("".replace),v=s("".slice),S=(i=/b*/g,o(m,r=/a/,"a"),o(m,i,"a"),0!==r.lastIndex||0!==i.lastIndex),k=c.BROKEN_CARET,_=void 0!==/()??/.exec("")[1];(S||_||k||p||f)&&(y=function(e){var t,n,r,i,s,c,u,p=h(this),f=a(e),E=p.raw;if(E)return E.lastIndex=this.lastIndex,t=o(y,E,f),this.lastIndex=E.lastIndex,t;var C=p.groups,P=k&&this.sticky,T=o(l,this),j=this.source,I=0,M=f;if(P&&(-1===w(T=x(T,"y",""),"g")&&(T+="g"),M=v(f,this.lastIndex),this.lastIndex>0&&(!this.multiline||this.multiline&&"\n"!==b(f,this.lastIndex-1))&&(j="(?: "+j+")",M=" "+M,I++),n=RegExp("^(?:"+j+")",T)),_&&(n=RegExp("^"+j+"$(?!\\s)",T)),S&&(r=this.lastIndex),i=o(m,P?n:this,M),P?i?(i.input=v(i.input,I),i[0]=v(i[0],I),i.index=this.lastIndex,this.lastIndex+=i[0].length):this.lastIndex=0:S&&i&&(this.lastIndex=this.global?i.index+i[0].length:r),_&&i&&i.length>1&&o(g,i[0],n,function(){for(s=1;s<arguments.length-2;s++)void 0===arguments[s]&&(i[s]=void 0)}),i&&C)for(s=0,i.groups=c=d(null);s<C.length;s++)c[(u=C[s])[0]]=i[u[1]];return i}),e.exports=y},9206:function(e,t,n){"use strict";var r=n(6188);e.exports=function(){var e=r(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},4214:function(e,t,n){"use strict";var r=n(5184),i=n(8417),o=n(2902),s=n(9206),a=RegExp.prototype;e.exports=function(e){var t=e.flags;return!(void 0===t&&!("flags"in a)&&!i(e,"flags")&&o(a,e))?t:r(s,e)}},5722:function(e,t,n){"use strict";var r=n(3958),i=n(6946).RegExp,o=r(function(){var e=i("a","y");return e.lastIndex=2,null!==e.exec("abcd")}),s=o||r(function(){return!i("a","y").sticky}),a=o||r(function(){var e=i("^r","gy");return e.lastIndex=2,null!==e.exec("str")});e.exports={BROKEN_CARET:a,MISSED_STICKY:s,UNSUPPORTED_Y:o}},3065:function(e,t,n){"use strict";var r=n(3958),i=n(6946).RegExp;e.exports=r(function(){var e=i(".","s");return!(e.dotAll&&e.test("\n")&&"s"===e.flags)})},9659:function(e,t,n){"use strict";var r=n(3958),i=n(6946).RegExp;e.exports=r(function(){var e=i("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})},1823:function(e,t,n){"use strict";var r=n(4642),i=TypeError;e.exports=function(e){if(r(e))throw new i("Can't call method on "+e);return e}},3942:function(e,t,n){"use strict";var r=n(4305),i=n(2824),o=r("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},6853:function(e,t,n){"use strict";var r=n(6946),i=n(8808),o="__core-js_shared__",s=r[o]||i(o,{});e.exports=s},4305:function(e,t,n){"use strict";var r=n(5045),i=n(6853);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.35.1",mode:r?"pure":"global",copyright:"\xa9 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.35.1/LICENSE",source:"https://github.com/zloirock/core-js"})},5418:function(e,t,n){"use strict";var r=n(9278),i=n(9540),o=n(3281),s=n(1823),a=r("".charAt),l=r("".charCodeAt),c=r("".slice),u=function(e){return function(t,n){var r,u,d=o(s(t)),h=i(n),p=d.length;return h<0||h>=p?e?"":void 0:(r=l(d,h))<55296||r>56319||h+1===p||(u=l(d,h+1))<56320||u>57343?e?a(d,h):r:e?c(d,h,h+2):(r-55296<<10)+(u-56320)+65536}};e.exports={codeAt:u(!1),charAt:u(!0)}},1541:function(e,t,n){"use strict";var r=n(9220),i=n(3958),o=n(6946).String;e.exports=!!Object.getOwnPropertySymbols&&!i(function(){var e=Symbol("symbol detection");return!o(e)||!(Object(e) instanceof Symbol)||!Symbol.sham&&r&&r<41})},141:function(e,t,n){"use strict";var r=n(9540),i=Math.max,o=Math.min;e.exports=function(e,t){var n=r(e);return n<0?i(n+t,0):o(n,t)}},7905:function(e,t,n){"use strict";var r=n(9693),i=n(1823);e.exports=function(e){return r(i(e))}},9540:function(e,t,n){"use strict";var r=n(4984);e.exports=function(e){var t=+e;return t!=t||0===t?0:r(t)}},2967:function(e,t,n){"use strict";var r=n(9540),i=Math.min;e.exports=function(e){var t=r(e);return t>0?i(t,9007199254740991):0}},232:function(e,t,n){"use strict";var r=n(1823),i=Object;e.exports=function(e){return i(r(e))}},7180:function(e,t,n){"use strict";var r=n(5184),i=n(2005),o=n(2135),s=n(5107),a=n(1583),l=n(8869),c=TypeError,u=l("toPrimitive");e.exports=function(e,t){if(!i(e)||o(e))return e;var n,l=s(e,u);if(l){if(void 0===t&&(t="default"),!i(n=r(l,e,t))||o(n))return n;throw new c("Can't convert object to primitive value")}return void 0===t&&(t="number"),a(e,t)}},6690:function(e,t,n){"use strict";var r=n(7180),i=n(2135);e.exports=function(e){var t=r(e,"string");return i(t)?t:t+""}},6970:function(e,t,n){"use strict";var r=n(8869)("toStringTag"),i={};i[r]="z",e.exports="[object z]"===String(i)},3281:function(e,t,n){"use strict";var r=n(3851),i=String;e.exports=function(e){if("Symbol"===r(e))throw TypeError("Cannot convert a Symbol value to a string");return i(e)}},648:function(e){"use strict";var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},2824:function(e,t,n){"use strict";var r=n(9278),i=0,o=Math.random(),s=r(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++i+o,36)}},7757:function(e,t,n){"use strict";var r=n(1541);e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},3526:function(e,t,n){"use strict";var r=n(7972),i=n(3958);e.exports=r&&i(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})},1911:function(e,t,n){"use strict";var r=n(6946),i=n(3385),o=r.WeakMap;e.exports=i(o)&&/native code/.test(String(o))},8869:function(e,t,n){"use strict";var r=n(6946),i=n(4305),o=n(8417),s=n(2824),a=n(1541),l=n(7757),c=r.Symbol,u=i("wks"),d=l?c.for||c:c&&c.withoutSetter||s;e.exports=function(e){return o(u,e)||(u[e]=a&&o(c,e)?c[e]:d("Symbol."+e)),u[e]}},5943:function(e,t,n){"use strict";var r=n(7096),i=n(232),o=n(5930),s=n(9540),a=n(4479);r({target:"Array",proto:!0},{at:function(e){var t=i(this),n=o(t),r=s(e),a=r>=0?r:n+r;return a<0||a>=n?void 0:t[a]}}),a("at")},6158:function(e,t,n){"use strict";var r=n(7096),i=n(6487),o=n(5084),s=n(232),a=n(5930),l=n(57);r({target:"Array",proto:!0},{flatMap:function(e){var t,n=s(this),r=a(n);return o(e),(t=l(n,0)).length=i(t,n,n,r,0,1,e,arguments.length>1?arguments[1]:void 0),t}})},5232:function(e,t,n){"use strict";var r=n(7096),i=n(6487),o=n(232),s=n(5930),a=n(9540),l=n(57);r({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=o(this),n=s(t),r=l(t,0);return r.length=i(r,t,t,n,0,void 0===e?1:a(e)),r}})},507:function(e,t,n){"use strict";n(4479)("flatMap")},2458:function(e,t,n){"use strict";n(4479)("flat")},1571:function(e,t,n){"use strict";var r=n(7096),i=n(6097);r({target:"RegExp",proto:!0,forced:/./.exec!==i},{exec:i})},7956:function(e,t,n){"use strict";var r=n(7096),i=n(9278),o=n(1823),s=n(9540),a=n(3281),l=n(3958),c=i("".charAt);r({target:"String",proto:!0,forced:l(function(){return"\uD842"!=="\uD842\uDFB7".at(-2)})},{at:function(e){var t=a(o(this)),n=t.length,r=s(e),i=r>=0?r:n+r;return i<0||i>=n?void 0:c(t,i)}})},8560:function(e,t,n){"use strict";var r=n(7096),i=n(5184),o=n(9278),s=n(1823),a=n(3385),l=n(4642),c=n(2107),u=n(3281),d=n(5107),h=n(4214),p=n(3253),f=n(8869),g=n(5045),m=f("replace"),y=TypeError,b=o("".indexOf),w=o("".replace),x=o("".slice),v=Math.max;r({target:"String",proto:!0},{replaceAll:function(e,t){var n,r,o,f,S,k,_,E,C=s(this),P=0,T=0,j="";if(!l(e)){if((n=c(e))&&!~b(u(s(h(e))),"g"))throw new y("`.replaceAll` does not allow non-global regexes");if(r=d(e,m))return i(r,e,C,t);if(g&&n)return w(u(C),e,t)}for(o=u(C),f=u(e),(S=a(t))||(t=u(t)),_=v(1,k=f.length),P=b(o,f);-1!==P;)E=S?u(t(f,P,o)):p(f,o,P,[],void 0,t),j+=x(o,T,P)+E,T=P+k,P=P+_>o.length?-1:b(o,f,P+_);return T<o.length&&(j+=x(o,T)),j}})},5089:function(e,t,n){"use strict";var r=n(413),i=n(5184),o=n(9278),s=n(5439),a=n(3958),l=n(6188),c=n(3385),u=n(4642),d=n(9540),h=n(2967),p=n(3281),f=n(1823),g=n(2857),m=n(5107),y=n(3253),b=n(3027),w=n(8869)("replace"),x=Math.max,v=Math.min,S=o([].concat),k=o([].push),_=o("".indexOf),E=o("".slice),C="$0"==="a".replace(/./,"$0"),P=!!/./[w]&&""===/./[w]("a","$0");s("replace",function(e,t,n){var o=P?"$":"$0";return[function(e,n){var r=f(this),o=u(e)?void 0:m(e,w);return o?i(o,e,r,n):i(t,p(r),e,n)},function(e,i){var s=l(this),a=p(e);if("string"==typeof i&&-1===_(i,o)&&-1===_(i,"$<")){var u=n(t,s,a,i);if(u.done)return u.value}var f=c(i);f||(i=p(i));var m=s.global;m&&(I=s.unicode,s.lastIndex=0);for(var w=[];null!==(M=b(s,a))&&(k(w,M),m);)""===p(M[0])&&(s.lastIndex=g(a,h(s.lastIndex),I));for(var C="",P=0,T=0;T<w.length;T++){for(var j,I,M,A,O=p((M=w[T])[0]),$=x(v(d(M.index),a.length),0),B=[],D=1;D<M.length;D++)k(B,void 0===(j=M[D])?j:String(j));var L=M.groups;if(f){var R=S([O],B,$,a);void 0!==L&&k(R,L),A=p(r(i,void 0,R))}else A=y(O,a,$,B,L,i);$>=P&&(C+=E(a,P,$)+A,P=$+O.length)}return C+E(a,P)}]},!!a(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})||!C||P)},4416:function(e,t,n){"use strict";var r=n(2587);e.exports=r},9207:function(e,t,n){"use strict";var r=n(1139);e.exports=r},7213:function(e,t,n){"use strict";var r=n(8078);e.exports=r},5671:function(e,t,n){"use strict";var r=n(1975);e.exports=r},977:function(e,t,n){"use strict";var r=n(2422);e.exports=r},8677:function(e,t,n){"use strict";n.d(t,{g:function(){return i}});var r=n(7437);function i({children:e,className:t="",...n}){return(0,r.jsx)("svg",{...n,className:`tl-svg-container ${t}`,children:e})}},5399:function(e,t,n){"use strict";n.d(t,{A6:function(){return d},JM:function(){return v},MO:function(){return f},ks:function(){return p},ng:function(){return h},yu:function(){return y}});var r=n(5801),i=n(8418),o=n(5895),s=n(477),a=n(6967);n(357);let l="TLDRAW_USER_DATA_v3",c=s.T.object({id:s.T.string,name:s.T.string.nullable().optional(),locale:s.T.string.nullable().optional(),color:s.T.string.nullable().optional(),isDarkMode:s.T.boolean.nullable().optional(),animationSpeed:s.T.number.nullable().optional(),edgeScrollSpeed:s.T.number.nullable().optional(),isSnapMode:s.T.boolean.nullable().optional()}),u=(0,i.zn)({currentVersion:4,migrators:{1:{up:e=>({...e,animationSpeed:1}),down:({animationSpeed:e,...t})=>t},2:{up:e=>({...e,isSnapMode:!1}),down:({isSnapMode:e,...t})=>t},3:{up:e=>e,down:e=>({id:e.id,name:e.name??p.name,locale:e.locale??p.locale,color:e.color??p.color,isDarkMode:e.isDarkMode??p.isDarkMode,animationSpeed:e.animationSpeed??p.animationSpeed,isSnapMode:e.isSnapMode??p.isSnapMode})},4:{up:e=>({...e,edgeScrollSpeed:1}),down:({edgeScrollSpeed:e,...t})=>t}}}),d=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function h(){return"undefined"!=typeof window&&(window.matchMedia?.("(prefers-color-scheme: dark)")?.matches??!1)}let p=Object.freeze({name:"New User",locale:(0,o.Bz)(),color:d[Math.floor(Math.random()*d.length)],isDarkMode:!1,edgeScrollSpeed:1,animationSpeed:"undefined"!=typeof window&&window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches?0:1,isSnapMode:!1});function f(){return{id:(0,a.E)()}}function g(e){if(null===e||"object"!=typeof e||!("version"in e)||!("user"in e)||"number"!=typeof e.version)return f();let t=(0,i.Te)({value:e.user,fromVersion:e.version,toVersion:u.currentVersion??0,migrations:u});if("error"===t.type)return f();try{c.validate(t.value)}catch(e){return f()}return t.value}let m=(0,r.cn)("globalUserData",g("undefined"==typeof window?null:JSON.parse(window?.localStorage?.getItem(l)||"null")??null));function y(e){c.validate(e),m.set(e),"undefined"!=typeof window&&window.localStorage&&window.localStorage.setItem(l,JSON.stringify({version:u.currentVersion,user:m.get()})),b?.postMessage({type:x,origin:w,data:{user:m.get(),version:u.currentVersion}})}let b="undefined"==typeof BroadcastChannel?null:new BroadcastChannel("tldraw-user-sync");b?.addEventListener("message",e=>{let t=e.data;t?.type===x&&t?.origin!==w&&m.set(g(t.data))});let w=(0,a.E)(),x="tldraw-user-preferences-change";function v(){return m.get()}},9694:function(e,t,n){"use strict";n.d(t,{L:function(){return o}});var r=n(5801),i=n(5399);function o(e={}){return{derivePresenceState:e.derivePresenceState??(()=>(0,r.Fl)("presence",()=>null)),userPreferences:e.userPreferences??(0,r.Fl)("userPreferences",()=>(0,i.JM)()),setUserPreferences:e.setUserPreferences??i.yu}}},5502:function(e,t,n){"use strict";n.d(t,{m:function(){return o},u:function(){return r}});let r=[n(8766).Q],i=new Set(r.map(e=>e.type));function o(e){let t=[...r],n=new Set;for(let r of e){if(i.has(r.type))throw Error(`Shape type "${r.type}" is a core shapes type and cannot be overridden`);if(n.has(r.type))throw Error(`Shape type "${r.type}" is defined more than once`);t.push(r),n.add(r.type)}return t}},6652:function(e,t,n){"use strict";n.d(t,{$G:function(){return k},CK:function(){return T},CN:function(){return d},E:function(){return l},EB:function(){return $},Et:function(){return o},KD:function(){return a},MN:function(){return P},Ns:function(){return f},O8:function(){return C},Pr:function(){return B},Pz:function(){return y},Qd:function(){return p},RH:function(){return g},RZ:function(){return E},Sk:function(){return w},UD:function(){return b},Xy:function(){return S},Zj:function(){return c},a:function(){return A},aR:function(){return I},dW:function(){return _},iF:function(){return v},kx:function(){return i},qV:function(){return m},rF:function(){return O},rQ:function(){return D},sZ:function(){return u},s_:function(){return x},uJ:function(){return s},wM:function(){return M},wi:function(){return h},yV:function(){return j}});var r=n(4085);let i=2e3,o=40,s=80,a=320,l=[.1,.25,.5,1,2,4,8],c=.1,u=8,d=.5,h=.1,p=.2,f=.005,g=.05,m=450,y=200,b=6,w=4,x=32,v={};for(let e=1;e<=Math.ceil(u);e++)v[e+"_dark"]=`hash_pattern_zoom_${e}_dark`,v[e+"_light"]=`hash_pattern_zoom_${e}_light`;let S={duration:0,easing:r.L.easeInOutCubic},k=.09,_=[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],E=6e4,C=3e3,P=1200,T={CAMERA_MOVE:-10},j=64,I=620,M=8,A=20,O=8,$=12,B=20,D=12},3096:function(e,t,n){"use strict";n.d(t,{w:function(){return i}});var r=n(5801);let i=e=>{let{store:t}=e,n=t.query.filterHistory("shape"),i=t.query.records("shape",()=>({type:{eq:"arrow"}}));function o(){let e=i.get(),t={};for(let n of e){let{start:e,end:r}=n.props;if("binding"===e.type){let r=t[e.boundShapeId];r?r.push({arrowId:n.id,handleId:"start"}):t[e.boundShapeId]=[{arrowId:n.id,handleId:"start"}]}if("binding"===r.type){let e=t[r.boundShapeId];e?e.push({arrowId:n.id,handleId:"end"}):t[r.boundShapeId]=[{arrowId:n.id,handleId:"end"}]}}return t}return(0,r.Fl)("arrowBindingsIndex",(t,i)=>{let s;if((0,r.e1)(t))return o();let a=n.getDiffSince(i);if(a===r.SB)return o();function l(e){s||(s={...t}),s[e]?s[e]===t[e]&&(s[e]=[...s[e]]):s[e]=[]}function c(e,t,n){l(e),s[e]=s[e].filter(e=>e.arrowId!==t||e.handleId!==n),0===s[e].length&&delete s[e]}function u(e,t,n){l(e),s[e].push({arrowId:t,handleId:n})}for(let t of a){for(let n of Object.values(t.added))if(e.isShapeOfType(n,"arrow")){let{start:e,end:t}=n.props;"binding"===e.type&&u(e.boundShapeId,n.id,"start"),"binding"===t.type&&u(t.boundShapeId,n.id,"end")}for(let[n,r]of Object.values(t.updated))if(e.isShapeOfType(n,"arrow")&&e.isShapeOfType(r,"arrow"))for(let e of["start","end"]){let t=n.props[e],i=r.props[e];"binding"===t.type&&"point"===i.type?c(t.boundShapeId,n.id,e):"point"===t.type&&"binding"===i.type?u(i.boundShapeId,r.id,e):"binding"===t.type&&"binding"===i.type&&t.boundShapeId!==i.boundShapeId&&(c(t.boundShapeId,n.id,e),u(i.boundShapeId,r.id,e))}for(let n of Object.values(t.removed))if(e.isShapeOfType(n,"arrow")){let{start:e,end:t}=n.props;"binding"===e.type&&c(e.boundShapeId,n.id,"start"),"binding"===t.type&&c(t.boundShapeId,n.id,"end")}}return s??t})}},9250:function(e,t,n){"use strict";n.d(t,{s:function(){return a}});var r=n(5801),i=n(5895),o=n(2302),s=n(6763);let a=e=>{let t=e.query.ids("shape");function n(){let n={},r=t.get(),i=Array(r.size);return r.forEach(t=>i.push(e.get(t))),i.sort(s.hl),i.forEach(e=>{n[e.parentId]||(n[e.parentId]=[]),n[e.parentId].push(e.id)}),n}return(0,r.Fl)("parentsToChildrenWithIndexes",(t,a)=>{let l;if((0,r.e1)(t))return n();let c=e.history.getDiffSince(a);if(c===r.SB)return n();if(0===c.length)return t;let u=null,d=e=>{u||(u={...t}),u[e]?u[e]===t[e]&&(u[e]=[...u[e]]):u[e]=[]},h=new Set;for(let e=0,t=c.length;e<t;e++){for(let t of Object.values((l=c[e]).added))(0,i.VV)(t)&&(d(t.parentId),u[t.parentId].push(t.id),h.add(u[t.parentId]));for(let[e,t]of Object.values(l.updated))if((0,i.VV)(t)&&(0,i.VV)(e)){if(e.parentId!==t.parentId)d(e.parentId),d(t.parentId),u[e.parentId].splice(u[e.parentId].indexOf(t.id),1),u[t.parentId].push(t.id),h.add(u[t.parentId]);else if(e.index!==t.index){d(t.parentId);let e=u[t.parentId].indexOf(t.id);u[t.parentId][e]=t.id,h.add(u[t.parentId])}}for(let e of Object.values(l.removed))(0,i.VV)(e)&&(d(e.parentId),u[e.parentId].splice(u[e.parentId].indexOf(e.id),1))}for(let t of h){let n=(0,o.oA)(t.map(t=>e.get(t)));n.sort(s.hl),t.splice(0,t.length,...n.map(e=>e.id))}return u??t})}},2981:function(e,t,n){"use strict";n.d(t,{Q:function(){return a}});var r=n(5801),i=n(8418),o=n(5895);let s=(e,t,n)=>{for(;!(0,o.r5)(n.parentId);){let t=e.get(n.parentId);if(!t)return!1;n=t}return n.parentId===t},a=(e,t)=>{let n=e.query.ids("shape"),a=null;function l(){let r=t();return a=r,new Set([...n.get()].filter(t=>s(e,r,e.get(t))))}return(0,r.Fl)("_shapeIdsInCurrentPage",(n,c)=>{if((0,r.e1)(n))return l();let u=t();if(u!==a)return l();let d=e.history.getDiffSince(c);if(d===r.SB)return l();let h=new i.mW(n);for(let t of d){for(let n of Object.values(t.added))(0,o.VV)(n)&&s(e,u,n)&&h.add(n.id);for(let[n,r]of Object.values(t.updated))(0,o.VV)(r)&&(s(e,u,r)?h.add(r.id):h.remove(r.id));for(let e of Object.keys(t.removed))(0,o.YT)(e)&&h.remove(e)}let p=h.get();return p?(0,r.qo)(p.value,p.diff):n})}},2197:function(e,t,n){"use strict";n.d(t,{o:function(){return s}});var r=n(6652),i=n(6810),o=n(6967);class s{constructor(e){this.editor=e}_clickId="";_clickTimeout;_clickScreenPoint;_previousScreenPoint;_getClickTimeout=(e,t=(0,o.E)())=>{this._clickId=t,clearTimeout(this._clickTimeout),this._clickTimeout=setTimeout(()=>{if(this._clickState===e&&this._clickId===t){switch(this._clickState){case"pendingTriple":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break;case"pendingQuadruple":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break;case"pendingOverflow":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"})}this._clickState="idle"}},"idle"===e||"pendingDouble"===e?r.qV:r.Pz)};_clickState="idle";get clickState(){return this._clickState}lastPointerInfo={};transformPointerDownEvent=e=>{if(!this._clickState)return e;switch(this._clickScreenPoint=i.B.From(e.point),this._previousScreenPoint&&this._previousScreenPoint.dist(this._clickScreenPoint)>40&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"idle":return this._clickState="pendingDouble",this._clickTimeout=this._getClickTimeout(this._clickState),e;case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"pendingOverflow":return this._clickState="overflow",this._clickTimeout=this._getClickTimeout(this._clickState),e;default:return this._clickTimeout=this._getClickTimeout(this._clickState),e}};transformPointerUpEvent=e=>{if(!this._clickState)return e;switch(this._clickScreenPoint=i.B.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"};default:return e}};cancelDoubleClickTimeout=()=>{this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"};handleMove=()=>{"idle"!==this._clickState&&this._clickScreenPoint&&this._clickScreenPoint.dist(this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?r.UD:r.Sk)&&this.cancelDoubleClickTimeout()}}},9028:function(e,t,n){"use strict";n.d(t,{l:function(){return r}});class r{constructor(e){this.editor=e,"undefined"!=typeof window&&"navigator"in window?(this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),this.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)):(this.isSafari=!1,this.isIos=!1,this.isChromeForIos=!1,this.isFirefox=!1,this.isAndroid=!1)}isSafari;isIos;isChromeForIos;isFirefox;isAndroid}},3190:function(e,t,n){"use strict";n.d(t,{E:function(){return u}});var r=n(5801),i=n(8418),o=n(6967);function s(e){if(e){let t=l;for(;e.length;)t=t.push(e.pop());return t}return l}class a{length=0;head=null;tail=this;push(e){return new c(e,this)}toArray(){return r.LZ}[Symbol.iterator](){return{next:()=>({value:void 0,done:!0})}}}let l=new a;class c{constructor(e,t){this.head=e,this.tail=t,this.length=t.length+1}length;push(e){return new c(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(!e.length)return{value:void 0,done:!0};{let t=e.head;return e=e.tail,{value:t,done:!1}}}}}}class u{constructor(e,t){this.ctx=e,this.annotateError=t}_undos=(0,r.cn)("HistoryManager.undos",s());_redos=(0,r.cn)("HistoryManager.redos",s());_batchDepth=0;onBatchComplete=()=>void 0;_commands={};getNumUndos(){return this._undos.get().length}getNumRedos(){return this._redos.get().length}createCommand=(e,t,n)=>{if(this._commands[e])throw Error(`Duplicate command: ${e}`);this._commands[e]=n;let r=(...a)=>{if(!this._batchDepth)return this.batch(()=>r(...a)),this.ctx;let l=t(...a);if(!l)return this.ctx;let{data:c,ephemeral:u,squashing:d,preservesRedoStack:h}=l;if(this.ignoringUpdates((e,t)=>(n.do(c),{undos:e,redos:t})),!u){let t=this._undos.get().head;d&&t&&"command"===t.type&&t.name===e&&t.preservesRedoStack===h?this._undos.update(e=>e.tail.push({...t,id:(0,o.E)(),data:(0,i.ZV)(n.squash(t.data,c))})):this._undos.update(t=>t.push({type:"command",name:e,data:(0,i.ZV)(c),id:(0,o.E)(),preservesRedoStack:h})),l.preservesRedoStack||this._redos.set(s()),this.ctx.emit("change-history",{reason:"push"})}return this.ctx};return r};batch=e=>{try{this._batchDepth++,1===this._batchDepth?(0,r.ay)(()=>{let t=this._undos.get().head?.id;e(),t!==this._undos.get().head?.id&&this.onBatchComplete()}):e()}catch(e){throw this.annotateError(e),e}finally{this._batchDepth--}return this};ignoringUpdates=e=>{let t=this._undos.get(),n=this._redos.get();this._undos.set(s()),this._redos.set(s());try{({undos:t,redos:n}=(0,r.ay)(()=>e(t,n)))}finally{this._undos.set(t),this._redos.set(n)}};_undo=({pushToRedoStack:e,toMark:t})=>(this.ignoringUpdates((n,r)=>{if(0===n.length)return{undos:n,redos:r};for(;n.head?.type==="STOP";){let i=n.head;if(n=n.tail,e&&(r=r.push(i)),i.id===t)return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:n,redos:r}}if(0===n.length)return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:n,redos:r};for(;n.head;){let i=n.head;if(n=n.tail,e&&(r=r.push(i)),"STOP"===i.type){if(i.onUndo&&(!t||i.id===t))break}else this._commands[i.name].undo(i.data)}return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:n,redos:r}}),this);undo=()=>(this._undo({pushToRedoStack:!0}),this);redo=()=>(this.ignoringUpdates((e,t)=>{if(0===t.length)return{undos:e,redos:t};for(;t.head?.type==="STOP";)e=e.push(t.head),t=t.tail;if(0===t.length)return this.ctx.emit("change-history",{reason:"redo"}),{undos:e,redos:t};for(;t.head;){let n=t.head;if(e=e.push(t.head),t=t.tail,"STOP"===n.type){if(n.onRedo)break}else{let e=this._commands[n.name];e.redo?e.redo(n.data):e.do(n.data)}}return this.ctx.emit("change-history",{reason:"redo"}),{undos:e,redos:t}}),this);bail=()=>(this._undo({pushToRedoStack:!1}),this);bailToMark=e=>(this._undo({pushToRedoStack:!1,toMark:e}),this);mark=(e=(0,o.E)(),t=!0,n=!0)=>{let r=this._undos.get().head;return r&&"STOP"===r.type&&r.id===e&&r.onUndo===t&&r.onRedo===n?r.id:(this._undos.update(r=>r.push({type:"STOP",id:e,onUndo:t,onRedo:n})),this.ctx.emit("mark-history",{id:e}),e)};clear(){this._undos.set(s()),this._redos.set(s())}}},7990:function(e,t,n){"use strict";n.d(t,{o:function(){return o}});var r=n(6810),i=n(6967);class o{constructor(e){this.editor=e}scribbleItems=new Map;state="paused";addScribble=(e,t=(0,i.E)())=>{let n={id:t,scribble:{id:t,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:e.delay??0,prev:null,next:null};return this.scribbleItems.set(t,n),"paused"===this.state&&this.resume(),n};resume(){this.state="running",this.editor.addListener("tick",this.tick)}pause(){this.editor.removeListener("tick",this.tick),this.state="paused"}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear(),this.pause()}stop=e=>{let t=this.scribbleItems.get(e);if(!t)throw Error(`Scribble with id ${e} not found`);return t.delayRemaining=Math.min(t.delayRemaining,200),t.scribble.state="stopping",t};addPoint=(e,t,n)=>{let i=this.scribbleItems.get(e);if(!i)throw Error(`Scribble with id ${e} not found`);let{prev:o}=i,s={x:t,y:n,z:.5};return(!o||r.B.Dist(o,s)>=1)&&(i.next=s),i};tick=e=>{this.editor.batch(()=>{this.scribbleItems.forEach(t=>{if("starting"===t.scribble.state){let{next:e,prev:n}=t;e&&e!==n&&(t.prev=e,t.scribble.points.push(e)),t.scribble.points.length>8&&(t.scribble.state="active");return}t.delayRemaining>0&&(t.delayRemaining=Math.max(0,t.delayRemaining-e)),t.timeoutMs+=e,t.timeoutMs>=16&&(t.timeoutMs=0);let{delayRemaining:n,timeoutMs:r,prev:i,next:o,scribble:s}=t;switch(s.state){case"active":o&&o!==i?(t.prev=o,s.points.push(o),0===n&&s.points.length>8&&s.points.shift()):0===r&&(s.points.length>1?s.points.shift():t.delayRemaining=s.delay);break;case"stopping":if(0===t.delayRemaining&&0===r){if(1===s.points.length){this.scribbleItems.delete(t.id);return}s.shrink&&(s.size=Math.max(1,s.size*(1-s.shrink))),s.points.shift()}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:e})=>({...e,points:[...e.points]})).slice(-5)}),0===this.scribbleItems.size&&this.pause()})}}},4220:function(e,t,n){"use strict";n.d(t,{Y:function(){return r}});class r{constructor(e){this.editor=e,e.store.onBeforeCreate=(e,t)=>{let n=this._beforeCreateHandlers[e.typeName];if(n){let r=e;for(let e of n)r=e(r,t);return r}return e},e.store.onAfterCreate=(e,t)=>{let n=this._afterCreateHandlers[e.typeName];if(n)for(let r of n)r(e,t)},e.store.onBeforeChange=(e,t,n)=>{let r=this._beforeChangeHandlers[t.typeName];if(r){let i=t;for(let t of r)i=t(e,i,n);return i}return t};let t=0;e.store.onAfterChange=(e,n,r)=>{if(++t>1e3)console.error("[CleanupManager.onAfterChange] Maximum update depth exceeded, bailing out.");else{let t=this._afterChangeHandlers[n.typeName];if(t)for(let i of t)i(e,n,r)}t--},e.store.onBeforeDelete=(e,t)=>{let n=this._beforeDeleteHandlers[e.typeName];if(n){for(let r of n)if(!1===r(e,t))return!1}},e.store.onAfterDelete=(e,t)=>{let n=this._afterDeleteHandlers[e.typeName];if(n)for(let r of n)r(e,t)},e.history.onBatchComplete=()=>{this._batchCompleteHandlers.forEach(e=>e())}}_beforeCreateHandlers={};_afterCreateHandlers={};_beforeChangeHandlers={};_afterChangeHandlers={};_beforeDeleteHandlers={};_afterDeleteHandlers={};_batchCompleteHandlers=[];registerBeforeCreateHandler(e,t){return this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(t),()=>i(this._beforeCreateHandlers[e],t)}registerAfterCreateHandler(e,t){return this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(t),()=>i(this._afterCreateHandlers[e],t)}registerBeforeChangeHandler(e,t){return this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(t),()=>i(this._beforeChangeHandlers[e],t)}registerAfterChangeHandler(e,t){return this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(t),()=>i(this._afterChangeHandlers[e],t)}registerBeforeDeleteHandler(e,t){return this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(t),()=>i(this._beforeDeleteHandlers[e],t)}registerAfterDeleteHandler(e,t){return this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(t),()=>i(this._afterDeleteHandlers[e],t)}registerBatchCompleteHandler(e){return this._batchCompleteHandlers.push(e),()=>i(this._batchCompleteHandlers,e)}}function i(e,t){let n=e.indexOf(t);n>=0&&e.splice(n,1)}},1531:function(e,t,n){"use strict";n.d(t,{f:function(){return m}});var r=n(5801),i=n(5895),o=n(2302),s=n(1334),a=n(7802),l=n(4885),c=n(6810),u=n(6967),d=Object.defineProperty,h=Object.getOwnPropertyDescriptor,p=(e,t,n,r)=>{for(var i,o=r>1?void 0:r?h(t,n):t,s=e.length-1;s>=0;s--)(i=e[s])&&(o=(r?i(t,n,o):i(o))||o);return r&&o&&d(t,n,o),o};let f=e=>Math.round(1e8*e)/1e8;function g(e,t,n,r,i){let o=e.filter(e=>("forward"===r?e.startNode.id===t:e.endNode.id===t)&&f(e.length)===f(n)&&(0,l.mW)(e.breadthIntersection[0],e.breadthIntersection[1],i[0],i[1]));if(0===o.length)return[];let s=new Set;return o.forEach(t=>{let a="forward"===r?t.endNode.id:t.startNode.id;if(!s.has(a)){s.add(a);let c=g(e,a,n,r,(0,l.mW)(t.breadthIntersection[0],t.breadthIntersection[1],i[0],i[1]));o.push(...c)}}),o}class m{constructor(e){this.editor=e}_snapLines=(0,r.cn)("snapLines",void 0);getLines(){return this._snapLines.get()??r.LZ}clear(){this.getLines().length&&this._snapLines.set(void 0)}setLines(e){this._snapLines.set(e)}getSnapPointsCache(){let{editor:e}=this;return e.store.createComputedCache("snapPoints",t=>{let n=e.getShapePageTransform(t.id);if(n)return this.editor.getShapeGeometry(t).snapPoints.map((e,r)=>{let{x:i,y:o}=a._.applyToPoint(n,e);return{x:i,y:o,id:`${t.id}:${r}`}})})}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){let{editor:e}=this,t=e.getRenderingBounds(),n=e.getSelectedShapeIds(),r=[],o=s=>{if((0,i.YT)(s)){let t=e.getShape(s);t&&e.isShapeOfType(t,"frame")&&r.push({id:s,pageBounds:e.getShapePageBounds(s),isClosed:e.getShapeGeometry(t).isClosed})}for(let i of e.getSortedChildIdsForParent(s)){if(n.includes(i))continue;let s=e.getShape(i);if(!s||!e.getShapeUtil(s).canSnap(s))continue;let a=e.getShapePageBounds(i);if(a&&t.includes(a)){if(e.isShapeOfType(s,"group")){o(i);continue}r.push({id:i,pageBounds:a,isClosed:e.getShapeGeometry(s).isClosed})}}};return o(this.getCurrentCommonAncestor()??e.getCurrentPageId()),r}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}getSnappablePoints(){let e=this.getSnapPointsCache(),t=this.getSnappableShapes(),n=[];return t.forEach(t=>{let r=e.get(t.id);r&&n.push(...r)}),n}getVisibleGaps(){let e,t;let n=[],r=[],i=this.getSnappableShapes().sort((e,t)=>e.pageBounds.minX-t.pageBounds.minX);for(let r=0;r<i.length;r++){e=i[r];for(let o=r+1;o<i.length;o++)t=i[o],e.pageBounds.maxX<t.pageBounds.minX&&(0,l.ep)(e.pageBounds.minY,e.pageBounds.maxY,t.pageBounds.minY,t.pageBounds.maxY)&&n.push({startNode:e,endNode:t,startEdge:[new c.B(e.pageBounds.maxX,e.pageBounds.minY),new c.B(e.pageBounds.maxX,e.pageBounds.maxY)],endEdge:[new c.B(t.pageBounds.minX,t.pageBounds.minY),new c.B(t.pageBounds.minX,t.pageBounds.maxY)],length:t.pageBounds.minX-e.pageBounds.maxX,breadthIntersection:(0,l.mW)(e.pageBounds.minY,e.pageBounds.maxY,t.pageBounds.minY,t.pageBounds.maxY)})}let o=i.sort((e,t)=>e.pageBounds.minY-t.pageBounds.minY);for(let n=0;n<o.length;n++){e=o[n];for(let i=n+1;i<o.length;i++)t=o[i],e.pageBounds.maxY<t.pageBounds.minY&&(0,l.ep)(e.pageBounds.minX,e.pageBounds.maxX,t.pageBounds.minX,t.pageBounds.maxX)&&r.push({startNode:e,endNode:t,startEdge:[new c.B(e.pageBounds.minX,e.pageBounds.maxY),new c.B(e.pageBounds.maxX,e.pageBounds.maxY)],endEdge:[new c.B(t.pageBounds.minX,t.pageBounds.minY),new c.B(t.pageBounds.maxX,t.pageBounds.minY)],length:t.pageBounds.minY-e.pageBounds.maxY,breadthIntersection:(0,l.mW)(e.pageBounds.minX,e.pageBounds.maxX,t.pageBounds.minX,t.pageBounds.maxX)})}return{horizontal:n,vertical:r}}snapTranslate({lockedAxis:e,initialSelectionPageBounds:t,initialSelectionSnapPoints:n,dragDelta:r}){let i=this.getSnapThreshold(),o=this.getSnappablePoints(),s=t.clone().translate(r),a=n.map(({x:e,y:t},n)=>({id:"selection:"+n,x:e+r.x,y:t+r.y})),l=[],u=[],d=new c.B(i,i);this.collectPointSnaps({minOffset:d,nearestSnapsX:l,nearestSnapsY:u,otherNodeSnapPoints:o,selectionSnapPoints:a}),this.collectGapSnaps({selectionPageBounds:s,nearestSnapsX:l,nearestSnapsY:u,minOffset:d});let h=new c.B("x"===e?0:l[0]?.nudge??0,"y"===e?0:u[0]?.nudge??0);d.x=0,d.y=0,l.length=0,u.length=0,a.forEach(e=>{e.x+=h.x,e.y+=h.y}),s.translate(h),this.collectPointSnaps({minOffset:d,nearestSnapsX:l,nearestSnapsY:u,otherNodeSnapPoints:o,selectionSnapPoints:a}),this.collectGapSnaps({selectionPageBounds:s,nearestSnapsX:l,nearestSnapsY:u,minOffset:d});let p=this.getPointSnapLines({nearestSnapsX:l,nearestSnapsY:u}),f=this.getGapSnapLines({selectionPageBounds:s,nearestSnapsX:l,nearestSnapsY:u});return this._snapLines.set([...f,...p]),{nudge:h}}getOutlinesInPageSpace(){return this.getSnappableShapes().map(({id:e,isClosed:t})=>{let n=(0,o.p$)(this.editor.getShapeGeometry(e).vertices);t&&n.push(n[0]);let r=this.editor.getShapePageTransform(e);if(!r)throw Error("No page transform");return a._.applyToPoints(r,n)})}getSnappingHandleDelta({handlePoint:e,additionalSegments:t}){let n,r,i,o;let s=this.getSnapThreshold(),a=this.getOutlinesInPageSpace(),l=s,d=null;for(let s of[...a,...t])for(let t=0;t<s.length-1;t++)n=s[t],r=s[t+1],i=c.B.NearestPointOnLineSegment(n,r,e),!isNaN(o=c.B.Dist(e,i))&&o<l&&(l=o,d=i);return d?(this._snapLines.set([{id:(0,u.E)(),type:"points",points:[d]}]),c.B.Sub(d,e)):null}snapResize({initialSelectionPageBounds:e,dragDelta:t,handle:n,isAspectRatioLocked:r,isResizingFromCenter:i}){let o=this.getSnapThreshold(),{box:a,scaleX:l,scaleY:u}=s.xu.Resize(e,n,i?2*t.x:t.x,i?2*t.y:t.y,r),d=n;l<0&&(d=(0,s.Ee)(d)),u<0&&(d=(0,s.Op)(d)),i&&(a.center=e.center);let h="top"===d||"bottom"===d,p="left"===d||"right"===d,f=y(d,a),g=this.getSnappablePoints(),m=[],b=[],w=new c.B(o,o);this.collectPointSnaps({minOffset:w,nearestSnapsX:m,nearestSnapsY:b,otherNodeSnapPoints:g,selectionSnapPoints:f});let x=new c.B(h?0:m[0]?.nudge??0,p?0:b[0]?.nudge??0);if(r&&(0,s.m3)(d)&&0!==x.len()){let t=m.length&&b.length?Math.abs(x.x)<Math.abs(x.y)?"x":"y":m.length?"x":"y",n=e.aspectRatio;"x"===t?(b.length=0,x.y=x.x/n,("bottom_left"===d||"top_right"===d)&&(x.y=-x.y)):(m.length=0,x.x=x.y*n,("bottom_left"===d||"top_right"===d)&&(x.x=-x.x))}let v=c.B.Add(t,x),{box:S}=s.xu.Resize(e,n,i?2*v.x:v.x,i?2*v.y:v.y,r);i&&(S.center=e.center);let k=y("any",S);m.length=0,b.length=0,w.x=0,w.y=0,this.collectPointSnaps({minOffset:w,nearestSnapsX:m,nearestSnapsY:b,otherNodeSnapPoints:g,selectionSnapPoints:k});let _=this.getPointSnapLines({nearestSnapsX:m,nearestSnapsY:b});return this._snapLines.set([..._]),{nudge:x}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:t,minOffset:n,nearestSnapsX:r,nearestSnapsY:i}){for(let o of e)for(let e of t){let t=c.B.Sub(o,e),s=Math.abs(t.x),a=Math.abs(t.y);f(s)<=f(n.x)&&(f(s)<f(n.x)&&(r.length=0),r.push({type:"points",points:{thisPoint:o,otherPoint:e},nudge:e.x-o.x}),n.x=s),f(a)<=f(n.y)&&(f(a)<f(n.y)&&(i.length=0),i.push({type:"points",points:{thisPoint:o,otherPoint:e},nudge:e.y-o.y}),n.y=a)}}collectGapSnaps({selectionPageBounds:e,minOffset:t,nearestSnapsX:n,nearestSnapsY:r}){let{horizontal:i,vertical:o}=this.getVisibleGaps();for(let r of i){if(!(0,l.ep)(r.breadthIntersection[0],r.breadthIntersection[1],e.minY,e.maxY))continue;let i=r.startEdge[0].x+r.length/2-e.center.x;if(r.length>e.width&&f(Math.abs(i))<=f(t.x)){f(Math.abs(i))<f(t.x)&&(n.length=0),t.x=Math.abs(i);let e={type:"gap_center",gap:r,nudge:i},o=n.find(({type:e})=>"gap_center"===e),s=o&&(0,l.mW)(r.breadthIntersection[0],r.breadthIntersection[1],o.gap.breadthIntersection[0],o.gap.breadthIntersection[1]);o&&o.gap.length>r.length&&s?n[n.indexOf(o)]=e:o&&s||n.push(e)}let o=r.startNode.pageBounds.minX-r.length-e.maxX;f(Math.abs(o))<=f(t.x)&&(f(Math.abs(o))<f(t.x)&&(n.length=0),t.x=Math.abs(o),n.push({type:"gap_duplicate",gap:r,protrusionDirection:"left",nudge:o}));let s=r.endNode.pageBounds.maxX+r.length-e.minX;f(Math.abs(s))<=f(t.x)&&(f(Math.abs(s))<f(t.x)&&(n.length=0),t.x=Math.abs(s),n.push({type:"gap_duplicate",gap:r,protrusionDirection:"right",nudge:s}))}for(let n of o){if(!(0,l.ep)(n.breadthIntersection[0],n.breadthIntersection[1],e.minX,e.maxX))continue;let i=n.startEdge[0].y+n.length/2-e.center.y;if(n.length>e.height&&f(Math.abs(i))<=f(t.y)){f(Math.abs(i))<f(t.y)&&(r.length=0),t.y=Math.abs(i);let e={type:"gap_center",gap:n,nudge:i},o=r.find(({type:e})=>"gap_center"===e),s=o&&(0,l.ep)(o.gap.breadthIntersection[0],o.gap.breadthIntersection[1],n.breadthIntersection[0],n.breadthIntersection[1]);o&&o.gap.length>n.length&&s?r[r.indexOf(o)]=e:o&&s||r.push(e);continue}let o=n.startNode.pageBounds.minY-n.length-e.maxY;f(Math.abs(o))<=f(t.y)&&(f(Math.abs(o))<f(t.y)&&(r.length=0),t.y=Math.abs(o),r.push({type:"gap_duplicate",gap:n,protrusionDirection:"top",nudge:o}));let s=n.endNode.pageBounds.maxY+n.length-e.minY;f(Math.abs(s))<=f(t.y)&&(f(Math.abs(s))<f(t.y)&&(r.length=0),t.y=Math.abs(s),r.push({type:"gap_duplicate",gap:n,protrusionDirection:"bottom",nudge:s}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:t}){let n={},r={};if(e.length>0){for(let t of e)if("points"===t.type){let e=f(t.points.otherPoint.x);n[e]||(n[e]=[]),n[e].push(t.points)}}if(t.length>0){for(let e of t)if("points"===e.type){let t=f(e.points.otherPoint.y);r[t]||(r[t]=[]),r[t].push(e.points)}}return Object.values(n).concat(Object.values(r)).map(e=>({id:(0,u.E)(),type:"points",points:(0,o.D8)(e.map(e=>c.B.From(e.otherPoint)).concat(e.map(e=>c.B.From(e.thisPoint))),(e,t)=>e.equals(t))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:t,nearestSnapsY:n}){let{vertical:r,horizontal:i}=this.getVisibleGaps(),o={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},s=[];if(t.length>0)for(let n of t){if("points"===n.type)continue;let{gap:{breadthIntersection:t,startEdge:r,startNode:a,endNode:c,length:d,endEdge:h}}=n;switch(n.type){case"gap_center":{let n=(d-e.width)/2,p=(0,l.mW)(t[0],t[1],e.minY,e.maxY);s.push({type:"gaps",direction:"horizontal",id:(0,u.E)(),gaps:[...g(i,a.id,n,"backward",p),{startEdge:r,endEdge:o.left},{startEdge:o.right,endEdge:h},...g(i,c.id,n,"forward",p)]});break}case"gap_duplicate":{let p=(0,l.mW)(t[0],t[1],e.minY,e.maxY);s.push({type:"gaps",direction:"horizontal",id:(0,u.E)(),gaps:"left"===n.protrusionDirection?[{startEdge:o.right,endEdge:r.map(e=>e.clone().addXY(-a.pageBounds.width,0))},{startEdge:r,endEdge:h},...g(i,c.id,d,"forward",p)]:[...g(i,a.id,d,"backward",p),{startEdge:r,endEdge:h},{startEdge:h.map(e=>e.clone().addXY(n.gap.endNode.pageBounds.width,0)),endEdge:o.left}]})}}}if(n.length>0)for(let t of n){if("points"===t.type)continue;let{gap:{breadthIntersection:n,startEdge:i,startNode:a,endNode:c,length:d,endEdge:h}}=t;switch(t.type){case"gap_center":{let c=(d-e.height)/2,p=(0,l.mW)(n[0],n[1],e.minX,e.maxX);s.push({type:"gaps",direction:"vertical",id:(0,u.E)(),gaps:[...g(r,a.id,c,"backward",p),{startEdge:i,endEdge:o.top},{startEdge:o.bottom,endEdge:h},...g(r,t.gap.endNode.id,c,"forward",p)]});break}case"gap_duplicate":{let p=(0,l.mW)(n[0],n[1],e.minX,e.maxX);s.push({type:"gaps",direction:"vertical",id:(0,u.E)(),gaps:"top"===t.protrusionDirection?[{startEdge:o.bottom,endEdge:i.map(e=>e.clone().addXY(0,-a.pageBounds.height))},{startEdge:i,endEdge:h},...g(r,c.id,d,"forward",p)]:[...g(r,a.id,d,"backward",p),{startEdge:i,endEdge:h},{startEdge:h.map(e=>e.clone().addXY(0,c.pageBounds.height)),endEdge:o.top}]})}}}return!function(e){e.sort((e,t)=>t.gaps.length-e.gaps.length);for(let t=e.length-1;t>0;t--){let n=e[t];for(let r=t-1;r>=0;r--){let i=e[r];if(i.direction===n.direction&&n.gaps.every(e=>i.gaps.some(t=>f(e.startEdge[0].x)===f(t.startEdge[0].x)&&f(e.startEdge[0].y)===f(t.startEdge[0].y)&&f(e.startEdge[1].x)===f(t.startEdge[1].x)&&f(e.startEdge[1].y)===f(t.startEdge[1].y))&&i.gaps.some(t=>f(e.endEdge[0].x)===f(t.endEdge[0].x)&&f(e.endEdge[0].y)===f(t.endEdge[0].y)&&f(e.endEdge[1].x)===f(t.endEdge[1].x)&&f(e.endEdge[1].y)===f(t.endEdge[1].y)))){e.splice(t,1);break}}}}(s),s}}function y(e,t){let{minX:n,maxX:r,minY:i,maxY:o}=t,s=[];switch(e){case"top":case"left":case"top_left":case"any":s.push({id:"top_left",handle:"top_left",x:n,y:i})}switch(e){case"top":case"right":case"top_right":case"any":s.push({id:"top_right",handle:"top_right",x:r,y:i})}switch(e){case"bottom":case"right":case"bottom_right":case"any":s.push({id:"bottom_right",handle:"bottom_right",x:r,y:o})}switch(e){case"bottom":case"left":case"bottom_left":case"any":s.push({id:"bottom_left",handle:"bottom_left",x:n,y:o})}return s}p([r.Fl],m.prototype,"getSnapPointsCache",1),p([r.Fl],m.prototype,"getSnapThreshold",1),p([r.Fl],m.prototype,"getSnappableShapes",1),p([r.Fl],m.prototype,"getCurrentCommonAncestor",1),p([r.Fl],m.prototype,"getSnappablePoints",1),p([r.Fl],m.prototype,"getVisibleGaps",1),p([r.Fl],m.prototype,"getOutlinesInPageSpace",1)},8343:function(e,t,n){"use strict";n.d(t,{R:function(){return a}});let r=/\r?\n|\r/g;function i(e){return e.replace(r,"\n").split("\n").map(e=>e||" ").join("\n")}let o={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},s=/\s/;class a{constructor(e){this.editor=e;let t=document.createElement("div");t.id="tldraw_text_measure",t.classList.add("tl-text"),t.classList.add("tl-text-measure"),t.tabIndex=-1,this.editor.getContainer().appendChild(t),this.baseElm=t}baseElm;measureText=(e,t)=>{let n=this.baseElm?.cloneNode();this.baseElm.insertAdjacentElement("afterend",n),n.setAttribute("dir","ltr"),n.style.setProperty("font-family",t.fontFamily),n.style.setProperty("font-style",t.fontStyle),n.style.setProperty("font-weight",t.fontWeight),n.style.setProperty("font-size",t.fontSize+"px"),n.style.setProperty("line-height",t.lineHeight*t.fontSize+"px"),n.style.setProperty("max-width",null===t.maxWidth?null:t.maxWidth+"px"),n.style.setProperty("min-width",t.minWidth??null),n.style.setProperty("padding",t.padding),n.textContent=i(e);let r=n.getBoundingClientRect();return n.remove(),{x:0,y:0,w:r.width,h:r.height}};measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:t=!1}={}){let n=[],r=e.getBoundingClientRect(),i=-r.left,o=-r.top,a=new Range,l=e.childNodes[0],c=0,u=null,d=null,h=0,p=!1;for(let r of e.childNodes)if(r.nodeType===Node.TEXT_NODE)for(let e of r.textContent??""){a.setStart(l,c),a.setEnd(l,c+e.length);let r=a.getClientRects(),f=r[r.length-1],g=f.top+o,m=f.left+i,y=f.right+i,b=s.test(e);if(b===d&&g===h&&u)u.box.w=y-u.box.x,u.text+=e;else{if(u){if(t&&g!==h){p=!0;break}n.push(u)}u={box:{x:m,y:g,w:f.width,h:f.height},text:e}}d=b,h=g,c+=e.length}return u&&n.push(u),{spans:n,didTruncate:p}}measureTextSpans(e,t){if(""===e)return[];let n=this.baseElm?.cloneNode();this.baseElm.insertAdjacentElement("afterend",n);let r=Math.ceil(t.width-2*t.padding);n.style.setProperty("width",`${r}px`),n.style.setProperty("height","min-content"),n.style.setProperty("dir","ltr"),n.style.setProperty("font-size",`${t.fontSize}px`),n.style.setProperty("font-family",t.fontFamily),n.style.setProperty("font-weight",t.fontWeight),n.style.setProperty("line-height",`${t.lineHeight*t.fontSize}px`),n.style.setProperty("text-align",o[t.textAlign]);let s="truncate-ellipsis"===t.overflow||"truncate-clip"===t.overflow;s&&(n.style.setProperty("overflow-wrap","anywhere"),n.style.setProperty("word-break","break-all"));let a=i(e);n.textContent=a;let{spans:l,didTruncate:c}=this.measureElementTextNodeSpans(n,{shouldTruncateToFirstLine:s});if("truncate-ellipsis"===t.overflow&&c){n.textContent="";let e=Math.ceil(this.measureElementTextNodeSpans(n).spans[0].box.w);n.style.setProperty("width",`${r-e}px`),n.textContent=a;let i=this.measureElementTextNodeSpans(n,{shouldTruncateToFirstLine:!0}).spans,o=i[i.length-1];return i.push({text:"",box:{x:Math.min(o.box.x+o.box.w,t.width-t.padding-e),y:o.box.y,w:e,h:o.box.h}}),i}return n.remove(),l}}},2062:function(e,t,n){"use strict";n.d(t,{r:function(){return i}});var r=n(6810);class i{constructor(e){this.editor=e,this.editor.disposables.add(this.dispose),this.start()}raf;isPaused=!0;last=0;t=0;start=()=>{this.isPaused=!1,cancelAnimationFrame(this.raf),this.raf=requestAnimationFrame(this.tick),this.last=Date.now()};tick=()=>{if(this.isPaused)return;let e=Date.now(),t=e-this.last;if(this.last=e,this.t+=t,this.editor.emit("frame",t),this.t<16){this.raf=requestAnimationFrame(this.tick);return}this.t-=16,this.updatePointerVelocity(t),this.editor.emit("tick",t),this.raf=requestAnimationFrame(this.tick)};dispose=()=>{this.isPaused=!0,cancelAnimationFrame(this.raf)};prevPoint=new r.B;updatePointerVelocity=e=>{let{prevPoint:t,editor:{inputs:{currentScreenPoint:n,pointerVelocity:i}}}=this;if(0===e)return;let o=r.B.Sub(n,t);this.prevPoint=n.clone();let s=o.len(),a=s?o.div(s):new r.B(0,0),l=i.clone().lrp(a.mul(s/e),.5);.01>Math.abs(l.x)&&(l.x=0),.01>Math.abs(l.y)&&(l.y=0),i.equals(l)||(this.editor.inputs.pointerVelocity=l)}}},2717:function(e,t,n){"use strict";n.d(t,{K:function(){return l}});var r=n(5801),i=n(5399),o=Object.defineProperty,s=Object.getOwnPropertyDescriptor,a=(e,t,n,r)=>{for(var i,a=r>1?void 0:r?s(t,n):t,l=e.length-1;l>=0;l--)(i=e[l])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&o(t,n,a),a};class l{constructor(e,t){this.user=e,this.inferDarkMode=t}updateUserPreferences=e=>{this.user.setUserPreferences({...this.user.userPreferences.get(),...e})};getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),isDarkMode:this.getIsDarkMode(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode()}}getIsDarkMode(){return this.user.userPreferences.get().isDarkMode??(!!this.inferDarkMode&&(0,i.ng)())}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??i.ks.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??i.ks.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name??i.ks.name}getLocale(){return this.user.userPreferences.get().locale??i.ks.locale}getColor(){return this.user.userPreferences.get().color??i.ks.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??i.ks.isSnapMode}}a([r.Fl],l.prototype,"getUserPreferences",1),a([r.Fl],l.prototype,"getIsDarkMode",1),a([r.Fl],l.prototype,"getEdgeScrollSpeed",1),a([r.Fl],l.prototype,"getAnimationSpeed",1),a([r.Fl],l.prototype,"getId",1),a([r.Fl],l.prototype,"getName",1),a([r.Fl],l.prototype,"getLocale",1),a([r.Fl],l.prototype,"getColor",1),a([r.Fl],l.prototype,"getIsSnapMode",1)},5808:function(e,t,n){"use strict";n.d(t,{E:function(){return r}});class r{constructor(e){this.editor=e}static props;static migrations;static type;canSnap=()=>!0;canScroll=()=>!1;canUnmount=()=>!0;canBind=(e,t)=>!0;canEdit=()=>!1;canResize=()=>!0;canEditInReadOnly=()=>!1;canCrop=()=>!1;providesBackgroundForChildren(e){return!1}hideResizeHandles=()=>!1;hideRotateHandle=()=>!1;hideSelectionBoundsBg=()=>!1;hideSelectionBoundsFg=()=>!1;isAspectRatioLocked=()=>!1;getOutlineSegments(e){return[this.editor.getShapeGeometry(e).vertices]}canReceiveNewChildrenOfType(e,t){return!1}canDropShapes(e,t){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}onBeforeCreate;onBeforeUpdate;onDragShapesOver;onDragShapesOut;onDropShapesOver;onResizeStart;onResize;onResizeEnd;onTranslateStart;onTranslate;onTranslateEnd;onHandleDrag;onRotateStart;onRotate;onRotateEnd;onBindingChange;onChildrenChange;onDoubleClickHandle;onDoubleClickEdge;onDoubleClick;onClick;onEditEnd}},8766:function(e,t,n){"use strict";n.d(t,{Q:function(){return f}});var r=n(7437),i=n(5895),o=n(8677),s=n(3072),a=n(8974),l=n(2287),c=n(737),u=n(5808),d=n(5801),h=n(7616);function p({bounds:e,className:t}){let n=(0,h.j)(),i=(0,d.Hg)("zoom level",()=>n.getZoomLevel(),[n]);return(0,r.jsx)("g",{className:t,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:e.sides.map((e,t)=>{let{strokeDasharray:n,strokeDashoffset:o}=function(e,t,n={}){let{closed:r=!1,snap:i=1,start:o="outset",end:s="outset",lengthRatio:a=2,style:l="dashed"}=n,c=0,u=0,d=1,h=0,p=0;switch(l){case"dashed":d=1,c=Math.min(t*a,e/4);break;case"dotted":c=t/(d=100);break;default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||("outset"===o?(e+=c/2,p+=c/2):"skip"===o&&(e-=c,p-=c),"outset"===s?e+=c/2:"skip"!==s||(e-=c)),u=Math.floor(e/c/(2*d)),(u-=u%i)<3&&"dashed"===l?e/t<5?(c=e,u=1,h=0):(c=.333*e,h=.333*e):(c=e/(u=Math.max(u,3))/(2*d),r?(p=c/2,h=(e-u*c)/u):h=(e-u*c)/Math.max(1,u-1)),{strokeDasharray:[c,h].join(" "),strokeDashoffset:p.toString()}}(e[0].dist(e[1]),1/i,{style:"dashed",lengthRatio:4});return(0,r.jsx)("line",{x1:e[0].x,y1:e[0].y,x2:e[1].x,y2:e[1].y,strokeDasharray:n,strokeDashoffset:o},t)})})}class f extends u.E{static type="group";static props=i.A7;static migrations=i.c4;hideSelectionBoundsFg=()=>!0;canBind=()=>!1;getDefaultProps(){return{}}getGeometry(e){let t=this.editor.getSortedChildIdsForParent(e.id);return 0===t.length?new c.z({width:1,height:1,isFilled:!1}):new s.m({children:t.map(e=>{let t=this.editor.getShape(e),n=this.editor.getShapeGeometry(e),r=this.editor.getShapeLocalTransform(t).applyToPoints(n.vertices);return n.isClosed?new a.w({points:r,isFilled:!0}):new l.q({points:r})})})}component(e){let t=this.editor.getErasingShapeIds().includes(e.id),{hintingShapeIds:n}=this.editor.getCurrentPageState(),i=n.length>0&&n.some(t=>t!==e.id&&this.editor.isShapeOfType(this.editor.getShape(t),"group")),s=this.editor.getCurrentPageState().focusedGroupId!==e.id;if(!t&&(s||i))return null;let a=this.editor.getShapeGeometry(e).bounds;return(0,r.jsx)(o.g,{id:e.id,children:(0,r.jsx)(p,{className:"tl-group",bounds:a})})}indicator(e){let t=this.editor.getShapeGeometry(e).bounds;return(0,r.jsx)(p,{className:"",bounds:t})}onChildrenChange=e=>{let t=this.editor.getSortedChildIdsForParent(e.id);if(0===t.length){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([e.id]);return}if(1===t.length){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(t,e.parentId),this.editor.deleteShapes([e.id]);return}}}},2705:function(e,t,n){"use strict";n.d(t,{p:function(){return c}});var r=n(7802),i=n(6810),o=n(9320),s=n(4885),a=n(8864),l=n(1637);function c(e,t,n=0){let{arrowheadEnd:c,arrowheadStart:d}=t.props,h=t.props.bend+n;if(Math.abs(h)>Math.abs(t.props.bend*a.Od))return(0,l.r)(e,t);let p=(0,a.Qs)(e,t),f=i.B.Med(p.start,p.end),g=i.B.Sub(p.end,p.start).uni(),m=i.B.Add(f,g.per().mul(-h)),y=(0,a.Up)(e,t.props.start),b=(0,a.Up)(e,t.props.end),w=p.start.clone(),x=p.end.clone(),v=m.clone();if(i.B.Equals(w,x))return{isStraight:!0,start:{handle:w,point:w,arrowhead:t.props.arrowheadStart},end:{handle:x,point:x,arrowhead:t.props.arrowheadEnd},middle:v,isValid:!1,length:0};let S=t.props.bend<0,k=S?s.VK:s.pc,_=u(w,x,v),E=i.B.Angle(_.center,w),C=k(E,i.B.Angle(_.center,x));if(0===_.length||0===_.size||!(0,s.AV)(_.length)||!(0,s.AV)(_.size))return(0,l.r)(e,t);let P=w.clone(),T=x.clone(),j=v.clone(),I=e.getShapePageTransform(t),M=0,A=0,O=a.Kn;if(y&&!y.isExact){let n;let i=r._.applyToPoint(I,P),s=r._.applyToPoint(I,_.center),l=r._.applyToPoint(I,T),c=r._.Inverse(y.transform),u=r._.applyToPoint(c,i),h=r._.applyToPoint(c,s),p=r._.applyToPoint(c,l),{isClosed:f}=y,g=(f?o.h9:o.XS)(h,_.radius,y.outline);if(g){let e=h.angle(u),t=k(e,h.angle(p));g=g.filter(n=>k(e,h.angle(n))<=t);let r=.25*t;g.sort(f?(t,n)=>Math.abs(k(e,h.angle(t))-r)<Math.abs(k(e,h.angle(n))-r)?-1:1:(t,n)=>k(e,h.angle(t))<k(e,h.angle(n))?-1:1),n=g[0]??(f?void 0:u)}else n=f?void 0:u;if(n&&(P.setTo(e.getPointInShapeSpace(t,r._.applyToPoint(y.transform,n))),y.didIntersect=!0,"none"!==d)){let e=a.L$[t.props.size]/2+("size"in y.shape.props?a.L$[y.shape.props.size]/2:0);M=a.oF+e,O+=e}}if(b&&!b.isExact){let n;let i=r._.applyToPoint(I,P),s=r._.applyToPoint(I,T),l=r._.applyToPoint(I,_.center),u=r._.Inverse(b.transform),d=r._.applyToPoint(u,i),h=r._.applyToPoint(u,l),p=r._.applyToPoint(u,s),f=b.isClosed,g=(f?o.h9:o.XS)(h,_.radius,b.outline);if(g){let e=h.angle(d),t=k(e,h.angle(p)),r=.75*t;(g=g.filter(n=>k(e,h.angle(n))<=t)).sort(f?(t,n)=>Math.abs(k(e,h.angle(t))-r)<Math.abs(k(e,h.angle(n))-r)?-1:1:(t,n)=>k(e,h.angle(t))<k(e,h.angle(n))?-1:1),n=g[0]?g[0]:f?void 0:p}else n=f?void 0:p;if(n&&(T.setTo(e.getPointInShapeSpace(t,r._.applyToPoint(b.transform,n))),b.didIntersect=!0,"none"!==c)){let e=a.L$[t.props.size]/2+("size"in b.shape.props?a.L$[b.shape.props.size]/2:0);A=a.oF+e,O+=e}}let $=i.B.Angle(_.center,P),B=i.B.Angle(_.center,T),D=k($,B),L=D*_.radius,R=P.clone(),z=T.clone();if(0!==M){let e=M/L*(S?1:-1),t=i.B.FromAngle($+D*e);R.setTo(_.center).add(t.mul(_.radius))}if(0!==A){let e=A/L*(S?-1:1),t=i.B.FromAngle(B+D*e);z.setTo(_.center).add(t.mul(_.radius))}if(i.B.Dist(R,z)<O&&(0!==M&&0!==A?(M*=-1.5,A*=-1.5):0!==M?M*=-2:0!==A&&(A*=-2)),0!==M){let e=M/L*(S?1:-1),t=i.B.FromAngle($+D*e);P.setTo(_.center).add(t.mul(_.radius))}if(0!==A){let e=A/L*(S?-1:1),t=i.B.FromAngle(B+D*e);T.setTo(_.center).add(t.mul(_.radius))}if(y&&b&&!y.isExact&&!b.isExact){L=(D=k($=i.B.Angle(_.center,P),B=i.B.Angle(_.center,T)))*_.radius;let t=(0,a.xO)(e,y.shape.id,b.shape.id);if("double-bound"===t&&L<30)P.setTo(w),T.setTo(x),j.setTo(v);else if("safe"===t&&(y&&!y.didIntersect&&P.setTo(w),b&&!b.didIntersect||k(E,$)>k(E,B))){let e=Math.min(.9,a.Kn/L)*(S?1:-1),t=i.B.FromAngle($+D*e);T.setTo(_.center).add(t.mul(_.radius))}}(function(e,t,n,r,o,a,l){let c=i.B.Angle(e,n),u=i.B.Angle(e,r),d=(0,s.VK)(c,u);l||(d=s.yo-d);let h=i.B.FromAngle(c+.5*(l?1:-1)*d);if(o.setTo(e).add(h.mul(t)),d>a){o.rotWith(e,s.PI);let t=r.clone();r.setTo(n),n.setTo(t)}})(_.center,_.radius,P,T,j,C,S),P.equals(T)&&(P.setTo(j.clone().addXY(1,1)),T.setTo(j.clone().subXY(1,1))),w.setTo(P),x.setTo(T),v.setTo(j);let N=u(w,x,v);return{isStraight:!1,start:{point:w,handle:p.start,arrowhead:t.props.arrowheadStart},end:{point:x,handle:p.end,arrowhead:t.props.arrowheadEnd},middle:v,handleArc:_,bodyArc:N,isValid:0!==N.length&&isFinite(N.center.x)&&isFinite(N.center.y)}}function u(e,t,n){let r=-2*(e.x*(t.y-n.y)-e.y*(t.x-n.x)+t.x*n.y-n.x*t.y),o={x:((e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y)+(n.x*n.x+n.y*n.y)*(t.y-e.y))/r,y:((e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x)+(n.x*n.x+n.y*n.y)*(e.x-t.x))/r},a=i.B.Dist(o,e),l=+i.B.Clockwise(e,n,t),c=Math.hypot(e.y-t.y,e.x-t.x),u=Math.hypot(t.y-n.y,t.x-n.x),d=Math.hypot(n.y-e.y,n.x-e.x),h=2*Math.acos((u*u+d*d-c*c)/(2*u*d)),p=+(s.PI>h),f=(s.yo-h)*(l?1:-1);return{center:o,radius:a,size:f,length:f*a,largeArcFlag:p,sweepFlag:l}}},8864:function(e,t,n){"use strict";n.d(t,{Kn:function(){return u},L$:function(){return p},Od:function(){return h},Qs:function(){return c},Up:function(){return a},el:function(){return s},oF:function(){return d},xO:function(){return f}});var r=n(7802),i=n(6810),o=n(3072);function s(e){return 8>Math.abs(e.props.bend)}function a(e,t){if("point"===t.type)return;let n=e.getShape(t.boundShapeId),r=e.getShapePageTransform(n),i=e.getShapeGeometry(n),s=i instanceof o.m?i.children[0].vertices:i.vertices;return{shape:n,transform:r,isClosed:i.isClosed,isExact:t.isExact,didIntersect:!1,outline:s}}function l(e,t,n,o){if("point"===n.type)return i.B.From(n);let s=e.getShape(n.boundShapeId);if(!s)return new i.B(0,0);{let{point:a,size:l}=e.getShapeGeometry(s).bounds,c=i.B.Add(a,i.B.MulV(n.isPrecise||o?n.normalizedAnchor:{x:.5,y:.5},l)),u=r._.applyToPoint(e.getShapePageTransform(s),c);return r._.applyToPoint(r._.Inverse(t),u)}}function c(e,t){let n,r;let i=e.getShapePageTransform(t);"binding"===t.props.start.type&&"binding"===t.props.end.type&&(n=t.props.start.boundShapeId,r=t.props.end.boundShapeId);let o=f(e,n,r);return{start:l(e,i,t.props.start,"double-bound"===o||"start-contains-end"===o),end:l(e,i,t.props.end,"double-bound"===o||"end-contains-start"===o)}}let u=10,d=10,h=10,p={s:2,m:3.5,l:5,xl:10};function f(e,t,n){if(!t||!n)return"safe";if(t===n)return"double-bound";let r=e.getShapePageBounds(t),i=e.getShapePageBounds(n);if(r&&i){if(r.contains(i))return"start-contains-end";if(i.contains(r))return"end-contains-start"}return"safe"}},1637:function(e,t,n){"use strict";n.d(t,{r:function(){return a}});var r=n(7802),i=n(6810),o=n(9320),s=n(8864);function a(e,t){let{start:n,end:r,arrowheadStart:o,arrowheadEnd:a}=t.props,c=(0,s.Qs)(e,t),u=c.start.clone(),d=c.end.clone(),h=i.B.Med(u,d);if(i.B.Equals(u,d))return{isStraight:!0,start:{handle:u,point:u,arrowhead:t.props.arrowheadStart},end:{handle:d,point:d,arrowhead:t.props.arrowheadEnd},middle:h,isValid:!1,length:0};let p=i.B.Sub(d,u).uni(),f=(0,s.Up)(e,n),g=(0,s.Up)(e,r),m=e.getShapePageTransform(t);l(d,c.start,m,g),l(u,c.end,m,f);let y=0,b=0,w=0,x=0,v=s.Kn,S=f&&g&&f.shape===g.shape,k=f&&g?(0,s.xO)(e,f.shape.id,g.shape.id):"safe";"safe"===k&&f&&g&&!S&&!f.isExact&&!g.isExact&&(g.didIntersect&&!f.didIntersect?f.isClosed&&u.setTo(d.clone().add(p.clone().mul(s.Kn))):!g.didIntersect&&g.isClosed&&d.setTo(u.clone().sub(p.clone().mul(s.Kn))));let _=i.B.Sub(d,u).uni(),E=!i.B.Equals(_,p);S||("start-contains-end"!==k&&f&&"none"!==o&&!f.isExact&&(w=s.L$[t.props.size]/2+("size"in f.shape.props?s.L$[f.shape.props.size]/2:0),y=s.oF+w,v+=w),"end-contains-start"===k||!g||"none"===a||g.isExact||(x=s.L$[t.props.size]/2+("size"in g.shape.props?s.L$[g.shape.props.size]/2:0),b=s.oF+x,v+=x));let C=u.clone().add(_.clone().mul(y*(E?-1:1))),P=d.clone().sub(_.clone().mul(b*(E?-1:1)));i.B.Dist(C,P)<v&&(0!==y&&0!==b?(y*=-1.5,b*=-1.5):0!==y?y*=-1:0!==b&&(b*=-1)),u.add(_.clone().mul(y*(E?-1:1))),d.sub(_.clone().mul(b*(E?-1:1))),E?(f&&g&&d.setTo(i.B.Add(u,_.clone().mul(-s.Kn))),h.setTo(i.B.Med(c.start,c.end))):h.setTo(i.B.Med(u,d));let T=i.B.Dist(u,d);return{isStraight:!0,start:{handle:c.start,point:u,arrowhead:t.props.arrowheadStart},end:{handle:c.end,point:d,arrowhead:t.props.arrowheadEnd},middle:h,isValid:T>0,length:T}}function l(e,t,n,s){let a;if(void 0===s||s.isExact)return;let l=r._.applyToPoint(n,t),c=r._.applyToPoint(n,e),u=r._.applyToPoint(r._.Inverse(s.transform),l),d=r._.applyToPoint(r._.Inverse(s.transform),c),h=s.isClosed,p=(h?o.qZ:o.Gc)(u,d,s.outline);if(null!==p&&(a=p.sort((e,t)=>i.B.Dist(e,u)-i.B.Dist(t,u))[0]??(h?void 0:d)),void 0===a)return;let f=r._.applyToPoint(s.transform,a),g=r._.applyToPoint(r._.Inverse(n),f);e.setTo(g),s.didIntersect=!0}},5783:function(e,t,n){"use strict";n.d(t,{m:function(){return i}});var r=n(7630);class i extends r.n{static id="root";static initial="";static children=()=>[];onKeyDown=e=>{if("KeyZ"===e.code&&!(e.shiftKey||e.ctrlKey)){let t=this.getCurrent();t&&t.getCurrent()?.id==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...e,onInteractionEnd:t.id})}}}},7630:function(e,t,n){"use strict";n.d(t,{n:function(){return o}});var r=n(5801),i=n(405);class o{constructor(e,t){this.editor=e;let{id:n,children:i,initial:o}=this.constructor;this.id=n,this._isActive=(0,r.cn)("toolIsActive"+this.id,!1),this._current=(0,r.cn)("toolState"+this.id,void 0),this._path=(0,r.Fl)("toolPath"+this.id,()=>{let e=this.getCurrent();return this.id+(e?`.${e.getPath()}`:"")}),this.parent=t??{},this.parent?i&&o?(this.type="branch",this.initial=o,this.children=Object.fromEntries(i().map(e=>[e.id,new e(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",i&&o&&(this.initial=o,this.children=Object.fromEntries(i().map(e=>[e.id,new e(this.editor,this)])),this._current.set(this.children[this.initial])))}static id;static initial;static children;id;type;shapeType;initial;children;parent;getPath(){return this._path.get()}_path;getCurrent(){return this._current.get()}_current;getIsActive(){return this._isActive.get()}_isActive;transition=(e,t={})=>{let n=e.split("."),r=this;for(let e=0;e<n.length;e++){let i=n[e],o=r.getCurrent(),s=r.children?.[i];if(!s)throw Error(`${r.id} - no child state exists with the id ${i}.`);if(o?.id!==s.id&&(o?.exit(t,i),r._current.set(s),s.enter(t,o?.id||"initial"),!s.getIsActive()))break;r=s}return this};handleEvent=e=>{let t=i.J[e.name],n=this.getCurrent();this[t]?.(e),this.getCurrent()===n&&this.getIsActive()&&n?.handleEvent(e)};enter=(e,t)=>{if(this._isActive.set(!0),this.onEnter?.(e,t),this.onTick&&this.editor.on("tick",this.onTick),this.children&&this.initial&&this.getIsActive()){let n=this.children[this.initial];this._current.set(n),n.enter(e,t)}};exit=(e,t)=>{this._isActive.set(!1),this.onTick&&this.editor.off("tick",this.onTick),this.onExit?.(e,t),this.getIsActive()||this.getCurrent()?.exit(e,t)};_currentToolIdMask=(0,r.cn)("curent tool id mask",void 0);getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}onWheel;onPointerDown;onPointerMove;onPointerUp;onDoubleClick;onTripleClick;onQuadrupleClick;onRightClick;onMiddleClick;onKeyDown;onKeyUp;onKeyRepeat;onCancel;onComplete;onInterrupt;onEnter;onExit;onTick}},405:function(e,t,n){"use strict";n.d(t,{J:function(){return r}});let r={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick"}},7616:function(e,t,n){"use strict";n.d(t,{j:function(){return o},r:function(){return i}});var r=n(2265);let i=r.createContext({});function o(){return r.useContext(i)}},1334:function(e,t,n){"use strict";n.d(t,{Ee:function(){return a},Op:function(){return s},dC:function(){return c},m3:function(){return u},rf:function(){return d},xu:function(){return o}});var r=n(6810),i=n(4885);class o{constructor(e=0,t=0,n=0,r=0){this.x=e,this.y=t,this.w=n,this.h=r}x=0;y=0;w=0;h=0;get point(){return new r.B(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new r.B(this.midX,this.midY)}set center(e){this.minX=e.x-this.width/2,this.minY=e.y-this.height/2}get corners(){return[new r.B(this.minX,this.minY),new r.B(this.maxX,this.minY),new r.B(this.maxX,this.maxY),new r.B(this.minX,this.maxY)]}get snapPoints(){return[new r.B(this.minX,this.minY),new r.B(this.maxX,this.minY),new r.B(this.maxX,this.maxY),new r.B(this.minX,this.maxY),this.center]}get sides(){let{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new r.B(this.w,this.h)}toFixed(){return this.x=(0,i.Zd)(this.x),this.y=(0,i.Zd)(this.y),this.w=(0,i.Zd)(this.w),this.h=(0,i.Zd)(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,t=0,n=0,r=0){return this.x=e,this.y=t,this.w=n,this.h=r,this}expand(e){let t=Math.min(this.minX,e.minX),n=Math.min(this.minY,e.minY),r=Math.max(this.maxX,e.maxX),i=Math.max(this.maxY,e.maxY);return this.x=t,this.y=n,this.w=r-t,this.h=i-n,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=2*e,this.h+=2*e,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){let{x:e,y:t,w:n,h:r}=this;return new o(e,t,n,r)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){let t=Math.round(this.minX/e)*e,n=Math.round(this.minY/e)*e,r=Math.round(this.maxX/e)*e,i=Math.round(this.maxY/e)*e;this.minX=t,this.minY=n,this.width=Math.max(1,r-t),this.height=Math.max(1,i-n)}collides(e){return o.Collides(this,e)}contains(e){return o.Contains(this,e)}includes(e){return o.Includes(this,e)}containsPoint(e,t=0){return o.ContainsPoint(this,e,t)}getHandlePoint(e){switch(e){case"top_left":return new r.B(this.minX,this.minY);case"top_right":return new r.B(this.maxX,this.minY);case"bottom_left":return new r.B(this.minX,this.maxY);case"bottom_right":return new r.B(this.maxX,this.maxY);case"top":return new r.B(this.midX,this.minY);case"right":return new r.B(this.maxX,this.midY);case"bottom":return new r.B(this.midX,this.maxY);case"left":return new r.B(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(e,t,n){let{minX:r,minY:i,maxX:o,maxY:s}=this,{minX:a,minY:l,maxX:c,maxY:u}=this;switch(e){case"left":case"top_left":case"bottom_left":a+=t;break;case"right":case"top_right":case"bottom_right":c+=t}switch(e){case"top":case"top_left":case"top_right":l+=n;break;case"bottom":case"bottom_left":case"bottom_right":u+=n}let d=(u-l)/(s-i);if((c-a)/(o-r)<0){let e=c;c=a,a=e}if(d<0){let e=u;u=l,l=e}this.minX=a,this.minY=l,this.width=Math.abs(c-a),this.height=Math.abs(u-l)}union(e){let t=Math.min(this.minX,e.x),n=Math.min(this.minY,e.y),r=Math.max(this.maxX,e.w+e.x),i=Math.max(this.maxY,e.h+e.y);return this.x=t,this.y=n,this.width=r-t,this.height=i-n,this}static From(e){return new o(e.x,e.y,e.w,e.h)}static FromCenter(e,t){return new o(e.x-t.x/2,e.y-t.y/2,t.x,t.y)}static FromPoints(e){let t;if(0===e.length)return new o;let n=1/0,r=1/0,i=-1/0,s=-1/0;for(let o=0,a=e.length;o<a;o++)n=Math.min((t=e[o]).x,n),r=Math.min(t.y,r),i=Math.max(t.x,i),s=Math.max(t.y,s);return new o(n,r,i-n,s-r)}static Expand(e,t){let n=Math.min(t.minX,e.minX),r=Math.min(t.minY,e.minY);return new o(n,r,Math.max(t.maxX,e.maxX)-n,Math.max(t.maxY,e.maxY)-r)}static ExpandBy(e,t){return new o(e.minX-t,e.minY-t,e.width+2*t,e.height+2*t)}static Collides=(e,t)=>!(e.maxX<t.minX||e.minX>t.maxX||e.maxY<t.minY||e.minY>t.maxY);static Contains=(e,t)=>e.minX<t.minX&&e.minY<t.minY&&e.maxY>t.maxY&&e.maxX>t.maxX;static Includes=(e,t)=>o.Collides(e,t)||o.Contains(e,t);static ContainsPoint=(e,t,n=0)=>!(t.x<e.minX-n||t.y<e.minY-n||t.x>e.maxX+n||t.y>e.maxY+n);static Common=e=>{let t=1/0,n=1/0,r=-1/0,i=-1/0;for(let o=0;o<e.length;o++){let s=e[o];t=Math.min(t,s.minX),n=Math.min(n,s.minY),r=Math.max(r,s.maxX),i=Math.max(i,s.maxY)}return new o(t,n,r-t,i-n)};static Sides=(e,t=0)=>{let{corners:n}=e;return[[n[0],n[1]],[n[1],n[2]],[n[2],n[3]],[n[3],n[0]]]};static Resize(e,t,n,r,i=!1){let{minX:s,minY:a,maxX:l,maxY:c}=e,{minX:u,minY:d,maxX:h,maxY:p}=e;switch(t){case"left":case"top_left":case"bottom_left":u+=n;break;case"right":case"top_right":case"bottom_right":h+=n}switch(t){case"top":case"top_left":case"top_right":d+=r;break;case"bottom":case"bottom_left":case"bottom_right":p+=r}let f=(h-u)/(l-s),g=(p-d)/(c-a);if(i){let e=(l-s)/(c-a),n=Math.abs(h-u),r=Math.abs(p-d),i=n*(g<0?1:-1)*(1/e),o=r*(f<0?1:-1)*e,m=e<n/r;switch(t){case"top_left":m?d=p+i:u=h+o;break;case"top_right":m?d=p+i:h=u-o;break;case"bottom_right":m?p=d-i:h=u-o;break;case"bottom_left":m?p=d-i:u=h+o;break;case"bottom":case"top":{let t=(u+h)/2,n=r*e;u=t-n/2,h=t+n/2;break}case"left":case"right":{let t=(d+p)/2,r=n/e;d=t-r/2,p=t+r/2}}}if(f<0){let e=h;h=u,u=e}if(g<0){let e=p;p=d,d=e}let m=new o(u,d,Math.abs(h-u),Math.abs(p-d));return{box:m,scaleX:+(m.width/e.width*(f>0?1:-1)).toFixed(5),scaleY:+(m.height/e.height*(g>0?1:-1)).toFixed(5)}}equals(e){return o.Equals(this,e)}static Equals(e,t){return t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new o(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}}function s(e){switch(e){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return e}}function a(e){switch(e){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return e}}let l=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function c(e,t){let n=Math.round((t%=i.yo)/(i.PI/4)),r=l.indexOf(e);return l[(r+n)%l.length]}function u(e){return"top_left"===e||"top_right"===e||"bottom_right"===e||"bottom_left"===e}let d={top_left_rotate:"top_left",top_right_rotate:"top_right",bottom_right_rotate:"bottom_right",bottom_left_rotate:"bottom_left",mobile_rotate:"top_left"}},7802:function(e,t,n){"use strict";n.d(t,{_:function(){return s}});var r=n(1334),i=n(4885),o=n(6810);class s{constructor(e,t,n,r,i,o){this.a=e,this.b=t,this.c=n,this.d=r,this.e=i,this.f=o}a=1;b=0;c=0;d=1;e=0;f=0;equals(e){return this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){let{a:t,b:n,c:r,d:i,e:o,f:s}=this;return this.a=t*e.a+r*e.b,this.c=t*e.c+r*e.d,this.e=t*e.e+r*e.f+o,this.b=n*e.a+i*e.b,this.d=n*e.c+i*e.d,this.f=n*e.e+i*e.f+s,this}rotate(e,t,n){return 0===e?this:void 0===t?this.multiply(s.Rotate(e)):this.translate(t,n).multiply(s.Rotate(e)).translate(-t,-n)}translate(e,t){return this.multiply(s.Translate(e,t))}scale(e,t){return this.multiply(s.Scale(e,t))}invert(){let{a:e,b:t,c:n,d:r,e:i,f:o}=this,s=e*r-t*n;return this.a=r/s,this.b=-(t/s),this.c=-(n/s),this.d=e/s,this.e=-((r*i-n*o)/s),this.f=(t*i-e*o)/s,this}applyToPoint(e){return s.applyToPoint(this,e)}applyToPoints(e){return s.applyToPoints(this,e)}rotation(){return s.Rotation(this)}point(){return s.Point(this)}decomposed(){return s.Decompose(this)}toCssString(){return s.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return s.Decompose(this)}clone(){return new s(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new s(1,0,0,1,0,0)}static Translate(e,t){return new s(1,0,0,1,e,t)}static Rotate(e,t,n){if(0===e)return s.Identity();let r=Math.cos(e),i=Math.sin(e),o=new s(r,i,-i,r,0,0);return void 0===t?o:s.Compose(s.Translate(t,n),o,s.Translate(-t,-n))}static Scale=(e,t,n,r)=>{let i=new s(e,0,0,t,0,0);return void 0===n?i:s.Compose(s.Translate(n,r),i,s.Translate(-n,-r))};static Multiply(e,t){return{a:e.a*t.a+e.c*t.b,c:e.a*t.c+e.c*t.d,e:e.a*t.e+e.c*t.f+e.e,b:e.b*t.a+e.d*t.b,d:e.b*t.c+e.d*t.d,f:e.b*t.e+e.d*t.f+e.f}}static Inverse(e){let t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:-(e.b/t),c:-(e.c/t),d:e.a/t,e:-((e.d*e.e-e.c*e.f)/t),f:(e.b*e.e-e.a*e.f)/t}}static Absolute(e){let t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:-(e.b/t),c:-(e.c/t),d:e.a/t,e:(e.d*e.e-e.c*e.f)/t,f:-((e.b*e.e-e.a*e.f)/t)}}static Compose(...e){let t=s.Identity();for(let n=0,r=e.length;n<r;n++)t.multiply(e[n]);return t}static Point(e){return new o.B(e.e,e.f)}static Rotation(e){let t;if(0!==e.a||0!==e.c){let n=Math.hypot(e.a,e.c);t=Math.acos(e.a/n)*(e.c>0?-1:1)}else if(0!==e.b||0!==e.d){let n=Math.hypot(e.b,e.d);t=i.pj+Math.acos(e.b/n)*(e.d>0?-1:1)}else t=0;return(0,i.Ci)(t)}static Decompose(e){let t,n,r;if(0!==e.a||0!==e.c){let i=Math.hypot(e.a,e.c);t=i,n=(e.a*e.d-e.b*e.c)/i,r=Math.acos(e.a/i)*(e.c>0?-1:1)}else if(0!==e.b||0!==e.d){let o=Math.hypot(e.b,e.d);t=(e.a*e.d-e.b*e.c)/o,n=o,r=i.pj+Math.acos(e.b/o)*(e.d>0?-1:1)}else t=0,n=0,r=0;return{x:e.e,y:e.f,scaleX:t,scaleY:n,rotation:(0,i.Ci)(r)}}static Smooth(e,t=1e10){return e.a=Math.round(e.a*t)/t,e.b=Math.round(e.b*t)/t,e.c=Math.round(e.c*t)/t,e.d=Math.round(e.d*t)/t,e.e=Math.round(e.e*t)/t,e.f=Math.round(e.f*t)/t,e}static toCssString(e){return`matrix(${(0,i.$Z)(e.a)}, ${(0,i.$Z)(e.b)}, ${(0,i.$Z)(e.c)}, ${(0,i.$Z)(e.d)}, ${(0,i.$Z)(e.e)}, ${(0,i.$Z)(e.f)})`}static applyToPoint(e,t){return new o.B(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z)}static applyToXY(e,t,n){return[e.a*t+e.c*n+e.e,e.b*t+e.d*n+e.f]}static applyToPoints(e,t){return t.map(t=>new o.B(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z))}static applyToBounds(e,t){return new r.xu(e.e+t.minX,e.f+t.minY,t.width,t.height)}static From(e){return new s(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof s?e:s.From(e)}}},6810:function(e,t,n){"use strict";n.d(t,{B:function(){return i}});var r=n(4085);class i{constructor(e=0,t=0,n=1){this.x=e,this.y=t,this.z=n}get pressure(){return this.z}set(e=this.x,t=this.y,n=this.z){return this.x=e,this.y=t,this.z=n,this}setTo({x:e=0,y:t=0,z:n=1}){return this.x=e,this.y=t,this.z=n,this}rot(e){if(0===e)return this;let{x:t,y:n}=this,r=Math.sin(e),i=Math.cos(e);return this.x=t*i-n*r,this.y=t*r+n*i,this}rotWith(e,t){if(0===t)return this;let n=this.x-e.x,r=this.y-e.y,i=Math.sin(t),o=Math.cos(t);return this.x=e.x+(n*o-r*i),this.y=e.y+(n*i+r*o),this}clone(){let{x:e,y:t,z:n}=this;return new i(e,t,n)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,t){return this.x-=e,this.y-=t,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,t){return this.x+=e,this.y+=t,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,t){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),void 0!==t&&(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,t){let n=i.Tan(e,this);return this.add(n.mul(t))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return i.Dpr(this,e)}cpr(e){return i.Cpr(this,e)}len2(){return i.Len2(this)}len(){return i.Len(this)}pry(e){return i.Pry(this,e)}per(){let{x:e,y:t}=this;return this.x=t,this.y=-e,this}uni(){return i.Uni(this)}tan(e){return i.Tan(this,e)}dist(e){return i.Dist(this,e)}distanceToLineSegment(e,t){return i.DistanceToLineSegment(e,t,this)}slope(e){return i.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return i.Angle(this,e)}toAngle(){return i.ToAngle(this)}lrp(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this}equals(e){return i.Equals(this,e)}equalsXY(e,t){return i.EqualsXY(this,e,t)}norm(){let e=this.len();return this.x=0===e?0:this.x/e,this.y=0===e?0:this.y/e,this}toFixed(){return i.ToFixed(this)}toString(){return i.ToString(i.ToFixed(this))}toJson(){return i.ToJson(this)}toArray(){return i.ToArray(this)}static Add(e,t){return new i(e.x+t.x,e.y+t.y)}static AddXY(e,t,n){return new i(e.x+t,e.y+n)}static Sub(e,t){return new i(e.x-t.x,e.y-t.y)}static SubXY(e,t,n){return new i(e.x-t,e.y-n)}static AddScalar(e,t){return new i(e.x+t,e.y+t)}static SubScalar(e,t){return new i(e.x-t,e.y-t)}static Div(e,t){return new i(e.x/t,e.y/t)}static Mul(e,t){return new i(e.x*t,e.y*t)}static DivV(e,t){return new i(e.x/t.x,e.y/t.y)}static MulV(e,t){return new i(e.x*t.x,e.y*t.y)}static Neg(e){return new i(-e.x,-e.y)}static Per(e){return new i(e.y,-e.x)}static Dist2(e,t){return i.Sub(e,t).len2()}static Abs(e){return new i(Math.abs(e.x),Math.abs(e.y))}static Dist(e,t){return Math.hypot(e.y-t.y,e.x-t.x)}static Dpr(e,t){return e.x*t.x+e.y*t.y}static Cross(e,t){return new i(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z)}static Cpr(e,t){return e.x*t.y-t.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return Math.hypot(e.x,e.y)}static Pry(e,t){return i.Dpr(e,t)/i.Len(t)}static Uni(e){return i.Div(e,i.Len(e))}static Tan(e,t){return i.Uni(i.Sub(e,t))}static Min(e,t){return new i(Math.min(e.x,t.x),Math.min(e.y,t.y))}static Max(e,t){return new i(Math.max(e.x,t.x),Math.max(e.y,t.y))}static From({x:e,y:t,z:n=1}){return new i(e,t,n)}static FromArray(e){return new i(e[0],e[1])}static Rot(e,t=0){let n=Math.sin(t),r=Math.cos(t);return new i(e.x*r-e.y*n,e.x*n+e.y*r)}static RotWith(e,t,n){let r=e.x-t.x,o=e.y-t.y,s=Math.sin(n),a=Math.cos(n);return new i(t.x+(r*a-o*s),t.y+(r*s+o*a))}static NearestPointOnLineThroughPoint(e,t,n){return i.Mul(t,i.Sub(n,e).pry(t)).add(e)}static NearestPointOnLineSegment(e,t,n,r=!0){let o=i.Tan(t,e),s=i.Add(e,i.Mul(o,i.Sub(n,e).pry(o)));if(r){if(s.x<Math.min(e.x,t.x))return i.Cast(e.x<t.x?e:t);if(s.x>Math.max(e.x,t.x))return i.Cast(e.x>t.x?e:t);if(s.y<Math.min(e.y,t.y))return i.Cast(e.y<t.y?e:t);if(s.y>Math.max(e.y,t.y))return i.Cast(e.y>t.y?e:t)}return s}static DistanceToLineThroughPoint(e,t,n){return i.Dist(n,i.NearestPointOnLineThroughPoint(e,t,n))}static DistanceToLineSegment(e,t,n,r=!0){return i.Dist(n,i.NearestPointOnLineSegment(e,t,n,r))}static Snap(e,t=1){return new i(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}static Cast(e){return e instanceof i?e:i.From(e)}static Slope(e,t){return e.x===t.y?NaN:(e.y-t.y)/(e.x-t.x)}static Angle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}static Lrp(e,t,n){return i.Sub(t,e).mul(n).add(e)}static Med(e,t){return new i((e.x+t.x)/2,(e.y+t.y)/2)}static Equals(e,t){return 1e-4>Math.abs(e.x-t.x)&&1e-4>Math.abs(e.y-t.y)}static EqualsXY(e,t,n){return e.x===t&&e.y===n}static Clockwise(e,t,n){return(n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y)<0}static Rescale(e,t){let n=i.Len(e);return new i(t*e.x/n,t*e.y/n)}static ScaleWithOrigin(e,t,n){return i.Sub(e,n).mul(t).add(n)}static ToFixed(e,t=2){return new i(+e.x.toFixed(t),+e.y.toFixed(t),+e.z.toFixed(t))}static Nudge(e,t,n){return i.Add(e,i.Tan(t,e).mul(n))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let t=Math.atan2(e.y,e.x);return t<0&&(t+=2*Math.PI),t}static FromAngle(e,t=1){return new i(Math.cos(e)*t,Math.sin(e)*t)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){let{x:t,y:n,z:r}=e;return{x:t,y:n,z:r}}static Average(e){let t=e.length,n=new i(0,0);for(let r=0;r<t;r++)n.add(e[r]);return n.div(t)}static Clamp(e,t,n){return void 0===n?new i(Math.min(Math.max(e.x,t)),Math.min(Math.max(e.y,t))):new i(Math.min(Math.max(e.x,t),n),Math.min(Math.max(e.y,t),n))}static PointsBetween(e,t,n=6){let s=[];for(let a=0;a<n;a++){let l=r.L.easeInQuad(a/(n-1)),c=i.Lrp(e,t,l);c.z=Math.min(1,.5+.65*Math.abs(.5-o(l))),s.push(c)}return s}static SnapToGrid(e,t=8){return new i(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}}let o=e=>e<.5?2*e*e:-1+(4-2*e)*e},4085:function(e,t,n){"use strict";n.d(t,{L:function(){return r}});let r={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>e*(2-e),easeInOutQuad:e=>e<.5?2*e*e:-1+(4-2*e)*e,easeInCubic:e=>e*e*e,easeOutCubic:e=>--e*e*e+1,easeInOutCubic:e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1- --e*e*e*e,easeInOutQuart:e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1+--e*e*e*e*e,easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInExpo:e=>e<=0?0:Math.pow(2,10*e-10),easeOutExpo:e=>e>=1?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>e<=0?0:e>=1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2}},9528:function(e,t,n){"use strict";n.d(t,{W:function(){return s}});var r=n(6810),i=n(9320),o=n(6e3);class s extends o.l{start;end;d;u;ul;constructor(e){super({...e,isClosed:!1,isFilled:!1});let{start:t,end:n}=e;this.start=t,this.end=n,this.d=t.clone().sub(n),this.u=this.d.clone().uni(),this.ul=this.u.len()}_length;get length(){return this._length?this._length:this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(e){let{start:t,end:n,u:i,ul:o}=this;if(0===o)return t;let s=r.B.Sub(e,t).dpr(i)/o,a=t.x+i.x*s;if(a<Math.min(t.x,n.x))return t.x<n.x?t:n;if(a>Math.max(t.x,n.x))return t.x>n.x?t:n;let l=t.y+i.y*s;return l<Math.min(t.y,n.y)?t.y<n.y?t:n:l>Math.max(t.y,n.y)?t.y>n.y?t:n:new r.B(a,l)}hitTestLineSegment(e,t,n){return(0,i.cB)(e,t,this.start,this.end)}}},6e3:function(e,t,n){"use strict";n.d(t,{l:function(){return s}});var r=n(1334),i=n(6810),o=n(4885);class s{isFilled=!1;isClosed=!0;isLabel=!1;isSnappable=!0;debugColor;ignore;constructor(e){this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.isSnappable=e.isSnappable??!1,this.isLabel=e.isLabel??!1,this.debugColor=e.debugColor,this.ignore=e.ignore}hitTestPoint(e,t=0,n=!1){return this.distanceToPoint(e,n)<=t}distanceToPoint(e,t=!1){let n=e.dist(this.nearestPoint(e));return this.isClosed&&(this.isFilled||t)&&(0,o.Of)(e,this.vertices)?-n:n}distanceToLineSegment(e,t){let n=this.nearestPointOnLineSegment(e,t),r=i.B.DistanceToLineSegment(e,t,n);return this.isClosed&&this.isFilled&&(0,o.Of)(n,this.vertices)?-r:r}hitTestLineSegment(e,t,n=0){return this.distanceToLineSegment(e,t)<=n}nearestPointOnLineSegment(e,t){let n,r=1/0;for(let o=0;o<this.vertices.length;o++){let s=this.vertices[o],a=i.B.DistanceToLineSegment(e,t,s);a<r&&(r=a,n=s)}if(!n)throw Error("nearest point not found");return n}isPointInBounds(e,t=0){let{bounds:n}=this;return!(e.x<n.minX-t||e.y<n.minY-t||e.x>n.maxX+t||e.y>n.maxY+t)}_vertices;get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return r.xu.FromPoints(this.vertices)}_bounds;get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}_snapPoints;get snapPoints(){return this._snapPoints||(this._snapPoints=this.bounds.snapPoints),this._snapPoints}get center(){return this.bounds.center}_area;get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;let{vertices:e}=this,t=0;for(let n=0,r=e.length;n<r;n++){let i=e[n],o=e[(n+1)%r];t+=i.x*o.y-o.x*i.y}return t/2}toSimpleSvgPath(){let e="",{vertices:t}=this,n=t.length;if(0===n)return e;e+=`M${t[0].x},${t[0].y}`;for(let r=1;r<n;r++)e+=`L${t[r].x},${t[r].y}`;return this.isClosed&&(e+="Z"),e}}},3072:function(e,t,n){"use strict";n.d(t,{m:function(){return o}});var r=n(1334),i=n(6e3);class o extends i.l{children=[];ignoredChildren=[];constructor(e){for(let t of(super({...e,isClosed:!0,isFilled:!1}),e.children))t.ignore?this.ignoredChildren.push(t):this.children.push(t);if(0===this.children.length)throw Error("Group2d must have at least one child")}getVertices(){return this.children.filter(e=>!e.isLabel).flatMap(e=>e.vertices)}nearestPoint(e){let t,n=1/0,{children:r}=this;if(0===r.length)throw Error("no children");for(let i of r){let r=i.nearestPoint(e),o=r.dist(e);o<n&&(n=o,t=r)}if(!t)throw Error("nearest point not found");return t}distanceToPoint(e,t=!1){return Math.min(...this.children.map((n,r)=>n.distanceToPoint(e,t||r>0)))}hitTestPoint(e,t,n){return!!this.children.filter(e=>!e.isLabel).find(r=>r.hitTestPoint(e,t,n))}hitTestLineSegment(e,t,n){return!!this.children.filter(e=>!e.isLabel).find(r=>r.hitTestLineSegment(e,t,n))}getArea(){return this.children[0].area}toSimpleSvgPath(){let e="";for(let t of this.children)e+=t.toSimpleSvgPath();let t=r.xu.FromPoints(this.vertices).corners;for(let n=0,r=t.length;n<r;n++){let i=t[n],o=t[(n-1+r)%r],s=i.dist(o),a=t[(n+1)%r],l=i.dist(a),c=i.clone().lrp(o,4/s),u=i.clone().lrp(a,4/l);e+=`M${c.x},${c.y} L${i.x},${i.y} L${u.x},${u.y} `}return e}}},8974:function(e,t,n){"use strict";n.d(t,{w:function(){return i}});var r=n(2287);class i extends r.q{constructor(e){super({...e}),this.isClosed=!0}}},2287:function(e,t,n){"use strict";n.d(t,{q:function(){return o}});var r=n(9528),i=n(6e3);class o extends i.l{points;constructor(e){super({isClosed:!1,isFilled:!1,...e});let{points:t}=e;this.points=t}_segments;get segments(){if(!this._segments){this._segments=[];let{vertices:e}=this;for(let t=0,n=e.length-1;t<n;t++){let n=e[t],i=e[t+1];this._segments.push(new r.W({start:n,end:i}))}this.isClosed&&this._segments.push(new r.W({start:e[e.length-1],end:e[0]}))}return this._segments}_length;get length(){return this._length||(this._length=this.segments.reduce((e,t)=>e+t.length,0)),this._length}getVertices(){return this.points}nearestPoint(e){let t,n;let{segments:r}=this,i=this.points[0],o=1/0;for(let s=0;s<r.length;s++)(n=(t=r[s].nearestPoint(e)).dist(e))<o&&(i=t,o=n);return i}hitTestLineSegment(e,t,n){return this.segments.some(r=>r.hitTestLineSegment(e,t,n))}}},737:function(e,t,n){"use strict";n.d(t,{z:function(){return s}});var r=n(1334),i=n(6810),o=n(8974);class s extends o.w{x;y;w;h;constructor(e){let{x:t=0,y:n=0,width:r,height:o}=e;super({...e,points:[new i.B(t,n),new i.B(t+r,n),new i.B(t+r,n+o),new i.B(t,n+o)]}),this.x=t,this.y=n,this.w=r,this.h=o}getBounds(){return new r.xu(this.x,this.y,this.w,this.h)}}},9320:function(e,t,n){"use strict";n.d(t,{Gc:function(){return a},S3:function(){return h},T9:function(){return o},UQ:function(){return y},XS:function(){return d},ZM:function(){return s},bO:function(){return c},cB:function(){return f},h9:function(){return u},qZ:function(){return l},tY:function(){return g}});var r=n(4885),i=n(6810);function o(e,t,n,r){let o=e.x-n.x,s=e.y-n.y,a=r.x-n.x,l=r.y-n.y,c=t.x-e.x,u=t.y-e.y,d=a*s-l*o,h=c*s-u*o,p=l*c-a*u;if(0===d||0===h||0===p)return null;if(0!==p){let t=d/p,n=h/p;if(0<=t&&t<=1&&0<=n&&n<=1)return i.B.AddXY(e,t*c,t*u)}return null}function s(e,t,n,r){let o=(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y),s=2*((t.x-e.x)*(e.x-n.x)+(t.y-e.y)*(e.y-n.y)),a=s*s-4*o*(n.x*n.x+n.y*n.y+e.x*e.x+e.y*e.y-2*(n.x*e.x+n.y*e.y)-r*r);if(a<0||0===a)return null;let l=Math.sqrt(a),c=(-s+l)/(2*o),u=(-s-l)/(2*o);if((c<0||c>1)&&(u<0||u>1))return null;let d=[];return(0<=c&&c<=1&&d.push(i.B.Lrp(e,t,c)),0<=u&&u<=1&&d.push(i.B.Lrp(e,t,u)),0===d.length)?null:d}function a(e,t,n){let r;let i=[];for(let s=0,a=n.length-1;s<a;s++)(r=o(e,t,n[s],n[s+1]))&&i.push(r);return 0===i.length?null:i}function l(e,t,n){let r;let i=[];for(let s=1,a=n.length;s<a+1;s++)(r=o(e,t,n[s-1],n[s%n.length]))&&i.push(r);return 0===i.length?null:i}function c(e,t,n,r){let o=n.x-e.x,s=n.y-e.y,a=Math.sqrt(o*o+s*s),l=(a*a-r*r+t*t)/(2*a),c=Math.sqrt(t*t-l*l);return o/=a,s/=a,[new i.B(e.x+o*l-s*c,e.y+s*l+o*c),new i.B(e.x+o*l+s*c,e.y+s*l-o*c)]}function u(e,t,n){let r;let i=[];for(let o=0,a=n.length;o<a;o++)(r=s(n[o],n[(o+1)%n.length],e,t))&&i.push(...r);return 0===i.length?null:i}function d(e,t,n){let r;let i=[];for(let o=1,a=n.length;o<a;o++)(r=s(n[o-1],n[o],e,t))&&i.push(...r);return 0===i.length?null:i}function h(e,t){let n;let r=[];for(let i of t.sides)(n=l(i[0],i[1],e))&&r.push(...n);return 0===r.length?null:r}function p(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function f(e,t,n,r){return p(e,n,r)!==p(t,n,r)&&p(e,t,n)!==p(e,t,r)}function g(e,t){let n,s;let a=new Map;for(let i=0,o=e.length;i<o;i++)if(n=e[i],(0,r.Of)(n,t)){let e=m(n);a.has(e)||a.set(e,n)}for(let i=0,o=t.length;i<o;i++)if(n=t[i],(0,r.Of)(n,e)){let e=m(n);a.has(e)||a.set(e,n)}for(let r=0,i=e.length;r<i;r++){n=e[r],s=e[(r+1)%e.length];for(let e=0,r=t.length;e<r;e++){let r=o(n,s,t[e],t[(e+1)%t.length]);if(null!==r){let e=m(r);a.has(e)||a.set(e,r)}}}return 0===a.size?null:function(e){let t=i.B.Average(e);return e.sort((e,n)=>i.B.Angle(t,e)-i.B.Angle(t,n))}([...a.values()])}function m(e){return`${e.x},${e.y}`}function y(e,t){let n,r;for(let i=0,o=e.length;i<o;i++){n=e[i],r=e[(i+1)%o];for(let e=0,i=t.length;e<i;e++)if(f(n,r,t[e],t[(e+1)%i]))return!0}return!1}},4885:function(e,t,n){"use strict";n.d(t,{$Z:function(){return j},AV:function(){return M},C2:function(){return h},Ci:function(){return b},D4:function(){return $},FH:function(){return I},Ht:function(){return v},Oe:function(){return _},Of:function(){return T},PI:function(){return s},Rp:function(){return p},VK:function(){return g},XD:function(){return k},Y8:function(){return o},Yk:function(){return i},Z7:function(){return y},Zd:function(){return d},_G:function(){return x},dv:function(){return c},ep:function(){return E},f5:function(){return f},mR:function(){return A},mW:function(){return C},nD:function(){return w},pc:function(){return m},pj:function(){return a},rW:function(){return O},uZ:function(){return u},vi:function(){return S},yo:function(){return l}});var r=n(6810);function i(e){return`${j(e.x)},${j(e.y)} `}function o(e,t){return`${j((e.x+t.x)/2)},${j((e.y+t.y)/2)} `}let s=Math.PI,a=s/2,l=2*s,c=Math.sin;function u(e,t,n){return Math.max(t,void 0!==n?Math.min(e,n):e)}function d(e,t=1e10){return e?Math.round(e*t)/t:0}function h(e,t,n=1e-6){return Math.abs(e-t)<=n}function p(e,t){let n=Math.pow(e-t,2)/Math.pow(e+t,2);return s*(e+t)*(1+3*n/(10+Math.sqrt(4-3*n)))}function f(e){return(e%=l)<0?e+=l:0===e&&(e=0),e}function g(e,t){return(e=f(e))>(t=f(t))&&(t+=l),t-e}function m(e,t){return l-g(e,t)}function y(e,t){let n=(t-e)%l;return 2*n%l-n}function b(e){return(l+e)%l}function w(e,t){let n=l/t,r=Math.floor((b(e)+n/2)/n)*n%l;return r<s&&(r+=l),r>s&&(r-=l),r}function x(e,t){return e===t||h(e%(Math.PI/2)-t%(Math.PI/2),0)}function v(e){return e*s/180}function S(e){return 180*e/s}function k(e,t,n){return new r.B(e.x,e.y).add(r.B.FromAngle(n,t))}function _(e,t,n){let i=e/2,o=t/2,s=[],c=1/0,u=-1/0,d=1/0,h=-1/0;for(let e=0;e<n;e++){let t=-a+l/n*e,p=i+i*Math.cos(t),f=o+o*Math.sin(t);p<c&&(c=p),f<d&&(d=f),p>u&&(u=p),f>h&&(h=f),s.push(new r.B(p,f))}let p=u-c,f=h-d;if(0!=e-p||0!=t-f)for(let n=0;n<s.length;n++){let r=s[n];r.x=(r.x-c)/p*e,r.y=(r.y-d)/f*t}return s}function E(e,t,n,r){return e<r&&n<t}function C(e,t,n,r){let i=Math.max(e,n),o=Math.min(t,r);return i<=o?[i,o]:null}function P(e,t,n){return(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y)}function T(e,t){let n,i,o=0;for(let s=0;s<t.length;s++){if((n=t[s]).x===e.x&&n.y===e.y||(i=t[(s+1)%t.length],r.B.Dist(e,n)+r.B.Dist(e,i)===r.B.Dist(n,i)))return!0;n.y<=e.y?i.y>e.y&&P(n,i,e)>0&&(o+=1):i.y<=e.y&&0>P(n,i,e)&&(o-=1)}return 0!==o}function j(e){return+e.toFixed(4)}function I(e){return+e.toFixed(2)}let M=e=>Math.abs(e)<Number.MAX_SAFE_INTEGER;function A(e,t,n){return n<0?g(e,t):m(e,t)}function O(e,t,n,r){let i;if(Math.abs(e)>s){i=y(t,r);let o=y(r,n);return Math.abs(i)<Math.abs(o)?i/e:(e-o)/e}{let n=(i=y(t,r))/e;return Math.sign(i)!==Math.sign(e)?Math.abs(n)>.5?1:0:n}}function $(e,t,n,r){let i=(t-e)%l*2%l-(t-e)%l;return r?(l-Math.abs(i))*(n?1:-1):i}},8642:function(e,t,n){"use strict";n.d(t,{_:function(){return o},o:function(){return s}});var r=n(2302);function i(e,t){if(!t)return!1;switch(e.type){case"mixed":return"mixed"===t.type;case"shared":return"shared"===t.type&&e.value===t.value;default:throw(0,r.iP)(e)}}class o{map;constructor(e){this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){let t=this.get(e);if(t&&"mixed"!==t.type)return t.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;let t=new Set;for(let[n,r]of this){if(!i(r,e.get(n)))return!1;t.add(n)}for(let[n,r]of e)if(!t.has(n)&&!i(r,this.get(n)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class s extends o{set(e,t){this.map.set(e,t)}applyValue(e,t){let n=this.get(e);if(!n){this.set(e,{type:"shared",value:t});return}switch(n.type){case"mixed":return;case"shared":n.value!==t&&this.set(e,{type:"mixed"});return;default:(0,r.iP)(n,"type")}}}},3595:function(e,t,n){"use strict";n.d(t,{_:function(){return r}});class r{items=new WeakMap;get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}access(e){return this.items.get(e)}set(e,t){this.items.set(e,t)}has(e){return this.items.has(e)}invalidate(e){this.items.delete(e)}bust(){this.items=new WeakMap}}},8504:function(e,t,n){"use strict";function r(e,t,n){return fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return new File([e],t,{type:n})})}n.d(t,{B:function(){return r}})},6132:function(e,t,n){"use strict";function r(e,t){let n=e,r=new Set(t);for(;r.has(n);)n=/^.*(\d+)$/.exec(n)?.[1]?n.replace(/(\d+)(?=\D?)$/,e=>(+e+1).toString()):`${n} 1`;return n}n.d(t,{u:function(){return r}})},2695:function(e,t,n){"use strict";n.d(t,{B:function(){return o}});var r=n(2302),i=n(6763);function o(e,t,n){if(0===n.length)return[];let o=new Map;for(let t of(0,r.oA)(n.map(t=>e.getShape(t)))){let{parentId:n}=t;o.has(n)||o.set(n,{children:(0,r.oA)(e.getSortedChildIdsForParent(n).map(t=>e.getShape(t))),moving:new Set}),o.get(n).moving.add(t)}let s=[];switch(t){case"toBack":o.forEach(({moving:e,children:t})=>(function(e,t,n){let r,o;let s=t.length;if(e.size!==s){for(let n=0;n<s;n++){let i=t[n];if(e.has(i))r=i.index,e.delete(i);else{o=i.index;break}}if(0===e.size)return;{let t=(0,i.Xv)(r,o,e.size);n.push(...Array.from(e.values()).sort(i.hl).map((e,n)=>({...e,index:t[n]})))}}})(e,t,s));break;case"toFront":o.forEach(({moving:e,children:t})=>(function(e,t,n){let r,o;let s=t.length;if(e.size!==s){for(let n=s-1;n>-1;n--){let i=t[n];if(e.has(i))o=i.index,e.delete(i);else{r=i.index;break}}if(0===e.size)return;{let t=(0,i.Xv)(r,o,e.size);n.push(...Array.from(e.values()).sort(i.hl).map((e,n)=>({...e,index:t[n]})))}}})(e,t,s));break;case"forward":o.forEach(({moving:e,children:t})=>(function(e,t,n){let r=t.length;if(e.size===r)return;let o={name:"skipping"};for(let s=0;s<r;s++){let r=e.has(t[s]);switch(o.name){case"skipping":if(!r)continue;o={name:"selecting",selectIndex:s};break;case"selecting":{if(r)continue;let{selectIndex:e}=o;(0,i.Xv)(t[s].index,t[s+1]?.index,s-e).forEach((r,i)=>n.push({...t[e+i],index:r})),o={name:"skipping"}}}}})(e,t,s));break;case"backward":o.forEach(({moving:e,children:t})=>(function(e,t,n){let r=t.length;if(e.size===r)return;let o={name:"skipping"};for(let s=r-1;s>-1;s--){let r=e.has(t[s]);switch(o.name){case"skipping":if(!r)continue;o={name:"selecting",selectIndex:s};break;case"selecting":if(r)continue;(0,i.Xv)(t[s-1]?.index,t[s].index,o.selectIndex-s).forEach((e,r)=>{n.push({...t[s+r+1],index:e})}),o={name:"skipping"}}}})(e,t,s))}return s}},6763:function(e,t,n){"use strict";n.d(t,{_L:function(){return b},Xg:function(){return w},eI:function(){return y},H$:function(){return x},vw:function(){return g},dk:function(){return m},Xv:function(){return f},hl:function(){return v}});let r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",i="A00000000000000000000000000";function o(e){if(e>="a"&&e<="z")return e.charCodeAt(0)-97+2;if(e>="A"&&e<="Z")return 90-e.charCodeAt(0)+2;throw Error("Invalid index key head: "+e)}function s(e){if(e.length!==o(e.charAt(0)))throw Error("invalid integer part of index key: "+e)}function a(e){if(void 0===e)throw Error("n is undefined")}function l(e){s(e);let[t,...n]=e.split(""),i=!0;for(let e=n.length-1;i&&e>=0;e--){let t=r.indexOf(n[e])+1;t===r.length?n[e]="0":(n[e]=r.charAt(t),i=!1)}if(!i)return t+n.join("");{if("Z"===t)return"a0";if("z"===t)return;let e=String.fromCharCode(t.charCodeAt(0)+1);return e>"a"?n.push("0"):n.pop(),e+n.join("")}}function c(e,t){if(void 0!==t&&e>=t)throw Error(e+" >= "+t);if("0"===e.slice(-1)||t&&"0"===t.slice(-1))throw Error("trailing zero");if(t){let n=0;for(;(e.charAt(n)||"0")===t.charAt(n);)n++;if(n>0)return t.slice(0,n)+c(e.slice(n),t.slice(n))}let n=e?r.indexOf(e.charAt(0)):0,i=void 0!==t?r.indexOf(t.charAt(0)):r.length;return i-n>1?r.charAt(Math.round(.5*(n+i))):t&&t.length>1?t.slice(0,1):r.charAt(n)+c(e.slice(1),void 0)}function u(e){let t=o(e.charAt(0));if(t>e.length)throw Error("invalid index: "+e);return e.slice(0,t)}function d(e){if(e===i)throw Error("invalid index: "+e);let t=u(e);if("0"===e.slice(t.length).slice(-1))throw Error("invalid index: "+e)}function h(e,t){if(void 0!==e&&d(e),void 0!==t&&d(t),void 0!==e&&void 0!==t&&e>=t)throw Error(e+" >= "+t);if(void 0===e&&void 0===t)return"a0";if(void 0===e){if(void 0===t)throw Error("b is undefined");let e=u(t),n=t.slice(e.length);if(e===i)return e+c("",n);if(e<t)return e;let o=function(e){s(e);let[t,...n]=e.split(""),i=!0;for(let e=n.length-1;i&&e>=0;e--){let t=r.indexOf(n[e])-1;-1===t?n[e]=r.slice(-1):(n[e]=r.charAt(t),i=!1)}if(!i)return t+n.join("");{if("a"===t)return"Z"+r.slice(-1);if("A"===t)return;let e=String.fromCharCode(t.charCodeAt(0)-1);return e<"Z"?n.push(r.slice(-1)):n.pop(),e+n.join("")}}(e);return a(o),o}if(void 0===t){let t=u(e),n=e.slice(t.length),r=l(t);return void 0===r?t+c(n,void 0):r}let n=u(e),o=e.slice(n.length),h=u(t),p=t.slice(h.length);if(n===h)return n+c(o,p);let f=l(n);return a(f),f<t?f:n+c(o,void 0)}function p(e,t,n){if(0===n)return[];if(1===n)return[h(e,t)];if(void 0===t){let r=h(e,t),i=[r];for(let e=0;e<n-1;e++)i.push(r=h(r,t));return i}if(void 0===e){let r=h(e,t),i=[r];for(let t=0;t<n-1;t++)i.push(r=h(e,r));return i.reverse(),i}let r=Math.floor(n/2),i=h(e,t);return[...p(e,i,r),i,...p(i,t,n-r-1)]}function f(e,t,n){return p(e,t,n)}function g(e,t){return p(e,void 0,t)}function m(e,t){return p(void 0,e,t)}function y(e,t){return p(e,t,1)[0]}function b(e){return p(e,void 0,1)[0]}function w(e){return p(void 0,e,1)[0]}function x(e,t="a1"){return[t,...p(t,void 0,e)]}function v(e,t){return e.index<t.index?-1:e.index>t.index?1:0}},3130:function(e,t,n){"use strict";n.d(t,{Z:function(){return c},o:function(){return l}});var r=n(5895),i=n(2302),o=n(7802),s=n(4885),a=n(6810);function l({editor:e}){let t=e.getSelectedShapes(),n=e.getSelectionRotation(),r=e.getSelectionRotatedPageBounds(),{inputs:{originPagePoint:o}}=e;if(!r)return null;let s=r.center.clone().rotWith(r.point,n);return{selectionPageCenter:s,initialCursorAngle:s.angle(o),initialSelectionRotation:n,shapeSnapshots:t.map(t=>({shape:(0,i.v4)(t),initialPagePoint:e.getShapePageTransform(t.id).point()}))}}function c({delta:e,editor:t,snapshot:n,stage:i}){let{selectionPageCenter:l,shapeSnapshots:c}=n;t.updateShapes(c.map(({shape:n,initialPagePoint:i})=>{let c=(0,r.YT)(n.parentId)?t.getShapePageTransform(n.parentId):o._.Identity(),u=a.B.RotWith(i,l,e),d=o._.applyToPoint(o._.Inverse(c),u),h=(0,s.f5)(n.rotation+e);return{id:n.id,type:n.type,x:d.x,y:d.y,rotation:h}}));let u=[];c.forEach(({shape:e})=>{let n=t.getShape(e.id);if(!n)return;let r=t.getShapeUtil(e);if("start"===i||"one-off"===i){let t=r.onRotateStart?.(e);t&&u.push(t)}let o=r.onRotate?.(e,n);if(o&&u.push(o),"end"===i||"one-off"===i){let t=r.onRotateEnd?.(e,n);t&&u.push(t)}}),u.length>0&&t.updateShapes(u)}},6967:function(e,t,n){"use strict";n.d(t,{E:function(){return i}});let r=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((e,t)=>((t&=63)<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");function i(){return r()}},5801:function(e,t,n){"use strict";function r(e){return e&&"object"==typeof e&&"parents"in e}function i(e){for(let t=0,n=e.parents.length;t<n;t++)if(e.parents[t].__unsafe__getWithoutCapture(),e.parents[t].lastChangedEpoch!==e.parentEpochs[t])return!0;return!1}n.d(t,{LZ:function(){return c},R0:function(){return x},SB:function(){return d},cn:function(){return M},Fl:function(){return F},e1:function(){return $},Ym:function(){return v},zH:function(){return S},j:function(){return W},ay:function(){return T},PS:function(){return P},vc:function(){return Y},BK:function(){return G},vC:function(){return X},uC:function(){return V},Hg:function(){return q},iJ:function(){return b},qo:function(){return D}});let o=(e,t)=>{if(e.children.remove(t)&&e.children.isEmpty&&r(e))for(let t=0,n=e.parents.length;t<n;t++)o(e.parents[t],e)},s=(e,t)=>{if(e.children.add(t)&&r(e))for(let t=0,n=e.parents.length;t<n;t++)s(e.parents[t],e)};function a(e,t){return e===t||Object.is(e,t)||!!(e&&t&&"function"==typeof e.equals&&e.equals(t))}function l(e,t){let n=Symbol.for(`com.tldraw.state/${e}`),r=globalThis;return r[n]??=t(),r[n]}let c=l("empty_array",()=>Object.freeze([]));class u{arraySize=0;array=Array(8);set=null;get isEmpty(){if(this.array)return 0===this.arraySize;if(this.set)return 0===this.set.size;throw Error("no set or array")}add(e){if(this.array)return -1===this.array.indexOf(e)&&(this.arraySize<8?(this.array[this.arraySize]=e,this.arraySize++):(this.set=new Set(this.array),this.array=null,this.set.add(e)),!0);if(this.set)return!this.set.has(e)&&(this.set.add(e),!0);throw Error("no set or array")}remove(e){if(this.array){let t=this.array.indexOf(e);return -1!==t&&(this.array[t]=void 0,this.arraySize--,t!==this.arraySize&&(this.array[t]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return!!this.set.has(e)&&(this.set.delete(e),!0);throw Error("no set or array")}visit(e){if(this.array){for(let t=0;t<this.arraySize;t++){let n=this.array[t];void 0!==n&&e(n)}return}if(this.set){this.set.forEach(e);return}throw Error("no set or array")}}let d=Symbol.for("com.tldraw.state/RESET_VALUE");class h{constructor(e){this.capacity=e,this.buffer=Array(e)}index=0;buffer;pushEntry(e,t,n){if(void 0!==n){if(n===d){this.clear();return}this.buffer[this.index]=[e,t,n],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){let{index:t,capacity:n,buffer:r}=this;for(let i=0;i<n;i++){let o=(t-1+n-i)%n,s=r[o];if(!s)break;let[a,l]=s;if(0===i&&e>=l)return[];if(a<=e&&e<l){let e=i+1,t=Array(e);for(let i=0;i<e;i++)t[i]=r[(o+i)%n][2];return t}}return d}}class p{constructor(e,t){this.below=e,this.child=t}offset=0;numNewParents=0;maybeRemoved}let f=l("capture",()=>({stack:null}));function g(e){f.stack=new p(f.stack,e)}function m(){let e=f.stack;if(f.stack=e.below,e.numNewParents>0||e.offset!==e.child.parents.length){for(let t=e.offset;t<e.child.parents.length;t++){let n=e.child.parents[t];e.child.parents.indexOf(n)>=e.offset&&o(n,e.child)}if(e.child.parents.length=e.offset,e.child.parentEpochs.length=e.offset,f.stack?.maybeRemoved)for(let t=0;t<f.stack.maybeRemoved.length;t++){let n=f.stack.maybeRemoved[t];-1===e.child.parents.indexOf(n)&&o(n,e.child)}}}function y(e){if(f.stack){let t=f.stack.child.parents.indexOf(e);if(t<0&&(f.stack.numNewParents++,f.stack.child.isActivelyListening&&s(e,f.stack.child)),t<0||t>=f.stack.offset){if(t!==f.stack.offset&&t>0){let e=f.stack.child.parents[f.stack.offset];f.stack.maybeRemoved?-1===f.stack.maybeRemoved.indexOf(e)&&f.stack.maybeRemoved.push(e):f.stack.maybeRemoved=[e]}f.stack.child.parents[f.stack.offset]=e,f.stack.child.parentEpochs[f.stack.offset]=e.lastChangedEpoch,f.stack.offset++}}}function b(){let e=f.stack?.child;if(!e)throw Error("whyAmIRunning() called outside of a reactive context");let t=[];for(let n=0;n<e.parents.length;n++){let r=e.parents[n];r.lastChangedEpoch>e.parentEpochs[n]&&t.push(r)}if(0===t.length)console.log(e.name,"is running but none of the parents changed");else for(let n of(console.log(e.name,"is running because:"),t))console.log("	",n.name,"changed =>",n.__unsafe__getWithoutCapture())}class w{constructor(e,t,n){this.name=e,this.runEffect=t,this._scheduleEffect=n?.scheduleEffect}_isActivelyListening=!1;get isActivelyListening(){return this._isActivelyListening}lastTraversedEpoch=-1;lastReactedEpoch=-1;_scheduleCount=0;get scheduleCount(){return this._scheduleCount}parentEpochs=[];parents=[];_scheduleEffect;maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==E()){if(this.parents.length&&!i(this)){this.lastReactedEpoch=E();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}maybeExecute=()=>{this._isActivelyListening&&this.execute()};attach(){this._isActivelyListening=!0;for(let e=0,t=this.parents.length;e<t;e++)s(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,t=this.parents.length;e<t;e++)o(this.parents[e],this)}execute(){try{g(this);let e=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=E(),e}finally{m()}}}let x=l("EffectScheduler",()=>w);function v(e,t,n){let r=new x(e,t,n);return r.attach(),r.scheduleEffect(),()=>{r.detach()}}function S(e,t,n){let r=new x(e,t,n);return{scheduler:r,start:e=>{let t=e?.force??!1;r.attach(),t?r.scheduleEffect():r.maybeScheduleEffect()},stop:()=>{r.detach()}}}class k{constructor(e){this.parent=e}initialAtomValues=new Map;get isRoot(){return null===this.parent}commit(){if(this.isRoot){let e=this.initialAtomValues;this.initialAtomValues=new Map,C(e.keys())}else this.initialAtomValues.forEach((e,t)=>{this.parent.initialAtomValues.has(t)||this.parent.initialAtomValues.set(t,e)})}abort(){_.globalEpoch++,this.initialAtomValues.forEach((e,t)=>{t.set(e),t.historyBuffer?.clear()}),this.commit()}}let _=l("transactions",()=>({globalEpoch:0,globalIsReacting:!1,currentTransaction:null}));function E(){return _.globalEpoch}function C(e){if(_.globalIsReacting)throw Error("cannot change atoms during reaction cycle");try{_.globalIsReacting=!0;let t=new Set,n=e=>{e.lastTraversedEpoch!==_.globalEpoch&&(e.lastTraversedEpoch=_.globalEpoch,e instanceof x?t.add(e):e.children.visit(n))};for(let t of e)t.children.visit(n);for(let e of t)e.maybeScheduleEffect()}finally{_.globalIsReacting=!1}}function P(e){let t=new k(_.currentTransaction);_.currentTransaction=t;try{let n=!1,r=e(()=>n=!0);return n?t.abort():t.commit(),r}catch(e){throw t.abort(),e}finally{_.currentTransaction=_.currentTransaction.parent}}function T(e){return _.currentTransaction?e():P(e)}class j{constructor(e,t,n){if(this.name=e,this.current=t,this.isEqual=n?.isEqual??null,!n)return;n.historyLength&&(this.historyBuffer=new h(n.historyLength)),this.computeDiff=n.computeDiff}isEqual;computeDiff;lastChangedEpoch=E();children=new u;historyBuffer;__unsafe__getWithoutCapture(){return this.current}get(){return y(this),this.current}set(e,t){if(this.isEqual?.(this.current,e)??a(this.current,e))return this.current;_.globalEpoch++,this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,E(),t??this.computeDiff?.(this.current,e,this.lastChangedEpoch,E())??d),this.lastChangedEpoch=E();let n=this.current;return this.current=e,_.currentTransaction?_.currentTransaction.initialAtomValues.has(this)||_.currentTransaction.initialAtomValues.set(this,n):C([this]),e}update(e){return this.set(e(this.current))}getDiffSince(e){return(y(this),e>=this.lastChangedEpoch)?c:this.historyBuffer?.getChangesSince(e)??d}}let I=l("Atom",()=>j);function M(e,t,n){return new I(e,t,n)}let A=!1,O=Symbol.for("com.tldraw.state/UNINITIALIZED"),$=e=>e===O,B=l("WithDiff",()=>class{constructor(e,t){this.value=e,this.diff=t}});function D(e,t){return new B(e,t)}class L{constructor(e,t,n){this.name=e,this.derive=t,n?.historyLength&&(this.historyBuffer=new h(n.historyLength)),this.computeDiff=n?.computeDiff,this.isEqual=n?.isEqual??a}lastChangedEpoch=-1;lastTraversedEpoch=-1;lastCheckedEpoch=-1;parents=[];parentEpochs=[];children=new u;get isActivelyListening(){return!this.children.isEmpty}historyBuffer;state=O;computeDiff;isEqual;__unsafe__getWithoutCapture(){let e=-1===this.lastChangedEpoch;if(!e&&(this.lastCheckedEpoch===E()||!i(this)))return this.lastCheckedEpoch=E(),this.state;try{g(this);let t=this.derive(this.state,this.lastCheckedEpoch),n=t instanceof B?t.value:t;if(this.state===O||!this.isEqual(n,this.state)){if(this.historyBuffer&&!e){let e=t instanceof B?t.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,E(),e??this.computeDiff?.(this.state,n,this.lastCheckedEpoch,E())??d)}this.lastChangedEpoch=E(),this.state=n}return this.lastCheckedEpoch=E(),this.state}finally{m()}}get(){let e=this.__unsafe__getWithoutCapture();return y(this),e}getDiffSince(e){return(this.get(),e>=this.lastChangedEpoch)?c:this.historyBuffer?.getChangesSince(e)??d}}let R=l("Computed",()=>L);function z(e={},t,n,r){return r.get?(A||(A=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`)),function(e={},t,n,r){let i=r.get,o=Symbol.for("__@tldraw/state__computed__"+n);return r.get=function(){let t=this[o];return t||Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:t=new R(n,i.bind(this),e)}),t.get()},r}(e,0,n,r)):function(e={},t,n,r){let i=r.value,o=Symbol.for("__@tldraw/state__computed__"+n);return r.value=function(){let t=this[o];return t||Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:t=new R(n,i.bind(this),e)}),t.get()},r.value[N]=!0,r}(e,0,n,r)}let N="@@__isComputedMethod__@@";function F(){if(1==arguments.length){let e=arguments[0];return(t,n,r)=>z(e,t,n,r)}return"string"==typeof arguments[0]?new R(arguments[0],arguments[1],arguments[2]):z(void 0,arguments[0],arguments[1],arguments[2])}if(1!==l("apiVersion",()=>1))throw Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");var U=n(2265);function V(e,t){let n=U.useRef(t);n.current=t;let[r,i,o]=U.useMemo(()=>{let t=null,r=new x(`useStateTracking(${e})`,()=>n.current?.(),{scheduleEffect(){t?.()}});return[r,e=>(t=e,()=>{t=null}),()=>r.scheduleCount]},[e]);return U.useSyncExternalStore(i,o,o),U.useEffect(()=>(r.attach(),r.maybeScheduleEffect(),()=>{r.detach()}),[r]),r.execute()}let H={apply:(e,t,n)=>V(e.displayName??e.name??"tracked(???)",()=>e.apply(t,n))},Z=Symbol.for("react.memo"),K=Symbol.for("react.forward_ref");function W(e){let t=null,n=e.$$typeof;return(n===Z&&(t=(e=e.type).compare),n===K)?(0,U.memo)((0,U.forwardRef)(new Proxy(e.render,H))):(0,U.memo)(new Proxy(e,H),t)}function Y(){let e=arguments[0],t=arguments[1],n=3==arguments.length?void 0:arguments[2],r=3==arguments.length?arguments[2]:arguments[3];return(0,U.useMemo)(()=>F(`useComputed(${e})`,t,n),r)}function G(e,t,n=c){(0,U.useEffect)(()=>{let n=new x(e,t);return n.attach(),n.execute(),()=>{n.detach()}},n)}function X(e,t,n=[]){let r=(0,U.useMemo)(()=>new x(e,t,{scheduleEffect:e=>requestAnimationFrame(e)}),n);(0,U.useEffect)(()=>(r.attach(),r.execute(),()=>{r.detach()}),[r])}function q(){let e=arguments,t=3===e.length?e[2]:[e[0]],n=3===e.length?e[0]:`useValue(${e[0].name})`,r=(0,U.useRef)(!0);r.current=!0;let i=(0,U.useMemo)(()=>1===e.length?e[0]:F(n,()=>{if(r.current)return e[1]();try{return e[1]()}catch{return{}}}),t);try{let{subscribe:e,getSnapshot:t}=(0,U.useMemo)(()=>({subscribe:e=>v(`useValue(${n})`,()=>{i.get(),e()}),getSnapshot:()=>i.get()}),[i]);return(0,U.useSyncExternalStore)(e,t,t)}finally{r.current=!1}}},8418:function(e,t,n){"use strict";n.d(t,{mW:function(){return r},qx:function(){return S},oX:function(){return a},yh:function(){return y},sS:function(){return P},lS:function(){return c},ix:function(){return _},$F:function(){return T},ju:function(){return l},zn:function(){return v},ZV:function(){return m},C$:function(){return k},Te:function(){return C},wJ:function(){return E},kJ:function(){return w},bs:function(){return b}});class r{constructor(e){this.previousValue=e}nextValue;diff;get(){let e=this.diff?.removed?.size??0,t=this.diff?.added?.size??0;if(0!==e||0!==t)return{value:this.nextValue,diff:this.diff}}_add(e,t){this.nextValue??=new Set(this.previousValue),this.nextValue.add(e),this.diff??={},t?this.diff.removed?.delete(e):(this.diff.added??=new Set,this.diff.added.add(e))}add(e){let t=this.previousValue.has(e);if(t){if(!this.diff?.removed?.has(e))return;return this._add(e,t)}this.nextValue?.has(e)||this._add(e,t)}_remove(e,t){this.nextValue??=new Set(this.previousValue),this.nextValue.delete(e),this.diff??={},t?(this.diff.removed??=new Set,this.diff.removed.add(e)):this.diff.added?.delete(e)}remove(e){let t=this.previousValue.has(e);if(!t){if(!this.diff?.added?.has(e))return;return this._remove(e,t)}this.diff?.removed?.has(e)||this._remove(e,t)}}var i,o=n(2302);let s=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((e,t)=>((t&=63)<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");class a{constructor(e,t){this.typeName=e,this.createDefaultProperties=t.createDefaultProperties,this.migrations=t.migrations,this.validator=t.validator??{validate:e=>e},this.scope=t.scope??"document"}createDefaultProperties;migrations;validator;scope;create(e){let t={...this.createDefaultProperties(),id:this.createId()};for(let[n,r]of Object.entries(e))void 0!==r&&(t[n]=r);return t.typeName=this.typeName,t}clone(e){return{...(0,o.v4)(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??s())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isInstance=e=>e?.typeName===this.typeName;isId(e){if(!e)return!1;for(let t=0;t<this.typeName.length;t++)if(e[t]!==this.typeName[t])return!1;return":"===e[this.typeName.length]}withDefaultProperties(e){return new a(this.typeName,{createDefaultProperties:e,migrations:this.migrations,validator:this.validator,scope:this.scope})}validate(e){return this.validator.validate(e)}}function l(e,t){return new a(e,{createDefaultProperties:()=>({}),migrations:t.migrations??{currentVersion:0,firstVersion:0,migrators:{}},validator:t.validator,scope:t.scope})}function c(e,t){if(!e||!t.isId(e))throw Error(`string ${JSON.stringify(e)} is not a valid ${t.typeName} id`)}var u=n(5801);class d{items=new WeakMap;get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}}var h=n(8355);function p(e,t){for(let[n,r]of Object.entries(e)){let e=t[n];if("eq"in r&&e!==r.eq||"neq"in r&&e===r.neq||"gt"in r&&("number"!=typeof e||e<=r.gt))return!1}return!0}function f(e,t,n){let r=Object.fromEntries(Object.keys(n).map(e=>[e,new Set]));for(let[i,o]of Object.entries(n))if("eq"in o){let n=e.index(t,i).get().get(o.eq);if(n)for(let e of n)r[i].add(e)}else if("neq"in o){for(let[n,s]of e.index(t,i).get())if(n!==o.neq)for(let e of s)r[i].add(e)}else if("gt"in o){for(let[n,s]of e.index(t,i).get())if(n>o.gt)for(let e of s)r[i].add(e)}return function(e){if(0===e.length)return new Set;let t=e[0],n=e.slice(1),r=new Set;for(let e of t)n.every(t=>t.has(e))&&r.add(e);return r}(Object.values(r))}class g{constructor(e,t){this.atoms=e,this.history=t}indexCache=new Map;historyCache=new Map;filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);let t=(0,u.Fl)("filterHistory:"+e,(t,n)=>{if((0,u.e1)(t))return this.history.get();let r=this.history.getDiffSince(n);if(r===u.SB)return this.history.get();let i={added:{},removed:{},updated:{}},s=0,a=0,l=0;for(let t of r){for(let n of(0,o.UM)(t.added))if(n.typeName===e){if(i.removed[n.id]){let e=i.removed[n.id];delete i.removed[n.id],a--,e!==n&&(i.updated[n.id]=[e,n],l++)}else i.added[n.id]=n,s++}for(let[n,r]of(0,o.UM)(t.updated))r.typeName===e&&(i.added[r.id]?i.added[r.id]=r:i.updated[r.id]?i.updated[r.id]=[i.updated[r.id][0],r]:(i.updated[r.id]=[n,r],l++));for(let n of(0,o.UM)(t.removed))n.typeName===e&&(i.added[n.id]?(delete i.added[n.id],s--):(i.updated[n.id]?(i.removed[n.id]=i.updated[n.id][0],delete i.updated[n.id],l--):i.removed[n.id]=n,a++))}return s||a||l?(0,u.qo)(this.history.get(),i):t},{historyLength:100});return this.historyCache.set(e,t),t}index(e,t){let n=e+":"+t;if(this.indexCache.has(n))return this.indexCache.get(n);let r=this.__uncached_createIndex(e,t);return this.indexCache.set(n,r),r}__uncached_createIndex(e,t){let n=this.filterHistory(e),i=()=>{n.get();let r=new Map;for(let n of(0,o.UM)(this.atoms.get())){let i=n.get();if(i.typeName===e){let e=i[t];r.has(e)||r.set(e,new Set),r.get(e).add(i.id)}}return r};return(0,u.Fl)("index:"+e+":"+t,(s,a)=>{let l,c;if((0,u.e1)(s))return i();let d=n.getDiffSince(a);if(d===u.SB)return i();let h=new Map,p=(e,t)=>{let n=h.get(e);n||(n=new r(s.get(e)??new Set)),n.add(t),h.set(e,n)},f=(e,t)=>{let n=h.get(e);n||(n=new r(s.get(e)??new Set)),n.remove(t),h.set(e,n)};for(let n of d){for(let r of(0,o.UM)(n.added))r.typeName===e&&p(r[t],r.id);for(let[r,i]of(0,o.UM)(n.updated))if(i.typeName===e){let e=r[t],n=i[t];e!==n&&(f(e,i.id),p(n,i.id))}for(let r of(0,o.UM)(n.removed))r.typeName===e&&f(r[t],r.id)}for(let[e,t]of h){let n=t.get();n&&(l||(l=new Map(s)),c||(c=new Map),0===n.value.size?l.delete(e):l.set(e,n.value),c.set(e,n.diff))}return l&&c?(0,u.qo)(l,c):s},{historyLength:100})}record(e,t=()=>({}),n="record:"+e+(t?":"+t.toString():"")){let r=this.ids(e,t,n);return(0,u.Fl)(n,()=>{for(let e of r.get())return this.atoms.get()[e]?.get()})}records(e,t=()=>({}),n="records:"+e+(t?":"+t.toString():"")){let r=this.ids(e,t,"ids:"+n);return(0,u.Fl)(n,()=>[...r.get()].map(e=>{let t=this.atoms.get()[e];if(!t)throw Error("no atom found for record id: "+e);return t.get()}))}ids(e,t=()=>({}),n="ids:"+e+(t?":"+t.toString():"")){let i=this.filterHistory(e),s=()=>{i.get();let n=t();return 0===Object.keys(n).length?new Set((0,o.UM)(this.atoms.get()).flatMap(t=>{let n=t.get();return n.typeName===e?n.id:[]})):f(this,e,n)},a=e=>{let t=s(),n=function(e,t){let n={};for(let r of t)e.has(r)||(n.added??=new Set,n.added.add(r));for(let r of e)t.has(r)||(n.removed??=new Set,n.removed.add(r));return n.added||n.removed?n:void 0}(e,t);return n?(0,u.qo)(t,n):e},l=(0,u.Fl)("ids_query:"+n,t,{isEqual:h});return(0,u.Fl)("query:"+n,(t,n)=>{let c=l.get();if((0,u.e1)(t))return s();if(n<l.lastChangedEpoch)return a(t);let d=i.getDiffSince(n);if(d===u.SB)return a(t);let h=new r(t);for(let t of d){for(let n of(0,o.UM)(t.added))n.typeName===e&&p(c,n)&&h.add(n.id);for(let[n,r]of(0,o.UM)(t.updated))r.typeName===e&&(p(c,r)?h.add(r.id):h.remove(r.id));for(let n of(0,o.UM)(t.removed))n.typeName===e&&h.remove(n.id)}let f=h.get();return f?(0,u.qo)(f.value,f.diff):t},{historyLength:50})}exec(e,t){let n=f(this,e,t);if(0===n.size)return u.LZ;let r=this.atoms.get();return[...n].map(e=>r[e].get())}}function m(e){return e}class y{id=s();atoms=(0,u.cn)("store_atoms",{});history=(0,u.cn)("history",0,{historyLength:1e3});query=new g(this.atoms,this.history);listeners=new Set;historyAccumulator=new x;historyReactor;schema;props;scopedTypes;constructor(e){let{initialData:t,schema:n}=e;this.schema=n,this.props=e.props,t&&this.atoms.set((0,o.Ls)((0,o.EP)(t).map(([e,t])=>[e,(0,u.cn)("atom:"+e,this.schema.validateRecord(this,t,"initialize",null))]))),this.historyReactor=(0,u.zH)("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:e=>(0,o.xP)(e)}),this.scopedTypes={document:new Set((0,o.UM)(this.schema.types).filter(e=>"document"===e.scope).map(e=>e.typeName)),session:new Set((0,o.UM)(this.schema.types).filter(e=>"session"===e.scope).map(e=>e.typeName)),presence:new Set((0,o.UM)(this.schema.types).filter(e=>"presence"===e.scope).map(e=>e.typeName))}}_flushHistory(){if(this.historyAccumulator.hasChanges())for(let{changes:e,source:t}of this.historyAccumulator.flush()){let n=null,r=null,i=null;for(let{onHistory:o,filters:s}of this.listeners)if("all"===s.source||s.source===t){if("all"!==s.scope){if("document"===s.scope){if(!(r??=this.filterChangesByScope(e,"document")))continue;o({changes:r,source:t})}else if("session"===s.scope){if(!(n??=this.filterChangesByScope(e,"session")))continue;o({changes:n,source:t})}else{if(!(i??=this.filterChangesByScope(e,"presence")))continue;o({changes:i,source:t})}}else o({changes:e,source:t})}}}filterChangesByScope(e,t){let n={added:(0,o.H4)(e.added,(e,n)=>this.scopedTypes[t].has(n.typeName)),updated:(0,o.H4)(e.updated,(e,n)=>this.scopedTypes[t].has(n[1].typeName)),removed:(0,o.H4)(e.removed,(e,n)=>this.scopedTypes[t].has(n.typeName))};return 0===Object.keys(n.added).length&&0===Object.keys(n.updated).length&&0===Object.keys(n.removed).length?null:n}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),0===this.listeners.size&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach(t=>this.schema.validateRecord(this,t,e,null))}onBeforeCreate;onAfterCreate;onBeforeChange;onAfterChange;onBeforeDelete;onAfterDelete;_runCallbacks=!0;put=(e,t)=>{(0,u.ay)(()=>{let n;let r={},i={},o=this.atoms.__unsafe__getWithoutCapture(),s=null,a=!1,l=this.onBeforeCreate&&this._runCallbacks?this.onBeforeCreate:null,c=this.onBeforeChange&&this._runCallbacks?this.onBeforeChange:null,d=this.isMergingRemoteChanges?"remote":"user";for(let h=0,p=e.length;h<p;h++){let p=(s??o)[(n=e[h]).id];if(p){let e=p.__unsafe__getWithoutCapture();c&&(n=c(e,n,d)),n=this.schema.validateRecord(this,n,t??"updateRecord",e),p.set(n);let i=p.__unsafe__getWithoutCapture();e!==i&&(a=!0,r[n.id]=[e,i])}else l&&(n=l(n,d)),a=!0,i[(n=this.schema.validateRecord(this,n,t??"createRecord",null)).id]=n,s||(s={...o}),s[n.id]=(0,u.cn)("atom:"+n.id,n)}if(s&&this.atoms.set(s),a&&(this.updateHistory({added:i,updated:r,removed:{}}),this._runCallbacks)){let{onAfterCreate:e,onAfterChange:t}=this;e&&Object.values(i).forEach(t=>{e(t,d)}),t&&Object.values(r).forEach(([e,n])=>{t(e,n,d)})}})};remove=e=>{(0,u.ay)(()=>{let t;let n=[],r=this.isMergingRemoteChanges?"remote":"user";if(this.onBeforeDelete&&this._runCallbacks)for(let t of e){let e=this.atoms.__unsafe__getWithoutCapture()[t];e&&!1===this.onBeforeDelete(e.get(),r)&&n.push(t)}if(this.atoms.update(r=>{let i;for(let o of e)!n.includes(o)&&o in r&&(i||(i={...r}),t||(t={}),delete i[o],t[o]=r[o].get());return i??r}),t&&(this.updateHistory({added:{},updated:{},removed:t}),this.onAfterDelete&&this._runCallbacks)){let n;for(let i=0,o=e.length;i<o;i++)(n=t[e[i]])&&this.onAfterDelete(n,r)}})};get=e=>this.atoms.get()[e]?.get();unsafeGetWithoutCapture=e=>this.atoms.get()[e]?.__unsafe__getWithoutCapture();serialize=(e="document")=>{let t={};for(let[n,r]of(0,o.EP)(this.atoms.get())){let i=r.get();("all"===e||this.scopedTypes[e].has(i.typeName))&&(t[n]=i)}return t};getSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}migrateSnapshot(e){let t=this.schema.migrateStoreSnapshot(e);if("error"===t.type)throw Error(`Failed to migrate snapshot: ${t.reason}`);return{store:t.value,schema:this.schema.serialize()}}loadSnapshot(e){let t=this.schema.migrateStoreSnapshot(e);if("error"===t.type)throw Error(`Failed to migrate snapshot: ${t.reason}`);(0,u.ay)(()=>{this.clear(),this.put(Object.values(t.value)),this.ensureStoreIsUsable()})}allRecords=()=>(0,o.UM)(this.atoms.get()).map(e=>e.get());clear=()=>{this.remove((0,o.GH)(this.atoms.get()))};update=(e,t)=>{let n=this.atoms.get()[e];if(!n){console.error(`Record ${e} not found. This is probably an error`);return}this.put([t(n.__unsafe__getWithoutCapture())])};has=e=>!!this.atoms.get()[e];listen=(e,t)=>{this._flushHistory();let n={onHistory:e,filters:{source:t?.source??"all",scope:t?.scope??"all"}};return this.listeners.add(n),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(n),0===this.listeners.size&&this.historyReactor.stop()}};isMergingRemoteChanges=!1;mergeRemoteChanges=e=>{if(this.isMergingRemoteChanges)return e();try{this.isMergingRemoteChanges=!0,(0,u.ay)(e)}finally{this.isMergingRemoteChanges=!1}};extractingChanges(e){let t=[],n=this.historyAccumulator.intercepting(e=>t.push(e.changes));try{return(0,u.ay)(e),b(t)}finally{n()}}applyDiff(e,t=!0){let n=this._runCallbacks;try{this._runCallbacks=t,(0,u.ay)(()=>{let t=(0,o.UM)(e.added).concat((0,o.UM)(e.updated).map(([e,t])=>t)),n=(0,o.GH)(e.removed);t.length&&this.put(t),n.length&&this.remove(n)})}finally{this._runCallbacks=n}}createComputedCache=(e,t,n)=>{let r=new d;return{get:i=>{let o=this.atoms.get()[i];if(o)return r.get(o,()=>{let r=n?(0,u.Fl)(o.name+":equals",()=>o.get(),{isEqual:n}):o;return(0,u.Fl)(e+":"+i,()=>t(r.get()))}).get()}}};createSelectedComputedCache=(e,t,n)=>{let r=new d;return{get:i=>{let o=this.atoms.get()[i];if(!o)return;let s=(0,u.Fl)(e+":"+i+":selector",()=>t(o.get()));return r.get(o,()=>(0,u.Fl)(e+":"+i,()=>n(s.get()))).get()}}};getRecordType=e=>{let t=this.schema.types[e.typeName];if(!t)throw Error(`Record type ${e.typeName} not found`);return t};_integrityChecker;ensureStoreIsUsable(){this._integrityChecker??=this.schema.createIntegrityChecker(this),this._integrityChecker?.()}_isPossiblyCorrupted=!1;markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}}function b(e){let t={added:{},removed:{},updated:{}};for(let n of e){for(let[e,r]of(0,o.EP)(n.added))if(t.removed[e]){let n=t.removed[e];delete t.removed[e],n!==r&&(t.updated[e]=[n,r])}else t.added[e]=r;for(let[e,[r,i]]of(0,o.EP)(n.updated)){if(t.added[e]){t.added[e]=i,delete t.updated[e],delete t.removed[e];continue}if(t.updated[e]){t.updated[e]=[t.updated[e][0],i],delete t.removed[e];continue}t.updated[e]=n.updated[e],delete t.removed[e]}for(let[e,r]of(0,o.EP)(n.removed))t.added[e]?delete t.added[e]:t.updated[e]?(t.removed[e]=t.updated[e][0],delete t.updated[e]):t.removed[e]=r}return t}function w(e){let t={added:e.removed,removed:e.added,updated:{}};for(let[n,r]of Object.values(e.updated))t.updated[n.id]=[r,n];return t}class x{_history=[];_interceptors=new Set;intercepting(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){for(let t of(this._history.push(e),this._interceptors))t(e)}flush(){let e=function(e){let t;let n=[],r=e[0];for(let i=1,o=e.length;i<o;i++)t=e[i],r.source!==t.source?(n.push(r),r=t):r={source:r.source,changes:b([r.changes,t.changes])};return n.push(r),n}(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function v(e){let{currentVersion:t,firstVersion:n,migrators:r={},subTypeKey:i,subTypeMigrations:o}=e;if("number"==typeof t&&"number"==typeof n){if(t===n)throw Error("Current version is equal to initial version.");if(t<n)throw Error("Current version is lower than initial version.")}return{firstVersion:n??0,currentVersion:t??0,migrators:r,subTypeKey:i,subTypeMigrations:o}}var S=((i=S||{}).IncompatibleSubtype="incompatible-subtype",i.UnknownType="unknown-type",i.TargetVersionTooNew="target-version-too-new",i.TargetVersionTooOld="target-version-too-old",i.MigrationError="migration-error",i.UnrecognizedSubtype="unrecognized-subtype",i);function k(e,t){let n=t.recordVersions[e.typeName];if(!n)return{rootVersion:0};if("subTypeKey"in n){let t=e[n.subTypeKey],r=n.subTypeVersions[t];return{rootVersion:n.version,subTypeVersion:r}}return{rootVersion:n.version}}function _(e,t){if(e.rootVersion>t.rootVersion)return 1;if(e.rootVersion<t.rootVersion)return -1;if(null!=e.subTypeVersion&&null!=t.subTypeVersion){if(e.subTypeVersion>t.subTypeVersion)return 1;if(e.subTypeVersion<t.subTypeVersion)return -1}return 0}function E({record:e,migrations:t,fromVersion:n,toVersion:r}){let i=n;if(!("object"==typeof e&&null!==e&&"id"in e&&"typeName"in e))throw Error("[migrateRecord] object is not a record");let{typeName:o,id:s,...a}=e,l=a;for(;i<r;){let e=i+1,n=t.migrators[e];if(!n)return{type:"error",reason:"target-version-too-new"};l=n.up(l),i=e}for(;i>r;){let e=i-1,n=t.migrators[i];if(!n)return{type:"error",reason:"target-version-too-old"};l=n.down(l),i=e}return{type:"success",value:{...l,id:s,typeName:o}}}function C({value:e,migrations:t,fromVersion:n,toVersion:r}){let i=n;for(;i<r;){let n=i+1,r=t.migrators[n];if(!r)return{type:"error",reason:"target-version-too-new"};e=r.up(e),i=n}for(;i>r;){let n=i-1,r=t.migrators[i];if(!r)return{type:"error",reason:"target-version-too-old"};e=r.down(e),i=n}return{type:"success",value:e}}class P{constructor(e,t){this.types=e,this.options=t}static create(e,t){return new P(e,t??{})}get currentStoreVersion(){return this.options.snapshotMigrations?.currentVersion??0}validateRecord(e,t,n,r){try{let e=(0,o.eg)(this.types,t.typeName);if(!e)throw Error(`Missing definition for record type ${t.typeName}`);return e.validate(t)}catch(i){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:t,phase:n,recordBefore:r,error:i});throw i}}migratePersistedRecord(e,t,n="up"){let r=(0,o.eg)(this.types,e.typeName),i=t.recordVersions[e.typeName];if(!i||!r)return{type:"error",reason:S.UnknownType};let s=r.migrations.currentVersion,a=i.version;if(s!==a){let t="up"===n?E({record:e,migrations:r.migrations,fromVersion:a,toVersion:s}):E({record:e,migrations:r.migrations,fromVersion:s,toVersion:a});if("error"===t.type)return t;e=t.value}if(!r.migrations.subTypeKey)return{type:"success",value:e};let l=r.migrations.subTypeMigrations?.[e[r.migrations.subTypeKey]],c="subTypeVersions"in i?i.subTypeVersions[e[r.migrations.subTypeKey]]:void 0;if(void 0===l)return{type:"error",reason:S.UnrecognizedSubtype};if(void 0===c)return{type:"error",reason:S.IncompatibleSubtype};let u="up"===n?E({record:e,migrations:l,fromVersion:c,toVersion:l.currentVersion}):E({record:e,migrations:l,fromVersion:l.currentVersion,toVersion:c});return"error"===u.type?u:{type:"success",value:u.value}}migrateStoreSnapshot(e){let{store:t}=e,n=this.options.snapshotMigrations;if(!n)return{type:"success",value:t};let r=n.currentVersion,i=e.schema.storeVersion??0;if(r<i)return{type:"error",reason:S.TargetVersionTooOld};if(r>i){let e=C({value:t,migrations:n,fromVersion:i,toVersion:r});if("error"===e.type)return e;t=e.value}let s=[];for(let n of(0,o.UM)(t)){let t=this.migratePersistedRecord(n,e.schema);if("error"===t.type)return t;t.value&&t.value!==n&&s.push(t.value)}if(s.length)for(let e of(t={...t},s))t[e.id]=e;return{type:"success",value:t}}createIntegrityChecker(e){return this.options.createIntegrityChecker?.(e)??void 0}serialize(){return{schemaVersion:1,storeVersion:this.options.snapshotMigrations?.currentVersion??0,recordVersions:Object.fromEntries((0,o.UM)(this.types).map(e=>[e.typeName,e.migrations.subTypeKey&&e.migrations.subTypeMigrations?{version:e.migrations.currentVersion,subTypeKey:e.migrations.subTypeKey,subTypeVersions:e.migrations.subTypeMigrations?Object.fromEntries(Object.entries(e.migrations.subTypeMigrations).map(([e,t])=>[e,t.currentVersion])):void 0}:{version:e.migrations.currentVersion}]))}}serializeEarliestVersion(){return{schemaVersion:1,storeVersion:this.options.snapshotMigrations?.firstVersion??0,recordVersions:Object.fromEntries((0,o.UM)(this.types).map(e=>[e.typeName,e.migrations.subTypeKey&&e.migrations.subTypeMigrations?{version:e.migrations.firstVersion,subTypeKey:e.migrations.subTypeKey,subTypeVersions:e.migrations.subTypeMigrations?Object.fromEntries(Object.entries(e.migrations.subTypeMigrations).map(([e,t])=>[e,t.firstVersion])):void 0}:{version:e.migrations.firstVersion}]))}}}let T=(e,t)=>{if(e.schemaVersion>t.schemaVersion)return 1;if(e.schemaVersion<t.schemaVersion)return -1;if(e.storeVersion>t.storeVersion)return 1;if(e.storeVersion<t.storeVersion)return -1;for(let n of Object.keys(e.recordVersions)){let r=e.recordVersions[n],i=t.recordVersions[n];if(r.version>i.version)return 1;if(r.version<i.version)return -1;if("subTypeVersions"in r&&!("subTypeVersions"in i))return 1;if(!("subTypeVersions"in r)&&"subTypeVersions"in i)return -1;if("subTypeVersions"in r&&"subTypeVersions"in i)for(let e of Object.keys(r.subTypeVersions)){let t=r.subTypeVersions[e],n=i.subTypeVersions[e];if(t>n)return 1;if(t<n)return -1}}return 0}},4159:function(e,t,n){"use strict";let r,i,o,s,a,l;n.r(t),n.d(t,{ANIMATION_MEDIUM_MS:function(){return L.KD},ANIMATION_SHORT_MS:function(){return L.uJ},Arc2d:function(){return rP},ArrayOfValidator:function(){return A.UR},ArrowShapeArrowheadEndStyle:function(){return I.ZJ},ArrowShapeArrowheadStartStyle:function(){return I.TA},ArrowShapeTool:function(){return iW},ArrowShapeUtil:function(){return oM},AssetRecordType:function(){return I.Yk},AssetUrlsProvider:function(){return lX},BaseBoxShapeTool:function(){return rf},BaseBoxShapeUtil:function(){return rl},BookmarkShapeUtil:function(){return oz},Box:function(){return rS.xu},BreakPointProvider:function(){return dA},Button:function(){return cn},CAMERA_SLIDE_FRICTION:function(){return L.$G},CameraRecordType:function(){return I.AN},Canvas:function(){return tU},Circle2d:function(){return rT},ContextMenu:function(){return yb},CubicBezier2d:function(){return rI},CubicSpline2d:function(){return rM},DEFAULT_ACCEPTED_IMG_TYPE:function(){return iA},DEFAULT_ACCEPTED_VID_TYPE:function(){return iO},DEFAULT_ANIMATION_OPTIONS:function(){return L.Xy},DOUBLE_CLICK_DURATION:function(){return L.qV},DRAG_DISTANCE:function(){return L.Sk},DefaultBackground:function(){return el},DefaultBrush:function(){return ed},DefaultCollaboratorHint:function(){return ep},DefaultColorStyle:function(){return I.R_},DefaultColorThemePalette:function(){return I.qi},DefaultCursor:function(){return ef},DefaultDashStyle:function(){return I.ci},DefaultErrorFallback:function(){return ex},DefaultFillStyle:function(){return I.pp},DefaultFontFamilies:function(){return I.p6},DefaultFontStyle:function(){return I.Y8},DefaultGrid:function(){return ev},DefaultHandle:function(){return eS},DefaultHandles:function(){return ek},DefaultHorizontalAlignStyle:function(){return I.Xo},DefaultHoveredShapeIndicator:function(){return e_},DefaultScribble:function(){return eC},DefaultSelectionBackground:function(){return eP},DefaultSelectionForeground:function(){return eT},DefaultSizeStyle:function(){return I.ST},DefaultSnapLine:function(){return eO},DefaultSpinner:function(){return e$},DefaultSvgDefs:function(){return eB},DefaultVerticalAlignStyle:function(){return I.HO},Dialog:function(){return C},DictValidator:function(){return A.oy},DocumentRecordType:function(){return I._A},DrawShapeTool:function(){return iX},DrawShapeUtil:function(){return o0},DropdownMenu:function(){return P},EASINGS:function(){return rk.L},EMBED_DEFINITIONS:function(){return I.Lu},EMPTY_ARRAY:function(){return T.LZ},EVENT_NAME_MAP:function(){return rg.J},Edge2d:function(){return rA.W},Editor:function(){return nr.M},Ellipse2d:function(){return rO},EmbedShapeUtil:function(){return o3},EnumStyleProp:function(){return I.$I},EraserTool:function(){return ar},ErrorBoundary:function(){return en},ErrorScreen:function(){return n7},FileHelpers:function(){return M.P6},FrameShapeTool:function(){return iq},FrameShapeUtil:function(){return o7},GRID_STEPS:function(){return L.dW},GeoShapeGeoStyle:function(){return I.Zu},GeoShapeTool:function(){return i0},GeoShapeUtil:function(){return sI},Geometry2d:function(){return rE.l},Group2d:function(){return tP.m},GroupShapeUtil:function(){return rc.Q},HALF_PI:function(){return eu.pj},HASH_PATTERN_ZOOM_NAMES:function(){return L.iF},HIT_TEST_MARGIN:function(){return L.wM},HTMLContainer:function(){return re},HandTool:function(){return aa},HighlightShapeTool:function(){return i1},HighlightShapeUtil:function(){return sO},Icon:function(){return l4},ImageShapeUtil:function(){return sH},IncrementalSetConstructor:function(){return j.mW},Input:function(){return uk},InstancePageStateRecordType:function(){return I.iS},InstancePresenceRecordType:function(){return I.AM},LANGUAGES:function(){return I.a2},LaserTool:function(){return au},LineShapeSplineStyle:function(){return I.t8},LineShapeTool:function(){return i3},LineShapeUtil:function(){return s0},LoadingScreen:function(){return n9},MAX_PAGES:function(){return L.Et},MAX_SHAPES_PER_PAGE:function(){return L.kx},MAX_ZOOM:function(){return L.sZ},MIN_ZOOM:function(){return L.Zj},MULTI_CLICK_DURATION:function(){return L.Pz},Mat:function(){return tC._},MediaHelpers:function(){return M.xe},MigrationFailureReason:function(){return j.qx},NoteShapeTool:function(){return i6},NoteShapeUtil:function(){return s2},ObjectValidator:function(){return A.kx},OfflineIndicator:function(){return y_},OptionalErrorBoundary:function(){return er},PI:function(){return eu.PI},PI2:function(){return eu.yo},PageRecordType:function(){return I.ez},PngHelpers:function(){return M.bM},Point2d:function(){return r$},PointerRecordType:function(){return I.zh},Polygon2d:function(){return rB.w},Polyline2d:function(){return rj.q},PositionedOnCanvas:function(){return rt},ROTATE_CORNER_TO_SELECTION_CORNER:function(){return rS.rf},ReadonlySharedStyleMap:function(){return rL._},RecordType:function(){return j.oX},Rectangle2d:function(){return ro.z},Result:function(){return M.x4},SIN:function(){return eu.dv},SVGContainer:function(){return rn.g},SVG_PADDING:function(){return L.s_},SelectTool:function(){return aK},ShapeIndicator:function(){return ea},ShapeUtil:function(){return rs.E},SharedStyleMap:function(){return rL.o},SnapManager:function(){return ri.f},Spinner:function(){return l8},Stadium2d:function(){return rD},StateNode:function(){return rd.n},Store:function(){return j.yh},StoreSchema:function(){return j.sS},StyleProp:function(){return I.fV},T:function(){return A.T},TAB_ID:function(){return ng},TLDOCUMENT_ID:function(){return I.G4},TLDRAW_FILE_EXTENSION:function(){return yq},TLINSTANCE_ID:function(){return I.PQ},TLPOINTER_ID:function(){return I.LV},TL_CANVAS_UI_COLOR_TYPES:function(){return I.z},TextShapeTool:function(){return ot},TextShapeUtil:function(){return s8},Tldraw:function(){return yS},TldrawCropHandles:function(){return r8},TldrawEditor:function(){return n2},TldrawHandles:function(){return rW},TldrawHoveredShapeIndicator:function(){return rY},TldrawScribble:function(){return r2},TldrawSelectionBackground:function(){return r5},TldrawSelectionForeground:function(){return r4},TldrawUi:function(){return m6},TldrawUiContextProvider:function(){return he},USER_COLORS:function(){return rr.A6},UiEventsProvider:function(){return uZ},UnionValidator:function(){return A.zr},Validator:function(){return A.cX},Vec:function(){return eh.B},VideoShapeUtil:function(){return s6},WeakMapCache:function(){return rR._},ZOOMS:function(){return L.E},ZoomTool:function(){return aX},angleDistance:function(){return eu.mR},annotateError:function(){return M.lw},applyRotationToSnapshotShapes:function(){return rH.Z},approximately:function(){return eu.C2},areAnglesCompatible:function(){return eu._G},areArraysShallowEqual:function(){return M.E8},areObjectsShallowEqual:function(){return M.dn},arrowShapeMigrations:function(){return I.Vm},arrowShapeProps:function(){return I.si},assert:function(){return M.hu},assertExists:function(){return M.kP},assertIdType:function(){return j.lS},assetIdValidator:function(){return I._3},assetMigrations:function(){return I.TD},assetValidator:function(){return I.$A},atom:function(){return T.cn},average:function(){return eu.Y8},bookmarkShapeMigrations:function(){return I.h9},bookmarkShapeProps:function(){return I.qU},boxModelValidator:function(){return I.lz},buildFromV1Document:function(){return yE},canonicalizeRotation:function(){return eu.f5},canvasUiColorTypeValidator:function(){return I.MN},clamp:function(){return eu.uZ},clampRadians:function(){return eu.Ci},clockwiseAngleDist:function(){return eu.VK},compact:function(){return M.oA},compactMenuItems:function(){return dx},compareRecordVersions:function(){return j.ix},compareSchemas:function(){return j.$F},computed:function(){return T.Fl},containBoxSize:function(){return iI},copyAs:function(){return dr},coreShapes:function(){return nY.u},counterClockwiseAngleDist:function(){return eu.pc},createAssetValidator:function(){return I.tL},createPresenceStateDerivation:function(){return I.GP},createRecordType:function(){return j.ju},createSessionStateSnapshotSignal:function(){return nb},createShapeId:function(){return I.F1},createShapeValidator:function(){return I.JY},createTLSchema:function(){return I.HH},createTLStore:function(){return nG},createTLUser:function(){return nn.L},dataUrlToFile:function(){return rz.B},debounce:function(){return M.Ds},debugFlags:function(){return N},dedupe:function(){return M.D8},deepCopy:function(){return M.p$},defaultShapeTools:function(){return on},defaultShapeUtils:function(){return s7},defaultTools:function(){return aq},defaultUserPreferences:function(){return rr.ks},defineMigrations:function(){return j.zn},degreesToRadians:function(){return eu.Ht},devFreeze:function(){return j.ZV},downsizeImage:function(){return iM},drawShapeMigrations:function(){return I._l},drawShapeProps:function(){return I.wu},embedShapeMigrations:function(){return I.BF},embedShapePermissionDefaults:function(){return I.gB},embedShapeProps:function(){return I.DW},exhaustiveSwitchError:function(){return M.iP},exportAs:function(){return dp},extractSessionStateFromLegacySnapshot:function(){return nx},featureFlags:function(){return z},filterEntries:function(){return M.H4},findMenuItem:function(){return dT},fitFrameToContent:function(){return lY},frameShapeMigrations:function(){return I.gR},frameShapeProps:function(){return I.k7},geoShapeMigrations:function(){return I.P3},geoShapeProps:function(){return I.eG},getArcMeasure:function(){return eu.D4},getArrowTerminalsInArrowSpace:function(){return ru.Qs},getCursor:function(){return nd},getDefaultColorTheme:function(){return I.y6},getDefaultTranslationLocale:function(){return I.Bz},getEmbedInfo:function(){return iR},getErrorAnnotations:function(){return M.wi},getFirstFromIterable:function(){return M.lr},getFreshUserPreferences:function(){return rr.MO},getHashForBuffer:function(){return M.Aq},getHashForObject:function(){return M.pT},getHashForString:function(){return M.jK},getIncrementedName:function(){return rU.u},getIndexAbove:function(){return rV._L},getIndexBelow:function(){return rV.Xg},getIndexBetween:function(){return rV.eI},getIndices:function(){return rV.H$},getIndicesAbove:function(){return rV.vw},getIndicesBelow:function(){return rV.dk},getIndicesBetween:function(){return rV.Xv},getOwnProperty:function(){return M.eg},getPointInArcT:function(){return eu.rW},getPointOnCircle:function(){return eu.XD},getPointerInfo:function(){return Y},getPolygonVertices:function(){return eu.Oe},getRecordVersion:function(){return j.C$},getRotationSnapshot:function(){return rH.o},getShapePropKeysByStyle:function(){return I.DR},getSvgAsImage:function(){return u6},getSvgPathFromPoints:function(){return eE},getUserPreferences:function(){return rr.JM},groupShapeMigrations:function(){return I.c4},groupShapeProps:function(){return I.A7},hardReset:function(){return rZ},hardResetEditor:function(){return ey},hasOwnProperty:function(){return M.nr},highlightShapeMigrations:function(){return I.J1},highlightShapeProps:function(){return I.VW},idValidator:function(){return I.yd},imageShapeMigrations:function(){return I.y5},imageShapeProps:function(){return I.Fc},intersectCircleCircle:function(){return r_.bO},intersectCirclePolygon:function(){return r_.h9},intersectCirclePolyline:function(){return r_.XS},intersectLineSegmentCircle:function(){return r_.ZM},intersectLineSegmentLineSegment:function(){return r_.T9},intersectLineSegmentPolygon:function(){return r_.qZ},intersectLineSegmentPolyline:function(){return r_.Gc},intersectPolygonBounds:function(){return r_.S3},intersectPolygonPolygon:function(){return r_.tY},isDefined:function(){return M.$K},isGifAnimated:function(){return i$},isNonNull:function(){return M.GT},isNonNullish:function(){return M.cF},isPageId:function(){return I.r5},isSafeFloat:function(){return eu.AV},isShape:function(){return I.VV},isShapeId:function(){return I.YT},last:function(){return M.Z$},lerp:function(){return M.t7},lineShapeMigrations:function(){return I.FH},lineShapeProps:function(){return I.BG},linesIntersect:function(){return r_.cB},lns:function(){return M.L8},loadSessionStateSnapshotIntoStore:function(){return nw},loopToHtmlElement:function(){return V},mapObjectMapValues:function(){return M.Fm},menuCustom:function(){return dk},menuGroup:function(){return dv},menuItem:function(){return d_},menuSubmenu:function(){return dS},migrate:function(){return j.Te},migrateRecord:function(){return j.wJ},minBy:function(){return M.F},modulate:function(){return M.vm},moveCameraWhenCloseToEdge:function(){return rF},noop:function(){return M.ZT},normalizeWheel:function(){return tv},noteShapeMigrations:function(){return I.C_},noteShapeProps:function(){return I.m0},objectMapEntries:function(){return M.EP},objectMapFromEntries:function(){return M.Ls},objectMapKeys:function(){return M.GH},objectMapValues:function(){return M.UM},omitFromStackTrace:function(){return M.fP},opacityValidator:function(){return I.jm},openWindow:function(){return rK},pageIdValidator:function(){return I.CF},parentIdValidator:function(){return I.Mv},parseAndLoadDocument:function(){return y2},parseTldrawJsonFile:function(){return yQ},partition:function(){return M.uK},perimeterOfEllipse:function(){return eu.Rp},pointInPolygon:function(){return eu.Of},polygonsIntersect:function(){return r_.UQ},precise:function(){return eu.Yk},preventDefault:function(){return H},promiseWithResolve:function(){return M.un},radiansToDegrees:function(){return eu.vi},rafThrottle:function(){return M.TE},rangeIntersection:function(){return eu.mW},react:function(){return T.Ym},refreshPage:function(){return eb},releasePointerCapture:function(){return K},removeFrame:function(){return lW},resizeBox:function(){return ra},reverseRecordsDiff:function(){return j.kJ},rng:function(){return M.Vk},rootShapeMigrations:function(){return I.cL},rotateArray:function(){return M.R8},rotateSelectionHandle:function(){return rS.dC},runtime:function(){return eg},scribbleValidator:function(){return I.gw},serializeTldrawJson:function(){return y0},serializeTldrawJsonBlob:function(){return y1},setDefaultEditorAssetUrls:function(){return lH},setDefaultUiAssetUrls:function(){return lK},setPointerCapture:function(){return Z},setRuntimeOverrides:function(){return em},setUserPreferences:function(){return rr.yu},shapeIdValidator:function(){return I.u5},shortAngleDist:function(){return eu.Z7},snapAngle:function(){return eu.nD},sortById:function(){return M.uv},sortByIndex:function(){return rV.hl},squashRecordDiffs:function(){return j.bs},stopEventPropagation:function(){return W},structuredClone:function(){return M.v4},textShapeMigrations:function(){return I.pL},textShapeProps:function(){return I.XB},throttle:function(){return M.P2},throttledRaf:function(){return M.xP},toDomPrecision:function(){return eu.$Z},toFixed:function(){return eu.FH},toPrecision:function(){return eu.Zd},toolbarItem:function(){return d3},track:function(){return T.j},transact:function(){return T.ay},transaction:function(){return T.PS},truncateStringWithEllipsis:function(){return iU},uniq:function(){return tM},uniqueId:function(){return nh.E},useActions:function(){return dw},useActionsMenuSchema:function(){return dL},useAssetUrls:function(){return lq},useBreakpoint:function(){return dO},useCanRedo:function(){return dQ},useCanUndo:function(){return d0},useComputed:function(){return T.vc},useContainer:function(){return J},useContextMenuSchema:function(){return dF},useCopyAs:function(){return dc},useDefaultHelpers:function(){return d9},useDialogs:function(){return dh},useEditor:function(){return G.j},useExportAs:function(){return dg},useHelpMenuSchema:function(){return dJ},useIsCropping:function(){return rw},useIsDarkMode:function(){return ni},useIsEditing:function(){return rx},useKeyboardShortcuts:function(){return mX},useKeyboardShortcutsSchema:function(){return dW},useLocalStorageState:function(){return gD},useLocalStore:function(){return nJ},useMenuClipboardEvents:function(){return u8},useMenuIsOpen:function(){return fz},useMenuSchema:function(){return d5},useNativeClipboardEvents:function(){return u4},usePeerIds:function(){return tA},usePresence:function(){return tO},useQuickReactor:function(){return T.BK},useReactor:function(){return T.vC},useReadonly:function(){return r3},useSelectionEvents:function(){return rv},useShallowArrayIdentity:function(){return ry},useShallowObjectIdentity:function(){return rb},useTLStore:function(){return nq},useToasts:function(){return dl},useToolbarSchema:function(){return d6},useTools:function(){return dH},useTransform:function(){return ec},useTranslation:function(){return l3},useUiEvents:function(){return uK},useValue:function(){return T.Hg},vecModelValidator:function(){return I.AT},videoShapeMigrations:function(){return I.lY},videoShapeProps:function(){return I.p$},warnDeprecatedGetter:function(){return M.q4},whyAmIRunning:function(){return T.iJ}});var c,u,d,h,p,f,g,m,y,b,w,x,v,S,k,_,E,C={};n.r(C),n.d(C,{Body:function(){return uv},CloseButton:function(){return ux},Footer:function(){return uS},Header:function(){return ub},Title:function(){return uw}});var P={};n.r(P),n.d(P,{CheckboxItem:function(){return fG},Content:function(){return fU},Group:function(){return fK},Indicator:function(){return fW},Item:function(){return fY},RadioItem:function(){return fX},Root:function(){return fN},Sub:function(){return fV},SubContent:function(){return fZ},SubTrigger:function(){return fH},Trigger:function(){return fF}});var T=n(5801),j=n(8418),I=n(5895),M=n(2302),A=n(477),O=n(7437),$=n(2265),B=n.t($,2),D=n(6800),L=n(6652),R=n(357);let z={},N={preventDefaultLogging:F("preventDefaultLogging",{defaults:{all:!1}}),pointerCaptureLogging:F("pointerCaptureLogging",{defaults:{all:!1}}),pointerCaptureTracking:F("pointerCaptureTracking",{defaults:{all:!1}}),pointerCaptureTrackingObject:F("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),elementRemovalLogging:F("elementRemovalLogging",{defaults:{all:!1}}),debugSvg:F("debugSvg",{defaults:{all:!1}}),showFps:F("showFps",{defaults:{all:!1}}),throwToBlob:F("throwToBlob",{defaults:{all:!1}}),logMessages:F("uiLog",{defaults:{all:[]}}),resetConnectionEveryPing:F("resetConnectionEveryPing",{defaults:{all:!1}}),debugCursors:F("debugCursors",{defaults:{all:!1}}),forceSrgb:F("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:F("debugGeometry",{defaults:{all:!1}}),hideShapes:F("hideShapes",{defaults:{all:!1}})};if("undefined"!=typeof window&&(window.tldrawLog=e=>{N.logMessages.set(N.logMessages.get().concat(e))}),"undefined"!=typeof Element){let e=Element.prototype.removeChild;(0,T.Ym)("element removal logging",()=>{N.elementRemovalLogging.get()?Element.prototype.removeChild=function(t){return console.warn("[tldraw] removing child:",t),e.call(this,t)}:Element.prototype.removeChild=e})}function F(e,{defaults:t,shouldStoreForSession:n=!0}){return function(e){let t=function(e){switch(U(()=>R.env.TLDRAW_ENV)??U(()=>R.env.VERCEL_PUBLIC_TLDRAW_ENV)??U(()=>R.env.NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return e.defaults.production??e.defaults.all;case"preview":case"staging":return e.defaults.staging??e.defaults.all;default:return e.defaults.development??e.defaults.all}}(e),n=e.shouldStoreForSession?function(e){try{return JSON.parse(window?.sessionStorage.getItem(`tldraw_debug:${e}`)??"null")}catch(e){return null}}(e.name):null,r=(0,T.cn)(`debug:${e.name}`,n??t);return"undefined"!=typeof window&&(e.shouldStoreForSession&&(0,T.Ym)(`debug:${e.name}`,()=>{let n=r.get();try{n===t?window.sessionStorage.removeItem(`tldraw_debug:${e.name}`):window.sessionStorage.setItem(`tldraw_debug:${e.name}`,JSON.stringify(n))}catch{}}),Object.defineProperty(window,`tldraw${e.name.replace(/^[a-z]/,e=>e.toUpperCase())}`,{get:()=>r.get(),set(e){r.set(e)},configurable:!0})),Object.assign(r,e)}({name:e,defaults:t,shouldStoreForSession:n})}function U(e){try{return e()}catch{return null}}function V(e){if(e instanceof HTMLElement)return e;if(e.parentElement)return V(e.parentElement);throw Error("Could not find a parent element of an HTML type!")}function H(e){e.preventDefault(),N.preventDefaultLogging.get()&&console.warn("preventDefault called on event:",e)}function Z(e,t){if(e.setPointerCapture(t.pointerId),N.pointerCaptureTracking.get()){let t=N.pointerCaptureTrackingObject.get();t.set(e,(t.get(e)??0)+1)}N.pointerCaptureLogging.get()&&console.warn("setPointerCapture called on element:",e,t)}function K(e,t){if(e.hasPointerCapture(t.pointerId)){if(e.releasePointerCapture(t.pointerId),N.pointerCaptureTracking.get()){let t=N.pointerCaptureTrackingObject.get();1===t.get(e)?t.delete(e):t.has(e)?t.set(e,t.get(e)-1):console.warn("Release without capture")}N.pointerCaptureLogging.get()&&console.warn("releasePointerCapture called on element:",e,t)}}let W=e=>e.stopPropagation();function Y(e){return e.isKilled=!0,{point:{x:e.clientX,y:e.clientY,z:e.pressure},shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,pointerId:e.pointerId,button:e.button,isPen:"pen"===e.pointerType}}var G=n(7616);let X=(0,$.createContext)(null);function q({container:e,children:t}){return(0,O.jsx)(X.Provider,{value:e,children:t})}function J(){return(0,M.kP)((0,$.useContext)(X),"useContainer used outside of <Tldraw />")}let Q=["input","select","button","textarea"];function ee(){let{activeElement:e}=document;return!!(e&&(e.getAttribute("contenteditable")||Q.indexOf(e.tagName.toLowerCase())>-1))}let et={error:null};class en extends $.Component{static getDerivedStateFromError(e){return{error:e}}state=et;componentDidCatch(e){this.props.onError?.(e)}render(){let{error:e}=this.state;if(null!==e){let{fallback:t}=this.props;return(0,O.jsx)(t,{error:e})}return this.props.children}}function er({children:e,fallback:t,...n}){return null===t?(0,O.jsx)(O.Fragment,{children:e}):(0,O.jsx)(en,{fallback:t,...n,children:e})}class ei{constructor(e){this.shape=e}equals(e){return this.shape?.isLocked===e?.shape?.isLocked&&this.shape?.props===e?.shape?.props&&this.shape?.meta===e?.shape?.meta}}let eo=({shape:e,util:t})=>(0,T.uC)("Indicator:"+e.type,()=>t.indicator(e)),es=({editor:e,id:t})=>{let n=(0,T.Hg)("shape",()=>new ei(e.store.get(t)),[e,t]),{ShapeIndicatorErrorFallback:r}=eR();return!n.shape||n.shape.isLocked?null:(0,O.jsx)(er,{fallback:r,onError:t=>e.annotateError(t,{origin:"react.shapeIndicator",willCrashApp:!1}),children:(0,O.jsx)(eo,{shape:n.shape,util:e.getShapeUtil(n.shape)},n.shape.id)})},ea=$.memo(({id:e,className:t,color:n,opacity:r})=>{let i=(0,G.j)(),o=(0,T.Hg)("transform",()=>{let t=i.getShapePageTransform(e);return t?t.toCssString():""},[i,e]);return(0,O.jsx)("svg",{className:D("tl-overlays__item",t),children:(0,O.jsx)("g",{className:"tl-shape-indicator",transform:o,stroke:n??"var(--color-selected)",opacity:r,children:(0,O.jsx)(es,{editor:i,id:e})})})});function el(){return(0,O.jsx)("div",{className:"tl-background"})}function ec(e,t,n,r,i,o){(0,$.useLayoutEffect)(()=>{let s=e.current;if(!s||void 0===t)return;let a=`translate(${t}px, ${n}px)`;void 0!==r&&(a+=` scale(${r})`),void 0!==i&&(a+=` rotate(${i}rad)`),o&&(a+=` translate(${o.x}px, ${o.y}px)`),s.style.transform=a})}var eu=n(4885);let ed=({brush:e,color:t,opacity:n,className:r})=>{let i=(0,$.useRef)(null);ec(i,e.x,e.y);let o=(0,eu.$Z)(Math.max(1,e.w)),s=(0,eu.$Z)(Math.max(1,e.h));return(0,O.jsx)("svg",{className:"tl-overlays__item",ref:i,children:t?(0,O.jsxs)("g",{className:"tl-brush",opacity:n,children:[(0,O.jsx)("rect",{width:o,height:s,fill:t,opacity:.75}),(0,O.jsx)("rect",{width:o,height:s,fill:"none",stroke:t,opacity:.1})]}):(0,O.jsx)("rect",{className:`tl-brush tl-brush__default ${r}`,width:o,height:s})})};var eh=n(6810);let ep=({className:e,zoom:t,point:n,color:r,viewport:i,opacity:o=1})=>{let s=(0,$.useRef)(null);return ec(s,(0,eu.uZ)(n.x,i.minX+5/t,i.maxX-5/t),(0,eu.uZ)(n.y,i.minY+5/t,i.maxY-5/t),1/t,eh.B.Angle(i.center,n)),(0,O.jsxs)("svg",{ref:s,className:D("tl-overlays__item",e),children:[(0,O.jsx)("use",{href:"#cursor_hint",color:r,strokeWidth:3,stroke:"var(--color-background)"}),(0,O.jsx)("use",{href:"#cursor_hint",color:r,opacity:o})]})},ef=(0,$.memo)(({className:e,zoom:t,point:n,color:r,name:i,chatMessage:o})=>{let s=(0,$.useRef)(null);return(ec(s,n?.x,n?.y,1/t),n)?(0,O.jsxs)("div",{ref:s,className:D("tl-overlays__item",e),children:[(0,O.jsx)("svg",{className:"tl-cursor",children:(0,O.jsx)("use",{href:"#cursor",color:r})}),o?(0,O.jsxs)(O.Fragment,{children:[i&&(0,O.jsx)("div",{className:"tl-nametag-title",style:{color:r},children:i}),(0,O.jsx)("div",{className:"tl-nametag-chat",style:{backgroundColor:r},children:o})]}):i&&(0,O.jsx)("div",{className:"tl-nametag",style:{backgroundColor:r},children:i})]}):null}),eg={openWindow:(e,t)=>window.open(e,t,"noopener noreferrer"),refreshPage:()=>window.location.reload(),hardReset:async()=>await window.__tldraw__hardReset?.()};function em(e){Object.assign(eg,e)}function ey(){eg.hardReset()}function eb(){eg.refreshPage()}function ew(){}let ex=({error:e,editor:t})=>{let n=(0,$.useRef)(null),[r,i]=(0,$.useState)(!1),[o,s]=(0,$.useState)(!1),[a,l]=(0,$.useState)(!1),c=e instanceof Error?e.message:String(e),u=e instanceof Error?e.stack:null,d=(0,T.Hg)("isDarkMode",()=>{try{if(t)return t.user.getIsDarkMode()}catch{}return null},[t]),[h,p]=(0,$.useState)(null);(0,$.useLayoutEffect)(()=>{null!==d&&p(d);let e=n.current?.parentElement,t=!1;for(;e;){if(e.classList.contains("tl-theme__dark")||e.classList.contains("tl-theme__light")){t=!0;break}e=e.parentElement}if(t){p(null);return}p(window.matchMedia("(prefers-color-scheme: dark)").matches)},[d]),(0,$.useEffect)(()=>{if(o){let e=setTimeout(()=>{s(!1)},2e3);return()=>clearTimeout(e)}},[o]);let f=async()=>{ey()},g=new URL("https://github.com/tldraw/tldraw/issues/new");return g.searchParams.set("title",c),g.searchParams.set("labels","bug"),g.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${u??c}
\`\`\`

My browser: ${navigator.userAgent}`),(0,O.jsxs)("div",{ref:n,className:D("tl-container tl-error-boundary",null===h?"":h?"tl-theme__dark":"tl-theme__light"),children:[(0,O.jsx)("div",{className:"tl-error-boundary__overlay"}),t&&(0,O.jsx)(en,{onError:ew,fallback:()=>null,children:(0,O.jsx)(G.r.Provider,{value:t,children:(0,O.jsx)("div",{className:"tl-overlay tl-error-boundary__canvas",children:(0,O.jsx)(tU,{})})})}),(0,O.jsx)("div",{className:D("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":r&&!a}),children:a?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("h2",{children:"Are you sure?"}),(0,O.jsx)("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),(0,O.jsxs)("div",{className:"tl-error-boundary__content__actions",children:[(0,O.jsx)("button",{onClick:()=>l(!1),children:"Cancel"}),(0,O.jsx)("button",{className:"tl-error-boundary__reset",onClick:f,children:"Reset data"})]})]}):(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("h2",{children:"Something's gone wrong."}),(0,O.jsxs)("p",{children:["Sorry, we encountered an error. Please refresh the page to continue. If you keep seeing this error, you can ",(0,O.jsx)("a",{href:g.toString(),children:"create a GitHub issue"})," or"," ",(0,O.jsx)("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"ask for help on Discord"}),"."]}),r&&(0,O.jsxs)("div",{className:"tl-error-boundary__content__error",children:[(0,O.jsx)("pre",{children:(0,O.jsx)("code",{children:u??c})}),(0,O.jsx)("button",{onClick:()=>{let e=document.createElement("textarea");e.value=u??c,document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove(),s(!0)},children:o?"Copied!":"Copy"})]}),(0,O.jsxs)("div",{className:"tl-error-boundary__content__actions",children:[(0,O.jsx)("button",{onClick:()=>i(!r),children:r?"Hide details":"Show details"}),(0,O.jsxs)("div",{className:"tl-error-boundary__content__actions__group",children:[(0,O.jsx)("button",{className:"tl-error-boundary__reset",onClick:()=>l(!0),children:"Reset data"}),(0,O.jsx)("button",{className:"tl-error-boundary__refresh",onClick:()=>{eb()},children:"Refresh Page"})]})]})]})})]})},ev=({x:e,y:t,z:n,size:r})=>(0,O.jsxs)("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[(0,O.jsx)("defs",{children:L.dW.map(({min:i,mid:o,step:s},a)=>{let l=s*r*n,c=.5+e*n,u=.5+t*n,d=c>0?c%l:l+c%l,h=u>0?u%l:l+u%l,p=n<o?(0,M.vm)(n,[i,o],[0,1]):1;return(0,O.jsx)("pattern",{id:`grid-${s}`,width:l,height:l,patternUnits:"userSpaceOnUse",children:(0,O.jsx)("circle",{className:"tl-grid-dot",cx:d,cy:h,r:1,opacity:p})},`grid-pattern-${a}`)})}),L.dW.map(({step:e},t)=>(0,O.jsx)("rect",{width:"100%",height:"100%",fill:`url(#grid-${e})`},`grid-rect-${t}`))]}),eS=({handle:e,isCoarse:t,className:n,zoom:r})=>{let i=(t?L.Pr:L.rQ)/r,o=("create"===e.type&&t?3:4)/r;return(0,O.jsxs)("g",{className:D("tl-handle",{"tl-handle__virtual":"virtual"===e.type,"tl-handle__create":"create"===e.type},n),children:[(0,O.jsx)("circle",{className:"tl-handle__bg",r:i}),(0,O.jsx)("circle",{className:"tl-handle__fg",r:o})]})},ek=({children:e})=>(0,O.jsx)("svg",{className:"tl-user-handles tl-overlays__item",children:e}),e_=({shapeId:e})=>(0,O.jsx)(ea,{className:"tl-user-indicator__hovered",id:e});function eE(e,t=!0){let n=e.length;if(n<2)return"";let r=e[0],i=e[1];if(2===n)return`M${(0,eu.Yk)(r)}L${(0,eu.Yk)(i)}`;let o="";for(let t=2,s=n-1;t<s;t++)r=e[t],i=e[t+1],o+=(0,eu.Y8)(r,i);return t?`M${(0,eu.Y8)(e[0],e[1])}Q${(0,eu.Yk)(e[1])}${(0,eu.Y8)(e[1],e[2])}T${o}${(0,eu.Y8)(e[n-1],e[0])}${(0,eu.Y8)(e[0],e[1])}Z`:`M${(0,eu.Yk)(e[0])}Q${(0,eu.Yk)(e[1])}${(0,eu.Y8)(e[1],e[2])}${e.length>3?"T":""}${o}L${(0,eu.Yk)(e[n-1])}`}let eC=({scribble:e,zoom:t,color:n,opacity:r,className:i})=>e.points.length?(0,O.jsx)("svg",{className:i?D("tl-overlays__item",i):i,children:(0,O.jsx)("path",{className:"tl-scribble",d:eE(e.points,!1),stroke:n??`var(--color-${e.color})`,fill:"none",strokeWidth:8/t,opacity:r??e.opacity})}):null,eP=({bounds:e,rotation:t})=>{let n=$.useRef(null);return ec(n,e.x,e.y,1,t),$.useLayoutEffect(()=>{let t=n.current;t&&(t.style.width=(0,eu.$Z)(Math.max(1,e.width))+"px",t.style.height=(0,eu.$Z)(Math.max(1,e.height))+"px")},[e.width,e.height]),(0,O.jsx)("div",{ref:n,className:"tl-selection__bg",draggable:!1})},eT=({bounds:e,rotation:t})=>{let n=(0,G.j)(),r=(0,$.useRef)(null),i=(0,T.Hg)("only selected shape",()=>n.getOnlySelectedShape(),[n]),o=i?n.getShapeUtil(i).expandSelectionOutlinePx(i):0;return ec(r,e?.x,e?.y,1,t,{x:-o,y:-o}),e=e.clone().expandBy(o).zeroFix(),(0,O.jsx)("svg",{ref:r,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:(0,O.jsx)("rect",{className:D("tl-selection__fg__outline"),width:(0,eu.$Z)(e.width),height:(0,eu.$Z)(e.height)})})},ej=()=>(0,O.jsx)("div",{className:"tl-shape-error-boundary"}),eI=()=>(0,O.jsx)("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"});function eM({points:e,zoom:t}){let n,r,i,o;let s=2.5/t,a=e.reduce((e,t)=>Math.min(e,t.x),1/0),l=e.reduce((e,t)=>Math.max(e,t.x),-1/0),c=e.reduce((e,t)=>Math.min(e,t.y),1/0),u=e.reduce((e,t)=>Math.max(e,t.y),-1/0);return e.some(e=>e.x===a&&e.y===c)?(n=a,r=c,i=l,o=u):(n=a,r=u,i=l,o=c),(0,O.jsxs)("g",{className:"tl-snap-line",children:[(0,O.jsx)("line",{x1:n,y1:r,x2:i,y2:o}),e.map((e,t)=>(0,O.jsx)("g",{transform:`translate(${e.x},${e.y})`,children:(0,O.jsx)("path",{className:"tl-snap-point",d:`M ${-s},${-s} L ${s},${s} M ${-s},${s} L ${s},${-s}`})},t))]})}function eA({gaps:e,direction:t,zoom:n}){let r=3.5/n,i=[-1/0,1/0],o=null,s="horizontal"===t;for(let t of e)(o=(0,eu.mW)(i[0],i[1],s?t.startEdge[0].y:t.startEdge[0].x,s?t.startEdge[1].y:t.startEdge[1].x))&&(i=o,(o=(0,eu.mW)(i[0],i[1],s?t.endEdge[0].y:t.endEdge[0].x,s?t.endEdge[1].y:t.endEdge[1].x))&&(i=o));if(null===i)return null;let a=(i[0]+i[1])/2;return(0,O.jsx)("g",{className:"tl-snap-line",children:e.map(({startEdge:e,endEdge:t},n)=>(0,O.jsx)($.Fragment,{children:s?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("line",{x1:e[0].x,y1:a-2*r,x2:e[1].x,y2:a+2*r}),(0,O.jsx)("line",{x1:t[0].x,y1:a-2*r,x2:t[1].x,y2:a+2*r}),(0,O.jsx)("line",{x1:e[0].x,y1:a,x2:t[0].x,y2:a}),(0,O.jsx)("line",{x1:(e[0].x+t[0].x)/2,y1:a-r,x2:(e[0].x+t[0].x)/2,y2:a+r})]}):(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("line",{x1:a-2*r,y1:e[0].y,x2:a+2*r,y2:e[1].y}),(0,O.jsx)("line",{x1:a-2*r,y1:t[0].y,x2:a+2*r,y2:t[1].y}),(0,O.jsx)("line",{x1:a,y1:e[0].y,x2:a,y2:t[0].y}),(0,O.jsx)("line",{x1:a-r,y1:(e[0].y+t[0].y)/2,x2:a+r,y2:(e[0].y+t[0].y)/2})]})},n))})}let eO=({className:e,line:t,zoom:n})=>(0,O.jsx)("svg",{className:D("tl-overlays__item",e),children:"points"===t.type?(0,O.jsx)(eM,{...t,zoom:n}):"gaps"===t.type?(0,O.jsx)(eA,{...t,zoom:n}):null}),e$=()=>(0,O.jsx)("svg",{width:16,height:16,viewBox:"0 0 16 16",children:(0,O.jsxs)("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[(0,O.jsx)("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"var(--color-text-1)"}),(0,O.jsx)("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"var(--color-text-1)",children:(0,O.jsx)("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})}),eB=()=>null,eD=(0,$.createContext)({});function eL({overrides:e,children:t}){return(0,O.jsx)(eD.Provider,{value:(0,$.useMemo)(()=>({Background:el,SvgDefs:eB,Brush:ed,ZoomBrush:ed,ScreenshotBrush:ed,CollaboratorBrush:ed,Cursor:ef,CollaboratorCursor:ef,CollaboratorHint:ep,CollaboratorShapeIndicator:ea,Grid:ev,Scribble:eC,SnapLine:eO,Handles:ek,Handle:eS,CollaboratorScribble:eC,ErrorFallback:ex,ShapeErrorFallback:ej,ShapeIndicatorErrorFallback:eI,Spinner:e$,SelectionBackground:eP,SelectionForeground:eT,HoveredShapeIndicator:e_,OnTheCanvas:null,InFrontOfTheCanvas:null,...e}),[e]),children:t})}function eR(){return(0,$.useContext)(eD)}let ez=["textarea","input"],eN={toVector:(e,t)=>(void 0===e&&(e=t),Array.isArray(e)?e:[e,e]),add:(e,t)=>[e[0]+t[0],e[1]+t[1]],sub:(e,t)=>[e[0]-t[0],e[1]-t[1]],addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function eF(e,t,n){return 0===t||Math.abs(t)===1/0?Math.pow(e,5*n):e*t*n/(t+n*e)}function eU(e,t,n,r=.15){return 0===r?Math.max(t,Math.min(e,n)):e<t?-eF(t-e,n-t,r)+t:e>n?+eF(e-n,n-t,r)+n:e}function eV(e,t,n){var r;return(t="symbol"==typeof(r=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?r:String(r))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function eH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eZ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eH(Object(n),!0).forEach(function(t){eV(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eH(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let eK={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function eW(e){return e?e[0].toUpperCase()+e.slice(1):""}let eY=["enter","leave"],eG=["gotpointercapture","lostpointercapture"];function eX(e){return"touches"in e}function eq(e,t){try{let n=t.clientX-e.clientX,r=t.clientY-e.clientY,i=(t.clientX+e.clientX)/2,o=(t.clientY+e.clientY)/2;return{angle:-(180*Math.atan2(n,r))/Math.PI,distance:Math.hypot(n,r),origin:[i,o]}}catch(e){}return null}function eJ(e,t){let[n,r]=Array.from(e.touches).filter(e=>t.includes(e.identifier));return eq(n,r)}function eQ(e){let{deltaX:t,deltaY:n,deltaMode:r}=e;return 1===r?(t*=40,n*=40):2===r&&(t*=800,n*=800),[t,n]}function e0(e,...t){return"function"==typeof e?e(...t):e}function e1(){}function e2(e,t){return Object.assign({},t,e||{})}class e5{constructor(e,t,n){this.ctrl=e,this.args=t,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){let{state:e,shared:t,ingKey:n,args:r}=this;t[n]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=r,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){let t=this.state,n=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=n.from?e0(n.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){let t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){let e=this.state;e._initial=e._values,e.initial=e.values}compute(e){let{state:t,config:n,shared:r}=this;t.args=this.args;let i=0;if(e&&(t.event=e,n.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,r.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,r.locked=!!document.pointerLockElement,Object.assign(r,function(e){let t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){let{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o}=e;Object.assign(t,{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o})}return t}(e)),r.down=r.pressed=r.buttons%2==1||r.touches>0,i=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){let e=t._delta.map(Math.abs);eN.addTo(t._distance,e)}this.axisIntent&&this.axisIntent(e);let[o,s]=t._movement,[a,l]=n.threshold,{_step:c,values:u}=t;if(n.hasCustomTransform?(!1===c[0]&&(c[0]=Math.abs(o)>=a&&u[0]),!1===c[1]&&(c[1]=Math.abs(s)>=l&&u[1])):(!1===c[0]&&(c[0]=Math.abs(o)>=a&&Math.sign(o)*a),!1===c[1]&&(c[1]=Math.abs(s)>=l&&Math.sign(s)*l)),t.intentional=!1!==c[0]||!1!==c[1],!t.intentional)return;let d=[0,0];if(n.hasCustomTransform){let[e,t]=u;d[0]=!1!==c[0]?e-c[0]:0,d[1]=!1!==c[1]?t-c[1]:0}else d[0]=!1!==c[0]?o-c[0]:0,d[1]=!1!==c[1]?s-c[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(d);let h=t.offset,p=t._active&&!t._blocked||t.active;p&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=r[this.ingKey]=t._active,e&&(t.first&&("bounds"in n&&(t._bounds=e0(n.bounds,t)),this.setup&&this.setup()),t.movement=d,this.computeOffset()));let[f,g]=t.offset,[[m,y],[b,w]]=t._bounds;t.overflow=[f<m?-1:f>y?1:0,g<b?-1:g>w?1:0],t._movementBound[0]=!!t.overflow[0]&&(!1===t._movementBound[0]?t._movement[0]:t._movementBound[0]),t._movementBound[1]=!!t.overflow[1]&&(!1===t._movementBound[1]?t._movement[1]:t._movementBound[1]);let x=t._active&&n.rubberband||[0,0];if(t.offset=function(e,[t,n],[r,i]){let[[o,s],[a,l]]=e;return[eU(t,o,s,r),eU(n,a,l,i)]}(t._bounds,t.offset,x),t.delta=eN.sub(t.offset,h),this.computeMovement(),p&&(!t.last||i>32)){t.delta=eN.sub(t.offset,h);let e=t.delta.map(Math.abs);eN.addTo(t.distance,e),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&i>0&&(t.velocity=[e[0]/i,e[1]/i],t.timeDelta=i)}}emit(){let e=this.state,t=this.shared,n=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!n.triggerAllEvents)return;let r=this.handler(eZ(eZ(eZ({},t),e),{},{[this.aliasKey]:e.values}));void 0!==r&&(e.memo=r)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}class e3 extends e5{constructor(...e){super(...e),eV(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=eN.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=eN.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){let t=this.state,n=this.config;if(!t.axis&&e){let r="object"==typeof n.axisThreshold?n.axisThreshold[eX(e)?"touch":"pointerType"in e?e.pointerType:"mouse"]:n.axisThreshold;t.axis=function([e,t],n){let r=Math.abs(e),i=Math.abs(t);return r>i&&r>n?"x":i>r&&i>n?"y":void 0}(t._movement,r)}t._blocked=(n.lockDirection||!!n.axis)&&!t.axis||!!n.axis&&n.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0}}}let e8=e=>e,e4={enabled:(e=!0)=>e,eventOptions:(e,t,n)=>eZ(eZ({},n.shared.eventOptions),e),preventDefault:(e=!1)=>e,triggerAllEvents:(e=!1)=>e,rubberband(e=0){switch(e){case!0:return[.15,.15];case!1:return[0,0];default:return eN.toVector(e)}},from:e=>"function"==typeof e?e:null!=e?eN.toVector(e):void 0,transform(e,t,n){let r=e||n.shared.transform;return this.hasCustomTransform=!!r,r||e8},threshold:e=>eN.toVector(e,0)},e6=0,e9=eZ(eZ({},e4),{},{axis(e,t,{axis:n}){if(this.lockDirection="lock"===n,!this.lockDirection)return n},axisThreshold:(e=e6)=>e,bounds(e={}){if("function"==typeof e)return t=>e9.bounds(e(t));if("current"in e)return()=>e.current;if("function"==typeof HTMLElement&&e instanceof HTMLElement)return e;let{left:t=-1/0,right:n=1/0,top:r=-1/0,bottom:i=1/0}=e;return[[t,n],[r,i]]}}),e7="undefined"!=typeof window&&window.document&&window.document.createElement;function te(){return e7&&"ontouchstart"in window}let tt={isBrowser:e7,gesture:function(){try{return"constructor"in GestureEvent}catch(e){return!1}}(),touch:te(),touchscreen:te()||e7&&window.navigator.maxTouchPoints>1,pointer:e7&&"onpointerdown"in window,pointerLock:e7&&"exitPointerLock"in window.document},tn=10,tr={mouse:0,touch:0,pen:8};function ti(e){let[t,n]=e.overflow,[r,i]=e._delta,[o,s]=e._direction;(t<0&&r>0&&o<0||t>0&&r<0&&o>0)&&(e._movement[0]=e._movementBound[0]),(n<0&&i>0&&s<0||n>0&&i<0&&s>0)&&(e._movement[1]=e._movementBound[1])}eZ(eZ({},e9),{},{device(e,t,{pointer:{touch:n=!1,lock:r=!1,mouse:i=!1}={}}){return(this.pointerLock=r&&tt.pointerLock,tt.touch&&n)?"touch":this.pointerLock?"mouse":tt.pointer&&!i?"pointer":tt.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:n}){if(this.preventScrollDelay="number"==typeof n?n:n||void 0===n&&e?250:void 0,tt.touchscreen&&!1!==n)return e||(void 0!==n?"y":void 0)},pointerCapture(e,t,{pointer:{capture:n=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&"pointer"===this.device&&n},threshold(e,t,{filterTaps:n=!1,tapsThreshold:r=3,axis:i}){let o=eN.toVector(e,n?r:i?1:0);return this.filterTaps=n,this.tapsThreshold=r,o},swipe({velocity:e=.5,distance:t=50,duration:n=250}={}){return{velocity:this.transform(eN.toVector(e)),distance:this.transform(eN.toVector(t)),duration:n}},delay(e=0){switch(e){case!0:return 180;case!1:return 0;default:return e}},axisThreshold:e=>e?eZ(eZ({},tr),e):tr,keyboardDisplacement:(e=tn)=>e});class to extends e5{constructor(...e){super(...e),eV(this,"ingKey","pinching"),eV(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();let e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){let{type:e,movement:t,lastOffset:n}=this.state;"wheel"===e?this.state.offset=eN.add(t,n):this.state.offset=[(1+t[0])*n[0],t[1]+n[1]]}computeMovement(){let{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){let e=this.state,[t,n]=e._movement;if(!e.axis){let r=30*Math.abs(t)-Math.abs(n);r<0?e.axis="angle":r>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&("scale"===this.state.axis?e[1]=0:"angle"===this.state.axis&&(e[0]=0))}cancel(){let e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);let t=this.state,n=this.ctrl.touchIds;if(t._active&&t._touchIds.every(e=>n.has(e))||n.size<2)return;this.start(e),t._touchIds=Array.from(n).slice(0,2);let r=eJ(e,t._touchIds);r&&this.pinchStart(e,r)}pointerStart(e){if(null!=e.buttons&&e.buttons%2!=1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);let t=this.state,n=t._pointerEvents,r=this.ctrl.pointerIds;if(t._active&&Array.from(n.keys()).every(e=>r.has(e))||(n.size<2&&n.set(e.pointerId,e),t._pointerEvents.size<2))return;this.start(e);let i=eq(...Array.from(n.values()));i&&this.pinchStart(e,i)}pinchStart(e,t){this.state.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;let t=eJ(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){let t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;let n=eq(...Array.from(t.values()));n&&this.pinchMove(e,n)}pinchMove(e,t){let n=this.state,r=n._values[1],i=t.angle-r,o=0;Math.abs(i)>270&&(o+=Math.sign(i)),this.computeValues([t.distance,t.angle-360*o]),n.origin=t.origin,n.turns=o,n._movement=[n._values[0]/n._initial[0]-1,n._values[1]-n._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(e=>!this.ctrl.touchIds.has(e))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){let t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch(e){}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();let t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;let t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];let n=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=eN.sub(t._movement,n),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){let t=this.config.modifierKey;(!t||(Array.isArray(t)?t.find(t=>e[t]):e[t]))&&(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||!e.cancelable||e.preventDefault();let t=this.state;t._delta=[-eQ(e)[1]/100*t.offset[0],0],eN.addTo(t._movement,t._delta),ti(t),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){let t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}let ts=eZ(eZ({},e4),{},{device(e,t,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!tt.touch&&tt.gesture)return"gesture";if(tt.touch&&r)return"touch";if(tt.touchscreen){if(tt.pointer)return"pointer";if(tt.touch)return"touch"}},bounds(e,t,{scaleBounds:n={},angleBounds:r={}}){let i=e=>{let t=e2(e0(n,e),{min:-1/0,max:1/0});return[t.min,t.max]},o=e=>{let t=e2(e0(r,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!=typeof n&&"function"!=typeof r?[i(),o()]:e=>[i(e),o(e)]},threshold(e,t,n){return this.lockDirection="lock"===n.axis,eN.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey:e=>void 0===e?"ctrlKey":e,pinchOnWheel:(e=!0)=>e});eZ(eZ({},e9),{},{mouseOnly:(e=!0)=>e});class ta extends e3{constructor(...e){super(...e),eV(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){let t=this.state;t._delta=eQ(e),eN.addTo(t._movement,t._delta),ti(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}eZ(eZ({},e9),{},{mouseOnly:(e=!0)=>e});let tl=new Map,tc=new Map,tu={target(e){if(e)return()=>"current"in e?e.current:e},enabled:(e=!0)=>e,window:(e=tt.isBrowser?window:void 0)=>e,eventOptions:({passive:e=!0,capture:t=!1}={})=>({passive:e,capture:t}),transform:e=>e},td=["target","eventOptions","window","enabled","transform"];function th(e={},t){let n={};for(let[r,i]of Object.entries(t))switch(typeof i){case"function":n[r]=i.call(n,e[r],r,e);break;case"object":n[r]=th(e[r],i);break;case"boolean":i&&(n[r]=e[r])}return n}class tp{constructor(e,t){eV(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,n,r,i){let o=this._listeners,s=function(e,t=""){let n=eK[e];return e+(n&&n[t]||t)}(t,n),a=eZ(eZ({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),i);e.addEventListener(s,r,a);let l=()=>{e.removeEventListener(s,r,a),o.delete(l)};return o.add(l),l}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class tf{constructor(){eV(this,"_timeouts",new Map)}add(e,t,n=140,...r){this.remove(e),this._timeouts.set(e,window.setTimeout(t,n,...r))}remove(e){let t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class tg{constructor(e){eV(this,"gestures",new Set),eV(this,"_targetEventStore",new tp(this)),eV(this,"gestureEventStores",{}),eV(this,"gestureTimeoutStores",{}),eV(this,"handlers",{}),eV(this,"config",{}),eV(this,"pointerIds",new Set),eV(this,"touchIds",new Set),eV(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),e.drag&&tm(this,"drag"),e.wheel&&tm(this,"wheel"),e.scroll&&tm(this,"scroll"),e.move&&tm(this,"move"),e.pinch&&tm(this,"pinch"),e.hover&&tm(this,"hover")}setEventIds(e){return eX(e)?(this.touchIds=new Set(Array.from(e.touches).filter(t=>{var n,r;return t.target===e.currentTarget||(null===(n=e.currentTarget)||void 0===n||null===(r=n.contains)||void 0===r?void 0:r.call(n,t.target))}).map(e=>e.identifier)),this.touchIds):"pointerId"in e?("pointerup"===e.type||"pointercancel"===e.type?this.pointerIds.delete(e.pointerId):"pointerdown"===e.type&&this.pointerIds.add(e.pointerId),this.pointerIds):void 0}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=function(e,t,n={}){let{target:r,eventOptions:i,window:o,enabled:s,transform:a}=e,l=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,td);if(n.shared=th({target:r,eventOptions:i,window:o,enabled:s,transform:a},tu),t){let e=tc.get(t);n[t]=th(eZ({shared:n.shared},l),e)}else for(let e in l){let t=tc.get(e);t&&(n[e]=th(eZ({shared:n.shared},l[e]),t))}return n}(e,t,this.config)}clean(){for(let e of(this._targetEventStore.clean(),this.gestures))this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){let t;let n=this.config.shared,r={};if(!n.target||(t=n.target())){if(n.enabled){for(let n of this.gestures){let i=this.config[n],o=ty(r,i.eventOptions,!!t);i.enabled&&new(tl.get(n))(this,e,n).bind(o)}let i=ty(r,n.eventOptions,!!t);for(let t in this.nativeHandlers)i(t,"",n=>this.nativeHandlers[t](eZ(eZ({},this.state.shared),{},{event:n,args:e})),void 0,!0)}for(let e in r)r[e]=function(...e){return 0===e.length?e1:1===e.length?e[0]:function(){let t;for(let n of e)t=n.apply(this,arguments)||t;return t}}(...r[e]);if(!t)return r;for(let e in r){let{device:n,capture:i,passive:o}=function(e){let t=e.substring(2).toLowerCase(),n=!!~t.indexOf("passive");n&&(t=t.replace("passive",""));let r=eG.includes(t)?"capturecapture":"capture",i=!!~t.indexOf(r);return i&&(t=t.replace("capture","")),{device:t,capture:i,passive:n}}(e);this._targetEventStore.add(t,n,"",r[e],{capture:i,passive:o})}}}}function tm(e,t){e.gestures.add(t),e.gestureEventStores[t]=new tp(e,t),e.gestureTimeoutStores[t]=new tf}let ty=(e,t,n)=>(r,i,o,s={},a=!1)=>{var l,c;let u=null!==(l=s.capture)&&void 0!==l?l:t.capture,d=null!==(c=s.passive)&&void 0!==c?c:t.passive,h=a?r:function(e,t="",n=!1){let r=eK[e],i=r&&r[t]||t;return"on"+eW(e)+eW(i)+(!function(e=!1,t){return e&&!eY.includes(t)}(n,i)?"":"Capture")}(r,i,u);n&&d&&(h+="Passive"),e[h]=e[h]||[],e[h].push(o)},tb=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function tw(e,t,n,r,i,o){if(!e.has(n)||!tl.has(r))return;let s=n+"Start",a=n+"End";i[r]=e=>{let r;return e.first&&s in t&&t[s](e),n in t&&(r=t[n](e)),e.last&&a in t&&t[a](e),r},o[r]=o[r]||{}}n(2492);let tx=/Mac|iPod|iPhone|iPad/.test("undefined"==typeof window?"node":window.navigator.platform);function tv(e){let{deltaY:t,deltaX:n}=e,r=0;if(e.ctrlKey||e.altKey||e.metaKey){let n=Math.sign(e.deltaY),i=Math.abs(e.deltaY),o=t;i>10&&(o=10*n),r=o/100}else e.shiftKey&&!tx&&(n=t,t=0);return{x:-n,y:-t,z:-r}}let tS=([{key:"wheel",engine:ta,resolver:e9},{key:"pinch",engine:to,resolver:ts}].forEach(function(e){tl.set(e.key,e.engine),tc.set(e.key,e.resolver)}),function(e,t){let{handlers:n,nativeHandlers:r,config:i}=function(e,t){let[n,r,i]=function(e){let t={},n={},r=new Set;for(let i in e)tb.test(i)?(r.add(RegExp.lastMatch),n[i]=e[i]):t[i]=e[i];return[n,t,r]}(e),o={};return tw(i,n,"onDrag","drag",o,t),tw(i,n,"onWheel","wheel",o,t),tw(i,n,"onScroll","scroll",o,t),tw(i,n,"onPinch","pinch",o,t),tw(i,n,"onMove","move",o,t),tw(i,n,"onHover","hover",o,t),{handlers:o,config:t,nativeHandlers:r}}(e,t||{});return function(e,t={},n,r){let i=$.useMemo(()=>new tg(e),[]);if(i.applyHandlers(e,r),i.applyConfig(t,n),$.useEffect(i.effect.bind(i)),$.useEffect(()=>i.clean.bind(i),[]),void 0===t.target)return i.bind.bind(i)}(n,i,void 0,r)}),tk=e=>void 0===s?(s=e,!1):e-s>120&&e-s<160?(s=e,!0):(s=e,!1);function t_(e,t,n){let r=e.getShape(t),i=e.getShapeHandles(r);return{shape:r,handle:i.find(e=>e.id===n)}}var tE=n(7701),tC=n(7802),tP=n(3072);let tT=(0,T.j)(function({showStroke:e=!0,showVertices:t=!0,showClosestPointOnOutline:n=!0}){let r=(0,G.j)();!function(e=!0){let[t,n]=(0,$.useState)(0),r=(0,G.j)();(0,$.useEffect)(()=>{if(!e)return;let t=()=>n(e=>e+1);return r.on("tick",t),()=>{r.off("tick",t)}},[r,e])}(n);let i=r.getZoomLevel(),o=r.getRenderingShapes(),{inputs:{currentPagePoint:s}}=r;return(0,O.jsx)("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:o.map(o=>{let a=r.getShape(o.id);if("group"===a.type)return null;let l=r.getShapeGeometry(a),c=r.getShapePageTransform(a),u=r.getPointInShapeSpace(a,s),d=l.nearestPoint(u),h=l.distanceToPoint(u,!0),p=Math.abs(h)*i,{vertices:f}=l;return(0,O.jsxs)("g",{transform:c.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[e&&(0,O.jsx)(tj,{geometry:l}),t&&f.map((e,t)=>(0,O.jsx)("circle",{cx:e.x,cy:e.y,r:"2",fill:`hsl(${(0,M.vm)(t,[0,f.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:"1"},`v${t}`)),n&&p<150&&(0,O.jsx)("line",{x1:d.x,y1:d.y,x2:u.x,y2:u.y,opacity:1-p/150,stroke:h<0?"goldenrod":"dodgerblue",strokeWidth:"2"})]},o.id+"_outline")})})});function tj({geometry:e}){return e instanceof tP.m?(0,O.jsx)(O.Fragment,{children:[...e.children,...e.ignoredChildren].map((e,t)=>(0,O.jsx)(tj,{geometry:e},t))}):(0,O.jsx)("path",{stroke:e.debugColor??"red",strokeWidth:"2",fill:"none",opacity:"1",d:e.toSimpleSvgPath()})}var tI=n(4408);function tM(e){return tI(e)}function tA(){let e=(0,G.j)(),t=(0,$.useMemo)(()=>e.store.query.records("instance_presence",()=>({userId:{neq:e.user.getId()}})),[e]),n=(0,T.vc)("userIds",()=>tI(t.get().map(e=>e.userId)).sort(),{isEqual:(e,t)=>e.join(",")===t.join?.(",")},[t]);return(0,T.Hg)(n)}function tO(e){let t=(0,G.j)(),n=(0,$.useMemo)(()=>t.store.query.records("instance_presence",()=>({userId:{eq:e}})),[t,e]);return(0,T.Hg)(`latestPresence:${e}`,()=>n.get().slice().sort((e,t)=>t.lastActivityTimestamp-e.lastActivityTimestamp)[0],[])??null}let t$=(0,T.j)(function(){let e=tA();return(0,O.jsx)(O.Fragment,{children:e.map(e=>(0,O.jsx)(tB,{collaboratorId:e},e))})}),tB=(0,T.j)(function({collaboratorId:e}){let t=(0,G.j)(),n=tO(e),r=function(e){let t=(0,$.useRef)(e?.lastActivityTimestamp??-1),[n,r]=(0,$.useState)(()=>tL(Date.now()-t.current));return(0,$.useEffect)(()=>{let e=setInterval(()=>{r(tL(Date.now()-t.current))},L.MN);return()=>clearInterval(e)},[]),e&&(t.current=e.lastActivityTimestamp),n}(n);if(!(n&&n.currentPageId===t.getCurrentPageId()))return null;switch(r){case"inactive":{let{followingUserId:e,highlightedUserIds:r}=t.getInstanceState();if(!(e===n.userId||r.includes(n.userId)))return null;break}case"idle":{let{highlightedUserIds:e}=t.getInstanceState();if(n.followingUserId===t.user.getId()&&!(n.chatMessage||e.includes(n.userId)))return null}}return(0,O.jsx)(tD,{latestPresence:n})}),tD=(0,T.j)(function({latestPresence:e}){let t=(0,G.j)(),{CollaboratorBrush:n,CollaboratorScribble:r,CollaboratorCursor:i,CollaboratorHint:o,CollaboratorShapeIndicator:s}=eR(),a=t.getZoomLevel(),l=t.getViewportPageBounds(),{userId:c,chatMessage:u,brush:d,scribbles:h,selectedShapeIds:p,userName:f,cursor:g,color:m}=e,y=!(g.x<l.minX-12/a||g.y<l.minY-16/a||g.x>l.maxX-12/a||g.y>l.maxY-16/a);return(0,O.jsxs)(O.Fragment,{children:[d&&n?(0,O.jsx)(n,{className:"tl-collaborator__brush",brush:d,color:m,opacity:.1},c+"_brush"):null,y&&i?(0,O.jsx)(i,{className:"tl-collaborator__cursor",point:g,color:m,zoom:a,name:"New User"!==f?f:null,chatMessage:u},c+"_cursor"):o?(0,O.jsx)(o,{className:"tl-collaborator__cursor-hint",point:g,color:m,zoom:a,viewport:l},c+"_cursor_hint"):null,r&&h.length?(0,O.jsx)(O.Fragment,{children:h.map(e=>(0,O.jsx)(r,{className:"tl-collaborator__scribble",scribble:e,color:m,zoom:a,opacity:"laser"===e.color?.5:.1},c+"_scribble_"+e.id))}):null,s&&p.map(e=>(0,O.jsx)(s,{className:"tl-collaborator__shape-indicator",id:e,color:m,opacity:.5},c+"_"+e))]})});function tL(e){return e>L.RZ?"inactive":e>L.O8?"idle":"active"}let tR=(0,T.j)(function({id:e,shape:t,util:n,index:r,backgroundIndex:i,opacity:o,isCulled:s}){let a=(0,G.j)(),{ShapeErrorFallback:l}=eR(),c=$.useRef(null),u=$.useRef(null),d=$.useCallback((e,t)=>{c.current?.style.setProperty(e,t),u.current?.style.setProperty(e,t)},[]);(0,T.BK)("set shape container transform position",()=>{if(!a.getShape(e))return;let t=a.getShapePageTransform(e);d("transform",tC._.toCssString(t))},[a,d]),(0,T.BK)("set shape container clip path",()=>{if(!a.getShape(e))return null;d("clip-path",a.getShapeClipPath(e)??"none")},[a,d]),(0,T.BK)("set shape height and width",()=>{let t=a.getShape(e);if(!t)return null;let n=a.getShapeGeometry(t).bounds,r=function(e){let t=e.toString().split(".")[1];if(!t)return 1;let n=Math.pow(10,t.length);return n/function e(t,n){return 0===n?t:e(n,t%n)}(parseInt(t,10),n)}(Math.floor(100*a.getInstanceState().devicePixelRatio)/100),i=n.w%r,o=0===i?n.w:n.w+(r-i),s=n.h%r,l=0===s?n.h:n.h+(r-s);d("width",Math.max(o,r)+"px"),d("height",Math.max(l,r)+"px")},[a]),$.useLayoutEffect(()=>{d("opacity",o+""),c.current?.style.setProperty("z-index",r+""),u.current?.style.setProperty("z-index",i+"")},[o,r,i,d]);let h=$.useCallback(e=>{a.annotateError(e,{origin:"react.shape",willCrashApp:!1})},[a]);return t?(0,O.jsxs)(O.Fragment,{children:[n.backgroundComponent&&(0,O.jsx)("div",{ref:u,className:"tl-shape tl-shape-background","data-shape-type":t.type,draggable:!1,children:!s&&(0,O.jsx)(er,{fallback:l,onError:h,children:(0,O.jsx)(tN,{shape:t,util:n})})}),(0,O.jsx)("div",{ref:c,className:"tl-shape","data-shape-type":t.type,draggable:!1,children:s?(0,O.jsx)(tF,{shape:t}):(0,O.jsx)(er,{fallback:l,onError:h,children:(0,O.jsx)(tz,{shape:t,util:n})})})]}):null}),tz=$.memo(function({shape:e,util:t}){return(0,T.uC)("InnerShape:"+e.type,()=>t.component(e))},(e,t)=>e.shape.props===t.shape.props&&e.shape.meta===t.shape.meta&&e.util===t.util),tN=$.memo(function({shape:e,util:t}){return(0,T.uC)("InnerShape:"+e.type,()=>t.backgroundComponent?.(e))},(e,t)=>e.shape.props===t.shape.props&&e.shape.meta===t.shape.meta),tF=$.memo(function({shape:e}){let t=(0,G.j)().getShapeGeometry(e).bounds;return(0,O.jsx)("div",{className:"tl-shape__culled",style:{transform:`translate(${(0,eu.$Z)(t.minX)}px, ${(0,eu.$Z)(t.minY)}px)`,width:Math.max(1,(0,eu.$Z)(t.width)),height:Math.max(1,(0,eu.$Z)(t.height))}})},()=>!0);function tU({className:e}){let t=(0,G.j)(),{Background:n,SvgDefs:r}=eR(),i=$.useRef(null),o=$.useRef(null),s=$.useRef(null);!function(){let e=(0,G.j)();(0,$.useLayoutEffect)(()=>{let t=tE(()=>{e.updateViewportScreenBounds()},200,{trailing:!0});e.updateViewportScreenBounds();let n=setInterval(t,1e3);return window.addEventListener("resize",t),window.addEventListener("scroll",t),()=>{clearInterval(n),window.removeEventListener("resize",t),window.removeEventListener("scroll",t)}},[e])}(),function(){let e=(0,G.j)(),t=J(),n=(0,T.Hg)("isFocused",()=>e.getInstanceState().isFocused,[e]);(0,$.useEffect)(()=>{let t=null,n=()=>{null!=t&&t();let r=matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),i=e=>{"change"===e.type&&n()};r.addEventListener?r.addEventListener("change",n):r.addListener&&r.addListener(i),t=()=>{r.removeEventListener?r.removeEventListener("change",n):r.removeListener&&r.removeListener(i)},e.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return n(),()=>{t?.()}},[e]),(0,$.useEffect)(()=>{if(!n)return;let r=n=>{if(n.altKey&&(e.isIn("zoom")||!e.getPath().endsWith(".idle"))&&!ee()&&H(n),n.isKilled)return;switch(n.isKilled=!0,n.key){case"=":case"-":case"0":if(n.metaKey||n.ctrlKey){H(n);return}break;case"Tab":default:if(ee()||e.getIsMenuOpen())return;break;case",":return;case"Escape":if((e.getEditingShape()||e.getSelectedShapeIds().length>0)&&n.preventDefault(),e.getOpenMenus().length>0)return;e.inputs.keys.has("Escape")||(e.inputs.keys.add("Escape"),e.cancel(),t.focus());return}let r={type:"keyboard",name:n.repeat?"key_repeat":"key_down",key:n.key,code:n.code,shiftKey:n.shiftKey,altKey:n.altKey,ctrlKey:n.metaKey||n.ctrlKey};e.dispatch(r)},i=t=>{if(t.isKilled||(t.isKilled=!0,ee()||e.getIsMenuOpen()||","===t.key))return;let n={type:"keyboard",name:"key_up",key:t.key,code:t.code,shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey};e.dispatch(n)};function o(n){if(t.contains(n.target)){let t=n.touches[0].pageX,r=n.touches[0].radiusX||0;(t-r<10||t+r>e.getViewportScreenBounds().width-10)&&(n.target?.tagName==="BUTTON"&&n.target?.click(),H(n))}}let s=e=>{t.contains(e.target)&&(e.ctrlKey||e.metaKey)&&H(e)};return t.addEventListener("touchstart",o,{passive:!1}),t.addEventListener("wheel",s,{passive:!1}),document.addEventListener("gesturestart",H),document.addEventListener("gesturechange",H),document.addEventListener("gestureend",H),t.addEventListener("keydown",r),t.addEventListener("keyup",i),()=>{t.removeEventListener("touchstart",o),t.removeEventListener("wheel",s),document.removeEventListener("gesturestart",H),document.removeEventListener("gesturechange",H),document.removeEventListener("gestureend",H),t.removeEventListener("keydown",r),t.removeEventListener("keyup",i)}},[e,t,n])}(),function(){let e=(0,G.j)();(0,$.useEffect)(()=>{if(e.environment.isFirefox&&!e.environment.isAndroid&&!e.environment.isIos){e.updateInstanceState({isCoarsePointer:!1});return}if(window.matchMedia){let t=window.matchMedia("(pointer: coarse)"),n=()=>{e.updateInstanceState({isCoarsePointer:!!t.matches})};if(n(),t)return t.addEventListener("change",n),()=>t.removeEventListener("change",n)}},[e])}(),function(e){let t=(0,G.j)();tS($.useMemo(()=>{let n="not sure",r=1,i=1,o=1,s=0,a=new eh.B,l=new eh.B,c=e=>{if(e&&(n="zooming"),"zooming"===n)return;let t=Math.abs(s-r),i=eh.B.Dist(a,l);switch(n){case"not sure":t>24?n="zooming":i>16&&(n="panning");break;case"panning":t>64&&(n="zooming")}};return{onWheel:({event:e})=>{if(!t.getInstanceState().isFocused||(n="not sure",tk(Date.now())))return;let r=t.getEditingShapeId();if(r){let e=t.getShape(r);if(e&&t.getShapeUtil(e).canScroll(e)){let e=t.getShapePageBounds(r);if(e?.containsPoint(t.inputs.currentPagePoint))return}}H(e);let i=tv(e);if(0===i.x&&0===i.y)return;let o={type:"wheel",name:"wheel",delta:i,point:new eh.B(e.clientX,e.clientY),shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey};t.dispatch(o)},onPinchStart:o=>{let s=e.current;n="not sure";let{event:c,origin:u,da:d}=o;!(c instanceof WheelEvent)&&(c.target===s||s?.contains(c.target))&&(l.x=u[0],l.y=u[1],a.x=u[0],a.y=u[1],r=d[0],i=t.getZoomLevel(),t.dispatch({type:"pinch",name:"pinch_start",point:{x:u[0],y:u[1],z:t.getZoomLevel()},delta:{x:0,y:0},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey}))},onPinchEnd:r=>{let i=e.current,{event:o,origin:s,offset:a}=r;if(o instanceof WheelEvent||!(o.target===i||i?.contains(o.target)))return;let l=a[0];n="not sure",requestAnimationFrame(()=>{t.dispatch({type:"pinch",name:"pinch_end",point:{x:s[0],y:s[1],z:l},delta:{x:s[0],y:s[1]},shiftKey:o.shiftKey,altKey:o.altKey,ctrlKey:o.metaKey||o.ctrlKey})})},onPinch:r=>{let a=e.current,{event:u,origin:d,offset:h,da:p}=r;if(u instanceof WheelEvent||!(u.target===a||a?.contains(u.target)))return;let f="gesturechange"===r.type||"gestureend"===r.type;s=p[0];let g=d[0]-l.x,m=d[1]-l.y;switch(l.x=d[0],l.y=d[1],c(f),n){case"zooming":o=h[0],t.dispatch({type:"pinch",name:"pinch",point:{x:d[0],y:d[1],z:o},delta:{x:g,y:m},shiftKey:u.shiftKey,altKey:u.altKey,ctrlKey:u.metaKey||u.ctrlKey});break;case"panning":t.dispatch({type:"pinch",name:"pinch",point:{x:d[0],y:d[1],z:i},delta:{x:g,y:m},shiftKey:u.shiftKey,altKey:u.altKey,ctrlKey:u.metaKey||u.ctrlKey})}}}},[t,e]),{target:e,eventOptions:{passive:!1},pinch:{from:()=>[t.getZoomLevel(),0],scaleBounds:()=>({from:t.getZoomLevel(),max:8,min:.05})}})}(i),function(e){let t=(0,G.j)();(0,$.useEffect)(()=>{let n=e.current;if(!n)return;let r=e=>{if(e instanceof PointerEvent&&"pen"===e.pointerType){e.isKilled=!0;let{target:n}=e;ez.includes(n.tagName?.toLocaleLowerCase())||t.isIn("select.editing_shape")||H(e)}};return n.addEventListener("touchstart",r),n.addEventListener("touchend",r),()=>{n.removeEventListener("touchstart",r),n.removeEventListener("touchend",r)}},[t,e])}(i),(0,T.BK)("position layers",()=>{let e=o.current;if(!e)return;let n=s.current;if(!n)return;let{x:r,y:i,z:a}=t.getCamera(),l=a>=1?(0,M.vm)(a,[1,8],[.125,.5],!0):(0,M.vm)(a,[.1,1],[-2,.125],!0),c=`scale(${(0,eu.$Z)(a)}) translate(${(0,eu.$Z)(r+l)}px,${(0,eu.$Z)(i+l)}px)`;e.style.setProperty("transform",c),n.style.setProperty("transform",c)},[t]);let a=function(){let e=(0,G.j)();return(0,$.useMemo)(function(){let t,n;return{onPointerDown:function(t){if(!t.isKilled){if(2===t.button){e.dispatch({type:"pointer",target:"canvas",name:"right_click",...Y(t)});return}(0===t.button||1===t.button||5===t.button)&&(Z(t.currentTarget,t),e.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...Y(t)}),e.getOpenMenus().length>0&&(e.updateInstanceState({openMenus:[]}),document.body.click(),e.getContainer().focus()))}},onPointerMove:function(r){r.isKilled||r.clientX===t&&r.clientY===n||(t=r.clientX,n=r.clientY,e.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...Y(r)}))},onPointerUp:function(r){r.isKilled||0!==r.button&&1!==r.button&&2!==r.button&&5!==r.button||(t=r.clientX,n=r.clientY,K(r.currentTarget,r),e.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...Y(r)}))},onPointerEnter:function(t){if(t.isKilled||e.getInstanceState().isPenMode&&"pen"!==t.pointerType)return;let n="mouse"===t.pointerType||"pen"===t.pointerType;e.updateInstanceState({isHoveringCanvas:!!n||null})},onPointerLeave:function(t){if(t.isKilled||e.getInstanceState().isPenMode&&"pen"!==t.pointerType)return;let n="mouse"===t.pointerType||"pen"===t.pointerType;e.updateInstanceState({isHoveringCanvas:!n&&null})},onDragOver:function(e){H(e)},onDrop:async function(t){if(H(t),!t.dataTransfer?.files?.length)return;let n=Array.from(t.dataTransfer.files);await e.putExternalContent({type:"files",files:n,point:e.screenToPage({x:t.clientX,y:t.clientY}),ignoreParent:!1})},onTouchStart:function(e){e.isKilled=!0,document.body.click(),H(e)},onTouchEnd:function(e){e.isKilled=!0,"A"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&H(e)},onClick:function(e){W(e)}}},[e])}(),l=(0,T.Hg)("shapeSvgDefs",()=>{let e=new Map;for(let n of(0,M.UM)(t.shapeUtils)){if(!n)return;for(let{key:t,component:r}of n.getCanvasSvgDefs())e.has(t)||e.set(t,(0,O.jsx)(r,{},t))}return[...e.values()]},[t]),c=(0,T.Hg)("debug_shapes",()=>N.hideShapes.get(),[N]),u=(0,T.Hg)("debug_svg",()=>N.debugSvg.get(),[N]),d=(0,T.Hg)("debug_geometry",()=>N.debugGeometry.get(),[N]);return(0,O.jsxs)("div",{ref:i,draggable:!1,className:D("tl-canvas",e),"data-testid":"canvas",...a,children:[n&&(0,O.jsx)(n,{}),(0,O.jsx)(tV,{}),(0,O.jsx)(t4,{}),(0,O.jsx)("svg",{className:"tl-svg-context",children:(0,O.jsxs)("defs",{children:[l,t1&&(0,O.jsx)(t1,{}),(0,O.jsx)(t2,{}),(0,O.jsx)(t5,{}),(0,O.jsx)(t3,{}),r&&(0,O.jsx)(r,{})]})}),(0,O.jsxs)("div",{ref:o,className:"tl-html-layer tl-shapes",draggable:!1,children:[(0,O.jsx)(t7,{}),(0,O.jsx)(t9,{}),c?null:u?(0,O.jsx)(tX,{}):(0,O.jsx)(tq,{})]}),(0,O.jsxs)("div",{className:"tl-fixed-layer tl-overlays",children:[(0,O.jsxs)("div",{ref:s,className:"tl-html-layer",children:[d?(0,O.jsx)(tT,{}):null,(0,O.jsx)(tY,{}),(0,O.jsx)(tZ,{}),(0,O.jsx)(tH,{}),(0,O.jsx)(tK,{}),(0,O.jsx)(tJ,{}),(0,O.jsx)(tQ,{}),(0,O.jsx)(t0,{}),(0,O.jsx)(tW,{}),(0,O.jsx)(t6,{}),(0,O.jsx)(t$,{})]}),(0,O.jsx)(ne,{})]})]})}function tV(){let e=(0,G.j)(),t=(0,T.Hg)("gridSize",()=>e.getDocumentSettings().gridSize,[e]),{x:n,y:r,z:i}=(0,T.Hg)("camera",()=>e.getCamera(),[e]),o=(0,T.Hg)("isGridMode",()=>e.getInstanceState().isGridMode,[e]),{Grid:s}=eR();return s&&o?(0,O.jsx)(s,{x:n,y:r,z:i,size:t}):null}function tH(){let e=(0,G.j)(),t=(0,T.Hg)("scribbles",()=>e.getInstanceState().scribbles,[e]),n=(0,T.Hg)("zoomLevel",()=>e.getZoomLevel(),[e]),{Scribble:r}=eR();return r&&t.length?(0,O.jsx)(O.Fragment,{children:t.map(e=>(0,O.jsx)(r,{className:"tl-user-scribble",scribble:e,zoom:n},e.id))}):null}function tZ(){let e=(0,G.j)(),t=(0,T.Hg)("brush",()=>e.getInstanceState().brush,[e]),{Brush:n}=eR();return n&&t?(0,O.jsx)(n,{className:"tl-user-brush",brush:t}):null}function tK(){let e=(0,G.j)(),t=(0,T.Hg)("zoomBrush",()=>e.getInstanceState().zoomBrush,[e]),{ZoomBrush:n}=eR();return n&&t?(0,O.jsx)(n,{className:"tl-user-brush tl-zoom-brush",brush:t}):null}function tW(){let e=(0,G.j)(),t=(0,T.Hg)("snapLines",()=>e.snaps.getLines(),[e]),n=(0,T.Hg)("zoomLevel",()=>e.getZoomLevel(),[e]),{SnapLine:r}=eR();return r&&t.length>0?(0,O.jsx)(O.Fragment,{children:t.map(e=>(0,O.jsx)(r,{className:"tl-user-snapline",line:e,zoom:n},e.id))}):null}function tY(){let e=(0,G.j)(),{Handles:t}=eR(),n=(0,T.Hg)("zoomLevel",()=>e.getZoomLevel(),[e]),r=(0,T.Hg)("coarse pointer",()=>e.getInstanceState().isCoarsePointer,[e]),i=(0,T.Hg)("isChangingStyle",()=>e.getInstanceState().isReadonly,[e]),o=(0,T.Hg)("isChangingStyle",()=>e.getInstanceState().isChangingStyle,[e]),s=(0,T.Hg)("onlySelectedShape",()=>e.getOnlySelectedShape(),[e]),a=(0,T.Hg)("transform",()=>s?e.getShapePageTransform(s):null,[e,s]),l=(0,T.Hg)("handles",()=>{if(!s)return null;let t=e.getShapeHandles(s);if(!t)return null;let i=(r?L.Pr:L.rQ)/n*2;return t.filter(e=>"virtual"!==e.type||!t.some(t=>t!==e&&"vertex"===t.type&&eh.B.Dist(e,t)<i)).sort(e=>"vertex"===e.type?1:-1)},[e,s,n,r]);return t&&s&&!o&&!i&&l&&a?(0,O.jsx)(t,{children:(0,O.jsx)("g",{transform:tC._.toCssString(a),children:l.map(e=>(0,O.jsx)(tG,{shapeId:s.id,handle:e,zoom:n,isCoarse:r},e.id))})}):null}function tG({shapeId:e,handle:t,zoom:n,isCoarse:r}){let i=function(e,t){let n=(0,G.j)();return $.useMemo(()=>{let r,i;return{onPointerDown:r=>{if(r.isKilled)return;Z(V(r.currentTarget),r);let{shape:i,handle:o}=t_(n,e,t);o&&n.dispatch({type:"pointer",target:"handle",handle:o,shape:i,name:"pointer_down",...Y(r)})},onPointerMove:o=>{if(o.isKilled||o.clientX===r&&o.clientY===i)return;r=o.clientX,i=o.clientY;let{shape:s,handle:a}=t_(n,e,t);a&&n.dispatch({type:"pointer",target:"handle",handle:a,shape:s,name:"pointer_move",...Y(o)})},onPointerUp:r=>{if(r.isKilled)return;K(V(r.currentTarget),r);let{shape:i,handle:o}=t_(n,e,t);o&&n.dispatch({type:"pointer",target:"handle",handle:o,shape:i,name:"pointer_up",...Y(r)})}}},[n,e,t])}(e,t.id),{Handle:o}=eR();return o?(0,O.jsx)("g",{"aria-label":"handle",transform:`translate(${t.x}, ${t.y})`,...i,children:(0,O.jsx)(o,{shapeId:e,handle:t,zoom:n,isCoarse:r})}):null}function tX(){let e=(0,G.j)(),t=(0,T.Hg)("rendering shapes",()=>e.getRenderingShapes(),[e]);return(0,O.jsx)(O.Fragment,{children:t.map(e=>(0,O.jsxs)($.Fragment,{children:[(0,O.jsx)(tR,{...e}),(0,O.jsx)(t8,{id:e.id})]},e.id+"_fragment"))})}function tq(){let e=(0,G.j)(),t=(0,T.Hg)("rendering shapes",()=>e.getRenderingShapes(),[e]);return(0,O.jsx)(O.Fragment,{children:t.map(e=>(0,O.jsx)(tR,{...e},e.id+"_shape"))})}function tJ(){let e=(0,G.j)(),t=(0,T.Hg)("selectedShapeIds",()=>e.getCurrentPageState().selectedShapeIds,[e]);return(0,T.Hg)("should display selected ids",()=>e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!e.getInstanceState().isChangingStyle,[e])?(0,O.jsx)(O.Fragment,{children:t.map(e=>(0,O.jsx)(ea,{className:"tl-user-indicator__selected",id:e},e+"_indicator"))}):null}let tQ=function(){let e=(0,G.j)(),{HoveredShapeIndicator:t}=eR(),n=(0,T.Hg)("coarse pointer",()=>e.getInstanceState().isCoarsePointer,[e]),r=(0,T.Hg)("hovering canvas",()=>e.getInstanceState().isHoveringCanvas,[e]),i=(0,T.Hg)("hovered id",()=>e.getCurrentPageState().hoveredShapeId,[e]);return!n&&r&&i&&t?(0,O.jsx)(t,{shapeId:i}):null},t0=(0,T.j)(function(){let e=(0,G.j)(),t=(0,M.D8)(e.getHintingShapeIds());return t.length?(0,O.jsx)(O.Fragment,{children:t.map(e=>(0,O.jsx)(ea,{className:"tl-user-indicator__hint",id:e},e+"_hinting"))}):null});function t1(){return(0,O.jsxs)("g",{id:"cursor",children:[(0,O.jsxs)("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[(0,O.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,O.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,O.jsxs)("g",{fill:"white",transform:"translate(-12,-12)",children:[(0,O.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,O.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,O.jsxs)("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[(0,O.jsx)("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),(0,O.jsx)("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function t2(){return(0,O.jsx)("path",{id:"cursor_hint",fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function t5(){return(0,O.jsx)("marker",{id:"arrowhead-dot",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:(0,O.jsx)("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function t3(){return(0,O.jsxs)("marker",{id:"arrowhead-cross",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[(0,O.jsx)("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),(0,O.jsx)("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}let t8=(0,T.j)(function({id:e}){let t=(0,G.j)(),n=t.getShape(e),[r,i]=$.useState(""),o=n?.parentId===t.getCurrentPageId();return($.useEffect(()=>{if(!o)return;let n=null,r=(0,T.Ym)("shape to svg",async()=>{let r=Math.random();n=r;let o=t.getShapePageBounds(e),s=await t.getSvg([e],{padding:0,background:t.getInstanceState().exportBackground});s&&o&&n===r&&(s.style.setProperty("overflow","visible"),s.setAttribute("preserveAspectRatio","xMidYMin slice"),s.style.setProperty("transform",`translate(${o.x}px, ${o.y+o.h+12}px)`),s.style.setProperty("border","1px solid black"),i(s?.outerHTML))});return()=>{n=null,r()}},[t,e,o]),o)?(0,O.jsx)("div",{style:{paddingTop:12,position:"absolute"},children:(0,O.jsx)("div",{style:{display:"flex"},dangerouslySetInnerHTML:{__html:r}})}):null});function t4(){let e=(0,T.Hg)("debugging ui log",()=>N.logMessages.get(),[N]);return e.length?(0,O.jsx)("div",{className:"debug__ui-logger",children:e.map((e,t)=>{let n="string"==typeof e?e:JSON.stringify(e);return(0,O.jsx)("div",{className:"debug__ui-logger__line",children:n},t)})}):null}function t6(){let e=(0,G.j)(),t=(0,T.Hg)("selection rotation",()=>e.getSelectionRotation(),[e]),n=(0,T.Hg)("selection bounds",()=>e.getSelectionRotatedPageBounds(),[e]),{SelectionForeground:r}=eR();return n&&r?(0,O.jsx)(r,{bounds:n,rotation:t}):null}function t9(){let e=(0,G.j)(),t=(0,T.Hg)("selection rotation",()=>e.getSelectionRotation(),[e]),n=(0,T.Hg)("selection bounds",()=>e.getSelectionRotatedPageBounds(),[e]),{SelectionBackground:r}=eR();return n&&r?(0,O.jsx)(r,{bounds:n,rotation:t}):null}function t7(){let{OnTheCanvas:e}=eR();return e?(0,O.jsx)(e,{}):null}function ne(){let{InFrontOfTheCanvas:e}=eR();return e?(0,O.jsx)(e,{}):null}let nt=()=>(0,O.jsx)(n9,{children:"Connecting..."});var nn=n(9694),nr=n(9410);function ni(){let e=(0,G.j)();return(0,T.Hg)("isDarkMode",()=>e.user.getIsDarkMode(),[e])}let no="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",ns="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",na='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function nl(e,t,n,r,i,o=16,s=16){let a=eu.PI/180*(-n-t),l=Math.sin(a),c=Math.cos(a);return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${i};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${1*c-1*l}' dy='${1*l+1*c}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${t+n} 16 16)${r?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+e.replaceAll('"',"'")+`</g></svg>") ${o} ${s}, pointer`}let nc=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],nu={none:()=>"none","ew-resize":(e,t,n)=>nl(ns,e,0,t,n),"ns-resize":(e,t,n)=>nl(ns,e,90,t,n),"nesw-resize":(e,t,n)=>nl(no,e,0,t,n),"nwse-resize":(e,t,n)=>nl(no,e,90,t,n),"nwse-rotate":(e,t,n)=>nl(na,e,0,t,n),"nesw-rotate":(e,t,n)=>nl(na,e,90,t,n),"senw-rotate":(e,t,n)=>nl(na,e,180,t,n),"swne-rotate":(e,t,n)=>nl(na,e,270,t,n)};function nd(e,t=0,n="black"){return nu[e]((0,eu.vi)(t),!1,n)}var nh=n(6967);let np="TLDRAW_TAB_ID_v2",nf=globalThis.window,ng=nf?.[np]??nf?.sessionStorage[np]??"TLDRAW_INSTANCE_STATE_V1_"+(0,nh.E)();nf&&(nf[np]=ng,nf&&(["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(nf.navigator.platform)||nf.navigator.userAgent.includes("Mac")&&"ontouchend"in document)?nf.sessionStorage[np]=ng:delete nf.sessionStorage[np]),nf?.addEventListener("beforeunload",()=>{nf.sessionStorage[np]=ng});let nm=A.T.object({version:A.T.number,currentPageId:I.CF,isFocusMode:A.T.boolean,exportBackground:A.T.boolean,isDebugMode:A.T.boolean,isToolLocked:A.T.boolean,isGridMode:A.T.boolean,pageStates:A.T.arrayOf(A.T.object({pageId:I.CF,camera:A.T.object({x:A.T.number,y:A.T.number,z:A.T.number}),selectedShapeIds:A.T.arrayOf(I.u5),focusedGroupId:I.u5.nullable()}))}),ny=(0,j.zn)({currentVersion:0});function nb(e){let t=e.query.ids("page");return(0,T.Fl)("sessionStateSnapshot",()=>{let n=e.get(I.PQ);if(!n)return null;let r=[...t.get()];return{version:0,currentPageId:n.currentPageId,exportBackground:n.exportBackground,isFocusMode:n.isFocusMode,isDebugMode:n.isDebugMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,pageStates:r.map(t=>{let n=e.get(I.iS.createId(t)),r=e.get(I.AN.createId(t));return{pageId:t,camera:{x:r?.x??0,y:r?.y??0,z:r?.z??1},selectedShapeIds:n?.selectedShapeIds??[],focusedGroupId:n?.focusedGroupId??null}})}})}function nw(e,t){let n=function(e){if(!e||"object"!=typeof e)return console.warn("Invalid instance state"),null;if(!("version"in e)||"number"!=typeof e.version)return console.warn("No version in instance state"),null;let t=(0,j.Te)({value:e,fromVersion:e.version,toVersion:0,migrations:ny});if("error"===t.type)return console.warn(t.reason),null;let n={...t.value,version:0};try{nm.validate(n)}catch(e){return console.warn(e),null}return n}(t);if(!n)return;let r=e.allRecords().filter(e=>"instance_page_state"===e.typeName||"camera"===e.typeName),i={added:{},updated:{},removed:{...(0,M.Ls)(r.map(e=>[e.id,e]))}};e.has(I.PQ)&&(i.removed[I.PQ]=e.get(I.PQ));let o={removed:{},updated:{},added:{[I.PQ]:e.schema.types.instance.create({id:I.PQ,currentPageId:n.currentPageId,isDebugMode:n.isDebugMode,isFocusMode:n.isFocusMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,exportBackground:n.exportBackground})}};for(let e of n.pageStates){let t=I.AN.createId(e.pageId),n=I.iS.createId(e.pageId);o.added[t]=I.AN.create({id:I.AN.createId(e.pageId),x:e.camera.x,y:e.camera.y,z:e.camera.z}),o.added[n]=I.iS.create({id:I.iS.createId(e.pageId),pageId:e.pageId,selectedShapeIds:e.selectedShapeIds,focusedGroupId:e.focusedGroupId})}(0,T.ay)(()=>{e.applyDiff((0,j.bs)([i,o])),e.ensureStoreIsUsable()})}function nx(e){let t=[];for(let n of Object.values(e))n.typeName?.match(/^(instance.*|pointer|camera)$/)&&t.push(n);let n=t.filter(e=>"instance"===e.typeName&&e.id!==I.PQ)[0];if(!n)return null;let r={version:0,currentPageId:n.currentPageId,exportBackground:!!n.exportBackground,isFocusMode:!!n.isFocusMode,isDebugMode:!!n.isDebugMode,isToolLocked:!!n.isToolLocked,isGridMode:!1,pageStates:t.filter(e=>"instance_page_state"===e.typeName&&e.instanceId===n.id).map(t=>{let n=e[t.cameraId]??{x:0,y:0,z:1};return{pageId:t.pageId,camera:{x:n.x,y:n.y,z:n.z},selectedShapeIds:t.selectedShapeIds,focusedGroupId:t.focusedGroupId}})};try{return nm.validate(r),r}catch(e){return null}}let nv=(e,t)=>t.some(t=>e instanceof t),nS=new WeakMap,nk=new WeakMap,n_=new WeakMap,nE=new WeakMap,nC=new WeakMap,nP={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return nk.get(e);if("objectStoreNames"===t)return e.objectStoreNames||n_.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return nT(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function nT(e){var t;if(e instanceof IDBRequest)return function(e){let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{t(nT(e.result)),r()},o=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",o)});return t.then(t=>{t instanceof IDBCursor&&nS.set(t,e)}).catch(()=>{}),nC.set(t,e),t}(e);if(nE.has(e))return nE.get(e);let n="function"==typeof(t=e)?t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(nj(this),e),nT(nS.get(this))}:function(...e){return nT(t.apply(nj(this),e))}:function(e,...n){let r=t.call(nj(this),e,...n);return n_.set(r,e.sort?e.sort():[e]),nT(r)}:(t instanceof IDBTransaction&&function(e){if(nk.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=()=>{t(),r()},o=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)});nk.set(e,t)}(t),nv(t,r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(t,nP):t;return n!==e&&(nE.set(e,n),nC.set(n,e)),n}let nj=e=>nC.get(e),nI=["get","getKey","getAll","getAllKeys","count"],nM=["put","add","delete","clear"],nA=new Map;function nO(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(nA.get(t))return nA.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=nM.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||nI.includes(n)))return;let o=async function(e,...t){let o=this.transaction(e,i?"readwrite":"readonly"),s=o.store;return r&&(s=s.index(t.shift())),(await Promise.all([s[n](...t),i&&o.done]))[0]};return nA.set(t,o),o}nP={...a=nP,get:(e,t,n)=>nO(e,t)||a.get(e,t,n),has:(e,t)=>!!nO(e,t)||a.has(e,t)};let n$="TLDRAW_DOCUMENT_v2",nB="TLDRAW_DB_NAME_INDEX_v2",nD={Records:"records",Schema:"schema",SessionState:"session_state"};async function nL(e,t){!function(e){let t=new Set(nU());t.add(e),window?.localStorage.setItem(nB,JSON.stringify([...t]))}(e);let n=await function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){let s=indexedDB.open(e,3),a=nT(s);return r&&s.addEventListener("upgradeneeded",e=>{r(nT(s.result),e.oldVersion,e.newVersion,nT(s.transaction),e)}),n&&s.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{o&&e.addEventListener("close",()=>o()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a}(e,0,{upgrade(e){e.objectStoreNames.contains(nD.Records)||e.createObjectStore(nD.Records),e.objectStoreNames.contains(nD.Schema)||e.createObjectStore(nD.Schema),e.objectStoreNames.contains(nD.SessionState)||e.createObjectStore(nD.SessionState)}});try{return await t(n)}finally{n.close()}}async function nR({persistenceKey:e,sessionId:t,didCancel:n}){let r=n$+e;if(nU().includes(r))return await nF({persistenceKey:e,didCancel:n}),await nL(r,async e=>{if(n?.())return;let r=e.transaction([nD.Records,nD.Schema,nD.SessionState],"readonly"),i=r.objectStore(nD.Records),o=r.objectStore(nD.Schema),s=r.objectStore(nD.SessionState),a=t?(await s.get(t))?.snapshot:null;if(!a){let e=await s.getAll();a=e.sort((e,t)=>e.updatedAt-t.updatedAt).pop()?.snapshot}let l={records:await i.getAll(),schema:await o.get(nD.Schema),sessionStateSnapshot:a};if(n?.()){r.abort();return}return await r.done,l})}async function nz({persistenceKey:e,schema:t,changes:n,sessionId:r,sessionStateSnapshot:i,didCancel:o}){await nL(n$+e,async e=>{let s=e.transaction([nD.Records,nD.Schema,nD.SessionState],"readwrite"),a=s.objectStore(nD.Records),l=s.objectStore(nD.Schema),c=s.objectStore(nD.SessionState);for(let[e,t]of Object.entries(n.added))await a.put(t,e);for(let[e,t]of Object.values(n.updated))await a.put(t,t.id);for(let e of Object.keys(n.removed))await a.delete(e);if(l.put(t.serialize(),nD.Schema),i&&r?c.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together"),o?.())return s.abort();await s.done})}async function nN({persistenceKey:e,schema:t,snapshot:n,sessionId:r,sessionStateSnapshot:i,didCancel:o}){await nL(n$+e,async e=>{let s=e.transaction([nD.Records,nD.Schema,nD.SessionState],"readwrite"),a=s.objectStore(nD.Records),l=s.objectStore(nD.Schema),c=s.objectStore(nD.SessionState);for(let[e,t]of(await a.clear(),Object.entries(n)))await a.put(t,e);if(l.put(t.serialize(),nD.Schema),i&&r?c.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together"),o?.())return s.abort();await s.done})}async function nF({persistenceKey:e,didCancel:t}){await nL(n$+e,async e=>{let n=e.transaction([nD.SessionState],"readwrite"),r=n.objectStore(nD.SessionState),i=(await r.getAll()).sort((e,t)=>e.updatedAt-t.updatedAt);if(i.length<10){await n.done;return}for(let{id:e}of i.slice(0,i.length-10))await r.delete(e);if(t?.())return n.abort();await n.done})}function nU(){let e=JSON.parse(window?.localStorage.getItem(nB)||"[]")??[];return Array.isArray(e)?e:[]}let nV=Symbol("UPDATE_INSTANCE_STATE"),nH=e=>e;class nZ{onmessage;constructor(e){}postMessage(e){}close(){}}let nK="undefined"==typeof BroadcastChannel?nZ:BroadcastChannel;class nW{constructor(e,{persistenceKey:t,sessionId:n=ng,onLoad:r,onLoadError:i},o=new nK(`tldraw-tab-sync-${t}`)){this.store=e,this.channel=o,"undefined"!=typeof window&&(window.tlsync=this),this.persistenceKey=t,this.sessionId=n,this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=nb(this.store),this.disposables.add(e.listen(({changes:e})=>{this.diffQueue.push(e),this.channel.postMessage(nH({type:"diff",storeId:this.store.id,changes:e,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(nV),this.schedulePersist()},{scope:"session"})),this.connect(r,i),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(e=>"document"===e.scope).map(e=>e.typeName))}disposables=new Set;diffQueue=[];didDispose=!1;shouldDoFullDBWrite=!0;isReloading=!1;persistenceKey;sessionId;serializedSchema;isDebugging=!1;documentTypes;$sessionStateSnapshot;initTime=Date.now();debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,t){let n;this.debug("connecting");try{n=await nR({persistenceKey:this.persistenceKey,sessionId:this.sessionId,didCancel:()=>this.didDispose})}catch(e){t(e),window.alert(`Oops! We could not access your browser's storage\u2014and the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`),"undefined"!=typeof window&&window.location.reload();return}if(this.debug("loaded data from store",n,"didDispose",this.didDispose),!this.didDispose)try{if(n){let e=Object.fromEntries(n.records.map(e=>[e.id,e])),r=n.sessionStateSnapshot??nx(e),i=this.store.schema.migrateStoreSnapshot({store:e,schema:n.schema??this.store.schema.serializeEarliestVersion()});if("error"===i.type){console.error("failed to migrate store",i),t(Error(`Failed to migrate store: ${i.reason}`));return}this.store.mergeRemoteChanges(()=>{this.store.put(Object.values(i.value).filter(e=>this.documentTypes.has(e.typeName)),"initialize")}),r&&nw(this.store,r)}this.channel.onmessage=({data:e})=>{this.debug("got message",e);let n=(0,j.$F)(this.serializedSchema,e.schema??this.store.schema.serializeEarliestVersion());if(-1===n){if(Date.now()-this.initTime<5e3){t(Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,window?.location?.reload?.();return}if(1===n){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}"diff"===e.type&&(this.debug("applying diff"),(0,T.ay)(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(e.changes),this.store.ensureStoreIsUsable()})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(e){if(this.debug("error loading data from store",e),this.didDispose)return;t(e);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}isPersisting=!1;didLastWriteError=!1;scheduledPersistTimeout=null;schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),this.scheduledPersistTimeout||(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?1e4:350))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),this.isPersisting||this.isReloading||this.store.isPossiblyCorrupted()||!this.shouldDoFullDBWrite&&!(this.diffQueue.length>0)||this.doPersist()}async doPersist(){(0,M.hu)(!this.isPersisting,"persist already in progress"),this.isPersisting=!0,this.debug("doPersist start");let e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await nN({persistenceKey:this.persistenceKey,schema:this.store.schema,snapshot:this.store.serialize(),didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{let t=(0,j.bs)(e.filter(e=>e!==nV));await nz({persistenceKey:this.persistenceKey,changes:t,schema:this.store.schema,didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(e){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",e),window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
\u2022 If your hard disk is full, try clearing up some space and then reload the page.`),"undefined"!=typeof window&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}var nY=n(5502);function nG({initialData:e,defaultName:t="",...n}){let r="schema"in n&&n.schema?n.schema:(0,I.HH)({shapes:Object.fromEntries((0,nY.m)("shapeUtils"in n&&n.shapeUtils?n.shapeUtils:[]).map(e=>[e.type,{props:e.props,migrations:e.migrations}]))});return new j.yh({schema:r,initialData:e,props:{defaultName:t}})}function nX(e){let t=nG(e);return e.snapshot&&t.loadSnapshot(e.snapshot),{store:t,opts:e}}function nq(e){let[t,n]=(0,$.useState)(()=>nX(e));if(!(0,M.dn)(t.opts,e)){let t=nX(e);return n(t),t.store}return t.store}function nJ({persistenceKey:e,sessionId:t,...n}){let[r,i]=(0,$.useState)(null),o=nq(n);return(0,$.useEffect)(()=>{let n=(0,nh.E)();if(!e){i({id:n,storeWithStatus:{status:"not-synced",store:o}});return}i({id:n,storeWithStatus:{status:"loading"}});let r=e=>{i(t=>t?.id===n?{id:n,storeWithStatus:e}:t)},s=new nW(o,{sessionId:t,persistenceKey:e,onLoad(){r({store:o,status:"synced-local"})},onLoadError(e){r({status:"error",error:e})}});return()=>{i(e=>e?.id===n?null:e),s.close()}},[e,o,t]),r?.storeWithStatus??{status:"loading"}}let nQ=!1;if("undefined"!=typeof window){let e=window.navigator.userAgent,t=!!e.match(/iPad/i)||!!e.match(/iPhone/i),n=!!e.match(/WebKit/i);nQ=t&&n&&!e.match(/CriOS/i)}let n0=[],n1=[],n2=(0,$.memo)(function({store:e,components:t,className:n,user:r,...i}){let[o,s]=$.useState(null),a=(0,$.useMemo)(()=>r??(0,nn.L)(),[r]),l=t?.ErrorFallback===void 0?ex:t?.ErrorFallback,c={...i,shapeUtils:i.shapeUtils??n0,tools:i.tools??n1,components:t};return(0,O.jsx)("div",{ref:s,draggable:!1,className:D("tl-container tl-theme__light",n),onPointerDown:W,tabIndex:-1,children:(0,O.jsx)(er,{fallback:l,onError:e=>(0,M.lw)(e,{tags:{origin:"react.tldraw-before-app"}}),children:o&&(0,O.jsx)(q,{container:o,children:(0,O.jsx)(eL,{overrides:t,children:e?e instanceof j.yh?(0,O.jsx)(n8,{...c,store:e,user:a}):(0,O.jsx)(n3,{...c,store:e,user:a}):(0,O.jsx)(n5,{...c,store:e,user:a})})})})})});function n5(e){let{defaultName:t,snapshot:n,initialData:r,shapeUtils:i,persistenceKey:o,sessionId:s,user:a}=e,l=nJ({shapeUtils:i,initialData:r,persistenceKey:o,sessionId:s,defaultName:t,snapshot:n});return(0,O.jsx)(n3,{...e,store:l,user:a})}let n3=(0,$.memo)(function({store:e,user:t,...n}){let r=J();switch((0,$.useLayoutEffect)(()=>{t.userPreferences.get().isDarkMode&&(r.classList.remove("tl-theme__light"),r.classList.add("tl-theme__dark"))},[r,t]),e.status){case"error":throw e.error;case"loading":{let e=n.components?.LoadingScreen??nt;return(0,O.jsx)(e,{})}}return(0,O.jsx)(n8,{...n,store:e.store,user:t})});function n8({onMount:e,children:t,store:n,tools:r,shapeUtils:i,user:o,initialState:s,autoFocus:a=!0,inferDarkMode:l}){let{ErrorFallback:c}=eR(),u=J(),[d,h]=(0,$.useState)(null);(0,$.useLayoutEffect)(()=>{let e=new nr.M({store:n,shapeUtils:i,tools:r,getContainer:()=>u,user:o,initialState:s,inferDarkMode:l});return window.app=e,window.editor=e,h(e),()=>{e.dispose()}},[u,i,r,n,o,s,l]);let p=(0,$.useSyncExternalStore)((0,$.useCallback)(e=>d?(d.on("crash",e),()=>d.off("crash",e)):()=>{},[d]),()=>d?.getCrashingError()??null);return d?(0,O.jsx)(er,{fallback:c,onError:e=>d.annotateError(e,{origin:"react.tldraw",willCrashApp:!0}),children:p?(0,O.jsx)(n6,{crashingError:p}):(0,O.jsx)(G.r.Provider,{value:d,children:(0,O.jsx)(n4,{autoFocus:a,onMount:e,children:t})})}):null}function n4({children:e,onMount:t,autoFocus:n}){return!function(){let e=(0,G.j)(),t=J();$.useEffect(()=>{let n=e=>t.style.setProperty("--tl-zoom",e.toString()),r=(0,M.Ds)(n,100),i=new T.R0("useZoomCss",()=>{e.getCurrentPageShapeIds().size<300?n(e.getZoomLevel()):r(e.getZoomLevel())});return i.attach(),i.execute(),()=>{i.detach()}},[e,t])}(),!function(){let e=(0,G.j)(),t=J(),n=ni();(0,T.BK)("useCursor",()=>{let{type:r,rotation:i}=e.getInstanceState().cursor;if(nc.includes(r)){t.style.setProperty("--tl-cursor",`var(--tl-cursor-${r})`);return}t.style.setProperty("--tl-cursor",nd(r,i,n?"white":"black"))},[e,t,n])}(),!function(){let e=(0,G.j)(),t=J(),n=ni(),r=(0,T.Hg)(N.forceSrgb);$.useEffect(()=>{n?(t.setAttribute("data-color-mode","dark"),t.classList.remove("tl-theme__light"),t.classList.add("tl-theme__dark")):(t.setAttribute("data-color-mode","light"),t.classList.remove("tl-theme__dark"),t.classList.add("tl-theme__light")),r?t.classList.add("tl-theme__force-sRGB"):t.classList.remove("tl-theme__force-sRGB")},[e,t,r,n])}(),!function(){let e=(0,G.j)();$.useEffect(()=>{if(nQ)return document.addEventListener("focusout",t),()=>document.removeEventListener("focusout",t);function t(t){(t.target instanceof HTMLInputElement&&"text"===t.target.type||t.target instanceof HTMLTextAreaElement)&&e.complete()}},[e])}(),!function(){let[e,t]=(0,$.useState)(0);(0,$.useEffect)(()=>t(e=>e+1),[])}(),!function(e){let t=(0,G.j)(),n=J();(0,$.useLayoutEffect)(()=>{e?(t.getInstanceState().isFocused||t.updateInstanceState({isFocused:!0}),t.getContainer().focus()):t.getInstanceState().isFocused&&t.updateInstanceState({isFocused:!1})},[t,n,e])}(n),function(e){let t=(0,G.j)(),n=function(e){let t=(0,$.useRef)();return(0,$.useLayoutEffect)(()=>{t.current=e}),(0,$.useDebugValue)(e),(0,$.useCallback)((...e)=>{let n=t.current;return(0,M.hu)(n,"fn does not exist"),n(...e)},[])}(t=>{let n=e?.(t);return t.emit("mount"),window.tldrawReady=!0,n});$.useLayoutEffect(()=>{if(t)return n?.(t)},[t,n])}(t),(0,G.j)().updateViewportScreenBounds(),e??(0,O.jsx)(tU,{})}function n6({crashingError:e}){throw e}function n9({children:e}){let{Spinner:t}=eR();return(0,O.jsxs)("div",{className:"tl-loading",children:[t?(0,O.jsx)(t,{}):null,e]})}function n7({children:e}){return(0,O.jsx)("div",{className:"tl-loading",children:e})}function re({children:e,className:t="",...n}){return(0,O.jsx)("div",{...n,className:`tl-html-container ${t}`,children:e})}let rt=(0,T.j)(function({x:e=0,y:t=0,rotation:n=0,...r}){let i=(0,G.j)(),o=(0,$.useRef)(null),s=i.getCamera();return(0,$.useLayoutEffect)(()=>{let{x:r,y:s,z:a}=i.getCamera(),l=o.current;l&&void 0!==r&&(l.style.transform=`translate(${r}px, ${s}px) scale(${a}) rotate(${n}rad) translate(${e}px, ${t}px)`)},[s,i,e,t,n]),(0,O.jsx)("div",{ref:o,...r,className:D("tl-positioned",r.className)})});var rn=n(8677),rr=n(5399),ri=n(1531),ro=n(737),rs=n(5808);function ra(e,t,n={}){let{newPoint:r,handle:i,scaleX:o,scaleY:s}=t,{minWidth:a=1,maxWidth:l=1/0,minHeight:c=1,maxHeight:u=1/0}=n,d=e.props.w*o,h=e.props.h*s,p=new eh.B(0,0);if(d>0){if(d<a){switch(i){case"top_left":case"left":case"bottom_left":p.x=d-a;break;case"top":case"bottom":p.x=(d-a)/2;break;default:p.x=0}d=a}}else if(p.x=d,(d=-d)<a){switch(i){case"top_left":case"left":case"bottom_left":p.x=-d;break;default:p.x=-a}d=a}if(h>0){if(h<c){switch(i){case"top_left":case"top":case"top_right":p.y=h-c;break;case"right":case"left":p.y=(h-c)/2;break;default:p.y=0}h=c}}else if(p.y=h,(h=-h)<c){switch(i){case"top_left":case"top":case"top_right":p.y=-h;break;default:p.y=-c}h=c}let{x:f,y:g}=p.rot(e.rotation).add(r);return{x:f,y:g,props:{w:Math.min(l,d),h:Math.min(u,h)}}}class rl extends rs.E{getGeometry(e){return new ro.z({width:e.props.w,height:e.props.h,isFilled:!0})}onResize=(e,t)=>ra(e,t)}var rc=n(8766),ru=n(8864),rd=n(7630);class rh extends rd.n{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")}}class rp extends rd.n{static id="pointing";markId="";wasFocusedOnEnter=!1;onEnter=()=>{this.wasFocusedOnEnter=!this.editor.getIsMenuOpen()};onPointerMove=e=>{if(this.editor.inputs.isDragging){let{originPagePoint:t}=this.editor.inputs,n=this.parent.shapeType,r=(0,I.F1)();this.markId=`creating:${r}`,this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:n,x:t.x,y:t.y,props:{w:1,h:1}}]).select(r),this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:this.parent.onCreate})}};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.cancel()};complete(){let{originPagePoint:e}=this.editor.inputs;if(!this.wasFocusedOnEnter)return;this.editor.mark(this.markId);let t=this.parent.shapeType,n=(0,I.F1)();this.editor.mark(this.markId),this.editor.createShapes([{id:n,type:t,x:e.x,y:e.y}]);let r=this.editor.getShape(n),{w:i,h:o}=this.editor.getShapeUtil(r).getDefaultProps(),s=new eh.B(i/2,o/2),a=this.editor.getShapeParentTransform(r);a&&s.rot(-a.rotation()),this.editor.updateShapes([{id:n,type:t,x:r.x-s.x,y:r.y-s.y}]),this.editor.setSelectedShapes([n]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}}class rf extends rd.n{static id="box";static initial="idle";static children=()=>[rh,rp];onCreate}var rg=n(405);function rm(e,t){let n=(0,$.useRef)(e);return t(e,n.current)?n.current:(n.current=e,e)}function ry(e){return rm(e,M.E8)}function rb(e){return rm(e,M.dn)}function rw(e){let t=(0,G.j)();return(0,T.Hg)("isCropping",()=>t.getCroppingShapeId()===e,[t,e])}function rx(e){let t=(0,G.j)();return(0,T.Hg)("isEditing",()=>t.getEditingShapeId()===e,[t,e])}function rv(e){let t=(0,G.j)();return(0,$.useMemo)(function(){let n,r;return{onPointerDown:n=>{if(n.isKilled)return;if(2===n.button){t.dispatch({type:"pointer",target:"selection",handle:e,name:"right_click",...Y(n)});return}if(0!==n.button)return;let r=V(n.currentTarget);Z(r,n),r.addEventListener("pointerup",function e(){r.removeEventListener("pointerup",e),K(r,n)}),t.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:e,...Y(n)}),W(n)},onPointerMove:function(i){i.isKilled||0!==i.button||i.clientX===n&&i.clientY===r||(n=i.clientX,r=i.clientY,t.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:e,...Y(i)}))},onPointerUp:n=>{n.isKilled||0!==n.button||t.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:e,...Y(n)})}}},[t,e])}var rS=n(1334),rk=n(4085),r_=n(9320),rE=n(6e3);function rC(e,t=20){return Math.max(8,Math.ceil(e/t))}class rP extends rE.l{_center;radius;start;end;measure;length;angleStart;angleEnd;constructor(e){super({...e,isFilled:!1,isClosed:!1});let{center:t,radius:n,sweepFlag:r,largeArcFlag:i,start:o,end:s}=e;if(o.equals(s))throw Error("Arc must have different start and end points.");this.angleStart=eh.B.Angle(t,o),this.angleEnd=eh.B.Angle(t,s),this.measure=(0,eu.D4)(this.angleStart,this.angleEnd,r,i),this.length=this.measure*n,this.start=o,this.end=s,this._center=t,this.radius=n}nearestPoint(e){let t;let{_center:n,measure:r,radius:i,angleEnd:o,angleStart:s,start:a,end:l}=this,c=(0,eu.rW)(r,s,o,n.angle(e));if(c<=0)return a;if(c>=1)return l;let u=n.clone().add(e.clone().sub(n).uni().mul(i)),d=1/0;for(let n of[a,l,u])e.dist(n)<d&&(t=n,d=e.dist(n));if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t,n){let{_center:r,radius:i,measure:o,angleStart:s,angleEnd:a}=this,l=(0,r_.ZM)(e,t,r,i);return null!==l&&l.some(e=>{let t=(0,eu.rW)(o,s,a,r.angle(e));return t>=0&&t<=1})}getVertices(){let{_center:e,measure:t,length:n,radius:r,angleStart:i}=this,o=[];for(let s=0,a=rC(Math.abs(n));s<a+1;s++){let n=i+s/a*t;o.push((0,eu.XD)(e,r,n))}return o}}class rT extends rE.l{constructor(e){super({isClosed:!0,...e}),this.config=e;let{x:t=0,y:n=0,radius:r}=e;this.x=t,this.y=n,this._center=new eh.B(r+t,r+n),this.radius=r}_center;radius;x;y;getBounds(){return new rS.xu(this.x,this.y,2*this.radius,2*this.radius)}getVertices(){let{_center:e,radius:t}=this,n=eu.yo*t,r=[];for(let i=0,o=rC(n);i<o;i++){let n=i/o*eu.yo;r.push((0,eu.XD)(e,t,n))}return r}nearestPoint(e){let{_center:t,radius:n}=this;return t.equals(e)?eh.B.AddXY(t,n,0):t.clone().add(e.clone().sub(t).uni().mul(n))}hitTestLineSegment(e,t,n){let{_center:r,radius:i}=this;return null!==(0,r_.ZM)(e,t,r,i)}}var rj=n(2287);class rI extends rj.q{a;b;c;d;constructor(e){let{start:t,cp1:n,cp2:r,end:i}=e;super({...e,points:[t,i]}),this.a=t,this.b=n,this.c=r,this.d=i}getVertices(){let e=[],{a:t,b:n,c:r,d:i}=this;for(let o=0;o<=10;o++){let s=o/10;e.push(new eh.B((1-s)*(1-s)*(1-s)*t.x+(1-s)*(1-s)*3*s*n.x+3*(1-s)*(s*s)*r.x+s*s*s*i.x,(1-s)*(1-s)*(1-s)*t.y+(1-s)*(1-s)*3*s*n.y+3*(1-s)*(s*s)*r.y+s*s*s*i.y))}return e}midPoint(){return function(e,t){let{a:n,b:r,c:i,d:o}=e;return new eh.B(.25*(1-t)*n.x+(1-t)*(1-t)*3*t*r.x+3*(1-t)*(t*t)*i.x+t*t*t*o.x,(1-t)*(1-t)*(1-t)*n.y+(1-t)*(1-t)*3*t*r.y+3*(1-t)*(t*t)*i.y+t*t*t*o.y)}(this,.5)}nearestPoint(e){let t;let n=1/0;for(let r of this.segments){let i=r.nearestPoint(e),o=i.dist(e);o<n&&(t=i,n=o)}if(!t)throw Error("nearest point not found");return t}}class rM extends rE.l{points;constructor(e){super({...e,isClosed:!1,isFilled:!1});let{points:t}=e;this.points=t}_segments;get segments(){if(!this._segments){this._segments=[];let{points:e}=this,t=e.length,n=t-2;for(let r=0;r<t-1;r++){let t=0===r?e[0]:e[r-1],i=e[r],o=e[r+1],s=r===n?o:e[r+2],a=0===r?t:new eh.B(i.x+(o.x-t.x)/6*1.25,i.y+(o.y-t.y)/6*1.25),l=r===n?o:new eh.B(o.x-(s.x-i.x)/6*1.25,o.y-(s.y-i.y)/6*1.25);this._segments.push(new rI({start:i,cp1:a,cp2:l,end:o}))}}return this._segments}_length;get length(){return this._length||(this._length=this.segments.reduce((e,t)=>e+t.length,0)),this._length}getVertices(){let e=this.segments.reduce((e,t)=>e.concat(t.vertices),[]);return e.push(this.points[this.points.length-1]),e}nearestPoint(e){let t;let n=1/0;for(let r of this.segments){let i=r.nearestPoint(e),o=i.dist(e);o<n&&(t=i,n=o)}if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t,n){return this.segments.some(r=>r.hitTestLineSegment(e,t,n))}}var rA=n(9528);class rO extends rE.l{constructor(e){super({...e,isClosed:!0}),this.config=e;let{width:t,height:n}=e;this.w=t,this.h=n}w;h;_edges;get edges(){if(!this._edges){let{vertices:e}=this;this._edges=[];for(let t=0,n=e.length;t<n;t++){let r=e[t],i=e[(t+1)%n];this._edges.push(new rA.W({start:r,end:i}))}}return this._edges}getVertices(){let e=Math.max(1,this.w),t=Math.max(1,this.h),n=e/2,r=t/2,i=Math.pow(n-r,2)/Math.pow(n+r,2),o=rC(eu.PI*(n+r)*(1+3*i/(10+Math.sqrt(4-3*i)))),s=eu.yo/o,a=Math.cos(s),l=Math.sin(s),c=0,u=1,d=0,h=1,p=Array(o);for(let e=0;e<o;e++)p[e]=new eh.B(n+n*u,r+r*c),d=l*u+a*c,h=a*u-l*c,c=d,u=h;return p}nearestPoint(e){let t;let n=1/0;for(let r of this.edges){let i=r.nearestPoint(e),o=i.dist(e);o<n&&(t=i,n=o)}if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t,n){return this.edges.some(r=>r.hitTestLineSegment(e,t,n))}getBounds(){return new rS.xu(0,0,this.w,this.h)}}class r$ extends rE.l{point;constructor(e){super({...e,isClosed:!0,isFilled:!0});let{point:t}=e;this.point=t}getVertices(){return[this.point]}nearestPoint(){return this.point}hitTestLineSegment(e,t,n){return eh.B.DistanceToLineSegment(e,t,this.point)<n}}var rB=n(8974);class rD extends rO{constructor(e){super({...e}),this.config=e}getVertices(){let e=Math.max(1,this.w),t=Math.max(1,this.h),n=e/2,r=t/2,i=Array(18);if(t>e)for(let e=0;e<9;e++){let r=-eu.PI+eu.PI*e/8,o=eu.PI*e/8;i[e]=new eh.B(n+n*Math.cos(r),n+n*Math.sin(r)),i[e+9]=new eh.B(n+n*Math.cos(o),t-n+n*Math.sin(o))}else for(let n=0;n<9;n++){let o=-eu.pj+eu.PI*n/8,s=eu.pj+-(eu.PI*n)/8;i[n]=new eh.B(e-r+r*Math.cos(o),t-r+r*Math.sin(o)),i[n+9]=new eh.B(r-r*Math.cos(s),t-r+r*Math.sin(s))}return i}}var rL=n(8642),rR=n(3595),rz=n(8504);function rN(e,t,n,r,i){let o=L.rF,s=n?L.EB:0,a=e-s,l=e+s,c=r?0:o,u=i?t:t-o;return a<c?Math.min(1,(c-a)/o):l>u?-Math.min(1,(l-u)/o):0}function rF(e){if(!e.inputs.isDragging||e.inputs.isPanning)return;let{inputs:{currentScreenPoint:{x:t,y:n}}}=e,r=e.getZoomLevel(),i=e.getViewportScreenBounds(),o=i.w<1e3?.612:1,s=i.h<1e3?.612:1,{isCoarsePointer:a,insets:[l,c,u,d]}=e.getInstanceState(),h=rN(t-i.x,i.w,a,d,c),p=rN(n-i.y,i.h,a,l,u);if(0===h&&0===p)return;let f=e.user.getEdgeScrollSpeed()*L.a,g=e.getCamera();e.setCamera({x:g.x+f*h*o/r,y:g.y+f*p*s/r})}var rU=n(6132),rV=n(6763),rH=n(3130);async function rZ({shouldReload:e=!0}={}){sessionStorage.clear(),await Promise.all(nU().map(e=>(function(e,{blocked:t}={}){let n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",e=>t(e.oldVersion,e)),nT(n).then(()=>void 0)})(e))),localStorage.clear(),e&&window.location.reload()}function rK(e,t="_blank"){eg.openWindow(e,t)}"undefined"!=typeof window&&(window.__tldraw__hardReset=rZ),n(4416),n(7213),n(9207),n(5671),n(977);let rW=({children:e})=>{let t=(0,G.j)();return(0,T.Hg)("shouldDisplayHandles",()=>t.isInAny("select.idle","select.pointing_handle"),[t])?(0,O.jsx)("svg",{className:"tl-user-handles tl-overlays__item",children:e}):null},rY=({shapeId:e})=>{let t=(0,G.j)();return(0,T.Hg)("show hovered",()=>t.isIn("select.editing_shape")?t.getHoveredShapeId()!==t.getEditingShapeId():t.isInAny("select.idle"),[t])?(0,O.jsx)(ea,{className:"tl-user-indicator__hovered",id:e}):null},{PI:rG}=Math,rX=rG+1e-4;function rq(e,t={}){let n;let{size:r=16,smoothing:i=.5}=t;if(0===e.length||r<=0)return{left:[],right:[]};let o=e[0],s=e[e.length-1],a=s.runningLength,l=Math.pow(r*i,2),c=[],u=[],d=e[0].vector,h=e[0].point,p=h,f=h,g=p,m=!1;for(let t=0;t<e.length;t++){n=e[t];let{point:r,vector:i}=e[t],y=n.vector.dpr(d),b=(t<e.length-1?e[t+1]:e[t]).vector,w=t<e.length-1?b.dpr(n.vector):1,x=null!==w&&w<.2;if(y<0&&!m||x){if(w>-.62&&a-n.runningLength>n.radius){let e=d.clone().mul(n.radius);0>d.clone().cpr(b)?(f=eh.B.Add(r,e),g=eh.B.Sub(r,e)):(f=eh.B.Sub(r,e),g=eh.B.Add(r,e)),c.push(f),u.push(g)}else{let e=d.clone().mul(n.radius).per(),t=eh.B.Sub(n.input,e);for(let e=1/13,r=0;r<1;r+=e)f=eh.B.RotWith(t,n.input,rX*r),c.push(f),g=eh.B.RotWith(t,n.input,rX+-(rX*r)),u.push(g)}h=f,p=g,x&&(m=!0);continue}if(m=!1,n===o||n===s){let e=eh.B.Per(i).mul(n.radius);c.push(eh.B.Sub(r,e)),u.push(eh.B.Add(r,e));continue}let v=eh.B.Lrp(b,i,w).per().mul(n.radius);f=eh.B.Sub(r,v),(t<=1||eh.B.Dist2(h,f)>l)&&(c.push(f),h=f),g=eh.B.Add(r,v),(t<=1||eh.B.Dist2(p,g)>l)&&(u.push(g),p=g),d=i}return{left:c,right:u}}function rJ(e,t={}){let{size:n=16,start:r={},end:i={},last:o=!1}=t,{cap:s=!0}=r,{cap:a=!0}=i;if(0===e.length||n<=0)return[];let l=e[0],c=e[e.length-1],u=c.runningLength,d=!1===r.taper?0:!0===r.taper?Math.max(n,u):r.taper,h=!1===i.taper?0:!0===i.taper?Math.max(n,u):i.taper,{left:p,right:f}=rq(e,t),g=l.point,m=e.length>1?e[e.length-1].point:eh.B.AddXY(l.point,1,1);if(1===e.length&&(!(d||h)||o)){let e=eh.B.Add(g,eh.B.Sub(g,m).uni().per().mul(-l.radius)),t=[];for(let n=1/13,r=n;r<=1;r+=n)t.push(eh.B.RotWith(e,g,2*rX*r));return t}let y=[];if(d||h&&1===e.length);else if(s)for(let e=1/8,t=e;t<=1;t+=e){let e=eh.B.RotWith(f[0],g,rX*t);y.push(e)}else{let e=eh.B.Sub(p[0],f[0]),t=eh.B.Mul(e,.5),n=eh.B.Mul(e,.51);y.push(eh.B.Sub(g,t),eh.B.Sub(g,n),eh.B.Add(g,n),eh.B.Add(g,t))}let b=[],w=c.vector.clone().per().neg();if(h||d&&1===e.length)b.push(m);else if(a){let e=eh.B.Add(m,eh.B.Mul(w,c.radius));for(let t=1/29,n=t;n<1;n+=t)b.push(eh.B.RotWith(e,m,3*rX*n))}else b.push(eh.B.Add(m,eh.B.Mul(w,c.radius)),eh.B.Add(m,eh.B.Mul(w,.99*c.radius)),eh.B.Sub(m,eh.B.Mul(w,.99*c.radius)),eh.B.Sub(m,eh.B.Mul(w,c.radius)));return p.concat(b,f.reverse(),y)}function rQ(e,t={}){let n,r;let{streamline:i=.5,size:o=16,simulatePressure:s=!1}=t;if(0===e.length)return[];let a=.15+(1-i)*.85,l=e.map(eh.B.From),c=0;if(!s){let e=l[0];for(;e&&!(e.z>=.025);)l.shift(),e=l[0]}if(!s){let e=l[l.length-1];for(;e&&!(e.z>=.01);)l.pop(),e=l[l.length-1]}if(0===l.length)return[{point:eh.B.From(e[0]),input:eh.B.From(e[0]),pressure:s?.5:.15,vector:new eh.B(1,1),distance:0,runningLength:0,radius:1}];let u=l[1];for(;u&&!(eh.B.Dist(u,l[0])>o/3);)l[0].z=Math.max(l[0].z,u.z),l.splice(1,1),u=l[1];let d=l.pop();for(u=l[l.length-1];u&&!(eh.B.Dist(u,d)>o/3);)l.pop(),u=l[l.length-1],c++;l.push(d);let h=t.last||!t.simulatePressure||l.length>1&&eh.B.Dist(l[l.length-1],l[l.length-2])<o||c>0;if(2===l.length&&t.simulatePressure){let e=l[1];l=l.slice(0,-1);for(let t=1;t<5;t++){let n=eh.B.Lrp(l[0],e,t/4);n.z=(l[0].z+(e.z-l[0].z))*t/4,l.push(n)}}let p=[{point:l[0],input:l[0],pressure:s?.5:l[0].z,vector:new eh.B(1,1),distance:0,runningLength:0,radius:1}],f=0,g=p[0];h&&i>0&&l.push(l[l.length-1].clone());for(let e=1,i=l.length;e<i;e++)if(n=!a||t.last&&e===i-1?l[e].clone():l[e].clone().lrp(g.point,1-a),!g.point.equals(n)){if(f+=r=eh.B.Dist(n,g.point),e<4&&f<o)continue;g={input:l[e],point:n,pressure:s?.5:l[e].z,vector:eh.B.Sub(g.point,n).uni(),distance:r,runningLength:f,radius:1},p.push(g)}if(p[1]?.vector&&(p[0].vector=p[1].vector.clone()),f<1){let e=Math.max(.5,...p.map(e=>e.pressure));p.forEach(t=>t.pressure=e)}return p}let{min:r0}=Math;function r1(e,t){let n,r;let{size:i=16,thinning:o=.5,simulatePressure:s=!0,easing:a=e=>e,start:l={},end:c={}}=t,{easing:u=rk.L.easeOutQuad}=l,{easing:d=rk.L.easeOutCubic}=c,h=e[e.length-1].runningLength,p=e[0].pressure;if(!s&&h<i){let t=e.reduce((e,t)=>Math.max(e,t.pressure),.5);return e.forEach(e=>{e.pressure=t,e.radius=i*a(.5-o*(.5-e.pressure))}),e}{let t;for(let n=0,o=e.length;n<o&&!((r=e[n]).runningLength>5*i);n++){let e=r0(1,r.distance/i);if(s){let n=r0(1,1-e);t=r0(1,p+.275*e*(n-p))}else t=r0(1,p+(r.pressure-p)*.5);p+=(t-p)*.5}for(let t=0;t<e.length;t++){if(r=e[t],o){let{pressure:e}=r,t=r0(1,r.distance/i);if(s){let n=r0(1,1-t);e=r0(1,p+.275*t*(n-p))}else e=r0(1,p+.275*t*(e-p));r.radius=i*a(.5-o*(.5-e)),p=e}else r.radius=i/2;void 0===n&&(n=r.radius)}}let f=!1===l.taper?0:!0===l.taper?Math.max(i,h):l.taper,g=!1===c.taper?0:!0===c.taper?Math.max(i,h):c.taper;if(f||g)for(let t=0;t<e.length;t++){let{runningLength:n}=r=e[t],i=n<f?u(n/f):1,o=h-n<g?d((h-n)/g):1;r.radius=Math.max(.01,r.radius*Math.min(i,o))}return e}let r2=({scribble:e,zoom:t,color:n,opacity:r,className:i})=>{let o;if(!e.points.length)return null;let s=function(e,t={}){return rJ(r1(rQ(e,t),t),t)}(e.points,{size:e.size/t,start:{taper:e.taper,easing:rk.L.linear},last:"stopping"===e.state,simulatePressure:!1,streamline:.32});if(s.length<4){let n=e.size/t/2,{x:r,y:i}=e.points[e.points.length-1];o=`M ${r-n},${i} a ${n},${n} 0 1,0 ${2*n},0 a ${n},${n} 0 1,0 ${-(2*n)},0`}else o=eE(s);return(0,O.jsx)("svg",{className:i?D("tl-overlays__item",i):i,children:(0,O.jsx)("path",{className:"tl-scribble",d:o,fill:n??`var(--color-${e.color})`,opacity:r??e.opacity})})},r5=({bounds:e,rotation:t})=>{let n=(0,G.j)();return(0,T.Hg)("should display",()=>n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing"),[n])?(0,O.jsx)(eP,{bounds:e,rotation:t}):null};function r3(){let e=(0,G.j)();return(0,T.Hg)("isReadonlyMode",()=>e.getInstanceState().isReadonly,[e])}function r8({size:e,width:t,height:n,hideAlternateHandles:r}){let i=(0,eu.$Z)(e/3),o=i/2;return(0,O.jsxs)("svg",{className:"tl-overlays__item",children:[(0,O.jsx)("polyline",{className:"tl-corner-crop-handle",points:`
						${(0,eu.$Z)(0-o)},${(0,eu.$Z)(e)} 
						${(0,eu.$Z)(0-o)},${(0,eu.$Z)(0-o)} 
						${(0,eu.$Z)(e)},${(0,eu.$Z)(0-o)}`,strokeWidth:i,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),(0,O.jsx)("line",{className:D("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:(0,eu.$Z)(t/2-e),y1:(0,eu.$Z)(0-o),x2:(0,eu.$Z)(t/2+e),y2:(0,eu.$Z)(0-o),strokeWidth:i,"data-testid":"selection.crop.top","aria-label":"top handle"}),(0,O.jsx)("polyline",{className:D("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${(0,eu.$Z)(t-e)},${(0,eu.$Z)(0-o)} 
						${(0,eu.$Z)(t+o)},${(0,eu.$Z)(0-o)} 
						${(0,eu.$Z)(t+o)},${(0,eu.$Z)(e)}`,strokeWidth:i,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),(0,O.jsx)("line",{className:D("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:(0,eu.$Z)(t+o),y1:(0,eu.$Z)(n/2-e),x2:(0,eu.$Z)(t+o),y2:(0,eu.$Z)(n/2+e),strokeWidth:i,"data-testid":"selection.crop.right","aria-label":"right handle"}),(0,O.jsx)("polyline",{className:"tl-corner-crop-handle",points:`
						${(0,eu.$Z)(t+o)},${(0,eu.$Z)(n-e)} 
						${(0,eu.$Z)(t+o)},${(0,eu.$Z)(n+o)}
						${(0,eu.$Z)(t-e)},${(0,eu.$Z)(n+o)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),(0,O.jsx)("line",{className:D("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:(0,eu.$Z)(t/2-e),y1:(0,eu.$Z)(n+o),x2:(0,eu.$Z)(t/2+e),y2:(0,eu.$Z)(n+o),strokeWidth:i,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),(0,O.jsx)("polyline",{className:D("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${(0,eu.$Z)(0+e)},${(0,eu.$Z)(n+o)} 
						${(0,eu.$Z)(0-o)},${(0,eu.$Z)(n+o)}
						${(0,eu.$Z)(0-o)},${(0,eu.$Z)(n-e)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),(0,O.jsx)("line",{className:D("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:(0,eu.$Z)(0-o),y1:(0,eu.$Z)(n/2-e),x2:(0,eu.$Z)(0-o),y2:(0,eu.$Z)(n/2+e),strokeWidth:i,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}let r4=(0,T.j)(function({bounds:e,rotation:t}){let n=(0,G.j)(),r=(0,$.useRef)(null),i=r3(),o=rv("top"),s=rv("right"),a=rv("bottom"),l=rv("left"),c=rv("top_left"),u=rv("top_right"),d=rv("bottom_right"),h=rv("bottom_left"),p=!n.getIsMenuOpen()&&"default"===n.getInstanceState().cursor.type,f=n.getInstanceState().isCoarsePointer,g=n.getOnlySelectedShape(),m=g&&n.isShapeOrAncestorLocked(g),y=g?n.getShapeUtil(g).expandSelectionOutlinePx(g):0;if(ec(r,e?.x,e?.y,1,n.getSelectionRotation(),{x:-y,y:-y}),!e)return null;e=e.clone().expandBy(y).zeroFix();let b=n.getZoomLevel(),w=n.getInstanceState().isChangingStyle,x=e.width,v=e.height,S=8/b,k=x<2*S,_=v<2*S,E=x<4*S,C=v<4*S,P=x<5*S,T=v<5*S,j=f?1.75:1,I=6/b*j,M=.75*j*(E?I/2:I),A=.75*j*(C?I/2:I),B=(!g||!n.getShapeUtil(g).hideSelectionBoundsFg(g))&&!w,L=B&&n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.pointing_resize_handle","select.pointing_crop_handle")||B&&n.isIn("select.resizing")&&g&&n.isShapeOfType(g,"text");g&&L&&n.environment.isFirefox&&n.isShapeOfType(g,"embed")&&(L=!1);let R=n.isInAny("select.pointing_crop_handle","select.crop.idle","select.crop.pointing_crop")&&!w&&!i,z=n.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!w&&!i,N=!f&&!(k||_)&&(z||R)&&(!g||!n.getShapeUtil(g).hideRotateHandle(g))&&!m,F=f&&(!E||!C)&&(z||R)&&(!g||!n.getShapeUtil(g).hideRotateHandle(g))&&!m,U=z&&(!g||n.getShapeUtil(g).canResize(g)&&!n.getShapeUtil(g).hideResizeHandles(g))&&!R&&!m,V=k||_,H=k&&_,Z=P||T,K=U||R,W=!N,Y=!z||!F,X=!z||!K,q=!z||!K||V,J=!z||!K||V,Q=!z||!K||H&&!R,ee=!0,et=!0;if(R)ee=Z,et=Z;else if(U){ee=V||H||f;let e=f&&g&&"text"===g.type;et=ee&&!e}let en=Math.min(24/b,v-3*A),er=z&&f&&g&&n.isShapeOfType(g,"text")&&en*b>=4;return(0,O.jsx)("svg",{className:"tl-overlays__item tl-selection__fg tl-svg-context","data-testid":"selection-foreground",children:(0,O.jsxs)("g",{ref:r,children:[L&&(0,O.jsx)("rect",{className:D("tl-selection__fg__outline"),width:(0,eu.$Z)(x),height:(0,eu.$Z)(v)}),(0,O.jsx)(r6,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:I,corner:"top_left_rotate",cursor:p?nd("nwse-rotate",t):void 0,isHidden:W}),(0,O.jsx)(r6,{"data-testid":"selection.rotate.top-right",cx:x+3*I,cy:0,targetSize:I,corner:"top_right_rotate",cursor:p?nd("nesw-rotate",t):void 0,isHidden:W}),(0,O.jsx)(r6,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:v+3*I,targetSize:I,corner:"bottom_left_rotate",cursor:p?nd("swne-rotate",t):void 0,isHidden:W}),(0,O.jsx)(r6,{"data-testid":"selection.rotate.bottom-right",cx:x+3*I,cy:v+3*I,targetSize:I,corner:"bottom_right_rotate",cursor:p?nd("senw-rotate",t):void 0,isHidden:W}),(0,O.jsx)(r7,{"data-testid":"selection.rotate.mobile",cx:E?-(1.5*I):x/2,cy:E?v/2:-(1.5*I),size:S,isHidden:Y}),(0,O.jsx)("rect",{className:D("tl-transparent",{"tl-hidden":ee}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:(0,eu.$Z)(0-(C?2*A:A)),width:(0,eu.$Z)(x),height:(0,eu.$Z)(Math.max(1,2*A)),style:p?{cursor:nd("ns-resize",t)}:void 0,...o}),(0,O.jsx)("rect",{className:D("tl-transparent",{"tl-hidden":et}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:(0,eu.$Z)(x-(E?0:M)),y:0,height:(0,eu.$Z)(v),width:(0,eu.$Z)(Math.max(1,2*M)),style:p?{cursor:nd("ew-resize",t)}:void 0,...s}),(0,O.jsx)("rect",{className:D("tl-transparent",{"tl-hidden":ee}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:(0,eu.$Z)(v-(C?0:A)),width:(0,eu.$Z)(x),height:(0,eu.$Z)(Math.max(1,2*A)),style:p?{cursor:nd("ns-resize",t)}:void 0,...a}),(0,O.jsx)("rect",{className:D("tl-transparent",{"tl-hidden":et}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:(0,eu.$Z)(0-(E?2*M:M)),y:0,height:(0,eu.$Z)(v),width:(0,eu.$Z)(Math.max(1,2*M)),style:p?{cursor:nd("ew-resize",t)}:void 0,...l}),(0,O.jsx)("rect",{className:D("tl-transparent",{"tl-hidden":X}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:(0,eu.$Z)(0-(E?2*M:1.5*M)),y:(0,eu.$Z)(0-(C?2*A:1.5*A)),width:(0,eu.$Z)(3*M),height:(0,eu.$Z)(3*A),style:p?{cursor:nd("nwse-resize",t)}:void 0,...c}),(0,O.jsx)("rect",{className:D("tl-transparent",{"tl-hidden":q}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:(0,eu.$Z)(x-(E?0:1.5*M)),y:(0,eu.$Z)(0-(C?2*A:1.5*A)),width:(0,eu.$Z)(3*M),height:(0,eu.$Z)(3*A),style:p?{cursor:nd("nesw-resize",t)}:void 0,...u}),(0,O.jsx)("rect",{className:D("tl-transparent",{"tl-hidden":Q}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:(0,eu.$Z)(x-(E?M:1.5*M)),y:(0,eu.$Z)(v-(C?A:1.5*A)),width:(0,eu.$Z)(3*M),height:(0,eu.$Z)(3*A),style:p?{cursor:nd("nwse-resize",t)}:void 0,...d}),(0,O.jsx)("rect",{className:D("tl-transparent",{"tl-hidden":J}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:(0,eu.$Z)(0-(E?3*M:1.5*M)),y:(0,eu.$Z)(v-(C?0:1.5*A)),width:(0,eu.$Z)(3*M),height:(0,eu.$Z)(3*A),style:p?{cursor:nd("nesw-resize",t)}:void 0,...h}),U&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("rect",{"data-testid":"selection.resize.top-left",className:D("tl-corner-handle",{"tl-hidden":X}),"aria-label":"top_left handle",x:(0,eu.$Z)(0-S/2),y:(0,eu.$Z)(0-S/2),width:(0,eu.$Z)(S),height:(0,eu.$Z)(S)}),(0,O.jsx)("rect",{"data-testid":"selection.resize.top-right",className:D("tl-corner-handle",{"tl-hidden":q}),"aria-label":"top_right handle",x:(0,eu.$Z)(x-S/2),y:(0,eu.$Z)(0-S/2),width:(0,eu.$Z)(S),height:(0,eu.$Z)(S)}),(0,O.jsx)("rect",{"data-testid":"selection.resize.bottom-right",className:D("tl-corner-handle",{"tl-hidden":Q}),"aria-label":"bottom_right handle",x:(0,eu.$Z)(x-S/2),y:(0,eu.$Z)(v-S/2),width:(0,eu.$Z)(S),height:(0,eu.$Z)(S)}),(0,O.jsx)("rect",{"data-testid":"selection.resize.bottom-left",className:D("tl-corner-handle",{"tl-hidden":J}),"aria-label":"bottom_left handle",x:(0,eu.$Z)(0-S/2),y:(0,eu.$Z)(v-S/2),width:(0,eu.$Z)(S),height:(0,eu.$Z)(S)})]}),er&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:(0,eu.$Z)(0-S/4),y:(0,eu.$Z)(v/2-en/2),rx:S/4,width:(0,eu.$Z)(S/2),height:(0,eu.$Z)(en)}),(0,O.jsx)("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:S/4,x:(0,eu.$Z)(x-S/4),y:(0,eu.$Z)(v/2-en/2),width:(0,eu.$Z)(S/2),height:(0,eu.$Z)(en)})]}),R&&(0,O.jsx)(r8,{size:S,width:x,height:v,hideAlternateHandles:Z})]})})}),r6=function({cx:e,cy:t,targetSize:n,corner:r,cursor:i,isHidden:o,"data-testid":s}){let a=rv(r);return(0,O.jsx)("rect",{className:D("tl-transparent","tl-rotate-corner",{"tl-hidden":o}),"data-testid":s,"aria-label":`${r} target`,pointerEvents:"all",x:(0,eu.$Z)(e-3*n),y:(0,eu.$Z)(t-3*n),width:(0,eu.$Z)(Math.max(1,3*n)),height:(0,eu.$Z)(Math.max(1,3*n)),cursor:i,...a})},r9=Math.sqrt(Math.PI),r7=function({cx:e,cy:t,size:n,isHidden:r,"data-testid":i}){let o=rv("mobile_rotate"),s=(0,G.j)(),a=(0,T.Hg)("zoom level",()=>s.getZoomLevel(),[s]);return(0,O.jsxs)("g",{children:[(0,O.jsx)("circle",{"data-testid":i,pointerEvents:"all",className:D("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":r}),cx:e,cy:t,r:Math.max(1/a*14,20/Math.max(1,a)),...o}),(0,O.jsx)("circle",{className:D("tl-mobile-rotate__fg",{"tl-hidden":r}),cx:e,cy:t,r:n/r9})]})},ie={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},it={s:2,m:3.5,l:5,xl:10},ir={s:18,m:24,l:36,xl:44},ii={s:18,m:22,l:26,xl:32},io={s:18,m:20,l:24,xl:28},is={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"};function ia(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function il(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ia(Object(n),!0).forEach(function(t){var r,i;r=t,i=n[t],(r=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ia(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ic(e,t){return function(e){if(Array.isArray(e))return e}(e)||/*!
 * canvas-size
 * v1.2.6
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,s,a=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(a.push(r.value),a.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw i}}return a}}(e,t)||id(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function iu(e){return function(e){if(Array.isArray(e))return ih(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||id(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function id(e,t){if(e){if("string"==typeof e)return ih(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ih(e,t)}}function ih(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ip(e){var t,n,r=e.sizes.shift(),i=Math.max(Math.ceil(r[0]),1),o=Math.max(Math.ceil(r[1]),1),s=Date.now(),a="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope;a?(t=new OffscreenCanvas(1,1),n=new OffscreenCanvas(i,o)):((t=document.createElement("canvas")).width=1,t.height=1,(n=document.createElement("canvas")).width=i,n.height=o);var l=t.getContext("2d"),c=n.getContext("2d");c&&(c.fillRect.apply(c,[i-1,o-1,1,1]),l.drawImage(n,i-1,o-1,1,1,0,0,1,1));var u=l&&0!==l.getImageData(0,0,1,1).data[3],d=Date.now()-s;return[t,n].forEach(function(e){e.height=0,e.width=0}),a?(postMessage({width:i,height:o,benchmark:d,isTestPass:u}),!u&&e.sizes.length&&ip(e)):u?e.onSuccess(i,o,d):(e.onError(i,o,d),e.sizes.length&&ip(e)),u}var ig=[16384,14188,11402,11180,10836,8192,4096,1],im=[8388607,65535,32767,16384,8192,4096,1],iy=[4194303,65535,32767,16384,8192,4096,1],ib=["onError","onSuccess"],iw={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},ix={};function iv(e){var t=e.width===e.height,n=1===e.height,r=1===e.width,i=[];if(e.width&&e.height)for(var o=e.min||iw.min,s=e.step||iw.step,a=Math.max(e.width,e.height);a>=o;){var l=t||n?a:1,c=t||r?a:1;i.push([l,c]),a-=s}else e.sizes.forEach(function(e){var o=t||n?e:1,s=t||r?e:1;i.push([o,s])});return i}function iS(e){var t=window&&"HTMLCanvasElement"in window,n=window&&"OffscreenCanvas"in window,r=Date.now(),i=e.onError,o=e.onSuccess,s=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,ib),a=null;if(!t)return!1;if(e.useWorker&&n){var l=new Blob(["\n            var canvasTest = ".concat(ip.toString(),";\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        ")],{type:"application/javascript"}),c=URL.createObjectURL(l);a=new Worker(c),URL.revokeObjectURL(c),a.onmessage=function(e){var t=e.data,n=t.width,i=t.height,o=t.benchmark;t.isTestPass?(ix[r].onSuccess(n,i,o),delete ix[r]):ix[r].onError(n,i,o)}}return e.usePromise?new Promise(function(t,n){var l=il(il({},e),{},{onError:function(t,r,o){var s;if(0===e.sizes.length)s=!0;else{var a=ic(e.sizes.slice(-1),1),l=ic(a[0],2),c=l[0],u=l[1];s=t===c&&r===u}i(t,r,o),s&&n({width:t,height:r,benchmark:o})},onSuccess:function(e,n,r){o(e,n,r),t({width:e,height:n,benchmark:r})}});if(a){var c=l.onError,u=l.onSuccess;ix[r]={onError:c,onSuccess:u},a.postMessage(s)}else ip(l)}):a?void(ix[r]={onError:i,onSuccess:o},a.postMessage(s)):ip(e)}var ik=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=iv({width:e.max,height:e.max,min:e.min,step:e.step,sizes:iu(ig)});return iS(il(il(il({},iw),e),{},{sizes:t}))},i_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=iv({width:1,height:e.max,min:e.min,step:e.step,sizes:iu(im)});return iS(il(il(il({},iw),e),{},{sizes:t}))},iE=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=iv({width:e.max,height:1,min:e.min,step:e.step,sizes:iu(iy)});return iS(il(il(il({},iw),e),{},{sizes:t}))};let iC=null;async function iP(){let e=await iE({usePromise:!0}),t=await i_({usePromise:!0}),n=await ik({usePromise:!0});return{maxWidth:e.width,maxHeight:t.height,maxArea:n.width*n.height}}async function iT(e,t){if(e<=8192&&t<=8192&&e*t<=16777216)return[e,t];let{maxWidth:n,maxHeight:r,maxArea:i}=await (iC||(iC=iP()),iC),o=e/t;if(e>n&&(t=(e=n)/o),t>r&&(e=(t=r)*o),e*t>i){let n=Math.sqrt(i/(e*t));e*=n,t*=n}return[e,t]}function ij(e,t){let n=0;for(;e[t+n];)n+=e[t+n]+1;return n+1}function iI(e,t){let n=e.w/t.w,r=e.h/t.h;return n<=1&&r<=1?e:n>r?{w:e.w/n,h:e.h/n}:{w:e.w/r,h:e.h/r}}async function iM(e,t,n,r={}){let i=await M.xe.usingObjectURL(e,M.xe.loadImage),{type:o=e.type,quality:s=.92}=r,[a,l]=await iT(Math.min(2*t,i.naturalWidth),Math.min(2*n,i.naturalHeight)),c=document.createElement("canvas");c.width=a,c.height=l;let u=(0,M.kP)(c.getContext("2d",{willReadFrequently:!0}),"Could not get canvas context");return u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="high",u.drawImage(i,0,0,a,l),new Promise((e,t)=>{c.toBlob(n=>{n?e(n):t(Error("Could not resize image"))},o,s)})}let iA=["image/jpeg","image/png","image/gif","image/svg+xml"],iO=["video/mp4","video/quicktime"];async function i$(e){return function(e){let t,n;let r=new Uint8Array(e),i=0,o=0;if("GIF"!==new TextDecoder("ascii").decode(e.slice(0,3)))return!1;for(t=128&r[10],n=7&r[10],i+=13+(t?3*Math.pow(2,n+1):0);o<2&&i<r.length;)switch(r[i]){case 44:o+=1,t=128&r[i+9],n=7&r[i+9],i+=10+(t?3*Math.pow(2,n+1):0),i+=ij(r,i+1)+1;break;case 33:i+=2,i+=ij(r,i);break;default:i=r.length}return o>1}(await e.arrayBuffer())}let iB=e=>e.split("*").map(e=>(function(e){if("string"!=typeof e)throw TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")})(e)).join(".+"),iD=(e,t)=>!!e.find(e=>{let n=new RegExp(iB(e));return t.match(n)});function iL(e){return function(e){let t=new URL(e).host.replace("www.","");for(let n of I.Lu)if(iD(n.hostnames,t)){let t=n.toEmbedUrl(e);if(t)return{definition:n,embedUrl:t,url:e}}}(e)??function(e){let t=new URL(e).host.replace("www.","");for(let n of I.Lu)if(iD(n.hostnames,t)){let t=n.fromEmbedUrl(e);if(t)return{definition:n,url:t,embedUrl:e}}}(e)}function iR(e){try{return iL(e)}catch(e){console.error(e)}}class iz{static insertTextFirefox(e,t){e.setRangeText(t,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:t,inputType:"insertText",isComposing:!1}))}static insert(e,t){let n=e.ownerDocument,r=n.activeElement;r!==e&&e.focus(),n.execCommand("insertText",!1,t)||iz.insertTextFirefox(e,t),r===n.body?e.blur():r instanceof HTMLElement&&r!==e&&r.focus()}static set(e,t){e.select(),iz.insert(e,t)}static getSelection(e){let{selectionStart:t,selectionEnd:n}=e;return e.value.slice(t||void 0,n||void 0)}static wrapSelection(e,t,n){let{selectionStart:r,selectionEnd:i}=e,o=iz.getSelection(e);iz.insert(e,t+o+(n??t)),e.selectionStart=(r||0)+t.length,e.selectionEnd=(i||0)+t.length}static replace(e,t,n){let r=0;e.value.replace(t,(...t)=>{let i=r+t[t.length-2],o=t[0].length;e.selectionStart=i,e.selectionEnd=i+o;let s="string"==typeof n?n:n(...t);return iz.insert(e,s),e.selectionStart=i,r+=s.length-o,s})}static findLineEnd(e,t){let n=e.lastIndexOf("\n",t-1)+1;return"	"!==e.charAt(n)?t:n+1}static indent(e){let{selectionStart:t,selectionEnd:n,value:r}=e,i=r.slice(t,n),o=/\n/g.exec(i)?.length;if(o&&o>0){let i=r.lastIndexOf("\n",t-1)+1,o=e.value.slice(i,n-1),s=o.replace(/^|\n/g,"$&  "),a=s.length-o.length;e.setSelectionRange(i,n-1),iz.insert(e,s),e.setSelectionRange(t+1,n+a)}else iz.insert(e,"  ")}static unindent(e){let{selectionStart:t,selectionEnd:n,value:r}=e,i=r.lastIndexOf("\n",t-1)+1,o=iz.findLineEnd(r,n),s=e.value.slice(i,o),a=s.replace(/(^|\n)(\t| {1,2})/g,"$1"),l=s.length-a.length;e.setSelectionRange(i,o),iz.insert(e,a);let c=/\t| {1,2}/.exec(r.slice(i,t)),u=c?c[0].length:0,d=t-u;e.setSelectionRange(t-u,Math.max(d,n-l))}static indentCE(e){let t=window.getSelection(),n=e.innerText,r=iN(e)??0,i=iN(e)??0,o=n.slice(r,i),s=/\n/g.exec(o)?.length;if(s&&s>0){let o=n.lastIndexOf("\n",r-1)+1,s=n.slice(o,i-1),a=s.replace(/^|\n/g,"$&  ").length-s.length;t&&t.setBaseAndExtent(e,r+1,e,i+a)}else{let t=window.getSelection();e.innerText=n.slice(0,r)+"  "+n.slice(r),t?.setBaseAndExtent(e,r+1,e,r+2)}}static unindentCE(e){let t=window.getSelection(),n=e.innerText,r=iN(e)??0,i=iN(e)??0,o=n.lastIndexOf("\n",r-1)+1,s=iz.findLineEnd(n,i),a=n.slice(o,s),l=a.replace(/(^|\n)(\t| {1,2})/g,"$1"),c=a.length-l.length;if(t){t.setBaseAndExtent(e,o,e,s);let a=/\t| {1,2}/.exec(n.slice(o,r)),l=a?a[0].length:0,u=r-l;t.setBaseAndExtent(e,r-l,e,Math.max(u,i-c))}}static fixNewLines=/\r?\n|\r/g;static normalizeText(e){return e.replace(iz.fixNewLines,"\n")}static normalizeTextForDom(e){return e.replace(iz.fixNewLines,"\n").split("\n").map(e=>e||" ").join("\n")}}function iN(e){if(void 0===window.getSelection)return;let t=window.getSelection();if(!t)return;let n=0;if(0!==t.rangeCount){let r=t.getRangeAt(0),i=r.cloneRange();i.selectNodeContents(e),i.setEnd(r.endContainer,r.endOffset),n=i.toString().length}return n}let iF=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/,iU=(e,t)=>e.length<=t?e:e.substring(0,t-3)+"...";async function iV(e,t,n){if(!t.length)return[];let r=eh.B.From(n),i=[];for(let e of t)switch(e.type){case"bookmark":i.push({id:(0,I.F1)(),type:"bookmark",x:r.x-150,y:r.y-160,opacity:1,props:{assetId:e.id,url:e.props.src}}),r.x+=300;break;case"image":i.push({id:(0,I.F1)(),type:"image",x:r.x-e.props.w/2,y:r.y-e.props.h/2,opacity:1,props:{assetId:e.id,w:e.props.w,h:e.props.h}}),r.x+=e.props.w;break;case"video":i.push({id:(0,I.F1)(),type:"video",x:r.x-e.props.w/2,y:r.y-e.props.h/2,opacity:1,props:{assetId:e.id,w:e.props.w,h:e.props.h}}),r.x+=e.props.w}return e.batch(()=>{let r=t.filter(t=>!e.getAsset(t.id));r.length&&e.createAssets(r),e.createShapes(i).select(...i.map(e=>e.id)),iH(e,n)}),i.map(e=>e.id)}function iH(e,t){let n=e.getViewportPageBounds(),r=e.getSelectionPageBounds();if(r){let n=r.center.sub(t);e.updateShapes(e.getSelectedShapes().map(t=>{let r=e.getShapeParentTransform(t).decompose().rotation,i=eh.B.Rot(n,-r);return{id:t.id,type:t.type,x:t.x-i.x,y:t.y-i.y}}))}(r=e.getSelectionPageBounds())&&!n.contains(r)&&e.zoomToSelection()}class iZ extends rd.n{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")};onKeyUp=e=>{if("Enter"===e.key){if(this.editor.getInstanceState().isReadonly)return null;let t=this.editor.getOnlySelectedShape();t&&this.editor.getShapeUtil(t).canEdit(t)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(t.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:t}))}}}class iK extends rd.n{static id="pointing";shape;markId="";onEnter=()=>{this.didTimeout=!1;let e=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:e=>!e.isLocked&&this.editor.getShapeUtil(e).canBind(e),margin:0,hitInside:!0,renderingOnly:!0});e?this.editor.setHintingShapes([e.id]):this.createArrowShape(),this.startPreciseTimeout()};onExit=()=>{this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()};onPointerMove=()=>{if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:this.editor.getShapeHandles(this.shape).find(e=>"end"===e.id),isCreating:!0,onInteractionEnd:"arrow"})}};onPointerUp=()=>{this.cancel()};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle")}createArrowShape(){let{originPagePoint:e}=this.editor.inputs,t=(0,I.F1)();this.markId=`creating:${t}`,this.editor.mark(this.markId),this.editor.createShapes([{id:t,type:"arrow",x:e.x,y:e.y}]);let n=this.editor.getShape(t);if(!n)throw Error("expected shape");let r=this.editor.getShapeHandles(n);if(!r)throw Error("expected handles for arrow");let i=this.editor.getShapeUtil("arrow"),o=this.shape,s=r.find(e=>"start"===e.id),a=i.onHandleDrag?.(n,{handle:{...s,x:0,y:0},isPrecise:!0,initial:o});if(a){let e=a.props?.start;e?.type==="binding"&&this.editor.setHintingShapes([e.boundShapeId]),this.editor.updateShapes([a],{squashing:!0})}this.shape=this.editor.getShape(t),this.editor.select(t)}updateArrowShapeEndHandle(){let e=this.shape;if(!e)throw Error("expected shape");let t=this.editor.getShapeHandles(e);if(!t)throw Error("expected handles for arrow");let n={...e,props:{...e.props,end:{...e.props.end,x:0,y:0}}};{let r=this.editor.getShapeUtil("arrow"),i=this.shape,o=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint),s=t.find(e=>"end"===e.id),a=r.onHandleDrag?.(n,{handle:{...s,x:o.x,y:o.y},isPrecise:!1,initial:i});if(a){let e=a.props?.end;e?.type==="binding"&&this.editor.setHintingShapes([e.boundShapeId]),this.editor.updateShapes([a],{squashing:!0})}}{let e=this.editor.getShapeUtil("arrow"),r=this.shape,i=t.find(e=>"start"===e.id),o=e.onHandleDrag?.(n,{handle:{...i,x:0,y:0},isPrecise:this.didTimeout,initial:r});o&&this.editor.updateShapes([o],{squashing:!0})}this.shape=this.editor.getShape(e.id)}preciseTimeout=-1;didTimeout=!1;startPreciseTimeout(){this.preciseTimeout=window.setTimeout(()=>{this.getIsActive()&&(this.didTimeout=!0)},320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}}class iW extends rd.n{static id="arrow";static initial="idle";static children=()=>[iZ,iK];shapeType="arrow"}class iY extends rd.n{static id="drawing";info={};initialShape;shapeType="highlight"===this.parent.id?"highlight":"draw";util=this.editor.getShapeUtil(this.shapeType);isPen=!1;segmentMode="free";didJustShiftClickToExtendPreviousShapeLine=!1;pagePointWhereCurrentSegmentChanged={};pagePointWhereNextSegmentChanged=null;lastRecordedPoint={};mergeNextPoint=!1;currentLineLength=0;canDraw=!1;markId=null;onEnter=e=>{this.markId=null,this.info=e,this.canDraw=!this.editor.getIsMenuOpen(),this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.canDraw&&this.startShape()};onPointerMove=()=>{let{editor:{inputs:e}}=this;if(this.isPen!==e.isPen){if(this.markId){this.editor.bailToMark(this.markId),this.startShape();return}}else!this.canDraw&&e.isDragging&&(this.startShape(),this.canDraw=!0);this.canDraw&&(e.isPen?eh.B.Dist(e.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=e.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateShapes())};onKeyDown=e=>{if("Shift"===e.key)switch(this.segmentMode){case"free":this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break;case"starting_free":this.segmentMode="starting_straight"}this.updateShapes()};onKeyUp=e=>{if("Shift"===e.key)switch(this.editor.snaps.clear(),this.segmentMode){case"straight":this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break;case"starting_straight":this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free"}this.updateShapes()};onExit=()=>{this.editor.snaps.clear(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()};canClose(){return"highlight"!==this.shapeType}getIsClosed(e,t){if(!this.canClose())return!1;let n=it[t],r=e[0].points[0],i=e[e.length-1],o=i.points[i.points.length-1];return r!==o&&this.currentLineLength>4*n&&eh.B.Dist(r,o)<2*n}startShape(){let{inputs:{originPagePoint:e,isPen:t}}=this.editor;this.markId="draw start "+(0,nh.E)(),this.editor.mark(this.markId),this.isPen=t;let n=this.isPen?1.25*this.info.point.z:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=e.clone(),this.initialShape){let t=this.editor.getShape(this.initialShape.id);if(t&&"straight"===this.segmentMode){this.didJustShiftClickToExtendPreviousShapeLine=!0;let n=(0,M.Z$)(t.props.segments);if(!n)throw Error("Expected a previous segment!");let r=(0,M.Z$)(n.points);if(!r)throw Error("Expected a previous point!");let{x:i,y:o}=this.editor.getPointInShapeSpace(t,e).toFixed(),s=this.isPen?1.25*this.info.point.z:.5,a={type:this.segmentMode,points:[{x:r.x,y:r.y,z:+s.toFixed(2)},{x:i,y:o,z:+s.toFixed(2)}]},l=tC._.applyToPoint(this.editor.getShapePageTransform(t.id),r);this.pagePointWhereCurrentSegmentChanged=l,this.pagePointWhereNextSegmentChanged=null;let c=[...t.props.segments,a];this.currentLineLength=this.getLineLength(c);let u={id:t.id,type:this.shapeType,props:{segments:c}};this.canClose()&&(u.props.isClosed=this.getIsClosed(c,t.props.size)),this.editor.updateShapes([u]);return}}this.pagePointWhereCurrentSegmentChanged=e.clone();let r=(0,I.F1)();this.editor.createShapes([{id:r,type:this.shapeType,x:e.x,y:e.y,props:{isPen:this.isPen,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+n.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(r)}updateShapes(){let{inputs:e}=this.editor,{initialShape:t}=this;if(!t)return;let{id:n,props:{size:r}}=t,i=this.editor.getShape(n);if(!i)return;let{segments:o}=i.props,{x:s,y:a,z:l}=this.editor.getPointInShapeSpace(i,e.currentPagePoint).toFixed(),c={x:s,y:a,z:this.isPen?+(1.25*l).toFixed(2):.5};switch(this.segmentMode){case"starting_straight":{let{pagePointWhereNextSegmentChanged:t}=this;if(null===t)throw Error("We should have a point where the segment changed");if(eh.B.Dist(t,e.currentPagePoint)>L.Sk){let e;this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";let t=(0,M.Z$)(o);if(!t)throw Error("Expected a previous segment!");let s=(0,M.Z$)(t.points);if(!s)throw Error("Expected a previous last point!");let a=this.editor.getPointInShapeSpace(i,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if("straight"===t.type){this.currentLineLength+=eh.B.Dist(s,a),e={type:"straight",points:[{...s},a]};let t=this.editor.getShapePageTransform(i);this.pagePointWhereCurrentSegmentChanged=tC._.applyToPoint(t,s)}else e={type:"straight",points:[a,c]};let l={id:n,type:this.shapeType,props:{segments:[...o,e]}};this.canClose()&&(l.props.isClosed=this.getIsClosed(o,r)),this.editor.updateShapes([l],{squashing:!0})}break}case"starting_free":{let{pagePointWhereNextSegmentChanged:t}=this;if(null===t)throw Error("We should have a point where the segment changed");if(eh.B.Dist(t,e.currentPagePoint)>L.Sk){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";let e=o.slice(),t=e[e.length-1],i=(0,M.Z$)(t.points);if(!i)throw Error("No previous point!");let s=[...e,{type:"free",points:[...eh.B.PointsBetween(i,c,6).map(e=>e.toFixed().toJson())]}];this.currentLineLength=this.getLineLength(s);let a={id:n,type:this.shapeType,props:{segments:s}};this.canClose()&&(a.props.isClosed=this.getIsClosed(s,r)),this.editor.updateShapes([a],{squashing:!0})}break}case"straight":{let e,t;let s=o.slice(),a=s[s.length-1],{pagePointWhereCurrentSegmentChanged:l}=this,{currentPagePoint:c,ctrlKey:u}=this.editor.inputs;if(!l)throw Error("We should have a point where the segment changed");let d=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(d=!u,this.didJustShiftClickToExtendPreviousShapeLine=!1):d=!u;let h=this.editor.getPointInShapeSpace(i,c).toFixed().toJson(),p=!1;if((this.editor.user.getIsSnapMode()?!u:u)&&s.length>2){let e;let n=8/this.editor.getZoomLevel();for(let r=0,i=o.length-2;r<i;r++){let i=o[r];if(!i)break;if("free"===i.type)continue;let s=i.points[0],a=(0,M.Z$)(i.points);if(!(s&&a))continue;let l=eh.B.NearestPointOnLineSegment(s,a,h),c=eh.B.Dist(l,h);if(c<n){e=l.toFixed().toJson(),n=c,t=i;break}}e&&(p=!0,h=e)}if(p&&t){let e=this.editor.getShapePageTransform(i),n=t.points[0],r=(0,M.Z$)(t.points);if(!r)throw Error("Expected a last point!");let o=tC._.applyToPoint(e,n),s=tC._.applyToPoint(e,r),a=tC._.applyToPoint(e,h);this.editor.snaps.setLines([{id:(0,nh.E)(),type:"points",points:[o,a,s]}])}else{if(this.editor.snaps.clear(),d){let t=eh.B.Angle(l,c),n=(0,eu.nD)(t,24);e=eh.B.RotWith(c,l,n-t)}else e=c;h=this.editor.getPointInShapeSpace(i,e).toFixed().toJson()}this.currentLineLength+=eh.B.Dist(a.points[0],h),s[s.length-1]={...a,type:"straight",points:[a.points[0],h]};let f={id:n,type:this.shapeType,props:{segments:s}};this.canClose()&&(f.props.isClosed=this.getIsClosed(o,r)),this.editor.updateShapes([f],{squashing:!0});break}case"free":{let e=o.slice(),t=e[e.length-1],i=[...t.points];if(i.length&&this.mergeNextPoint){let{z:e}=i[i.length-1];i[i.length-1]={x:c.x,y:c.y,z:e?Math.max(e,c.z):c.z}}else this.currentLineLength+=eh.B.Dist(i[i.length-1],c),i.push(c);e[e.length-1]={...t,points:i},this.currentLineLength=this.getLineLength(e);let s={id:n,type:this.shapeType,props:{segments:e}};if(this.canClose()&&(s.props.isClosed=this.getIsClosed(e,r)),this.editor.updateShapes([s],{squashing:!0}),i.length>500){this.editor.updateShapes([{id:n,type:this.shapeType,props:{isComplete:!0}}]);let{currentPagePoint:e}=this.editor.inputs,t=(0,I.F1)();this.editor.createShapes([{id:t,type:this.shapeType,x:(0,eu.FH)(e.x),y:(0,eu.FH)(e.y),props:{isPen:this.isPen,segments:[{type:"free",points:[{x:0,y:0,z:this.isPen?+(1.25*l).toFixed():.5}]}]}}]),this.initialShape=structuredClone(this.editor.getShape(t)),this.mergeNextPoint=!1,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.currentLineLength=0}}}}getLineLength(e){let t=0;for(let n of e)for(let e=0;e<n.points.length-1;e++){let r=n.points[e],i=n.points[e+1];t+=eh.B.Sub(i,r).len2()}return Math.sqrt(t)}onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())};complete(){if(!this.canDraw){this.cancel();return}let{initialShape:e}=this;e&&(this.editor.updateShapes([{id:e.id,type:e.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}class iG extends rd.n{static id="idle";onPointerDown=e=>{this.parent.transition("drawing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")}}class iX extends rd.n{static id="draw";static initial="idle";static children=()=>[iG,iY];shapeType="draw";onExit=()=>{this.children.drawing.initialShape=void 0}}class iq extends rf{static id="frame";static initial="idle";shapeType="frame";onCreate=e=>{if(!e)return;let t=this.editor.getShapePageBounds(e),n=[],r=this.editor.getShapeAncestors(e).map(e=>e.id);this.editor.getCurrentPageShapes().map(i=>{if(i.id===e.id||i.isLocked)return;let o=this.editor.getShapePageBounds(i);o&&t.contains(o)&&!r.includes(i.id)&&i.parentId===e.parentId&&n.push(i.id)}),this.editor.reparentShapes(n,e.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")}}class iJ extends rd.n{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onKeyUp=e=>{if("Enter"===e.key){if(this.editor.getInstanceState().isReadonly)return null;let t=this.editor.getOnlySelectedShape();t&&this.editor.getShapeUtil(t).canEdit(t)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(t.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:t}))}};onCancel=()=>{this.editor.setCurrentTool("select")}}class iQ extends rd.n{static id="pointing";markId="";onPointerUp=()=>{this.complete()};onPointerMove=e=>{if(this.editor.inputs.isDragging){let{originPagePoint:t}=this.editor.inputs,n=(0,I.F1)();this.markId=`creating:${n}`,this.editor.mark(this.markId),this.editor.createShapes([{id:n,type:"geo",x:t.x,y:t.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(I.Zu)}}]).select(n).setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.cancel()};complete(){let{originPagePoint:e}=this.editor.inputs,t=(0,I.F1)();this.markId=`creating:${t}`,this.editor.mark(this.markId),this.editor.createShapes([{id:t,type:"geo",x:e.x,y:e.y,props:{geo:this.editor.getStyleForNextShape(I.Zu),w:1,h:1}}]);let n=this.editor.getShape(t);if(!n)return;let r="star"===n.props.geo?new rS.xu(0,0,200,190):"cloud"===n.props.geo?new rS.xu(0,0,300,180):new rS.xu(0,0,200,200),i=r.center,o=this.editor.getShapeParentTransform(n);o&&i.rot(-o.rotation()),this.editor.select(t),this.editor.updateShapes([{id:n.id,type:"geo",x:n.x-i.x,y:n.y-i.y,props:{geo:this.editor.getStyleForNextShape(I.Zu),w:r.width,h:r.height}}]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}}class i0 extends rd.n{static id="geo";static initial="idle";static children=()=>[iJ,iQ];shapeType="geo"}class i1 extends rd.n{static id="highlight";static initial="idle";static children=()=>[iG,iY];shapeType="highlight";onExit=()=>{this.children.drawing.initialShape=void 0}}class i2 extends rd.n{static id="idle";shapeId="";onEnter=e=>{this.shapeId=e.shapeId,this.editor.setCursor({type:"cross",rotation:0})};onPointerDown=()=>{this.parent.transition("pointing",{shapeId:this.shapeId})};onCancel=()=>{this.editor.setCurrentTool("select")}}class i5 extends rd.n{static id="pointing";shape={};markId;onEnter=e=>{let{inputs:t}=this.editor,{currentPagePoint:n}=t;this.markId=void 0;let r=e.shapeId&&this.editor.getShape(e.shapeId);if(r&&t.shiftKey){let e,t;this.markId=`creating:${r.id}`,this.editor.mark(this.markId),this.shape=r;let i=this.editor.getShapeHandles(this.shape);if(!i)return;let o=i.filter(e=>"vertex"===e.type).sort(rV.hl),s=o[o.length-1],a=o[o.length-2],l=tC._.applyToPoint(this.editor.getShapeParentTransform(this.shape),new eh.B(this.shape.x,this.shape.y)),c=eh.B.Sub(n,l);2>eh.B.Dist(s,a)||2>eh.B.Dist(c,s)?(e=s.index,s.id,t={...s,x:c.x+.1,y:c.y+.1}):t={id:"handle:"+(e=(0,rV._L)(s.index)),type:"vertex",index:e,x:c.x+.1,y:c.y+.1,canBind:!1};let u=(0,M.v4)(this.shape.props.handles);u[t.id]=t,this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{handles:u}}])}else{let e=(0,I.F1)();this.markId=`creating:${e}`,this.editor.mark(this.markId),this.editor.createShapes([{id:e,type:"line",x:n.x,y:n.y}]),this.editor.select(e),this.shape=this.editor.getShape(e)}};onPointerMove=()=>{if(this.shape&&this.editor.inputs.isDragging){let e=this.editor.getShapeHandles(this.shape);if(!e)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");let t=(0,M.Z$)(e);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,handle:{...t,x:t.x-.1,y:t.y-.1},onInteractionEnd:"line"})}};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clear()};complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clear()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clear()}}class i3 extends rd.n{static id="line";static initial="idle";static children=()=>[i2,i5];shapeType="line"}class i8 extends rd.n{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")}}class i4 extends rd.n{static id="pointing";dragged=!1;info={};wasFocusedOnEnter=!1;markId="";shape={};onEnter=()=>{this.wasFocusedOnEnter=!this.editor.getIsMenuOpen(),this.wasFocusedOnEnter&&(this.shape=this.createShape())};onPointerMove=e=>{this.editor.inputs.isDragging&&(this.wasFocusedOnEnter||(this.shape=this.createShape()),this.editor.setCurrentTool("select.translating",{...e,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}}))};onPointerUp=()=>{this.complete()};onInterrupt=()=>{this.cancel()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};complete(){this.wasFocusedOnEnter&&(this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape})))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}createShape(){let{inputs:{originPagePoint:e}}=this.editor,t=(0,I.F1)();this.markId=`creating:${t}`,this.editor.mark(this.markId),this.editor.createShapes([{id:t,type:"note",x:e.x,y:e.y}]).select(t);let n=this.editor.getShape(t),r=this.editor.getShapeGeometry(n).bounds;return this.editor.updateShapes([{id:t,type:"note",x:n.x-r.width/2,y:n.y-r.height/2}]),this.editor.getShape(t)}}class i6 extends rd.n{static id="note";static initial="idle";static children=()=>[i8,i4];shapeType="note"}function i9(e){let t;let n=e.getShapeAtPoint(e.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:L.wM/e.getZoomLevel(),renderingOnly:!0});if(!n)return e.setHoveredShape(null);let r=e.getOutermostSelectableShape(n);return t=r===n?n:r.id===e.getFocusedGroupId()||e.getSelectedShapeIds().includes(r.id)?n:r,e.setHoveredShape(t.id)}class i7 extends rd.n{static id="idle";onPointerMove=e=>{switch(e.target){case"shape":case"canvas":i9(this.editor)}};onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onKeyDown=e=>{if("Enter"===e.key){if(this.editor.getInstanceState().isReadonly)return null;let t=this.editor.getOnlySelectedShape();t&&this.editor.getShapeUtil(t).canEdit(t)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(t.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:t}))}};onCancel=()=>{this.editor.setCurrentTool("select")}}class oe extends rd.n{static id="pointing";shape;markId="";onExit=()=>{this.editor.setHintingShapes([])};onPointerMove=e=>{if(this.editor.inputs.isDragging){let{inputs:{originPagePoint:t}}=this.editor,n=(0,I.F1)();if(this.markId=`creating:${n}`,this.editor.mark(this.markId),this.editor.createShapes([{id:n,type:"text",x:t.x,y:t.y,props:{text:"",autoSize:!1,w:20}}]),this.editor.select(n),this.shape=this.editor.getShape(n),!this.shape)return;let{shape:r}=this;this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"text",onCreate:()=>{this.editor.setEditingShape(r.id),this.editor.setCurrentTool("select.editing_shape")}})}};onPointerUp=()=>{this.complete()};onComplete=()=>{this.cancel()};onCancel=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.editor.mark("creating text shape");let e=(0,I.F1)(),{x:t,y:n}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:e,type:"text",x:t,y:n,props:{text:"",autoSize:!0}}]).select(e),this.editor.setEditingShape(e),this.editor.setCurrentTool("select"),this.editor.root.getCurrent()?.transition("editing_shape")}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}}class ot extends rd.n{static id="text";static initial="idle";static children=()=>[i7,oe];shapeType="text"}let on=[ot,iX,i0,i6,i3,iq,iW,i1];function or(){return(0,I.y6)({isDarkMode:ni()})}let oi=$.memo(function({theme:e,d:t,color:n,fill:r}){switch(r){case"none":return null;case"solid":return(0,O.jsx)("path",{fill:e[n].semi,d:t});case"semi":return(0,O.jsx)("path",{fill:e.solid,d:t});case"pattern":return(0,O.jsx)(oo,{theme:e,color:n,fill:r,d:t})}}),oo=function({d:e,color:t,theme:n}){let r=(0,G.j)(),i=(0,T.Hg)("zoomLevel",()=>r.getZoomLevel(),[r]),o=.18>=r.getZoomLevel();return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("path",{fill:n[t].pattern,d:e}),(0,O.jsx)("path",{fill:o?n[t].semi:`url(#${L.iF[`${Math.ceil(i)}_${n.id}`]})`,d:e})]})};function os({d:e,color:t,fill:n,theme:r}){if("none"===n)return;if("pattern"===n){let n=document.createElementNS("http://www.w3.org/2000/svg","g"),i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d",e),i.setAttribute("fill",r[t].pattern);let o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttribute("d",e),o.setAttribute("fill","url(#hash_pattern)"),n.appendChild(i),n.appendChild(o),n}let i=document.createElementNS("http://www.w3.org/2000/svg","path");switch(i.setAttribute("d",e),n){case"semi":i.setAttribute("fill",r.solid);break;case"solid":i.setAttribute("fill",r[t].semi)}return i}function oa(e,t){if(!t)return e;{let n=document.createElementNS("http://www.w3.org/2000/svg","g");return n.appendChild(t),n.appendChild(e),n}}function ol(e,t,n){let{padding:r=0}=n,i=document.createElementNS("http://www.w3.org/2000/svg","text");if(i.setAttribute("font-size",n.fontSize+"px"),i.setAttribute("font-family",n.fontFamily),i.setAttribute("font-style",n.fontStyle),i.setAttribute("font-weight",n.fontWeight),i.setAttribute("line-height",n.lineHeight*n.fontSize+"px"),i.setAttribute("dominant-baseline","mathematical"),i.setAttribute("alignment-baseline","mathematical"),0===t.length)return i;let o=rS.xu.From(t[0].box);for(let{box:e}of t)o.union(e);let s=r+(n.offsetX??0),a=(n.offsetY??0)+n.fontSize/2+("start"===n.verticalTextAlign?r:"end"===n.verticalTextAlign?n.height-r-o.height:(Math.ceil(n.height)-o.height)/2),l=null;for(let{text:e,box:n}of t){if(null!==l&&n.y>l){let e=document.createElementNS("http://www.w3.org/2000/svg","tspan");e.setAttribute("alignment-baseline","mathematical"),e.setAttribute("x",s+"px"),e.setAttribute("y",n.y+a+"px"),e.textContent="\n",i.appendChild(e)}let t=document.createElementNS("http://www.w3.org/2000/svg","tspan");t.setAttribute("alignment-baseline","mathematical"),t.setAttribute("x",n.x+s+"px"),t.setAttribute("y",n.y+a+"px");let r=e.replace(/\s/g,"\xa0");t.textContent=r,i.appendChild(t),l=n.y}return n.stroke&&n.strokeWidth&&(i.setAttribute("stroke",n.stroke),i.setAttribute("stroke-width",n.strokeWidth+"px")),n.fill&&i.setAttribute("fill",n.fill),i}function oc(e){return{key:`${I.Y8.id}:${e}`,getElement:async()=>{let t=function(e){let t=I.p6[e];for(let e of document.fonts)if(t.includes(e.family))return e;return null}(e);if(!t)return null;let n=t.$$_url,r=t.$$_fontface;if(!n||!r)return null;let i=await (await fetch(n)).blob(),o=await new Promise((e,t)=>{let n=new FileReader;n.onload=()=>e(n.result),n.onerror=t,n.readAsDataURL(i)}),s=r.replace(n,o),a=document.createElementNS("http://www.w3.org/2000/svg","style");return a.textContent=s,a}}}function ou(e,t){return{key:`${I.Y8.id}:${e}`,getElement:async()=>{if("pattern"!==e)return null;let n=8/12,r=document.createElement("div");return r.innerHTML=`
				<svg>
					<defs>
						<mask id="hash_pattern_mask">
							<rect x="0" y="0" width="8" height="8" fill="white" />
							<g
								strokeLinecap="round"
								stroke="black"
							>
								<line x1="${1*n}" y1="${3*n}" x2="${3*n}" y2="${1*n}" />
								<line x1="${5*n}" y1="${7*n}" x2="${7*n}" y2="${5*n}" />
								<line x1="${9*n}" y1="${11*n}" x2="${11*n}" y2="${9*n}" />
							</g>
						</mask>
						<pattern
							id="hash_pattern"
							width="8"
							height="8"
							patternUnits="userSpaceOnUse"
						>
							<rect x="0" y="0" width="8" height="8" fill="${t.solid}" mask="url(#hash_pattern_mask)" />
						</pattern>
					</defs>
				</svg>
			`,Array.from(r.querySelectorAll("defs > *"))}}}function od(){return{key:`${I.Y8.id}:pattern`,component:og}}let oh=(e,t,n)=>new Promise((r,i)=>{let o=8*t*e,s=document.createElement("canvas");s.width=o,s.height=o;let a=s.getContext("2d");if(!a)return;a.fillStyle=n?"#212529":"#f8f9fa",a.fillRect(0,0,o,o),a.globalCompositeOperation="destination-out",a.lineCap="round",a.lineWidth=1.25*t*e;let l=8/12;a.beginPath(),a.moveTo(1*l*t*e,3*l*t*e),a.lineTo(3*l*t*e,1*l*t*e),a.moveTo(5*l*t*e,7*l*t*e),a.lineTo(7*l*t*e,5*l*t*e),a.moveTo(9*l*t*e,11*l*t*e),a.lineTo(11*l*t*e,9*l*t*e),a.stroke(),s.toBlob(e=>{!e||N.throwToBlob.get()?i():r(e)})}),op=(e,t)=>{let n=document.createElement("canvas");n.width=e[0],n.height=e[1];let r=n.getContext("2d");return r?(t(r),n.toDataURL()):""},of=()=>{let e=[];for(let t=1;t<=Math.ceil(L.sZ);t++){let n=op([1,1],e=>{e.fillStyle=I.qi.lightMode.black.semi,e.fillRect(0,0,1,1)}),r=op([1,1],e=>{e.fillStyle=I.qi.darkMode.black.semi,e.fillRect(0,0,1,1)});e.push({zoom:t,url:n,darkMode:!1}),e.push({zoom:t,url:r,darkMode:!0})}return e};function og(){let e=(0,G.j)(),t=(0,$.useRef)(null),{defs:n,isReady:r}=function(){let e=(0,G.j)().getInstanceState().devicePixelRatio,[t,n]=(0,$.useState)(!1),r=(0,$.useMemo)(()=>of(),[]),[i,o]=(0,$.useState)(r);return(0,$.useEffect)(()=>{let t=[];for(let n=1;n<=Math.ceil(L.sZ);n++)t.push(oh(e,n,!1).then(e=>({zoom:n,url:URL.createObjectURL(e),darkMode:!1}))),t.push(oh(e,n,!0).then(e=>({zoom:n,url:URL.createObjectURL(e),darkMode:!0})));let r=!1;return Promise.all(t).then(e=>{r||(o(e),n(!0))}),()=>{r=!0,n(!1)}},[e]),{defs:(0,O.jsx)(O.Fragment,{children:i.map(e=>{let t=e.zoom+(e.darkMode?"_dark":"_light");return(0,O.jsx)("pattern",{id:L.iF[t],width:8,height:8,patternUnits:"userSpaceOnUse",children:(0,O.jsx)("image",{href:e.url,width:8,height:8})},t)})}),isReady:t}}();return(0,$.useEffect)(()=>{if(r&&e.environment.isSafari){let e=function e(t){return t.classList.contains("tl-html-layer")?t:t.parentElement?e(t.parentElement):null}(t.current);e&&requestAnimationFrame(()=>{e.style.display="none",requestAnimationFrame(()=>{e.style.display=""})})}},[e,r]),(0,O.jsx)("g",{ref:t,"data-testid":r?"ready-pattern-fill-defs":void 0,children:n})}function om(e,t,n={}){let{closed:r=!1,snap:i=1,start:o="outset",end:s="outset",lengthRatio:a=2,style:l="dashed"}=n,c=0,u=0,d=1,h=0,p=0;switch(l){case"dashed":d=1,c=Math.min(t*a,e/4);break;case"dotted":c=t/(d=100);break;default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||("outset"===o?(e+=c/2,p+=c/2):"skip"===o&&(e-=c,p-=c),"outset"===s?e+=c/2:"skip"!==s||(e-=c)),u=Math.floor(e/c/(2*d)),(u-=u%i)<3&&"dashed"===l?e/t<5?(c=e,u=1,h=0):(c=.333*e,h=.333*e):(c=e/(u=Math.max(u,3))/(2*d),r?(p=c/2,h=(e-u*c)/u):h=(e-u*c)/Math.max(1,u-1)),{strokeDasharray:[c,h].join(" "),strokeDashoffset:p.toString()}}let oy=new WeakMap;function ob(e,t){let n=oy.get(t);if(n)return n;let r=e.getArrowInfo(t),i=0,o=0,s=r.isStraight?new rA.W({start:eh.B.From(r.start.point),end:eh.B.From(r.end.point)}):new rP({center:eh.B.Cast(r.handleArc.center),radius:r.handleArc.radius,start:eh.B.Cast(r.start.point),end:eh.B.Cast(r.end.point),sweepFlag:r.bodyArc.sweepFlag,largeArcFlag:r.bodyArc.largeArcFlag});if(t.props.text.trim()){let n=s.bounds,{w:r,h:a}=e.textMeasure.measureText(t.props.text,{...ie,fontFamily:is[t.props.font],fontSize:io[t.props.size],maxWidth:null});if(i=r,o=a,n.width>n.height){i=Math.max(Math.min(r,64),Math.min(n.width-64,r));let{w:s,h:a}=e.textMeasure.measureText(t.props.text,{...ie,fontFamily:is[t.props.font],fontSize:io[t.props.size],maxWidth:i});i=s,o=a}if(i>16*io[t.props.size]){i=16*io[t.props.size];let{w:n,h:r}=e.textMeasure.measureText(t.props.text,{...ie,fontFamily:is[t.props.font],fontSize:io[t.props.size],maxWidth:i});i=n,o=r}}let a=new eh.B(i,o).addScalar(8.5);return oy.set(t,a),a}function ow(e,t){let n=it[t.props.size];return 20+(n-it.s)*2+(n===it.xl?20:0)}function ox(e,t){let n;let r=[],i=e.getArrowInfo(t),o="none"!==i.start.arrowhead,s="none"!==i.end.arrowhead;if(i.isStraight){let r=function(e,t,n){let r=ob(e,t),i=ow(e,t),o=eh.B.Nudge(n.start.point,n.end.point,i),s=eh.B.Nudge(n.end.point,n.start.point,i),a=(0,r_.qZ)(o,s,rS.xu.FromCenter(n.middle,r).corners);if(!a||2!==a.length)return{start:.5,end:.5};let[l,c]=a;eh.B.Dist2(l,o)>eh.B.Dist2(c,o)&&([c,l]=a);let u=o.add(eh.B.Sub(n.middle,l)),d=s.add(eh.B.Sub(n.middle,c));return{start:eh.B.Dist(n.start.point,u)/n.length,end:eh.B.Dist(n.start.point,d)/n.length}}(e,t,i),a=(0,eu.uZ)(t.props.labelPosition,o?r.start:0,s?r.end:1);a=a>=.48&&a<=.52?.5:a,n=eh.B.Lrp(i.start.point,i.end.point,a)}else{let a=function(e,t,n){let r=ob(e,t),i=ow(e,t),o=Math.sign(t.props.bend),s=i/n.handleArc.radius*o,a=eh.B.Angle(n.bodyArc.center,n.start.point)-s,l=eh.B.Angle(n.bodyArc.center,n.end.point)+s,c=(0,eu.XD)(n.bodyArc.center,n.bodyArc.radius,a),u=(0,eu.XD)(n.bodyArc.center,n.bodyArc.radius,l),d=[],h=ov(n.bodyArc.center,n.bodyArc.radius,a,l,o,rS.xu.FromCenter(c,r).corners);d.push(new rB.w({points:rS.xu.FromCenter(c,r).corners,debugColor:"lime",isFilled:!1,ignore:!0}));let p=ov(n.bodyArc.center,n.bodyArc.radius,a,l,o,rS.xu.FromCenter(u,r).corners);for(let e of(d.push(new rB.w({points:rS.xu.FromCenter(u,r).corners,debugColor:"lime",isFilled:!1,ignore:!0})),[...h??[],...p??[],c,u]))d.push(new rT({x:e.x-3,y:e.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));let f=(h&&oS(n.start.point,h))??n.middle,g=(p&&oS(n.end.point,p))??n.middle,m=eh.B.Angle(n.bodyArc.center,n.start.point),y=eh.B.Angle(n.bodyArc.center,n.end.point),b=eh.B.Angle(n.bodyArc.center,f),w=eh.B.Angle(n.bodyArc.center,g);if((0,eu.mR)(m,b,o)>(0,eu.mR)(m,w,o))return{start:.5,end:.5,dbg:d};let x=(0,eu.mR)(m,y,o);return{start:(0,eu.mR)(m,b,o)/x,end:(0,eu.mR)(m,w,o)/x,dbg:d}}(e,t,i);a.dbg&&r.push(...a.dbg);let l=(0,eu.uZ)(t.props.labelPosition,o?a.start:0,s?a.end:1);l=l>=.48&&l<=.52?.5:l;let c=function(e,t,n,r){let i=(0,eu.mR)(e,t,n);return e+-(i*r*n*1)}(eh.B.Angle(i.bodyArc.center,i.start.point),eh.B.Angle(i.bodyArc.center,i.end.point),Math.sign(t.props.bend),l);n=(0,eu.XD)(i.bodyArc.center,i.bodyArc.radius,c)}let a=ob(e,t);return{box:rS.xu.FromCenter(n,a),debugGeom:r}}function ov(e,t,n,r,i,o){let s=(0,r_.h9)(e,t,o),a=(0,eu.mR)(n,r,i);return s?.filter(t=>{let r=eu.mR(n,eh.B.Angle(e,t),i);return r>=0&&r<=a})}function oS(e,t){let n=null,r=-1/0;for(let i of t){let t=eh.B.Dist2(e,i);t>r&&(n=i,r=t)}return n}function ok(e,t,n){let r="end"===t?e.end.arrowhead:e.start.arrowhead;if("none"===r)return;let i=function(e,t,n){let r;let i="end"===t?e.end.point:e.start.point,o="end"===t?e.start.point:e.end.point,s=Math.max(Math.min((e.isStraight?eh.B.Dist(o,i):Math.abs(e.bodyArc.length))/5,3*n),n);if(e.isStraight)r=eh.B.Nudge(i,o,s);else{let n=(0,r_.bO)(i,s,e.handleArc.center,e.handleArc.radius);r="end"===t?e.handleArc.sweepFlag?n[0]:n[1]:e.handleArc.sweepFlag?n[1]:n[0]}return{point:i,int:r}}(e,t,n);if(i){switch(r){case"bar":return function({int:e,point:t}){let n=eh.B.Sub(e,t).div(2),r=eh.B.Add(t,eh.B.Rot(n,eu.pj)),i=eh.B.Sub(t,eh.B.Rot(n,eu.pj));return`M ${r.x} ${r.y} L ${i.x} ${i.y}`}(i);case"square":return function({int:e,point:t}){let n=eh.B.Lrp(t,e,.85),r=eh.B.Sub(n,t).div(2),i=eh.B.Add(t,eh.B.Rot(r,eu.pj)),o=eh.B.Sub(t,eh.B.Rot(r,eu.pj)),s=eh.B.Add(n,eh.B.Rot(r,eu.pj)),a=eh.B.Sub(n,eh.B.Rot(r,eu.pj));return`M ${i.x} ${i.y} L ${s.x} ${s.y} L ${a.x} ${a.y} L ${o.x} ${o.y} Z`}(i);case"diamond":return function({point:e,int:t}){let n=eh.B.Lrp(e,t,.75),r=eh.B.RotWith(n,e,eu.PI/4),i=eh.B.RotWith(n,e,-eu.PI/4),o=eh.B.Lrp(r,i,.5);return o.add(eh.B.Sub(o,e)),`M ${o.x} ${o.y} L ${r.x} ${r.y} ${e.x} ${e.y} L ${i.x} ${i.y} Z`}(i);case"dot":return function({point:e,int:t}){let n=eh.B.Lrp(e,t,.45),r=eh.B.Dist(n,e);return`M ${n.x-r},${n.y}
  a ${r},${r} 0 1,0 ${2*r},0
  a ${r},${r} 0 1,0 -${2*r},0 `}(i);case"inverted":return function({point:e,int:t}){let n=eh.B.Sub(t,e).div(2),r=eh.B.Add(e,eh.B.Rot(n,eu.pj)),i=eh.B.Sub(e,eh.B.Rot(n,eu.pj));return`M ${r.x} ${r.y} L ${t.x} ${t.y} L ${i.x} ${i.y} Z`}(i);case"arrow":return function({point:e,int:t}){let n=eh.B.RotWith(t,e,eu.PI/6),r=eh.B.RotWith(t,e,-eu.PI/6);return`M ${n.x} ${n.y} L ${e.x} ${e.y} L ${r.x} ${r.y}`}(i);case"triangle":return function({point:e,int:t}){let n=eh.B.RotWith(t,e,eu.PI/6),r=eh.B.RotWith(t,e,-eu.PI/6);return`M ${n.x} ${n.y} L ${e.x} ${e.y} L ${r.x} ${r.y} Z`}(i)}return""}}function o_(e){let{start:t,end:n,bodyArc:{radius:r,largeArcFlag:i,sweepFlag:o}}=e;return`M${t.point.x},${t.point.y} A${r} ${r} 0 ${i} ${o} ${n.point.x},${n.point.y}`}function oE(e,t){return`M${e.x},${e.y}L${t.x},${t.y}`}function oC(e){return oE(e.start.point,e.end.point)}function oP(e,t,n){let r=(0,G.j)(),i=(0,$.useRef)(null),o=(0,$.useRef)(!1),s=(0,$.useRef)(),a=(0,T.Hg)("isEditing",()=>r.getEditingShapeId()===e,[r,e]);(0,$.useEffect)(()=>{let e=i.current;e&&a&&document.activeElement!==e&&e.focus()},[a]);let l=(0,$.useCallback)(()=>{let t=o.current;o.current=!1,requestAnimationFrame(()=>{let n=i.current;if(!n)return;let o=r.getShape(e);o&&(n.value=o.props.text,n.value.length&&!t&&n.select())})},[r,e]),c=(0,$.useCallback)(()=>{let t=s.current;requestAnimationFrame(()=>{let n=i.current,s=r.getEditingShapeId();if(n&&s){if(s===e){if(t){if(t.length){o.current=!0,n.focus();let e=window.getSelection();e&&t.forEach(t=>e.addRange(t))}else n.focus()}else n.focus()}}else window.getSelection()?.removeAllRanges(),r.complete()})},[r,e]),u=(0,$.useCallback)(e=>{if(a)switch((e.ctrlKey||e.metaKey)&&W(e),e.key){case"Enter":(e.ctrlKey||e.metaKey)&&r.complete();break;case"Tab":H(e),e.shiftKey?iz.unindent(e.currentTarget):iz.indent(e.currentTarget)}},[r,a]),d=(0,$.useCallback)(n=>{if(!a)return;let i=iz.normalizeText(n.currentTarget.value),o=i.replace(/\t/g,"  ");if(o!==i){let e=n.currentTarget.selectionStart;n.currentTarget.value=o,n.currentTarget.selectionStart=e+(o.length-i.length),n.currentTarget.selectionEnd=e+(o.length-i.length),i=o}r.updateShapes([{id:e,type:t,props:{text:i}}])},[r,e,t,a]),h=0===n.trim().length;return(0,$.useEffect)(()=>{if(a&&i.current){let e=function(){let e=window.getSelection?.();if(e&&"None"!==e.type){let t=[];if(e)for(let n=0;n<e.rangeCount;n++)t.push(e.getRangeAt?.(n));s.current=t}};return document.addEventListener("selectionchange",e),()=>{document.removeEventListener("selectionchange",e)}}},[a]),{rInput:i,isEditing:a,handleFocus:l,handleBlur:c,handleKeyDown:u,handleChange:d,handleInputPointerDown:(0,$.useCallback)(t=>{r.dispatch({...Y(t),type:"pointer",name:"pointer_down",target:"shape",shape:r.getShape(e)}),W(t)},[r,e]),handleDoubleClick:W,isEmpty:h}}let oT=$.memo(function({id:e,text:t,size:n,font:r,position:i,width:o,labelColor:s}){let{rInput:a,isEditing:l,handleFocus:c,handleBlur:u,handleKeyDown:d,handleChange:h,isEmpty:p,handleInputPointerDown:f,handleDoubleClick:g}=oP(e,"arrow",t),m=iz.normalizeTextForDom(t).trim().length>0;return l||m?(0,O.jsx)("div",{className:"tl-arrow-label","data-font":r,"data-align":"center","data-hastext":!p,"data-isediting":l,style:{textAlign:"center",fontSize:io[n],lineHeight:io[n]*ie.lineHeight+"px",transform:`translate(${i.x}px, ${i.y}px)`,color:s},children:(0,O.jsxs)("div",{className:"tl-arrow-label__inner",children:[(0,O.jsx)("p",{style:{width:o||"9px"},children:t?iz.normalizeTextForDom(t):" "}),l&&(0,O.jsx)("textarea",{ref:a,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:t,onFocus:c,onChange:h,onKeyDown:d,onBlur:u,onContextMenu:W,onPointerDown:f,onDoubleClick:g})]})}):null}),oj=0;var oI=((c=oI||{}).START="start",c.MIDDLE="middle",c.END="end",c);class oM extends rs.E{static type="arrow";static props=I.si;static migrations=I.Vm;canEdit=()=>!0;canBind=()=>!1;canSnap=()=>!1;hideResizeHandles=()=>!0;hideRotateHandle=()=>!0;hideSelectionBoundsBg=()=>!0;hideSelectionBoundsFg=()=>!0;getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{type:"point",x:0,y:0},end:{type:"point",x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",labelPosition:.5,font:"draw"}}getGeometry(e){let t;let n=this.editor.getArrowInfo(e),r=[],i=n.isStraight?new rA.W({start:eh.B.From(n.start.point),end:eh.B.From(n.end.point)}):new rP({center:eh.B.Cast(n.handleArc.center),radius:n.handleArc.radius,start:eh.B.Cast(n.start.point),end:eh.B.Cast(n.end.point),sweepFlag:n.bodyArc.sweepFlag,largeArcFlag:n.bodyArc.largeArcFlag});if(e.props.text.trim()){let n=ox(this.editor,e);r.push(...n.debugGeom),t=new ro.z({x:n.box.x,y:n.box.y,width:n.box.w,height:n.box.h,isFilled:!0,isLabel:!0})}return new tP.m({children:[...t?[i,t]:[i],...r],isSnappable:!1})}getLength(e){let t=this.editor.getArrowInfo(e);return t.isStraight?eh.B.Dist(t.start.handle,t.end.handle):Math.abs(t.handleArc.length)}getHandles(e){let t=this.editor.getArrowInfo(e);return[{id:"start",type:"vertex",index:"a0",x:t.start.handle.x,y:t.start.handle.y,canBind:!0},{id:"middle",type:"virtual",index:"a2",x:t.middle.x,y:t.middle.y,canBind:!1},{id:"end",type:"vertex",index:"a3",x:t.end.handle.x,y:t.end.handle.y,canBind:!0}].filter(Boolean)}onHandleDrag=(e,{handle:t,isPrecise:n})=>{let r=t.id;if("middle"===r){let{start:n,end:r}=(0,ru.Qs)(this.editor,e),i=eh.B.Sub(r,n),o=eh.B.Per(i),s=eh.B.Med(r,n),a=eh.B.Sub(s,o),l=eh.B.Add(s,o),c=eh.B.NearestPointOnLineSegment(a,l,t,!1),u=eh.B.Dist(c,s);return eh.B.Clockwise(c,r,s)&&(u*=-1),{id:e.id,type:e.type,props:{bend:u}}}let i=(0,M.p$)(e);if(this.editor.inputs.ctrlKey)return i.props[r]={type:"point",x:t.x,y:t.y},i;let o=this.editor.getShapePageTransform(e.id).applyToPoint(t),s=this.editor.getShapeAtPoint(o,{hitInside:!0,hitFrameInside:!0,margin:0,filter:e=>!e.isLocked&&this.editor.getShapeUtil(e).canBind(e)});if(!s)return i.props[r]={type:"point",x:t.x,y:t.y},i;let a=this.editor.getShapeGeometry(s),l=rS.xu.ZeroFix(a.bounds),c=this.editor.getShapePageTransform(i.id).applyToPoint(t),u=this.editor.getPointInShapeSpace(s,c),d=n;if(!d){let e=i.props[r];("point"===e.type||"binding"===e.type&&s.id!==e.boundShapeId)&&(d=.5>this.editor.inputs.pointerVelocity.len())}if(!n){a.isClosed||(d=!0);let e=i.props["start"===r?"end":"start"];"binding"===e.type&&s.id===e.boundShapeId&&e.isPrecise&&(d=!0)}let h={x:(u.x-l.minX)/l.width,y:(u.y-l.minY)/l.height};return d&&eh.B.Dist(u,l.center)<Math.max(4,Math.min(.15*Math.min(l.width,l.height),16))/this.editor.getZoomLevel()&&(h.x=.5,h.y=.5),i.props[r]={type:"binding",boundShapeId:s.id,normalizedAnchor:h,isPrecise:d,isExact:this.editor.inputs.altKey},"binding"===i.props.start.type&&"binding"===i.props.end.type&&i.props.start.boundShapeId===i.props.end.boundShapeId&&eh.B.Equals(i.props.start.normalizedAnchor,i.props.end.normalizedAnchor)&&(i.props.end.normalizedAnchor.x+=.05),i};onTranslateStart=e=>{let t="binding"===e.props.start.type?e.props.start.boundShapeId:null,n="binding"===e.props.end.type?e.props.end.boundShapeId:null,r=(0,ru.Qs)(this.editor,e),i=this.editor.getShapePageTransform(e.id),o=this.editor.getSelectedShapeIds();if(t&&(o.includes(t)||this.editor.isAncestorSelected(t))||n&&(o.includes(n)||this.editor.isAncestorSelected(n)))return;let s=e;for(let t of(o$.set(e,{pagePosition:i.applyToPoint(e),terminalBindings:(0,M.Fm)(r,(t,n)=>{let r=e.props[t];return"binding"!==r.type?null:{binding:r,shapePosition:n,pagePosition:i.applyToPoint(n)}})}),["start","end"])){let n=e.props[t];"binding"===n.type&&(s={...e,props:{...e.props,[t]:{...n,isPrecise:!0}}})}return s};onTranslate=(e,t)=>{let n=o$.get(e);if(!n)return;let r=this.editor.getShapePageTransform(t.id),i=eh.B.Sub(r.applyToPoint(t),n.pagePosition),o=t;for(let[e,t]of(0,M.EP)(n.terminalBindings)){if(!t)continue;let n=eh.B.Add(t.pagePosition,eh.B.Mul(i,.5)),r=this.editor.getShapeAtPoint(n,{hitInside:!0,hitFrameInside:!0,margin:0,filter:e=>!e.isLocked&&this.editor.getShapeUtil(e).canBind(e)});if(r?.id===t.binding.boundShapeId){let i=rS.xu.ZeroFix(this.editor.getShapeGeometry(r).bounds),s=this.editor.getPointInShapeSpace(r,n),a={x:(s.x-i.minX)/i.width,y:(s.y-i.minY)/i.height};o={...o,props:{...o.props,[e]:{...t.binding,isPrecise:!0,normalizedAnchor:a}}}}else o={...o,props:{...o.props,[e]:{type:"point",x:t.shapePosition.x,y:t.shapePosition.y}}}}return o};onResize=(e,t)=>{let{scaleX:n,scaleY:r}=t,i=(0,ru.Qs)(this.editor,e),{start:o,end:s}=(0,M.p$)(e.props),{bend:a}=e.props;"point"===o.type&&(o.x=i.start.x*n,o.y=i.start.y*r),"point"===s.type&&(s.x=i.end.x*n,s.y=i.end.y*r);let l=Math.abs(n),c=Math.abs(r);return n<0&&r>=0?(0!==a&&(a*=-1*Math.max(l,c)),"binding"===o.type&&(o.normalizedAnchor.x=1-o.normalizedAnchor.x),"binding"===s.type&&(s.normalizedAnchor.x=1-s.normalizedAnchor.x)):n>=0&&r<0?(0!==a&&(a*=-1*Math.max(l,c)),"binding"===o.type&&(o.normalizedAnchor.y=1-o.normalizedAnchor.y),"binding"===s.type&&(s.normalizedAnchor.y=1-s.normalizedAnchor.y)):n>=0&&r>=0?0!==a&&(a*=Math.max(l,c)):n<0&&r<0&&(0!==a&&(a*=Math.max(l,c)),"binding"===o.type&&(o.normalizedAnchor.x=1-o.normalizedAnchor.x,o.normalizedAnchor.y=1-o.normalizedAnchor.y),"binding"===s.type&&(s.normalizedAnchor.x=1-s.normalizedAnchor.x,s.normalizedAnchor.y=1-s.normalizedAnchor.y)),{props:{start:o,end:s,bend:a}}};onDoubleClickHandle=(e,t)=>{switch(t.id){case"start":return{id:e.id,type:e.type,props:{...e.props,arrowheadStart:"none"===e.props.arrowheadStart?"arrow":"none"}};case"end":return{id:e.id,type:e.type,props:{...e.props,arrowheadEnd:"none"===e.props.arrowheadEnd?"arrow":"none"}}}};component(e){let t=or(),n=this.editor.getOnlySelectedShape(),r=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getInstanceState().isReadonly,i=this.editor.getArrowInfo(e),o=rS.xu.ZeroFix(this.editor.getShapeGeometry(e).bounds),s=$.useMemo(()=>this.editor.environment.isSafari?oj+=1:0,[e]);if(!i?.isValid)return null;let a=it[e.props.size],l=i.start.arrowhead&&ok(i,"start",a),c=i.end.arrowhead&&ok(i,"end",a),u=i.isStraight?oC(i):o_(i),d=null;if(n===e&&r){let{strokeDasharray:t,strokeDashoffset:n}=om(this.getLength(e),2,{end:"skip",start:"skip",lengthRatio:2.5});d="binding"===e.props.start.type||"binding"===e.props.end.type?(0,O.jsx)("path",{className:"tl-arrow-hint",d:i.isStraight?oE(i.start.handle,i.end.handle):function(e){let{start:t,end:n,handleArc:{radius:r,largeArcFlag:i,sweepFlag:o}}=e;return`M${t.handle.x},${t.handle.y} A${r} ${r} 0 ${i} ${o} ${n.handle.x},${n.handle.y}`}(i),strokeDasharray:t,strokeDashoffset:n,strokeWidth:2,markerStart:"binding"===e.props.start.type?e.props.start.isExact?"":e.props.start.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",markerEnd:"binding"===e.props.end.type?e.props.end.isExact?"":e.props.end.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",opacity:.16}):null}let{strokeDasharray:h,strokeDashoffset:p}=om(i.isStraight?i.length:Math.abs(i.bodyArc.length),a,{style:e.props.dash}),f=ox(this.editor,e),g=!("none"===i.start.arrowhead||"arrow"===i.start.arrowhead),m=!("none"===i.end.arrowhead||"arrow"===i.end.arrowhead),y=(e.id+"_clip_"+s).replace(":","_");return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(rn.g,{id:e.id,style:{minWidth:50,minHeight:50},children:[(0,O.jsx)("defs",{children:(0,O.jsxs)("mask",{id:y,children:[(0,O.jsx)("rect",{x:(0,eu.$Z)(-100+o.minX),y:(0,eu.$Z)(-100+o.minY),width:(0,eu.$Z)(o.width+200),height:(0,eu.$Z)(o.height+200),fill:"white"}),e.props.text.trim()&&(0,O.jsx)("rect",{x:f.box.x,y:f.box.y,width:f.box.w,height:f.box.h,fill:"black",rx:4,ry:4}),l&&g&&(0,O.jsx)("path",{d:l,fill:"arrow"===i.start.arrowhead?"none":"black",stroke:"none"}),c&&m&&(0,O.jsx)("path",{d:c,fill:"arrow"===i.end.arrowhead?"none":"black",stroke:"none"})]})}),(0,O.jsxs)("g",{fill:"none",stroke:t[e.props.color].solid,strokeWidth:a,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[d,(0,O.jsxs)("g",{mask:`url(#${y})`,children:[(0,O.jsx)("rect",{x:(0,eu.$Z)(o.minX-100),y:(0,eu.$Z)(o.minY-100),width:(0,eu.$Z)(o.width+200),height:(0,eu.$Z)(o.height+200),opacity:0}),(0,O.jsx)("path",{d:u,strokeDasharray:h,strokeDashoffset:p})]}),l&&g&&"none"!==e.props.fill&&(0,O.jsx)(oi,{theme:t,d:l,color:e.props.color,fill:e.props.fill}),c&&m&&"none"!==e.props.fill&&(0,O.jsx)(oi,{theme:t,d:c,color:e.props.color,fill:e.props.fill}),l&&(0,O.jsx)("path",{d:l}),c&&(0,O.jsx)("path",{d:c})]})]}),(0,O.jsx)(oT,{id:e.id,text:e.props.text,font:e.props.font,size:e.props.size,position:f.box.center,width:f.box.w,labelColor:t[e.props.labelColor].solid})]})}indicator(e){let{start:t,end:n}=(0,ru.Qs)(this.editor,e),r=this.editor.getArrowInfo(e),i=this.editor.getShapeGeometry(e),o=i.bounds,s=e.props.text.trim()?i.children[1]:null,a=rx(e.id);if(!r||eh.B.Equals(t,n))return null;let l=it[e.props.size],c=r.start.arrowhead&&ok(r,"start",l),u=r.end.arrowhead&&ok(r,"end",l),d=r.isStraight?oC(r):o_(r),h=c&&"arrow"!==r.start.arrowhead||u&&"arrow"!==r.end.arrowhead||!!s,p=(e.id+"_clip").replace(":","_");return a&&s?(0,O.jsx)("rect",{x:(0,eu.$Z)(s.x),y:(0,eu.$Z)(s.y),width:s.w,height:s.h,rx:3.5,ry:3.5}):(0,O.jsxs)("g",{children:[h&&(0,O.jsx)("defs",{children:(0,O.jsxs)("mask",{id:p,children:[(0,O.jsx)("rect",{x:o.minX-100,y:o.minY-100,width:o.w+200,height:o.h+200,fill:"white"}),s&&(0,O.jsx)("rect",{x:(0,eu.$Z)(s.x),y:(0,eu.$Z)(s.y),width:s.w,height:s.h,fill:"black",rx:3.5,ry:3.5}),c&&(0,O.jsx)("path",{d:c,fill:"arrow"===r.start.arrowhead?"none":"black",stroke:"none"}),u&&(0,O.jsx)("path",{d:u,fill:"arrow"===r.end.arrowhead?"none":"black",stroke:"none"})]})}),(0,O.jsxs)("g",{...h?{mask:`url(#${p})`}:void 0,children:[h&&(0,O.jsx)("rect",{x:o.minX-100,y:o.minY-100,width:o.width+200,height:o.height+200,opacity:0}),(0,O.jsx)("path",{d:d})]}),c&&(0,O.jsx)("path",{d:c}),u&&(0,O.jsx)("path",{d:u}),s&&(0,O.jsx)("rect",{x:(0,eu.$Z)(s.x),y:(0,eu.$Z)(s.y),width:s.w,height:s.h,rx:3.5,ry:3.5})]})}onEditEnd=e=>{let{id:t,type:n,props:{text:r}}=e;r.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:r.trimEnd()}}])};toSvg(e,t){let n=(0,I.y6)({isDarkMode:this.editor.user.getIsDarkMode()});t.addExportDef(ou(e.props.fill,n));let r=n[e.props.color].solid,i=this.editor.getArrowInfo(e),o=it[e.props.size],s=document.createElementNS("http://www.w3.org/2000/svg","g");if(!i)return s;let a=i.start.arrowhead&&ok(i,"start",o),l=i.end.arrowhead&&ok(i,"end",o),c=this.editor.getShapeGeometry(e),u=c.bounds,d=e.props.text.trim()?c.children[1]:null,h=(e.id+"_clip").replace(":","_");if(a||l||d){let e=document.createElementNS("http://www.w3.org/2000/svg","defs"),t=document.createElementNS("http://www.w3.org/2000/svg","mask");t.id=h;let n=document.createElementNS("http://www.w3.org/2000/svg","rect");if(n.setAttribute("x",u.minX-100+""),n.setAttribute("y",u.minY-100+""),n.setAttribute("width",u.width+200+""),n.setAttribute("height",u.height+200+""),n.setAttribute("fill","white"),t.appendChild(n),a&&t.appendChild(oA(a,i.start.arrowhead)),l&&t.appendChild(oA(l,i.end.arrowhead)),d){let e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("x",d.x+""),e.setAttribute("y",d.y+""),e.setAttribute("width",d.w+""),e.setAttribute("height",d.h+""),e.setAttribute("fill","black"),t.appendChild(e)}e.appendChild(t),s.appendChild(e)}let p=document.createElementNS("http://www.w3.org/2000/svg","g");p.setAttribute("mask",`url(#${h})`),s.appendChild(p);let f=document.createElementNS("http://www.w3.org/2000/svg","rect");f.setAttribute("x","-100"),f.setAttribute("y","-100"),f.setAttribute("width",u.width+200+""),f.setAttribute("height",u.height+200+""),f.setAttribute("fill","transparent"),f.setAttribute("stroke","none"),p.appendChild(f);let g=function(e,t,n){let r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r.setAttribute("fill","none"),r.setAttribute("stroke",t),r.setAttribute("stroke-width",n+""),r}(i.isStraight?oC(i):o_(i),r,o),{strokeDasharray:m,strokeDashoffset:y}=om(i.isStraight?i.length:Math.abs(i.bodyArc.length),o,{style:e.props.dash});if(g.setAttribute("stroke-dasharray",m),g.setAttribute("stroke-dashoffset",y),p.appendChild(g),a&&s.appendChild(oO(a,e.props.color,o,"arrow"===e.props.arrowheadStart?"none":e.props.fill,n)),l&&s.appendChild(oO(l,e.props.color,o,"arrow"===e.props.arrowheadEnd?"none":e.props.fill,n)),d){t.addExportDef(oc(e.props.font));let r={fontSize:io[e.props.size],lineHeight:ie.lineHeight,fontFamily:I.p6[e.props.font],padding:0,textAlign:"middle",width:d.w-8,verticalTextAlign:"middle",height:d.h,fontStyle:"normal",fontWeight:"normal",overflow:"wrap"},i=ol(this.editor,this.editor.textMeasure.measureTextSpans(e.props.text,r),r);i.setAttribute("fill",n[e.props.labelColor].solid),Array.from(i.children).forEach(e=>{let t=parseFloat(e.getAttribute("x")||"0"),n=parseFloat(e.getAttribute("y")||"0");e.setAttribute("x",t+4+d.x+"px"),e.setAttribute("y",n+d.y+"px")});let o=i.cloneNode(!0);o.setAttribute("stroke-width","2"),o.setAttribute("fill",n.background),o.setAttribute("stroke",n.background),s.appendChild(o),s.appendChild(i)}return s}getCanvasSvgDefs(){return[od()]}}function oA(e,t){let n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d",e),n.setAttribute("fill","arrow"===t?"none":"black"),n.setAttribute("stroke","none"),n}function oO(e,t,n,r,i){let o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d",e),o.setAttribute("fill","none"),o.setAttribute("stroke",i[t].solid),o.setAttribute("stroke-width",n+"");let s=os({d:e,fill:r,color:t,theme:i});if(!s)return o;{let e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.appendChild(s),e.appendChild(o),e}}let o$=new WeakMap,oB="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function oD({url:e,zoomLevel:t}){return(0,O.jsx)("a",{className:D("tl-hyperlink-button",{"tl-hyperlink-button__hidden":t<.32}),href:e,target:"_blank",rel:"noopener noreferrer",onPointerDown:W,onPointerUp:W,title:e,draggable:!1,children:(0,O.jsx)("div",{className:"tl-hyperlink-button__icon",style:{mask:`url("${oB}") center 100% / 100% no-repeat`,WebkitMask:`url("${oB}") center 100% / 100% no-repeat`}})})}let oL=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function oR(e){return oL.map(t=>{let{offsetX:n,offsetY:r,blur:i,spread:o,color:s}=t,{x:a,y:l}=new eh.B(n,r).rot(-e);return`${a}px ${l}px ${i}px ${o}px ${s}`}).join(", ")}class oz extends rl{static type="bookmark";static props=I.qU;static migrations=I.h9;canResize=()=>!1;hideSelectionBoundsFg=()=>!0;getDefaultProps(){return{url:"",w:300,h:320,assetId:null}}component(e){let t=e.props.assetId?this.editor.getAsset(e.props.assetId):null,n=this.editor.getShapePageTransform(e).rotation(),r=oN(e);return(0,O.jsx)(re,{children:(0,O.jsxs)("div",{className:"tl-bookmark__container",style:{boxShadow:oR(n)},children:[(0,O.jsxs)("div",{className:"tl-bookmark__image_container",children:[t?.props.image?(0,O.jsx)("img",{className:"tl-bookmark__image",draggable:!1,src:t?.props.image,alt:t?.props.title||""}):(0,O.jsx)("div",{className:"tl-bookmark__placeholder"}),(0,O.jsx)(oD,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]}),(0,O.jsxs)("div",{className:"tl-bookmark__copy_container",children:[t?.props.title&&(0,O.jsx)("h2",{className:"tl-bookmark__heading",children:iU(t?.props.title||"",54)}),t?.props.description&&(0,O.jsx)("p",{className:"tl-bookmark__description",children:iU(t?.props.description||"",128)}),(0,O.jsx)("a",{className:"tl-bookmark__link",href:e.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:W,onPointerUp:W,onClick:W,children:iU(r,45)})]})]})})}indicator(e){return(0,O.jsx)("rect",{width:(0,eu.$Z)(e.props.w),height:(0,eu.$Z)(e.props.h),rx:"6",ry:"6"})}onBeforeCreate=e=>{oF(this.editor,e)};onBeforeUpdate=(e,t)=>{if(e.props.url!==t.props.url){if(!A.T.linkUrl.isValid(t.props.url))return{...t,props:{...t.props,url:e.props.url}};oF(this.editor,t)}}}let oN=e=>{try{let t=new URL(e.props.url),n=t.pathname.replace(/\/*$/,"");return`${t.hostname}${n}`}catch(t){return e.props.url}};function oF(e,t){let{url:n}=t.props,r=I.Yk.createId((0,M.jK)(n));e.getAsset(r)?t.props.assetId!==r&&e.updateShapes([{id:t.id,type:t.type,props:{assetId:r}}]):(e.updateShapes([{id:t.id,type:t.type,props:{assetId:null}}]),oU(e,t))}let oU=(0,M.Ds)(async(e,t)=>{let{url:n}=t.props,r=await e.getAssetForExternalContent({type:"url",url:n});r&&e.batch(()=>{e.createAssets([r]),e.updateShapes([{id:t.id,type:t.type,props:{assetId:r.id}}])})},500);function oV(e,t=!1){let n=e.length;if(n<2)return"";let r=e[0].point,i=e[1].point;if(2===n)return`M${(0,eu.Yk)(r)}L${(0,eu.Yk)(i)}`;let o="";for(let t=2,s=n-1;t<s;t++)r=e[t].point,i=e[t+1].point,o+=(0,eu.Y8)(r,i);return t?`M${(0,eu.Y8)(e[0].point,e[1].point)}Q${(0,eu.Yk)(e[1].point)}${(0,eu.Y8)(e[1].point,e[2].point)}T${o}${(0,eu.Y8)(e[n-1].point,e[0].point)}${(0,eu.Y8)(e[0].point,e[1].point)}Z`:`M${(0,eu.Yk)(e[0].point)}Q${(0,eu.Yk)(e[1].point)}${(0,eu.Y8)(e[1].point,e[2].point)}${e.length>3?"T":""}${o}L${(0,eu.Yk)(e[n-1].point)}`}function oH(e){let t=e[0];for(;e.length>2;){let n=e[1];if(eh.B.Dist(t.point,n.point)<(t.radius+n.radius)/2*.5)e.splice(1,1);else break}let n=e[e.length-1];for(;e.length>2;){let t=e[e.length-2];if(eh.B.Dist(n.point,t.point)<(n.radius+t.radius)/2*.5)e.splice(e.length-2,1);else break}return e.length>1&&(e[0]={...e[0],vector:eh.B.FromAngle(eh.B.Angle(e[1].point,e[0].point))},e[e.length-1]={...e[e.length-1],vector:eh.B.FromAngle(eh.B.Angle(e[e.length-1].point,e[e.length-2].point))}),e}function oZ(){let e=(0,G.j)();return(0,T.Hg)("zoom",()=>.35>e.getZoomLevel(),[e])}let oK=e=>.65*e+.35*(0,eu.dv)(e*eu.PI/2),oW=e=>({size:1+e,thinning:.5,streamline:.62+(1+e)/8*.06,smoothing:.62,easing:rk.L.easeOutSine,simulatePressure:!0}),oY=e=>({size:1+1.2*e,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:oK}),oG=e=>({size:1+e,thinning:0,streamline:.62+(1+e)/8*.06,smoothing:.62,simulatePressure:!1,easing:rk.L.linear});function oX({strokeWidth:e,showAsComplete:t}){return{size:1+e,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:rk.L.easeOutSine,last:t}}function oq(e,t,n,r){return{...r?oG(t):"draw"===e.dash?e.isPen?oY(t):oW(t):oG(t),last:e.isComplete||n}}function oJ(e){let t=[];for(let n of e)if("free"===n.type||n.points.length<2)t.push(...n.points.map(eh.B.Cast));else{let e=Math.max(4,Math.floor(eh.B.Dist(n.points[0],n.points[1])/16));t.push(...eh.B.PointsBetween(n.points[0],n.points[1],e))}return t}function oQ(e,t){return({draw:"none",solid:"none",dotted:`0.1 ${2*t}`,dashed:`${2*t} ${2*t}`})[e.props.dash]}class o0 extends rs.E{static type="draw";static props=I.wu;static migrations=I._l;hideResizeHandles=e=>o2(e);hideRotateHandle=e=>o2(e);hideSelectionBoundsFg=e=>o2(e);getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1}}getGeometry(e){let t=oJ(e.props.segments),n=it[e.props.size];if(1===e.props.segments.length){let e=rS.xu.FromPoints(t);if(e.width<2*n&&e.height<2*n)return new rT({x:-n,y:-n,radius:n,isFilled:!0})}let r=rQ(t,oq(e.props,n,!0,!0)).map(e=>e.point);return e.props.isClosed?new rB.w({points:r,isFilled:"none"!==e.props.fill}):new rj.q({points:r})}component(e){let t=or(),n=oZ(),r=it[e.props.size],i=oJ(e.props.segments),o=e.props.isComplete||M.Z$(e.props.segments)?.type==="straight",s=r;n||e.props.isPen||"draw"!==e.props.dash||1!==i.length||(s+=(0,M.Vk)(e.id)()*(r/6));let a=oq(e.props,s,o,n);if(!n&&"draw"===e.props.dash)return(0,O.jsxs)(rn.g,{id:e.id,children:[e.props.isClosed&&e.props.fill&&i.length>1?(0,O.jsx)(oi,{theme:t,fill:e.props.isClosed?e.props.fill:"none",color:e.props.color,d:oV(rQ(i,a),e.props.isClosed)}):null,(0,O.jsx)("path",{d:function(e,t={}){let{start:n={},end:r={}}=t,{cap:i=!0}=n,{cap:o=!0}=r;(0,M.hu)(!n.taper&&!r.taper,"cap taper not supported here"),(0,M.hu)(!n.easing&&!r.easing,"cap easing not supported here"),(0,M.hu)(i&&o,"cap must be true");let s=rQ(e,t);r1(s,t);let a=function(e){if(e.length<=2)return[e];let t=[],n=[e[0]];for(let r=1;r<e.length-1;r++){let i=e[r-1],o=e[r],s=e[r+1],a=eh.B.Angle(i.point,o.point),l=eh.B.Angle(o.point,s.point),c=Math.abs((0,eu.Z7)(a,l))/Math.PI;if(c>.8){let e={...o,point:o.input};n.push(e),t.push(oH(n)),n=[e];continue}if(n.push(o),c<.25)continue;let u=(i.radius+o.radius+s.radius)/3;if(eh.B.Dist(i.point,o.point)/u+eh.B.Dist(o.point,s.point)/u<1.5){n.push(o),t.push(oH(n)),n=[o];continue}}return n.push(e[e.length-1]),t.push(oH(n)),t}(s),l="";for(let e of a)l+=function(e,t={}){if(0===e.length)return"";if(1===e.length){var n;return"M "+e[0].point.x+" "+e[0].point.y+" m -"+(n=e[0].radius)+", 0 a "+n+","+n+" 0 1,1 "+2*n+",0 a "+n+","+n+" 0 1,1 -"+2*n+",0"}let{left:r,right:i}=rq(e,t);i.reverse();let o=`M${(0,eu.Yk)(r[0])}T`;for(let e=1;e<r.length;e++)o+=(0,eu.Y8)(r[e-1],r[e]);{let t=e[e.length-1],n=t.radius,r=t.vector.clone().per().neg(),i=eh.B.Add(t.point,eh.B.Mul(r,n)),s=eh.B.Add(t.point,eh.B.Mul(r,-n));o+=`${(0,eu.Yk)(i)}A${(0,eu.$Z)(n)},${(0,eu.$Z)(n)} 0 0 1 ${(0,eu.Yk)(s)}T`}for(let e=1;e<i.length;e++)o+=(0,eu.Y8)(i[e-1],i[e]);{let t=e[0],n=t.radius,r=t.vector.clone().per(),i=eh.B.Add(t.point,eh.B.Mul(r,n)),s=eh.B.Add(t.point,eh.B.Mul(r,-n));o+=`${(0,eu.Yk)(i)}A${(0,eu.$Z)(n)},${(0,eu.$Z)(n)} 0 0 1 ${(0,eu.Yk)(s)}Z`}return o}(e,t);return l}(i,a),strokeLinecap:"round",fill:t[e.props.color].solid})]});let l=rQ(i,a),c=l.length<2,u=c?o1(i[0],0):oV(l,e.props.isClosed);return(0,O.jsxs)(rn.g,{id:e.id,children:[(0,O.jsx)(oi,{theme:t,color:e.props.color,fill:c||e.props.isClosed?e.props.fill:"none",d:u}),(0,O.jsx)("path",{d:u,strokeLinecap:"round",fill:c?t[e.props.color].solid:"none",stroke:t[e.props.color].solid,strokeWidth:r,strokeDasharray:c?"none":oQ(e,r),strokeDashoffset:"0"})]})}indicator(e){let t=oZ(),n=it[e.props.size],r=oJ(e.props.segments),i=n;t||e.props.isPen||"draw"!==e.props.dash||1!==r.length||(i+=(0,M.Vk)(e.id)()*(n/6));let o=e.props.isComplete||M.Z$(e.props.segments)?.type==="straight",s=rQ(r,oq(e.props,i,o,!0)),a=s.length>1?oV(s,e.props.isClosed):o1(r[0],i);return(0,O.jsx)("path",{d:a})}toSvg(e,t){let n;let r=(0,I.y6)({isDarkMode:this.editor.user.getIsDarkMode()});t.addExportDef(ou(e.props.fill,r));let{color:i}=e.props,o=it[e.props.size],s=oJ(e.props.segments),a=e.props.isComplete||M.Z$(e.props.segments)?.type==="straight",l=o;e.props.isPen||"draw"!==e.props.dash||1!==s.length||(l+=(0,M.Vk)(e.id)()*(o/6));let c=oq(e.props,l,a,!1),u=rQ(s,c),d=u.length>1?oV(u,e.props.isClosed):o1(s[0],l);if("draw"===e.props.dash||u.length<2){r1(u,c);let e=rJ(u,c),t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d",eE(e,!0)),t.setAttribute("fill",r[i].solid),t.setAttribute("stroke-linecap","round"),n=t}else{let t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d",d),t.setAttribute("stroke",r[i].solid),t.setAttribute("fill","none"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-width",o.toString()),t.setAttribute("stroke-dasharray",oQ(e,o)),t.setAttribute("stroke-dashoffset","0"),n=t}let h=os({fill:e.props.isClosed?e.props.fill:"none",d:d,color:e.props.color,theme:r});if(h){let e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.appendChild(h),e.appendChild(n),e}return n}getCanvasSvgDefs(){return[od()]}onResize=(e,t)=>{let{scaleX:n,scaleY:r}=t,i=[];for(let t of e.props.segments)i.push({...t,points:t.points.map(({x:e,y:t,z:i})=>({x:(0,eu.FH)(n*e),y:(0,eu.FH)(r*t),z:i}))});return{props:{segments:i}}};expandSelectionOutlinePx(e){let t="draw"===e.props.dash?1.6:1;return it[e.props.size]*t/2}}function o1(e,t){let n=(t+1)*.5;return`M ${e.x} ${e.y} m -${n}, 0 a ${n},${n} 0 1,0 ${2*n},0 a ${n},${n} 0 1,0 -${2*n},0`}function o2(e){return 1===e.props.segments.length&&e.props.segments[0].points.length<2}let o5=e=>Object.entries(e).filter(([e,t])=>t).map(([e])=>e).join(" ");class o3 extends rl{static type="embed";static props=I.DW;static migrations=I.BF;hideSelectionBoundsFg=e=>!this.canResize(e);canEdit=()=>!0;canUnmount=e=>!!iR(e.props.url)?.definition?.canUnmount;canResize=e=>!!iR(e.props.url)?.definition?.doesResize;canEditInReadOnly=()=>!0;getDefaultProps(){return{w:300,h:300,url:""}}isAspectRatioLocked=e=>{let t=iR(e.props.url);return t?.definition.isAspectRatioLocked??!1};onResize=(e,t)=>{let n=this.isAspectRatioLocked(e),r=iR(e.props.url),i=r?.definition.minWidth??200,o=r?.definition.minHeight??200;if(n){let t=e.props.w/e.props.h;t>1?i*=t:o/=t}return function(e,t,n={}){let{newPoint:r,handle:i,scaleX:o,scaleY:s}=t,{minWidth:a=1,maxWidth:l=1/0,minHeight:c=1,maxHeight:u=1/0}=n,d=e.props.w*o,h=e.props.h*s,p=new eh.B(0,0);if(d>0){if(d<a){switch(i){case"top_left":case"left":case"bottom_left":p.x=d-a;break;case"top":case"bottom":p.x=(d-a)/2;break;default:p.x=0}d=a}}else if(p.x=d,(d=-d)<a){switch(i){case"top_left":case"left":case"bottom_left":p.x=-d;break;default:p.x=-a}d=a}if(h>0){if(h<c){switch(i){case"top_left":case"top":case"top_right":p.y=h-c;break;case"right":case"left":p.y=(h-c)/2;break;default:p.y=0}h=c}}else if(p.y=h,(h=-h)<c){switch(i){case"top_left":case"top":case"top_right":p.y=-h;break;default:p.y=-c}h=c}let{x:f,y:g}=p.rot(e.rotation).add(r);return{x:f,y:g,props:{w:Math.min(l,d),h:Math.min(u,h)}}}(e,t,{minWidth:i,minHeight:o})};component(e){let{w:t,h:n,url:r}=e.props,i=rx(e.id),o=(0,$.useMemo)(()=>iL(r),[r]),s=(0,T.Hg)("is hovering",()=>{let{editingShapeId:e,hoveredShapeId:t}=this.editor.getCurrentPageState();if(e&&t!==e){let t=this.editor.getShape(e);if(t&&this.editor.isShapeOfType(t,"embed"))return!0}return!1},[]),a=this.editor.getShapePageTransform(e).rotation(),l=i||s;if(o?.definition.type==="github_gist"){let r=o.url.split("/").pop();if(!r)throw Error("No gist id!");return(0,O.jsx)(re,{className:"tl-embed-container",id:e.id,children:(0,O.jsx)(o8,{id:r,width:(0,eu.$Z)(t),height:(0,eu.$Z)(n),isInteractive:l,pageRotation:a})})}let c=o5({...I.gB,...o?.definition.overridePermissions??{}});return(0,O.jsx)(re,{className:"tl-embed-container",id:e.id,children:o?.definition?(0,O.jsx)("iframe",{className:"tl-embed",sandbox:c,src:o.embedUrl,width:(0,eu.$Z)(t),height:(0,eu.$Z)(n),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:l?"auto":"none",zIndex:l?"":"-1",boxShadow:oR(a),borderRadius:o?.definition.overrideOutlineRadius??8,background:o?.definition.backgroundColor}}):null})}indicator(e){let t=(0,$.useMemo)(()=>iR(e.props.url),[e.props.url]);return(0,O.jsx)("rect",{width:(0,eu.$Z)(e.props.w),height:(0,eu.$Z)(e.props.h),rx:t?.definition.overrideOutlineRadius??8,ry:t?.definition.overrideOutlineRadius??8})}}function o8({id:e,file:t,isInteractive:n,width:r,height:i,style:o,pageRotation:s}){return(0,O.jsx)("iframe",{className:"tl-embed",draggable:!1,width:(0,eu.$Z)(r),height:(0,eu.$Z)(i),frameBorder:"0",scrolling:"no",seamless:!0,referrerPolicy:"no-referrer-when-downgrade",style:{...o,pointerEvents:n?"all":"none",zIndex:n?"":"-1",boxShadow:oR(s)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=https://gist.github.com/${e}.js${t?`?file=${t}`:""}></script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}let o4=(0,$.forwardRef)(({id:e,name:t,isEditing:n},r)=>{let i=(0,G.j)(),o=(0,$.useCallback)(e=>{"Enter"!==e.key||e.nativeEvent.isComposing||(W(e),e.currentTarget.blur(),i.setEditingShape(null))},[i]),s=(0,$.useCallback)(t=>{let n=i.getShape(e);if(!n)return;let r=n.props.name,o=t.currentTarget.value.trim();r!==o&&i.updateShapes([{id:e,type:"frame",props:{name:o}}],{squashing:!0})},[e,i]),a=(0,$.useCallback)(t=>{let n=i.getShape(e);if(!n)return;let r=n.props.name,o=t.currentTarget.value;r!==o&&i.updateShapes([{id:e,type:"frame",props:{name:o}}],{squashing:!0})},[e,i]);return(0,O.jsxs)("div",{className:`tl-frame-label ${n?"tl-frame-label__editing":""}`,children:[(0,O.jsx)("input",{className:"tl-frame-name-input",ref:r,style:{display:n?void 0:"none"},value:t,autoFocus:!0,onKeyDown:o,onBlur:s,onChange:a}),o9(t,"Frame")+String.fromCharCode(8203)]})}),o6=function({id:e,name:t,width:n,height:r}){let i;let o=(0,G.j)(),s=(0,T.Hg)("shape rotation",()=>(0,eu.f5)(o.getShapePageTransform(e).rotation()),[o,e]),a=rx(e),l=(0,$.useRef)(null),c=(0,$.useCallback)(t=>{let n=Y(t);o.getEditingShapeId()!==e&&(o.dispatch({type:"pointer",name:"pointer_down",target:"shape",shape:o.getShape(e),...n}),t.preventDefault())},[o,e]);(0,$.useEffect)(()=>{let e=l.current;e&&a&&(e.focus(),e.select(),requestAnimationFrame(()=>{document.activeElement!==e&&(e.focus(),e.select())}))},[l,a]);let u=["top","left","bottom","right"][Math.floor((2/Math.PI*(s+Math.PI/4)+4)%4)];switch(u){case"top":i="";break;case"right":i=`translate(${(0,eu.$Z)(n)}px, 0px) rotate(90deg)`;break;case"bottom":i=`translate(${(0,eu.$Z)(n)}px, ${(0,eu.$Z)(r)}px) rotate(180deg)`;break;case"left":i=`translate(0px, ${(0,eu.$Z)(r)}px) rotate(270deg)`}return(0,O.jsx)("div",{className:"tl-frame-heading",style:{overflow:a?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${"top"===u||"bottom"===u?Math.ceil(n):Math.ceil(r)}px + var(--space-5))`,bottom:"100%",transform:`${i} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`},onPointerDown:c,children:(0,O.jsx)("div",{className:"tl-frame-heading-hit-area",children:(0,O.jsx)(o4,{ref:l,id:e,name:t,isEditing:a})})})};function o9(e,t){return e.match(/^\s*$/)?t:e}class o7 extends rl{static type="frame";static props=I.k7;static migrations=I.gR;canBind=()=>!0;canEdit=()=>!0;getDefaultProps(){return{w:320,h:180,name:""}}getGeometry(e){return new ro.z({width:e.props.w,height:e.props.h,isFilled:!1})}component(e){let t=this.editor.getShapeGeometry(e).bounds,n=or(),r=(0,T.Hg)("is creating this shape",()=>{let t=this.editor.getStateDescendant("select.resizing");if(!t||!t.getIsActive())return!1;let n=t?.info;return!!n&&n.isCreating&&this.editor.getOnlySelectedShape()?.id===e.id},[e.id]);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(rn.g,{children:(0,O.jsx)("rect",{className:D("tl-frame__body",{"tl-frame__creating":r}),width:t.width,height:t.height,fill:n.solid,stroke:n.text})}),r?null:(0,O.jsx)(o6,{id:e.id,name:e.props.name,width:t.width,height:t.height})]})}toSvg(e){let t;let n=(0,I.y6)({isDarkMode:this.editor.user.getIsDarkMode()}),r=document.createElementNS("http://www.w3.org/2000/svg","g"),i=document.createElementNS("http://www.w3.org/2000/svg","rect");switch(i.setAttribute("width",e.props.w.toString()),i.setAttribute("height",e.props.h.toString()),i.setAttribute("fill",n.solid),i.setAttribute("stroke",n.black.solid),i.setAttribute("stroke-width","1"),i.setAttribute("rx","1"),i.setAttribute("ry","1"),r.appendChild(i),["top","left","bottom","right"][Math.floor((2/Math.PI*((0,eu.f5)(this.editor.getShapePageTransform(e.id).rotation())+Math.PI/4)+4)%4)]){case"top":default:t="";break;case"right":t=`translate(${(0,eu.$Z)(e.props.w)}px, 0px) rotate(90deg)`;break;case"bottom":t=`translate(${(0,eu.$Z)(e.props.w)}px, ${(0,eu.$Z)(e.props.h)}px) rotate(180deg)`;break;case"left":t=`translate(0px, ${(0,eu.$Z)(e.props.h)}px) rotate(270deg)`}let o={fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:e.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle"},s=this.editor.textMeasure.measureTextSpans(o9(e.props.name,"Frame")+String.fromCharCode(8203),o),a=s[0],l=(0,M.Z$)(s),c=l.box.w+l.box.x-a.box.x,u=ol(this.editor,s,{offsetY:-o.height-2,...o});u.style.setProperty("transform",t);let d=document.createElementNS("http://www.w3.org/2000/svg","rect");return d.setAttribute("x","-8px"),d.setAttribute("y",-o.height-4+"px"),d.setAttribute("width",c+16+"px"),d.setAttribute("height",`${o.height}px`),d.setAttribute("rx","4px"),d.setAttribute("ry","4px"),d.setAttribute("fill",n.background),r.appendChild(d),r.appendChild(u),r}indicator(e){let t=this.editor.getShapeGeometry(e).bounds;return(0,O.jsx)("rect",{width:(0,eu.$Z)(t.width),height:(0,eu.$Z)(t.height),className:"tl-frame-indicator"})}canReceiveNewChildrenOfType=(e,t)=>!e.isLocked;providesBackgroundForChildren(){return!0}canDropShapes=(e,t)=>!e.isLocked;onDragShapesOver=(e,t)=>t.every(t=>t.parentId===e.id)?{shouldHint:!1}:(this.editor.reparentShapes(t.map(e=>e.id),e.id),{shouldHint:!0});onDragShapesOut=(e,t)=>{let n=this.editor.getShape(e.parentId);n&&this.editor.isShapeOfType(n,"group")?this.editor.reparentShapes(t,n.id):this.editor.reparentShapes(t,this.editor.getCurrentPageId())};onResizeEnd=e=>{let t=this.editor.getShapePageBounds(e),n=this.editor.getSortedChildIdsForParent(e.id),r=[];for(let e of n){let n=this.editor.getShapePageBounds(e);t.includes(n)||r.push(e)}r.length>0&&this.editor.reparentShapes(r,this.editor.getCurrentPageId())};onResize=(e,t)=>ra(e,t)}let se=$.memo(function({id:e,type:t,text:n,size:r,labelColor:i,font:o,align:s,verticalAlign:a,wrap:l,bounds:c}){let{rInput:u,isEmpty:d,isEditing:h,handleFocus:p,handleChange:f,handleKeyDown:g,handleBlur:m,handleInputPointerDown:y,handleDoubleClick:b}=oP(e,t,n),w=iz.normalizeTextForDom(n),x=w.length>0,v="start-legacy"===s||"middle-legacy"===s||"end-legacy"===s,S=or();return h||x?(0,O.jsx)("div",{className:"tl-text-label","data-font":o,"data-align":s,"data-hastext":!d,"data-isediting":h,"data-textwrap":!!l,style:{justifyContent:"middle"===s||v?"center":s,alignItems:"middle"===a?"center":a,...c?{top:c.minY,left:c.minX,width:c.width,height:c.height,position:"absolute"}:{}},children:(0,O.jsxs)("div",{className:"tl-text-label__inner",style:{fontSize:ii[r],lineHeight:ii[r]*ie.lineHeight+"px",minHeight:ie.lineHeight+32,minWidth:0,color:S[i].solid},children:[(0,O.jsx)("div",{className:"tl-text tl-text-content",dir:"ltr",children:w}),h&&(0,O.jsx)("textarea",{ref:u,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:n,onFocus:p,onChange:f,onKeyDown:g,onBlur:m,onContextMenu:W,onPointerDown:y,onDoubleClick:b})]})}):null});function st({bounds:e,editor:t,font:n,shape:r}){let i={fontSize:ii[r.props.size],fontFamily:n,textAlign:r.props.align,verticalTextAlign:r.props.verticalAlign,width:Math.ceil(e.width),height:Math.ceil(e.height),padding:16,lineHeight:ie.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0},o=t.textMeasure.measureTextSpans(r.props.text,i),s=function(e,t,n,r){if(("start-legacy"===e||"end-legacy"===e)&&0!==n.length){let t=rS.xu.From(n[0].box);for(let{box:e}of n)t.union(e);if("start-legacy"===e)return(r-32-t.width)/2;if("end-legacy"===e)return-(r-32-t.width)/2}}(r.props.align,0,o,e.width);return s&&(i.offsetX=s),ol(t,o,i)}function sn(e){return`${(0,eu.$Z)(e.x)},${(0,eu.$Z)(e.y)} `}function sr(e=""){let t=0,n=0,r=0,i=0;function o(){let e=t^t<<11;return t=n,n=r,r=i,(i^=(i>>>19^e^e>>>8)>>>0)/4294967296*2}for(let n=0;n<e.length+64;n++)t^=0|e.charCodeAt(n),o();return o}function si(e){let t,n,r,i="M",o=e.length;for(let s=0;s<o;s+=3)t=e[s],n=e[s+1],r=e[s+2],i+=`${sn(t)}L${sn(n)}Q${sn(r)}`;return i+`${sn(e[0])}`}function so(e,t,n,r,i){let o;let s=[],a=sr(e),l=t[0],c=t.length;for(let e=0,u=c*i;e<u;e++){o=eh.B.AddXY(t[(e+1)%c],a()*n,a()*n);let i=eh.B.Sub(o,l),u=eh.B.Len(i),d=eh.B.Div(i,u).mul(Math.min(u/4,r));s.push(eh.B.Add(l,d),eh.B.Add(o,d.neg()),o),l=o}return s}function ss(e,t,n){let r,i,o=`M ${sn(t[0])}L`,s=`M ${sn(t[0])}L`,a=n/3,l=2*n,c=sr(e),u=t[0],d=t[0],h=t.length;for(let e=0,n=h-1;e<n;e++){r=t[e+1],i=eh.B.AddXY(t[e+1],c()*a,c()*a);let h=eh.B.Sub(r,u),p=eh.B.Len(h),f=eh.B.Div(h,p).mul(Math.min(p/4,l)),g=eh.B.Add(u,f),m=eh.B.Add(r,f.neg()),y=eh.B.Sub(i,d),b=eh.B.Len(y),w=eh.B.Div(y,b).mul(Math.min(b/4,l)),x=eh.B.Add(d,w),v=eh.B.Add(i,w.neg());e===n-1?(o+=`${sn(g)}L ${sn(r)}`,s+=`${sn(x)}L ${sn(i)}`):(o+=`${sn(g)}L ${sn(m)}Q ${sn(r)}`,s+=`${sn(x)}L ${sn(v)}Q ${sn(i)}`,u=r,d=i)}return[o,o+s]}function sa(e,t){let n=Math.min(e,t)/2;return 2*n*Math.PI+2*(Math.max(e,t)-2*n)}let sl=(e,t,n,r,i)=>{switch(e){case"s":return t;case"m":return n;case"l":return r;case"xl":return i}};function sc(e,t,n,r){let i=(0,M.Vk)(n),o=sa(e,t),s=Math.max(Math.ceil(o/sl(r,50,70,100,130)),6,Math.ceil(o/Math.min(e,t))),a=o/s*.2,l=Math.max(e-2*a,1),c=Math.max(t-2*a,1),u=(e-l)/2,d=(t-c)/2,h=sa(l,c)/s,p=(function(e,t,n){let r=Math.min(e,t)/2,i=Math.max(e,t)-2*r,o=(2*r*Math.PI+2*i)/n,s=e>t?[{type:"straight",start:new eh.B(r,0),delta:new eh.B(1,0)},{type:"arc",center:new eh.B(e-r,r),startAngle:-eu.PI/2},{type:"straight",start:new eh.B(e-r,t),delta:new eh.B(-1,0)},{type:"arc",center:new eh.B(r,r),startAngle:eu.PI/2}]:[{type:"straight",start:new eh.B(e,r),delta:new eh.B(0,1)},{type:"arc",center:new eh.B(r,t-r),startAngle:0},{type:"straight",start:new eh.B(0,t-r),delta:new eh.B(0,-1)},{type:"arc",center:new eh.B(r,r),startAngle:eu.PI}],a=0,l=[];for(let e=0;e<n;e++){let e=s[0];"straight"===e.type?l.push(eh.B.Add(e.start,eh.B.Mul(e.delta,a))):l.push((0,eu.XD)(e.center,r,e.startAngle+a/r)),a+=o;let t="straight"===e.type?i:eu.PI*r;for(;a>t;)a-=t,s.push(s.shift()),t="straight"===s[0].type?i:eu.PI*r}return l})(l,c,s).map(e=>e.addXY(u,d)),f=e<20?0:.3*a,g=t<20?0:.3*a,m=p.slice(0);for(let e=0;e<Math.floor(s/2);e++)m[e]=eh.B.AddXY(m[e],i()*f,i()*g),m[s-e-1]=eh.B.AddXY(m[s-e-1],i()*f,i()*g);let y=[];for(let n=0;n<m.length;n++){let r=n===m.length-1?0:n+1,i=m[n],o=m[r],s=p[n],a=p[r],l=eh.B.Average([s,a]),c=eh.B.Angle(s,a)-Math.PI/2,f=eh.B.Dist(s,a),g=eh.B.Dist(i,o)/f*(Math.max(u,d)+(h-f)),b=eh.B.Add(l,eh.B.FromAngle(c,g));b.x<0?b.x=0:b.x>e&&(b.x=e),b.y<0?b.y=0:b.y>t&&(b.y=t);let w=su(i,o,b),x=eh.B.Dist(w||eh.B.Average([i,o]),i);y.push({leftPoint:i,rightPoint:o,arcPoint:b,center:w,radius:x})}return y}function su(e,t,n){let r=e.x*(t.y-n.y)-e.y*(t.x-n.x)+t.x*n.y-n.x*t.y,i=(e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y)+(n.x*n.x+n.y*n.y)*(t.y-e.y),o=(e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x)+(n.x*n.x+n.y*n.y)*(e.x-t.x),s=-i/(2*r),a=-o/(2*r);return Number.isFinite(s)&&Number.isFinite(a)?new eh.B(s,a):null}function sd(e,t,n,r){let i=sc(e,t,n,r),o=`M${(0,eu.$Z)(i[0].leftPoint.x)},${(0,eu.$Z)(i[0].leftPoint.y)}`;for(let{leftPoint:e,rightPoint:t,radius:n,center:r}of i){if(null===r){o+=` L${(0,eu.$Z)(t.x)},${(0,eu.$Z)(t.y)}`;continue}let i=sp(e,t,r)?"0":"1";o+=` A${(0,eu.$Z)(n)},${(0,eu.$Z)(n)} 0 ${i},1 ${(0,eu.$Z)(t.x)},${(0,eu.$Z)(t.y)}`}return o+" Z"}function sh(e,t,n,r){let i=(0,M.Vk)(n),o="s"===r?.5:"m"===r?.7:"l"===r?.9:1.6,s=e=>e+i()*o*2,a=sc(e,t,n,r),l=a.reduce((e,t)=>e+eh.B.Dist(t.leftPoint,t.rightPoint),0)/a.length>15*o?e=>new eh.B(s(e.x),s(e.y)):e=>e,c=`M${(0,eu.$Z)(a[0].leftPoint.x)},${(0,eu.$Z)(a[0].leftPoint.y)}`,u=l(a[0].leftPoint),d=`M${(0,eu.$Z)(u.x)},${(0,eu.$Z)(u.y)}`;for(let{leftPoint:e,center:t,rightPoint:n,radius:r,arcPoint:i}of a){if(null===t){c+=` L${(0,eu.$Z)(n.x)},${(0,eu.$Z)(n.y)}`;let e=l(n);d+=` L${(0,eu.$Z)(e.x)},${(0,eu.$Z)(e.y)}`,u=e;continue}let o=sp(e,n,t)?"0":"1";c+=` A${(0,eu.$Z)(r)},${(0,eu.$Z)(r)} 0 ${o},1 ${(0,eu.$Z)(n.x)},${(0,eu.$Z)(n.y)}`;let s=l(n),a=su(u,s,l(i));if(!a){d+=` L${(0,eu.$Z)(s.x)},${(0,eu.$Z)(s.y)}`,u=s;continue}let h=Math.abs(eh.B.Dist(a,u));d+=` A${(0,eu.$Z)(h)},${(0,eu.$Z)(h)} 0 ${o},1 ${(0,eu.$Z)(s.x)},${(0,eu.$Z)(s.y)}`,u=s}return c+d+" Z"}function sp(e,t,n){return(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)>0}let sf=$.memo(function({dash:e,fill:t,color:n,strokeWidth:r,w:i,h:o,id:s,size:a}){let l=or(),c=sd(i,o,s,a),u=sc(i,o,s,a);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(oi,{theme:l,d:c,fill:t,color:n}),(0,O.jsx)("g",{strokeWidth:r,stroke:l[n].solid,fill:"none",pointerEvents:"all",children:u.map(({leftPoint:t,rightPoint:n,center:i,radius:o},s)=>{let{strokeDasharray:a,strokeDashoffset:l}=om(i?o*(0,eu.f5)((0,eu.f5)(eh.B.Angle(i,n))-(0,eu.f5)(eh.B.Angle(i,t))):eh.B.Dist(t,n),r,{style:e,start:"outset",end:"outset"});return(0,O.jsx)("path",{d:i?`M${t.x},${t.y}A${o},${o},0,0,1,${n.x},${n.y}`:`M${t.x},${t.y}L${n.x},${n.y}`,strokeDasharray:a,strokeDashoffset:l},s)})})]})}),sg=$.memo(function({w:e,h:t,strokeWidth:n,dash:r,color:i,fill:o}){let s=or(),a=e/2,l=t/2,c=Math.max(0,a),u=Math.max(0,l),d=(0,eu.Rp)(c,u),{strokeDasharray:h,strokeDashoffset:p}=om(d<64?2*d:d,n,{style:r,snap:4,closed:!0}),f=`M${a-c},${l}a${c},${u},0,1,1,${2*c},0a${c},${u},0,1,1,-${2*c},0`;return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(oi,{theme:s,d:f,color:i,fill:o}),(0,O.jsx)("path",{d:f,strokeWidth:n,width:(0,eu.$Z)(e),height:(0,eu.$Z)(t),fill:"none",stroke:s[i].solid,strokeDasharray:h,strokeDashoffset:p,pointerEvents:"all"})]})});function sm(e,t){if(t>e){let n=e/2;return`
    M0,${n}
    a${n},${n},0,1,1,${2*n},0
    L${e},${t-n}
    a${n},${n},0,1,1,-${2*n},0
    Z`}let n=t/2;return`
    M${n},0
    L${e-n},0
    a${n},${n},0,1,1,0,${2*n}
    L${n},${t}
    a${n},${n},0,1,1,0,${-(2*n)}
    Z`}function sy(e,t){if(e>t){let n=t/2;return(0,eu.Rp)(n,n)+(e-2*n)*2}let n=e/2;return(0,eu.Rp)(n,n)+(t-2*n)*2}let sb=$.memo(function({w:e,h:t,strokeWidth:n,dash:r,color:i,fill:o}){let s=or(),a=sm(e,t),l=sy(e,t),{strokeDasharray:c,strokeDashoffset:u}=om(l<64?2*l:l,n,{style:r,snap:4,start:"outset",end:"outset",closed:!0});return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(oi,{theme:s,d:a,color:i,fill:o}),(0,O.jsx)("path",{d:a,strokeWidth:n,width:(0,eu.$Z)(e),height:(0,eu.$Z)(t),fill:"none",stroke:s[i].solid,strokeDasharray:c,strokeDashoffset:u,pointerEvents:"all"})]})}),sw=$.memo(function({dash:e,fill:t,color:n,strokeWidth:r,outline:i,lines:o}){let s=or(),a="M"+i[0]+"L"+i.slice(1)+"Z";return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(oi,{theme:s,d:a,fill:t,color:n}),(0,O.jsxs)("g",{strokeWidth:r,stroke:s[n].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(i.length)).map((t,n)=>{let o=i[n],s=i[(n+1)%i.length],{strokeDasharray:a,strokeDashoffset:l}=om(eh.B.Dist(o,s),r,{style:e,start:"outset",end:"outset"});return(0,O.jsx)("line",{x1:o.x,y1:o.y,x2:s.x,y2:s.y,strokeDasharray:a,strokeDashoffset:l},n)}),o&&o.map(([t,i],o)=>{let{strokeDasharray:a,strokeDashoffset:l}=om(eh.B.Dist(t,i),r,{style:e,start:"skip",end:"outset",snap:"dotted"===e?4:void 0});return(0,O.jsx)("path",{d:`M${t.x},${t.y}L${i.x},${i.y}`,stroke:s[n].solid,strokeWidth:r,fill:"none",strokeDasharray:a,strokeDashoffset:l},`line_fg_${o}`)})]})]})}),sx=$.memo(function({fill:e,color:t,strokeWidth:n,w:r,h:i,id:o,size:s}){let a=or(),l=sh(r,i,o,s);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(oi,{theme:a,d:l,fill:e,color:t}),(0,O.jsx)("path",{d:l,stroke:a[t].solid,strokeWidth:n,fill:"none"})]})});function sv(e){return{size:1+e,thinning:.25,end:{taper:e},start:{taper:e},streamline:0,smoothing:1,simulatePressure:!1}}function sS(e,t,n,r){let i=(0,M.Vk)(e),o=t/2,s=n/2,a=(0,eu.Rp)(o,s),l=[],c=eu.yo*i(),u=eu.yo+eu.pj/2+Math.abs(i())*eu.pj,d=Math.max(16,a/10);for(let e=0;e<d;e++){let r=e/(d-1),a=c+r*u,h=Math.cos(a),p=Math.sin(a);l.push(new eh.B(o*h+.5*t+.05*i(),s*p+n/2+.05*i(),Math.min(1,.5+Math.abs(.5-(i()>0?rk.L.easeInOutSine(r):rk.L.easeInExpo(r)))/2)))}return rQ(l,sv(r))}function sk(e,t,n,r){let i=sv(r);return eE(rJ(r1(sS(e,t,n,r),i),i))}$.memo(function({id:e,w:t,h:n,strokeWidth:r,fill:i,color:o}){let s=or(),a=oV(sS(e,t,n,r)),l=sk(e,t,n,r);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(oi,{theme:s,d:a,color:o,fill:i}),(0,O.jsx)("path",{d:l,fill:s[o].solid,strokeWidth:0,pointerEvents:"all"})]})});let s_=$.memo(function({id:e,outline:t,lines:n,fill:r,color:i,strokeWidth:o}){let s=or(),a=si(so(e,t,o/3,2*o,2));if(n)for(let[e,t]of n)a+=`M${e.x},${e.y}L${t.x},${t.y}`;let l=si(so(e,t,0,2*o,1));return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(oi,{d:l,fill:r,color:i,theme:s}),(0,O.jsx)("path",{d:a,stroke:s[i].solid,strokeWidth:o,fill:"none"})]})}),sE=$.memo(function({fill:e,color:t,strokeWidth:n,w:r,h:i,id:o,size:s}){let a=or(),l=sd(r,i,o,s);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(oi,{theme:a,d:l,fill:e,color:t}),(0,O.jsx)("path",{d:l,stroke:a[t].solid,strokeWidth:n,fill:"none"})]})}),sC=$.memo(function({w:e,h:t,strokeWidth:n,fill:r,color:i}){let o=or(),s=e/2,a=t/2,l=Math.max(0,s),c=Math.max(0,a),u=`M${s-l},${a}a${l},${c},0,1,1,${2*l},0a${l},${c},0,1,1,-${2*l},0`;return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(oi,{d:u,color:i,fill:r,theme:o}),(0,O.jsx)("path",{d:u,stroke:o[i].solid,strokeWidth:n,fill:"none"})]})}),sP=$.memo(function({w:e,h:t,strokeWidth:n,fill:r,color:i}){let o=or(),s=sT(e,t);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(oi,{d:s,color:i,fill:r,theme:o}),(0,O.jsx)("path",{d:s,stroke:o[i].solid,strokeWidth:n,fill:"none"})]})});function sT(e,t){let n;if(t>e){let r=e/2;n=`
    M0,${r}
    a${r},${r},0,1,1,${2*r},0
    L${e},${t-r}
    a${r},${r},0,1,1,-${2*r},0
    Z`}else{let r=t/2;n=`
    M${r},0
    L${e-r},0
    a${r},${r},0,1,1,0,${2*r}
    L${r},${t}
    a${r},${r},0,1,1,0,${-(2*r)}
    Z`}return n}let sj=$.memo(function({outline:e,lines:t,fill:n,color:r,strokeWidth:i}){let o=or(),s="M"+e[0]+"L"+e.slice(1)+"Z";if(t)for(let[e,n]of t)s+=`M${e.x},${e.y}L${n.x},${n.y}`;return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(oi,{d:s,fill:n,color:r,theme:o}),(0,O.jsx)("path",{d:s,stroke:o[r].solid,strokeWidth:i,fill:"none"})]})});class sI extends rl{static type="geo";static props=I.eG;static migrations=I.P3;canEdit=()=>!0;getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:""}}getGeometry(e){let t;let n=Math.max(1,e.props.w),r=Math.max(1,e.props.h+e.props.growY),i=n/2,o=r/2,s=it[e.props.size],a="none"!==e.props.fill;switch(e.props.geo){case"cloud":t=new rB.w({points:function(e,t,n,r){let i=[];for(let{center:o,radius:s,leftPoint:a,rightPoint:l}of sc(e,t,n,r))i.push(...function(e,t,n,r,i){if(null===n)return[eh.B.From(e),eh.B.From(t)];let o=[],s=eh.B.Angle(n,e),a=eh.B.Angle(n,t),l=(0,eu.VK)(s,a);for(let e=0;e<10;e++){let t=s+e/9*l,i=(0,eu.XD)(n,r,t);o.push(i)}return o}(a,l,o,s,10));return i}(n,r,e.id,e.props.size),isFilled:a});break;case"triangle":t=new rB.w({points:[new eh.B(i,0),new eh.B(n,r),new eh.B(0,r)],isFilled:a});break;case"diamond":t=new rB.w({points:[new eh.B(i,0),new eh.B(n,o),new eh.B(i,r),new eh.B(0,o)],isFilled:a});break;case"pentagon":t=new rB.w({points:(0,eu.Oe)(n,r,5),isFilled:a});break;case"hexagon":t=new rB.w({points:(0,eu.Oe)(n,r,6),isFilled:a});break;case"octagon":t=new rB.w({points:(0,eu.Oe)(n,r,8),isFilled:a});break;case"ellipse":t=new rO({width:n,height:r,isFilled:a});break;case"oval":t=new rD({width:n,height:r,isFilled:a});break;case"star":{let e=eu.yo/5/2,i=2*Math.floor(5/4),o=Math.cos(-eu.pj+i*e)*n/2,s=Math.cos(-eu.pj+(10-i)*e)*n/2,l=Math.sin(-eu.pj+0*e)*r/2,c=Math.sin(-eu.pj+2*Math.floor(2.5)*e)*r/2,u=n-Math.abs(o-s),d=r-Math.abs(c-l),h=n/2+s-(n/2-o),p=r/2+l-(r/2-c),f=(n-h)/2,g=(r-p)/2,m=(n+u)/2,y=(r+d)/2,b=1*m/2,w=1*y/2;t=new rB.w({points:Array.from(Array(10)).map((t,n)=>{let r=-eu.pj+n*e;return new eh.B(f+(n%2?b:m)*Math.cos(r),g+(n%2?w:y)*Math.sin(r))}),isFilled:a});break}case"rhombus":{let e=Math.min(.38*n,.38*r);t=new rB.w({points:[new eh.B(e,0),new eh.B(n,0),new eh.B(n-e,r),new eh.B(0,r)],isFilled:a});break}case"rhombus-2":{let e=Math.min(.38*n,.38*r);t=new rB.w({points:[new eh.B(0,0),new eh.B(n-e,0),new eh.B(n,r),new eh.B(e,r)],isFilled:a});break}case"trapezoid":{let e=Math.min(.38*n,.38*r);t=new rB.w({points:[new eh.B(e,0),new eh.B(n-e,0),new eh.B(n,r),new eh.B(0,r)],isFilled:a});break}case"arrow-right":{let e=.38*Math.min(n,r),i=.16*r;t=new rB.w({points:[new eh.B(0,i),new eh.B(n-e,i),new eh.B(n-e,0),new eh.B(n,r/2),new eh.B(n-e,r),new eh.B(n-e,r-i),new eh.B(0,r-i)],isFilled:a});break}case"arrow-left":{let e=.38*Math.min(n,r),i=.16*r;t=new rB.w({points:[new eh.B(e,0),new eh.B(e,i),new eh.B(n,i),new eh.B(n,r-i),new eh.B(e,r-i),new eh.B(e,r),new eh.B(0,r/2)],isFilled:a});break}case"arrow-up":{let e=.16*n,i=.38*Math.min(n,r);t=new rB.w({points:[new eh.B(n/2,0),new eh.B(n,i),new eh.B(n-e,i),new eh.B(n-e,r),new eh.B(e,r),new eh.B(e,i),new eh.B(0,i)],isFilled:a});break}case"arrow-down":{let e=.16*n,i=.38*Math.min(n,r);t=new rB.w({points:[new eh.B(e,0),new eh.B(n-e,0),new eh.B(n-e,r-i),new eh.B(n,r-i),new eh.B(n/2,r),new eh.B(0,r-i),new eh.B(e,r-i)],isFilled:a});break}case"check-box":case"x-box":case"rectangle":t=new ro.z({width:n,height:r,isFilled:a,isSnappable:!0})}let l=sM(this.editor,e),c=Math.min(n,Math.max(l.w,Math.min(32,Math.max(1,n-8)))),u=Math.min(r,Math.max(l.h,Math.min(32,Math.max(1,n-8)))),d=sA(e.props,s),h=d?d.map(e=>new rj.q({points:e})):[];return new tP.m({children:[t,new ro.z({x:"start"===e.props.align?0:"end"===e.props.align?n-c:(n-c)/2,y:"start"===e.props.verticalAlign?0:"end"===e.props.verticalAlign?r-u:(r-u)/2,width:c,height:u,isFilled:!0,isSnappable:!1,isLabel:!0}),...h],isSnappable:!1})}onEditEnd=e=>{let{id:t,type:n,props:{text:r}}=e;r.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:r.trimEnd()}}])};component(e){let{id:t,type:n,props:r}=e,i=it[r.size],{w:o,color:s,labelColor:a,fill:l,dash:c,growY:u,font:d,align:h,verticalAlign:p,size:f,text:g}=r;return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(rn.g,{id:t,children:(()=>{let n=r.h+u;switch(r.geo){case"cloud":if("solid"===c)return(0,O.jsx)(sE,{color:s,fill:l,strokeWidth:i,w:o,h:n,id:t,size:f});if("dashed"===c||"dotted"===c)return(0,O.jsx)(sf,{color:s,fill:l,strokeWidth:i,w:o,h:n,id:t,size:f,dash:c});if("draw"===c)return(0,O.jsx)(sx,{color:s,fill:l,strokeWidth:i,w:o,h:n,id:t,size:f});break;case"ellipse":if("solid"===c)return(0,O.jsx)(sC,{strokeWidth:i,w:o,h:n,color:s,fill:l});if("dashed"===c||"dotted"===c)return(0,O.jsx)(sg,{id:t,strokeWidth:i,w:o,h:n,dash:c,color:s,fill:l});if("draw"===c)return(0,O.jsx)(sC,{strokeWidth:i,w:o,h:n,color:s,fill:l});break;case"oval":if("solid"===c)return(0,O.jsx)(sP,{strokeWidth:i,w:o,h:n,color:s,fill:l});if("dashed"===c||"dotted"===c)return(0,O.jsx)(sb,{id:t,strokeWidth:i,w:o,h:n,dash:c,color:s,fill:l});if("draw"===c)return(0,O.jsx)(sP,{strokeWidth:i,w:o,h:n,color:s,fill:l});break;default:{let n=this.editor.getShapeGeometry(e),r=n instanceof tP.m?n.children[0].vertices:n.vertices,o=sA(e.props,i);if("solid"===c)return(0,O.jsx)(sj,{fill:l,color:s,strokeWidth:i,outline:r,lines:o});if("dashed"===c||"dotted"===c)return(0,O.jsx)(sw,{dash:c,fill:l,color:s,strokeWidth:i,outline:r,lines:o});if("draw"===c)return(0,O.jsx)(s_,{id:t,fill:l,color:s,strokeWidth:i,outline:r,lines:o})}}})()}),(0,O.jsxs)(re,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h+r.growY},children:[(0,O.jsx)(se,{id:t,type:n,font:d,fill:l,size:f,align:h,verticalAlign:p,text:g,labelColor:a,wrap:!0,bounds:"cloud"===r.geo?this.getGeometry(e).bounds:void 0}),e.props.url&&(0,O.jsx)(oD,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})]})}indicator(e){let{id:t,props:n}=e,{w:r,size:i}=n,o=n.h+n.growY,s=it[i];switch(n.geo){case"ellipse":if("draw"===n.dash)return(0,O.jsx)("path",{d:oV(sS(t,r,o,s))});return(0,O.jsx)("ellipse",{cx:r/2,cy:o/2,rx:r/2,ry:o/2});case"oval":return(0,O.jsx)("path",{d:sT(r,o)});case"cloud":return(0,O.jsx)("path",{d:sd(r,o,t,i)});default:{let r;let i=this.editor.getShapeGeometry(e),o=i instanceof tP.m?i.children[0].vertices:i.vertices;r="draw"===n.dash?si(so(t,o,0,2*s,1)):"M"+o[0]+"L"+o.slice(1)+"Z";let a=sA(e.props,s);if(a)for(let[e,t]of a)r+=`M${e.x},${e.y}L${t.x},${t.y}`;return(0,O.jsx)("path",{d:r})}}}toSvg(e,t){let n;let{id:r,props:i}=e,o=it[i.size],s=(0,I.y6)({isDarkMode:this.editor.user.getIsDarkMode()});switch(t.addExportDef(ou(e.props.fill,s)),i.geo){case"ellipse":switch(i.dash){case"draw":n=function({id:e,w:t,h:n,strokeWidth:r,fill:i,color:o,theme:s}){let a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("d",sk(e,t,n,r)),a.setAttribute("fill",s[o].solid),oa(a,os({d:oV(sS(e,t,n,r)),fill:i,color:o,theme:s}))}({id:r,w:i.w,h:i.h,color:i.color,fill:i.fill,strokeWidth:o,theme:s});break;case"solid":n=function({w:e,h:t,strokeWidth:n,fill:r,color:i,theme:o}){let s=e/2,a=t/2,l=Math.max(0,s),c=Math.max(0,a),u=`M${s-l},${a}a${l},${c},0,1,1,${2*l},0a${l},${c},0,1,1,-${2*l},0`,d=document.createElementNS("http://www.w3.org/2000/svg","path");return d.setAttribute("d",u),d.setAttribute("stroke-width",n.toString()),d.setAttribute("width",e.toString()),d.setAttribute("height",t.toString()),d.setAttribute("fill","none"),d.setAttribute("stroke",o[i].solid),oa(d,os({d:u,fill:r,color:i,theme:o}))}({strokeWidth:o,w:i.w,h:i.h,color:i.color,fill:i.fill,theme:s});break;default:n=function({w:e,h:t,strokeWidth:n,dash:r,color:i,theme:o,fill:s}){let a=e/2,l=t/2,c=Math.max(0,a-n/2),u=Math.max(0,l-n/2),d=(0,eu.Rp)(c,u),{strokeDasharray:h,strokeDashoffset:p}=om(d<64?2*d:d,n,{style:r,snap:4,closed:!0}),f=`M${a-c},${l}a${c},${u},0,1,1,${2*c},0a${c},${u},0,1,1,-${2*c},0`,g=document.createElementNS("http://www.w3.org/2000/svg","path");return g.setAttribute("d",f),g.setAttribute("stroke-width",n.toString()),g.setAttribute("width",e.toString()),g.setAttribute("height",t.toString()),g.setAttribute("fill","none"),g.setAttribute("stroke",o[i].solid),g.setAttribute("stroke-dasharray",h),g.setAttribute("stroke-dashoffset",p),oa(g,os({d:f,fill:s,color:i,theme:o}))}({id:r,strokeWidth:o,w:i.w,h:i.h,dash:i.dash,color:i.color,fill:i.fill,theme:s})}break;case"oval":switch(i.dash){case"draw":default:n=function({w:e,h:t,strokeWidth:n,dash:r,color:i,theme:o,fill:s}){let a=sm(e,t),l=sy(e,t),{strokeDasharray:c,strokeDashoffset:u}=om(l<64?2*l:l,n,{style:r,snap:4,closed:!0}),d=document.createElementNS("http://www.w3.org/2000/svg","path");return d.setAttribute("d",a),d.setAttribute("stroke-width",n.toString()),d.setAttribute("width",e.toString()),d.setAttribute("height",t.toString()),d.setAttribute("fill","none"),d.setAttribute("stroke",o[i].solid),d.setAttribute("stroke-dasharray",c),d.setAttribute("stroke-dashoffset",u),oa(d,os({d:a,fill:s,color:i,theme:o}))}({id:r,strokeWidth:o,w:i.w,h:i.h,dash:i.dash,color:i.color,fill:i.fill,theme:s});break;case"solid":n=function({w:e,h:t,strokeWidth:n,fill:r,color:i,theme:o}){let s=sT(e,t),a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("d",s),a.setAttribute("stroke-width",n.toString()),a.setAttribute("width",e.toString()),a.setAttribute("height",t.toString()),a.setAttribute("fill","none"),a.setAttribute("stroke",o[i].solid),oa(a,os({d:s,fill:r,color:i,theme:o}))}({strokeWidth:o,w:i.w,h:i.h,color:i.color,fill:i.fill,theme:s})}break;case"cloud":switch(i.dash){case"draw":n=function({fill:e,color:t,strokeWidth:n,theme:r,w:i,h:o,id:s,size:a}){let l=sh(i,o,s,a),c=document.createElementNS("http://www.w3.org/2000/svg","path");return c.setAttribute("d",l),c.setAttribute("stroke-width",n.toString()),c.setAttribute("stroke",r[t].solid),c.setAttribute("fill","none"),oa(c,os({d:l,fill:e,color:t,theme:r}))}({id:r,strokeWidth:o,w:i.w,h:i.h,color:i.color,fill:i.fill,size:i.size,theme:s});break;case"solid":n=function({fill:e,color:t,strokeWidth:n,theme:r,w:i,h:o,id:s,size:a}){let l=sd(i,o,s,a),c=document.createElementNS("http://www.w3.org/2000/svg","path");return c.setAttribute("d",l),c.setAttribute("stroke-width",n.toString()),c.setAttribute("stroke",r[t].solid),c.setAttribute("fill","none"),oa(c,os({d:l,fill:e,color:t,theme:r}))}({strokeWidth:o,w:i.w,h:i.h,color:i.color,fill:i.fill,size:i.size,id:r,theme:s});break;default:n=function({dash:e,fill:t,color:n,theme:r,strokeWidth:i,w:o,h:s,id:a,size:l}){let c=sd(o,s,a,l),u=sc(o,s,a,l),d=document.createElementNS("http://www.w3.org/2000/svg","g");for(let{leftPoint:t,rightPoint:o,center:s,radius:a}of(d.setAttribute("stroke-width",i.toString()),d.setAttribute("stroke",r[n].solid),d.setAttribute("fill","none"),u)){let{strokeDasharray:n,strokeDashoffset:r}=om(s?a*(0,eu.f5)((0,eu.f5)(eh.B.Angle(s,o))-(0,eu.f5)(eh.B.Angle(s,t))):eh.B.Dist(t,o),i,{style:e,start:"outset",end:"outset"}),l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d",s?`M${t.x},${t.y}A${a},${a},0,0,1,${o.x},${o.y}`:`M${t.x},${t.y}L${o.x},${o.y}`),l.setAttribute("stroke-dasharray",n.toString()),l.setAttribute("stroke-dashoffset",r.toString()),d.appendChild(l)}return oa(d,os({d:c,fill:t,color:n,theme:r}))}({id:r,strokeWidth:o,w:i.w,h:i.h,dash:i.dash,color:i.color,fill:i.fill,theme:s,size:i.size})}break;default:{let t=this.editor.getShapeGeometry(e),a=t instanceof tP.m?t.children[0].vertices:t.vertices,l=sA(e.props,o);switch(i.dash){case"draw":n=function({id:e,outline:t,lines:n,fill:r,color:i,theme:o,strokeWidth:s}){let a=si(so(e,t,s/3,2*s,2));if(n)for(let[e,t]of n)a+=`M${e.x},${e.y}L${t.x},${t.y}`;let l=si(so(e,t,0,2*s,1)),c=document.createElementNS("http://www.w3.org/2000/svg","path");return c.setAttribute("d",a),c.setAttribute("fill","none"),c.setAttribute("stroke",o[i].solid),c.setAttribute("stroke-width",s.toString()),oa(c,os({d:l,fill:r,color:i,theme:o}))}({id:r,fill:i.fill,color:i.color,strokeWidth:o,outline:a,lines:l,theme:s});break;case"solid":n=function({outline:e,lines:t,fill:n,color:r,strokeWidth:i,theme:o}){let s="M"+e[0]+"L"+e.slice(1)+"Z",a=s;if(t)for(let[e,n]of t)a+=`M${e.x},${e.y}L${n.x},${n.y}`;let l=document.createElementNS("http://www.w3.org/2000/svg","path");return l.setAttribute("d",a),l.setAttribute("stroke-width",i.toString()),l.setAttribute("stroke",o[r].solid),l.setAttribute("fill","none"),oa(l,os({d:s,fill:n,color:r,theme:o}))}({fill:i.fill,color:i.color,strokeWidth:o,outline:a,lines:l,theme:s});break;default:n=function({dash:e,fill:t,color:n,theme:r,strokeWidth:i,outline:o,lines:s}){let a=document.createElementNS("http://www.w3.org/2000/svg","g");if(a.setAttribute("stroke-width",i.toString()),a.setAttribute("stroke",r[n].solid),a.setAttribute("fill","none"),Array.from(Array(o.length)).forEach((t,n)=>{let r=o[n],s=o[(n+1)%o.length],{strokeDasharray:l,strokeDashoffset:c}=om(eh.B.Dist(r,s),i,{style:e}),u=document.createElementNS("http://www.w3.org/2000/svg","line");u.setAttribute("x1",r.x.toString()),u.setAttribute("y1",r.y.toString()),u.setAttribute("x2",s.x.toString()),u.setAttribute("y2",s.y.toString()),u.setAttribute("stroke-dasharray",l.toString()),u.setAttribute("stroke-dashoffset",c.toString()),a.appendChild(u)}),s)for(let[t,n]of s){let{strokeDasharray:r,strokeDashoffset:o}=om(eh.B.Dist(t,n),i,{style:e,start:"skip",end:"skip",snap:"dotted"===e?4:2}),s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1",t.x.toString()),s.setAttribute("y1",t.y.toString()),s.setAttribute("x2",n.x.toString()),s.setAttribute("y2",n.y.toString()),s.setAttribute("stroke-dasharray",r.toString()),s.setAttribute("stroke-dashoffset",o.toString()),a.appendChild(s)}return oa(a,os({d:"M"+o[0]+"L"+o.slice(1)+"Z",fill:t,color:n,theme:r}))}({dash:i.dash,fill:i.fill,color:i.color,strokeWidth:o,outline:a,lines:l,theme:s})}}}if(i.text){let r=this.editor.getShapeGeometry(e).bounds;t.addExportDef(oc(e.props.font));let i=st({editor:this.editor,shape:e,font:I.p6[e.props.font],bounds:r}),o=i.cloneNode(!0);o.setAttribute("fill",s[e.props.labelColor].solid),o.setAttribute("stroke","none");let a=i.cloneNode(!0);a.setAttribute("stroke-width","2"),a.setAttribute("fill",s.background),a.setAttribute("stroke",s.background);let l=document.createElementNS("http://www.w3.org/2000/svg","g");if(l.append(a),l.append(o),"g"===n.nodeName)n.appendChild(l);else{let e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.appendChild(n),e.appendChild(l),e}}return n}getCanvasSvgDefs(){return[od()]}onResize=(e,{handle:t,newPoint:n,scaleX:r,scaleY:i,initialShape:o})=>{let s=o.props.w*r,a=(o.props.h+o.props.growY)*i,l=0,c=0;if(e.props.text.trim()){let t=Math.max(Math.abs(s),51),n=Math.max(Math.abs(a),51);t<51&&51===n&&(t=51),51===t&&n<51&&(n=51);let r=sM(this.editor,{...e,props:{...e.props,w:t,h:n}}),i=Math.max(Math.abs(s),r.w)*Math.sign(s),o=Math.max(Math.abs(a),r.h)*Math.sign(a);l=Math.abs(i)-Math.abs(s),c=Math.abs(o)-Math.abs(a),s=i,a=o}let u=new eh.B(0,0);r<0&&(u.x+=s),("left"===t||"top_left"===t||"bottom_left"===t)&&(u.x+=r<0?l:-l),i<0&&(u.y+=a),("top"===t||"top_left"===t||"top_right"===t)&&(u.y+=i<0?c:-c);let{x:d,y:h}=u.rot(e.rotation).add(n);return{x:d,y:h,props:{w:Math.max(Math.abs(s),1),h:Math.max(Math.abs(a),1),growY:0}}};onBeforeCreate=e=>{if(!e.props.text)return e.props.growY?{...e,props:{...e.props,growY:0}}:void 0;let t=e.props.h,n=sM(this.editor,e).h,r=null;if(n>t?r=n-t:e.props.growY&&(r=0),null!==r)return{...e,props:{...e.props,growY:r}}};onBeforeUpdate=(e,t)=>{let n=e.props.text,r=t.props.text;if(n===r&&e.props.font===t.props.font&&e.props.size===t.props.size)return;if(n&&!r)return{...t,props:{...t.props,growY:0}};let i=e.props.w,o=e.props.h,s=sM(this.editor,t),a=s.w,l=s.h;if(!n&&r&&1===r.length){let n=Math.max(i,a),r=Math.max(o,l);return e.props.w<51&&e.props.h<51&&(r=Math.max(n=Math.max(n=Math.max(n,51),r=Math.max(r,51)),r)),{...t,props:{...t.props,w:n,h:r,growY:0}}}let c=null;return(l>o?c=l-o:e.props.growY&&(c=0),null!==c)?{...t,props:{...t.props,growY:c,w:Math.max(t.props.w,a)}}:a>e.props.w?{...t,props:{...t.props,w:a}}:void 0};onDoubleClick=e=>{if(this.editor.inputs.altKey)switch(e.props.geo){case"rectangle":return{...e,props:{geo:"check-box"}};case"check-box":return{...e,props:{geo:"rectangle"}}}}}function sM(e,t){let n=t.props.text;if(!n)return{w:0,h:0};let r=e.textMeasure.measureText("w",{...ie,fontFamily:is[t.props.font],fontSize:ii[t.props.size],maxWidth:100}),i=e.textMeasure.measureText(n,{...ie,fontFamily:is[t.props.font],fontSize:ii[t.props.size],minWidth:r.w+"px",maxWidth:Math.max(0,Math.ceil(r.w+({s:2,m:3.5,l:5,xl:10})[t.props.size]),Math.ceil(t.props.w-32))});return{w:i.w+32,h:i.h+32}}function sA(e,t){switch(e.geo){case"x-box":return function(e,t,n,r){let i="draw"===r?.62:0;if("dashed"===r)return[[new eh.B(0,0),new eh.B(e/2,t/2)],[new eh.B(e,t),new eh.B(e/2,t/2)],[new eh.B(0,t),new eh.B(e/2,t/2)],[new eh.B(e,0),new eh.B(e/2,t/2)]];let o=t=>Math.max(0,Math.min(e,t)),s=e=>Math.max(0,Math.min(t,e));return[[new eh.B(o(n*i),s(n*i)),new eh.B(o(e-n*i),s(t-n*i))],[new eh.B(o(n*i),s(t-n*i)),new eh.B(o(e-n*i),s(n*i))]]}(e.w,e.h,t,e.dash);case"check-box":return function(e,t){let n=.82*Math.min(e,t),r=(e-n)/2,i=(t-n)/2,o=t=>Math.max(0,Math.min(e,t)),s=e=>Math.max(0,Math.min(t,e));return[[new eh.B(o(r+.25*n),s(i+.52*n)),new eh.B(o(r+.45*n),s(i+.82*n))],[new eh.B(o(r+.45*n),s(i+.82*n)),new eh.B(o(r+.82*n),s(i+.22*n))]]}(e.w,e.h);default:return}}class sO extends rs.E{static type="highlight";static props=I.VW;static migrations=I.J1;hideResizeHandles=e=>sz(e);hideRotateHandle=e=>sz(e);hideSelectionBoundsFg=e=>sz(e);getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1}}getGeometry(e){let t=sR(e);if(sz(e))return new rT({x:-t/2,y:-t/2,radius:t/2,isFilled:!0});let{strokePoints:n,sw:r}=s$(e,t,!0),i=oX({strokeWidth:r,showAsComplete:!0});return r1(n,i),new rB.w({points:rJ(n,i),isFilled:!0})}component(e){return(0,O.jsx)(sD,{strokeWidth:sR(e),shape:e,opacity:.35})}backgroundComponent(e){return(0,O.jsx)(sD,{strokeWidth:sR(e),shape:e,opacity:.82})}indicator(e){let t;let n=oZ(),r=sR(e),i=oJ(e.props.segments),o=r;n||e.props.isPen||1!==i.length||(o+=(0,M.Vk)(e.id)()*(r/6));let s=rQ(i,oX({strokeWidth:r,showAsComplete:e.props.isComplete||M.Z$(e.props.segments)?.type==="straight"}));return t=s.length<2?function(e,t){let n=t/2;return`M ${e.x} ${e.y} m -${n}, 0 a ${n},${n} 0 1,0 ${2*n},0 a ${n},${n} 0 1,0 -${2*n},0`}(i[0],o):oV(s,!1),(0,O.jsx)("path",{d:t})}toSvg(e){let t=(0,I.y6)({isDarkMode:this.editor.user.getIsDarkMode()});return sL(sR(e),e,.35,t)}toBackgroundSvg(e){let t=(0,I.y6)({isDarkMode:this.editor.user.getIsDarkMode()});return sL(sR(e),e,.82,t)}onResize=(e,t)=>{let{scaleX:n,scaleY:r}=t,i=[];for(let t of e.props.segments)i.push({...t,points:t.points.map(({x:e,y:t,z:i})=>({x:n*e,y:r*t,z:i}))});return{props:{segments:i}}}}function s$(e,t,n){let r=oJ(e.props.segments),i=e.props.isComplete||M.Z$(e.props.segments)?.type==="straight",o=t;return n||e.props.isPen||1!==r.length||(o+=(0,M.Vk)(e.id)()*(t/6)),{strokePoints:rQ(r,oX({strokeWidth:o,showAsComplete:i})),sw:o}}function sB(e,t,n){var r;let{strokePoints:i,sw:o}=s$(e,t,n);return{solidStrokePath:i.length>1?oV(i,!1):(r=e.props.segments[0].points[0],`M ${r.x} ${r.y} m -0.1, 0 a 0.1,0.1 0 1,0 0.2,0 a 0.1,0.1 0 1,0 -0.2,0`),sw:o}}function sD({strokeWidth:e,shape:t,opacity:n}){let r=or(),{solidStrokePath:i,sw:o}=sB(t,e,oZ()),s=function(){let[e,t]=(0,$.useState)(!1);return(0,$.useEffect)(()=>{let e=CSS.supports("color","color(display-p3 1 1 1)"),n=matchMedia("(color-gamut: p3)");t(e&&n.matches);let r=()=>t(e&&n.matches);return n.addEventListener("change",r),()=>n.removeEventListener("change",r)},[]),(0,T.Hg)(N.forceSrgb)||!e?"srgb":"p3"}(),a=r[t.props.color].highlight[s];return(0,O.jsx)(rn.g,{id:t.id,style:{opacity:n},children:(0,O.jsx)("path",{d:i,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:a,strokeWidth:o})})}function sL(e,t,n,r){let{solidStrokePath:i,sw:o}=sB(t,e,!1),s=document.createElementNS("http://www.w3.org/2000/svg","path");return s.setAttribute("d",i),s.setAttribute("fill","none"),s.setAttribute("stroke",r[t.props.color].highlight.srgb),s.setAttribute("stroke-width",`${o}`),s.setAttribute("opacity",`${n}`),s}function sR(e){return 1.12*ir[e.props.size]}function sz(e){return 1===e.props.segments.length&&e.props.segments[0].points.length<2}function sN(){let[e,t]=(0,$.useState)(!1);return(0,$.useEffect)(()=>{let e=window.matchMedia("(prefers-reduced-motion: reduce)"),n=()=>{t(e.matches)};return n(),e.addEventListener("change",n),()=>e.removeEventListener("change",n)},[]),e}let sF=async e=>new Promise((t,n)=>{let r=new Image;r.onload=()=>t(r),r.onerror=()=>n(Error("Failed to load image")),r.crossOrigin="anonymous",r.src=e}),sU=async e=>{let t=await sF(e),n=document.createElement("canvas");n.width=t.width,n.height=t.height;let r=n.getContext("2d");if(r)return r.drawImage(t,0,0),n.toDataURL()};async function sV(e){let t=await fetch(e),n=await t.blob();return new Promise((e,t)=>{let r=new FileReader;r.onloadend=()=>e(r.result),r.onerror=t,r.readAsDataURL(n)})}class sH extends rl{static type="image";static props=I.Fc;static migrations=I.y5;isAspectRatioLocked=()=>!0;canCrop=()=>!0;getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null}}component(e){let t=sZ(e),n=rw(e.id),r=sN(),[i,o]=(0,$.useState)(""),s=e.props.assetId?this.editor.getAsset(e.props.assetId):void 0;if(s?.type==="bookmark")throw Error("Bookmark assets can't be rendered as images");let a=(0,T.Hg)("onlySelectedShape",()=>e.id===this.editor.getOnlySelectedShape()?.id,[this.editor])&&n&&this.editor.isInAny("select.crop","select.cropping","select.pointing_crop_handle"),l=r&&(s?.props.mimeType?.includes("video")||s?.props.mimeType?.includes("gif"));return(0,$.useEffect)(()=>{if(s?.props.src&&"mimeType"in s.props&&s?.props.mimeType==="image/gif"){let e=!1;return(async()=>{let t=await sU(s.props.src);!e&&t&&o(t)})(),()=>{e=!0}}},[r,s?.props]),(0,O.jsxs)(O.Fragment,{children:[s?.props.src&&a&&(0,O.jsx)("div",{style:t,children:(0,O.jsx)("div",{className:"tl-image",style:{opacity:.1,backgroundImage:`url(${!e.props.playing||l?i:s.props.src})`},draggable:!1})}),(0,O.jsxs)(re,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h},children:[(0,O.jsxs)("div",{className:"tl-image-container",style:t,children:[s?.props.src?(0,O.jsx)("div",{className:"tl-image",style:{backgroundImage:`url(${!e.props.playing||l?i:s.props.src})`},draggable:!1}):null,s?.props.isAnimated&&!e.props.playing&&(0,O.jsx)("div",{className:"tl-image__tg",children:"GIF"})]}),"url"in e.props&&e.props.url&&(0,O.jsx)(oD,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})]})}indicator(e){return rw(e.id)?null:(0,O.jsx)("rect",{width:(0,eu.$Z)(e.props.w),height:(0,eu.$Z)(e.props.h)})}shouldGetDataURI(e){return e&&(e.startsWith("http")||e.startsWith("/")||e.startsWith("./"))}async toSvg(e){let t=document.createElementNS("http://www.w3.org/2000/svg","g"),n=e.props.assetId?this.editor.getAsset(e.props.assetId):null,r=n?.props.src||"";this.shouldGetDataURI(r)&&(r=await sV(r)||"");let i=document.createElementNS("http://www.w3.org/2000/svg","image");i.setAttributeNS("http://www.w3.org/1999/xlink","href",r);let o=sZ(e),s=e.props.crop;if(o.transform&&s){let{transform:e,width:n,height:r}=o,a=(s.bottomRight.x-s.topLeft.x)*n,l=(s.bottomRight.y-s.topLeft.y)*r,c=[new eh.B(0,0),new eh.B(a,0),new eh.B(a,l),new eh.B(0,l)],u=document.createElementNS("http://www.w3.org/2000/svg","polygon");u.setAttribute("points",c.map(e=>`${e.x},${e.y}`).join(" "));let d=document.createElementNS("http://www.w3.org/2000/svg","clipPath");d.setAttribute("id","cropClipPath"),d.appendChild(u);let h=document.createElementNS("http://www.w3.org/2000/svg","defs");h.appendChild(d),t.appendChild(h);let p=document.createElementNS("http://www.w3.org/2000/svg","g");p.setAttribute("clip-path","url(#cropClipPath)"),i.setAttribute("width",n.toString()),i.setAttribute("height",r.toString()),i.style.transform=e,p.appendChild(i),t.appendChild(p)}else i.setAttribute("width",e.props.w.toString()),i.setAttribute("height",e.props.h.toString()),t.appendChild(i);return t}onDoubleClick=e=>{let t=e.props.assetId?this.editor.getAsset(e.props.assetId):void 0;t&&t.props.src&&"mimeType"in t.props&&"image/gif"===t.props.mimeType&&this.editor.updateShapes([{type:"image",id:e.id,props:{playing:!e.props.playing}}])};onDoubleClickEdge=e=>{let t=e.props;if(!t||this.editor.getCroppingShapeId()!==e.id)return;let n=(0,M.p$)(t.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},r=1/(n.bottomRight.x-n.topLeft.x)*e.props.w,i=1/(n.bottomRight.y-n.topLeft.y)*e.props.h,o=new eh.B(n.topLeft.x*r,n.topLeft.y*i).rot(e.rotation),s={id:e.id,type:e.type,x:e.x-o.x,y:e.y-o.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:r,h:i}};this.editor.updateShapes([s])}}function sZ(e){let t=e.props.crop,n=t?.topLeft;if(!n)return{width:e.props.w,height:e.props.h};let r=1/(t.bottomRight.x-t.topLeft.x)*e.props.w,i=1/(t.bottomRight.y-t.topLeft.y)*e.props.h,o=-n.x*r,s=-n.y*i;return{transform:`translate(${o}px, ${s}px)`,width:r,height:i}}function sK(e,t){let{start:n,end:r}=e;return t?`M${(0,eu.$Z)(n.x)},${(0,eu.$Z)(n.y)} L${(0,eu.$Z)(r.x)},${(0,eu.$Z)(r.y)} `:`${(0,eu.$Z)(r.x)},${(0,eu.$Z)(r.y)} `}function sW(e,t){let{a:n,b:r,c:i,d:o}=e;return eh.B.Equals(n,o)?"":`${t?`M${(0,eu.$Z)(n.x)},${(0,eu.$Z)(n.y)}`:""}C${(0,eu.$Z)(r.x)},${(0,eu.$Z)(r.y)} ${(0,eu.$Z)(i.x)},${(0,eu.$Z)(i.y)} ${(0,eu.$Z)(o.x)},${(0,eu.$Z)(o.y)}`}function sY(e,t){let n=e.segments.reduce((e,t,n)=>e+sW(t,0===n),"");return t&&(n+="Z"),n}function sG(e,t=!1){if(!(e instanceof rj.q))return sY(e,t);{let n;return n=e.segments.reduce((e,t,n)=>e+sK(t,0===n),""),t&&(n+="Z"),n}}function sX(e){return{size:e,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function sq(e,t,n){return rQ(t.vertices,sX(n))}function sJ(e,t,n){return eE(function(e,t,n){let r=sX(n);return rJ(r1(sq(e,t,n),r),r)}(e,t,n))}let sQ=new rR._;class s0 extends rs.E{static type="line";static props=I.BG;static migrations=I.FH;hideResizeHandles=()=>!0;hideRotateHandle=()=>!0;hideSelectionBoundsFg=()=>!0;hideSelectionBoundsBg=()=>!0;getDefaultProps(){return{dash:"draw",size:"m",color:"black",spline:"line",handles:{start:{id:"start",type:"vertex",canBind:!1,canSnap:!0,index:"a1",x:0,y:0},end:{id:"end",type:"vertex",canBind:!1,canSnap:!0,index:"a2",x:.1,y:.1}}}}getGeometry(e){return s1(e)}getHandles(e){return sQ.get(e.props,()=>{let t=e.props.handles,n=s1(e),r=Object.values(t).sort(rV.hl),i=r.slice();for(let e=0;e<n.segments.length;e++){let t=n.segments[e].midPoint(),o=(0,rV.eI)(r[e].index,r[e+1].index);i.push({id:`mid-${e}`,type:"create",index:o,x:t.x,y:t.y})}return i.sort(rV.hl)})}getOutlineSegments(e){return this.editor.getShapeGeometry(e).segments.map(e=>e.vertices)}onResize=(e,t)=>{let{scaleX:n,scaleY:r}=t,i=(0,M.p$)(e.props.handles);return Object.values(e.props.handles).forEach(({id:e,x:t,y:o})=>{i[e].x=t*n,i[e].y=o*r}),{props:{handles:i}}};onHandleDrag=(e,{handle:t})=>{let n=(0,M.p$)(e);switch(t.id){case"start":case"end":n.props.handles[t.id]={...n.props.handles[t.id],x:t.x,y:t.y};break;default:{let r="handle:"+t.index,i=e.props.handles[r];i?n.props.handles[r]={...i,x:t.x,y:t.y}:n.props.handles[r]={id:r,type:"vertex",canBind:!1,index:t.index,x:t.x,y:t.y}}}return n};component(e){let t=or(),n=s1(e),r=it[e.props.size],{dash:i,color:o}=e.props;if("line"===e.props.spline){if("solid"===i){let i=n.points,s="M"+i[0]+"L"+i.slice(1);return(0,O.jsxs)(rn.g,{id:e.id,children:[(0,O.jsx)(oi,{d:s,fill:"none",color:o,theme:t}),(0,O.jsx)("path",{d:s,stroke:t[o].solid,strokeWidth:r,fill:"none"})]})}if("dashed"===i||"dotted"===i){let s=n.points,a="M"+s[0]+"L"+s.slice(1);return(0,O.jsxs)(rn.g,{id:e.id,children:[(0,O.jsx)(oi,{d:a,fill:"none",color:o,theme:t}),(0,O.jsx)("g",{stroke:t[o].solid,strokeWidth:r,children:n.segments.map((e,t)=>{let{strokeDasharray:o,strokeDashoffset:s}=om(e.length,r,{style:i,start:t>0?"outset":"none",end:t<n.segments.length-1?"outset":"none"});return(0,O.jsx)("path",{strokeDasharray:o,strokeDashoffset:s,d:sK(e,!0),fill:"none"},t)})})]})}if("draw"===i){let i=n.points,[s,a]=ss(e.id,i,r);return(0,O.jsxs)(rn.g,{id:e.id,children:[(0,O.jsx)(oi,{d:s,fill:"none",color:o,theme:t}),(0,O.jsx)("path",{d:a,stroke:t[o].solid,strokeWidth:r,fill:"none"})]})}}if("cubic"===e.props.spline){let s=sG(n);if("solid"===i)return(0,O.jsxs)(rn.g,{id:e.id,children:[(0,O.jsx)(oi,{d:s,fill:"none",color:o,theme:t}),(0,O.jsx)("path",{strokeWidth:r,stroke:t[o].solid,fill:"none",d:s})]});if("dashed"===i||"dotted"===i)return(0,O.jsxs)(rn.g,{id:e.id,children:[(0,O.jsx)(oi,{d:s,fill:"none",color:o,theme:t}),(0,O.jsx)("g",{stroke:t[o].solid,strokeWidth:r,children:n.segments.map((e,t)=>{let{strokeDasharray:o,strokeDashoffset:s}=om(e.length,r,{style:i,start:t>0?"outset":"none",end:t<n.segments.length-1?"outset":"none"});return(0,O.jsx)("path",{strokeDasharray:o,strokeDashoffset:s,d:sW(e,!0),fill:"none"},t)})})]});if("draw"===i)return(0,O.jsxs)(rn.g,{id:e.id,children:[(0,O.jsx)(oi,{d:s,fill:"none",color:o,theme:t}),(0,O.jsx)("path",{d:sJ(e,n,r),strokeWidth:1,stroke:t[o].solid,fill:t[o].solid})]})}}indicator(e){let t;let n=it[e.props.size],r=s1(e),{dash:i}=e.props;if("line"===e.props.spline){let o=r.points;if("solid"===i||"dotted"===i||"dashed"===i)t="M"+o[0]+"L"+o.slice(1);else{let[r]=ss(e.id,o,n);t=r}}else t="draw"===e.props.dash?oV(sq(e,r,n)):sG(r);return(0,O.jsx)("path",{d:t})}toSvg(e){let t=(0,I.y6)({isDarkMode:this.editor.user.getIsDarkMode()})[e.props.color].solid,n=s1(e),r=it[e.props.size];switch(e.props.dash){case"draw":{let i;if(n instanceof rM)i=sJ(e,n,r);else{let[t,o]=ss(e.id,n.points,r);i=o}let o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttribute("stroke-width",r+"px"),o.setAttribute("stroke",t),o.setAttribute("fill","none"),o.setAttribute("d",i),o}case"solid":{let e;if(n instanceof rM)e=sY(n,!1);else{let t=n.points;e="M"+t[0]+"L"+t.slice(1)}let i=document.createElementNS("http://www.w3.org/2000/svg","path");return i.setAttribute("stroke-width",r+"px"),i.setAttribute("stroke",t),i.setAttribute("fill","none"),i.setAttribute("d",e),i}default:{let{segments:i}=n,o=document.createElementNS("http://www.w3.org/2000/svg","g");o.setAttribute("stroke",t),o.setAttribute("stroke-width",r.toString());let s=n instanceof rM?sW:sK;return i.forEach((t,n)=>{let a=document.createElementNS("http://www.w3.org/2000/svg","path"),{strokeDasharray:l,strokeDashoffset:c}=om(t.length,r,{style:e.props.dash,start:n>0?"outset":"none",end:n<i.length-1?"outset":"none"});a.setAttribute("stroke-dasharray",l.toString()),a.setAttribute("stroke-dashoffset",c.toString()),a.setAttribute("d",s(t,!0)),a.setAttribute("fill","none"),o.appendChild(a)}),o}}}}function s1(e){let{spline:t,handles:n}=e.props,r=Object.values(n).sort(rV.hl).map(eh.B.From);switch(t){case"cubic":return new rM({points:r});case"line":return new rj.q({points:r})}}class s2 extends rs.E{static type="note";static props=I.m0;static migrations=I.C_;canEdit=()=>!0;hideResizeHandles=()=>!0;hideSelectionBoundsFg=()=>!0;getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",growY:0,url:""}}getHeight(e){return 200+e.props.growY}getGeometry(e){let t=this.getHeight(e);return new ro.z({width:200,height:t,isFilled:!0})}component(e){let{id:t,type:n,props:{color:r,font:i,size:o,align:s,text:a,verticalAlign:l}}=e,c=or(),u="black"===r?"yellow":r;return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("div",{style:{position:"absolute",width:200,height:this.getHeight(e)},children:(0,O.jsxs)("div",{className:"tl-note__container",style:{color:c[u].solid,backgroundColor:c[u].solid},children:[(0,O.jsx)("div",{className:"tl-note__scrim"}),(0,O.jsx)(se,{id:t,type:n,font:i,size:o,align:s,verticalAlign:l,text:a,labelColor:"black",wrap:!0})]})}),"url"in e.props&&e.props.url&&(0,O.jsx)(oD,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(e){return(0,O.jsx)("rect",{rx:"6",width:(0,eu.$Z)(200),height:(0,eu.$Z)(this.getHeight(e))})}toSvg(e,t){t.addExportDef(oc(e.props.font));let n=(0,I.y6)({isDarkMode:this.editor.user.getIsDarkMode()}),r=this.editor.getShapeGeometry(e).bounds,i=document.createElementNS("http://www.w3.org/2000/svg","g"),o="black"===e.props.color?"yellow":e.props.color,s=document.createElementNS("http://www.w3.org/2000/svg","rect");s.setAttribute("rx","10"),s.setAttribute("width","200"),s.setAttribute("height",r.height.toString()),s.setAttribute("fill",n[o].solid),s.setAttribute("stroke",n[o].solid),s.setAttribute("stroke-width","1"),i.appendChild(s);let a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.setAttribute("rx","10"),a.setAttribute("width","200"),a.setAttribute("height",r.height.toString()),a.setAttribute("fill",n.background),a.setAttribute("opacity",".28"),i.appendChild(a);let l=st({editor:this.editor,shape:e,font:I.p6[e.props.font],bounds:r});return l.setAttribute("fill",n.text),l.setAttribute("stroke","none"),i.appendChild(l),i}onBeforeCreate=e=>s5(this.editor,e,e.props.growY);onBeforeUpdate=(e,t)=>{if(e.props.text!==t.props.text||e.props.font!==t.props.font||e.props.size!==t.props.size)return s5(this.editor,t,e.props.growY)};onEditEnd=e=>{let{id:t,type:n,props:{text:r}}=e;r.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:r.trimEnd()}}])}}function s5(e,t,n=0){let r=e.textMeasure.measureText(t.props.text,{...ie,fontFamily:is[t.props.font],fontSize:ii[t.props.size],maxWidth:166}).h+34,i=null;if(r>200?i=r-200:n&&(i=0),null!==i)return{...t,props:{...t.props,growY:i}}}let s3=new rR._;class s8 extends rs.E{static type="text";static props=I.XB;static migrations=I.pL;getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",align:"middle",autoSize:!0,scale:1}}getMinDimensions(e){return s3.get(e.props,e=>s4(this.editor,e))}getGeometry(e){let{scale:t}=e.props,{width:n,height:r}=this.getMinDimensions(e);return new ro.z({width:n*t,height:r*t,isFilled:!0})}canEdit=()=>!0;isAspectRatioLocked=()=>!0;component(e){let{id:t,type:n,props:{text:r,color:i}}=e,o=(0,I.y6)({isDarkMode:this.editor.user.getIsDarkMode()}),{width:s,height:a}=this.getMinDimensions(e),{rInput:l,isEmpty:c,isEditing:u,handleFocus:d,handleChange:h,handleKeyDown:p,handleBlur:f,handleInputPointerDown:g,handleDoubleClick:m}=oP(t,n,r);return(0,O.jsx)(re,{id:e.id,children:(0,O.jsxs)("div",{className:"tl-text-shape__wrapper tl-text-shadow","data-font":e.props.font,"data-align":e.props.align,"data-hastext":!c,"data-isediting":u,"data-textwrap":!0,style:{fontSize:ir[e.props.size],lineHeight:ir[e.props.size]*ie.lineHeight+"px",transform:`scale(${e.props.scale})`,transformOrigin:"top left",width:Math.max(1,s),height:Math.max(ir[e.props.size]*ie.lineHeight,a),color:o[i].solid},children:[(0,O.jsx)("div",{className:"tl-text tl-text-content",dir:"ltr",children:r}),u?(0,O.jsx)("textarea",{ref:l,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:u,placeholder:"",spellCheck:"true",wrap:"off",dir:"ltr",datatype:"wysiwyg",defaultValue:r,onFocus:d,onChange:h,onKeyDown:p,onBlur:f,onTouchEnd:W,onContextMenu:W,onPointerDown:g,onDoubleClick:m}):null]})})}indicator(e){let t=this.editor.getShapeGeometry(e).bounds,n=(0,G.j)();return e.props.autoSize&&n.getEditingShapeId()===e.id?null:(0,O.jsx)("rect",{width:(0,eu.$Z)(t.width),height:(0,eu.$Z)(t.height)})}toSvg(e,t){t.addExportDef(oc(e.props.font));let n=(0,I.y6)({isDarkMode:this.editor.user.getIsDarkMode()}),r=this.editor.getShapeGeometry(e).bounds,i=e.props.text,o=r.width/(e.props.scale??1),s=r.height/(e.props.scale??1),a={fontSize:ir[e.props.size],fontFamily:I.p6[e.props.font],textAlign:e.props.align,verticalTextAlign:"middle",width:o,height:s,padding:0,lineHeight:ie.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap"},l=n[e.props.color].solid,c=document.createElementNS("http://www.w3.org/2000/svg","g"),u=ol(this.editor,this.editor.textMeasure.measureTextSpans(i,a),{...a,stroke:n.background,strokeWidth:2,fill:n.background,padding:0}),d=u.cloneNode(!0);return d.setAttribute("fill",l),d.setAttribute("stroke","none"),c.append(u),c.append(d),c}onResize=(e,t)=>{let{initialBounds:n,initialShape:r,scaleX:i,handle:o}=t;if("scale_shape"===t.mode||"right"!==o&&"left"!==o)return{id:e.id,type:e.type,...function(e,{initialBounds:t,scaleX:n,scaleY:r,newPoint:i}){let o=Math.max(.01,Math.min(Math.abs(n),Math.abs(r))),s=new eh.B(0,0);n<0&&(s.x=-(t.width*o)),r<0&&(s.y=-(t.height*o));let{x:a,y:l}=eh.B.Add(i,s.rot(e.rotation));return{x:a,y:l,props:{scale:o*e.props.scale}}}(e,t)};{let t=n.width,s=t*i,a=new eh.B(0,0);s=Math.max(1,Math.abs(s)),"left"===o?(a.x=t-s,i<0&&(a.x+=s)):i<0&&(a.x-=s);let{x:l,y:c}=a.rot(e.rotation).add(r);return{id:e.id,type:e.type,x:l,y:c,props:{w:s/r.props.scale,autoSize:!1}}}};onBeforeCreate=e=>{if(!e.props.autoSize||e.props.text.trim())return;let t=this.getMinDimensions(e);return{...e,x:e.x-t.width/2,y:e.y-t.height/2}};onEditEnd=e=>{let{id:t,type:n,props:{text:r}}=e,i=e.props.text.trimEnd();0===i.length?this.editor.deleteShapes([e.id]):i!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:r.trimEnd()}}])};onBeforeUpdate=(e,t)=>{let n;if(!t.props.autoSize)return;let r=e.props.size!==t.props.size||e.props.align!==t.props.align||e.props.font!==t.props.font||1!==e.props.scale&&1===t.props.scale,i=e.props.text!==t.props.text;if(!r&&!i)return;let o=this.getMinDimensions(e),s=s4(this.editor,t.props),a=o.width*e.props.scale,l=o.height*e.props.scale,c=s.width*t.props.scale,u=s.height*t.props.scale;switch(t.props.align){case"middle":n=new eh.B((c-a)/2,i?0:(u-l)/2);break;case"end":n=new eh.B(c-a,i?0:(u-l)/2);break;default:if(i)break;n=new eh.B(0,(u-l)/2)}if(!n)return{...t,props:{...t.props,w:c}};{n.rot(t.rotation);let{x:e,y:r}=t;return{...t,x:e-n.x,y:r-n.y,props:{...t.props,w:c}}}};onDoubleClickEdge=e=>e.props.autoSize?1!==e.props.scale?{id:e.id,type:e.type,props:{scale:1}}:void 0:{id:e.id,type:e.type,props:{autoSize:!0}}}function s4(e,t){let{font:n,text:r,autoSize:i,size:o,w:s}=t,a=i?16:Math.max(16,s),l=ir[o],c=e.textMeasure.measureText(r,{...ie,fontFamily:is[n],fontSize:l,maxWidth:i?null:Math.floor(Math.max(a,s))});return i&&(c.w+=1),{width:Math.max(a,c.w),height:Math.max(l,c.h)}}class s6 extends rl{static type="video";static props=I.p$;static migrations=I.lY;canEdit=()=>!0;isAspectRatioLocked=()=>!0;getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(e){return(0,O.jsx)(s9,{shape:e,videoUtil:this})}indicator(e){return(0,O.jsx)("rect",{width:(0,eu.$Z)(e.props.w),height:(0,eu.$Z)(e.props.h)})}toSvg(e){let t=document.createElementNS("http://www.w3.org/2000/svg","g"),n=document.createElementNS("http://www.w3.org/2000/svg","image");return n.setAttributeNS("http://www.w3.org/1999/xlink","href",function(e){let t=e.split(":")[1],n=document.querySelector(`.tl-video-shape-${t}`);if(n){let e=document.createElement("canvas");return e.width=n.videoWidth,e.height=n.videoHeight,e.getContext("2d").drawImage(n,0,0),e.toDataURL("image/png")}throw Error("Video with id "+t+" not found")}(e.id)),n.setAttribute("width",e.props.w.toString()),n.setAttribute("height",e.props.h.toString()),t.appendChild(n),t}}let s9=(0,T.j)(function(e){let{shape:t,videoUtil:n}=e,r=n.editor.getShapeGeometry(t).bounds.w*n.editor.getZoomLevel()>=110,i=t.props.assetId?n.editor.getAsset(t.props.assetId):null,{time:o,playing:s}=t.props,a=rx(t.id),l=sN(),c=$.useRef(null),u=$.useCallback(e=>{let r=e.currentTarget;n.editor.updateShapes([{type:"video",id:t.id,props:{playing:!0,time:r.currentTime}}])},[t.id,n.editor]),d=$.useCallback(e=>{let r=e.currentTarget;n.editor.updateShapes([{type:"video",id:t.id,props:{playing:!1,time:r.currentTime}}])},[t.id,n.editor]),h=$.useCallback(e=>{let r=e.currentTarget;a&&n.editor.updateShapes([{type:"video",id:t.id,props:{time:r.currentTime}}])},[a,t.id,n.editor]),[p,f]=$.useState(!1),g=$.useCallback(e=>{let t=e.currentTarget;o!==t.currentTime&&(t.currentTime=o),s||t.pause(),f(!0)},[s,o]);return $.useEffect(()=>{let e=c.current;e&&(p&&!a&&o!==e.currentTime&&(e.currentTime=o),a&&document.activeElement!==e&&e.focus())},[a,p,o]),$.useEffect(()=>{if(l){let e=c.current;e.pause(),e.currentTime=0}},[c,l]),(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(re,{id:t.id,children:(0,O.jsx)("div",{className:"tl-counter-scaled",children:i?.props.src?(0,O.jsx)("video",{ref:c,style:a?{pointerEvents:"all"}:void 0,className:`tl-video tl-video-shape-${t.id.split(":")[1]}`,width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:a&&r,onPlay:u,onPause:d,onTimeUpdate:h,onLoadedData:g,hidden:!p,children:(0,O.jsx)("source",{src:i.props.src})}):null})}),"url"in t.props&&t.props.url&&(0,O.jsx)(oD,{url:t.props.url,zoomLevel:n.editor.getZoomLevel()})]})}),s7=[s8,oz,o0,sI,s2,s0,o7,oM,sO,o3,sH,s6];class ae extends rd.n{static id="erasing";info={};scribbleId="id";markId="";excludedShapeIds=new Set;onEnter=e=>{this.markId="erase scribble begin",this.editor.mark(this.markId),this.info=e;let{originPagePoint:t}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(e=>{if(this.editor.isShapeOrAncestorLocked(e))return!0;if(this.editor.isShapeOfType(e,"group")||this.editor.isShapeOfType(e,"frame")){let n=this.editor.getPointInShapeSpace(e,t);return this.editor.getShapeGeometry(e).bounds.containsPoint(n)}return!1}).map(e=>e.id));let n=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=n.id,this.update()};pushPointToScribble=()=>{let{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)};onExit=()=>{this.editor.scribbles.stop(this.scribbleId)};onPointerMove=()=>{this.update()};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};update(){let e=this.editor.getErasingShapeIds(),t=this.editor.getZoomLevel(),n=this.editor.getCurrentPageShapes(),{inputs:{currentPagePoint:r,previousPagePoint:i}}=this.editor,{excludedShapeIds:o}=this;this.pushPointToScribble();let s=new Set(e);for(let e of n){if(this.editor.isShapeOfType(e,"group"))continue;let n=this.editor.getShapeMask(e.id);if(n&&!(0,eu.Of)(r,n))continue;let o=this.editor.getShapeGeometry(e),a=this.editor.getPointInShapeSpace(e,i),l=this.editor.getPointInShapeSpace(e,r);o.hitTestLineSegment(a,l,L.wM/t)&&s.add(this.editor.getOutermostSelectableShape(e).id)}this.editor.setErasingShapes([...s].filter(e=>!o.has(e)))}complete(){this.editor.deleteShapes(this.editor.getCurrentPageState().erasingShapeIds),this.editor.setErasingShapes([]),this.parent.transition("idle")}cancel(){this.editor.setErasingShapes([]),this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}}class at extends rd.n{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onCancel=()=>{this.editor.setCurrentTool("select")}}class an extends rd.n{static id="pointing";onEnter=()=>{let e=this.editor.getZoomLevel(),t=this.editor.getCurrentPageShapesSorted(),{inputs:{currentPagePoint:n}}=this.editor,r=new Set,i=r.size;for(let o=t.length,s=o-1;s>=0;s--){let o=t[s];if(!(this.editor.isShapeOrAncestorLocked(o)||this.editor.isShapeOfType(o,"group"))&&this.editor.isPointInShape(o,n,{hitInside:!1,margin:L.wM/e})){let e=this.editor.getOutermostSelectableShape(o);if(this.editor.isShapeOfType(e,"frame")&&r.size>i)break;r.add(e.id)}}this.editor.setErasingShapes([...r])};onPointerMove=e=>{this.editor.inputs.isDragging&&this.parent.transition("erasing",e)};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.cancel()};complete(){let e=this.editor.getErasingShapeIds();e.length&&(this.editor.mark("erase end"),this.editor.deleteShapes(e)),this.editor.setErasingShapes([]),this.parent.transition("idle")}cancel(){this.editor.setErasingShapes([]),this.parent.transition("idle")}}class ar extends rd.n{static id="eraser";static initial="idle";static children=()=>[at,an,ae];onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})}}class ai extends rd.n{static id="dragging";onEnter=()=>{this.update()};onPointerMove=()=>{this.update()};onPointerUp=()=>{this.complete()};onCancel=()=>{this.complete()};onComplete=()=>{this.complete()};update(){let{currentScreenPoint:e,previousScreenPoint:t}=this.editor.inputs,n=eh.B.Sub(e,t);(Math.abs(n.x)>0||Math.abs(n.y)>0)&&this.editor.pan(n)}complete(){this.editor.slideCamera({speed:Math.min(2,this.editor.inputs.pointerVelocity.len()),direction:this.editor.inputs.pointerVelocity,friction:L.$G}),this.parent.transition("idle")}}class ao extends rd.n{static id="idle";onEnter=()=>{this.editor.setCursor({type:"grab",rotation:0})};onPointerDown=e=>{this.parent.transition("pointing",e)};onCancel=()=>{this.editor.setCurrentTool("select")}}class as extends rd.n{static id="pointing";onEnter=()=>{this.editor.stopCameraAnimation(),this.editor.updateInstanceState({cursor:{type:"grabbing",rotation:0}},{ephemeral:!0})};onPointerMove=e=>{this.editor.inputs.isDragging&&this.parent.transition("dragging",e)};onPointerUp=()=>{this.complete()};onCancel=()=>{this.complete()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.complete()};complete(){this.parent.transition("idle")}}class aa extends rd.n{static id="hand";static initial="idle";static children=()=>[ao,as,ai];onDoubleClick=e=>{if("settle"===e.phase){let{currentScreenPoint:e}=this.editor.inputs;this.editor.zoomIn(e,{duration:220,easing:rk.L.easeOutQuint})}};onTripleClick=e=>{if("settle"===e.phase){let{currentScreenPoint:e}=this.editor.inputs;this.editor.zoomOut(e,{duration:320,easing:rk.L.easeOutQuint})}};onQuadrupleClick=e=>{if("settle"===e.phase){let e=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:t}}=this.editor;1===e?this.editor.zoomToFit({duration:400,easing:rk.L.easeOutQuint}):this.editor.resetZoom(t,{duration:320,easing:rk.L.easeOutQuint})}}}class al extends rd.n{static id="idle";onPointerDown=e=>{this.parent.transition("lasering",e)}}class ac extends rd.n{static id="lasering";scribbleId="id";onEnter=()=>{let e=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:1200,shrink:.05,taper:!0});this.scribbleId=e.id,this.pushPointToScribble()};onExit=()=>{this.editor.scribbles.stop(this.scribbleId)};onPointerMove=()=>{this.pushPointToScribble()};onPointerUp=()=>{this.complete()};pushPointToScribble=()=>{let{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}class au extends rd.n{static id="laser";static initial="idle";static children=()=>[al,ac];onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})}}class ad extends rd.n{static id="brushing";info={};brush=new rS.xu;initialSelectedShapeIds=[];excludedShapeIds=new Set;initialStartShape=null;onEnter=e=>{let{altKey:t,currentPagePoint:n}=this.editor.inputs;if(t){this.parent.transition("scribble_brushing",e);return}this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(e=>this.editor.isShapeOfType(e,"group")||this.editor.isShapeOrAncestorLocked(e)).map(e=>e.id)),this.info=e,this.initialSelectedShapeIds=this.editor.getSelectedShapeIds().slice(),this.initialStartShape=this.editor.getShapesAtPoint(n)[0],this.onPointerMove()};onExit=()=>{this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})};onTick=()=>{rF(this.editor)};onPointerMove=()=>{this.hitTestShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=e=>{this.editor.setSelectedShapes(this.initialSelectedShapeIds,{squashing:!0}),this.parent.transition("idle",e)};onKeyDown=e=>{this.editor.inputs.altKey?this.parent.transition("scribble_brushing",e):this.hitTestShapes()};onKeyUp=()=>{this.hitTestShapes()};complete(){this.parent.transition("idle")}hitTestShapes(){let e,t,n,r,i,o;let s=this.editor.getZoomLevel(),a=this.editor.getCurrentPageShapes(),l=this.editor.getCurrentPageId(),{inputs:{originPagePoint:c,currentPagePoint:u,shiftKey:d,ctrlKey:h}}=this.editor;this.brush.setTo(rS.xu.FromPoints([c,u]));let p=new Set(d?this.initialSelectedShapeIds:[]),{corners:f}=this.brush,{excludedShapeIds:g}=this;for(let c=0,d=a.length;c<d;c++)if(n=a[c],!(g.has(n.id)||p.has(n.id))&&(r=this.editor.getShapePageBounds(n))){if(this.brush.contains(r)){this.handleHit(n,u,l,p,f);continue}if(!(h||this.editor.isShapeOfType(n,"frame"))&&this.brush.collides(r)){let r=this.editor.getShapeGeometry(n);if(!(i=this.editor.getShapePageTransform(n)))continue;o=i.clone().invert().applyToPoints(f);for(let i=0;i<o.length;i++)if(e=o[i],t=o[(i+1)%o.length],r.hitTestLineSegment(e,t,L.wM/s)){this.handleHit(n,u,l,p,f);break}}}this.editor.updateInstanceState({brush:{...this.brush.toJson()}}),this.editor.setSelectedShapes(Array.from(p),{squashing:!0})}onInterrupt=()=>{this.editor.updateInstanceState({brush:null})};handleHit(e,t,n,r,i){if(e.parentId===n){r.add(e.id);return}let o=this.editor.getOutermostSelectableShape(e),s=this.editor.getShapeMask(o.id);(!s||(0,r_.UQ)(s,i)||(0,eu.Of)(t,s))&&r.add(o.id)}}function ah(e){let t=e.getZoomLevel(),{inputs:{currentPagePoint:n}}=e;return e.getShapeAtPoint(n,{hitInside:!1,hitLabels:!1,margin:L.wM/t,renderingOnly:!0})??e.getSelectedShapeAtPoint(n)}function ap(e,t,n){if(!t)throw Error("Needs to translate a cropped shape!");let{crop:r}=t.props;if(!r)return;let i=e.inputs.shiftKey?Math.abs(n.x)<Math.abs(n.y)?"x":"y":null;"x"===i?n.x=0:"y"===i&&(n.y=0),n.rot(-t.rotation);let o=1/(r.bottomRight.x-r.topLeft.x)*t.props.w,s=1/(r.bottomRight.y-r.topLeft.y)*t.props.h,a=r.bottomRight.y-r.topLeft.y,l=r.bottomRight.x-r.topLeft.x,c=(0,M.p$)(r);return c.topLeft.x=Math.min(1-l,Math.max(0,c.topLeft.x-n.x/o)),c.topLeft.y=Math.min(1-a,Math.max(0,c.topLeft.y-n.y/s)),c.bottomRight.x=c.topLeft.x+l,c.bottomRight.y=c.topLeft.y+a,{id:t.id,type:t.type,props:{crop:c}}}class af extends rd.n{static id="idle";onEnter=()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0});let e=this.editor.getOnlySelectedShape();this.editor.on("change-history",this.cleanupCroppingState),e&&(this.editor.mark("crop"),this.editor.setCroppingShape(e.id))};onExit=()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.editor.off("change-history",this.cleanupCroppingState)};onCancel=()=>{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})};onPointerDown=e=>{if(!this.editor.getIsMenuOpen()){if(e.ctrlKey){this.cancel(),this.editor.root.handleEvent(e);return}switch(e.target){case"canvas":{let t=ah(this.editor);if(t&&!this.editor.isShapeOfType(t,"group")){this.onPointerDown({...e,shape:t,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(e);break}case"shape":if(e.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",e);return}this.editor.getShapeUtil(e.shape)?.canCrop(e.shape)?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break;case"selection":switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":this.editor.setCurrentTool("select.pointing_rotate_handle",{...e,onInteractionEnd:"select.crop"});break;case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":this.editor.setCurrentTool("select.pointing_crop_handle",{...e,onInteractionEnd:"select.crop"});break;default:this.cancel()}}}};onDoubleClick=e=>{if(this.editor.inputs.shiftKey||"up"!==e.phase)return;let t=this.editor.getCroppingShapeId();if(!t)return;let n=this.editor.getShape(t);if(!n)return;let r=this.editor.getShapeUtil(n);r&&"selection"===e.target&&r.onDoubleClickEdge?.(n)};onKeyDown=()=>{this.nudgeCroppingImage(!1)};onKeyRepeat=()=>{this.nudgeCroppingImage(!0)};onKeyUp=e=>{"Enter"===e.code&&(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{}))};cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}cleanupCroppingState=()=>{this.editor.getCroppingShapeId()||this.editor.setCurrentTool("select.idle",{})};nudgeCroppingImage(e=!1){let{editor:{inputs:{keys:t}}}=this,n=t.has("ShiftLeft"),r=new eh.B(0,0);if(t.has("ArrowLeft")&&(r.x+=1),t.has("ArrowRight")&&(r.x-=1),t.has("ArrowUp")&&(r.y+=1),t.has("ArrowDown")&&(r.y-=1),r.equals(new eh.B(0,0)))return;n&&r.mul(10);let i=this.editor.getShape(this.editor.getCroppingShapeId());if(!i)return;let o=ap(this.editor,i,r);o&&(e||this.editor.mark("translate crop"),this.editor.updateShapes([o]))}}class ag extends rd.n{static id="pointing_crop";onCancel=()=>{this.editor.setCurrentTool("select.crop.idle",{})};onPointerMove=e=>{this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",e)};onPointerUp=e=>{this.editor.setCurrentTool("select.crop.idle",e)}}class am extends rd.n{static id="translating_crop";info={};markId="translating crop";snapshot={};onEnter=e=>{this.info=e,this.snapshot=this.createSnapshot(),this.editor.mark(this.markId),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()};onExit=()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})};onPointerMove=()=>{this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};onKeyDown=e=>{switch(e.key){case"Alt":case"Shift":this.updateShapes();return}};onKeyUp=e=>{switch(e.key){case"Enter":this.complete();return;case"Alt":case"Shift":this.updateShapes()}};complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){let e=this.snapshot.shape;if(!e)return;let{originPagePoint:t,currentPagePoint:n}=this.editor.inputs,r=n.clone().sub(t),i=ap(this.editor,e,r);i&&this.editor.updateShapes([i],{squashing:!0})}}class ay extends rd.n{static id="crop";static initial="idle";static children=()=>[af,am,ag]}let ab={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class aw extends rd.n{static id="pointing_resize_handle";info={};updateCursor(){let e=this.editor.getSelectedShapes(),t=ab[this.info.handle];this.editor.updateInstanceState({cursor:{type:t,rotation:1===e.length?e[0].rotation:0}})}onEnter=e=>{this.info=e,this.updateCursor()};onPointerMove=()=>{this.editor.inputs.isDragging&&this.parent.transition("resizing",this.info)};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}class ax extends rd.n{static id="cropping";info={};markId="";snapshot={};onEnter=e=>{this.info=e,this.markId="cropping",this.editor.mark(this.markId),this.snapshot=this.createSnapshot(),this.updateShapes()};onPointerMove=()=>{this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};updateCursor(){let e=this.editor.getSelectedShapes()[0];if(!e)return;let t=ab[this.info.handle];this.editor.updateInstanceState({cursor:{type:t,rotation:e.rotation}})}getDefaultCrop=()=>({topLeft:{x:0,y:0},bottomRight:{x:1,y:1}});updateShapes(){let{shape:e,cursorHandleOffset:t}=this.snapshot;if(!e||!this.editor.getShapeUtil("image"))return;let n=e.props,r=this.editor.inputs.currentPagePoint.clone().sub(t),i=this.editor.inputs.originPagePoint.clone().sub(t),o=r.clone().sub(i).rot(-e.rotation),s=n.crop??this.getDefaultCrop(),a=(0,M.p$)(s),l=new eh.B(e.x,e.y),c=new eh.B(0,0),u=1/(s.bottomRight.x-s.topLeft.x)*n.w,d=1/(s.bottomRight.y-s.topLeft.y)*n.h,h=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":if(d<8)break;h=!0,a.topLeft.y=a.topLeft.y+o.y/d,d*(a.bottomRight.y-a.topLeft.y)<8?(a.topLeft.y=a.bottomRight.y-8/d,c.y=(a.topLeft.y-s.topLeft.y)*d):a.topLeft.y<=0?(a.topLeft.y=0,c.y=(a.topLeft.y-s.topLeft.y)*d):c.y=o.y;break;case"bottom":case"bottom_left":case"bottom_right":if(d<8)break;h=!0,a.bottomRight.y=Math.min(1,a.bottomRight.y+o.y/d),d*(a.bottomRight.y-a.topLeft.y)<8&&(a.bottomRight.y=a.topLeft.y+8/d)}switch(this.info.handle){case"left":case"top_left":case"bottom_left":if(u<8)break;h=!0,a.topLeft.x=a.topLeft.x+o.x/u,u*(a.bottomRight.x-a.topLeft.x)<8?(a.topLeft.x=a.bottomRight.x-8/u,c.x=(a.topLeft.x-s.topLeft.x)*u):a.topLeft.x<=0?(a.topLeft.x=0,c.x=(a.topLeft.x-s.topLeft.x)*u):c.x=o.x;break;case"right":case"top_right":case"bottom_right":if(u<8)break;h=!0,a.bottomRight.x=Math.min(1,a.bottomRight.x+o.x/u),u*(a.bottomRight.x-a.topLeft.x)<8&&(a.bottomRight.x=a.topLeft.x+8/u)}if(!h)return;l.add(c.rot(e.rotation));let p={id:e.id,type:e.type,x:l.x,y:l.y,props:{crop:a,w:(a.bottomRight.x-a.topLeft.x)*u,h:(a.bottomRight.y-a.topLeft.y)*d}};this.editor.updateShapes([p],{squashing:!0}),this.updateCursor()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))}createSnapshot(){let e=this.editor.getSelectionRotation(),{inputs:{originPagePoint:t}}=this.editor,n=this.editor.getOnlySelectedShape(),r=this.editor.getSelectionRotatedPageBounds(),i=eh.B.RotWith(r.getHandlePoint(this.info.handle),r.point,e);return{shape:n,cursorHandleOffset:eh.B.Sub(t,i)}}}class av extends rd.n{static id="dragging_handle";shapeId="";initialHandle={};initialAdjacentHandle=null;initialPagePoint={};markId="";initialPageTransform;initialPageRotation;info={};isPrecise=!1;isPreciseId=null;pointingId=null;onEnter=e=>{let{shape:t,isCreating:n,handle:r}=e;this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.shapeId=t.id,this.markId=n?`creating:${t.id}`:"dragging handle",n||this.editor.mark(this.markId),this.initialHandle=(0,M.p$)(r),this.initialPageTransform=this.editor.getShapePageTransform(t),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.updateInstanceState({cursor:{type:n?"cross":"grabbing",rotation:0}},{ephemeral:!0});let i=this.editor.getShapeHandles(t).sort(rV.hl),o=i.findIndex(t=>t.id===e.handle.id);this.initialAdjacentHandle=null;for(let t=o+1;t<i.length;t++){let n=i[t];if("vertex"===n.type&&"middle"!==n.id&&n.id!==e.handle.id){this.initialAdjacentHandle=n;break}}if(!this.initialAdjacentHandle)for(let t=i.length-1;t>=0;t--){let n=i[t];if("vertex"===n.type&&"middle"!==n.id&&n.id!==e.handle.id){this.initialAdjacentHandle=n;break}}let s=t.props[e.handle.id];this.isPrecise=!1,s?.type==="binding"?(this.editor.setHintingShapes([s.boundShapeId]),this.isPrecise=s.isPrecise,this.isPrecise?this.isPreciseId=s.boundShapeId:this.resetExactTimeout()):this.editor.setHintingShapes([]),this.update(),this.editor.select(this.shapeId)};exactTimeout=-1;resetExactTimeout(){-1!==this.exactTimeout&&this.clearExactTimeout(),this.exactTimeout=setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){-1!==this.exactTimeout&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}onPointerMove=()=>{this.update()};onKeyDown=()=>{this.update()};onKeyUp=()=>{this.update()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setHintingShapes([]),this.editor.snaps.clear(),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})};complete(){this.editor.snaps.clear();let{onInteractionEnd:e}=this.info;if(this.editor.getInstanceState().isToolLocked&&e){this.editor.setCurrentTool(e,{shapeId:this.shapeId});return}this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clear();let{onInteractionEnd:e}=this.info;if(e){this.editor.setCurrentTool(e,{shapeId:this.shapeId});return}this.parent.transition("idle")}update(){let{editor:e,shapeId:t,initialPagePoint:n}=this,{initialHandle:r,initialPageRotation:i,initialAdjacentHandle:o}=this,s=this.editor.getHintingShapeIds(),a=this.editor.user.getIsSnapMode(),{snaps:l,inputs:{currentPagePoint:c,shiftKey:u,ctrlKey:d,altKey:h,pointerVelocity:p}}=e,f=this.info.shape,g=e.getShape(t);if(!g)return;let m=e.getShapeUtil(g),y=c.clone().sub(n).rot(-i).add(r);if(u&&o&&"middle"!==r.id){let e=eh.B.Angle(o,y),t=(0,eu.nD)(e,24);y=eh.B.RotWith(y,o,t-e)}if(e.snaps.clear(),r.canSnap&&(a?!d:d)){let t=e.getShapePageTransform(g.id);if(!t)throw Error("Expected a page transform");let n=e.getShapeHandles(g).filter(({type:e})=>"vertex"===e).sort(rV.hl).findIndex(({index:e})=>r.index===e),i=m.getOutlineSegments(g).map(e=>tC._.applyToPoints(t,e)).filter((e,t)=>t!==n-1&&t!==n),o=l.getSnappingHandleDelta({additionalSegments:i,handlePoint:tC._.applyToPoint(t,y)});o&&(o.rot(-e.getShapeParentTransform(g).rotation()),y.add(o))}let b=m.onHandleDrag?.(g,{handle:{...r,x:y.x,y:y.y},isPrecise:this.isPrecise||h,initial:f}),w={...g,...b};if(r.canBind){let t=w.props[r.id];t?.type==="binding"?s[0]!==t.boundShapeId&&(e.setHintingShapes([t.boundShapeId]),this.pointingId=t.boundShapeId,this.isPrecise=.5>p.len()||h,this.isPreciseId=this.isPrecise?t.boundShapeId:null,this.resetExactTimeout()):s.length>0&&(e.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}b&&e.updateShapes([w],{squashing:!0})}}class aS extends rd.n{static id="editing_shape";onEnter=()=>{let e=this.editor.getEditingShape();if(!e)throw Error("Entered editing state without an editing shape");i9(this.editor),this.editor.select(e)};onExit=()=>{let{editingShapeId:e}=this.editor.getCurrentPageState();if(!e)return;this.editor.setEditingShape(null);let t=this.editor.getShape(e),n=this.editor.getShapeUtil(t);n.onEditEnd?.(t),setTimeout(()=>{this.editor.updateViewportScreenBounds()},500)};onPointerMove=e=>{switch(e.target){case"shape":case"canvas":i9(this.editor);return}};onPointerDown=e=>{switch(e.target){case"canvas":{let t=ah(this.editor);if(t){this.onPointerDown({...e,shape:t,target:"shape"});return}break}case"shape":{let{shape:t}=e,n=this.editor.getEditingShape();if(!n)throw Error("Expected an editing shape!");if(t.type===n.type){if(this.editor.isShapeOfType(t,"geo")||this.editor.isShapeOfType(t,"arrow")){let r=this.editor.getShapeUtil(t).getGeometry(t).children[1];if(r){let i=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint);if(r.bounds.containsPoint(i)){if(t.id===n.id)return;this.parent.transition("pointing_shape",e);return}}}else{t.id===n.id?this.editor.isShapeOfType(t,"frame")&&this.editor.setEditingShape(null):this.parent.transition("pointing_shape",e);return}}}}this.parent.transition("idle",e),this.editor.root.handleEvent(e)};onComplete=e=>{this.parent.transition("idle",e)};onCancel=e=>{this.parent.transition("idle",e)}}function ak(e){let t=e.getOnlySelectedShape();return!!(t&&!e.isShapeOrAncestorLocked(t)&&e.getShapeUtil(t).canCrop(t))}function a_(e){let t=e.getSelectedShapeIds(),{shiftKey:n,altKey:r,currentPagePoint:i}=e.inputs,o=e.getShapeAtPoint(i,{hitInside:!1,margin:L.wM/e.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:e=>!e.isLocked});if(o){let i=e.getOutermostSelectableShape(o);if(n&&!r)e.cancelDoubleClick(),t.includes(i.id)?(e.mark("deselecting shape"),e.deselect(i)):(e.mark("shift selecting shape"),e.setSelectedShapes([...t,i.id]));else{let n;(n=i===o?o:i.id===e.getFocusedGroupId()||t.includes(i.id)?o:i)&&!t.includes(n.id)&&(e.mark("selecting shape"),e.select(n.id))}}else{if(n)return;{t.length>0&&(e.mark("selecting none"),e.selectNone());let n=e.getFocusedGroupId();if((0,I.YT)(n)){let t=e.getShape(n);e.isPointInShape(t,i,{margin:0,hitInside:!0})||e.setFocusedGroup(null)}}}}class aE extends rd.n{static id="idle";onEnter=()=>{this.parent.setCurrentToolIdMask(void 0),i9(this.editor),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})};onPointerMove=()=>{i9(this.editor)};onPointerDown=e=>{if(this.editor.getIsMenuOpen())return;let t=e.ctrlKey&&ak(this.editor);if(e.ctrlKey&&!t){if("shape"===e.target&&this.isDarwin&&this.editor.inputs.keys.has("ControlLeft")&&!this.editor.isShapeOrAncestorLocked(e.shape)){this.parent.transition("pointing_shape",e);return}this.parent.transition("brushing",e);return}switch(e.target){case"canvas":{let t=ah(this.editor);if(t&&!t.isLocked){this.onPointerDown({...e,shape:t,target:"shape"});return}let n=this.editor.getSelectedShapeIds(),r=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:i}}=this.editor;if((n.length>1||r&&!this.editor.getShapeUtil(r).hideSelectionBoundsBg(r))&&aj(this.editor,i)){this.onPointerDown({...e,target:"selection"});return}this.parent.transition("pointing_canvas",e);break}case"shape":{let{shape:t}=e,n=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint);if(this.editor.isShapeOfType(t,"arrow")){let r=this.editor.getShapeGeometry(t).children[1];if(r&&(0,eu.Of)(n,r.vertices)){this.parent.transition("pointing_arrow_label",e);break}}if(this.editor.isShapeOrAncestorLocked(t)){this.parent.transition("pointing_canvas",e);break}this.parent.transition("pointing_shape",e);break}case"handle":if(this.editor.getInstanceState().isReadonly)break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break;case"selection":switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":this.parent.transition("pointing_rotate_handle",e);break;case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":t?this.parent.transition("pointing_crop_handle",e):this.parent.transition("pointing_resize_handle",e);break;default:{let t=this.editor.getHoveredShape();if(t&&!this.editor.getSelectedShapeIds().includes(t.id)&&!t.isLocked){this.onPointerDown({...e,shape:t,target:"shape"});return}this.parent.transition("pointing_selection",e)}}}};onDoubleClick=e=>{if(!this.editor.inputs.shiftKey&&"up"===e.phase)switch(e.target){case"canvas":{let t=this.editor.getHoveredShape(),n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:L.wM/this.editor.getZoomLevel(),hitInside:!1}),r=this.editor.getFocusedGroupId();if(n){if(this.editor.isShapeOfType(n,"group")){a_(this.editor);return}{let e=this.editor.getShape(n.parentId);if(e&&this.editor.isShapeOfType(e,"group")){if(r&&e.id===r);else{a_(this.editor);return}}}this.onDoubleClick({...e,shape:n,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.getInstanceState().isReadonly)break;let t=this.editor.getOnlySelectedShape();if(t){let n=this.editor.getShapeUtil(t);if(!this.canInteractWithShapeInReadOnly(t))return;if("right"===e.handle||"left"===e.handle||"top"===e.handle||"bottom"===e.handle){let e=n.onDoubleClickEdge?.(t);if(e){this.editor.mark("double click edge"),this.editor.updateShapes([e]);return}}if(n.canCrop(t)&&!this.editor.isShapeOrAncestorLocked(t)){this.parent.transition("crop",e);return}this.shouldStartEditingShape(t)&&this.startEditingShape(t,e)}break}case"shape":{let{shape:t}=e,n=this.editor.getShapeUtil(t);if("video"!==t.type&&"embed"!==t.type&&this.editor.getInstanceState().isReadonly)break;if(n.onDoubleClick){let r=n.onDoubleClick?.(t);if(r){this.editor.updateShapes([r]);return}if(n.canCrop(t)&&!this.editor.isShapeOrAncestorLocked(t)){this.editor.mark("select and crop"),this.editor.select(e.shape?.id),this.parent.transition("crop",e);return}}this.shouldStartEditingShape(t)?this.startEditingShape(t,e):this.handleDoubleClickOnCanvas(e);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;let{shape:t,handle:n}=e,r=this.editor.getShapeUtil(t),i=r.onDoubleClickHandle?.(t,n);i?this.editor.updateShapes([i]):this.shouldStartEditingShape(t)&&this.startEditingShape(t,e)}}};onRightClick=e=>{switch(e.target){case"canvas":{let t=this.editor.getHoveredShape(),n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:L.wM/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitFrameInside:!1,renderingOnly:!0});if(n){this.onRightClick({...e,shape:n,target:"shape"});return}let r=this.editor.getSelectedShapeIds(),i=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:o}}=this.editor;if((r.length>1||i&&!this.editor.getShapeUtil(i).hideSelectionBoundsBg(i))&&aj(this.editor,o)){this.onRightClick({...e,target:"selection"});return}this.editor.selectNone();break}case"shape":{let{selectedShapeIds:t}=this.editor.getCurrentPageState(),{shape:n}=e,r=this.editor.getOutermostSelectableShape(n,e=>!t.includes(e.id));t.includes(r.id)||(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([r.id]))}}};onCancel=()=>{this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.mark("clearing selection"),this.editor.selectNone())};onKeyDown=e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":this.nudgeSelectedShapes(!1)}};onKeyRepeat=e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":this.nudgeSelectedShapes(!0)}};onKeyUp=e=>{if("Enter"===e.code){let t=this.editor.getSelectedShapes();if(t.every(e=>this.editor.isShapeOfType(e,"group"))){this.editor.setSelectedShapes(t.flatMap(e=>this.editor.getSortedChildIdsForParent(e.id)));return}let n=this.editor.getOnlySelectedShape();if(n&&this.shouldStartEditingShape(n)){this.startEditingShape(n,{...e,target:"shape",shape:n});return}ak(this.editor)&&this.parent.transition("crop",e)}};shouldStartEditingShape(e=this.editor.getOnlySelectedShape()){return!(!e||this.editor.isShapeOrAncestorLocked(e)&&"embed"!==e.type)&&!!this.canInteractWithShapeInReadOnly(e)&&this.editor.getShapeUtil(e).canEdit(e)}startEditingShape(e,t){this.editor.isShapeOrAncestorLocked(e)&&"embed"!==e.type||(this.editor.mark("editing shape"),this.editor.setEditingShape(e.id),this.parent.transition("editing_shape",t))}isDarwin=window.navigator.userAgent.toLowerCase().indexOf("mac")>-1;handleDoubleClickOnCanvas(e){if(this.editor.getInstanceState().isReadonly)return;this.editor.mark("creating text shape");let t=(0,I.F1)(),{x:n,y:r}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:t,type:"text",x:n,y:r,props:{text:"",autoSize:!0}}]);let i=this.editor.getShape(t);if(!i)return;let o=this.editor.getShapeUtil(i);(!this.editor.getInstanceState().isReadonly||o.canEditInReadOnly(i))&&(this.editor.setEditingShape(t),this.editor.select(t),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(e=!1){let{editor:{inputs:{keys:t}}}=this,n=t.has("ShiftLeft"),r=new eh.B(0,0);if(t.has("ArrowLeft")&&(r.x-=1),t.has("ArrowRight")&&(r.x+=1),t.has("ArrowUp")&&(r.y-=1),t.has("ArrowDown")&&(r.y+=1),r.equals(new eh.B(0,0)))return;e||this.editor.mark("nudge shapes");let{gridSize:i}=this.editor.getDocumentSettings(),o=this.editor.getInstanceState().isGridMode?n?i*aT:i:n?aC:aP;this.editor.nudgeShapes(this.editor.getSelectedShapeIds(),r.mul(o))}canInteractWithShapeInReadOnly(e){return!!(!this.editor.getInstanceState().isReadonly||this.editor.getShapeUtil(e).canEditInReadOnly(e))}}let aC=10,aP=1,aT=5;function aj(e,t){let n=e.getSelectionRotatedPageBounds();if(!n)return!1;let r=e.getSelectionRotation();return r?(0,eu.Of)(t,n.corners.map(e=>eh.B.RotWith(e,n.point,r))):n.containsPoint(t)}class aI extends rd.n{static id="pointing_arrow_label";shapeId="";markId="";info={};updateCursor(){this.editor.updateInstanceState({cursor:{type:"grabbing",rotation:0}})}onEnter=e=>{let{shape:t}=e;this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.shapeId=t.id,this.updateCursor();let n=this.editor.getShapeGeometry(t).children[1];if(!n)throw Error(`Expected to find an arrow label geometry for shape: ${t.id}`);let{currentPagePoint:r}=this.editor.inputs,i=this.editor.getPointInShapeSpace(t,r);this._labelDragOffset=eh.B.Sub(n.center,i),this.markId="label-drag start",this.editor.mark(this.markId),this.editor.setSelectedShapes([this.shapeId])};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})};_labelDragOffset=new eh.B(0,0);onPointerMove=()=>{let e;let{isDragging:t}=this.editor.inputs;if(!t)return;let n=this.editor.getShape(this.shapeId);if(!n)return;let r=this.editor.getArrowInfo(n),i=this.editor.getShapeGeometry(n),o=i.children[0],s=this.editor.getPointInShapeSpace(n,this.editor.inputs.currentPagePoint),a=o.nearestPoint(eh.B.Add(s,this._labelDragOffset));if(r.isStraight){let t=eh.B.Dist(r.start.point,r.end.point);e=1-eh.B.Dist(r.end.point,a)/t}else{let{_center:t,measure:n,angleEnd:r,angleStart:o}=i.children[0];e=(0,eu.rW)(n,o,r,t.angle(a))}this.editor.updateShape({id:n.id,type:n.type,props:{labelPosition:e}},{squashing:!0})};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}class aM extends rd.n{static id="pointing_canvas";onEnter=()=>{let{inputs:e}=this.editor;!e.shiftKey&&this.editor.getSelectedShapeIds().length>0&&(this.editor.mark("selecting none"),this.editor.selectNone())};onPointerMove=e=>{this.editor.inputs.isDragging&&this.parent.transition("brushing",e)};onPointerUp=()=>{a_(this.editor),this.complete()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.parent.transition("idle")};complete(){this.parent.transition("idle")}}class aA extends rd.n{static id="pointing_crop_handle";info={};updateCursor(e){let t=ab[this.info.handle];this.editor.updateInstanceState({cursor:{type:t,rotation:e.rotation}})}onEnter=e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd);let t=this.editor.getSelectedShapes()[0];t&&(this.updateCursor(t),this.editor.setCroppingShape(t.id))};onExit=()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.parent.setCurrentToolIdMask(void 0)};onPointerMove=()=>{this.editor.inputs.isDragging&&this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})};onPointerUp=()=>{this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))}}class aO extends rd.n{static id="pointing_handle";info={};onEnter=e=>{this.info=e;let t=e.shape.props[e.handle.id];t?.type==="binding"&&this.editor.setHintingShapes([t.boundShapeId]),this.editor.updateInstanceState({cursor:{type:"grabbing",rotation:0}},{ephemeral:!0})};onExit=()=>{this.editor.setHintingShapes([]),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})};onPointerUp=()=>{this.parent.transition("idle",this.info)};onPointerMove=()=>{this.editor.inputs.isDragging&&this.parent.transition("dragging_handle",this.info)};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.parent.transition("idle")}}class a$ extends rd.n{static id="pointing_rotate_handle";info={};updateCursor(){let e=this.editor.getSelectionRotation();this.editor.updateInstanceState({cursor:{type:ab[this.info.handle],rotation:e}})}onEnter=e=>{this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.updateCursor()};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})};onPointerMove=()=>{let{isDragging:e}=this.editor.inputs;e&&this.parent.transition("rotating",this.info)};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}class aB extends rd.n{static id="pointing_selection";info={};onEnter=e=>{this.info=e};onPointerUp=e=>{a_(this.editor),this.parent.transition("idle",e)};onPointerMove=e=>{this.editor.inputs.isDragging&&!this.editor.getInstanceState().isReadonly&&this.parent.transition("translating",e)};onDoubleClick=e=>{let t=this.editor.getHoveredShape(),n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(n){this.parent.transition("idle"),this.parent.onDoubleClick?.({...e,target:"shape",shape:this.editor.getShape(n)});return}};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.parent.transition("idle")}}class aD extends rd.n{static id="pointing_shape";hitShape={};hitShapeForPointerUp={};didSelectOnEnter=!1;onEnter=e=>{let t=this.editor.getSelectedShapeIds(),n=this.editor.getSelectionRotatedPageBounds(),r=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:i,shiftKey:o,altKey:s}}=this.editor;this.hitShape=e.shape;let a=this.editor.getOutermostSelectableShape(e.shape);if(this.editor.getShapeUtil(e.shape).onClick||a.id===r||t.includes(a.id)||this.editor.isAncestorSelected(a.id)||t.length>1&&n?.containsPoint(i)){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=a;return}this.didSelectOnEnter=!0,o&&!s?(this.editor.cancelDoubleClick(),t.includes(a.id)||(this.editor.mark("shift selecting shape"),this.editor.setSelectedShapes([...t,a.id]))):(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([a.id]))};onPointerUp=e=>{let t=this.editor.getSelectedShapeIds(),n=this.editor.getFocusedGroupId(),r=this.editor.getZoomLevel(),{inputs:{currentPagePoint:i,shiftKey:o}}=this.editor,s=this.editor.getShapeAtPoint(i,{margin:L.wM/r,hitInside:!0,renderingOnly:!0})??this.hitShape,a=s?this.editor.getOutermostSelectableShape(s):this.hitShapeForPointerUp;if(a){let r=this.editor.getShapeUtil(a);if(r.onClick){let t=r.onClick?.(a);if(t){this.editor.mark("shape on click"),this.editor.updateShapes([t]),this.parent.transition("idle",e);return}}if(a.id===n){t.length>0?(this.editor.mark("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",e);return}}if(!this.didSelectOnEnter){let e=this.editor.getOutermostSelectableShape(s,e=>!t.includes(e.id));if(t.includes(e.id)){if(o)this.editor.mark("deselecting on pointer up"),this.editor.deselect(a);else if(t.includes(a.id)){if(1===t.length&&(this.editor.isShapeOfType(a,"geo")||this.editor.isShapeOfType(a,"arrow"))){let e=this.editor.getShapeGeometry(a).children[1];if(e){let t=this.editor.getPointInShapeSpace(a,i);if(e.bounds.containsPoint(t,0)&&e.hitTestPoint(t)){this.editor.batch(()=>{this.editor.mark("editing on pointer up"),this.editor.select(a.id);let e=this.editor.getShapeUtil(a);(!this.editor.getInstanceState().isReadonly||e.canEditInReadOnly(a))&&(this.editor.setEditingShape(a.id),this.editor.setCurrentTool("select.editing_shape"))});return}}}this.editor.mark("selecting on pointer up"),this.editor.select(a.id)}else this.editor.mark("selecting on pointer up"),this.editor.select(a)}else if(o){let t=this.editor.getShapeAncestors(e);this.editor.mark("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(e=>!t.find(t=>t.id===e)),e.id])}else this.editor.mark("selecting on pointer up"),this.editor.setSelectedShapes([e.id])}this.parent.transition("idle",e)};onPointerMove=e=>{this.editor.inputs.isDragging&&!this.editor.getInstanceState().isReadonly&&this.parent.transition("translating",e)};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.parent.transition("idle")}}class aL extends rd.n{static id="resizing";info={};markId="";didHoldCommand=!1;creationCursorOffset={x:0,y:0};snapshot={};onEnter=e=>{let{isCreating:t=!1,creationCursorOffset:n={x:0,y:0}}=e;this.info=e,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.creationCursorOffset=n,this.snapshot=this._createSnapshot(),t?(this.markId=`creating:${this.editor.getOnlySelectedShape().id}`,this.editor.updateInstanceState({cursor:{type:"cross",rotation:0}},{ephemeral:!0})):(this.markId="starting resizing",this.editor.mark(this.markId)),this.handleResizeStart(),this.updateShapes()};onTick=()=>{rF(this.editor)};onPointerMove=()=>{this.updateShapes()};onKeyDown=()=>{this.updateShapes()};onKeyUp=()=>{this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){if(this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){this.info.onCreate?.(this.editor.getOnlySelectedShape());return}if(this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle")}handleResizeStart(){let{shapeSnapshots:e}=this.snapshot,t=[];e.forEach(({shape:e})=>{let n=this.editor.getShapeUtil(e),r=n.onResizeStart?.(e);r&&t.push(r)}),t.length>0&&this.editor.updateShapes(t)}handleResizeEnd(){let{shapeSnapshots:e}=this.snapshot,t=[];e.forEach(({shape:e})=>{let n=this.editor.getShape(e.id),r=this.editor.getShapeUtil(e),i=r.onResizeEnd?.(e,n);i&&t.push(i)}),t.length>0&&this.editor.updateShapes(t)}updateShapes(){let{altKey:e,shiftKey:t}=this.editor.inputs,{frames:n,shapeSnapshots:r,selectionBounds:i,cursorHandleOffset:o,selectedShapeIds:s,selectionRotation:a,canShapesDeform:l}=this.snapshot,c=t||!l,{ctrlKey:u}=this.editor.inputs,d=this.editor.inputs.currentPagePoint.clone().sub(o).sub(this.creationCursorOffset),h=this.editor.inputs.originPagePoint.clone().sub(o);if(this.editor.getInstanceState().isGridMode&&!u){let{gridSize:e}=this.editor.getDocumentSettings();d.snapToGrid(e)}let p=this.info.handle,f=az(p,Math.PI);if(this.editor.snaps.clear(),(this.editor.user.getIsSnapMode()?!u:u)&&a%eu.pj==0){let{nudge:t}=this.editor.snaps.snapResize({dragDelta:eh.B.Sub(d,h),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:az(p,a),isAspectRatioLocked:c,isResizingFromCenter:e});d.add(t)}let g=eh.B.RotWith(e?i.center:i.getHandlePoint(f),i.point,a),m=eh.B.Sub(d,g).rot(-a),y=eh.B.Sub(h,g).rot(-a),b=eh.B.DivV(m,y);Number.isFinite(b.x)||(b.x=1),Number.isFinite(b.y)||(b.y=1);let w="top"===p||"bottom"===p,x="left"===p||"right"===p;for(let e of(c?x?b.y=Math.abs(b.x):w?b.x=Math.abs(b.y):Math.abs(b.x)>Math.abs(b.y)?b.y=Math.abs(b.x)*(b.y<0?-1:1):b.x=Math.abs(b.y)*(b.x<0?-1:1):(w&&(b.x=1),x&&(b.y=1)),this.info.isCreating||this.updateCursor({dragHandle:p,isFlippedX:b.x<0,isFlippedY:b.y<0,rotation:a}),r.keys())){let t=r.get(e);this.editor.resizeShape(e,b,{initialShape:t.shape,initialBounds:t.bounds,initialPageTransform:t.pageTransform,dragHandle:p,mode:1===s.length&&e===s[0]?"resize_bounds":"scale_shape",scaleOrigin:g,scaleAxisRotation:a})}if(this.editor.inputs.ctrlKey)for(let{id:e,children:t}of(this.didHoldCommand=!0,n)){if(!t.length)continue;let n=r.get(e).shape,i=this.editor.getShape(e);if(!(n&&i))continue;let o=i.x-n.x,s=i.y-n.y,a=new eh.B(o,s).rot(-n.rotation);if(0!==a.x||0!==a.y)for(let e of t)this.editor.updateShape({id:e.id,type:e.type,x:e.x-a.x,y:e.y-a.y})}else if(this.didHoldCommand){for(let{children:e}of(this.didHoldCommand=!1,n))if(e.length)for(let t of e)this.editor.updateShape({id:t.id,type:t.type,x:t.x,y:t.y})}}updateCursor({dragHandle:e,isFlippedX:t,isFlippedY:n,rotation:r}){let i={...this.editor.getInstanceState().cursor};switch(e){case"top_left":case"bottom_right":i.type="nwse-resize",t!==n&&(i.type="nesw-resize");break;case"top_right":case"bottom_left":i.type="nesw-resize",t!==n&&(i.type="nwse-resize")}i.rotation=r,this.editor.setCursor(i)}onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.editor.snaps.clear()};_createSnapshot=()=>{let e=this.editor.getSelectedShapeIds(),t=this.editor.getSelectionRotation(),{inputs:{originPagePoint:n}}=this.editor,r=this.editor.getSelectionRotatedPageBounds(),i=eh.B.RotWith(r.getHandlePoint(this.info.handle),r.point,t),o=eh.B.Sub(n,i),s=new Map,a=[];e.forEach(t=>{let n=this.editor.getShape(t);if(n){if("frame"===n.type&&a.push({id:t,children:(0,M.oA)(this.editor.getSortedChildIdsForParent(n).map(e=>this.editor.getShape(e)))}),s.set(n.id,this._createShapeSnapshot(n)),this.editor.isShapeOfType(n,"frame")&&1===e.length)return;this.editor.visitDescendants(n.id,e=>{let t=this.editor.getShape(e);if(t&&(s.set(t.id,this._createShapeSnapshot(t)),this.editor.isShapeOfType(t,"frame")))return!1})}});let l=![...s.values()].some(e=>!(0,eu._G)(e.pageRotation,t)||e.isAspectRatioLocked);return{shapeSnapshots:s,selectionBounds:r,cursorHandleOffset:o,selectionRotation:t,selectedShapeIds:e,canShapesDeform:l,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:a}};_createShapeSnapshot=e=>{let t=this.editor.getShapePageTransform(e),n=this.editor.getShapeUtil(e);return{shape:e,bounds:this.editor.getShapeGeometry(e).bounds,pageTransform:t,pageRotation:tC._.Decompose(t).rotation,isAspectRatioLocked:n.isAspectRatioLocked(e)}}}let aR=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function az(e,t){let n=Math.round((t%=eu.yo)/(eu.PI/4)),r=aR.indexOf(e);return aR[(r+n)%aR.length]}let aN=Math.PI/180;class aF extends rd.n{static id="rotating";snapshot={};info={};markId="";onEnter=e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.markId="rotate start",this.editor.mark(this.markId);let t=(0,rH.o)({editor:this.editor});if(!t)return this.parent.transition("idle",this.info);this.snapshot=t,this.handleStart()};onExit=()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}};onPointerMove=()=>{this.update()};onKeyDown=()=>{this.update()};onKeyUp=()=>{this.update()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};update=()=>{let e=this._getRotationFromPointerPosition({snapToNearestDegree:!1});(0,rH.Z)({editor:this.editor,delta:e,snapshot:this.snapshot,stage:"update"}),this.editor.updateInstanceState({cursor:{type:ab[this.info.handle],rotation:e+this.snapshot.initialSelectionRotation}})};cancel=()=>{this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)};complete=()=>{(0,rH.Z)({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)};handleStart(){let e=this._getRotationFromPointerPosition({snapToNearestDegree:!1});(0,rH.Z)({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.updateInstanceState({cursor:{type:ab[this.info.handle],rotation:e+this.snapshot.initialSelectionRotation}})}_getRotationFromPointerPosition({snapToNearestDegree:e}){let t=this.editor.getSelectionRotation(),n=this.editor.getSelectionRotatedPageBounds(),{inputs:{shiftKey:r,currentPagePoint:i}}=this.editor,{initialCursorAngle:o,initialSelectionRotation:s}=this.snapshot;if(!n)return s;let a=s+(n.center.clone().rotWith(n.point,t).angle(i)-o);if(r)a=(0,eu.nD)(a,24);else if(e&&(a=Math.round(a/aN)*aN,this.editor.getInstanceState().isCoarsePointer)){let e=(0,eu.nD)(a,4);Math.abs((0,eu.Z7)(a,e))<(0,eu.Ht)(5)&&(a=e)}return a-s}}class aU extends rd.n{static id="scribble_brushing";hits=new Set;size=0;scribbleId="id";initialSelectedShapeIds=new Set;newlySelectedShapeIds=new Set;onEnter=()=>{this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();let e=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=e.id,this.updateScribbleSelection(!0),requestAnimationFrame(()=>{this.editor.updateInstanceState({brush:null})})};onExit=()=>{this.editor.scribbles.stop(this.scribbleId)};onPointerMove=()=>{this.updateScribbleSelection(!0)};onPointerUp=()=>{this.complete()};onKeyDown=()=>{this.updateScribbleSelection(!1)};onKeyUp=()=>{this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};pushPointToScribble=()=>{let{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)};updateScribbleSelection(e){let t,n,r,i;let o=this.editor.getZoomLevel(),s=this.editor.getCurrentPageShapes(),{inputs:{shiftKey:a,originPagePoint:l,previousPagePoint:c,currentPagePoint:u}}=this.editor,{newlySelectedShapeIds:d,initialSelectedShapeIds:h}=this;e&&this.pushPointToScribble();for(let e=0,a=s.length;e<a;e++)if(t=s[e],n=this.editor.getShapeGeometry(t),!(this.editor.isShapeOfType(t,"group")||d.has(t.id)||this.editor.isShapeOrAncestorLocked(t))){if(this.editor.isShapeOfType(t,"frame")){let e=this.editor.getPointInShapeSpace(t,l);if(n.bounds.containsPoint(e))continue}if(r=this.editor.getPointInShapeSpace(t,c),i=this.editor.getPointInShapeSpace(t,u),n.hitTestLineSegment(r,i,L.wM/o)){let e=this.editor.getOutermostSelectableShape(t),n=this.editor.getShapeMask(e.id);if(n&&null!==(0,r_.Gc)(c,u,n)&&!(0,eu.Of)(u,n))continue;d.add(e.id)}}this.editor.setSelectedShapes([...new Set(a?[...d,...h]:[...d])],{squashing:!0})}complete(){this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds],{squashing:!0}),this.parent.transition("idle")}}class aV{constructor(e){this.editor=e,e.disposables.add(this.dispose)}prevDroppingShapeId=null;droppingNodeTimer=null;first=!0;updateDroppingNode(e,t){this.first&&(this.prevDroppingShapeId=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,e)?.id??null,this.first=!1),null===this.droppingNodeTimer?this.setDragTimer(e,1e3,t):this.editor.inputs.pointerVelocity.len()>.5&&(clearInterval(this.droppingNodeTimer),this.setDragTimer(e,100,t))}setDragTimer(e,t,n){this.droppingNodeTimer=setTimeout(()=>{this.editor.batch(()=>{this.handleDrag(this.editor.inputs.currentPagePoint,e,n)}),this.droppingNodeTimer=null},t)}handleDrag(e,t,n){t=(0,M.oA)(t.map(e=>this.editor.getShape(e.id)));let r=this.editor.getDroppingOverShape(e,t)?.id??null;if(r===this.prevDroppingShapeId)return;let{prevDroppingShapeId:i}=this,o=i&&this.editor.getShape(i),s=r&&this.editor.getShape(r);if(o&&this.editor.getShapeUtil(o).onDragShapesOut?.(o,t),s){let e=this.editor.getShapeUtil(s).onDragShapesOver?.(s,t);e&&e.shouldHint&&this.editor.setHintingShapes([s.id])}else this.editor.setHintingShapes([]);n?.(),this.prevDroppingShapeId=r}dropShapes(e){let{prevDroppingShapeId:t}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,e),t){let n=this.editor.getShape(t);if(!n)return;this.editor.getShapeUtil(n).onDropShapesOver?.(n,e)}}clear(){this.prevDroppingShapeId=null,null!==this.droppingNodeTimer&&clearInterval(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}dispose=()=>{this.clear()}}class aH extends rd.n{static id="translating";info={};selectionSnapshot={};snapshot={};markId="";isCloning=!1;isCreating=!1;onCreate=()=>void 0;dragAndDropManager=new aV(this.editor);onEnter=e=>{let{isCreating:t=!1,onCreate:n=()=>void 0}=e;if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.isCreating=t,this.onCreate=n,t?this.markId=`creating:${this.editor.getOnlySelectedShape().id}`:(this.markId="translating",this.editor.mark(this.markId)),this.isCloning=!1,this.info=e,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=aZ(this.editor),!this.isCreating&&this.editor.inputs.altKey){this.startCloning();return}this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clear(),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.dragAndDropManager.clear()};onTick=()=>{this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),rF(this.editor)};onPointerMove=()=>{this.updateShapes()};onKeyDown=()=>{if(this.editor.inputs.altKey&&!this.isCloning){this.startCloning();return}this.updateShapes()};onKeyUp=()=>{if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=aZ(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?this.onCreate?.(this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){let{movingShapes:e}=this.snapshot,t=[];e.forEach(e=>{let n=this.editor.getShapeUtil(e),r=n.onTranslateStart?.(e);r&&t.push(r)}),t.length>0&&this.editor.updateShapes(t),this.editor.setHoveredShape(null)}handleEnd(){let{movingShapes:e}=this.snapshot;if(this.isCloning){let t=eh.B.Average(e.map(e=>this.editor.getShapePageTransform(e.id).point())),n=eh.B.Sub(t,this.selectionSnapshot.averagePagePoint);this.editor.updateInstanceState({duplicateProps:{shapeIds:e.map(e=>e.id),offset:{x:n.x,y:n.y}}})}let t=[];e.forEach(e=>{let n=this.editor.getShape(e.id),r=this.editor.getShapeUtil(e),i=r.onTranslateEnd?.(e,n);i&&t.push(i)}),t.length>0&&this.editor.updateShapes(t)}handleChange(){let{movingShapes:e}=this.snapshot,t=[];e.forEach(e=>{let n=this.editor.getShape(e.id),r=this.editor.getShapeUtil(e),i=r.onTranslate?.(e,n);i&&t.push(i)}),t.length>0&&this.editor.updateShapes(t)}updateShapes(){let{snapshot:e}=this;this.dragAndDropManager.updateDroppingNode(e.movingShapes,this.updateParentTransforms),function({editor:e,shapeSnapshots:t,averagePagePoint:n,initialSelectionPageBounds:r,initialSelectionSnapPoints:i}){let{inputs:o}=e,s=e.getInstanceState().isGridMode,a=e.getDocumentSettings().gridSize,l=eh.B.Sub(o.currentPagePoint,o.originPagePoint),c=e.inputs.shiftKey?Math.abs(l.x)<Math.abs(l.y)?"x":"y":null;if("x"===c?l.x=0:"y"===c&&(l.y=0),e.snaps.clear(),(e.user.getIsSnapMode()?!o.ctrlKey:o.ctrlKey)&&.5>e.inputs.pointerVelocity.len()){let{nudge:t}=e.snaps.snapTranslate({dragDelta:l,initialSelectionPageBounds:r,lockedAxis:c,initialSelectionSnapPoints:i});l.add(t)}let u=eh.B.Add(n,l);s&&!o.ctrlKey&&u.snapToGrid(a);let d=eh.B.Sub(u,n);e.updateShapes((0,M.oA)(t.map(({shape:e,pagePoint:t,parentTransform:n})=>{let r=eh.B.Add(t,d),i=n?tC._.applyToPoint(n,r):r;return{id:e.id,type:e.type,x:i.x,y:i.y}})),{squashing:!0})}({editor:this.editor,shapeSnapshots:e.shapeSnapshots,averagePagePoint:e.averagePagePoint,initialSelectionPageBounds:e.initialPageBounds,initialSelectionSnapPoints:e.initialSnapPoints}),this.handleChange()}updateParentTransforms=()=>{let{editor:e,snapshot:{shapeSnapshots:t}}=this,n=[];t.forEach(t=>{let r=e.getShape(t.shape.id);if(!r)return null;n.push(r);let i=(0,I.r5)(r.parentId)?null:tC._.Inverse(e.getShapePageTransform(r.parentId));t.parentTransform=i})}}function aZ(e){let t=[],n=[],r=(0,M.oA)(e.getSelectedShapeIds().map(r=>{let i=e.getShape(r);if(!i)return null;t.push(i);let o=e.getShapePageTransform(r).point();if(!o)return null;n.push(o);let s=I.ez.isId(i.parentId)?null:tC._.Inverse(e.getShapePageTransform(i.parentId));return{shape:i,pagePoint:o,parentTransform:s}})),i=[];if(1===e.getSelectedShapeIds().length)i=e.snaps.getSnapPointsCache().get(e.getSelectedShapeIds()[0]);else{let t=e.getSelectionPageBounds();t&&(i=t.snapPoints.map((e,t)=>({id:"selection:"+t,x:e.x,y:e.y})))}return{averagePagePoint:eh.B.Average(n),movingShapes:t,shapeSnapshots:r,initialPageBounds:e.getSelectionPageBounds(),initialSnapPoints:i}}n(357);class aK extends rd.n{static id="select";static initial="idle";reactor=void 0;static children=()=>[ay,ax,aE,aM,aD,aH,ad,aU,aA,aB,aw,aS,aL,aF,a$,aI,aO,av];cleanUpDuplicateProps=()=>{let e=this.editor.getSelectedShapeIds(),t=this.editor.getInstanceState();if(!t.duplicateProps)return;let n=new Set(t.duplicateProps.shapeIds);e.length===n.size&&e.every(e=>n.has(e))||this.editor.updateInstanceState({duplicateProps:null})};onEnter=()=>{this.reactor=(0,T.Ym)("clean duplicate props",()=>{try{this.cleanUpDuplicateProps()}catch(e){console.error(e)}})};onExit=()=>{this.reactor?.(),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)}}class aW extends rd.n{static id="idle";info={};onEnter=e=>{this.info=e};onPointerDown=()=>{this.parent.transition("pointing",this.info)}}class aY extends rd.n{static id="pointing";info={};onEnter=e=>{this.info=e};onPointerUp=()=>{this.complete()};onPointerMove=()=>{this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)};onCancel=()=>{this.cancel()};complete(){let{currentScreenPoint:e}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(e,{duration:220}):this.editor.zoomIn(e,{duration:220}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}class aG extends rd.n{static id="zoom_brushing";info={};zoomBrush=new rS.xu;onEnter=e=>{this.info=e,this.update()};onExit=()=>{this.editor.updateInstanceState({zoomBrush:null})};onPointerMove=()=>{this.update()};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};update(){let{inputs:{originPagePoint:e,currentPagePoint:t}}=this.editor;this.zoomBrush.setTo(rS.xu.FromPoints([e,t])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){let{zoomBrush:e}=this,t=8/this.editor.getZoomLevel();if(e.width<t&&e.height<t){let e=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(e,{duration:220}):this.editor.zoomIn(e,{duration:220})}else{let t=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(e,t,{duration:220})}this.parent.transition("idle",this.info)}}class aX extends rd.n{static id="zoom";static initial="idle";static children=()=>[aW,aG,aY];info={};onEnter=e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.updateCursor()};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.parent.setCurrentToolIdMask(void 0)};onKeyDown=()=>{this.updateCursor()};onKeyUp=e=>{this.updateCursor(),"KeyZ"===e.code&&this.complete()};onInterrupt=()=>{this.complete()};complete(){this.info.onInteractionEnd&&"select"!==this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.updateInstanceState({cursor:{type:"zoom-out",rotation:0}},{ephemeral:!0}):this.editor.updateInstanceState({cursor:{type:"zoom-in",rotation:0}},{ephemeral:!0})}}let aq=[ar,aa,au,aX,aK];function aJ(){return(aJ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var aQ=n(4887);function a0(e,t,{checkForDefaultPrevented:n=!0}={}){return function(r){if(null==e||e(r),!1===n||!r.defaultPrevented)return null==t?void 0:t(r)}}function a1(...e){return t=>e.forEach(e=>{"function"==typeof e?e(t):null!=e&&(e.current=t)})}function a2(...e){return(0,$.useCallback)(a1(...e),e)}function a5(e,t=[]){let n=[],r=()=>{let t=n.map(e=>(0,$.createContext)(e));return function(n){let r=(null==n?void 0:n[e])||t;return(0,$.useMemo)(()=>({[`__scope${e}`]:{...n,[e]:r}}),[n,r])}};return r.scopeName=e,[function(t,r){let i=(0,$.createContext)(r),o=n.length;function s(t){let{scope:n,children:r,...s}=t,a=(null==n?void 0:n[e][o])||i,l=(0,$.useMemo)(()=>s,Object.values(s));return(0,$.createElement)(a.Provider,{value:l},r)}return n=[...n,r],s.displayName=t+"Provider",[s,function(n,s){let a=(null==s?void 0:s[e][o])||i,l=(0,$.useContext)(a);if(l)return l;if(void 0!==r)return r;throw Error(`\`${n}\` must be used within \`${t}\``)}]},function(...e){let t=e[0];if(1===e.length)return t;let n=()=>{let n=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let r=n.reduce((t,{useScope:n,scopeName:r})=>{let i=n(e)[`__scope${r}`];return{...t,...i}},{});return(0,$.useMemo)(()=>({[`__scope${t.scopeName}`]:r}),[r])}};return n.scopeName=t.scopeName,n}(r,...t)]}let a3=(0,$.forwardRef)((e,t)=>{let{children:n,...r}=e,i=$.Children.toArray(n),o=i.find(a6);if(o){let e=o.props.children,n=i.map(t=>t!==o?t:$.Children.count(e)>1?$.Children.only(null):(0,$.isValidElement)(e)?e.props.children:null);return(0,$.createElement)(a8,aJ({},r,{ref:t}),(0,$.isValidElement)(e)?(0,$.cloneElement)(e,void 0,n):null)}return(0,$.createElement)(a8,aJ({},r,{ref:t}),n)});a3.displayName="Slot";let a8=(0,$.forwardRef)((e,t)=>{let{children:n,...r}=e;return(0,$.isValidElement)(n)?(0,$.cloneElement)(n,{...function(e,t){let n={...t};for(let r in t){let i=e[r],o=t[r];/^on[A-Z]/.test(r)?i&&o?n[r]=(...e)=>{o(...e),i(...e)}:i&&(n[r]=i):"style"===r?n[r]={...i,...o}:"className"===r&&(n[r]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}(r,n.props),ref:t?a1(t,n.ref):n.ref}):$.Children.count(n)>1?$.Children.only(null):null});a8.displayName="SlotClone";let a4=({children:e})=>(0,$.createElement)($.Fragment,null,e);function a6(e){return(0,$.isValidElement)(e)&&e.type===a4}function a9(e){let t=e+"CollectionProvider",[n,r]=a5(t),[i,o]=n(t,{collectionRef:{current:null},itemMap:new Map}),s=e+"CollectionSlot",a=$.forwardRef((e,t)=>{let{scope:n,children:r}=e,i=a2(t,o(s,n).collectionRef);return $.createElement(a3,{ref:i},r)}),l=e+"CollectionItemSlot",c="data-radix-collection-item";return[{Provider:e=>{let{scope:t,children:n}=e,r=$.useRef(null),o=$.useRef(new Map).current;return $.createElement(i,{scope:t,itemMap:o,collectionRef:r},n)},Slot:a,ItemSlot:$.forwardRef((e,t)=>{let{scope:n,children:r,...i}=e,s=$.useRef(null),a=a2(t,s),u=o(l,n);return $.useEffect(()=>(u.itemMap.set(s,{ref:s,...i}),()=>void u.itemMap.delete(s))),$.createElement(a3,{[c]:"",ref:a},r)})},function(t){let n=o(e+"CollectionConsumer",t);return $.useCallback(()=>{let e=n.collectionRef.current;if(!e)return[];let t=Array.from(e.querySelectorAll(`[${c}]`));return Array.from(n.itemMap.values()).sort((e,n)=>t.indexOf(e.ref.current)-t.indexOf(n.ref.current))},[n.collectionRef,n.itemMap])},r]}let a7=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce((e,t)=>{let n=(0,$.forwardRef)((e,n)=>{let{asChild:r,...i}=e,o=r?a3:t;return(0,$.useEffect)(()=>{window[Symbol.for("radix-ui")]=!0},[]),(0,$.createElement)(o,aJ({},i,{ref:n}))});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function le(e,t){e&&(0,aQ.flushSync)(()=>e.dispatchEvent(t))}function lt(e){let t=(0,$.useRef)(e);return(0,$.useEffect)(()=>{t.current=e}),(0,$.useMemo)(()=>(...e)=>{var n;return null===(n=t.current)||void 0===n?void 0:n.call(t,...e)},[])}let ln="dismissableLayer.update",lr=(0,$.createContext)({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),li=(0,$.forwardRef)((e,t)=>{var n;let{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:i,onPointerDownOutside:s,onFocusOutside:a,onInteractOutside:l,onDismiss:c,...u}=e,d=(0,$.useContext)(lr),[h,p]=(0,$.useState)(null),f=null!==(n=null==h?void 0:h.ownerDocument)&&void 0!==n?n:null==globalThis?void 0:globalThis.document,[,g]=(0,$.useState)({}),m=a2(t,e=>p(e)),y=Array.from(d.layers),[b]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),w=y.indexOf(b),x=h?y.indexOf(h):-1,v=d.layersWithOutsidePointerEventsDisabled.size>0,S=x>=w,k=function(e,t=null==globalThis?void 0:globalThis.document){let n=lt(e),r=(0,$.useRef)(!1),i=(0,$.useRef)(()=>{});return(0,$.useEffect)(()=>{let e=e=>{if(e.target&&!r.current){let r={originalEvent:e};function o(){la("dismissableLayer.pointerDownOutside",n,r,{discrete:!0})}"touch"===e.pointerType?(t.removeEventListener("click",i.current),i.current=o,t.addEventListener("click",i.current,{once:!0})):o()}else t.removeEventListener("click",i.current);r.current=!1},o=window.setTimeout(()=>{t.addEventListener("pointerdown",e)},0);return()=>{window.clearTimeout(o),t.removeEventListener("pointerdown",e),t.removeEventListener("click",i.current)}},[t,n]),{onPointerDownCapture:()=>r.current=!0}}(e=>{let t=e.target,n=[...d.branches].some(e=>e.contains(t));!S||n||(null==s||s(e),null==l||l(e),e.defaultPrevented||null==c||c())},f),_=function(e,t=null==globalThis?void 0:globalThis.document){let n=lt(e),r=(0,$.useRef)(!1);return(0,$.useEffect)(()=>{let e=e=>{e.target&&!r.current&&la("dismissableLayer.focusOutside",n,{originalEvent:e},{discrete:!1})};return t.addEventListener("focusin",e),()=>t.removeEventListener("focusin",e)},[t,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}(e=>{let t=e.target;[...d.branches].some(e=>e.contains(t))||(null==a||a(e),null==l||l(e),e.defaultPrevented||null==c||c())},f);return!function(e,t=null==globalThis?void 0:globalThis.document){let n=lt(e);(0,$.useEffect)(()=>{let e=e=>{"Escape"===e.key&&n(e)};return t.addEventListener("keydown",e),()=>t.removeEventListener("keydown",e)},[n,t])}(e=>{x!==d.layers.size-1||(null==i||i(e),!e.defaultPrevented&&c&&(e.preventDefault(),c()))},f),(0,$.useEffect)(()=>{if(h)return r&&(0===d.layersWithOutsidePointerEventsDisabled.size&&(o=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(h)),d.layers.add(h),ls(),()=>{r&&1===d.layersWithOutsidePointerEventsDisabled.size&&(f.body.style.pointerEvents=o)}},[h,f,r,d]),(0,$.useEffect)(()=>()=>{h&&(d.layers.delete(h),d.layersWithOutsidePointerEventsDisabled.delete(h),ls())},[h,d]),(0,$.useEffect)(()=>{let e=()=>g({});return document.addEventListener(ln,e),()=>document.removeEventListener(ln,e)},[]),(0,$.createElement)(a7.div,aJ({},u,{ref:m,style:{pointerEvents:v?S?"auto":"none":void 0,...e.style},onFocusCapture:a0(e.onFocusCapture,_.onFocusCapture),onBlurCapture:a0(e.onBlurCapture,_.onBlurCapture),onPointerDownCapture:a0(e.onPointerDownCapture,k.onPointerDownCapture)}))}),lo=(0,$.forwardRef)((e,t)=>{let n=(0,$.useContext)(lr),r=(0,$.useRef)(null),i=a2(t,r);return(0,$.useEffect)(()=>{let e=r.current;if(e)return n.branches.add(e),()=>{n.branches.delete(e)}},[n.branches]),(0,$.createElement)(a7.div,aJ({},e,{ref:i}))});function ls(){let e=new CustomEvent(ln);document.dispatchEvent(e)}function la(e,t,n,{discrete:r}){let i=n.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&i.addEventListener(e,t,{once:!0}),r?le(i,o):i.dispatchEvent(o)}let ll=(0,$.forwardRef)((e,t)=>{var n;let{container:r=null==globalThis?void 0:null===(n=globalThis.document)||void 0===n?void 0:n.body,...i}=e;return r?aQ.createPortal((0,$.createElement)(a7.div,aJ({},i,{ref:t})),r):null}),lc=(null==globalThis?void 0:globalThis.document)?$.useLayoutEffect:()=>{},lu=e=>{let{present:t,children:n}=e,r=function(e){var t,n;let[r,i]=(0,$.useState)(),o=(0,$.useRef)({}),s=(0,$.useRef)(e),a=(0,$.useRef)("none"),[l,c]=(t=e?"mounted":"unmounted",n={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},(0,$.useReducer)((e,t)=>{let r=n[e][t];return null!=r?r:e},t));return(0,$.useEffect)(()=>{let e=ld(o.current);a.current="mounted"===l?e:"none"},[l]),lc(()=>{let t=o.current,n=s.current;if(n!==e){let r=a.current,i=ld(t);e?c("MOUNT"):"none"===i||(null==t?void 0:t.display)==="none"?c("UNMOUNT"):n&&r!==i?c("ANIMATION_OUT"):c("UNMOUNT"),s.current=e}},[e,c]),lc(()=>{if(r){let e=e=>{let t=ld(o.current).includes(e.animationName);e.target===r&&t&&(0,aQ.flushSync)(()=>c("ANIMATION_END"))},t=e=>{e.target===r&&(a.current=ld(o.current))};return r.addEventListener("animationstart",t),r.addEventListener("animationcancel",e),r.addEventListener("animationend",e),()=>{r.removeEventListener("animationstart",t),r.removeEventListener("animationcancel",e),r.removeEventListener("animationend",e)}}c("ANIMATION_END")},[r,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:(0,$.useCallback)(e=>{e&&(o.current=getComputedStyle(e)),i(e)},[])}}(t),i="function"==typeof n?n({present:r.isPresent}):$.Children.only(n),o=a2(r.ref,i.ref);return"function"==typeof n||r.isPresent?(0,$.cloneElement)(i,{ref:o}):null};function ld(e){return(null==e?void 0:e.animationName)||"none"}function lh({prop:e,defaultProp:t,onChange:n=()=>{}}){let[r,i]=function({defaultProp:e,onChange:t}){let n=(0,$.useState)(e),[r]=n,i=(0,$.useRef)(r),o=lt(t);return(0,$.useEffect)(()=>{i.current!==r&&(o(r),i.current=r)},[r,i,o]),n}({defaultProp:t,onChange:n}),o=void 0!==e,s=o?e:r,a=lt(n);return[s,(0,$.useCallback)(t=>{if(o){let n="function"==typeof t?t(e):t;n!==e&&a(n)}else i(t)},[o,e,i,a])]}lu.displayName="Presence";let lp=(0,$.forwardRef)((e,t)=>(0,$.createElement)(a7.span,aJ({},e,{ref:t,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...e.style}}))),lf="ToastProvider",[lg,lm,ly]=a9("Toast"),[lb,lw]=a5("Toast",[ly]),[lx,lv]=lb(lf),lS=e=>{let{__scopeToast:t,label:n="Notification",duration:r=5e3,swipeDirection:i="right",swipeThreshold:o=50,children:s}=e,[a,l]=(0,$.useState)(null),[c,u]=(0,$.useState)(0),d=(0,$.useRef)(!1),h=(0,$.useRef)(!1);return(0,$.createElement)(lg.Provider,{scope:t},(0,$.createElement)(lx,{scope:t,label:n,duration:r,swipeDirection:i,swipeThreshold:o,toastCount:c,viewport:a,onViewportChange:l,onToastAdd:(0,$.useCallback)(()=>u(e=>e+1),[]),onToastRemove:(0,$.useCallback)(()=>u(e=>e-1),[]),isFocusedToastEscapeKeyDownRef:d,isClosePausedRef:h},s))};lS.propTypes={label:e=>e.label&&"string"==typeof e.label&&!e.label.trim()?Error(`Invalid prop \`label\` supplied to \`${lf}\`. Expected non-empty \`string\`.`):null};let lk=["F8"],l_="toast.viewportPause",lE="toast.viewportResume",lC=(0,$.forwardRef)((e,t)=>{let{__scopeToast:n,hotkey:r=lk,label:i="Notifications ({hotkey})",...o}=e,s=lv("ToastViewport",n),a=lm(n),l=(0,$.useRef)(null),c=(0,$.useRef)(null),u=(0,$.useRef)(null),d=(0,$.useRef)(null),h=a2(t,d,s.onViewportChange),p=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),f=s.toastCount>0;(0,$.useEffect)(()=>{let e=e=>{var t;r.every(t=>e[t]||e.code===t)&&(null===(t=d.current)||void 0===t||t.focus())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[r]),(0,$.useEffect)(()=>{let e=l.current,t=d.current;if(f&&e&&t){let n=()=>{if(!s.isClosePausedRef.current){let e=new CustomEvent(l_);t.dispatchEvent(e),s.isClosePausedRef.current=!0}},r=()=>{if(s.isClosePausedRef.current){let e=new CustomEvent(lE);t.dispatchEvent(e),s.isClosePausedRef.current=!1}},i=t=>{e.contains(t.relatedTarget)||r()},o=()=>{e.contains(document.activeElement)||r()};return e.addEventListener("focusin",n),e.addEventListener("focusout",i),e.addEventListener("pointermove",n),e.addEventListener("pointerleave",o),window.addEventListener("blur",n),window.addEventListener("focus",r),()=>{e.removeEventListener("focusin",n),e.removeEventListener("focusout",i),e.removeEventListener("pointermove",n),e.removeEventListener("pointerleave",o),window.removeEventListener("blur",n),window.removeEventListener("focus",r)}}},[f,s.isClosePausedRef]);let g=(0,$.useCallback)(({tabbingDirection:e})=>{let t=a().map(t=>{let n=t.ref.current,r=[n,...function(e){let t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{let t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}(n)];return"forwards"===e?r:r.reverse()});return("forwards"===e?t.reverse():t).flat()},[a]);return(0,$.useEffect)(()=>{let e=d.current;if(e){let t=t=>{let n=t.altKey||t.ctrlKey||t.metaKey;if("Tab"===t.key&&!n){var r,i,o;let n=document.activeElement,s=t.shiftKey;if(t.target===e&&s){null===(r=c.current)||void 0===r||r.focus();return}let a=g({tabbingDirection:s?"backwards":"forwards"}),l=a.findIndex(e=>e===n);lF(a.slice(l+1))?t.preventDefault():s?null===(i=c.current)||void 0===i||i.focus():null===(o=u.current)||void 0===o||o.focus()}};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)}},[a,g]),(0,$.createElement)(lo,{ref:l,role:"region","aria-label":i.replace("{hotkey}",p),tabIndex:-1,style:{pointerEvents:f?void 0:"none"}},f&&(0,$.createElement)(lP,{ref:c,onFocusFromOutsideViewport:()=>{lF(g({tabbingDirection:"forwards"}))}}),(0,$.createElement)(lg.Slot,{scope:n},(0,$.createElement)(a7.ol,aJ({tabIndex:-1},o,{ref:h}))),f&&(0,$.createElement)(lP,{ref:u,onFocusFromOutsideViewport:()=>{lF(g({tabbingDirection:"backwards"}))}}))}),lP=(0,$.forwardRef)((e,t)=>{let{__scopeToast:n,onFocusFromOutsideViewport:r,...i}=e,o=lv("ToastFocusProxy",n);return(0,$.createElement)(lp,aJ({"aria-hidden":!0,tabIndex:0},i,{ref:t,style:{position:"fixed"},onFocus:e=>{var t;let n=e.relatedTarget;null!==(t=o.viewport)&&void 0!==t&&t.contains(n)||r()}}))}),lT="Toast",lj=(0,$.forwardRef)((e,t)=>{let{forceMount:n,open:r,defaultOpen:i,onOpenChange:o,...s}=e,[a=!0,l]=lh({prop:r,defaultProp:i,onChange:o});return(0,$.createElement)(lu,{present:n||a},(0,$.createElement)(lA,aJ({open:a},s,{ref:t,onClose:()=>l(!1),onPause:lt(e.onPause),onResume:lt(e.onResume),onSwipeStart:a0(e.onSwipeStart,e=>{e.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:a0(e.onSwipeMove,e=>{let{x:t,y:n}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","move"),e.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${n}px`)}),onSwipeCancel:a0(e.onSwipeCancel,e=>{e.currentTarget.setAttribute("data-swipe","cancel"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:a0(e.onSwipeEnd,e=>{let{x:t,y:n}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","end"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${n}px`),l(!1)})})))}),[lI,lM]=lb(lT,{onClose(){}}),lA=(0,$.forwardRef)((e,t)=>{let{__scopeToast:n,type:r="foreground",duration:i,open:o,onClose:s,onEscapeKeyDown:a,onPause:l,onResume:c,onSwipeStart:u,onSwipeMove:d,onSwipeCancel:h,onSwipeEnd:p,...f}=e,g=lv(lT,n),[m,y]=(0,$.useState)(null),b=a2(t,e=>y(e)),w=(0,$.useRef)(null),x=(0,$.useRef)(null),v=i||g.duration,S=(0,$.useRef)(0),k=(0,$.useRef)(v),_=(0,$.useRef)(0),{onToastAdd:E,onToastRemove:C}=g,P=lt(()=>{var e;(null==m?void 0:m.contains(document.activeElement))&&(null===(e=g.viewport)||void 0===e||e.focus()),s()}),T=(0,$.useCallback)(e=>{e&&e!==1/0&&(window.clearTimeout(_.current),S.current=new Date().getTime(),_.current=window.setTimeout(P,e))},[P]);(0,$.useEffect)(()=>{let e=g.viewport;if(e){let t=()=>{T(k.current),null==c||c()},n=()=>{let e=new Date().getTime()-S.current;k.current=k.current-e,window.clearTimeout(_.current),null==l||l()};return e.addEventListener(l_,n),e.addEventListener(lE,t),()=>{e.removeEventListener(l_,n),e.removeEventListener(lE,t)}}},[g.viewport,v,l,c,T]),(0,$.useEffect)(()=>{o&&!g.isClosePausedRef.current&&T(v)},[o,v,g.isClosePausedRef,T]),(0,$.useEffect)(()=>(E(),()=>C()),[E,C]);let j=(0,$.useMemo)(()=>m?function e(t){let n=[];return Array.from(t.childNodes).forEach(t=>{if(t.nodeType===t.TEXT_NODE&&t.textContent&&n.push(t.textContent),t.nodeType===t.ELEMENT_NODE){let r=t.ariaHidden||t.hidden||"none"===t.style.display,i=""===t.dataset.radixToastAnnounceExclude;if(!r){if(i){let e=t.dataset.radixToastAnnounceAlt;e&&n.push(e)}else n.push(...e(t))}}}),n}(m):null,[m]);return g.viewport?(0,$.createElement)($.Fragment,null,j&&(0,$.createElement)(lO,{__scopeToast:n,role:"status","aria-live":"foreground"===r?"assertive":"polite","aria-atomic":!0},j),(0,$.createElement)(lI,{scope:n,onClose:P},(0,aQ.createPortal)((0,$.createElement)(lg.ItemSlot,{scope:n},(0,$.createElement)(li,{asChild:!0,onEscapeKeyDown:a0(a,()=>{g.isFocusedToastEscapeKeyDownRef.current||P(),g.isFocusedToastEscapeKeyDownRef.current=!1})},(0,$.createElement)(a7.li,aJ({role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":o?"open":"closed","data-swipe-direction":g.swipeDirection},f,{ref:b,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:a0(e.onKeyDown,e=>{"Escape"!==e.key||(null==a||a(e.nativeEvent),e.nativeEvent.defaultPrevented||(g.isFocusedToastEscapeKeyDownRef.current=!0,P()))}),onPointerDown:a0(e.onPointerDown,e=>{0===e.button&&(w.current={x:e.clientX,y:e.clientY})}),onPointerMove:a0(e.onPointerMove,e=>{if(!w.current)return;let t=e.clientX-w.current.x,n=e.clientY-w.current.y,r=!!x.current,i=["left","right"].includes(g.swipeDirection),o=["left","up"].includes(g.swipeDirection)?Math.min:Math.max,s=i?o(0,t):0,a=i?0:o(0,n),l="touch"===e.pointerType?10:2,c={x:s,y:a},h={originalEvent:e,delta:c};r?(x.current=c,lz("toast.swipeMove",d,h,{discrete:!1})):lN(c,g.swipeDirection,l)?(x.current=c,lz("toast.swipeStart",u,h,{discrete:!1}),e.target.setPointerCapture(e.pointerId)):(Math.abs(t)>l||Math.abs(n)>l)&&(w.current=null)}),onPointerUp:a0(e.onPointerUp,e=>{let t=x.current,n=e.target;if(n.hasPointerCapture(e.pointerId)&&n.releasePointerCapture(e.pointerId),x.current=null,w.current=null,t){let n=e.currentTarget,r={originalEvent:e,delta:t};lN(t,g.swipeDirection,g.swipeThreshold)?lz("toast.swipeEnd",p,r,{discrete:!0}):lz("toast.swipeCancel",h,r,{discrete:!0}),n.addEventListener("click",e=>e.preventDefault(),{once:!0})}})})))),g.viewport))):null});lA.propTypes={type:e=>e.type&&!["foreground","background"].includes(e.type)?Error(`Invalid prop \`type\` supplied to \`${lT}\`. Expected \`foreground | background\`.`):null};let lO=e=>{let{__scopeToast:t,children:n,...r}=e,i=lv(lT,t),[o,s]=(0,$.useState)(!1),[a,l]=(0,$.useState)(!1);return function(e=()=>{}){let t=lt(e);lc(()=>{let e=0,n=0;return e=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(e),window.cancelAnimationFrame(n)}},[t])}(()=>s(!0)),(0,$.useEffect)(()=>{let e=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(e)},[]),a?null:(0,$.createElement)(ll,{asChild:!0},(0,$.createElement)(lp,r,o&&(0,$.createElement)($.Fragment,null,i.label," ",n)))},l$=(0,$.forwardRef)((e,t)=>{let{__scopeToast:n,...r}=e;return(0,$.createElement)(a7.div,aJ({},r,{ref:t}))}),lB=(0,$.forwardRef)((e,t)=>{let{__scopeToast:n,...r}=e;return(0,$.createElement)(a7.div,aJ({},r,{ref:t}))}),lD=(0,$.forwardRef)((e,t)=>{let{altText:n,...r}=e;return n?(0,$.createElement)(lR,{altText:n,asChild:!0},(0,$.createElement)(lL,aJ({},r,{ref:t}))):null});lD.propTypes={altText:e=>e.altText?null:Error("Missing prop `altText` expected on `ToastAction`")};let lL=(0,$.forwardRef)((e,t)=>{let{__scopeToast:n,...r}=e,i=lM("ToastClose",n);return(0,$.createElement)(lR,{asChild:!0},(0,$.createElement)(a7.button,aJ({type:"button"},r,{ref:t,onClick:a0(e.onClick,i.onClose)})))}),lR=(0,$.forwardRef)((e,t)=>{let{__scopeToast:n,altText:r,...i}=e;return(0,$.createElement)(a7.div,aJ({"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0},i,{ref:t}))});function lz(e,t,n,{discrete:r}){let i=n.originalEvent.currentTarget,o=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n});t&&i.addEventListener(e,t,{once:!0}),r?le(i,o):i.dispatchEvent(o)}let lN=(e,t,n=0)=>{let r=Math.abs(e.x),i=Math.abs(e.y),o=r>i;return"left"===t||"right"===t?o&&r>n:!o&&i>n};function lF(e){let t=document.activeElement;return e.some(e=>e===t||(e.focus(),document.activeElement!==t))}let lU="2.0.0-canary.d0f6ef80fcf9",lV={fonts:{draw:`https://unpkg.com/@tldraw/assets@${lU}/fonts/Shantell_Sans-Tldrawish.woff2`,serif:`https://unpkg.com/@tldraw/assets@${lU}/fonts/IBMPlexSerif-Medium.woff2`,sansSerif:`https://unpkg.com/@tldraw/assets@${lU}/fonts/IBMPlexSans-Medium.woff2`,monospace:`https://unpkg.com/@tldraw/assets@${lU}/fonts/IBMPlexMono-Medium.woff2`}};function lH(e){lV=e}let lZ={...lV,icons:Object.fromEntries(["align-bottom-center","align-bottom-left","align-bottom-right","align-bottom","align-center-center","align-center-horizontal","align-center-left","align-center-right","align-center-vertical","align-left","align-right","align-top-center","align-top-left","align-top-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","aspect-ratio","avatar","blob","bring-forward","bring-to-front","check","checkbox-checked","checkbox-empty","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","code","collab","color","comment","cross-2","cross","dash-dashed","dash-dotted","dash-draw","dash-solid","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","file","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","hidden","image","info-circle","leading","link","lock-small","lock","menu","minus","mixed","pack","page","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","ruler","search","send-backward","send-to-back","settings-horizontal","settings-vertical-1","settings-vertical","share-1","share-2","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","status-online","stretch-horizontal","stretch-vertical","text-align-center","text-align-justify","text-align-left","text-align-right","tool-arrow","tool-embed","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-text","trash","triangle-down","triangle-up","twitter","undo","ungroup","unlock-small","unlock","vertical-align-center","vertical-align-end","vertical-align-start","visible","warning-triangle","zoom-in","zoom-out"].map(e=>[e,`https://unpkg.com/@tldraw/assets@${lU}/icons/icon/${e}.svg`])),translations:Object.fromEntries(I.a2.map(e=>[e.locale,`https://unpkg.com/@tldraw/assets@${lU}/translations/${e.locale}.json`])),embedIcons:Object.fromEntries(I.Lu.map(e=>[e.type,`https://unpkg.com/@tldraw/assets@${lU}/embed-icons/${e.type}.png`]))};function lK(e){lZ=e}function lW(e,t){let n=(0,M.oA)(t.map(t=>e.getShape(t)).filter(t=>t&&e.isShapeOfType(t,"frame")));if(!n.length)return;let r=[];e.batch(()=>{n.map(t=>{let n=e.getSortedChildIdsForParent(t.id);n.length&&(e.reparentShapes(n,t.parentId,t.index),r.push(...n))}),e.setSelectedShapes(r),e.deleteShapes(t)})}function lY(e,t,n={}){let r=e.getShape(t);if(!r)return;let i=e.getSortedChildIdsForParent(r.id),o=(0,M.oA)(i.map(t=>e.getShape(t)));if(!o.length)return;let s=rS.xu.FromPoints(o.flatMap(t=>{let n=e.getShapeGeometry(t.id);return e.getShapeLocalTransform(t).applyToPoints(n.vertices)})),{padding:a=50}=n,l=s.w+2*a,c=s.h+2*a,u=a-s.minX,d=a-s.minY;if(0===u&&0===d&&r.props.w===l&&r.props.h===c)return;let h=new eh.B(u,d).rot(r.rotation);e.batch(()=>{let t=i.map(t=>{let n=e.getShape(t);return{id:n.id,type:n.type,x:n.x+u,y:n.y+d}});t.push({id:r.id,type:r.type,x:r.x-h.x,y:r.y-h.y,props:{w:l,h:c}}),e.updateShapes(t)})}let lG=(0,$.createContext)(null);function lX({assetUrls:e,children:t}){return(0,O.jsx)(lG.Provider,{value:e,children:t})}function lq(){let e=(0,$.useContext)(lG);if(!e)throw Error("useAssetUrls must be used within an AssetUrlsProvider");return e}let lJ={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","menu.title":"Menu","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.view":"View","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy share link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy read-only link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to view (but not edit) this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.title":"Help and resources","help-menu.about":"About","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},lQ={locale:"en",label:"English",messages:lJ};async function l0(e,t){if(!(await fetch(t.translations.en)).ok)return console.warn("No main translations found."),lQ;if("en"===e)return lQ;let n=I.a2.find(t=>t.locale===e);if(!n)return console.warn(`No translation found for locale ${e}`),lQ;let r=await fetch(t.translations[n.locale]),i=await r.json();if(!i)return console.warn(`No messages found for locale ${e}`),lQ;let o=[];for(let e in lQ.messages)i[e]||o.push(e);return o.length,{locale:e,label:n.label,messages:{...lQ.messages,...i}}}let l1=$.createContext({}),l2=()=>$.useContext(l1),l5=(0,T.j)(function({overrides:e,children:t}){let n=(0,G.j)().user.getLocale(),r=lq(),[i,o]=$.useState(()=>e&&e.en?{locale:"en",label:"English",messages:{...lJ,...e.en}}:{locale:"en",label:"English",messages:lJ});return $.useEffect(()=>{let t=!1;return async function(){let i=await l0(n,r);i&&!t&&(e&&e[n]?o({...i,messages:{...i.messages,...e[n]}}):o(i))}(),()=>{t=!0}},[r,n,e]),(0,O.jsx)(l1.Provider,{value:i,children:t})});function l3(){let e=l2();return $.useCallback(function(t){return e.messages[t]??t},[e])}function l8(e){return(0,O.jsx)("svg",{width:16,height:16,viewBox:"0 0 16 16",...e,children:(0,O.jsxs)("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[(0,O.jsx)("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),(0,O.jsx)("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:(0,O.jsx)("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}let l4=(0,$.memo)(function({small:e,invertIcon:t,icon:n,color:r,className:i,...o}){let s=lq(),a=s.icons[n]??s.icons["question-mark-circle"],l=(0,$.useRef)(null);return(0,$.useLayoutEffect)(()=>{a||console.error(`Icon not found: ${n}. Add it to the assetUrls.icons object.`),l?.current&&(l.current.style.webkitMask=`url(${a}) center 100% / 100% no-repeat`)},[l,a,n]),(0,O.jsx)("div",{...o,ref:l,className:D("tlui-icon",{"tlui-icon__small":e},i),style:{color:r,mask:`url(${a}) center 100% / 100% no-repeat`,transform:t?"scale(-1, 1)":void 0}})}),l6="undefined"!=typeof window&&window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,l9=l6?"":"Ctrl",l7=l6?"":"Alt";function ce(e){return" "+e.split(",")[0].split("").map(e=>{let t=e.replace(/\$/g,l9).replace(/\?/g,l7).replace(/!/g,"");return t[0].toUpperCase()+t.slice(1)}).join("")}function ct({children:e}){return(0,O.jsx)("kbd",{className:"tlui-kbd",children:e.split(",")[0].split("").map(e=>{let t=e.replace(/\$/g,l9).replace(/\?/g,l7).replace(/!/g,"");return t[0].toUpperCase()+t.slice(1)}).map((e,t)=>(0,O.jsx)("span",{children:e},t))})}let cn=$.forwardRef(function({label:e,icon:t,invertIcon:n,iconLeft:r,smallIcon:i,kbd:o,isChecked:s=!1,type:a,children:l,spinner:c,disabled:u,...d},h){let p=l3(),f=e?p(e):"",g=(0,G.j)(),m=h?.current;return u&&m===document.activeElement&&g.getContainer().focus(),(0,O.jsxs)("button",{ref:h,draggable:!1,type:"button",disabled:u,...d,title:d.title??f,className:D("tlui-button",`tlui-button__${a}`,d.className),children:[r&&(0,O.jsx)(l4,{icon:r,className:"tlui-button__icon-left",small:!0}),l,e&&(0,O.jsxs)("span",{className:"tlui-button__label",draggable:!1,children:[f,s&&(0,O.jsx)(l4,{icon:"check"})]}),o&&(0,O.jsx)(ct,{children:o}),t&&!c&&(0,O.jsx)(l4,{icon:t,small:!!e||i,invertIcon:n}),c&&(0,O.jsx)(l8,{})]})}),cr=B["useId".toString()]||(()=>void 0),ci=0;function co(e){let[t,n]=$.useState(cr());return lc(()=>{e||n(e=>null!=e?e:String(ci++))},[e]),e||(t?`radix-${t}`:"")}let cs="focusScope.autoFocusOnMount",ca="focusScope.autoFocusOnUnmount",cl={bubbles:!1,cancelable:!0},cc=(0,$.forwardRef)((e,t)=>{let{loop:n=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:o,...s}=e,[a,l]=(0,$.useState)(null),c=lt(i),u=lt(o),d=(0,$.useRef)(null),h=a2(t,e=>l(e)),p=(0,$.useRef)({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;(0,$.useEffect)(()=>{if(r){function e(e){if(p.paused||!a)return;let t=e.target;a.contains(t)?d.current=t:ch(d.current,{select:!0})}function t(e){if(p.paused||!a)return;let t=e.relatedTarget;null===t||a.contains(t)||ch(d.current,{select:!0})}document.addEventListener("focusin",e),document.addEventListener("focusout",t);let n=new MutationObserver(function(e){if(document.activeElement===document.body)for(let t of e)t.removedNodes.length>0&&ch(a)});return a&&n.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",e),document.removeEventListener("focusout",t),n.disconnect()}}},[r,a,p.paused]),(0,$.useEffect)(()=>{if(a){cp.add(p);let e=document.activeElement;if(!a.contains(e)){let t=new CustomEvent(cs,cl);a.addEventListener(cs,c),a.dispatchEvent(t),t.defaultPrevented||(function(e,{select:t=!1}={}){let n=document.activeElement;for(let r of e)if(ch(r,{select:t}),document.activeElement!==n)return}(cu(a).filter(e=>"A"!==e.tagName),{select:!0}),document.activeElement===e&&ch(a))}return()=>{a.removeEventListener(cs,c),setTimeout(()=>{let t=new CustomEvent(ca,cl);a.addEventListener(ca,u),a.dispatchEvent(t),t.defaultPrevented||ch(null!=e?e:document.body,{select:!0}),a.removeEventListener(ca,u),cp.remove(p)},0)}}},[a,c,u,p]);let f=(0,$.useCallback)(e=>{if(!n&&!r||p.paused)return;let t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,i=document.activeElement;if(t&&i){let t=e.currentTarget,[r,o]=function(e){let t=cu(e);return[cd(t,e),cd(t.reverse(),e)]}(t);r&&o?e.shiftKey||i!==o?e.shiftKey&&i===r&&(e.preventDefault(),n&&ch(o,{select:!0})):(e.preventDefault(),n&&ch(r,{select:!0})):i===t&&e.preventDefault()}},[n,r,p.paused]);return(0,$.createElement)(a7.div,aJ({tabIndex:-1},s,{ref:h,onKeyDown:f}))});function cu(e){let t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{let t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function cd(e,t){for(let n of e)if(!function(e,{upTo:t}){if("hidden"===getComputedStyle(e).visibility)return!0;for(;e&&(void 0===t||e!==t);){if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}(n,{upTo:t}))return n}function ch(e,{select:t=!1}={}){if(e&&e.focus){var n;let r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&(n=e)instanceof HTMLInputElement&&"select"in n&&t&&e.select()}}let cp=(l=[],{add(e){let t=l[0];e!==t&&(null==t||t.pause()),(l=cf(l,e)).unshift(e)},remove(e){var t;null===(t=(l=cf(l,e))[0])||void 0===t||t.resume()}});function cf(e,t){let n=[...e],r=n.indexOf(t);return -1!==r&&n.splice(r,1),n}let cg=0;function cm(){(0,$.useEffect)(()=>{var e,t;let n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",null!==(e=n[0])&&void 0!==e?e:cy()),document.body.insertAdjacentElement("beforeend",null!==(t=n[1])&&void 0!==t?t:cy()),cg++,()=>{1===cg&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),cg--}},[])}function cy(){let e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",e}var cb=function(){return(cb=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function cw(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)0>t.indexOf(r[i])&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}"function"==typeof SuppressedError&&SuppressedError;var cx="right-scroll-bar-position",cv="width-before-scroll-bar",cS=(void 0===u&&(u={}),(void 0===d&&(d=function(e){return e}),h=[],p=!1,f={read:function(){if(p)throw Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return h.length?h[h.length-1]:null},useMedium:function(e){var t=d(e,p);return h.push(t),function(){h=h.filter(function(e){return e!==t})}},assignSyncMedium:function(e){for(p=!0;h.length;){var t=h;h=[],t.forEach(e)}h={push:function(t){return e(t)},filter:function(){return h}}},assignMedium:function(e){p=!0;var t=[];if(h.length){var n=h;h=[],n.forEach(e),t=h}var r=function(){var n=t;t=[],n.forEach(e)},i=function(){return Promise.resolve().then(r)};i(),h={push:function(e){t.push(e),i()},filter:function(e){return t=t.filter(e),h}}}}).options=cb({async:!0,ssr:!1},u),f),ck=function(){},c_=$.forwardRef(function(e,t){var n,r,i,o=$.useRef(null),s=$.useState({onScrollCapture:ck,onWheelCapture:ck,onTouchMoveCapture:ck}),a=s[0],l=s[1],c=e.forwardProps,u=e.children,d=e.className,h=e.removeScrollBar,p=e.enabled,f=e.shards,g=e.sideCar,m=e.noIsolation,y=e.inert,b=e.allowPinchZoom,w=e.as,x=cw(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),v=(n=[o,t],r=function(e){return n.forEach(function(t){return"function"==typeof t?t(e):t&&(t.current=e),t})},(i=(0,$.useState)(function(){return{value:null,callback:r,facade:{get current(){return i.value},set current(value){var e=i.value;e!==value&&(i.value=value,i.callback(value,e))}}}})[0]).callback=r,i.facade),S=cb(cb({},x),a);return $.createElement($.Fragment,null,p&&$.createElement(g,{sideCar:cS,removeScrollBar:h,shards:f,noIsolation:m,inert:y,setCallbacks:l,allowPinchZoom:!!b,lockRef:o}),c?$.cloneElement($.Children.only(u),cb(cb({},S),{ref:v})):$.createElement(void 0===w?"div":w,cb({},S,{className:d,ref:v}),u))});c_.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},c_.classNames={fullWidth:cv,zeroRight:cx};var cE=function(e){var t=e.sideCar,n=cw(e,["sideCar"]);if(!t)throw Error("Sidecar: please provide `sideCar` property to import the right car");var r=t.read();if(!r)throw Error("Sidecar medium not found");return $.createElement(r,cb({},n))};cE.isSideCarExport=!0;var cC=function(){var e=0,t=null;return{add:function(r){if(0==e&&(t=function(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=E||n.nc;return t&&e.setAttribute("nonce",t),e}())){var i,o;(i=t).styleSheet?i.styleSheet.cssText=r:i.appendChild(document.createTextNode(r)),o=t,(document.head||document.getElementsByTagName("head")[0]).appendChild(o)}e++},remove:function(){--e||!t||(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},cP=function(){var e=cC();return function(t,n){$.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},cT=function(){var e=cP();return function(t){return e(t.styles,t.dynamic),null}},cj={left:0,top:0,right:0,gap:0},cI=function(e){return parseInt(e||"",10)||0},cM=function(e){var t=window.getComputedStyle(document.body),n=t["padding"===e?"paddingLeft":"marginLeft"],r=t["padding"===e?"paddingTop":"marginTop"],i=t["padding"===e?"paddingRight":"marginRight"];return[cI(n),cI(r),cI(i)]},cA=function(e){if(void 0===e&&(e="margin"),"undefined"==typeof window)return cj;var t=cM(e),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-n+t[2]-t[0])}},cO=cT(),c$=function(e,t,n,r){var i=e.left,o=e.top,s=e.right,a=e.gap;return void 0===n&&(n="margin"),"\n  .".concat("with-scroll-bars-hidden"," {\n   overflow: hidden ").concat(r,";\n   padding-right: ").concat(a,"px ").concat(r,";\n  }\n  body {\n    overflow: hidden ").concat(r,";\n    overscroll-behavior: contain;\n    ").concat([t&&"position: relative ".concat(r,";"),"margin"===n&&"\n    padding-left: ".concat(i,"px;\n    padding-top: ").concat(o,"px;\n    padding-right: ").concat(s,"px;\n    margin-left:0;\n    margin-top:0;\n    margin-right: ").concat(a,"px ").concat(r,";\n    "),"padding"===n&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),"\n  }\n  \n  .").concat(cx," {\n    right: ").concat(a,"px ").concat(r,";\n  }\n  \n  .").concat(cv," {\n    margin-right: ").concat(a,"px ").concat(r,";\n  }\n  \n  .").concat(cx," .").concat(cx," {\n    right: 0 ").concat(r,";\n  }\n  \n  .").concat(cv," .").concat(cv," {\n    margin-right: 0 ").concat(r,";\n  }\n  \n  body {\n    ").concat("--removed-body-scroll-bar-size",": ").concat(a,"px;\n  }\n")},cB=function(e){var t=e.noRelative,n=e.noImportant,r=e.gapMode,i=void 0===r?"margin":r,o=$.useMemo(function(){return cA(i)},[i]);return $.createElement(cO,{styles:c$(o,!t,i,n?"":"!important")})},cD=!1;if("undefined"!=typeof window)try{var cL=Object.defineProperty({},"passive",{get:function(){return cD=!0,!0}});window.addEventListener("test",cL,cL),window.removeEventListener("test",cL,cL)}catch(e){cD=!1}var cR=!!cD&&{passive:!1},cz=function(e,t){var n=window.getComputedStyle(e);return"hidden"!==n[t]&&!(n.overflowY===n.overflowX&&"TEXTAREA"!==e.tagName&&"visible"===n[t])},cN=function(e,t){var n=t;do{if("undefined"!=typeof ShadowRoot&&n instanceof ShadowRoot&&(n=n.host),cF(e,n)){var r=cU(e,n);if(r[1]>r[2])return!0}n=n.parentNode}while(n&&n!==document.body);return!1},cF=function(e,t){return"v"===e?cz(t,"overflowY"):cz(t,"overflowX")},cU=function(e,t){return"v"===e?[t.scrollTop,t.scrollHeight,t.clientHeight]:[t.scrollLeft,t.scrollWidth,t.clientWidth]},cV=function(e,t,n,r,i){var o,s=(o=window.getComputedStyle(t).direction,"h"===e&&"rtl"===o?-1:1),a=s*r,l=n.target,c=t.contains(l),u=!1,d=a>0,h=0,p=0;do{var f=cU(e,l),g=f[0],m=f[1]-f[2]-s*g;(g||m)&&cF(e,l)&&(h+=m,p+=g),l=l.parentNode}while(!c&&l!==document.body||c&&(t.contains(l)||t===l));return d&&(i&&0===h||!i&&a>h)?u=!0:!d&&(i&&0===p||!i&&-a>p)&&(u=!0),u},cH=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},cZ=function(e){return[e.deltaX,e.deltaY]},cK=function(e){return e&&"current"in e?e.current:e},cW=0,cY=[],cG=(g=function(e){var t=$.useRef([]),n=$.useRef([0,0]),r=$.useRef(),i=$.useState(cW++)[0],o=$.useState(function(){return cT()})[0],s=$.useRef(e);$.useEffect(function(){s.current=e},[e]),$.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(i));var t=(function(e,t,n){if(n||2==arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))})([e.lockRef.current],(e.shards||[]).map(cK),!0).filter(Boolean);return t.forEach(function(e){return e.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),t.forEach(function(e){return e.classList.remove("allow-interactivity-".concat(i))})}}},[e.inert,e.lockRef.current,e.shards]);var a=$.useCallback(function(e,t){if("touches"in e&&2===e.touches.length)return!s.current.allowPinchZoom;var i,o=cH(e),a=n.current,l="deltaX"in e?e.deltaX:a[0]-o[0],c="deltaY"in e?e.deltaY:a[1]-o[1],u=e.target,d=Math.abs(l)>Math.abs(c)?"h":"v";if("touches"in e&&"h"===d&&"range"===u.type)return!1;var h=cN(d,u);if(!h)return!0;if(h?i=d:(i="v"===d?"h":"v",h=cN(d,u)),!h)return!1;if(!r.current&&"changedTouches"in e&&(l||c)&&(r.current=i),!i)return!0;var p=r.current||i;return cV(p,t,e,"h"===p?l:c,!0)},[]),l=$.useCallback(function(e){if(cY.length&&cY[cY.length-1]===o){var n="deltaY"in e?cZ(e):cH(e),r=t.current.filter(function(t){var r;return t.name===e.type&&t.target===e.target&&(r=t.delta)[0]===n[0]&&r[1]===n[1]})[0];if(r&&r.should){e.cancelable&&e.preventDefault();return}if(!r){var i=(s.current.shards||[]).map(cK).filter(Boolean).filter(function(t){return t.contains(e.target)});(i.length>0?a(e,i[0]):!s.current.noIsolation)&&e.cancelable&&e.preventDefault()}}},[]),c=$.useCallback(function(e,n,r,i){var o={name:e,delta:n,target:r,should:i};t.current.push(o),setTimeout(function(){t.current=t.current.filter(function(e){return e!==o})},1)},[]),u=$.useCallback(function(e){n.current=cH(e),r.current=void 0},[]),d=$.useCallback(function(t){c(t.type,cZ(t),t.target,a(t,e.lockRef.current))},[]),h=$.useCallback(function(t){c(t.type,cH(t),t.target,a(t,e.lockRef.current))},[]);$.useEffect(function(){return cY.push(o),e.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:h}),document.addEventListener("wheel",l,cR),document.addEventListener("touchmove",l,cR),document.addEventListener("touchstart",u,cR),function(){cY=cY.filter(function(e){return e!==o}),document.removeEventListener("wheel",l,cR),document.removeEventListener("touchmove",l,cR),document.removeEventListener("touchstart",u,cR)}},[]);var p=e.removeScrollBar,f=e.inert;return $.createElement($.Fragment,null,f?$.createElement(o,{styles:"\n  .block-interactivity-".concat(i," {pointer-events: none;}\n  .allow-interactivity-").concat(i," {pointer-events: all;}\n")}):null,p?$.createElement(cB,{gapMode:"margin"}):null)},cS.useMedium(g),cE),cX=$.forwardRef(function(e,t){return $.createElement(c_,cb({},e,{ref:t,sideCar:cG}))});cX.classNames=c_.classNames;var cq=new WeakMap,cJ=new WeakMap,cQ={},c0=0,c1=function(e){return e&&(e.host||c1(e.parentNode))},c2=function(e,t,n,r){var i=(Array.isArray(e)?e:[e]).map(function(e){if(t.contains(e))return e;var n=c1(e);return n&&t.contains(n)?n:(console.error("aria-hidden",e,"in not contained inside",t,". Doing nothing"),null)}).filter(function(e){return!!e});cQ[n]||(cQ[n]=new WeakMap);var o=cQ[n],s=[],a=new Set,l=new Set(i),c=function(e){!e||a.has(e)||(a.add(e),c(e.parentNode))};i.forEach(c);var u=function(e){!e||l.has(e)||Array.prototype.forEach.call(e.children,function(e){if(a.has(e))u(e);else{var t=e.getAttribute(r),i=null!==t&&"false"!==t,l=(cq.get(e)||0)+1,c=(o.get(e)||0)+1;cq.set(e,l),o.set(e,c),s.push(e),1===l&&i&&cJ.set(e,!0),1===c&&e.setAttribute(n,"true"),i||e.setAttribute(r,"true")}})};return u(t),a.clear(),c0++,function(){s.forEach(function(e){var t=cq.get(e)-1,i=o.get(e)-1;cq.set(e,t),o.set(e,i),t||(cJ.has(e)||e.removeAttribute(r),cJ.delete(e)),i||e.removeAttribute(n)}),--c0||(cq=new WeakMap,cq=new WeakMap,cJ=new WeakMap,cQ={})}},c5=function(e,t,n){void 0===n&&(n="data-aria-hidden");var r=Array.from(Array.isArray(e)?e:[e]),i=t||("undefined"==typeof document?null:(Array.isArray(e)?e[0]:e).ownerDocument.body);return i?(r.push.apply(r,Array.from(i.querySelectorAll("[aria-live]"))),c2(r,i,n,"aria-hidden")):function(){return null}};let c3="Dialog",[c8,c4]=a5(c3),[c6,c9]=c8(c3),c7="DialogPortal",[ue,ut]=c8(c7,{forceMount:void 0}),un="DialogOverlay",ur=(0,$.forwardRef)((e,t)=>{let n=ut(un,e.__scopeDialog),{forceMount:r=n.forceMount,...i}=e,o=c9(un,e.__scopeDialog);return o.modal?(0,$.createElement)(lu,{present:r||o.open},(0,$.createElement)(ui,aJ({},i,{ref:t}))):null}),ui=(0,$.forwardRef)((e,t)=>{let{__scopeDialog:n,...r}=e,i=c9(un,n);return(0,$.createElement)(cX,{as:a3,allowPinchZoom:!0,shards:[i.contentRef]},(0,$.createElement)(a7.div,aJ({"data-state":up(i.open)},r,{ref:t,style:{pointerEvents:"auto",...r.style}})))}),uo="DialogContent",us=(0,$.forwardRef)((e,t)=>{let n=ut(uo,e.__scopeDialog),{forceMount:r=n.forceMount,...i}=e,o=c9(uo,e.__scopeDialog);return(0,$.createElement)(lu,{present:r||o.open},o.modal?(0,$.createElement)(ua,aJ({},i,{ref:t})):(0,$.createElement)(ul,aJ({},i,{ref:t})))}),ua=(0,$.forwardRef)((e,t)=>{let n=c9(uo,e.__scopeDialog),r=(0,$.useRef)(null),i=a2(t,n.contentRef,r);return(0,$.useEffect)(()=>{let e=r.current;if(e)return c5(e)},[]),(0,$.createElement)(uc,aJ({},e,{ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:a0(e.onCloseAutoFocus,e=>{var t;e.preventDefault(),null===(t=n.triggerRef.current)||void 0===t||t.focus()}),onPointerDownOutside:a0(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey;(2===t.button||n)&&e.preventDefault()}),onFocusOutside:a0(e.onFocusOutside,e=>e.preventDefault())}))}),ul=(0,$.forwardRef)((e,t)=>{let n=c9(uo,e.__scopeDialog),r=(0,$.useRef)(!1),i=(0,$.useRef)(!1);return(0,$.createElement)(uc,aJ({},e,{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var o,s;null===(o=e.onCloseAutoFocus)||void 0===o||o.call(e,t),t.defaultPrevented||(r.current||null===(s=n.triggerRef.current)||void 0===s||s.focus(),t.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:t=>{var o,s;null===(o=e.onInteractOutside)||void 0===o||o.call(e,t),t.defaultPrevented||(r.current=!0,"pointerdown"!==t.detail.originalEvent.type||(i.current=!0));let a=t.target;(null===(s=n.triggerRef.current)||void 0===s?void 0:s.contains(a))&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&i.current&&t.preventDefault()}}))}),uc=(0,$.forwardRef)((e,t)=>{let{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,...s}=e,a=c9(uo,n),l=a2(t,(0,$.useRef)(null));return cm(),(0,$.createElement)($.Fragment,null,(0,$.createElement)(cc,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:o},(0,$.createElement)(li,aJ({role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":up(a.open)},s,{ref:l,onDismiss:()=>a.onOpenChange(!1)}))),!1)}),uu="DialogTitle",ud=(0,$.forwardRef)((e,t)=>{let{__scopeDialog:n,...r}=e,i=c9(uu,n);return(0,$.createElement)(a7.h2,aJ({id:i.titleId},r,{ref:t}))}),uh=(0,$.forwardRef)((e,t)=>{let{__scopeDialog:n,...r}=e,i=c9("DialogClose",n);return(0,$.createElement)(a7.button,aJ({type:"button"},r,{ref:t,onClick:a0(e.onClick,()=>i.onOpenChange(!1))}))});function up(e){return e?"open":"closed"}let[uf,ug]=function(e,t){let n=(0,$.createContext)(t);function r(e){let{children:t,...r}=e,i=(0,$.useMemo)(()=>r,Object.values(r));return(0,$.createElement)(n.Provider,{value:i},t)}return r.displayName=e+"Provider",[r,function(r){let i=(0,$.useContext)(n);if(i)return i;if(void 0!==t)return t;throw Error(`\`${r}\` must be used within \`${e}\``)}]}("DialogTitleWarning",{contentName:uo,titleName:uu,docsSlug:"dialog"}),um=e=>{let{__scopeDialog:t,children:n,open:r,defaultOpen:i,onOpenChange:o,modal:s=!0}=e,a=(0,$.useRef)(null),l=(0,$.useRef)(null),[c=!1,u]=lh({prop:r,defaultProp:i,onChange:o});return(0,$.createElement)(c6,{scope:t,triggerRef:a,contentRef:l,contentId:co(),titleId:co(),descriptionId:co(),open:c,onOpenChange:u,onOpenToggle:(0,$.useCallback)(()=>u(e=>!e),[u]),modal:s},n)},uy=e=>{let{__scopeDialog:t,forceMount:n,children:r,container:i}=e,o=c9(c7,t);return(0,$.createElement)(ue,{scope:t,forceMount:n},$.Children.map(r,e=>(0,$.createElement)(lu,{present:n||o.open},(0,$.createElement)(ll,{asChild:!0,container:i},e))))};function ub({className:e,children:t}){return(0,O.jsx)("div",{className:D("tlui-dialog__header",e),children:t})}function uw({className:e,children:t}){return(0,O.jsx)(ud,{dir:"ltr",className:D("tlui-dialog__header__title",e),children:t})}function ux(){return(0,O.jsx)("div",{className:"tlui-dialog__header__close",children:(0,O.jsx)(uh,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:(0,O.jsx)(cn,{type:"icon","aria-label":"Close",onTouchEnd:e=>e.target.click(),children:(0,O.jsx)(l4,{small:!0,icon:"cross-2"})})})})}function uv({className:e,children:t,style:n}){return(0,O.jsx)("div",{className:D("tlui-dialog__body",e),style:n,children:t})}function uS({className:e,children:t}){return(0,O.jsx)("div",{className:D("tlui-dialog__footer",e),children:t})}let uk=$.forwardRef(function({className:e,label:t,icon:n,iconLeft:r,autoselect:i=!1,autofocus:o=!1,defaultValue:s,placeholder:a,onComplete:l,onValueChange:c,onCancel:u,onBlur:d,shouldManuallyMaintainScrollPositionWhenFocused:h=!1,children:p,value:f},g){let m=(0,G.j)(),y=$.useRef(null);$.useImperativeHandle(g,()=>y.current);let b=l3(),w=$.useRef(s??""),x=$.useRef(s??""),[v,S]=$.useState(!1),k=$.useCallback(e=>{S(!0);let t=e.currentTarget;x.current=t.value,requestAnimationFrame(()=>{i&&t.select()})},[i]),_=$.useCallback(e=>{let t=e.currentTarget.value;x.current=t,c?.(t)},[c]),E=$.useCallback(e=>{switch(e.key){case"Enter":e.currentTarget.blur(),W(e),l?.(e.currentTarget.value);break;case"Escape":e.currentTarget.value=w.current,e.currentTarget.blur(),W(e),u?.(e.currentTarget.value)}},[l,u]),C=$.useCallback(e=>{S(!1);let t=e.currentTarget.value;d?.(t)},[d]);return $.useEffect(()=>{if(!m.environment.isIos)return;let e=window.visualViewport;if(v&&h&&e){let t=()=>{y.current?.scrollIntoView({block:"center"})};return e.addEventListener("resize",t),e.addEventListener("scroll",t),requestAnimationFrame(()=>{y.current?.scrollIntoView({block:"center"})}),()=>{e.removeEventListener("resize",t),e.removeEventListener("scroll",t)}}},[m,v,h]),(0,O.jsxs)("div",{draggable:!1,className:"tlui-input__wrapper",children:[p,t&&(0,O.jsx)("label",{children:b(t)}),r&&(0,O.jsx)(l4,{icon:r,className:"tlui-icon-left",small:!0}),(0,O.jsx)("input",{ref:y,className:D("tlui-input",e),type:"text",defaultValue:s,onKeyUp:E,onChange:_,onFocus:k,onBlur:C,autoFocus:o,placeholder:a,value:f}),n&&(0,O.jsx)(l4,{icon:n,small:!!t})]})});function u_(e){return A.T.linkUrl.isValid(e)?{isValid:!0,hasProtocol:!0}:A.T.linkUrl.isValid("https://"+e)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}let uE=(0,T.j)(function({onClose:e}){let t=(0,G.j)().getOnlySelectedShape();return t&&"url"in t.props&&"string"==typeof t.props.url?(0,O.jsx)(uC,{onClose:e,selectedShape:t}):null}),uC=(0,T.j)(function({onClose:e,selectedShape:t}){let n=(0,G.j)(),r=l3(),i=(0,$.useRef)(null);(0,$.useEffect)(()=>{requestAnimationFrame(()=>i.current?.focus())},[]);let o=(0,$.useRef)(t.props.url),[s,a]=(0,$.useState)(()=>{let e=u_(t.props.url),n=!0===e.isValid?e.hasProtocol?t.props.url:"https://"+t.props.url:"https://";return{actual:n,safe:n,valid:!0}}),l=(0,$.useCallback)(e=>{let t=e.replace(/https?:\/\/(https?:\/\/)/,(e,t)=>t),n=u_(t),r=!0===n.isValid?n.hasProtocol?t:"https://"+t:"https://";a({actual:t,safe:r,valid:n.isValid})},[]),c=(0,$.useCallback)(()=>{let t=n.getOnlySelectedShape();t&&(n.updateShapes([{id:t.id,type:t.type,props:{url:""}}]),e())},[n,e]),u=(0,$.useCallback)(()=>{let t=n.getOnlySelectedShape();t&&(t&&"url"in t.props&&t.props.url!==s.safe&&n.updateShapes([{id:t.id,type:t.type,props:{url:s.safe}}]),e())},[n,e,s]),d=(0,$.useCallback)(()=>{e()},[e]);if(!t)return e(),null;let h=o.current&&!s.valid;return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(ub,{children:[(0,O.jsx)(uw,{children:r("edit-link-dialog.title")}),(0,O.jsx)(ux,{})]}),(0,O.jsx)(uv,{children:(0,O.jsxs)("div",{className:"tlui-edit-link-dialog",children:[(0,O.jsx)(uk,{ref:i,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autofocus:!0,value:s.actual,onValueChange:l,onComplete:u,onCancel:d}),(0,O.jsx)("div",{children:r(s.valid?"edit-link-dialog.detail":"edit-link-dialog.invalid-url")})]})}),(0,O.jsxs)(uS,{className:"tlui-dialog__footer__actions",children:[(0,O.jsx)(cn,{type:"normal",onClick:d,onTouchEnd:d,children:r("edit-link-dialog.cancel")}),h?(0,O.jsx)(cn,{type:"danger",onTouchEnd:c,onClick:c,children:r("edit-link-dialog.clear")}):(0,O.jsx)(cn,{type:"primary",disabled:!s.valid,onTouchEnd:u,onClick:u,children:r("edit-link-dialog.save")})]})]})}),uP=(0,T.j)(function({onClose:e}){let t=(0,G.j)(),n=l3(),r=lq(),[i,o]=(0,$.useState)(null),[s,a]=(0,$.useState)(""),[l,c]=(0,$.useState)(null),[u,d]=(0,$.useState)(!1),h=(0,$.useRef)(-1);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(ub,{children:[(0,O.jsx)(uw,{children:i?`${n("embed-dialog.title")} \u2014 ${i.title}`:n("embed-dialog.title")}),(0,O.jsx)(ux,{})]}),i?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(uv,{className:"tlui-embed-dialog__enter",children:[(0,O.jsx)(uk,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"http://example.com",autofocus:!0,onValueChange:e=>{a(e);let t=iR(e);c(t&&t.definition.type===i.type?t:null),d(!1),clearTimeout(h.current),h.current=setTimeout(()=>d(!t),320)}}),""===s?(0,O.jsxs)("div",{className:"tlui-embed-dialog__instruction",children:[(0,O.jsx)("span",{children:n("embed-dialog.instruction")})," ",i.instructionLink&&(0,O.jsxs)("a",{target:"_blank",rel:"noopener noreferrer",href:i.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",(0,O.jsx)(l4,{icon:"external-link",small:!0})]})]}):(0,O.jsx)("div",{className:"tlui-embed-dialog__warning",children:u?n("embed-dialog.invalid-url"):"\xa0"})]}),(0,O.jsxs)(uS,{className:"tlui-dialog__footer__actions",children:[(0,O.jsx)(cn,{type:"normal",onClick:()=>{o(null),c(null),a("")},label:"embed-dialog.back"}),(0,O.jsx)("div",{className:"tlui-embed__spacer"}),(0,O.jsx)(cn,{type:"normal",label:"embed-dialog.cancel",onClick:e}),(0,O.jsx)(cn,{type:"primary",disabled:!l,label:"embed-dialog.create",onClick:()=>{l&&(t.putExternalContent({type:"embed",url:s,point:t.getViewportPageCenter(),embed:l.definition}),e())}})]})]}):(0,O.jsx)(O.Fragment,{children:(0,O.jsx)(uv,{className:"tlui-embed-dialog__list",children:I.Lu.map(e=>(0,O.jsx)(cn,{type:"menu",onClick:()=>o(e),label:e.title,children:(0,O.jsx)("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${r.embedIcons[e.type]})`}})},e.type))})})]})});var uT=n(6488);async function uj(e,t,n){let{elements:r,files:i}=t,o={shapes:[],rootShapeIds:[],assets:[],schema:e.store.schema.serialize()},s=new Map,a=new Map,l=e.getCurrentPageId(),c=new Map,u=[],d=new Set;r.forEach(e=>{if(c.set(e.id,(0,I.F1)()),null!==e.boundElements)for(let t of e.boundElements)"text"===t.type&&d.add(t.id)});let h="a1";for(let e of r){if(d.has(e.id))continue;let t=c.get(e.id),n={id:t,typeName:"shape",parentId:l,index:h,x:e.x,y:e.y,rotation:0,isLocked:e.locked,opacity:uI(e.opacity),meta:{}};switch(0!==e.angle&&a.set(t,e.angle),e.groupIds&&e.groupIds.length>0?s.has(e.groupIds[0])?s.get(e.groupIds[0])?.push(t):s.set(e.groupIds[0],[t]):u.push(t),e.type){case"rectangle":case"ellipse":case"diamond":{let t="",i="middle";if(null!==e.boundElements){for(let n of e.boundElements)if("text"===n.type){let e=r.find(e=>e.id===n.id);e&&(t=e.text,i=uL[e.textAlign])}}let s="transparent"===e.backgroundColor?e.strokeColor:e.backgroundColor;o.shapes.push({...n,type:"geo",props:{geo:e.type,url:e.link??"",w:e.width,h:e.height,size:uM[e.strokeWidth]??"draw",color:u$[s]??"black",text:t,align:i,dash:uz(e),fill:uN(e)}});break}case"freedraw":o.shapes.push({...n,type:"draw",props:{dash:uz(e),size:uM[e.strokeWidth],color:u$[e.strokeColor]??"black",segments:[{type:"free",points:e.points.map(([e,t,n=.5])=>({x:e,y:t,z:n}))}]}});break;case"line":{let t=e.points[0],r=e.points[e.points.length-1],i=(0,rV.H$)(e.points.length);o.shapes.push({...n,type:"line",props:{dash:uz(e),size:uM[e.strokeWidth],color:u$[e.strokeColor]??"black",spline:e.roundness?"cubic":"line",handles:{start:{id:"start",type:"vertex",index:i[0],x:t[0],y:t[1]},end:{id:"end",type:"vertex",index:i[i.length-1],x:r[0],y:r[1]},...Object.fromEntries(e.points.slice(1,-1).map(([e,t],n)=>{let r=(0,nh.E)();return[r,{id:r,type:"vertex",index:i[n+1],x:e,y:t}]}))}}});break}case"arrow":{let t="";if(null!==e.boundElements){for(let n of e.boundElements)if("text"===n.type){let e=r.find(e=>e.id===n.id);e&&(t=e.text)}}let i=e.points[0],s=e.points[e.points.length-1],a=c.get(e.startBinding?.elementId),l=c.get(e.endBinding?.elementId);o.shapes.push({...n,type:"arrow",props:{text:t,bend:function(e,t,n){let r=0;if(e.points.length>2){let i=new eh.B(t[0],t[1]),o=new eh.B(n[0],n[1]),s=new eh.B(e.points[1][0],e.points[1][1]),a=eh.B.Sub(o,i),l=eh.B.Per(a),c=eh.B.Med(o,i),u=eh.B.Sub(c,l),d=eh.B.Add(c,l),h=eh.B.NearestPointOnLineSegment(u,d,s,!1);r=eh.B.Dist(h,c),eh.B.Clockwise(h,o,c)&&(r*=-1)}return r}(e,i,s),dash:uz(e),size:uM[e.strokeWidth]??"m",color:u$[e.strokeColor]??"black",start:a?{type:"binding",boundShapeId:a,normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1}:{type:"point",x:i[0],y:i[1]},end:l?{type:"binding",boundShapeId:l,normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1}:{type:"point",x:s[0],y:s[1]},arrowheadEnd:uR[e.endArrowhead]??"none",arrowheadStart:uR[e.startArrowhead]??"none"}});break}case"text":{let{size:t,scale:r}=function(e){let t=uA[e];return t?{size:t,scale:1}:e<16?{size:"s",scale:e/16}:e>36?{size:"xl",scale:e/36}:{size:"m",scale:1}}(e.fontSize);o.shapes.push({...n,type:"text",props:{size:t,scale:r,font:uO[e.fontFamily]??"draw",color:u$[e.strokeColor]??"black",text:e.text,align:uL[e.textAlign]}});break}case"image":{let t=i[e.fileId];if(!t)break;let r=I.Yk.createId();o.assets.push({id:r,typeName:"asset",type:"image",props:{w:e.width,h:e.height,name:e.id??"Untitled",isAnimated:!1,mimeType:t.mimeType,src:t.dataURL},meta:{}}),o.shapes.push({...n,type:"image",props:{w:e.width,h:e.height,assetId:r}})}}h=(0,rV._L)(h)}let p=n??(e.inputs.shiftKey?e.inputs.currentPagePoint:void 0);for(let t of(e.mark("paste"),e.putContentOntoCurrentPage(o,{point:p,select:!1,preserveIds:!0}),s.values()))if(t.length>1){e.groupShapes(t);let n=e.getShape(t[0]);n?.parentId&&(0,I.YT)(n.parentId)&&u.push(n.parentId)}for(let[t,n]of a)e.select(t),e.rotateShapesBy([t],n);let f=(0,M.oA)(u.map(t=>e.getShape(t))),g=rS.xu.Common(f.map(t=>e.getShapePageBounds(t))),m=e.getViewportPageBounds().center;e.updateShapes(f.map(e=>{let t={x:(e.x??0)-(g.x+g.w/2),y:(e.y??0)-(g.y+g.h/2)};return{id:e.id,type:e.type,x:m.x+t.x,y:m.y+t.y}})),e.setSelectedShapes(u)}let uI=e=>{let t=e/100;return t<.2?.1:t<.4?.25:t<.6?.5:t<.8?.75:1},uM={1:"s",2:"m",3:"l",4:"xl"},uA={16:"s",20:"m",28:"l",36:"xl"},uO={1:"draw",2:"sans",3:"mono"},u$={"#ffffff":"grey","#000000":"black","#343a40":"black","#495057":"grey","#c92a2a":"red","#a61e4d":"light-red","#862e9c":"violet","#5f3dc4":"light-violet","#364fc7":"blue","#1864ab":"light-blue","#0b7285":"light-green","#087f5b":"light-green","#2b8a3e":"green","#5c940d":"light-green","#e67700":"yellow","#d9480f":"orange","#ced4da":"grey","#868e96":"grey","#fa5252":"light-red","#e64980":"red","#be4bdb":"light-violet","#7950f2":"violet","#4c6ef5":"blue","#228be6":"light-blue","#15aabf":"light-green","#12b886":"green","#40c057":"green","#82c91e":"light-green","#fab005":"yellow","#fd7e14":"orange","#212529":"grey"},uB={solid:"draw",dashed:"dashed",dotted:"dotted"},uD={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},uL={left:"start",center:"middle",right:"end"},uR={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"},uz=e=>{let t=uB[e.strokeStyle]??"draw";return"draw"===t&&0===e.roughness&&(t="solid"),t},uN=e=>"transparent"===e.backgroundColor?"none":uD[e.fillStyle]??"solid";async function uF(e,t,n,r){let i=(await Promise.all(t.map(async e=>await (await fetch(e)).blob()))).map(e=>new File([e],"tldrawFile",{type:e.type}));e.mark("paste"),await e.putExternalContent({type:"files",files:i,point:n,ignoreParent:!1,sources:r}),t.forEach(e=>URL.revokeObjectURL(e))}async function uU(e,t,n,r){try{if(new URL(t).pathname.match(/\.(png|jpe?g|gif|svg|webp)$/i)){let n=await fetch(t,{method:"HEAD"});if(n.headers.get("content-type")?.match(/^image\//)){e.mark("paste"),uF(e,[t]);return}}}catch(e){"Failed to fetch"!==e.message&&console.error(e)}return e.mark("paste"),await e.putExternalContent({type:"url",point:n,url:t,sources:r})}let uV=()=>void 0,uH=$.createContext({});function uZ({onEvent:e,children:t}){return(0,O.jsx)(uH.Provider,{value:e??uV,children:t})}function uK(){return $.useContext(uH)??uV}let uW=e=>{try{let t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch(e){return!1}},uY=e=>{let t=e.split(/[\n\s]/);for(let e of t)try{let t=new URL(e);if(!("http:"===t.protocol||"https:"===t.protocol))return}catch(e){return}return tI(t)},uG=e=>/^<svg/.test(e),uX=["input","select","textarea"];function uq(e){let{activeElement:t}=document;return e.getIsMenuOpen()||t&&(t.getAttribute("contenteditable")||uX.indexOf(t.tagName.toLowerCase())>-1)}async function uJ(e){return new Promise((t,n)=>{let r=new FileReader;r.addEventListener("loadend",()=>{t(r.result)}),r.addEventListener("error",()=>{n(r.error)}),r.readAsText(e)})}let uQ=e=>e.types.find(e=>e.match(/^image\//)),u0=(e,t,n,r)=>{let i=uY(t);if(i)for(let t of i)uU(e,t,n);else uW(t)?uU(e,t,n):uG(t)?(e.mark("paste"),e.putExternalContent({type:"svg-text",text:t,point:n,sources:r})):(e.mark("paste"),e.putExternalContent({type:"text",text:t,point:n,sources:r}))},u1=async(e,t,n)=>{if(null!==e.getEditingShapeId())return;if(!t)throw Error("No clipboard data");let r=[];for(let e of Object.values(t.items))switch(e.kind){case"file":r.push({type:"file",source:new Promise(t=>t(e.getAsFile()))});break;case"string":"text/html"===e.type?r.push({type:"html",source:new Promise(t=>e.getAsString(t))}):"text/plain"===e.type?r.push({type:"text",source:new Promise(t=>e.getAsString(t))}):r.push({type:e.type,source:new Promise(t=>e.getAsString(t))})}u5(e,r,n)},u2=async(e,t,n)=>{let r=[];for(let e of t){if(uQ(e))for(let t of e.types)t.match(/^image\//)&&r.push({type:"blob",source:e.getType(t)});e.types.includes("text/html")&&r.push({type:"html",source:new Promise(t=>e.getType("text/html").then(e=>uJ(e).then(t)))}),e.types.includes("text/uri-list")&&r.push({type:"url",source:new Promise(t=>e.getType("text/uri-list").then(e=>uJ(e).then(t)))}),e.types.includes("text/plain")&&r.push({type:"text",source:new Promise(t=>e.getType("text/plain").then(e=>uJ(e).then(t)))})}return await u5(e,r,n)};async function u5(e,t,n){let r=t.filter(e=>("file"===e.type||"blob"===e.type)&&null!==e.source);if(r.length){let t=(await Promise.all(r.map(e=>e.source))).filter(Boolean).map(e=>URL.createObjectURL(e));return await uF(e,t,n)}let i=await Promise.all(t.filter(e=>"file"!==e.type).map(e=>new Promise(t=>{if("file"===e.type){t({type:"error",data:null,reason:"unexpected file"});return}e.source.then(n=>{let r=n.match(/<tldraw[^>]*>(.*)<\/tldraw>/)?.[1];if(r)try{let e=(0,uT.decompressFromBase64)(r);if(null===e){t({type:"error",data:e,reason:"found tldraw data comment but could not parse base64"});return}{let n=JSON.parse(e);if("application/tldraw"!==n.type&&t({type:"error",data:n,reason:`found tldraw data comment but JSON was of a different type: ${n.type}`}),"string"==typeof n.data){t({type:"error",data:n,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}t({type:"tldraw",data:n.data});return}}catch(e){t({type:"error",data:r,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if("html"===e.type){t({type:"text",data:n,subtype:"html"});return}if("url"===e.type){t({type:"text",data:n,subtype:"url"});return}try{let e=JSON.parse(n);if("excalidraw/clipboard"===e.type){t({type:"excalidraw",data:e});return}t({type:"text",data:n,subtype:"json"});return}catch(e){t({type:"text",data:n,subtype:"text"});return}}t({type:"error",data:n,reason:"unhandled case"})})})));for(let t of i)if("tldraw"===t.type){!function(e,t,n){let r=n??(e.inputs.shiftKey?e.inputs.currentPagePoint:void 0);e.mark("paste"),e.putContentOntoCurrentPage(t,{point:r,select:!0})}(e,t.data,n);return}for(let t of i)if("excalidraw"===t.type){uj(e,t.data,n);return}for(let t of i)if("text"===t.type&&"html"===t.subtype){let r=new DOMParser().parseFromString(t.data,"text/html").querySelector("body");if(r&&1===Array.from(r.children).filter(e=>1===e.nodeType).length&&r.firstElementChild&&"A"===r.firstElementChild.tagName&&r.firstElementChild.hasAttribute("href")&&""!==r.firstElementChild.getAttribute("href")){u0(e,r.firstElementChild.getAttribute("href"),n,i);return}if(!i.some(e=>"text"===e.type&&"html"!==e.subtype)&&t.data.trim()){u0(e,function(e){let t=document.implementation.createHTMLDocument("");return t.documentElement.innerHTML=e.trim(),t.body.textContent||t.body.innerText||""}(t.data),n,i);return}}for(let t of i)if("text"===t.type&&"url"===t.subtype){uU(e,t.data,n,i);return}for(let t of i)if("text"===t.type&&"text"===t.subtype&&t.data.trim()){u0(e,t.data,n,i);return}}let u3=e=>{let t=e.getContentFromCurrentPage(e.getSelectedShapeIds());if(!t){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}let n=(0,uT.compressToBase64)(JSON.stringify({type:"application/tldraw",kind:"content",data:t}));if("undefined"!=typeof navigator){let r=t.shapes.map(t=>e.isShapeOfType(t,"text")||e.isShapeOfType(t,"geo")||e.isShapeOfType(t,"arrow")?t.props.text:e.isShapeOfType(t,"bookmark")||e.isShapeOfType(t,"embed")?t.props.url:null).filter(M.GT);if(navigator.clipboard?.write){let e=new Blob([`<tldraw>${n}</tldraw>`],{type:"text/html"}),t=r.join(" ");""===t&&(t=" "),navigator.clipboard.write([new ClipboardItem({"text/html":e,"text/plain":new Blob([t],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<tldraw>${n}</tldraw>`)}};function u8(){let e=(0,G.j)(),t=uK(),n=(0,$.useCallback)(function(n){0!==e.getSelectedShapeIds().length&&(u3(e),t("copy",{source:n}))},[e,t]),r=(0,$.useCallback)(function(n){0!==e.getSelectedShapeIds().length&&(u3(e),e.deleteShapes(e.getSelectedShapeIds()),t("cut",{source:n}))},[e,t]),i=(0,$.useCallback)(async function(n,r,o){null!==e.getEditingShapeId()||uq(e)||(Array.isArray(n)&&n[0]instanceof ClipboardItem?(u2(e,n,o),t("paste",{source:"menu"})):navigator.clipboard.read().then(e=>{i(e,r,o)}))},[e,t]);return{copy:n,cut:r,paste:i}}function u4(){let e=(0,G.j)(),t=uK(),n=(0,T.Hg)("editor.isFocused",()=>e.getInstanceState().isFocused,[e]);(0,$.useEffect)(()=>{if(!n)return;let r=()=>{0===e.getSelectedShapeIds().length||null!==e.getEditingShapeId()||uq(e)||(u3(e),t("copy",{source:"kbd"}))};function i(){0===e.getSelectedShapeIds().length||null!==e.getEditingShapeId()||uq(e)||(u3(e),e.deleteShapes(e.getSelectedShapeIds()),t("cut",{source:"kbd"}))}let o=!1,s=e=>{1===e.button&&(o=!0,requestAnimationFrame(()=>{o=!1}))},a=n=>{if(o){n.stopPropagation();return}null!==e.getEditingShapeId()||uq(e)||(n.clipboardData&&!e.inputs.shiftKey?u1(e,n.clipboardData):navigator.clipboard.read().then(t=>{Array.isArray(t)&&t[0]instanceof ClipboardItem&&u2(e,t,e.inputs.currentPagePoint)}),t("paste",{source:"kbd"}))};return document.addEventListener("copy",r),document.addEventListener("cut",i),document.addEventListener("paste",a),document.addEventListener("pointerup",s),()=>{document.removeEventListener("copy",r),document.removeEventListener("cut",i),document.removeEventListener("paste",a),document.removeEventListener("pointerup",s)}},[e,t,n])}async function u6(e,t,n){let{type:r,quality:i,scale:o}=n,s=+e.getAttribute("width"),a=+e.getAttribute("height"),[l,c]=await iT(s*o,a*o);l=Math.floor(l),c=Math.floor(c);let u=l/s,d=await u9(e),h=URL.createObjectURL(new Blob([d],{type:"image/svg+xml"})),p=await new Promise(e=>{let n=new Image;n.crossOrigin="anonymous",n.onload=async()=>{t&&await new Promise(e=>setTimeout(e,250));let r=document.createElement("canvas"),i=r.getContext("2d");r.width=l,r.height=c,i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(n,0,0,l,c),URL.revokeObjectURL(h),e(r)},n.onerror=()=>{e(null)},n.src=h});if(!p)return null;let f=await new Promise(e=>p.toBlob(t=>{(!t||N.throwToBlob.get())&&e(null),e(t)},"image/"+r,i));if(!f)return null;let g=new DataView(await f.arrayBuffer());return M.bM.setPhysChunk(g,u,{type:"image/"+r})}async function u9(e){let t=e.cloneNode(!0);e.setAttribute("width",+e.getAttribute("width")+""),e.setAttribute("height",+e.getAttribute("height")+"");let n=new FileReader;for(let e of Array.from(t.querySelectorAll("image"))){let t=e.getAttribute("xlink:href");if(t&&!t.startsWith("data:")){let r=await (await fetch(t)).blob(),i=await new Promise((e,t)=>{n.onload=()=>e(n.result),n.onerror=()=>t(n.error),n.readAsDataURL(r)});e.setAttribute("xlink:href",i)}}return new XMLSerializer().serializeToString(t).replaceAll("&#10;      ","").replaceAll(/((\s|")[0-9]*\.[0-9]{2})([0-9]*)(\b|"|\))/g,"$1")}async function u7(e,t,n){let r=await e.getSvg(t?.length?t:[...e.getCurrentPageShapeIds()],{scale:1,background:e.getInstanceState().exportBackground,...n});if(!r)throw Error("Could not construct SVG.");return r}async function de(e,t,n,r={}){switch(n){case"svg":return u9(await u7(e,t,r));case"json":return JSON.stringify(e.getContentFromCurrentPage(t));default:(0,M.iP)(n)}}async function dt(e,t,n,r={}){switch(n){case"svg":return new Blob([await de(e,t,"svg",r)],{type:"text/plain"});case"json":return new Blob([await de(e,t,"json",r)],{type:"text/plain"});case"jpeg":case"png":case"webp":{let i=await u6(await u7(e,t,r),e.environment.isSafari,{type:n,quality:1,scale:2});if(!i)throw Error("Could not construct image.");return i}default:(0,M.iP)(n)}}let dn={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",json:"text/plain",svg:"text/plain"};function dr(e,t,n="svg",r={}){if(!window.navigator.clipboard)return Promise.reject(Error("Copy not supported"));if(window.navigator.clipboard.write){let{blobPromise:i,mimeType:o}=function(e,t,n,r={}){return{blobPromise:dt(e,t,n,r),mimeType:dn[n]}}(e,t,n,r);return window.navigator.clipboard.write([new ClipboardItem({[o]:i})]).catch(e=>(console.error(e),i.then(e=>window.navigator.clipboard.write([new ClipboardItem({[o]:e})]))))}switch(n){case"json":case"svg":return di(async()=>de(e,t,n,r));case"jpeg":case"png":throw Error("Copy not supported");default:(0,M.iP)(n)}}async function di(e){await navigator.clipboard?.writeText?.(await e())}let ds=(0,$.createContext)({});function da({children:e}){let[t,n]=(0,$.useState)([]),r=(0,$.useCallback)(e=>{let t=e.id??(0,nh.E)();return n(n=>[...n.filter(t=>t.id!==e.id),{...e,id:t}]),t},[]),i=(0,$.useCallback)(e=>(n(t=>t.filter(t=>t.id!==e)),e),[]),o=(0,$.useCallback)(()=>{n(()=>[])},[]);return(0,O.jsx)(ds.Provider,{value:{toasts:t,addToast:r,removeToast:i,clearToasts:o},children:e})}function dl(){let e=(0,$.useContext)(ds);if(!e)throw Error("useToasts must be used within a ToastsProvider");return e}function dc(){let e=(0,G.j)(),{addToast:t}=dl(),n=l3();return(0,$.useCallback)((r,i="svg")=>{dr(e,r,i).catch(()=>{t({id:"copy-fail",icon:"warning-triangle",title:n("toast.error.copy-fail.title"),description:n("toast.error.copy-fail.desc")})})},[e,t,n])}let du=(0,$.createContext)({});function dd({children:e}){let t=(0,G.j)(),n=uK(),[r,i]=(0,$.useState)([]),o=(0,$.useCallback)(e=>{let r=e.id??(0,nh.E)();return i(t=>[...t.filter(t=>t.id!==e.id),{...e,id:r}]),n("open-menu",{source:"dialog",id:r}),t.addOpenMenu(r),r},[t,n]),s=(0,$.useCallback)((e,r)=>(i(t=>t.map(t=>t.id===e?{...t,...r}:t)),n("open-menu",{source:"dialog",id:e}),t.addOpenMenu(e),e),[t,n]),a=(0,$.useCallback)(e=>(i(t=>t.filter(t=>t.id!==e||(t.onClose?.(),!1))),n("close-menu",{source:"dialog",id:e}),t.deleteOpenMenu(e),e),[t,n]),l=(0,$.useCallback)(()=>{i(e=>(e.forEach(e=>{e.onClose?.(),n("close-menu",{source:"dialog",id:e.id}),t.deleteOpenMenu(e.id)}),[]))},[t,n]);return(0,O.jsx)(du.Provider,{value:{dialogs:r,addDialog:o,removeDialog:a,clearDialogs:l,updateDialog:s},children:e})}function dh(){let e=(0,$.useContext)(du);if(!e)throw Error("useDialogs must be used within a DialogsProvider");return e}async function dp(e,t,n="png",r={}){let i=`shapes at ${df()}`;if(1===t.length){let n=e.getShape(t[0]);i=e.isShapeOfType(n,"frame")?n.props.name??"frame":`${n.id.replace(/:/,"_")} at ${df()}`}i+=`.${n}`;let o=await dt(e,t,n,r);!function(e){let t=document.createElement("a"),n=URL.createObjectURL(e);t.href=n,t.download=e.name,t.click(),URL.revokeObjectURL(n)}(new File([o],i,{type:o.type}))}function df(){let e=new Date,t=String(e.getFullYear()).slice(2),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),s=String(e.getSeconds()).padStart(2,"0");return`${t}-${n}-${r} ${i}.${o}.${s}`}function dg(){let e=(0,G.j)(),{addToast:t}=dl(),n=l3();return(0,$.useCallback)((r,i="png")=>{dp(e,r,i,{scale:1,background:e.getInstanceState().exportBackground}).catch(e=>{console.error(e.message),t({id:"export-fail",title:n("toast.error.export-fail.title"),description:n("toast.error.export-fail.desc")})})},[e,t,n])}function dm(){let e=(0,G.j)(),t=(0,$.useRef)();return(0,$.useEffect)(()=>{let n=window.document.createElement("input");async function r(t){let r=t.target.files;r&&0!==r.length&&(await e.putExternalContent({type:"files",files:Array.from(r),point:e.getViewportPageBounds().center,ignoreParent:!1}),n.value="")}return n.type="file",n.accept="image/jpeg,image/png,image/gif,image/svg+xml,video/mp4,video/quicktime",n.multiple=!0,t.current=n,n.addEventListener("change",r),()=>{t.current=void 0,n.removeEventListener("change",r)}},[e]),(0,$.useCallback)(()=>{t.current?.click()},[t])}let dy=$.createContext({});function db({overrides:e,children:t}){let n=(0,G.j)(),{addDialog:r,clearDialogs:i}=dh(),{clearToasts:o}=dl(),s=dm(),a=function(){let e=(0,G.j)(),t=(0,$.useRef)(null),n=(0,$.useRef)(null);return(0,$.useCallback)(async function(){let r=document.createElement("div"),i=document.createElement("style"),o=(e,t)=>{e&&(e.innerHTML=""),t&&document.head.contains(t)&&document.head.removeChild(t),e&&document.body.contains(e)&&document.body.removeChild(e)};o(t.current,n.current),t.current=r,n.current=i;let s=`tl-print-surface-${(0,nh.E)()}`;r.className=s,i.innerHTML=`
			.${s} {
				display: none;
			}

			.${s} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${s} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${s}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${s}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${s}__item__header {
					display: none;
				}

				.${s}__item__footer {
					display: none;
					text-align: right;
				}

				.${s}__item__footer__hide {
					display: none;
				}

				
			}

		`;let a=()=>{document.head.appendChild(i),document.body.appendChild(r)},l=()=>{e.once("change-history",()=>{o(r,i)})};function c(e,t,n){try{r.innerHTML+=`<div class="${s}__item">
        <div class="${s}__item__header">
          ${e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${s}__item__main">
          ${n.outerHTML}
        </div>
        <div class="${s}__item__footer ${s}__item__footer__${t?"":"hide"}">
          ${t??""}
        </div>
      </div>`}catch(e){console.error(e)}}function u(){e.environment.isChromeForIos?(a(),window.print()):e.environment.isSafari?(a(),document.execCommand("print",!1)):window.print()}window.addEventListener("beforeprint",a),window.addEventListener("afterprint",l);let d=e.getSelectedShapeIds(),h=e.getCurrentPageId(),p=e.getPages(),f={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(e.getSelectedShapeIds().length>0){let t=await e.getSvg(d,f);if(t){let e=p.find(e=>e.id===h);c(`tldraw \u2014 ${e?.name}`,null,t),u()}}else{let t=e.getCurrentPage(),n=await e.getSvg(e.getSortedChildIdsForParent(t.id),f);n&&(c(`tldraw \u2014 ${t.name}`,null,n),u())}window.removeEventListener("beforeprint",a),window.removeEventListener("afterprint",l)},[e])}(),{cut:l,copy:c,paste:u}=u8(),d=dc(),h=dg(),p=uK(),f=$.useMemo(()=>{function t(){return n.isIn("select")||(n.complete(),n.setCurrentTool("select")),!1}function f(){return n.isIn("select")&&n.getSelectedShapeIds().length>0}let g=Object.fromEntries([{id:"edit-link",label:"action.edit-link",icon:"link",readonlyOk:!1,onSelect(e){f()&&(t()||(p("edit-link",{source:e}),n.mark("edit-link"),r({component:uE})))}},{id:"insert-embed",label:"action.insert-embed",readonlyOk:!1,kbd:"$i",onSelect(e){p("insert-embed",{source:e}),r({component:uP})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",readonlyOk:!1,onSelect(e){p("insert-media",{source:e}),s()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",readonlyOk:!1,onSelect(e){p("undo",{source:e}),n.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",readonlyOk:!1,onSelect(e){p("redo",{source:e}),n.redo()}},{id:"export-as-svg",label:"action.export-as-svg",menuLabel:"action.export-as-svg.short",contextMenuLabel:"action.export-as-svg.short",readonlyOk:!0,onSelect(e){p("export-as",{format:"svg",source:e}),h(n.getSelectedShapeIds(),"svg")}},{id:"export-as-png",label:"action.export-as-png",menuLabel:"action.export-as-png.short",contextMenuLabel:"action.export-as-png.short",readonlyOk:!0,onSelect(e){p("export-as",{format:"png",source:e}),h(n.getSelectedShapeIds(),"png")}},{id:"export-as-json",label:"action.export-as-json",menuLabel:"action.export-as-json.short",contextMenuLabel:"action.export-as-json.short",readonlyOk:!0,onSelect(e){p("export-as",{format:"json",source:e}),h(n.getSelectedShapeIds(),"json")}},{id:"copy-as-svg",label:"action.copy-as-svg",menuLabel:"action.copy-as-svg.short",contextMenuLabel:"action.copy-as-svg.short",kbd:"$!c",readonlyOk:!0,onSelect(e){p("copy-as",{format:"svg",source:e}),d(n.getSelectedShapeIds(),"svg")}},{id:"copy-as-png",label:"action.copy-as-png",menuLabel:"action.copy-as-png.short",contextMenuLabel:"action.copy-as-png.short",readonlyOk:!0,onSelect(e){p("copy-as",{format:"png",source:e}),d(n.getSelectedShapeIds(),"png")}},{id:"copy-as-json",label:"action.copy-as-json",menuLabel:"action.copy-as-json.short",contextMenuLabel:"action.copy-as-json.short",readonlyOk:!0,onSelect(e){p("copy-as",{format:"json",source:e}),d(n.getSelectedShapeIds(),"json")}},{id:"toggle-auto-size",label:"action.toggle-auto-size",readonlyOk:!1,onSelect(e){f()&&(t()||(p("toggle-auto-size",{source:e}),n.mark("toggling auto size"),n.updateShapes(n.getSelectedShapes().filter(e=>n.isShapeOfType(e,"text")&&!1===e.props.autoSize).map(e=>({id:e.id,type:e.type,props:{...e.props,w:8,autoSize:!0}})))))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(e){p("open-embed-link",{source:e});let t=n.getSelectedShapeIds(),r="No embed shapes selected";if(1!==t.length){console.error(r);return}let i=n.getShape(t[0]);if(!i||!n.isShapeOfType(i,"embed")){console.error(r);return}rK(i.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(e){if(n.root.getCurrent()?.id!=="zoom"&&(p("zoom-tool",{source:e}),!(n.inputs.shiftKey||n.inputs.ctrlKey))){let e=n.root.getCurrent();e&&e.getCurrent()?.id==="idle"&&n.setCurrentTool("zoom",{onInteractionEnd:e.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",readonlyOk:!1,onSelect(e){f()&&(t()||n.batch(()=>{p("convert-to-bookmark",{source:e});let t=n.getSelectedShapes(),r=[],i=[];for(let e of t){if(!e||!n.isShapeOfType(e,"embed")||!e.props.url)continue;let t=new eh.B(e.x,e.y);t.rot(-e.rotation),t.add(new eh.B(e.props.w/2-150,e.props.h/2-160)),t.rot(e.rotation);let o={id:(0,I.F1)(),type:"bookmark",rotation:e.rotation,x:t.x,y:t.y,opacity:1,props:{url:e.props.url}};r.push(o),i.push(e.id)}n.mark("convert shapes to bookmark"),n.deleteShapes(i),n.createShapes(r)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",readonlyOk:!1,onSelect(e){f()&&(t()||(p("convert-to-embed",{source:e}),n.batch(()=>{let e=n.getSelectedShapeIds(),t=(0,M.oA)(e.map(e=>n.getShape(e))),r=[],i=[];for(let e of t){if(!n.isShapeOfType(e,"bookmark"))continue;let{url:t}=e.props,o=iR(e.props.url);if(!o||!o.definition)continue;let{width:s,height:a}=o.definition,l=new eh.B(e.x,e.y);l.rot(-e.rotation),l.add(new eh.B(e.props.w/2-s/2,e.props.h/2-a/2)),l.rot(e.rotation);let c={id:(0,I.F1)(),type:"embed",x:l.x,y:l.y,rotation:e.rotation,props:{url:t,w:s,h:a}};r.push(c),i.push(e.id)}n.mark("convert shapes to embed"),n.deleteShapes(i),n.createShapes(r)})))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",readonlyOk:!1,onSelect(e){let r,i;if(!f()||t())return;p("duplicate-shapes",{source:e});let o=n.getInstanceState();if(o.duplicateProps)r=o.duplicateProps.shapeIds,i=o.duplicateProps.offset;else{r=n.getSelectedShapeIds();let e=rS.xu.Common((0,M.oA)(r.map(e=>n.getShapePageBounds(e))));i=o.canMoveCamera?{x:e.width+10,y:0}:{x:16/n.getZoomLevel(),y:16/n.getZoomLevel()}}n.mark("duplicate shapes"),n.duplicateShapes(r,i),o.duplicateProps&&n.updateInstanceState({duplicateProps:{...o.duplicateProps,shapeIds:n.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",readonlyOk:!1,onSelect(e){f()&&(t()||(p("ungroup-shapes",{source:e}),n.mark("ungroup"),n.ungroupShapes(n.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",readonlyOk:!1,onSelect(e){if(!f()||t())return;p("group-shapes",{source:e});let r=n.getOnlySelectedShape();r&&n.isShapeOfType(r,"group")?(n.mark("ungroup"),n.ungroupShapes(n.getSelectedShapeIds())):(n.mark("group"),n.groupShapes(n.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",readonlyOk:!1,onSelect(e){if(!f())return;p("remove-frame",{source:e});let t=n.getSelectedShapes();t.length>0&&t.every(e=>n.isShapeOfType(e,"frame"))&&(n.mark("remove-frame"),lW(n,t.map(e=>e.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",readonlyOk:!1,onSelect(e){if(!f())return;p("fit-frame-to-content",{source:e});let t=n.getOnlySelectedShape();t&&n.isShapeOfType(t,"frame")&&(n.mark("fit-frame-to-content"),lY(n,t.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",readonlyOk:!1,onSelect(e){f()&&(t()||(p("align-shapes",{operation:"left",source:e}),n.mark("align left"),n.alignShapes(n.getSelectedShapeIds(),"left")))}},{id:"align-center-horizontal",label:"action.align-center-horizontal",contextMenuLabel:"action.align-center-horizontal.short",kbd:"?H",icon:"align-center-horizontal",readonlyOk:!1,onSelect(e){f()&&(t()||(p("align-shapes",{operation:"center-horizontal",source:e}),n.mark("align center horizontal"),n.alignShapes(n.getSelectedShapeIds(),"center-horizontal")))}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",readonlyOk:!1,onSelect(e){f()&&(t()||(p("align-shapes",{operation:"right",source:e}),n.mark("align right"),n.alignShapes(n.getSelectedShapeIds(),"right")))}},{id:"align-center-vertical",label:"action.align-center-vertical",contextMenuLabel:"action.align-center-vertical.short",kbd:"?V",icon:"align-center-vertical",readonlyOk:!1,onSelect(e){f()&&(t()||(p("align-shapes",{operation:"center-vertical",source:e}),n.mark("align center vertical"),n.alignShapes(n.getSelectedShapeIds(),"center-vertical")))}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",readonlyOk:!1,onSelect(e){f()&&(t()||(p("align-shapes",{operation:"top",source:e}),n.mark("align top"),n.alignShapes(n.getSelectedShapeIds(),"top")))}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",readonlyOk:!1,onSelect(e){f()&&(t()||(p("align-shapes",{operation:"bottom",source:e}),n.mark("align bottom"),n.alignShapes(n.getSelectedShapeIds(),"bottom")))}},{id:"distribute-horizontal",label:"action.distribute-horizontal",contextMenuLabel:"action.distribute-horizontal.short",icon:"distribute-horizontal",kbd:"?!h",readonlyOk:!1,onSelect(e){f()&&(t()||(p("distribute-shapes",{operation:"horizontal",source:e}),n.mark("distribute horizontal"),n.distributeShapes(n.getSelectedShapeIds(),"horizontal")))}},{id:"distribute-vertical",label:"action.distribute-vertical",contextMenuLabel:"action.distribute-vertical.short",icon:"distribute-vertical",kbd:"?!V",readonlyOk:!1,onSelect(e){f()&&(t()||(p("distribute-shapes",{operation:"vertical",source:e}),n.mark("distribute vertical"),n.distributeShapes(n.getSelectedShapeIds(),"vertical")))}},{id:"stretch-horizontal",label:"action.stretch-horizontal",contextMenuLabel:"action.stretch-horizontal.short",icon:"stretch-horizontal",readonlyOk:!1,onSelect(e){f()&&(t()||(p("stretch-shapes",{operation:"horizontal",source:e}),n.mark("stretch horizontal"),n.stretchShapes(n.getSelectedShapeIds(),"horizontal")))}},{id:"stretch-vertical",label:"action.stretch-vertical",contextMenuLabel:"action.stretch-vertical.short",icon:"stretch-vertical",readonlyOk:!1,onSelect(e){f()&&(t()||(p("stretch-shapes",{operation:"vertical",source:e}),n.mark("stretch vertical"),n.stretchShapes(n.getSelectedShapeIds(),"vertical")))}},{id:"flip-horizontal",label:"action.flip-horizontal",contextMenuLabel:"action.flip-horizontal.short",kbd:"!h",readonlyOk:!1,onSelect(e){f()&&(t()||(p("flip-shapes",{operation:"horizontal",source:e}),n.mark("flip horizontal"),n.flipShapes(n.getSelectedShapeIds(),"horizontal")))}},{id:"flip-vertical",label:"action.flip-vertical",contextMenuLabel:"action.flip-vertical.short",kbd:"!v",readonlyOk:!1,onSelect(e){f()&&(t()||(p("flip-shapes",{operation:"vertical",source:e}),n.mark("flip vertical"),n.flipShapes(n.getSelectedShapeIds(),"vertical")))}},{id:"pack",label:"action.pack",icon:"pack",readonlyOk:!1,onSelect(e){f()&&(t()||(p("pack-shapes",{source:e}),n.mark("pack"),n.packShapes(n.getSelectedShapeIds(),16)))}},{id:"stack-vertical",label:"action.stack-vertical",contextMenuLabel:"action.stack-vertical.short",icon:"stack-vertical",readonlyOk:!1,onSelect(e){f()&&(t()||(p("stack-shapes",{operation:"vertical",source:e}),n.mark("stack-vertical"),n.stackShapes(n.getSelectedShapeIds(),"vertical",16)))}},{id:"stack-horizontal",label:"action.stack-horizontal",contextMenuLabel:"action.stack-horizontal.short",icon:"stack-horizontal",readonlyOk:!1,onSelect(e){f()&&(t()||(p("stack-shapes",{operation:"horizontal",source:e}),n.mark("stack-horizontal"),n.stackShapes(n.getSelectedShapeIds(),"horizontal",16)))}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",readonlyOk:!1,onSelect(e){f()&&(t()||(p("reorder-shapes",{operation:"toFront",source:e}),n.mark("bring to front"),n.bringToFront(n.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",readonlyOk:!1,onSelect(e){f()&&(t()||(p("reorder-shapes",{operation:"forward",source:e}),n.mark("bring forward"),n.bringForward(n.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",readonlyOk:!1,onSelect(e){f()&&(t()||(p("reorder-shapes",{operation:"backward",source:e}),n.mark("send backward"),n.sendBackward(n.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",readonlyOk:!1,onSelect(e){f()&&(t()||(p("reorder-shapes",{operation:"toBack",source:e}),n.mark("send to back"),n.sendToBack(n.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",readonlyOk:!1,onSelect(e){f()&&(t()||(n.mark("cut"),l(e)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(e){f()&&(t()||c(e))}},{id:"paste",label:"action.paste",kbd:"$v",readonlyOk:!1,onSelect(e){navigator.clipboard?.read().then(t=>{u(t,e,"context-menu"===e?n.inputs.currentPagePoint:void 0)})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(e){n.batch(()=>{t()||(p("select-all-shapes",{source:e}),n.mark("select all kbd"),n.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(e){f()&&(t()||(p("select-none-shapes",{source:e}),n.mark("select none"),n.selectNone()))}},{id:"delete",label:"action.delete",kbd:",del,backspace",icon:"trash",readonlyOk:!1,onSelect(e){f()&&(t()||(p("delete-shapes",{source:e}),n.mark("delete"),n.deleteShapes(n.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",readonlyOk:!1,onSelect(e){if(!f()||t())return;p("rotate-cw",{source:e}),n.mark("rotate-cw");let r=n.getSelectionRotation()%(eu.pj/2),i=(0,eu.C2)(r,0)||(0,eu.C2)(r,eu.pj/2);n.rotateShapesBy(n.getSelectedShapeIds(),eu.pj/2-(i?0:r))}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",readonlyOk:!1,onSelect(e){if(!f()||t())return;p("rotate-ccw",{source:e}),n.mark("rotate-ccw");let r=n.getSelectionRotation()%(eu.pj/2),i=(0,eu.C2)(r,0);n.rotateShapesBy(n.getSelectedShapeIds(),i?-(eu.pj/2):-r)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(e){p("zoom-in",{source:e}),n.zoomIn(n.getViewportScreenCenter(),{duration:L.KD})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(e){p("zoom-out",{source:e}),n.zoomOut(n.getViewportScreenCenter(),{duration:L.KD})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(e){p("reset-zoom",{source:e}),n.resetZoom(n.getViewportScreenCenter(),{duration:L.KD})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(e){p("zoom-to-fit",{source:e}),n.zoomToFit({duration:L.KD})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(e){f()&&(t()||(p("zoom-to-selection",{source:e}),n.zoomToSelection({duration:L.KD})))}},{id:"toggle-snap-mode",label:"action.toggle-snap-mode",menuLabel:"action.toggle-snap-mode.menu",readonlyOk:!1,onSelect(e){p("toggle-snap-mode",{source:e}),n.user.updateUserPreferences({isSnapMode:!n.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:"action.toggle-dark-mode",menuLabel:"action.toggle-dark-mode.menu",kbd:"$/",readonlyOk:!0,onSelect(e){p("toggle-dark-mode",{source:e}),n.user.updateUserPreferences({isDarkMode:!n.user.getIsDarkMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:"action.toggle-reduce-motion",menuLabel:"action.toggle-reduce-motion.menu",readonlyOk:!0,onSelect(e){p("toggle-reduce-motion",{source:e}),n.user.updateUserPreferences({animationSpeed:0===n.user.getAnimationSpeed()?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:"action.toggle-edge-scrolling",menuLabel:"action.toggle-edge-scrolling.menu",readonlyOk:!0,onSelect(e){p("toggle-edge-scrolling",{source:e}),n.user.updateUserPreferences({edgeScrollSpeed:0===n.user.getEdgeScrollSpeed()?1:0})},checkbox:!0},{id:"toggle-transparent",label:"action.toggle-transparent",menuLabel:"action.toggle-transparent.menu",contextMenuLabel:"action.toggle-transparent.context-menu",readonlyOk:!0,onSelect(e){p("toggle-transparent",{source:e}),n.updateInstanceState({exportBackground:!n.getInstanceState().exportBackground},{ephemeral:!0})},checkbox:!0},{id:"toggle-tool-lock",label:"action.toggle-tool-lock",menuLabel:"action.toggle-tool-lock.menu",readonlyOk:!1,kbd:"q",onSelect(e){p("toggle-tool-lock",{source:e}),n.updateInstanceState({isToolLocked:!n.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",readonlyOk:!1,onSelect(e){p("unlock-all",{source:e});let t=[];for(let e of n.getCurrentPageShapes())e.isLocked&&t.push({id:e.id,type:e.type,isLocked:!1});t.length>0&&n.updateShapes(t)}},{id:"toggle-focus-mode",label:"action.toggle-focus-mode",menuLabel:"action.toggle-focus-mode.menu",readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(e){requestAnimationFrame(()=>{n.batch(()=>{p("toggle-focus-mode",{source:e}),i(),o(),n.updateInstanceState({isFocusMode:!n.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:"action.toggle-grid",menuLabel:"action.toggle-grid.menu",readonlyOk:!0,kbd:"$'",onSelect(e){p("toggle-grid-mode",{source:e}),n.updateInstanceState({isGridMode:!n.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:"action.toggle-debug-mode",menuLabel:"action.toggle-debug-mode.menu",readonlyOk:!0,onSelect(e){p("toggle-debug-mode",{source:e}),n.updateInstanceState({isDebugMode:!n.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(e){p("print",{source:e}),a()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(e){p("exit-pen-mode",{source:e}),n.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(e){p("stop-following",{source:e}),n.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(e){p("zoom-to-content",{source:e}),n.zoomToContent()}},{id:"toggle-lock",label:"action.toggle-lock",readonlyOk:!1,kbd:"!l",onSelect(e){n.mark("locking"),p("toggle-lock",{source:e}),n.toggleLock(n.getSelectedShapeIds())}}].map(e=>[e.id,e]));return e?e(n,g,void 0):g},[n,p,e,r,s,h,d,l,c,u,i,o,a]);return(0,O.jsx)(dy.Provider,{value:f,children:t})}function dw(){let e=$.useContext(dy);if(!e)throw Error("useTools must be used within a ToolProvider");return e}function dx(e){return e.filter(e=>null!=e&&!1!==e)}function dv(e,...t){let n=dx(t);return 0===n.length?null:{id:e,type:"group",checkbox:n.every(e=>"item"===e.type&&e.actionItem.checkbox),disabled:n.every(e=>e.disabled),readonlyOk:n.some(e=>e.readonlyOk),children:n}}function dS(e,t,...n){let r=dx(n);return 0===r.length?null:{id:e,type:"submenu",label:t,children:r,disabled:r.every(e=>e.disabled),readonlyOk:r.some(e=>e.readonlyOk)}}function dk(e,t={}){let{readonlyOk:n=!0,disabled:r=!1}=t;return{id:e,type:"custom",disabled:r,readonlyOk:n}}function d_(e,t={}){if(!e)throw Error("No action item provided to menuItem");if(!e.label)throw Error("Trying to create menu item for action item that doesn't have a label");let{checked:n=!1,disabled:r=!1}=t;return{id:e.id,type:"item",actionItem:e,disabled:r,checked:n,readonlyOk:e.readonlyOk}}let dE=()=>{let e=(0,G.j)();return(0,T.Hg)("threeStackableItems",()=>e.getSelectedShapeIds().map(t=>e.getShape(t)).filter(t=>!(!t||e.isShapeOfType(t,"arrow")&&"binding"===t.props.start.type||e.isShapeOfType(t,"arrow")&&"binding"===t.props.end.type)).length>2,[e])},dC=()=>{let e=(0,G.j)();return(0,T.Hg)("allowGroup",()=>(function(e){let t=e.getSelectedShapes(),n=[],r=new Map;t.forEach(e=>{"arrow"===e.type?n.push(e):r.set(e.id,e)});let i=n.filter(e=>!!(("binding"!==e.props.start.type||r.has(e.props.start.boundShapeId))&&("binding"!==e.props.end.type||r.has(e.props.end.boundShapeId))));return Array.from(r.values()).concat(i)})(e).length>1,[e])},dP=()=>{let e=(0,G.j)();return(0,T.Hg)("allowUngroup",()=>e.getSelectedShapeIds().some(t=>e.getShape(t)?.type==="group"),[e])};function dT(e,t){let n=function e(t,n){let[r,...i]=n;if(!r)return null;let o=t.find(e=>e?.id===r);if(!o)return null;switch(o.type){case"group":case"submenu":return 0===i.length?o:e(o.children,i);case"item":case"custom":return 0===i.length?o:null;default:(0,M.iP)(o,"type")}}(e,t);return(0,M.hu)(n,`Menu item ${t.join(" > ")} not found`),n}let dj="undefined"!=typeof window&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read,dI=[0,390,428,468,580,640,840,1023],dM=$.createContext(0);function dA({forceMobile:e=!1,children:t}){let n=(0,G.j)(),r=(0,T.Hg)("breakpoint",()=>{let{width:t}=n.getViewportScreenBounds(),r=e?3:dI.length-1;for(let e=0;e<r;e++)if(t>dI[e]&&t<=dI[e+1])return e;return r},[n]);return(0,O.jsx)(dM.Provider,{value:r,children:t})}function dO(){return(0,$.useContext)(dM)}function d$(){let e=(0,G.j)();return(0,T.Hg)("hasLinkShapeSelected",()=>{let t=e.getSelectedShapes();return 1===t.length&&"url"in t[0].props&&"embed"!==t[0].type},[e])}let dB=$.createContext({}),dD=({overrides:e,children:t})=>{let n=(0,G.j)(),r=dw(),i=(0,T.Hg)("selected count",()=>n.getSelectedShapeIds().length,[n]),o=i>0,s=i>1,a=i>2,l=dE(),c=dC(),u=dP(),d=d$(),h=dO(),p=(0,T.Hg)("zoom is 1",()=>1===n.getZoomLevel(),[n]),f=(0,$.useMemo)(()=>{let t=[d_(r["align-left"],{disabled:!s}),d_(r["align-center-horizontal"],{disabled:!s}),d_(r["align-right"],{disabled:!s}),d_(r["stretch-horizontal"],{disabled:!s}),d_(r["align-top"],{disabled:!s}),d_(r["align-center-vertical"],{disabled:!s}),d_(r["align-bottom"],{disabled:!s}),d_(r["stretch-vertical"],{disabled:!s}),d_(r["distribute-horizontal"],{disabled:!a}),d_(r["distribute-vertical"],{disabled:!a}),d_(r["stack-horizontal"],{disabled:!l}),d_(r["stack-vertical"],{disabled:!l}),d_(r["send-to-back"],{disabled:!o}),d_(r["send-backward"],{disabled:!o}),d_(r["bring-forward"],{disabled:!o}),d_(r["bring-to-front"],{disabled:!o}),h<5?d_(r["zoom-to-100"],{disabled:!!p}):d_(r["rotate-ccw"],{disabled:!o}),d_(r["rotate-cw"],{disabled:!o}),d_(r["edit-link"],{disabled:!d}),c?d_(r.group,{disabled:!s}):u?d_(r.ungroup):d_(r.group,{disabled:!s})];return e?e(n,t,{actions:r,oneSelected:o,twoSelected:s,threeSelected:a}):t},[n,p,c,e,r,o,s,a,l,u,d,h]);return(0,O.jsx)(dB.Provider,{value:f,children:t})};function dL(){let e=$.useContext(dB);if(!e)throw Error("useActionsMenuSchema must be used inside of a ActionsMenuSchemaProvider.");return e}function dR(){let e=(0,G.j)();return(0,T.Hg)("showAutoSizeToggle",()=>{let t=e.getSelectedShapes();return 1===t.length&&e.isShapeOfType(t[0],"text")&&!1===t[0].props.autoSize},[e])}let dz=$.createContext({}),dN=(0,T.j)(function({overrides:e,children:t}){let n=(0,G.j)(),r=dw(),i=dR(),o=function(){let e=(0,G.j)();return(0,T.Hg)("onlyFlippableShape",()=>{let t=e.getSelectedShapes();return 1===t.length&&t.every(t=>e.isShapeOfType(t,"group")||e.isShapeOfType(t,"arrow")||e.isShapeOfType(t,"line")||e.isShapeOfType(t,"draw"))},[e])}(),s=n.getSelectedShapes(),a=s.length,l=a>0,c=a>1,u=a>2,d=dE(),h=(0,T.Hg)("atLeastOneShapeOnPage",()=>n.getCurrentPageShapeIds().size>0,[]),p=(0,T.Hg)("isTransparentBg",()=>n.getInstanceState().exportBackground,[]),f=dC(),g=dP(),m=!!window.navigator.clipboard?.write,y=d$(),b=n.getOnlySelectedShape(),w=l&&s.every(e=>n.isShapeOfType(e,"frame")),x=b&&n.isShapeOfType(b,"frame")&&n.getSortedChildIdsForParent(b).length>0,v=b&&n.isShapeOrAncestorLocked(b),S=(0,$.useMemo)(()=>dx([dv("selection",i&&d_(r["toggle-auto-size"]),y&&!v&&d_(r["edit-link"]),l&&!v&&d_(r.duplicate),f&&!v&&d_(r.group),g&&!v&&d_(r.ungroup),w&&!v&&d_(r["remove-frame"]),x&&!v&&d_(r["fit-frame-to-content"]),l&&d_(r["toggle-lock"])),dv("modify",(c||o)&&dS("arrange","context-menu.arrange",c&&dv("align",d_(r["align-left"]),d_(r["align-center-horizontal"]),d_(r["align-right"]),d_(r["align-top"]),d_(r["align-center-vertical"]),d_(r["align-bottom"])),u&&dv("distribute",d_(r["distribute-horizontal"]),d_(r["distribute-vertical"])),c&&dv("stretch",d_(r["stretch-horizontal"]),d_(r["stretch-vertical"])),o&&!v&&dv("flip",d_(r["flip-horizontal"]),d_(r["flip-vertical"])),c&&dv("order",d_(r.pack,{disabled:!c}),d&&d_(r["stack-vertical"]),d&&d_(r["stack-horizontal"]))),l&&!v&&dS("reorder","context-menu.reorder",dv("reorder",d_(r["bring-to-front"]),d_(r["bring-forward"]),d_(r["send-backward"]),d_(r["send-to-back"]))),l&&!v&&dk("MOVE_TO_PAGE_MENU",{readonlyOk:!1})),dv("clipboard-group",l&&!v&&d_(r.cut),l&&d_(r.copy),dj&&d_(r.paste)),h&&dv("conversions",dS("copy-as","context-menu.copy-as",dv("copy-as-group",d_(r["copy-as-svg"]),m&&d_(r["copy-as-png"]),d_(r["copy-as-json"])),dv("export-bg",d_(r["toggle-transparent"],{checked:!p}))),dS("export-as","context-menu.export-as",dv("export-as-group",d_(r["export-as-svg"]),d_(r["export-as-png"]),d_(r["export-as-json"])),dv("export-bg,",d_(r["toggle-transparent"],{checked:!p})))),h&&dv("set-selection-group",d_(r["select-all"]),l&&d_(r["select-none"])),l&&!v&&dv("delete-group",d_(r.delete))]),[r,l,c,u,i,o,h,d,f,g,w,x,m,y,p,v]),k=(0,T.Hg)("overrides",()=>e?e(n,S,{actions:r,oneSelected:l,twoSelected:c,threeSelected:u,showAutoSizeToggle:i,showUngroup:g,onlyFlippableShapeSelected:o}):S,[r,g,S,n,l,o,e,i,u,c]);return(0,O.jsx)(dz.Provider,{value:k,children:t})});function dF(){let e=$.useContext(dz);if(!e)throw Error("useContextMenuSchema must be used inside of a TLUiContextMenuSchemaProvider.");return e}let dU=$.createContext({});function dV({overrides:e,children:t}){let n=(0,G.j)(),r=uK(),{addDialog:i}=dh(),o=dm(),s=$.useMemo(()=>{let t=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(e){n.setCurrentTool("select"),r("select-tool",{source:e,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(e){n.setCurrentTool("hand"),r("select-tool",{source:e,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",readonlyOk:!1,onSelect(e){n.setCurrentTool("eraser"),r("select-tool",{source:e,id:"eraser"})}},{id:"draw",label:"tool.draw",readonlyOk:!1,icon:"tool-pencil",kbd:"d,b,x",onSelect(e){n.setCurrentTool("draw"),r("select-tool",{source:e,id:"draw"})}},...[...I.Zu.values].map(e=>({id:e,label:`tool.${e}`,readonlyOk:!1,meta:{geo:e},kbd:"rectangle"===e?"r":"ellipse"===e?"o":void 0,icon:"geo-"+e,onSelect(t){n.batch(()=>{n.updateInstanceState({stylesForNextShape:{...n.getInstanceState().stylesForNextShape,[I.Zu.id]:e}},{ephemeral:!0}),n.setCurrentTool("geo"),r("select-tool",{source:t,id:`geo-${e}`})})}})),{id:"arrow",label:"tool.arrow",readonlyOk:!1,icon:"tool-arrow",kbd:"a",onSelect(e){n.setCurrentTool("arrow"),r("select-tool",{source:e,id:"arrow"})}},{id:"line",label:"tool.line",readonlyOk:!1,icon:"tool-line",kbd:"l",onSelect(e){n.setCurrentTool("line"),r("select-tool",{source:e,id:"line"})}},{id:"frame",label:"tool.frame",readonlyOk:!1,icon:"tool-frame",kbd:"f",onSelect(e){n.setCurrentTool("frame"),r("select-tool",{source:e,id:"frame"})}},{id:"text",label:"tool.text",readonlyOk:!1,icon:"tool-text",kbd:"t",onSelect(e){n.setCurrentTool("text"),r("select-tool",{source:e,id:"text"})}},{id:"asset",label:"tool.asset",readonlyOk:!1,icon:"tool-media",kbd:"$u",onSelect(e){o(),r("select-tool",{source:e,id:"media"})}},{id:"note",label:"tool.note",readonlyOk:!1,icon:"tool-note",kbd:"n",onSelect(e){n.setCurrentTool("note"),r("select-tool",{source:e,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(e){n.setCurrentTool("laser"),r("select-tool",{source:e,id:"laser"})}},{id:"embed",label:"tool.embed",readonlyOk:!1,icon:"tool-embed",onSelect(e){i({component:uP}),r("select-tool",{source:e,id:"embed"})}}];t.push({id:"highlight",label:"tool.highlight",readonlyOk:!1,icon:"tool-highlight",kbd:"!d",onSelect(e){n.setCurrentTool("highlight"),r("select-tool",{source:e,id:"highlight"})}});let s=Object.fromEntries(t.map(e=>[e.id,e]));return e?e(n,s,{insertMedia:o}):s},[e,n,r,o,i]);return(0,O.jsx)(dU.Provider,{value:s,children:t})}function dH(){let e=$.useContext(dU);if(!e)throw Error("useTools must be used within a ToolProvider");return e}let dZ=$.createContext({}),dK=(0,T.j)(function({overrides:e,children:t}){let n=(0,G.j)(),r=dH(),i=dw(),o=(0,$.useMemo)(()=>{let t=(0,M.oA)([dv("shortcuts-dialog.tools",d_(i["toggle-tool-lock"]),d_(r.select),d_(r.draw),d_(r.eraser),d_(r.hand),d_(r.rectangle),d_(r.ellipse),d_(r.arrow),d_(r.line),d_(r.text),d_(r.frame),d_(r.note),d_(r.laser)),dv("shortcuts-dialog.file",d_(i["insert-media"]),d_(i.print)),dv("shortcuts-dialog.preferences",d_(i["toggle-dark-mode"]),d_(i["toggle-focus-mode"]),d_(i["toggle-grid"])),dv("shortcuts-dialog.edit",d_(i.undo),d_(i.redo),d_(i.cut),d_(i.copy),d_(i.paste),d_(i["select-all"]),d_(i.delete),d_(i.duplicate),d_(i["export-as-svg"]),d_(i["export-as-png"])),dv("shortcuts-dialog.view",d_(i["zoom-in"]),d_(i["zoom-out"]),d_(i["zoom-to-100"]),d_(i["zoom-to-fit"]),d_(i["zoom-to-selection"])),dv("shortcuts-dialog.transform",d_(i["bring-to-front"]),d_(i["bring-forward"]),d_(i["send-backward"]),d_(i["send-to-back"]),d_(i.group),d_(i.ungroup),d_(i["flip-horizontal"]),d_(i["flip-vertical"]),d_(i["align-top"]),d_(i["align-center-vertical"]),d_(i["align-bottom"]),d_(i["align-left"]),d_(i["align-center-horizontal"]),d_(i["align-right"]))]);return e?e(n,t,{tools:r,actions:i}):t},[n,e,i,r]);return(0,O.jsx)(dZ.Provider,{value:o,children:t})});function dW(){let e=$.useContext(dZ);if(!e)throw Error("Shortcuts must be used inside of a ShortcutsProvider.");return e}let dY=()=>{let e=l3(),t=r3(),n=dW();return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(ub,{className:"tlui-shortcuts-dialog__header",children:[(0,O.jsx)(uw,{children:e("shortcuts-dialog.title")}),(0,O.jsx)(ux,{})]}),(0,O.jsx)(uv,{className:"tlui-shortcuts-dialog__body",children:n.map(function n(r){if(!r||t&&!r.readonlyOk)return null;switch(r.type){case"group":return(0,O.jsxs)("div",{className:"tlui-shortcuts-dialog__group",children:[(0,O.jsx)("h2",{className:"tlui-shortcuts-dialog__group__title",children:e(r.id)}),(0,O.jsx)("div",{className:"tlui-shortcuts-dialog__group__content",children:r.children.filter(e=>e&&"item"===e.type&&e.actionItem.kbd).map(n)})]},r.id);case"item":{let{id:t,label:n,shortcutsLabel:i,kbd:o}=r.actionItem;return(0,O.jsxs)("div",{className:"tlui-shortcuts-dialog__key-pair",children:[(0,O.jsx)("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:e(i??n)}),(0,O.jsx)("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:(0,O.jsx)(ct,{children:o})})]},t)}}})}),(0,O.jsx)("div",{className:"tlui-dialog__scrim"})]})};function dG(){let e=(0,G.j)();return{languages:I.a2,currentLanguage:e.user.getLocale()}}let dX=$.createContext({}),dq=(0,T.j)(function({overrides:e,children:t}){let n=(0,G.j)(),r=dw(),i=n.getSelectedShapeIds().length,o=i>0,s=i>1,a=i>2,{languages:l,currentLanguage:c}=dG(),{addDialog:u}=dh(),d=(0,$.useMemo)(()=>{let t=(0,M.oA)([dv("top",dk("LANGUAGE_MENU",{readonlyOk:!0}),d_({id:"keyboard-shortcuts",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect(){u({component:dY})}}))]);return e?e(n,t,{actions:r,currentLanguage:c,languages:l,oneSelected:o,twoSelected:s,threeSelected:a}):t},[n,e,l,r,o,s,a,c,u]);return(0,O.jsx)(dX.Provider,{value:d,children:t})});function dJ(){let e=$.useContext(dX);if(!e)throw Error("useHelpMenuSchema must be used inside of a helpTLUiMenuSchemaProvider.");return e}function dQ(){let e=(0,G.j)();return(0,T.Hg)("useCanRedo",()=>e.getCanRedo(),[e])}function d0(){let e=(0,G.j)();return(0,T.Hg)("useCanUndo",()=>e.getCanUndo(),[e])}let d1=$.createContext({});function d2({overrides:e,children:t}){let n=(0,G.j)(),r=dw(),i=5>dO(),o=(0,T.Hg)("isDarkMode",()=>n.user.getIsDarkMode(),[n]),s=(0,T.Hg)("animationSpeed",()=>n.user.getAnimationSpeed(),[n]),a=(0,T.Hg)("edgeScrollSpeed",()=>n.user.getEdgeScrollSpeed(),[n]),l=(0,T.Hg)("isGridMode",()=>n.getInstanceState().isGridMode,[n]),c=(0,T.Hg)("isSnapMode",()=>n.user.getIsSnapMode(),[n]),u=(0,T.Hg)("isToolLock",()=>n.getInstanceState().isToolLocked,[n]),d=(0,T.Hg)("isFocusMode",()=>n.getInstanceState().isFocusMode,[n]),h=(0,T.Hg)("isDebugMode",()=>n.getInstanceState().isDebugMode,[n]),p=(0,T.Hg)("exportBackground",()=>n.getInstanceState().exportBackground,[n]),f=(0,T.Hg)("emptyPage",()=>0===n.getCurrentPageShapeIds().size,[n]),g=(0,T.Hg)("selectedCount",()=>n.getSelectedShapeIds().length,[n]),m=0===g,y=g>0,b=g>1,w=g>2,x=!!window.navigator.clipboard?.write,v=d$(),S=dR(),k=dC(),_=dP(),E=d0(),C=dQ(),P=(0,T.Hg)("isZoomedTo100",()=>1===n.getZoomLevel(),[n]),j=(0,T.Hg)("oneEmbedSelected",()=>{let e=n.getOnlySelectedShape();return!!e&&!!(n.isShapeOfType(e,"embed")&&e.props.url&&!n.isShapeOrAncestorLocked(e))},[]),I=(0,T.Hg)("oneEmbeddableBookmarkSelected",()=>{let e=n.getOnlySelectedShape();return!!e&&!!(n.isShapeOfType(e,"bookmark")&&e.props.url&&iR(e.props.url)&&!n.isShapeOrAncestorLocked(e))},[]),M=(0,$.useMemo)(()=>{let t=dx([dv("menu",dS("file","menu.file",dv("print",d_(r.print,{disabled:f}))),dS("edit","menu.edit",dv("undo-actions",d_(r.undo,{disabled:!E}),d_(r.redo,{disabled:!C})),dv("clipboard-actions",d_(r.cut,{disabled:m}),d_(r.copy,{disabled:m}),d_(r.paste,{disabled:!dj})),dv("conversions",dS("copy-as","menu.copy-as",dv("copy-as-group",d_(r["copy-as-svg"],{disabled:f}),d_(r["copy-as-png"],{disabled:f||!x}),d_(r["copy-as-json"],{disabled:f})),dv("export-bg",d_(r["toggle-transparent"],{checked:!p}))),dS("export-as","menu.export-as",dv("export-as-group",d_(r["export-as-svg"],{disabled:f}),d_(r["export-as-png"],{disabled:f}),d_(r["export-as-json"],{disabled:f})),dv("export-bg",d_(r["toggle-transparent"],{checked:!p})))),dv("set-selection-group",d_(r["select-all"],{disabled:f}),d_(r["select-none"],{disabled:!y})),dv("selection",S&&d_(r["toggle-auto-size"]),v&&d_(r["edit-link"]),d_(r.duplicate,{disabled:!y}),k&&d_(r.group),_&&d_(r.ungroup),d_(r["unlock-all"],{disabled:f})),dv("delete-group",d_(r.delete,{disabled:!y})),dv("embeds",j&&d_(r["open-embed-link"]),j&&d_(r["convert-to-bookmark"]),I&&d_(r["convert-to-embed"]))),dS("view","menu.view",dv("view-actions",d_(r["zoom-in"]),d_(r["zoom-out"]),d_(r["zoom-to-100"],{disabled:P}),d_(r["zoom-to-fit"],{disabled:f}),d_(r["zoom-to-selection"],{disabled:f||!y})))),dv("extras",d_(r["insert-embed"]),d_(r["insert-media"])),dv("preferences",dS("preferences","menu.preferences",dv("preferences-actions",d_(r["toggle-snap-mode"],{checked:c}),d_(r["toggle-tool-lock"],{checked:u}),d_(r["toggle-grid"],{checked:l}),d_(r["toggle-dark-mode"],{checked:o}),d_(r["toggle-focus-mode"],{checked:d}),d_(r["toggle-edge-scrolling"],{checked:1===a}),d_(r["toggle-reduce-motion"],{checked:0===s}),d_(r["toggle-debug-mode"],{checked:h}))),i&&dk("LANGUAGE_MENU",{readonlyOk:!0}))]);return e?e(n,t,{actions:r,noneSelected:m,oneSelected:y,twoSelected:b,threeSelected:w}):t},[n,e,r,y,b,w,f,i,k,_,v,x,S,m,E,C,s,o,l,c,u,d,p,h,a,P,I,j]);return(0,O.jsx)(d1.Provider,{value:M,children:t})}function d5(){let e=$.useContext(d1);if(!e)throw Error("useMenuSchema must be used inside of a TLUiMenuSchemaProvider.");return e}function d3(e){return{id:e.id,type:"item",readonlyOk:e.readonlyOk,toolItem:e}}let d8=$.createContext([]);function d4({overrides:e,children:t}){let n=(0,G.j)(),r=dH(),i=$.useMemo(()=>{let t=(0,M.oA)([d3(r.select),d3(r.hand),d3(r.draw),d3(r.eraser),d3(r.arrow),d3(r.text),d3(r.note),d3(r.asset),d3(r.rectangle),d3(r.ellipse),d3(r.diamond),d3(r.triangle),d3(r.trapezoid),d3(r.rhombus),d3(r.hexagon),d3(r.cloud),d3(r.star),d3(r.oval),d3(r["x-box"]),d3(r["check-box"]),d3(r["arrow-left"]),d3(r["arrow-up"]),d3(r["arrow-down"]),d3(r["arrow-right"]),d3(r.line),d3(r.highlight),d3(r.frame),d3(r.laser)]);return e?e(n,t,{tools:r}):t},[n,e,r]);return(0,O.jsx)(d8.Provider,{value:i,children:t})}function d6(){let e=$.useContext(d8);if(!e)throw Error("useToolbarSchema must be used within a ToolbarSchemaProvider");return e}function d9(){let{addToast:e,removeToast:t,clearToasts:n}=dl(),{addDialog:r,clearDialogs:i,removeDialog:o,updateDialog:s}=dh(),a=5>dO(),l=l3();return(0,$.useMemo)(()=>({addToast:e,removeToast:t,clearToasts:n,addDialog:r,clearDialogs:i,removeDialog:o,updateDialog:s,msg:l,isMobile:a}),[r,e,i,n,l,o,t,s,a])}function d7(e){return(0,$.useMemo)(()=>e,e)}function he({overrides:e,assetUrls:t,onUiEvent:n,forceMobile:r,children:i}){return(0,O.jsx)(lX,{assetUrls:t?{fonts:Object.assign({...lZ.fonts},{...t?.fonts}),icons:Object.assign({...lZ.icons},{...t?.icons}),embedIcons:Object.assign({...lZ.embedIcons},{...t?.embedIcons}),translations:Object.assign({...lZ.translations},{...t?.translations})}:lZ,children:(0,O.jsx)(l5,{overrides:function(e){let t=d7(null==e?[]:Array.isArray(e)?e:[e]);return(0,$.useMemo)(()=>{let e={};for(let n of t)if(n.translations)for(let[t,r]of(0,M.EP)(n.translations)){let n=e[t];n||(n=e[t]={}),Object.assign(n,r)}return e},[t])}(e),children:(0,O.jsx)(uZ,{onEvent:n,children:(0,O.jsx)(da,{children:(0,O.jsx)(dd,{children:(0,O.jsx)(dA,{forceMobile:r,children:(0,O.jsx)(ht,{overrides:e,children:i})})})})})})})}function ht({overrides:e,children:t}){let n=function(e){let t=d9(),n=d7(null==e?[]:Array.isArray(e)?e:[e]);return(0,$.useMemo)(()=>(function(e,t){let n={};for(let t of e)if(t.translations)for(let[e,r]of(0,M.EP)(t.translations)){let t=n[e];t||(t=n[e]={}),Object.assign(t,r)}return{actionsMenu:(n,r,i)=>{for(let o of e)o.actionsMenu&&(r=o.actionsMenu(n,r,{...t,...i}));return r},actions:(n,r)=>{for(let i of e)i.actions&&(r=i.actions(n,r,t));return r},contextMenu:(n,r,i)=>{for(let o of e)o.contextMenu&&(r=o.contextMenu(n,r,{...t,...i}));return r},helpMenu:(n,r,i)=>{for(let o of e)o.helpMenu&&(r=o.helpMenu(n,r,{...t,...i}));return r},menu:(n,r,i)=>{for(let o of e)o.menu&&(r=o.menu(n,r,{...t,...i}));return r},toolbar:(n,r,i)=>{for(let o of e)o.toolbar&&(r=o.toolbar(n,r,{...t,...i}));return r},keyboardShortcutsMenu:(n,r,i)=>{for(let o of e)o.keyboardShortcutsMenu&&(r=o.keyboardShortcutsMenu(n,r,{...t,...i}));return r},tools:(n,r,i)=>{for(let o of e)o.tools&&(r=o.tools(n,r,{...t,...i}));return r},translations:n}})(n,t),[n,t])}(e);return(0,O.jsx)(db,{overrides:n.actions,children:(0,O.jsx)(dV,{overrides:n.tools,children:(0,O.jsx)(d4,{overrides:n.toolbar,children:(0,O.jsx)(dD,{overrides:n.actionsMenu,children:(0,O.jsx)(dK,{overrides:n.keyboardShortcutsMenu,children:(0,O.jsx)(dN,{overrides:n.contextMenu,children:(0,O.jsx)(dq,{overrides:n.helpMenu,children:(0,O.jsx)(d2,{overrides:n.menu,children:t})})})})})})})})}function hn(){let e=(0,G.j)(),t=dw()["back-to-content"],[n,r]=(0,$.useState)(!1);return((0,$.useEffect)(()=>{let t=!1,n=setInterval(()=>{let n=e.getRenderingShapes(),i=e.getRenderingBounds(),o=0===n.filter(e=>e.maskedPageBounds&&i.includes(e.maskedPageBounds)).length&&e.getCurrentPageShapes().length>0;t!==o&&(r(o),t=o)},1e3);return()=>{clearInterval(n)}},[e]),n)?(0,O.jsx)(cn,{iconLeft:t.icon,label:t.label,type:"low",onClick:()=>{t.onSelect("helper-buttons"),r(!1)}}):null}let hr=(0,$.createContext)(void 0);function hi(e){let t=(0,$.useContext)(hr);return e||t||"ltr"}let ho=["top","right","bottom","left"],hs=Math.min,ha=Math.max,hl=Math.round,hc=Math.floor,hu=e=>({x:e,y:e}),hd={left:"right",right:"left",bottom:"top",top:"bottom"},hh={start:"end",end:"start"};function hp(e,t){return"function"==typeof e?e(t):e}function hf(e){return e.split("-")[0]}function hg(e){return e.split("-")[1]}function hm(e){return"x"===e?"y":"x"}function hy(e){return"y"===e?"height":"width"}function hb(e){return["top","bottom"].includes(hf(e))?"y":"x"}function hw(e){return e.replace(/start|end/g,e=>hh[e])}function hx(e){return e.replace(/left|right|bottom|top/g,e=>hd[e])}function hv(e){return"number"!=typeof e?{top:0,right:0,bottom:0,left:0,...e}:{top:e,right:e,bottom:e,left:e}}function hS(e){return{...e,top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}function hk(e,t,n){let r,{reference:i,floating:o}=e,s=hb(t),a=hm(hb(t)),l=hy(a),c=hf(t),u="y"===s,d=i.x+i.width/2-o.width/2,h=i.y+i.height/2-o.height/2,p=i[l]/2-o[l]/2;switch(c){case"top":r={x:d,y:i.y-o.height};break;case"bottom":r={x:d,y:i.y+i.height};break;case"right":r={x:i.x+i.width,y:h};break;case"left":r={x:i.x-o.width,y:h};break;default:r={x:i.x,y:i.y}}switch(hg(t)){case"start":r[a]-=p*(n&&u?-1:1);break;case"end":r[a]+=p*(n&&u?-1:1)}return r}let h_=async(e,t,n)=>{let{placement:r="bottom",strategy:i="absolute",middleware:o=[],platform:s}=n,a=o.filter(Boolean),l=await (null==s.isRTL?void 0:s.isRTL(t)),c=await s.getElementRects({reference:e,floating:t,strategy:i}),{x:u,y:d}=hk(c,r,l),h=r,p={},f=0;for(let n=0;n<a.length;n++){let{name:o,fn:g}=a[n],{x:m,y:y,data:b,reset:w}=await g({x:u,y:d,initialPlacement:r,placement:h,strategy:i,middlewareData:p,rects:c,platform:s,elements:{reference:e,floating:t}});if(u=null!=m?m:u,d=null!=y?y:d,p={...p,[o]:{...p[o],...b}},w&&f<=50){f++,"object"==typeof w&&(w.placement&&(h=w.placement),w.rects&&(c=!0===w.rects?await s.getElementRects({reference:e,floating:t,strategy:i}):w.rects),{x:u,y:d}=hk(c,h,l)),n=-1;continue}}return{x:u,y:d,placement:h,strategy:i,middlewareData:p}};async function hE(e,t){var n;void 0===t&&(t={});let{x:r,y:i,platform:o,rects:s,elements:a,strategy:l}=e,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:p=0}=hp(t,e),f=hv(p),g=a[h?"floating"===d?"reference":"floating":d],m=hS(await o.getClippingRect({element:null==(n=await (null==o.isElement?void 0:o.isElement(g)))||n?g:g.contextElement||await (null==o.getDocumentElement?void 0:o.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),y="floating"===d?{...s.floating,x:r,y:i}:s.reference,b=await (null==o.getOffsetParent?void 0:o.getOffsetParent(a.floating)),w=await (null==o.isElement?void 0:o.isElement(b))&&await (null==o.getScale?void 0:o.getScale(b))||{x:1,y:1},x=hS(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({rect:y,offsetParent:b,strategy:l}):y);return{top:(m.top-x.top+f.top)/w.y,bottom:(x.bottom-m.bottom+f.bottom)/w.y,left:(m.left-x.left+f.left)/w.x,right:(x.right-m.right+f.right)/w.x}}let hC=e=>({name:"arrow",options:e,async fn(t){let{x:n,y:r,placement:i,rects:o,platform:s,elements:a,middlewareData:l}=t,{element:c,padding:u=0}=hp(e,t)||{};if(null==c)return{};let d=hv(u),h={x:n,y:r},p=hm(hb(i)),f=hy(p),g=await s.getDimensions(c),m="y"===p,y=m?"clientHeight":"clientWidth",b=o.reference[f]+o.reference[p]-h[p]-o.floating[f],w=h[p]-o.reference[p],x=await (null==s.getOffsetParent?void 0:s.getOffsetParent(c)),v=x?x[y]:0;v&&await (null==s.isElement?void 0:s.isElement(x))||(v=a.floating[y]||o.floating[f]);let S=v/2-g[f]/2-1,k=hs(d[m?"top":"left"],S),_=hs(d[m?"bottom":"right"],S),E=v-g[f]-_,C=v/2-g[f]/2+(b/2-w/2),P=ha(k,hs(C,E)),T=!l.arrow&&null!=hg(i)&&C!=P&&o.reference[f]/2-(C<k?k:_)-g[f]/2<0,j=T?C<k?C-k:C-E:0;return{[p]:h[p]+j,data:{[p]:P,centerOffset:C-P-j,...T&&{alignmentOffset:j}},reset:T}}});function hP(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function hT(e){return ho.some(t=>e[t]>=0)}async function hj(e,t){let{placement:n,platform:r,elements:i}=e,o=await (null==r.isRTL?void 0:r.isRTL(i.floating)),s=hf(n),a=hg(n),l="y"===hb(n),c=["left","top"].includes(s)?-1:1,u=o&&l?-1:1,d=hp(t,e),{mainAxis:h,crossAxis:p,alignmentAxis:f}="number"==typeof d?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...d};return a&&"number"==typeof f&&(p="end"===a?-1*f:f),l?{x:p*u,y:h*c}:{x:h*c,y:p*u}}function hI(e){return hO(e)?(e.nodeName||"").toLowerCase():"#document"}function hM(e){var t;return(null==e?void 0:null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function hA(e){var t;return null==(t=(hO(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function hO(e){return e instanceof Node||e instanceof hM(e).Node}function h$(e){return e instanceof Element||e instanceof hM(e).Element}function hB(e){return e instanceof HTMLElement||e instanceof hM(e).HTMLElement}function hD(e){return"undefined"!=typeof ShadowRoot&&(e instanceof ShadowRoot||e instanceof hM(e).ShadowRoot)}function hL(e){let{overflow:t,overflowX:n,overflowY:r,display:i}=hF(e);return/auto|scroll|overlay|hidden|clip/.test(t+r+n)&&!["inline","contents"].includes(i)}function hR(e){let t=hz(),n=hF(e);return"none"!==n.transform||"none"!==n.perspective||!!n.containerType&&"normal"!==n.containerType||!t&&!!n.backdropFilter&&"none"!==n.backdropFilter||!t&&!!n.filter&&"none"!==n.filter||["transform","perspective","filter"].some(e=>(n.willChange||"").includes(e))||["paint","layout","strict","content"].some(e=>(n.contain||"").includes(e))}function hz(){return"undefined"!=typeof CSS&&!!CSS.supports&&CSS.supports("-webkit-backdrop-filter","none")}function hN(e){return["html","body","#document"].includes(hI(e))}function hF(e){return hM(e).getComputedStyle(e)}function hU(e){return h$(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function hV(e){if("html"===hI(e))return e;let t=e.assignedSlot||e.parentNode||hD(e)&&e.host||hA(e);return hD(t)?t.host:t}function hH(e,t,n){var r;void 0===t&&(t=[]),void 0===n&&(n=!0);let i=function e(t){let n=hV(t);return hN(n)?t.ownerDocument?t.ownerDocument.body:t.body:hB(n)&&hL(n)?n:e(n)}(e),o=i===(null==(r=e.ownerDocument)?void 0:r.body),s=hM(i);return o?t.concat(s,s.visualViewport||[],hL(i)?i:[],s.frameElement&&n?hH(s.frameElement):[]):t.concat(i,hH(i,[],n))}function hZ(e){let t=hF(e),n=parseFloat(t.width)||0,r=parseFloat(t.height)||0,i=hB(e),o=i?e.offsetWidth:n,s=i?e.offsetHeight:r,a=hl(n)!==o||hl(r)!==s;return a&&(n=o,r=s),{width:n,height:r,$:a}}function hK(e){return h$(e)?e:e.contextElement}function hW(e){let t=hK(e);if(!hB(t))return hu(1);let n=t.getBoundingClientRect(),{width:r,height:i,$:o}=hZ(t),s=(o?hl(n.width):n.width)/r,a=(o?hl(n.height):n.height)/i;return s&&Number.isFinite(s)||(s=1),a&&Number.isFinite(a)||(a=1),{x:s,y:a}}let hY=hu(0);function hG(e){let t=hM(e);return hz()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:hY}function hX(e,t,n,r){var i;void 0===t&&(t=!1),void 0===n&&(n=!1);let o=e.getBoundingClientRect(),s=hK(e),a=hu(1);t&&(r?h$(r)&&(a=hW(r)):a=hW(e));let l=(void 0===(i=n)&&(i=!1),r&&(!i||r===hM(s))&&i)?hG(s):hu(0),c=(o.left+l.x)/a.x,u=(o.top+l.y)/a.y,d=o.width/a.x,h=o.height/a.y;if(s){let e=hM(s),t=r&&h$(r)?hM(r):r,n=e.frameElement;for(;n&&r&&t!==e;){let e=hW(n),t=n.getBoundingClientRect(),r=hF(n),i=t.left+(n.clientLeft+parseFloat(r.paddingLeft))*e.x,o=t.top+(n.clientTop+parseFloat(r.paddingTop))*e.y;c*=e.x,u*=e.y,d*=e.x,h*=e.y,c+=i,u+=o,n=hM(n).frameElement}}return hS({width:d,height:h,x:c,y:u})}function hq(e){return hX(hA(e)).left+hU(e).scrollLeft}function hJ(e,t,n){let r;if("viewport"===t)r=function(e,t){let n=hM(e),r=hA(e),i=n.visualViewport,o=r.clientWidth,s=r.clientHeight,a=0,l=0;if(i){o=i.width,s=i.height;let e=hz();(!e||e&&"fixed"===t)&&(a=i.offsetLeft,l=i.offsetTop)}return{width:o,height:s,x:a,y:l}}(e,n);else if("document"===t)r=function(e){let t=hA(e),n=hU(e),r=e.ownerDocument.body,i=ha(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),o=ha(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight),s=-n.scrollLeft+hq(e),a=-n.scrollTop;return"rtl"===hF(r).direction&&(s+=ha(t.clientWidth,r.clientWidth)-i),{width:i,height:o,x:s,y:a}}(hA(e));else if(h$(t))r=function(e,t){let n=hX(e,!0,"fixed"===t),r=n.top+e.clientTop,i=n.left+e.clientLeft,o=hB(e)?hW(e):hu(1),s=e.clientWidth*o.x;return{width:s,height:e.clientHeight*o.y,x:i*o.x,y:r*o.y}}(t,n);else{let n=hG(e);r={...t,x:t.x-n.x,y:t.y-n.y}}return hS(r)}function hQ(e,t){return hB(e)&&"fixed"!==hF(e).position?t?t(e):e.offsetParent:null}function h0(e,t){let n=hM(e);if(!hB(e))return n;let r=hQ(e,t);for(;r&&["table","td","th"].includes(hI(r))&&"static"===hF(r).position;)r=hQ(r,t);return r&&("html"===hI(r)||"body"===hI(r)&&"static"===hF(r).position&&!hR(r))?n:r||function(e){let t=hV(e);for(;hB(t)&&!hN(t);){if(hR(t))return t;t=hV(t)}return null}(e)||n}let h1=async function(e){let{reference:t,floating:n,strategy:r}=e,i=this.getOffsetParent||h0,o=this.getDimensions;return{reference:function(e,t,n){let r=hB(t),i=hA(t),o="fixed"===n,s=hX(e,!0,o,t),a={scrollLeft:0,scrollTop:0},l=hu(0);if(r||!r&&!o){if(("body"!==hI(t)||hL(i))&&(a=hU(t)),r){let e=hX(t,!0,o,t);l.x=e.x+t.clientLeft,l.y=e.y+t.clientTop}else i&&(l.x=hq(i))}return{x:s.left+a.scrollLeft-l.x,y:s.top+a.scrollTop-l.y,width:s.width,height:s.height}}(t,await i(n),r),floating:{x:0,y:0,...await o(n)}}},h2={convertOffsetParentRelativeRectToViewportRelativeRect:function(e){let{rect:t,offsetParent:n,strategy:r}=e,i=hB(n),o=hA(n);if(n===o)return t;let s={scrollLeft:0,scrollTop:0},a=hu(1),l=hu(0);if((i||!i&&"fixed"!==r)&&(("body"!==hI(n)||hL(o))&&(s=hU(n)),hB(n))){let e=hX(n);a=hW(n),l.x=e.x+n.clientLeft,l.y=e.y+n.clientTop}return{width:t.width*a.x,height:t.height*a.y,x:t.x*a.x-s.scrollLeft*a.x+l.x,y:t.y*a.y-s.scrollTop*a.y+l.y}},getDocumentElement:hA,getClippingRect:function(e){let{element:t,boundary:n,rootBoundary:r,strategy:i}=e,o=[..."clippingAncestors"===n?function(e,t){let n=t.get(e);if(n)return n;let r=hH(e,[],!1).filter(e=>h$(e)&&"body"!==hI(e)),i=null,o="fixed"===hF(e).position,s=o?hV(e):e;for(;h$(s)&&!hN(s);){let t=hF(s),n=hR(s);n||"fixed"!==t.position||(i=null),(o?!n&&!i:!n&&"static"===t.position&&!!i&&["absolute","fixed"].includes(i.position)||hL(s)&&!n&&function e(t,n){let r=hV(t);return!(r===n||!h$(r)||hN(r))&&("fixed"===hF(r).position||e(r,n))}(e,s))?r=r.filter(e=>e!==s):i=t,s=hV(s)}return t.set(e,r),r}(t,this._c):[].concat(n),r],s=o[0],a=o.reduce((e,n)=>{let r=hJ(t,n,i);return e.top=ha(r.top,e.top),e.right=hs(r.right,e.right),e.bottom=hs(r.bottom,e.bottom),e.left=ha(r.left,e.left),e},hJ(t,s,i));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}},getOffsetParent:h0,getElementRects:h1,getClientRects:function(e){return Array.from(e.getClientRects())},getDimensions:function(e){return hZ(e)},getScale:hW,isElement:h$,isRTL:function(e){return"rtl"===hF(e).direction}},h5=(e,t,n)=>{let r=new Map,i={platform:h2,...n},o={...i.platform,_c:r};return h_(e,t,{...i,platform:o})},h3=e=>({name:"arrow",options:e,fn(t){let{element:n,padding:r}="function"==typeof e?e(t):e;if(n&&({}).hasOwnProperty.call(n,"current")){if(null!=n.current)return hC({element:n.current,padding:r}).fn(t)}else if(n)return hC({element:n,padding:r}).fn(t);return{}}});var h8="undefined"!=typeof document?$.useLayoutEffect:$.useEffect;function h4(e,t){let n,r,i;if(e===t)return!0;if(typeof e!=typeof t)return!1;if("function"==typeof e&&e.toString()===t.toString())return!0;if(e&&t&&"object"==typeof e){if(Array.isArray(e)){if((n=e.length)!=t.length)return!1;for(r=n;0!=r--;)if(!h4(e[r],t[r]))return!1;return!0}if((n=(i=Object.keys(e)).length)!==Object.keys(t).length)return!1;for(r=n;0!=r--;)if(!({}).hasOwnProperty.call(t,i[r]))return!1;for(r=n;0!=r--;){let n=i[r];if(("_owner"!==n||!e.$$typeof)&&!h4(e[n],t[n]))return!1}return!0}return e!=e&&t!=t}function h6(e){return"undefined"==typeof window?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function h9(e,t){let n=h6(e);return Math.round(t*n)/n}function h7(e){let t=$.useRef(e);return h8(()=>{t.current=e}),t}let pe=(0,$.forwardRef)((e,t)=>{let{children:n,width:r=10,height:i=5,...o}=e;return(0,$.createElement)(a7.svg,aJ({},o,{ref:t,width:r,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),e.asChild?n:(0,$.createElement)("polygon",{points:"0,0 30,0 15,10"}))});function pt(e){let[t,n]=(0,$.useState)(void 0);return lc(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});let t=new ResizeObserver(t=>{let r,i;if(!Array.isArray(t)||!t.length)return;let o=t[0];if("borderBoxSize"in o){let e=o.borderBoxSize,t=Array.isArray(e)?e[0]:e;r=t.inlineSize,i=t.blockSize}else r=e.offsetWidth,i=e.offsetHeight;n({width:r,height:i})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}n(void 0)},[e]),t}let pn="Popper",[pr,pi]=a5(pn),[po,ps]=pr(pn),pa=(0,$.forwardRef)((e,t)=>{let{__scopePopper:n,virtualRef:r,...i}=e,o=ps("PopperAnchor",n),s=(0,$.useRef)(null),a=a2(t,s);return(0,$.useEffect)(()=>{o.onAnchorChange((null==r?void 0:r.current)||s.current)}),r?null:(0,$.createElement)(a7.div,aJ({},i,{ref:a}))}),pl="PopperContent",[pc,pu]=pr(pl),pd=(0,$.forwardRef)((e,t)=>{var n,r,i,o,s,a,l,c,u,d,h,p,f,g;let{__scopePopper:m,side:y="bottom",sideOffset:b=0,align:w="center",alignOffset:x=0,arrowPadding:v=0,avoidCollisions:S=!0,collisionBoundary:k=[],collisionPadding:_=0,sticky:E="partial",hideWhenDetached:C=!1,updatePositionStrategy:P="optimized",onPlaced:T,...j}=e,I=ps(pl,m),[M,A]=(0,$.useState)(null),O=a2(t,e=>A(e)),[B,D]=(0,$.useState)(null),L=pt(B),R=null!==(n=null==L?void 0:L.width)&&void 0!==n?n:0,z=null!==(r=null==L?void 0:L.height)&&void 0!==r?r:0,N="number"==typeof _?_:{top:0,right:0,bottom:0,left:0,..._},F=Array.isArray(k)?k:[k],U=F.length>0,V={padding:N,boundary:F.filter(pf),altBoundary:U},{refs:H,floatingStyles:Z,placement:K,isPositioned:W,middlewareData:Y}=function(e){void 0===e&&(e={});let{placement:t="bottom",strategy:n="absolute",middleware:r=[],platform:i,elements:{reference:o,floating:s}={},transform:a=!0,whileElementsMounted:l,open:c}=e,[u,d]=$.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[h,p]=$.useState(r);h4(h,r)||p(r);let[f,g]=$.useState(null),[m,y]=$.useState(null),b=$.useCallback(e=>{e!=S.current&&(S.current=e,g(e))},[g]),w=$.useCallback(e=>{e!==k.current&&(k.current=e,y(e))},[y]),x=o||f,v=s||m,S=$.useRef(null),k=$.useRef(null),_=$.useRef(u),E=h7(l),C=h7(i),P=$.useCallback(()=>{if(!S.current||!k.current)return;let e={placement:t,strategy:n,middleware:h};C.current&&(e.platform=C.current),h5(S.current,k.current,e).then(e=>{let t={...e,isPositioned:!0};T.current&&!h4(_.current,t)&&(_.current=t,aQ.flushSync(()=>{d(t)}))})},[h,t,n,C]);h8(()=>{!1===c&&_.current.isPositioned&&(_.current.isPositioned=!1,d(e=>({...e,isPositioned:!1})))},[c]);let T=$.useRef(!1);h8(()=>(T.current=!0,()=>{T.current=!1}),[]),h8(()=>{if(x&&(S.current=x),v&&(k.current=v),x&&v){if(E.current)return E.current(x,v,P);P()}},[x,v,P,E]);let j=$.useMemo(()=>({reference:S,floating:k,setReference:b,setFloating:w}),[b,w]),I=$.useMemo(()=>({reference:x,floating:v}),[x,v]),M=$.useMemo(()=>{let e={position:n,left:0,top:0};if(!I.floating)return e;let t=h9(I.floating,u.x),r=h9(I.floating,u.y);return a?{...e,transform:"translate("+t+"px, "+r+"px)",...h6(I.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:t,top:r}},[n,a,I.floating,u.x,u.y]);return $.useMemo(()=>({...u,update:P,refs:j,elements:I,floatingStyles:M}),[u,P,j,I,M])}({strategy:"fixed",placement:y+("center"!==w?"-"+w:""),whileElementsMounted:(...e)=>(function(e,t,n,r){let i;void 0===r&&(r={});let{ancestorScroll:o=!0,ancestorResize:s=!0,elementResize:a="function"==typeof ResizeObserver,layoutShift:l="function"==typeof IntersectionObserver,animationFrame:c=!1}=r,u=hK(e),d=o||s?[...u?hH(u):[],...hH(t)]:[];d.forEach(e=>{o&&e.addEventListener("scroll",n,{passive:!0}),s&&e.addEventListener("resize",n)});let h=u&&l?function(e,t){let n,r=null,i=hA(e);function o(){clearTimeout(n),r&&r.disconnect(),r=null}return!function s(a,l){void 0===a&&(a=!1),void 0===l&&(l=1),o();let{left:c,top:u,width:d,height:h}=e.getBoundingClientRect();if(a||t(),!d||!h)return;let p=hc(u),f=hc(i.clientWidth-(c+d)),g={rootMargin:-p+"px "+-f+"px "+-hc(i.clientHeight-(u+h))+"px "+-hc(c)+"px",threshold:ha(0,hs(1,l))||1},m=!0;function y(e){let t=e[0].intersectionRatio;if(t!==l){if(!m)return s();t?s(!1,t):n=setTimeout(()=>{s(!1,1e-7)},100)}m=!1}try{r=new IntersectionObserver(y,{...g,root:i.ownerDocument})}catch(e){r=new IntersectionObserver(y,g)}r.observe(e)}(!0),o}(u,n):null,p=-1,f=null;a&&(f=new ResizeObserver(e=>{let[r]=e;r&&r.target===u&&f&&(f.unobserve(t),cancelAnimationFrame(p),p=requestAnimationFrame(()=>{f&&f.observe(t)})),n()}),u&&!c&&f.observe(u),f.observe(t));let g=c?hX(e):null;return c&&function t(){let r=hX(e);g&&(r.x!==g.x||r.y!==g.y||r.width!==g.width||r.height!==g.height)&&n(),g=r,i=requestAnimationFrame(t)}(),n(),()=>{d.forEach(e=>{o&&e.removeEventListener("scroll",n),s&&e.removeEventListener("resize",n)}),h&&h(),f&&f.disconnect(),f=null,c&&cancelAnimationFrame(i)}})(...e,{animationFrame:"always"===P}),elements:{reference:I.anchor},middleware:[{name:"offset",options:u={mainAxis:b+z,alignmentAxis:x},async fn(e){let{x:t,y:n}=e,r=await hj(e,u);return{x:t+r.x,y:n+r.y,data:r}}},S&&{name:"shift",options:h={mainAxis:!0,crossAxis:!1,limiter:"partial"===E?(void 0===d&&(d={}),{options:d,fn(e){let{x:t,y:n,placement:r,rects:i,middlewareData:o}=e,{offset:s=0,mainAxis:a=!0,crossAxis:l=!0}=hp(d,e),c={x:t,y:n},u=hb(r),h=hm(u),p=c[h],f=c[u],g=hp(s,e),m="number"==typeof g?{mainAxis:g,crossAxis:0}:{mainAxis:0,crossAxis:0,...g};if(a){let e="y"===h?"height":"width",t=i.reference[h]-i.floating[e]+m.mainAxis,n=i.reference[h]+i.reference[e]-m.mainAxis;p<t?p=t:p>n&&(p=n)}if(l){var y,b;let e="y"===h?"width":"height",t=["top","left"].includes(hf(r)),n=i.reference[u]-i.floating[e]+(t&&(null==(y=o.offset)?void 0:y[u])||0)+(t?0:m.crossAxis),s=i.reference[u]+i.reference[e]+(t?0:(null==(b=o.offset)?void 0:b[u])||0)-(t?m.crossAxis:0);f<n?f=n:f>s&&(f=s)}return{[h]:p,[u]:f}}}):void 0,...V},async fn(e){let{x:t,y:n,placement:r}=e,{mainAxis:i=!0,crossAxis:o=!1,limiter:s={fn:e=>{let{x:t,y:n}=e;return{x:t,y:n}}},...a}=hp(h,e),l={x:t,y:n},c=await hE(e,a),u=hb(hf(r)),d=hm(u),p=l[d],f=l[u];if(i){let e="y"===d?"top":"left",t="y"===d?"bottom":"right",n=p+c[e],r=p-c[t];p=ha(n,hs(p,r))}if(o){let e="y"===u?"top":"left",t="y"===u?"bottom":"right",n=f+c[e],r=f-c[t];f=ha(n,hs(f,r))}let g=s.fn({...e,[d]:p,[u]:f});return{...g,data:{x:g.x-t,y:g.y-n}}}},S&&{name:"flip",options:p={...V},async fn(e){var t,n,r,i,o;let{placement:s,middlewareData:a,rects:l,initialPlacement:c,platform:u,elements:d}=e,{mainAxis:h=!0,crossAxis:f=!0,fallbackPlacements:g,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:b=!0,...w}=hp(p,e);if(null!=(t=a.arrow)&&t.alignmentOffset)return{};let x=hf(s),v=hf(c)===c,S=await (null==u.isRTL?void 0:u.isRTL(d.floating)),k=g||(v||!b?[hx(c)]:function(e){let t=hx(e);return[hw(e),t,hw(t)]}(c));g||"none"===y||k.push(...function(e,t,n,r){let i=hg(e),o=function(e,t,n){let r=["left","right"],i=["right","left"];switch(e){case"top":case"bottom":if(n)return t?i:r;return t?r:i;case"left":case"right":return t?["top","bottom"]:["bottom","top"];default:return[]}}(hf(e),"start"===n,r);return i&&(o=o.map(e=>e+"-"+i),t&&(o=o.concat(o.map(hw)))),o}(c,b,y,S));let _=[c,...k],E=await hE(e,w),C=[],P=(null==(n=a.flip)?void 0:n.overflows)||[];if(h&&C.push(E[x]),f){let e=function(e,t,n){void 0===n&&(n=!1);let r=hg(e),i=hm(hb(e)),o=hy(i),s="x"===i?r===(n?"end":"start")?"right":"left":"start"===r?"bottom":"top";return t.reference[o]>t.floating[o]&&(s=hx(s)),[s,hx(s)]}(s,l,S);C.push(E[e[0]],E[e[1]])}if(P=[...P,{placement:s,overflows:C}],!C.every(e=>e<=0)){let e=((null==(r=a.flip)?void 0:r.index)||0)+1,t=_[e];if(t)return{data:{index:e,overflows:P},reset:{placement:t}};let n=null==(i=P.filter(e=>e.overflows[0]<=0).sort((e,t)=>e.overflows[1]-t.overflows[1])[0])?void 0:i.placement;if(!n)switch(m){case"bestFit":{let e=null==(o=P.map(e=>[e.placement,e.overflows.filter(e=>e>0).reduce((e,t)=>e+t,0)]).sort((e,t)=>e[1]-t[1])[0])?void 0:o[0];e&&(n=e);break}case"initialPlacement":n=c}if(s!==n)return{reset:{placement:n}}}return{}}},{name:"size",options:f={...V,apply:({elements:e,rects:t,availableWidth:n,availableHeight:r})=>{let{width:i,height:o}=t.reference,s=e.floating.style;s.setProperty("--radix-popper-available-width",`${n}px`),s.setProperty("--radix-popper-available-height",`${r}px`),s.setProperty("--radix-popper-anchor-width",`${i}px`),s.setProperty("--radix-popper-anchor-height",`${o}px`)}},async fn(e){let t,n;let{placement:r,rects:i,platform:o,elements:s}=e,{apply:a=()=>{},...l}=hp(f,e),c=await hE(e,l),u=hf(r),d=hg(r),h="y"===hb(r),{width:p,height:g}=i.floating;"top"===u||"bottom"===u?(t=u,n=d===(await (null==o.isRTL?void 0:o.isRTL(s.floating))?"start":"end")?"left":"right"):(n=u,t="end"===d?"top":"bottom");let m=g-c[t],y=p-c[n],b=!e.middlewareData.shift,w=m,x=y;if(h){let e=p-c.left-c.right;x=d||b?hs(y,e):e}else{let e=g-c.top-c.bottom;w=d||b?hs(m,e):e}if(b&&!d){let e=ha(c.left,0),t=ha(c.right,0),n=ha(c.top,0),r=ha(c.bottom,0);h?x=p-2*(0!==e||0!==t?e+t:ha(c.left,c.right)):w=g-2*(0!==n||0!==r?n+r:ha(c.top,c.bottom))}await a({...e,availableWidth:x,availableHeight:w});let v=await o.getDimensions(s.floating);return p!==v.width||g!==v.height?{reset:{rects:!0}}:{}}},B&&h3({element:B,padding:v}),pg({arrowWidth:R,arrowHeight:z}),C&&{name:"hide",options:g={strategy:"referenceHidden",...V},async fn(e){let{rects:t}=e,{strategy:n="referenceHidden",...r}=hp(g,e);switch(n){case"referenceHidden":{let n=hP(await hE(e,{...r,elementContext:"reference"}),t.reference);return{data:{referenceHiddenOffsets:n,referenceHidden:hT(n)}}}case"escaped":{let n=hP(await hE(e,{...r,altBoundary:!0}),t.floating);return{data:{escapedOffsets:n,escaped:hT(n)}}}default:return{}}}}]}),[G,X]=pm(K),q=lt(T);lc(()=>{W&&(null==q||q())},[W,q]);let J=null===(i=Y.arrow)||void 0===i?void 0:i.x,Q=null===(o=Y.arrow)||void 0===o?void 0:o.y,ee=(null===(s=Y.arrow)||void 0===s?void 0:s.centerOffset)!==0,[et,en]=(0,$.useState)();return lc(()=>{M&&en(window.getComputedStyle(M).zIndex)},[M]),(0,$.createElement)("div",{ref:H.setFloating,"data-radix-popper-content-wrapper":"",style:{...Z,transform:W?Z.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:et,"--radix-popper-transform-origin":[null===(a=Y.transformOrigin)||void 0===a?void 0:a.x,null===(l=Y.transformOrigin)||void 0===l?void 0:l.y].join(" ")},dir:e.dir},(0,$.createElement)(pc,{scope:m,placedSide:G,onArrowChange:D,arrowX:J,arrowY:Q,shouldHideArrow:ee},(0,$.createElement)(a7.div,aJ({"data-side":G,"data-align":X},j,{ref:O,style:{...j.style,animation:W?void 0:"none",opacity:null!==(c=Y.hide)&&void 0!==c&&c.referenceHidden?0:void 0}}))))}),ph={top:"bottom",right:"left",bottom:"top",left:"right"},pp=(0,$.forwardRef)(function(e,t){let{__scopePopper:n,...r}=e,i=pu("PopperArrow",n),o=ph[i.placedSide];return(0,$.createElement)("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0}},(0,$.createElement)(pe,aJ({},r,{ref:t,style:{...r.style,display:"block"}})))});function pf(e){return null!==e}let pg=e=>({name:"transformOrigin",options:e,fn(t){var n,r,i,o,s;let{placement:a,rects:l,middlewareData:c}=t,u=(null===(n=c.arrow)||void 0===n?void 0:n.centerOffset)!==0,d=u?0:e.arrowWidth,h=u?0:e.arrowHeight,[p,f]=pm(a),g={start:"0%",center:"50%",end:"100%"}[f],m=(null!==(r=null===(i=c.arrow)||void 0===i?void 0:i.x)&&void 0!==r?r:0)+d/2,y=(null!==(o=null===(s=c.arrow)||void 0===s?void 0:s.y)&&void 0!==o?o:0)+h/2,b="",w="";return"bottom"===p?(b=u?g:`${m}px`,w=`${-h}px`):"top"===p?(b=u?g:`${m}px`,w=`${l.floating.height+h}px`):"right"===p?(b=`${-h}px`,w=u?g:`${y}px`):"left"===p&&(b=`${l.floating.width+h}px`,w=u?g:`${y}px`),{data:{x:b,y:w}}}});function pm(e){let[t,n="center"]=e.split("-");return[t,n]}let py=e=>{let{__scopePopper:t,children:n}=e,[r,i]=(0,$.useState)(null);return(0,$.createElement)(po,{scope:t,anchor:r,onAnchorChange:i},n)},pb="rovingFocusGroup.onEntryFocus",pw={bubbles:!1,cancelable:!0},px="RovingFocusGroup",[pv,pS,pk]=a9(px),[p_,pE]=a5(px,[pk]),[pC,pP]=p_(px),pT=(0,$.forwardRef)((e,t)=>(0,$.createElement)(pv.Provider,{scope:e.__scopeRovingFocusGroup},(0,$.createElement)(pv.Slot,{scope:e.__scopeRovingFocusGroup},(0,$.createElement)(pj,aJ({},e,{ref:t}))))),pj=(0,$.forwardRef)((e,t)=>{let{__scopeRovingFocusGroup:n,orientation:r,loop:i=!1,dir:o,currentTabStopId:s,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:c,...u}=e,d=(0,$.useRef)(null),h=a2(t,d),p=hi(o),[f=null,g]=lh({prop:s,defaultProp:a,onChange:l}),[m,y]=(0,$.useState)(!1),b=lt(c),w=pS(n),x=(0,$.useRef)(!1),[v,S]=(0,$.useState)(0);return(0,$.useEffect)(()=>{let e=d.current;if(e)return e.addEventListener(pb,b),()=>e.removeEventListener(pb,b)},[b]),(0,$.createElement)(pC,{scope:n,orientation:r,dir:p,loop:i,currentTabStopId:f,onItemFocus:(0,$.useCallback)(e=>g(e),[g]),onItemShiftTab:(0,$.useCallback)(()=>y(!0),[]),onFocusableItemAdd:(0,$.useCallback)(()=>S(e=>e+1),[]),onFocusableItemRemove:(0,$.useCallback)(()=>S(e=>e-1),[])},(0,$.createElement)(a7.div,aJ({tabIndex:m||0===v?-1:0,"data-orientation":r},u,{ref:h,style:{outline:"none",...e.style},onMouseDown:a0(e.onMouseDown,()=>{x.current=!0}),onFocus:a0(e.onFocus,e=>{let t=!x.current;if(e.target===e.currentTarget&&t&&!m){let t=new CustomEvent(pb,pw);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){let e=w().filter(e=>e.focusable);pA([e.find(e=>e.active),e.find(e=>e.id===f),...e].filter(Boolean).map(e=>e.ref.current))}}x.current=!1}),onBlur:a0(e.onBlur,()=>y(!1))})))}),pI=(0,$.forwardRef)((e,t)=>{let{__scopeRovingFocusGroup:n,focusable:r=!0,active:i=!1,tabStopId:o,...s}=e,a=co(),l=o||a,c=pP("RovingFocusGroupItem",n),u=c.currentTabStopId===l,d=pS(n),{onFocusableItemAdd:h,onFocusableItemRemove:p}=c;return(0,$.useEffect)(()=>{if(r)return h(),()=>p()},[r,h,p]),(0,$.createElement)(pv.ItemSlot,{scope:n,id:l,focusable:r,active:i},(0,$.createElement)(a7.span,aJ({tabIndex:u?0:-1,"data-orientation":c.orientation},s,{ref:t,onMouseDown:a0(e.onMouseDown,e=>{r?c.onItemFocus(l):e.preventDefault()}),onFocus:a0(e.onFocus,()=>c.onItemFocus(l)),onKeyDown:a0(e.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey){c.onItemShiftTab();return}if(e.target!==e.currentTarget)return;let t=function(e,t,n){var r;let i=(r=e.key,"rtl"!==n?r:"ArrowLeft"===r?"ArrowRight":"ArrowRight"===r?"ArrowLeft":r);if(!("vertical"===t&&["ArrowLeft","ArrowRight"].includes(i))&&!("horizontal"===t&&["ArrowUp","ArrowDown"].includes(i)))return pM[i]}(e,c.orientation,c.dir);if(void 0!==t){e.preventDefault();let i=d().filter(e=>e.focusable).map(e=>e.ref.current);if("last"===t)i.reverse();else if("prev"===t||"next"===t){var n,r;"prev"===t&&i.reverse();let o=i.indexOf(e.currentTarget);i=c.loop?(n=i,r=o+1,n.map((e,t)=>n[(r+t)%n.length])):i.slice(o+1)}setTimeout(()=>pA(i))}})})))}),pM={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function pA(e){let t=document.activeElement;for(let n of e)if(n===t||(n.focus(),document.activeElement!==t))return}let pO=["Enter"," "],p$=["ArrowUp","PageDown","End"],pB=["ArrowDown","PageUp","Home",...p$],pD={ltr:[...pO,"ArrowRight"],rtl:[...pO,"ArrowLeft"]},pL={ltr:["ArrowLeft"],rtl:["ArrowRight"]},pR="Menu",[pz,pN,pF]=a9(pR),[pU,pV]=a5(pR,[pF,pi,pE]),pH=pi(),pZ=pE(),[pK,pW]=pU(pR),[pY,pG]=pU(pR),pX=(0,$.forwardRef)((e,t)=>{let{__scopeMenu:n,...r}=e,i=pH(n);return(0,$.createElement)(pa,aJ({},i,r,{ref:t}))}),pq="MenuPortal",[pJ,pQ]=pU(pq,{forceMount:void 0}),p0="MenuContent",[p1,p2]=pU(p0),p5=(0,$.forwardRef)((e,t)=>{let n=pQ(p0,e.__scopeMenu),{forceMount:r=n.forceMount,...i}=e,o=pW(p0,e.__scopeMenu),s=pG(p0,e.__scopeMenu);return(0,$.createElement)(pz.Provider,{scope:e.__scopeMenu},(0,$.createElement)(lu,{present:r||o.open},(0,$.createElement)(pz.Slot,{scope:e.__scopeMenu},s.modal?(0,$.createElement)(p3,aJ({},i,{ref:t})):(0,$.createElement)(p8,aJ({},i,{ref:t})))))}),p3=(0,$.forwardRef)((e,t)=>{let n=pW(p0,e.__scopeMenu),r=(0,$.useRef)(null),i=a2(t,r);return(0,$.useEffect)(()=>{let e=r.current;if(e)return c5(e)},[]),(0,$.createElement)(p4,aJ({},e,{ref:i,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:a0(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)}))}),p8=(0,$.forwardRef)((e,t)=>{let n=pW(p0,e.__scopeMenu);return(0,$.createElement)(p4,aJ({},e,{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)}))}),p4=(0,$.forwardRef)((e,t)=>{let{__scopeMenu:n,loop:r=!1,trapFocus:i,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:a,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,onDismiss:p,disableOutsideScroll:f,...g}=e,m=pW(p0,n),y=pG(p0,n),b=pH(n),w=pZ(n),x=pN(n),[v,S]=(0,$.useState)(null),k=(0,$.useRef)(null),_=a2(t,k,m.onContentChange),E=(0,$.useRef)(0),C=(0,$.useRef)(""),P=(0,$.useRef)(0),T=(0,$.useRef)(null),j=(0,$.useRef)("right"),I=(0,$.useRef)(0),M=f?cX:$.Fragment,A=f?{as:a3,allowPinchZoom:!0}:void 0,O=e=>{var t,n;let r=C.current+e,i=x().filter(e=>!e.disabled),o=document.activeElement,s=null===(t=i.find(e=>e.ref.current===o))||void 0===t?void 0:t.textValue,a=function(e,t,n){var r;let i=t.length>1&&Array.from(t).every(e=>e===t[0])?t[0]:t,o=(r=Math.max(n?e.indexOf(n):-1,0),e.map((t,n)=>e[(r+n)%e.length]));1===i.length&&(o=o.filter(e=>e!==n));let s=o.find(e=>e.toLowerCase().startsWith(i.toLowerCase()));return s!==n?s:void 0}(i.map(e=>e.textValue),r,s),l=null===(n=i.find(e=>e.textValue===a))||void 0===n?void 0:n.ref.current;!function e(t){C.current=t,window.clearTimeout(E.current),""!==t&&(E.current=window.setTimeout(()=>e(""),1e3))}(r),l&&setTimeout(()=>l.focus())};(0,$.useEffect)(()=>()=>window.clearTimeout(E.current),[]),cm();let B=(0,$.useCallback)(e=>{var t,n,r;return j.current===(null===(t=T.current)||void 0===t?void 0:t.side)&&!!(r=null===(n=T.current)||void 0===n?void 0:n.area)&&function(e,t){let{x:n,y:r}=e,i=!1;for(let e=0,o=t.length-1;e<t.length;o=e++){let s=t[e].x,a=t[e].y,l=t[o].x,c=t[o].y;a>r!=c>r&&n<(l-s)*(r-a)/(c-a)+s&&(i=!i)}return i}({x:e.clientX,y:e.clientY},r)},[]);return(0,$.createElement)(p1,{scope:n,searchRef:C,onItemEnter:(0,$.useCallback)(e=>{B(e)&&e.preventDefault()},[B]),onItemLeave:(0,$.useCallback)(e=>{var t;B(e)||(null===(t=k.current)||void 0===t||t.focus(),S(null))},[B]),onTriggerLeave:(0,$.useCallback)(e=>{B(e)&&e.preventDefault()},[B]),pointerGraceTimerRef:P,onPointerGraceIntentChange:(0,$.useCallback)(e=>{T.current=e},[])},(0,$.createElement)(M,A,(0,$.createElement)(cc,{asChild:!0,trapped:i,onMountAutoFocus:a0(o,e=>{var t;e.preventDefault(),null===(t=k.current)||void 0===t||t.focus()}),onUnmountAutoFocus:s},(0,$.createElement)(li,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,onDismiss:p},(0,$.createElement)(pT,aJ({asChild:!0},w,{dir:y.dir,orientation:"vertical",loop:r,currentTabStopId:v,onCurrentTabStopIdChange:S,onEntryFocus:a0(l,e=>{y.isUsingKeyboardRef.current||e.preventDefault()})}),(0,$.createElement)(pd,aJ({role:"menu","aria-orientation":"vertical","data-state":fg(m.open),"data-radix-menu-content":"",dir:y.dir},b,g,{ref:_,style:{outline:"none",...g.style},onKeyDown:a0(g.onKeyDown,e=>{let t=e.target.closest("[data-radix-menu-content]")===e.currentTarget,n=e.ctrlKey||e.altKey||e.metaKey,r=1===e.key.length;t&&("Tab"===e.key&&e.preventDefault(),!n&&r&&O(e.key));let i=k.current;if(e.target!==i||!pB.includes(e.key))return;e.preventDefault();let o=x().filter(e=>!e.disabled).map(e=>e.ref.current);p$.includes(e.key)&&o.reverse(),function(e){let t=document.activeElement;for(let n of e)if(n===t||(n.focus(),document.activeElement!==t))return}(o)}),onBlur:a0(e.onBlur,e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(E.current),C.current="")}),onPointerMove:a0(e.onPointerMove,fb(e=>{let t=e.target,n=I.current!==e.clientX;if(e.currentTarget.contains(t)&&n){let t=e.clientX>I.current?"right":"left";j.current=t,I.current=e.clientX}}))})))))))}),p6=(0,$.forwardRef)((e,t)=>{let{__scopeMenu:n,...r}=e;return(0,$.createElement)(a7.div,aJ({role:"group"},r,{ref:t}))}),p9=((e,t)=>{let{__scopeMenu:n,...r}=e;return(0,$.createElement)(a7.div,aJ({},r,{ref:t}))},"MenuItem"),p7="menu.itemSelect",fe=(0,$.forwardRef)((e,t)=>{let{disabled:n=!1,onSelect:r,...i}=e,o=(0,$.useRef)(null),s=pG(p9,e.__scopeMenu),a=p2(p9,e.__scopeMenu),l=a2(t,o),c=(0,$.useRef)(!1);return(0,$.createElement)(ft,aJ({},i,{ref:l,disabled:n,onClick:a0(e.onClick,()=>{let e=o.current;if(!n&&e){let t=new CustomEvent(p7,{bubbles:!0,cancelable:!0});e.addEventListener(p7,e=>null==r?void 0:r(e),{once:!0}),le(e,t),t.defaultPrevented?c.current=!1:s.onClose()}}),onPointerDown:t=>{var n;null===(n=e.onPointerDown)||void 0===n||n.call(e,t),c.current=!0},onPointerUp:a0(e.onPointerUp,e=>{var t;c.current||null===(t=e.currentTarget)||void 0===t||t.click()}),onKeyDown:a0(e.onKeyDown,e=>{let t=""!==a.searchRef.current;!n&&(!t||" "!==e.key)&&pO.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())})}))}),ft=(0,$.forwardRef)((e,t)=>{let{__scopeMenu:n,disabled:r=!1,textValue:i,...o}=e,s=p2(p9,n),a=pZ(n),l=(0,$.useRef)(null),c=a2(t,l),[u,d]=(0,$.useState)(!1),[h,p]=(0,$.useState)("");return(0,$.useEffect)(()=>{let e=l.current;if(e){var t;p((null!==(t=e.textContent)&&void 0!==t?t:"").trim())}},[o.children]),(0,$.createElement)(pz.ItemSlot,{scope:n,disabled:r,textValue:null!=i?i:h},(0,$.createElement)(pI,aJ({asChild:!0},a,{focusable:!r}),(0,$.createElement)(a7.div,aJ({role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0},o,{ref:c,onPointerMove:a0(e.onPointerMove,fb(e=>{r?s.onItemLeave(e):(s.onItemEnter(e),e.defaultPrevented||e.currentTarget.focus())})),onPointerLeave:a0(e.onPointerLeave,fb(e=>s.onItemLeave(e))),onFocus:a0(e.onFocus,()=>d(!0)),onBlur:a0(e.onBlur,()=>d(!1))}))))}),fn=(0,$.forwardRef)((e,t)=>{let{checked:n=!1,onCheckedChange:r,...i}=e;return(0,$.createElement)(fs,{scope:e.__scopeMenu,checked:n},(0,$.createElement)(fe,aJ({role:"menuitemcheckbox","aria-checked":fm(n)?"mixed":n},i,{ref:t,"data-state":fy(n),onSelect:a0(i.onSelect,()=>null==r?void 0:r(!!fm(n)||!n),{checkForDefaultPrevented:!1})})))}),[fr,fi]=pU("MenuRadioGroup",{value:void 0,onValueChange:()=>{}}),fo=((e,t)=>{let{value:n,onValueChange:r,...i}=e,o=lt(r);return(0,$.createElement)(fr,{scope:e.__scopeMenu,value:n,onValueChange:o},(0,$.createElement)(p6,aJ({},i,{ref:t})))},"MenuItemIndicator"),[fs,fa]=pU(fo,{checked:!1}),fl=(0,$.forwardRef)((e,t)=>{let{__scopeMenu:n,forceMount:r,...i}=e,o=fa(fo,n);return(0,$.createElement)(lu,{present:r||fm(o.checked)||!0===o.checked},(0,$.createElement)(a7.span,aJ({},i,{ref:t,"data-state":fy(o.checked)})))}),fc=((e,t)=>{let{__scopeMenu:n,...r}=e;return(0,$.createElement)(a7.div,aJ({role:"separator","aria-orientation":"horizontal"},r,{ref:t}))},"MenuSub"),[fu,fd]=pU(fc),fh="MenuSubTrigger",fp=(0,$.forwardRef)((e,t)=>{let n=pW(fh,e.__scopeMenu),r=pG(fh,e.__scopeMenu),i=fd(fh,e.__scopeMenu),o=p2(fh,e.__scopeMenu),s=(0,$.useRef)(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:l}=o,c={__scopeMenu:e.__scopeMenu},u=(0,$.useCallback)(()=>{s.current&&window.clearTimeout(s.current),s.current=null},[]);return(0,$.useEffect)(()=>u,[u]),(0,$.useEffect)(()=>{let e=a.current;return()=>{window.clearTimeout(e),l(null)}},[a,l]),(0,$.createElement)(pX,aJ({asChild:!0},c),(0,$.createElement)(ft,aJ({id:i.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":i.contentId,"data-state":fg(n.open)},e,{ref:a1(t,i.onTriggerChange),onClick:t=>{var r;null===(r=e.onClick)||void 0===r||r.call(e,t),e.disabled||t.defaultPrevented||(t.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:a0(e.onPointerMove,fb(t=>{o.onItemEnter(t),t.defaultPrevented||e.disabled||n.open||s.current||(o.onPointerGraceIntentChange(null),s.current=window.setTimeout(()=>{n.onOpenChange(!0),u()},100))})),onPointerLeave:a0(e.onPointerLeave,fb(e=>{var t,r;u();let i=null===(t=n.content)||void 0===t?void 0:t.getBoundingClientRect();if(i){let t=null===(r=n.content)||void 0===r?void 0:r.dataset.side,s="right"===t,l=i[s?"left":"right"],c=i[s?"right":"left"];o.onPointerGraceIntentChange({area:[{x:e.clientX+(s?-5:5),y:e.clientY},{x:l,y:i.top},{x:c,y:i.top},{x:c,y:i.bottom},{x:l,y:i.bottom}],side:t}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(e),e.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:a0(e.onKeyDown,t=>{let i=""!==o.searchRef.current;if(!e.disabled&&(!i||" "!==t.key)&&pD[r.dir].includes(t.key)){var s;n.onOpenChange(!0),null===(s=n.content)||void 0===s||s.focus(),t.preventDefault()}})})))}),ff=(0,$.forwardRef)((e,t)=>{let n=pQ(p0,e.__scopeMenu),{forceMount:r=n.forceMount,...i}=e,o=pW(p0,e.__scopeMenu),s=pG(p0,e.__scopeMenu),a=fd("MenuSubContent",e.__scopeMenu),l=(0,$.useRef)(null),c=a2(t,l);return(0,$.createElement)(pz.Provider,{scope:e.__scopeMenu},(0,$.createElement)(lu,{present:r||o.open},(0,$.createElement)(pz.Slot,{scope:e.__scopeMenu},(0,$.createElement)(p4,aJ({id:a.contentId,"aria-labelledby":a.triggerId},i,{ref:c,align:"start",side:"rtl"===s.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{var t;s.isUsingKeyboardRef.current&&(null===(t=l.current)||void 0===t||t.focus()),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:a0(e.onFocusOutside,e=>{e.target!==a.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:a0(e.onEscapeKeyDown,e=>{s.onClose(),e.preventDefault()}),onKeyDown:a0(e.onKeyDown,e=>{let t=e.currentTarget.contains(e.target),n=pL[s.dir].includes(e.key);if(t&&n){var r;o.onOpenChange(!1),null===(r=a.trigger)||void 0===r||r.focus(),e.preventDefault()}})})))))});function fg(e){return e?"open":"closed"}function fm(e){return"indeterminate"===e}function fy(e){return fm(e)?"indeterminate":e?"checked":"unchecked"}function fb(e){return t=>"mouse"===t.pointerType?e(t):void 0}let fw=e=>{let{__scopeMenu:t,open:n=!1,children:r,dir:i,onOpenChange:o,modal:s=!0}=e,a=pH(t),[l,c]=(0,$.useState)(null),u=(0,$.useRef)(!1),d=lt(o),h=hi(i);return(0,$.useEffect)(()=>{let e=()=>{u.current=!0,document.addEventListener("pointerdown",t,{capture:!0,once:!0}),document.addEventListener("pointermove",t,{capture:!0,once:!0})},t=()=>u.current=!1;return document.addEventListener("keydown",e,{capture:!0}),()=>{document.removeEventListener("keydown",e,{capture:!0}),document.removeEventListener("pointerdown",t,{capture:!0}),document.removeEventListener("pointermove",t,{capture:!0})}},[]),(0,$.createElement)(py,a,(0,$.createElement)(pK,{scope:t,open:n,onOpenChange:d,content:l,onContentChange:c},(0,$.createElement)(pY,{scope:t,onClose:(0,$.useCallback)(()=>d(!1),[d]),isUsingKeyboardRef:u,dir:h,modal:s},r)))},fx=e=>{let{__scopeMenu:t,forceMount:n,children:r,container:i}=e,o=pW(pq,t);return(0,$.createElement)(pJ,{scope:t,forceMount:n},(0,$.createElement)(lu,{present:n||o.open},(0,$.createElement)(ll,{asChild:!0,container:i},r)))},fv=e=>{let{__scopeMenu:t,children:n,open:r=!1,onOpenChange:i}=e,o=pW(fc,t),s=pH(t),[a,l]=(0,$.useState)(null),[c,u]=(0,$.useState)(null),d=lt(i);return(0,$.useEffect)(()=>(!1===o.open&&d(!1),()=>d(!1)),[o.open,d]),(0,$.createElement)(py,s,(0,$.createElement)(pK,{scope:t,open:r,onOpenChange:d,content:c,onContentChange:u},(0,$.createElement)(fu,{scope:t,contentId:co(),triggerId:co(),trigger:a,onTriggerChange:l},n)))},fS="DropdownMenu",[fk,f_]=a5(fS,[pV]),fE=pV(),[fC,fP]=fk(fS),fT=(0,$.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,disabled:r=!1,...i}=e,o=fP("DropdownMenuTrigger",n),s=fE(n);return(0,$.createElement)(pX,aJ({asChild:!0},s),(0,$.createElement)(a7.button,aJ({type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":r?"":void 0,disabled:r},i,{ref:a1(t,o.triggerRef),onPointerDown:a0(e.onPointerDown,e=>{r||0!==e.button||!1!==e.ctrlKey||(o.onOpenToggle(),o.open||e.preventDefault())}),onKeyDown:a0(e.onKeyDown,e=>{!r&&(["Enter"," "].includes(e.key)&&o.onOpenToggle(),"ArrowDown"===e.key&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())})})))}),fj=(0,$.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=fP("DropdownMenuContent",n),o=fE(n),s=(0,$.useRef)(!1);return(0,$.createElement)(p5,aJ({id:i.contentId,"aria-labelledby":i.triggerId},o,r,{ref:t,onCloseAutoFocus:a0(e.onCloseAutoFocus,e=>{var t;s.current||null===(t=i.triggerRef.current)||void 0===t||t.focus(),s.current=!1,e.preventDefault()}),onInteractOutside:a0(e.onInteractOutside,e=>{let t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,r=2===t.button||n;(!i.modal||r)&&(s.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),fI=(0,$.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=fE(n);return(0,$.createElement)(p6,aJ({},i,r,{ref:t}))}),fM=(0,$.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=fE(n);return(0,$.createElement)(fe,aJ({},i,r,{ref:t}))}),fA=(0,$.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=fE(n);return(0,$.createElement)(fn,aJ({},i,r,{ref:t}))}),fO=(0,$.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=fE(n);return(0,$.createElement)(fl,aJ({},i,r,{ref:t}))}),f$=(0,$.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=fE(n);return(0,$.createElement)(fp,aJ({},i,r,{ref:t}))}),fB=(0,$.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=fE(n);return(0,$.createElement)(ff,aJ({},i,r,{ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),fD=e=>{let{__scopeDropdownMenu:t,children:n,dir:r,open:i,defaultOpen:o,onOpenChange:s,modal:a=!0}=e,l=fE(t),c=(0,$.useRef)(null),[u=!1,d]=lh({prop:i,defaultProp:o,onChange:s});return(0,$.createElement)(fC,{scope:t,triggerId:co(),triggerRef:c,contentId:co(),open:u,onOpenChange:d,onOpenToggle:(0,$.useCallback)(()=>d(e=>!e),[d]),modal:a},(0,$.createElement)(fw,aJ({},l,{open:u,onOpenChange:d,dir:r,modal:a}),n))},fL=e=>{let{__scopeDropdownMenu:t,...n}=e,r=fE(t);return(0,$.createElement)(fx,aJ({},r,n))},fR=e=>{let{__scopeDropdownMenu:t,children:n,open:r,onOpenChange:i,defaultOpen:o}=e,s=fE(t),[a=!1,l]=lh({prop:r,defaultProp:o,onChange:i});return(0,$.createElement)(fv,aJ({},s,{open:a,onOpenChange:l}),n)};function fz(e,t){let n=(0,G.j)(),r=(0,$.useRef)(!1),i=uK(),o=(0,$.useCallback)(i=>{r.current=i,n.batch(()=>{i?(n.complete(),n.addOpenMenu(e)):n.updateInstanceState({openMenus:n.getOpenMenus().filter(t=>!t.startsWith(e))}),t?.(i)})},[n,e,t]),s=(0,T.Hg)("is menu open",()=>n.getOpenMenus().includes(e),[n,e]);return(0,$.useEffect)(()=>(r.current&&(i("open-menu",{source:"unknown",id:e}),n.addOpenMenu(e)),()=>{r.current&&(n.deleteOpenMenu(e),n.getOpenMenus().forEach(t=>{t.startsWith(e)&&(i("close-menu",{source:"unknown",id:e}),n.deleteOpenMenu(t))}),r.current=!1)}),[n,e,i]),[s,o]}function fN({id:e,children:t,modal:n=!1,debugOpen:r=!1}){let[i,o]=fz(e);return(0,O.jsx)(fD,{open:r||i,dir:"ltr",modal:n,onOpenChange:o,children:t})}function fF({children:e,"data-testid":t}){return(0,O.jsx)(fT,{dir:"ltr","data-testid":t,asChild:!0,onTouchEnd:e=>H(e),children:e})}function fU({side:e="bottom",align:t="start",sideOffset:n=8,alignOffset:r=8,children:i}){let o=J();return(0,O.jsx)(fL,{container:o,children:(0,O.jsx)(fj,{className:"tlui-menu",align:t,sideOffset:n,side:e,alignOffset:r,collisionPadding:4,children:i})})}function fV({id:e,children:t}){let[n,r]=fz(e);return(0,O.jsx)(fR,{open:n,onOpenChange:r,children:t})}function fH({label:e,"data-testid":t,"data-direction":n}){return(0,O.jsx)(f$,{dir:"ltr","data-direction":n,"data-testid":t,asChild:!0,children:(0,O.jsx)(cn,{type:"menu",className:"tlui-menu__submenu__trigger",label:e,icon:"chevron-right"})})}function fZ({alignOffset:e=0,sideOffset:t=5,children:n}){let r=J();return(0,O.jsx)(fL,{container:r,children:(0,O.jsx)(fB,{className:"tlui-menu tlui-menu__submenu__content",alignOffset:e,sideOffset:t,collisionPadding:4,children:n})})}function fK({children:e,size:t="medium"}){return(0,O.jsx)(fI,{dir:"ltr",className:"tlui-menu__group","data-size":t,children:e})}function fW(){return(0,O.jsx)(fO,{dir:"ltr",asChild:!0,children:(0,O.jsx)(l4,{icon:"check"})})}function fY({noClose:e,...t}){return(0,O.jsx)(fM,{dir:"ltr",asChild:!0,onClick:e||void 0!==t.isChecked?H:void 0,children:(0,O.jsx)(cn,{...t})})}function fG({children:e,onSelect:t,...n}){return(0,O.jsxs)(fA,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",onSelect:e=>{t?.(e),H(e)},...n,children:[(0,O.jsx)(l4,{small:!0,icon:n.checked?"check":"checkbox-empty"}),e]})}function fX({children:e,onSelect:t,...n}){return(0,O.jsxs)(fA,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",onSelect:e=>{t?.(e),H(e)},...n,children:[(0,O.jsx)("div",{className:"tlui-button__checkbox__indicator",children:(0,O.jsx)(fO,{dir:"ltr",children:(0,O.jsx)(l4,{icon:"check",small:!0})})}),e]})}let fq=0,fJ=$.memo(function({renderDebugMenuItems:e}){let t=l3(),n=(0,T.Hg)("show_fps",()=>N.showFps.get(),[N]);return(0,O.jsxs)("div",{className:"tlui-debug-panel",children:[(0,O.jsx)(fQ,{}),n&&(0,O.jsx)(f0,{}),(0,O.jsx)(f1,{}),(0,O.jsxs)(fN,{id:"debug",children:[(0,O.jsx)(fF,{children:(0,O.jsx)(cn,{type:"icon",icon:"dots-horizontal",title:t("debug-panel.more")})}),(0,O.jsx)(fU,{side:"top",align:"end",alignOffset:0,children:(0,O.jsx)(f2,{renderDebugMenuItems:e})})]})]})}),fQ=(0,T.j)(function(){!function(e=!0){let[t,n]=$.useState(0),r=(0,G.j)();$.useEffect(()=>{if(!e)return;let t=()=>n(e=>e+1);return r.on("tick",t),()=>{r.off("tick",t)}},[r,e])}();let e=(0,G.j)(),t=e.getPath(),n=e.getHoveredShape(),r=e.getOnlySelectedShape(),i="select.idle"!==t&&t.includes("select.")?r:n,o=i&&t.includes("select.")?` / ${i.type||""}${"geo"in i.props?" / "+i.props.geo:""} / [${eh.B.ToFixed(e.getPointInShapeSpace(i,e.inputs.currentPagePoint),0)}]`:"",s=t.startsWith("select.")&&!t.includes(".idle")?` / [${eh.B.ToFixed(e.inputs.originPagePoint,0)}] \u2192 [${eh.B.ToFixed(e.inputs.currentPagePoint,0)}] = ${eh.B.Dist(e.inputs.originPagePoint,e.inputs.currentPagePoint).toFixed(0)}`:"";return(0,O.jsx)("div",{className:"tlui-debug-panel__current-state",children:`${t}${o}${s}`})});function f0(){let e=$.useRef(null);return $.useEffect(()=>{let t=0,n=!1,r=performance.now(),i=0,o=0,s=!1;return function a(){if(!n){if(o++,(i=performance.now()-r)>250){let n=Math.round(250/i*o*4);n>t&&(t=n);let a=.75*t;(n<a&&!s||n>=a&&s)&&(s=!s),e.current.innerHTML=`FPS ${n.toString()}`,e.current.className="tlui-debug-panel__fps"+(s?" tlui-debug-panel__fps__slow":""),i-=250,o=0,r=performance.now()}requestAnimationFrame(a)}}(),()=>{n=!0}},[]),(0,O.jsx)("div",{ref:e})}let f1=function(){let e=(0,G.j)(),t=(0,T.Hg)("rendering shapes count",()=>e.getRenderingShapes().length,[e]);return(0,O.jsxs)("div",{children:[t," Shapes"]})},f2=(0,T.j)(function({renderDebugMenuItems:e}){let t=(0,G.j)(),{addToast:n}=dl(),{addDialog:r}=dh(),[i,o]=$.useState(!1);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(fK,{children:[(0,O.jsx)(fY,{type:"menu",onClick:()=>{n({id:(0,nh.E)(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0}),n({id:(0,nh.E)(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),n({id:(0,nh.E)(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,icon:"twitter",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]})},label:"Show toast"}),(0,O.jsx)(fY,{type:"menu",onClick:()=>{r({component:({onClose:e})=>(0,O.jsx)(f8,{displayDontShowAgain:!0,onCancel:()=>{e()},onContinue:()=>{e()}}),onClose:()=>{}})},label:"Show dialog"}),(0,O.jsx)(fY,{type:"menu",onClick:()=>(function(e,t){let n=Array(100),r=Math.floor(Math.sqrt(100));for(let e=0;e<100;e++)fq++,n[e]={id:(0,I.F1)("box"+fq),type:"geo",x:e%r*132,y:132*Math.floor(e/r)};e.batch(()=>{e.createShapes(n).setSelectedShapes(n.map(e=>e.id))})})(t,100),label:"Create 100 shapes"}),(0,O.jsx)(fY,{type:"menu",onClick:()=>{let e=t.getSelectedShapes(),n=0===e.length?t.getRenderingShapes():e,r=n.map(e=>document.getElementById(e.id).parentElement),i=r.length;for(let e of r)i+=function e({children:t}){let n=0;if(!t.length)return 0;for(let r of[...t])n++,n+=e(r);return n}(e);window.alert(`Shapes ${n.length}, DOM nodes:${i}`)},label:"Count shapes / nodes"}),(()=>{if(i)throw Error("oh no!")})(),(0,O.jsx)(fY,{type:"menu",onClick:()=>{o(!0)},label:"Throw error"}),(0,O.jsx)(fY,{type:"menu",onClick:()=>{ey()},label:"Hard reset"})]}),(0,O.jsxs)(fK,{children:[(0,O.jsx)(f3,{flag:N.debugSvg}),(0,O.jsx)(f3,{flag:N.showFps}),(0,O.jsx)(f3,{flag:N.forceSrgb}),(0,O.jsx)(f3,{flag:N.debugGeometry}),(0,O.jsx)(f3,{flag:N.hideShapes})]}),(0,O.jsx)(fK,{children:Object.values(z).map(e=>(0,O.jsx)(f3,{flag:e},e.name))}),e?.()]})});function f5({label:e,value:t,onChange:n}){return(0,O.jsx)(fG,{title:e,checked:t,onSelect:()=>n(!t),children:(0,O.jsx)("span",{className:"tlui-button__label",draggable:!1,children:e})})}let f3=(0,T.j)(function({flag:e,onChange:t}){return(0,O.jsx)(f5,{label:e.name.replace(/([a-z0-9])([A-Z])/g,e=>`${e[0]} ${e[1].toLowerCase()}`).replace(/^[a-z]/,e=>e.toUpperCase()),value:e.get(),onChange:n=>{e.set(n),t?.(n)}})});function f8({title:e="title",body:t="hello hello hello",cancel:n="Cancel",confirm:r="Continue",displayDontShowAgain:i=!1,onCancel:o,onContinue:s}){let[a,l]=$.useState(!1);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)(ub,{children:[(0,O.jsx)(uw,{children:e}),(0,O.jsx)(ux,{})]}),(0,O.jsx)(uv,{style:{maxWidth:350},children:t}),(0,O.jsxs)(uS,{className:"tlui-dialog__footer__actions",children:[i&&(0,O.jsx)(cn,{type:"normal",onClick:()=>l(!a),iconLeft:a?"check":"checkbox-empty",style:{marginRight:"auto"},children:"Don't show again"}),(0,O.jsx)(cn,{type:"normal",onClick:o,children:n}),(0,O.jsx)(cn,{type:"primary",onClick:async()=>s(),children:r})]})]})}let f4=({id:e,component:t,onClose:n})=>{let{removeDialog:r}=dh(),i=J(),o=(0,$.useCallback)(t=>{if(!t){if(n)try{n()}catch(e){console.warn(e)}r(e)}},[e,n,r]);return(0,O.jsx)(um,{onOpenChange:o,defaultOpen:!0,children:(0,O.jsx)(uy,{container:i,children:(0,O.jsx)(ur,{dir:"ltr",className:"tlui-dialog__overlay",onClick:e=>{e.target===e.currentTarget&&o(!1)},children:(0,O.jsx)(us,{dir:"ltr",className:"tlui-dialog__content",children:(0,O.jsx)(t,{onClose:()=>o(!1)})})})})})},f6=$.memo(function(){let{dialogs:e}=dh();return(0,O.jsx)(O.Fragment,{children:e.map(e=>(0,O.jsx)(f4,{...e},e.id))})});function f9(){let e=(0,G.j)(),t=(0,T.Hg)("follow",()=>e.getInstanceState().followingUserId,[e]);return t?(0,O.jsx)(f7,{userId:t}):null}function f7({userId:e}){let t=tO(e);return t?(0,O.jsx)("div",{className:"tlui-following-indicator",style:{borderColor:t.color}}):null}function ge(){let e=(0,G.j)(),{languages:t,currentLanguage:n}=dG(),r=(0,$.useCallback)(t=>e.user.updateUserPreferences({locale:t}),[e]);return(0,O.jsxs)(fV,{id:"help menu language",children:[(0,O.jsx)(fH,{label:"menu.language","data-direction":"left"}),(0,O.jsx)(fZ,{sideOffset:-4,children:(0,O.jsx)(fK,{children:t.map(({locale:e,label:t})=>(0,O.jsx)(fX,{title:e,checked:e===n,onSelect:()=>r(e),children:(0,O.jsx)("span",{className:"tlui-button__label",children:t})},e))})})]})}let gt=$.memo(function(){let e=J(),t=l3(),[n,r]=fz("help menu");return(0,O.jsx)("div",{className:"tlui-help-menu",children:(0,O.jsxs)(fD,{dir:"ltr",open:n,onOpenChange:r,modal:!1,children:[(0,O.jsx)(fT,{asChild:!0,dir:"ltr",children:(0,O.jsx)(cn,{type:"help",className:"tlui-button",smallIcon:!0,title:t("help-menu.title"),icon:"question-mark"})}),(0,O.jsx)(fL,{container:e,children:(0,O.jsx)(fj,{className:"tlui-menu",side:"top",sideOffset:8,align:"end",alignOffset:0,collisionPadding:4,children:(0,O.jsx)(gn,{})})})]})})});function gn(){let e=dJ(),t=r3();return(0,O.jsx)(O.Fragment,{children:e.map(function e(n){if(!n||t&&!n.readonlyOk)return null;switch(n.type){case"custom":if("LANGUAGE_MENU"===n.id)return(0,O.jsx)(ge,{},"item");break;case"group":return(0,O.jsx)(fK,{size:"small",children:n.children.map(e)},n.id);case"submenu":return(0,O.jsxs)(fV,{id:`help menu ${n.id}`,children:[(0,O.jsx)(fH,{label:n.label}),(0,O.jsx)(fZ,{children:n.children.map(e)})]},n.id);case"item":{let{id:e,kbd:t,label:r,onSelect:i,icon:o}=n.actionItem;return(0,O.jsx)(fY,{type:"menu",kbd:t,label:r,onClick:()=>i("help-menu"),iconLeft:o},e)}}})})}let gr="Popover",[gi,go]=a5(gr,[pi]),gs=pi(),[ga,gl]=gi(gr),gc=(0,$.forwardRef)((e,t)=>{let{__scopePopover:n,...r}=e,i=gl("PopoverTrigger",n),o=gs(n),s=a2(t,i.triggerRef),a=(0,$.createElement)(a7.button,aJ({type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":gb(i.open)},r,{ref:s,onClick:a0(e.onClick,i.onOpenToggle)}));return i.hasCustomAnchor?a:(0,$.createElement)(pa,aJ({asChild:!0},o),a)}),gu="PopoverPortal",[gd,gh]=gi(gu,{forceMount:void 0}),gp="PopoverContent",gf=(0,$.forwardRef)((e,t)=>{let n=gh(gp,e.__scopePopover),{forceMount:r=n.forceMount,...i}=e,o=gl(gp,e.__scopePopover);return(0,$.createElement)(lu,{present:r||o.open},o.modal?(0,$.createElement)(gg,aJ({},i,{ref:t})):(0,$.createElement)(gm,aJ({},i,{ref:t})))}),gg=(0,$.forwardRef)((e,t)=>{let n=gl(gp,e.__scopePopover),r=(0,$.useRef)(null),i=a2(t,r),o=(0,$.useRef)(!1);return(0,$.useEffect)(()=>{let e=r.current;if(e)return c5(e)},[]),(0,$.createElement)(cX,{as:a3,allowPinchZoom:!0},(0,$.createElement)(gy,aJ({},e,{ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:a0(e.onCloseAutoFocus,e=>{var t;e.preventDefault(),o.current||null===(t=n.triggerRef.current)||void 0===t||t.focus()}),onPointerDownOutside:a0(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,r=2===t.button||n;o.current=r},{checkForDefaultPrevented:!1}),onFocusOutside:a0(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1})})))}),gm=(0,$.forwardRef)((e,t)=>{let n=gl(gp,e.__scopePopover),r=(0,$.useRef)(!1),i=(0,$.useRef)(!1);return(0,$.createElement)(gy,aJ({},e,{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var o,s;null===(o=e.onCloseAutoFocus)||void 0===o||o.call(e,t),t.defaultPrevented||(r.current||null===(s=n.triggerRef.current)||void 0===s||s.focus(),t.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:t=>{var o,s;null===(o=e.onInteractOutside)||void 0===o||o.call(e,t),t.defaultPrevented||(r.current=!0,"pointerdown"!==t.detail.originalEvent.type||(i.current=!0));let a=t.target;(null===(s=n.triggerRef.current)||void 0===s?void 0:s.contains(a))&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&i.current&&t.preventDefault()}}))}),gy=(0,$.forwardRef)((e,t)=>{let{__scopePopover:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,disableOutsidePointerEvents:s,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onInteractOutside:u,...d}=e,h=gl(gp,n),p=gs(n);return cm(),(0,$.createElement)(cc,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:o},(0,$.createElement)(li,{asChild:!0,disableOutsidePointerEvents:s,onInteractOutside:u,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onDismiss:()=>h.onOpenChange(!1)},(0,$.createElement)(pd,aJ({"data-state":gb(h.open),role:"dialog",id:h.contentId},p,d,{ref:t,style:{...d.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}}))))});function gb(e){return e?"open":"closed"}let gw=e=>{let{__scopePopover:t,children:n,open:r,defaultOpen:i,onOpenChange:o,modal:s=!1}=e,a=gs(t),l=(0,$.useRef)(null),[c,u]=(0,$.useState)(!1),[d=!1,h]=lh({prop:r,defaultProp:i,onChange:o});return(0,$.createElement)(py,a,(0,$.createElement)(ga,{scope:t,contentId:co(),triggerRef:l,open:d,onOpenChange:h,onOpenToggle:(0,$.useCallback)(()=>h(e=>!e),[h]),hasCustomAnchor:c,onCustomAnchorAdd:(0,$.useCallback)(()=>u(!0),[]),onCustomAnchorRemove:(0,$.useCallback)(()=>u(!1),[]),modal:s},n))},gx=e=>{let{__scopePopover:t,forceMount:n,children:r,container:i}=e,o=gl(gu,t);return(0,$.createElement)(gd,{scope:t,forceMount:n},(0,$.createElement)(lu,{present:n||o.open},(0,$.createElement)(ll,{asChild:!0,container:i},r)))},gv=({id:e,children:t,onOpenChange:n,open:r})=>{let[i,o]=fz(e,n);return(0,O.jsx)(gw,{onOpenChange:o,open:r||i,children:(0,O.jsx)("div",{className:"tlui-popover",children:t})})},gS=({children:e,disabled:t,"data-testid":n})=>(0,O.jsx)(gc,{"data-testid":n,disabled:t,asChild:!0,dir:"ltr",children:e}),gk=({side:e,children:t,align:n="center",sideOffset:r=8,alignOffset:i=0})=>{let o=J();return(0,O.jsx)(gx,{container:o,children:(0,O.jsx)(gf,{className:"tlui-popover__content",side:e,sideOffset:r,align:n,alignOffset:i,dir:"ltr",children:t})})},g_=(0,$.memo)(function(){let e=l3(),t=J(),n=dL(),r=r3();return(0,O.jsxs)(gv,{id:"actions-menu",children:[(0,O.jsx)(gS,{children:(0,O.jsx)(cn,{className:"tlui-menu__trigger","data-testid":"main.action-menu",icon:"dots-vertical",title:e("actions-menu.title"),type:"icon",smallIcon:!0})}),(0,O.jsx)(gx,{container:t,children:(0,O.jsx)(gf,{className:"tlui-popover__content",side:"bottom",dir:"ltr",sideOffset:6,children:(0,O.jsx)("div",{className:"tlui-actions-menu tlui-buttons__grid",children:n.map(function(t){if(!t||r&&!t.readonlyOk)return null;if("item"===t.type){let{id:n,icon:r,label:i,kbd:o,onSelect:s}=t.actionItem;return(0,O.jsx)(cn,{"data-testid":`menu-item.${t.id}`,icon:r,type:"icon",title:i?o?`${e(i)} ${ce(o)}`:`${e(i)}`:o?`${ce(o)}`:"",onClick:()=>s("actions-menu"),disabled:t.disabled},n)}})})})})]})}),gE=(0,T.j)(function(){let e=(0,G.j)(),t=dw(),n=l3(),r=t.duplicate,i=(0,$.useRef)(null);return(0,O.jsx)(cn,{icon:r.icon,type:"icon",onClick:()=>r.onSelect("quick-actions"),disabled:!(e.isIn("select")&&e.getSelectedShapeIds().length>0),title:`${n(r.label)} ${ce(r.kbd)}`,smallIcon:!0,ref:i})}),gC=$.memo(function(){let e=l3();return(0,O.jsxs)(fN,{id:"main menu",children:[(0,O.jsx)(fF,{children:(0,O.jsx)(cn,{type:"icon",className:"tlui-menu__trigger","data-testid":"main.menu",title:e("menu.title"),icon:"menu",smallIcon:!0})}),(0,O.jsx)(fU,{alignOffset:0,sideOffset:6,children:(0,O.jsx)(gP,{})})]})});function gP(){let e=(0,G.j)(),t=l3(),n=d5(),r=dO(),i=r3();return(0,O.jsx)(O.Fragment,{children:n.map(n=>(function e(n,o,s,a){if(!o)return null;switch(o.type){case"custom":if(i&&!o.readonlyOk)return null;if("LANGUAGE_MENU"===o.id)return(0,O.jsx)(ge,{},"item");return null;case"group":if(i&&!o.readonlyOk)return null;return(0,O.jsx)(fK,{size:a<=1?"medium":r<3||s?.type==="submenu"&&a>2?"tiny":"medium",children:o.children.map(t=>e(n,t,o,a+1))},o.id);case"submenu":if(i&&!o.readonlyOk)return null;return(0,O.jsxs)(fV,{id:`main menu ${s?s.id+" ":""}${o.id}`,children:[(0,O.jsx)(fH,{label:o.label,"data-testid":`menu-item.${o.id}`}),(0,O.jsx)(fZ,{sideOffset:-4,alignOffset:-1,children:o.children.map(t=>e(n,t,o,a+1))})]},o.id);case"item":{if(i&&!o.readonlyOk)return null;let{id:e,checkbox:n,menuLabel:r,label:s,onSelect:a,kbd:l}=o.actionItem,c=r??s,u=c?t(c):void 0;if(n)return(0,O.jsxs)(fG,{onSelect:()=>a("menu"),title:u||"",checked:o.checked,disabled:o.disabled,children:[u&&(0,O.jsx)("span",{className:"tlui-button__label",children:u}),l&&(0,O.jsx)(ct,{children:l})]},e);return(0,O.jsx)(fY,{type:"menu","data-testid":`menu-item.${o.id}`,kbd:l,label:c,onClick:()=>a("menu"),disabled:o.disabled},e)}}})(e,n,null,0))})}let gT=function({name:e,id:t,isCurrentPage:n}){let r=(0,G.j)(),i=(0,$.useRef)(null),o=(0,$.useCallback)(e=>{r.renamePage(t,e||"New Page",{ephemeral:!0})},[r,t]),s=(0,$.useCallback)(e=>{r.mark("rename page"),r.renamePage(t,e||"New Page",{ephemeral:!1})},[r,t]);return(0,O.jsx)(uk,{className:"tlui-page-menu__item__input",ref:e=>i.current=e,defaultValue:e,onValueChange:o,onComplete:s,onCancel:s,shouldManuallyMaintainScrollPositionWhenFocused:!0,autofocus:n,autoselect:!0})},gj=(e,t,n,r)=>{let i;let o=e.getPages(),s=n>r?o[r-1]:o[r],a=n>r?o[r]:o[r+1];(i=s&&!a?(0,rV._L)(s.index):!s&&a?(0,rV.Xg)(o[0].index):(0,rV.eI)(s.index,a.index))!==o[n].index&&(e.mark("moving page"),e.updatePage({id:t,index:i}))},gI=(0,T.j)(function({index:e,listSize:t,item:n,onRename:r}){let i=(0,G.j)(),o=l3(),s=i.getPages(),a=(0,$.useCallback)(()=>{i.mark("creating page");let e=I.ez.createId();i.duplicatePage(n.id,e)},[i,n]),l=(0,$.useCallback)(()=>{gj(i,n.id,e,e-1)},[i,n,e]),c=(0,$.useCallback)(()=>{gj(i,n.id,e,e+1)},[i,n,e]),u=(0,$.useCallback)(()=>{i.mark("deleting page"),i.deletePage(n.id)},[i,n]);return(0,O.jsxs)(fN,{id:`page item submenu ${e}`,children:[(0,O.jsx)(fF,{children:(0,O.jsx)(cn,{type:"icon",title:o("page-menu.submenu.title"),icon:"dots-vertical"})}),(0,O.jsxs)(fU,{alignOffset:0,children:[(0,O.jsxs)(fK,{children:[r&&(0,O.jsx)(fM,{dir:"ltr",onSelect:r,asChild:!0,children:(0,O.jsx)(cn,{type:"menu",label:"page-menu.submenu.rename"})}),(0,O.jsx)(fM,{dir:"ltr",onSelect:a,disabled:s.length>=L.Et,asChild:!0,children:(0,O.jsx)(cn,{type:"menu",label:"page-menu.submenu.duplicate-page"})}),e>0&&(0,O.jsx)(fM,{dir:"ltr",onSelect:l,asChild:!0,children:(0,O.jsx)(cn,{type:"menu",label:"page-menu.submenu.move-up"})}),e<t-1&&(0,O.jsx)(fM,{dir:"ltr",onSelect:c,asChild:!0,children:(0,O.jsx)(cn,{type:"menu",label:"page-menu.submenu.move-down"})})]}),t>1&&(0,O.jsx)(fK,{children:(0,O.jsx)(fM,{dir:"ltr",onSelect:u,asChild:!0,children:(0,O.jsx)(cn,{type:"menu",label:"page-menu.submenu.delete"})})})]})]})}),gM=function(){let e=(0,G.j)(),t=l3(),n=dO(),[r,i]=fz("page-menu",(0,$.useCallback)(()=>p(!1),[])),o=(0,$.useRef)(null),s=(0,T.Hg)("pages",()=>e.getPages(),[e]),a=(0,T.Hg)("currentPage",()=>e.getCurrentPage(),[e]),l=(0,T.Hg)("currentPageId",()=>e.getCurrentPageId(),[e]),c=r3(),u=(0,T.Hg)("maxPageCountReached",()=>e.getPages().length>=L.Et,[e]),d=(0,T.Hg)("isCoarsePointer",()=>e.getInstanceState().isCoarsePointer,[e]),[h,p]=(0,$.useState)(!1),f=(0,$.useCallback)(()=>{c||p(e=>!e)},[c]),g=(0,$.useRef)({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[m,y]=(0,$.useState)(Object.fromEntries(s.map((e,t)=>[e.id,{y:36*t,offsetY:0,isSelected:!1}])));(0,$.useLayoutEffect)(()=>{y(Object.fromEntries(s.map((e,t)=>[e.id,{y:36*t,offsetY:0,isSelected:!1}])))},[36,s]),(0,$.useEffect)(()=>{r&&requestAnimationFrame(()=>{let e=document.querySelector(`[data-testid="page-menu-item-${l}"]`);if(e){let t=o.current;if(!t)return;let n=e.offsetTop;n<t.scrollTop&&t.scrollTo({top:n});let r=n+36;r>t.scrollTop+t.offsetHeight&&t.scrollTo({top:r-t.offsetHeight})}})},[36,l,r]);let b=(0,$.useCallback)(e=>{let{clientY:t,currentTarget:n}=e,{dataset:{id:r,index:i}}=n;if(!r||!i)return;let o=g.current;Z(e.currentTarget,e),o.status="pointing",o.pointing={id:r,index:+i};let a=m[r].y;o.startY=t,o.startIndex=Math.max(0,Math.min(Math.round(a/36),s.length-1))},[36,s.length,m]),w=(0,$.useCallback)(e=>{let t=g.current;if("pointing"===t.status){let{clientY:n}=e;Math.abs(n-t.startY)>5&&(t.status="dragging")}if("dragging"===t.status){let{clientY:n}=e,r=n-t.startY,i=m[t.pointing.id],{startIndex:o,pointing:a}=t,l=Math.max(0,Math.min(Math.round((i.y+r)/36),s.length-1)),c={...m};if(c[a.id]={y:i.y,offsetY:r,isSelected:!0},l!==t.dragIndex){t.dragIndex=l;for(let e=0;e<s.length;e++){let n=s[e];if(n.id===t.pointing.id)continue;let{y:r}=c[n.id];l===o?r=36*e:l<o?r=l<=e&&e<o?(e+1)*36:36*e:l>o&&(r=l>=e&&e>o?(e-1)*36:36*e),r!==c[n.id].y&&(c[n.id]={y:r,offsetY:0,isSelected:!0})}}y(c)}},[36,s,m]),x=(0,$.useCallback)(t=>{let n=g.current;if("dragging"===n.status){let{id:t,index:r}=n.pointing;gj(e,t,r,n.dragIndex)}K(t.currentTarget,t),n.status="idle"},[e]),v=(0,$.useCallback)(e=>{let t=g.current;"Escape"===e.key&&("dragging"===t.status&&y(Object.fromEntries(s.map((e,t)=>[e.id,{y:36*t,offsetY:0,isSelected:!1}]))),t.status="idle")},[36,s]),S=(0,$.useCallback)(()=>{c||e.batch(()=>{e.mark("creating page");let n=I.ez.createId();e.createPage({name:t("page-menu.new-page-initial-name"),id:n}),e.setCurrentPage(n),p(!0)})},[e,t,c]);return(0,O.jsxs)(gv,{id:"pages",onOpenChange:i,open:r,children:[(0,O.jsx)(gS,{children:(0,O.jsx)(cn,{className:"tlui-page-menu__trigger tlui-menu__trigger","data-testid":"main.page-menu",icon:"chevron-down",type:"menu",title:a.name,children:(0,O.jsx)("div",{className:"tlui-page-menu__name",children:a.name})})}),(0,O.jsx)(gk,{side:"bottom",align:"start",sideOffset:6,children:(0,O.jsxs)("div",{className:"tlui-page-menu__wrapper",children:[(0,O.jsxs)("div",{className:"tlui-page-menu__header",children:[(0,O.jsx)("div",{className:"tlui-page-menu__header__title",children:t("page-menu.title")}),!c&&(0,O.jsxs)("div",{className:"tlui-buttons__horizontal",children:[(0,O.jsx)(cn,{type:"icon","data-testid":"page-menu.edit",title:t(h?"page-menu.edit-done":"page-menu.edit-start"),icon:h?"check":"edit",onClick:f}),(0,O.jsx)(cn,{type:"icon","data-testid":"page-menu.create",icon:"plus",title:t(u?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:u,onClick:S})]})]}),(0,O.jsx)("div",{className:"tlui-page-menu__list tlui-menu__group",style:{height:36*s.length+4},ref:o,children:s.map((r,i)=>{let o=m[r.id]??{position:40*i,offsetY:0};return h?(0,O.jsxs)("div",{"data-testid":`page-menu-item-${r.id}`,className:"tlui-page_menu__item__sortable",style:{zIndex:r.id===a.id?888:i,transform:`translate(0px, ${o.y+o.offsetY}px)`},children:[(0,O.jsx)(cn,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",icon:"drag-handle-dots",onPointerDown:b,onPointerUp:x,onPointerMove:w,onKeyDown:v,"data-id":r.id,"data-index":i}),n<5&&d?(0,O.jsx)(cn,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{let t=window.prompt("Rename page",r.name);t&&t!==r.name&&e.renamePage(r.id,t)},onDoubleClick:f,isChecked:r.id===a.id,children:(0,O.jsx)("span",{children:r.name})}):(0,O.jsx)("div",{className:"tlui-page_menu__item__sortable__title",style:{height:36},children:(0,O.jsx)(gT,{id:r.id,name:r.name,isCurrentPage:r.id===a.id})}),!c&&(0,O.jsx)("div",{className:"tlui-page_menu__item__submenu","data-isediting":h,children:(0,O.jsx)(gI,{index:i,item:r,listSize:s.length})})]},r.id+"_editing"):(0,O.jsxs)("div",{"data-testid":`page-menu-item-${r.id}`,className:"tlui-page-menu__item",children:[(0,O.jsxs)(cn,{type:"normal",className:"tlui-page-menu__item__button tlui-page-menu__item__button__checkbox",onClick:()=>e.setCurrentPage(r.id),onDoubleClick:f,isChecked:r.id===a.id,title:t("page-menu.go-to-page"),children:[(0,O.jsx)("div",{className:"tlui-page-menu__item__button__check",children:r.id===a.id&&(0,O.jsx)(l4,{icon:"check"})}),(0,O.jsx)("span",{children:r.name})]}),!c&&(0,O.jsx)("div",{className:"tlui-page_menu__item__submenu",children:(0,O.jsx)(gI,{index:i,item:r,listSize:s.length,onRename:()=>{if(e.environment.isIos){let t=window.prompt("Rename page",r.name);t&&t!==r.name&&e.renamePage(r.id,t)}else e.batch(()=>{p(!0),e.setCurrentPage(r.id)})}})})]},r.id)})})]})})]})},gA=(0,$.memo)(function(){let e=l3(),t=dQ(),n=dw().redo,r=(0,$.useRef)(null);return(0,O.jsx)(cn,{"data-testid":"main.redo",icon:n.icon,type:"icon",title:`${e(n.label)} ${ce(n.kbd)}`,disabled:!t,onClick:()=>n.onSelect("quick-actions"),smallIcon:!0,ref:r})}),gO=(0,T.j)(function(){let e=(0,G.j)(),t=dw(),n=l3(),r=t.delete,i=r3(),o=(0,$.useRef)(null);return i?null:(0,O.jsx)(cn,{icon:r.icon,type:"icon",onClick:()=>{r.onSelect("quick-actions"),e.getContainer().focus()},disabled:!(e.isIn("select")&&e.getSelectedShapeIds().length>0),title:`${n(r.label)} ${ce(r.kbd)}`,smallIcon:!0,ref:o})}),g$=(0,$.memo)(function(){let e=l3(),t=d0(),n=dw(),r=(0,$.useRef)(null),i=n.undo;return(0,O.jsx)(cn,{"data-testid":"main.undo",icon:i.icon,type:"icon",title:`${e(i.label)} ${ce(i.kbd)}`,disabled:!t,onClick:()=>i.onSelect("quick-actions"),smallIcon:!0,ref:r})}),gB=(0,T.j)(function(){let e=(0,G.j)(),t=dO(),n=r3();return(0,O.jsx)("div",{className:"tlui-menu-zone",children:(0,O.jsxs)("div",{className:"tlui-buttons__horizontal",children:[(0,O.jsx)(gC,{}),(0,O.jsx)(gM,{}),t>=6&&!n&&!e.isInAny("hand","zoom")&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(g$,{}),(0,O.jsx)(gA,{}),(0,O.jsx)(gO,{}),(0,O.jsx)(gE,{}),(0,O.jsx)(g_,{})]})]})})});function gD(e,t){let[n,r]=$.useState(t);return $.useLayoutEffect(()=>{let t=localStorage.getItem(e);if(t)try{r(JSON.parse(t))}catch(t){console.error(`Could not restore value ${e} from local storage.`)}},[e]),[n,$.useCallback(t=>{r(n=>{let r="function"==typeof t?t(n):t;return localStorage.setItem(e,JSON.stringify(r)),r})},[e])]}class gL{constructor(e){this.editor=e}dpr=1;colors={shapeFill:"rgba(144, 144, 144, .1)",selectFill:"#2f80ed",viewportFill:"rgba(144, 144, 144, .1)"};id=(0,nh.E)();cvs=null;pageBounds=[];collaborators=[];canvasScreenBounds=new rS.xu;canvasPageBounds=new rS.xu;contentPageBounds=new rS.xu;contentScreenBounds=new rS.xu;originPagePoint=new eh.B;originPageCenter=new eh.B;isInViewport=!1;debug=!1;setDpr(e){this.dpr=+e.toFixed(2)}updateContentScreenBounds=()=>{let{contentScreenBounds:e,contentPageBounds:t,canvasScreenBounds:n}=this,{x:r,y:i,w:o,h:s}=e;if(t.w>t.h){let e=n.w/(t.w/t.h);e>n.h?(r=(n.w-n.w*(n.h/e))/2,i=0,o=n.w*(n.h/e),s=n.h):(r=0,i=(n.h-e)/2,o=n.w,s=e)}else if(t.w<t.h){let e=n.h/(t.h/t.w);r=(n.w-e)/2,i=0,o=e,s=n.h}else r=n.h/2,i=0,o=n.h,s=n.h;e.set(r,i,o,s)};updateCanvasPageBounds=()=>{let{canvasPageBounds:e,canvasScreenBounds:t,contentPageBounds:n,contentScreenBounds:r}=this;e.set(0,0,n.width/(r.width/t.width),n.height/(r.height/t.height)),e.center=n.center};getScreenPoint=(e,t)=>{let{canvasScreenBounds:n}=this;return{x:(e-n.minX)*this.dpr,y:(t-n.minY)*this.dpr}};getPagePoint=(e,t)=>{let{contentPageBounds:n,contentScreenBounds:r,canvasPageBounds:i}=this,{x:o,y:s}=this.getScreenPoint(e,t);return new eh.B(i.minX+o*n.width/r.width,i.minY+s*n.height/r.height,1)};minimapScreenPointToPagePoint=(e,t,n=!1,r=!1)=>{let{editor:i}=this,o=i.getViewportPageBounds(),{x:s,y:a}=this.getPagePoint(e,t);if(r){let e=this.editor.getCurrentPageBounds(),t=(e?.minX??0)-o.width/2,n=(e?.maxX??0)+o.width/2,r=(e?.minY??0)-o.height/2,i=(e?.maxY??0)+o.height/2,l=Math.max(0,t+o.width-s),c=Math.max(0,-(n-o.width-s)),u=Math.max(0,r+o.height-a),d=Math.max(0,-(i-o.height-a)),h=Math.max(0,l-c),p=Math.max(0,c-l),f=Math.max(0,u-d),g=Math.max(0,d-u);h&&h>p?s+=h/2:p&&(s-=p/2),f&&f>g?a+=f/2:g&&(a-=g/2),s=(0,eu.uZ)(s,t,n),a=(0,eu.uZ)(a,r,i)}if(n){let{originPagePoint:e}=this;Math.abs(s-e.x)>Math.abs(a-e.y)?a=e.y:s=e.x}return new eh.B(s,a)};render=()=>{let e,t;let{cvs:n,pageBounds:r}=this;this.updateCanvasPageBounds();let{editor:i,canvasScreenBounds:o,canvasPageBounds:s,contentPageBounds:a,contentScreenBounds:l}=this,{width:c,height:u}=o,d=i.getSelectedShapeIds(),h=i.getViewportPageBounds();if(!n||!r)return;let p=n.getContext("2d");if(!p)throw Error("Minimap (shapes): Could not get context");p.resetTransform(),p.globalAlpha=1,p.clearRect(0,0,c,u);let f=l.width/a.width,g=l.height/a.height;p.translate((c-l.width)/2,(u-l.height)/2),p.scale(f,g),p.translate(-a.minX,-a.minY);let m=8/f,y=8/f,b=1/f,w=1/f,x=m/4,v=y/4,S=new Path2D,k=new Path2D,{shapeFill:_,selectFill:E,viewportFill:C}=this.colors;for(let t=0,n=r.length;t<n;t++)e=r[t],gL.roundedRect(d.includes(e.id)?k:S,e.minX,e.minY,e.width,e.height,(0,eu.uZ)(m,b,e.width/x),(0,eu.uZ)(y,w,e.height/v));if(p.fillStyle=_,p.fill(S),p.fillStyle=E,p.fill(k),this.debug){let{minX:e,minY:t,width:n,height:i}=rS.xu.Common(r);p.strokeStyle="green",p.lineWidth=2/f,p.strokeRect(e+1/f,t+1/g,n-2/f,i-2/g)}{let{brush:e}=i.getInstanceState();if(e){let{x:t,y:n,w:r,h:i}=e;p.beginPath(),gL.sharpRect(p,t,n,r,i),p.closePath(),p.fillStyle=C,p.fill()}}{let{minX:e,minY:t,width:n,height:r}=h;p.beginPath();let i=12/f,o=12/f;gL.roundedRect(p,e,t,n,r,Math.min(n/4,i),Math.min(r/4,o)),p.closePath(),p.fillStyle=C,p.fill(),this.debug&&(p.strokeStyle="orange",p.strokeRect(e+1/f,t+1/g,n-2/f,r-2/g))}let P=2.5/f,T=2.5/g,j=i.getCurrentPageId();for(let e=0;e<this.collaborators.length;e++)(t=this.collaborators[e]).currentPageId===j&&(p.beginPath(),p.ellipse((0,eu.uZ)(t.cursor.x,s.minX+P,s.maxX-P),(0,eu.uZ)(t.cursor.y,s.minY+T,s.maxY-T),5/f,5/g,0,0,eu.yo),p.fillStyle=t.color,p.fill());if(this.debug){p.lineWidth=2/f;{let{minX:e,minY:t,width:n,height:r}=a;p.strokeStyle="red",p.strokeRect(e+1/f,t+1/g,n-2/f,r-2/g)}{let{minX:e,minY:t,width:n,height:r}=s;p.strokeStyle="blue",p.strokeRect(e+1/f,t+1/g,n-2/f,r-2/g)}}};static roundedRect(e,t,n,r,i,o,s){if(o<1&&s<1){e.rect(t,n,r,i);return}e.moveTo(t+o,n),e.lineTo(t+r-o,n),e.quadraticCurveTo(t+r,n,t+r,n+s),e.lineTo(t+r,n+i-s),e.quadraticCurveTo(t+r,n+i,t+r-o,n+i),e.lineTo(t+o,n+i),e.quadraticCurveTo(t,n+i,t,n+i-s),e.lineTo(t,n+s),e.quadraticCurveTo(t,n,t+o,n)}static sharpRect(e,t,n,r,i,o,s){e.rect(t,n,r,i)}}function gR({shapeFill:e,selectFill:t,viewportFill:n}){let r=(0,G.j)(),i=$.useRef(null),o=$.useRef(!1),s=ni(),a=(0,T.vc)("dpr",()=>r.getInstanceState().devicePixelRatio,[r]),l=$.useMemo(()=>r.store.query.records("instance_presence"),[r]),c=$.useMemo(()=>new gL(r),[r]);$.useEffect(()=>{let i=requestAnimationFrame(()=>{let i=getComputedStyle(r.getContainer());c.colors={shapeFill:i.getPropertyValue(e).trim(),selectFill:i.getPropertyValue(t).trim(),viewportFill:i.getPropertyValue(n).trim()},c.render()});return()=>{cancelAnimationFrame(i)}},[r,t,e,n,c,s]);let u=$.useCallback(e=>{if(!r.getCurrentPageShapeIds().size)return;let t=c.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!1),n=c.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!0);c.originPagePoint.setTo(n),c.originPageCenter.setTo(r.getViewportPageBounds().center),r.centerOnPoint(t,{duration:L.KD})},[r,c]),d=$.useCallback(e=>{let t=e.currentTarget;if(Z(t,e),!r.getCurrentPageShapeIds().size)return;o.current=!0,c.isInViewport=!1;let n=c.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!1),i=c.minimapScreenPointToPagePoint(e.clientX,e.clientY,!1,!0),s=r.getViewportPageBounds();if(c.isInViewport=s.containsPoint(i),c.isInViewport)c.originPagePoint.setTo(i),c.originPageCenter.setTo(s.center);else{let e=eh.B.Sub(s.center,s.point),t=eh.B.Add(n,e);c.originPagePoint.setTo(t),c.originPageCenter.setTo(n),r.centerOnPoint(n,{duration:L.KD})}document.body.addEventListener("pointerup",function e(n){t&&K(t,n),o.current=!1,document.body.removeEventListener("pointerup",e)})},[r,c]),h=$.useCallback(e=>{let t=c.minimapScreenPointToPagePoint(e.clientX,e.clientY,e.shiftKey,!0);if(o.current){if(c.isInViewport){let e=c.originPagePoint.clone().sub(c.originPageCenter);r.centerOnPoint(eh.B.Sub(t,e));return}r.centerOnPoint(t)}let n=c.getPagePoint(e.clientX,e.clientY),i=r.pageToScreen(n),s={type:"pointer",target:"canvas",name:"pointer_move",...Y(e),point:i,isPen:r.getInstanceState().isPenMode};r.dispatch(s)},[r,c]),p=$.useCallback(e=>{let t=tv(e);r.dispatch({type:"wheel",name:"wheel",delta:t,point:new eh.B(e.clientX,e.clientY),shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey})},[r]);return(0,T.BK)("update when dpr changes",()=>{let e=a.get();c.setDpr(e);let t=i.current,n=t.getBoundingClientRect(),r=n.width*e,o=n.height*e;t.width=r,t.height=o,c.canvasScreenBounds.set(n.x,n.y,r,o),c.cvs=i.current},[a,c]),(0,T.BK)("minimap render when pagebounds or collaborators changes",()=>{let e=r.getCurrentPageShapeIds(),t=r.getCurrentPageBounds(),n=r.getViewportPageBounds();a.get(),c.contentPageBounds=t?rS.xu.Expand(t,n):n,c.updateContentScreenBounds();let i=[];e.forEach(e=>{let t=r.getShapePageBounds(e);if(!t)return;let n=r.getShapeMask(e);if(n){let e=(0,r_.tY)(n,t.corners);if(!e)return;t=rS.xu.FromPoints(e)}t&&(t.id=e,i.push(t))}),c.pageBounds=i,c.collaborators=l.get(),c.render()},[r,c]),(0,O.jsx)("div",{className:"tlui-minimap",children:(0,O.jsx)("canvas",{ref:i,className:"tlui-minimap__canvas",onDoubleClick:u,onPointerMove:h,onPointerDown:d,onWheel:p})})}let gz=(0,T.j)(function(){let e=(0,G.j)(),t=l3(),n=dO(),r=e.getZoomLevel(),i=e.getCurrentPageShapeIds().size>0,o=e.getSelectedShapeIds().length>0,s=1===e.getZoomLevel(),a=$.useCallback(()=>{e.resetZoom(e.getViewportScreenCenter(),{duration:L.KD})},[e]);return(0,O.jsxs)(fN,{id:"zoom",children:[(0,O.jsx)(fF,{children:(0,O.jsx)(cn,{type:"icon",title:`${t("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu",className:n<5?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:a,icon:n<4?"zoom-in":void 0,children:n<4?null:(0,O.jsxs)("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(100*r),"%"]})})}),(0,O.jsx)(fU,{side:"top",align:"start",alignOffset:0,children:(0,O.jsxs)(fK,{children:[(0,O.jsx)(gN,{action:"zoom-in","data-testid":"minimap.zoom-menu.zoom-in",noClose:!0}),(0,O.jsx)(gN,{action:"zoom-out","data-testid":"minimap.zoom-menu.zoom-out",noClose:!0}),(0,O.jsx)(gN,{action:"zoom-to-100","data-testid":"minimap.zoom-menu.zoom-to-100",noClose:!0,disabled:s}),(0,O.jsx)(gN,{action:"zoom-to-fit",disabled:!i,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0}),(0,O.jsx)(gN,{action:"zoom-to-selection",disabled:!o,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})]})})]})});function gN(e){let{action:t,disabled:n=!1,noClose:r=!1}=e,i=dw();return(0,O.jsx)(fY,{type:"menu",label:i[t].label,kbd:i[t].kbd,"data-testid":e["data-testid"],onClick:()=>i[t].onSelect("zoom-menu"),noClose:r,disabled:n})}let gF=(0,$.memo)(function(){let e=dw(),t=l3(),n=dO(),[r,i]=gD("minimap",!0),o=(0,$.useCallback)(()=>{i(e=>!e)},[i]);return n<4?null:(0,O.jsxs)("div",{className:"tlui-navigation-zone",children:[(0,O.jsx)("div",{className:"tlui-buttons__horizontal",children:n<6?(0,O.jsx)(gz,{}):r?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(gz,{}),(0,O.jsx)(cn,{type:"icon",icon:r?"chevrons-ne":"chevrons-sw","data-testid":"minimap.toggle",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-zone__toggle",onClick:o})]}):(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(cn,{type:"icon",icon:"minus","data-testid":"minimap.zoom-out",title:`${t(e["zoom-out"].label)} ${ce(e["zoom-out"].kbd)}`,onClick:()=>e["zoom-out"].onSelect("navigation-zone")}),(0,O.jsx)(gz,{}),(0,O.jsx)(cn,{type:"icon",icon:"plus","data-testid":"minimap.zoom-in",title:`${t(e["zoom-in"].label)} ${ce(e["zoom-in"].kbd)}`,onClick:()=>e["zoom-in"].onSelect("navigation-zone")}),(0,O.jsx)(cn,{type:"icon",icon:r?"chevrons-ne":"chevrons-sw","data-testid":"minimap.toggle",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-zone__toggle",onClick:o})]})}),n>=6&&!r&&(0,O.jsx)(gR,{viewportFill:"--color-muted-1",selectFill:"--color-selected",shapeFill:"--color-text-3"})]})}),gU=(0,T.j)(function(){let e=(0,G.j)().getInstanceState().isPenMode,t=dw();if(!e)return null;let n=t["exit-pen-mode"];return(0,O.jsx)(cn,{type:"normal",label:n.label,iconLeft:n.icon,onClick:()=>n.onSelect("helper-buttons")})}),gV=(0,T.j)(function(){let e=(0,G.j)(),t=dw();if(!e.getInstanceState().followingUserId)return null;let n=t["stop-following"];return(0,O.jsx)(cn,{type:"normal",label:n.label,iconLeft:n.icon,onClick:()=>n.onSelect("people-menu")})}),gH=[I.R_,I.ci,I.pp,I.ST];function gZ(){let e=(0,G.j)();return(0,T.Hg)("getRelevantStyles",()=>{let t=new rL.o(e.getSharedStyles()),n=e.getSelectedShapeIds().length>0||!!e.root.getCurrent()?.shapeType;if(0===t.size&&e.isIn("select")&&0===e.getSelectedShapeIds().length)for(let n of gH)t.applyValue(n,e.getStyleForNextShape(n));return 0!==t.size||n?{styles:t,opacity:e.getSharedOpacity()}:null},[e])}let gK=$.memo(function(e){let{uiType:t,items:n,title:r,style:i,value:o,onValueChange:s}=e,a=(0,G.j)(),l=l3(),c=(0,$.useRef)(!1),{handleButtonClick:u,handleButtonPointerDown:d,handleButtonPointerEnter:h,handleButtonPointerUp:p}=$.useMemo(()=>{let e=()=>{c.current=!1,window.removeEventListener("pointerup",e)};return{handleButtonClick:e=>{let{id:t}=e.currentTarget.dataset;("shared"!==o.type||o.value!==t)&&(a.mark("point picker item"),s(i,t,!1))},handleButtonPointerDown:t=>{let{id:n}=t.currentTarget.dataset;a.mark("point picker item"),s(i,n,!0),c.current=!0,window.addEventListener("pointerup",e)},handleButtonPointerEnter:e=>{if(!c.current)return;let{id:t}=e.currentTarget.dataset;s(i,t,!0)},handleButtonPointerUp:e=>{let{id:t}=e.currentTarget.dataset;s(i,t,!1)}}},[o,a,s,i]),f=(0,T.Hg)("theme",()=>(0,I.y6)({isDarkMode:a.user.getIsDarkMode()}),[a]);return(0,O.jsx)("div",{className:D("tlui-buttons__grid"),children:n.map(e=>(0,O.jsx)(cn,{type:"icon","data-id":e.value,"data-testid":`style.${t}.${e.value}`,"aria-label":e.value,"data-state":"shared"===o.type&&o.value===e.value?"hinted":void 0,title:r+"  "+l(`${t}-style.${e.value}`),className:D("tlui-button-grid__button"),style:i===I.R_?{color:f[e.value].solid}:void 0,onPointerEnter:h,onPointerDown:d,onPointerUp:p,onClick:u,icon:e.icon},e.value))})});function gW(e,[t,n]){return Math.min(n,Math.max(t,e))}let gY=["PageUp","PageDown"],gG=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],gX={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},gq="Slider",[gJ,gQ,g0]=a9(gq),[g1,g2]=a5(gq,[g0]),[g5,g3]=g1(gq),g8=(0,$.forwardRef)((e,t)=>{let{name:n,min:r=0,max:i=100,step:o=1,orientation:s="horizontal",disabled:a=!1,minStepsBetweenThumbs:l=0,defaultValue:c=[r],value:u,onValueChange:d=()=>{},onValueCommit:h=()=>{},inverted:p=!1,...f}=e,[g,m]=(0,$.useState)(null),y=a2(t,e=>m(e)),b=(0,$.useRef)(new Set),w=(0,$.useRef)(0),x="horizontal"===s,v=!g||!!g.closest("form"),[S=[],k]=lh({prop:u,defaultProp:c,onChange:e=>{var t;null===(t=[...b.current][w.current])||void 0===t||t.focus(),d(e)}}),_=(0,$.useRef)(S);function E(e,t,{commit:n}={commit:!1}){let s=(String(o).split(".")[1]||"").length,a=gW(function(e,t){let n=Math.pow(10,t);return Math.round(e*n)/n}(Math.round((e-r)/o)*o+r,s),[r,i]);k((e=[])=>{var r,i;let s=function(e=[],t,n){let r=[...e];return r[n]=t,r.sort((e,t)=>e-t)}(e,a,t);if(r=s,!(!((i=l*o)>0)||Math.min(...r.slice(0,-1).map((e,t)=>r[t+1]-e))>=i))return e;{w.current=s.indexOf(a);let t=String(s)!==String(e);return t&&n&&h(s),t?s:e}})}return(0,$.createElement)(g5,{scope:e.__scopeSlider,disabled:a,min:r,max:i,valueIndexToChangeRef:w,thumbs:b.current,values:S,orientation:s},(0,$.createElement)(gJ.Provider,{scope:e.__scopeSlider},(0,$.createElement)(gJ.Slot,{scope:e.__scopeSlider},(0,$.createElement)(x?g9:g7,aJ({"aria-disabled":a,"data-disabled":a?"":void 0},f,{ref:y,onPointerDown:a0(f.onPointerDown,()=>{a||(_.current=S)}),min:r,max:i,inverted:p,onSlideStart:a?void 0:function(e){let t=function(e,t){if(1===e.length)return 0;let n=e.map(e=>Math.abs(e-t));return n.indexOf(Math.min(...n))}(S,e);E(e,t)},onSlideMove:a?void 0:function(e){E(e,w.current)},onSlideEnd:a?void 0:function(){let e=_.current[w.current];S[w.current]!==e&&h(S)},onHomeKeyDown:()=>!a&&E(r,0,{commit:!0}),onEndKeyDown:()=>!a&&E(i,S.length-1,{commit:!0}),onStepKeyDown:({event:e,direction:t})=>{if(!a){let n=gY.includes(e.key)||e.shiftKey&&gG.includes(e.key),r=w.current;E(S[r]+o*(n?10:1)*t,r,{commit:!0})}}})))),v&&S.map((e,t)=>(0,$.createElement)(ma,{key:t,name:n?n+(S.length>1?"[]":""):void 0,value:e})))}),[g4,g6]=g1(gq,{startEdge:"left",endEdge:"right",size:"width",direction:1}),g9=(0,$.forwardRef)((e,t)=>{let{min:n,max:r,dir:i,inverted:o,onSlideStart:s,onSlideMove:a,onSlideEnd:l,onStepKeyDown:c,...u}=e,[d,h]=(0,$.useState)(null),p=a2(t,e=>h(e)),f=(0,$.useRef)(),g=hi(i),m="ltr"===g,y=m&&!o||!m&&o;function b(e){let t=f.current||d.getBoundingClientRect(),i=mc([0,t.width],y?[n,r]:[r,n]);return f.current=t,i(e-t.left)}return(0,$.createElement)(g4,{scope:e.__scopeSlider,startEdge:y?"left":"right",endEdge:y?"right":"left",direction:y?1:-1,size:"width"},(0,$.createElement)(me,aJ({dir:g,"data-orientation":"horizontal"},u,{ref:p,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:e=>{let t=b(e.clientX);null==s||s(t)},onSlideMove:e=>{let t=b(e.clientX);null==a||a(t)},onSlideEnd:()=>{f.current=void 0,null==l||l()},onStepKeyDown:e=>{let t=gX[y?"from-left":"from-right"].includes(e.key);null==c||c({event:e,direction:t?-1:1})}})))}),g7=(0,$.forwardRef)((e,t)=>{let{min:n,max:r,inverted:i,onSlideStart:o,onSlideMove:s,onSlideEnd:a,onStepKeyDown:l,...c}=e,u=(0,$.useRef)(null),d=a2(t,u),h=(0,$.useRef)(),p=!i;function f(e){let t=h.current||u.current.getBoundingClientRect(),i=mc([0,t.height],p?[r,n]:[n,r]);return h.current=t,i(e-t.top)}return(0,$.createElement)(g4,{scope:e.__scopeSlider,startEdge:p?"bottom":"top",endEdge:p?"top":"bottom",size:"height",direction:p?1:-1},(0,$.createElement)(me,aJ({"data-orientation":"vertical"},c,{ref:d,style:{...c.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:e=>{let t=f(e.clientY);null==o||o(t)},onSlideMove:e=>{let t=f(e.clientY);null==s||s(t)},onSlideEnd:()=>{h.current=void 0,null==a||a()},onStepKeyDown:e=>{let t=gX[p?"from-bottom":"from-top"].includes(e.key);null==l||l({event:e,direction:t?-1:1})}})))}),me=(0,$.forwardRef)((e,t)=>{let{__scopeSlider:n,onSlideStart:r,onSlideMove:i,onSlideEnd:o,onHomeKeyDown:s,onEndKeyDown:a,onStepKeyDown:l,...c}=e,u=g3(gq,n);return(0,$.createElement)(a7.span,aJ({},c,{ref:t,onKeyDown:a0(e.onKeyDown,e=>{"Home"===e.key?(s(e),e.preventDefault()):"End"===e.key?(a(e),e.preventDefault()):gY.concat(gG).includes(e.key)&&(l(e),e.preventDefault())}),onPointerDown:a0(e.onPointerDown,e=>{let t=e.target;t.setPointerCapture(e.pointerId),e.preventDefault(),u.thumbs.has(t)?t.focus():r(e)}),onPointerMove:a0(e.onPointerMove,e=>{e.target.hasPointerCapture(e.pointerId)&&i(e)}),onPointerUp:a0(e.onPointerUp,e=>{let t=e.target;t.hasPointerCapture(e.pointerId)&&(t.releasePointerCapture(e.pointerId),o(e))})}))}),mt=(0,$.forwardRef)((e,t)=>{let{__scopeSlider:n,...r}=e,i=g3("SliderTrack",n);return(0,$.createElement)(a7.span,aJ({"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation},r,{ref:t}))}),mn="SliderRange",mr=(0,$.forwardRef)((e,t)=>{let{__scopeSlider:n,...r}=e,i=g3(mn,n),o=g6(mn,n),s=a2(t,(0,$.useRef)(null)),a=i.values.length,l=i.values.map(e=>ml(e,i.min,i.max));return(0,$.createElement)(a7.span,aJ({"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0},r,{ref:s,style:{...e.style,[o.startEdge]:(a>1?Math.min(...l):0)+"%",[o.endEdge]:100-Math.max(...l)+"%"}}))}),mi="SliderThumb",mo=(0,$.forwardRef)((e,t)=>{let n=gQ(e.__scopeSlider),[r,i]=(0,$.useState)(null),o=a2(t,e=>i(e)),s=(0,$.useMemo)(()=>r?n().findIndex(e=>e.ref.current===r):-1,[n,r]);return(0,$.createElement)(ms,aJ({},e,{ref:o,index:s}))}),ms=(0,$.forwardRef)((e,t)=>{var n;let{__scopeSlider:r,index:i,...o}=e,s=g3(mi,r),a=g6(mi,r),[l,c]=(0,$.useState)(null),u=a2(t,e=>c(e)),d=pt(l),h=s.values[i],p=void 0===h?0:ml(h,s.min,s.max),f=(n=s.values.length)>2?`Value ${i+1} of ${n}`:2===n?["Minimum","Maximum"][i]:void 0,g=null==d?void 0:d[a.size],m=g?function(e,t,n){let r=e/2,i=mc([0,50],[0,r]);return(r-i(t)*n)*n}(g,p,a.direction):0;return(0,$.useEffect)(()=>{if(l)return s.thumbs.add(l),()=>{s.thumbs.delete(l)}},[l,s.thumbs]),(0,$.createElement)("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${p}% + ${m}px)`}},(0,$.createElement)(gJ.ItemSlot,{scope:e.__scopeSlider},(0,$.createElement)(a7.span,aJ({role:"slider","aria-label":e["aria-label"]||f,"aria-valuemin":s.min,"aria-valuenow":h,"aria-valuemax":s.max,"aria-orientation":s.orientation,"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,tabIndex:s.disabled?void 0:0},o,{ref:u,style:void 0===h?{display:"none"}:e.style,onFocus:a0(e.onFocus,()=>{s.valueIndexToChangeRef.current=i})}))))}),ma=e=>{let{value:t,...n}=e,r=(0,$.useRef)(null),i=function(e){let t=(0,$.useRef)({value:e,previous:e});return(0,$.useMemo)(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}(t);return(0,$.useEffect)(()=>{let e=r.current,n=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set;if(i!==t&&n){let r=new Event("input",{bubbles:!0});n.call(e,t),e.dispatchEvent(r)}},[i,t]),(0,$.createElement)("input",aJ({style:{display:"none"}},n,{ref:r,defaultValue:t}))};function ml(e,t,n){return gW(100/(n-t)*(e-t),[0,100])}function mc(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];let r=(t[1]-t[0])/(e[1]-e[0]);return t[0]+r*(n-e[0])}}let mu=(0,$.memo)(function(e){let{title:t,steps:n,value:r,label:i,onValueChange:o}=e,s=(0,G.j)(),a=l3(),l=(0,$.useCallback)(e=>{o(e[0],!0)},[o]),c=(0,$.useCallback)(()=>{s.mark("click slider")},[s]),u=(0,$.useCallback)(()=>{r&&o(r,!1)},[r,o]);return(0,O.jsx)("div",{className:"tlui-slider__container",children:(0,O.jsxs)(g8,{"data-testid":e["data-testid"],className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:n,step:1,value:r?[r]:void 0,onPointerDown:c,onValueChange:l,onPointerUp:u,title:t+"  "+a(i),children:[(0,O.jsx)(mt,{className:"tlui-slider__track",dir:"ltr",children:null!==r&&(0,O.jsx)(mr,{className:"tlui-slider__range",dir:"ltr"})}),null!==r&&(0,O.jsx)(mo,{className:"tlui-slider__thumb",dir:"ltr"})]})})}),md=$.memo(function({label:e,uiTypeA:t,uiTypeB:n,labelA:r,labelB:i,itemsA:o,itemsB:s,styleA:a,styleB:l,valueA:c,valueB:u,onValueChange:d}){let h=l3(),p=$.useMemo(()=>o.find(e=>"shared"===c.type&&c.value===e.value)?.icon??"mixed",[o,c]),f=$.useMemo(()=>s.find(e=>"shared"===u.type&&u.value===e.value)?.icon??"mixed",[s,u]);return void 0===c&&void 0===u?null:(0,O.jsxs)("div",{className:"tlui-style-panel__double-select-picker",children:[(0,O.jsx)("div",{title:h(e),className:"tlui-style-panel__double-select-picker-label",children:h(e)}),(0,O.jsxs)("div",{className:"tlui-buttons__horizontal",children:[(0,O.jsxs)(fN,{id:`style panel ${t} A`,children:[(0,O.jsx)(fT,{asChild:!0,onTouchEnd:e=>H(e),children:(0,O.jsx)(cn,{type:"icon","data-testid":`style.${t}`,title:h(r)+"  "+(null===c||"mixed"===c.type?h("style-panel.mixed"):h(`${t}-style.${c.value}`)),icon:p,invertIcon:!0,smallIcon:!0})}),(0,O.jsx)(fU,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:(0,O.jsx)("div",{className:"tlui-buttons__grid",children:o.map(e=>(0,O.jsx)(fY,{type:"icon",title:h(r)+"  "+h(`${t}-style.${e.value}`),"data-testid":`style.${t}.${e.value}`,icon:e.icon,onClick:()=>d(a,e.value,!1),invertIcon:!0},e.value))})})]}),(0,O.jsxs)(fN,{id:`style panel ${n}`,children:[(0,O.jsx)(fT,{asChild:!0,onTouchEnd:e=>H(e),children:(0,O.jsx)(cn,{type:"icon","data-testid":`style.${n}`,title:h(i)+"  "+(null===u||"mixed"===u.type?h("style-panel.mixed"):h(`${n}-style.${u.value}`)),icon:f,smallIcon:!0})}),(0,O.jsx)(fU,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:(0,O.jsx)("div",{className:"tlui-buttons__grid",children:s.map(e=>(0,O.jsx)(fY,{type:"icon",title:h(i)+"  "+h(`${n}-style.${e.value}`),"data-testid":`style.${n}.${e.value}`,icon:e.icon,onClick:()=>d(l,e.value,!1)},e.value))})})]})]})]})}),mh=$.memo(function({id:e,label:t,uiType:n,style:r,items:i,type:o,value:s,onValueChange:a}){let l=l3(),c=$.useMemo(()=>i.find(e=>"shared"===s.type&&e.value===s.value)?.icon,[i,s]);return(0,O.jsxs)(fN,{id:`style panel ${e}`,children:[(0,O.jsx)(fT,{asChild:!0,onTouchEnd:e=>H(e),children:(0,O.jsx)(cn,{type:o,"data-testid":`style.${n}`,title:"mixed"===s.type?l("style-panel.mixed"):l(`${n}-style.${s.value}`),label:t,icon:c??"mixed"})}),(0,O.jsx)(fU,{side:"left",align:"center",alignOffset:0,children:(0,O.jsx)("div",{className:"tlui-buttons__grid",children:i.map(e=>(0,O.jsx)(fY,{type:"icon","data-testid":`style.${n}.${e.value}`,title:l(`${n}-style.${e.value}`),icon:e.icon,onClick:()=>a(r,e.value,!1)},e.value))})})]})}),mp={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],horizontalAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-center"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"cloud",icon:"geo-cloud"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"star",icon:"geo-star"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},mf=function({isMobile:e}){let t=(0,G.j)(),n=gZ(),r=(0,$.useCallback)(()=>{e||t.updateInstanceState({isChangingStyle:!1})},[t,e]);if(!n)return null;let{styles:i,opacity:o}=n,s=i.get(I.Zu),a=i.get(I.ZJ),l=i.get(I.TA),c=i.get(I.t8),u=i.get(I.Y8);return(0,O.jsxs)("div",{className:"tlui-style-panel","data-ismobile":e,onPointerLeave:r,children:[(0,O.jsx)(my,{styles:i,opacity:o}),void 0!==u&&(0,O.jsx)(mb,{styles:i}),!(void 0===s&&void 0===a&&void 0===l&&void 0===c)&&(0,O.jsxs)("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[(0,O.jsx)(mw,{styles:i}),(0,O.jsx)(mv,{styles:i}),(0,O.jsx)(mx,{styles:i})]})]})};function mg(){let e=(0,G.j)();return $.useMemo(()=>function(t,n,r){e.batch(()=>{e.isIn("select")&&e.setStyleForSelectedShapes(t,n,{squashing:r}),e.setStyleForNextShapes(t,n,{squashing:r}),e.updateInstanceState({isChangingStyle:!0})})},[e])}let mm=[.1,.25,.5,.75,1];function my({styles:e,opacity:t}){let n=(0,G.j)(),r=l3(),i=mg(),o=$.useCallback((e,t)=>{let r=mm[e];n.batch(()=>{n.isIn("select")&&n.setOpacityForSelectedShapes(r,{ephemeral:t}),n.setOpacityForNextShapes(r,{ephemeral:t}),n.updateInstanceState({isChangingStyle:!0})})},[n]),s=e.get(I.R_),a=e.get(I.pp),l=e.get(I.ci),c=e.get(I.ST),u="mixed"===t.type?-1:mm.indexOf((0,M.F)(mm,e=>Math.abs(e-t.value)));return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles",children:[void 0===s?null:(0,O.jsx)(gK,{title:r("style-panel.color"),uiType:"color",style:I.R_,items:mp.color,value:s,onValueChange:i}),void 0===t?null:(0,O.jsx)(mu,{"data-testid":"style.opacity",value:u>=0?u:mm.length-1,label:"mixed"===t.type?"style-panel.mixed":`opacity-style.${t.value}`,onValueChange:o,steps:mm.length-1,title:r("style-panel.opacity")})]}),(void 0!==a||void 0!==l||void 0!==c)&&(0,O.jsxs)("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[void 0===a?null:(0,O.jsx)(gK,{title:r("style-panel.fill"),uiType:"fill",style:I.pp,items:mp.fill,value:a,onValueChange:i}),void 0===l?null:(0,O.jsx)(gK,{title:r("style-panel.dash"),uiType:"dash",style:I.ci,items:mp.dash,value:l,onValueChange:i}),void 0===c?null:(0,O.jsx)(gK,{title:r("style-panel.size"),uiType:"size",style:I.ST,items:mp.size,value:c,onValueChange:i})]})]})}function mb({styles:e}){let t=l3(),n=mg(),r=e.get(I.Y8),i=e.get(I.Xo),o=e.get(I.HO);return void 0===r&&void 0===i?null:(0,O.jsxs)("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[void 0===r?null:(0,O.jsx)(gK,{title:t("style-panel.font"),uiType:"font",style:I.Y8,items:mp.font,value:r,onValueChange:n}),void 0===i?null:(0,O.jsxs)("div",{className:"tlui-style-panel__row",children:[(0,O.jsx)(gK,{title:t("style-panel.align"),uiType:"align",style:I.Xo,items:mp.horizontalAlign,value:i,onValueChange:n}),(0,O.jsx)("div",{className:"tlui-style-panel__row__extra-button",children:void 0===o?(0,O.jsx)(cn,{type:"icon",title:t("style-panel.vertical-align"),"data-testid":"vertical-align",icon:"vertical-align-center",disabled:!0}):(0,O.jsx)(mh,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",style:I.HO,items:mp.verticalAlign,value:o,onValueChange:n})})]})]})}function mw({styles:e}){let t=mg(),n=e.get(I.Zu);return void 0===n?null:(0,O.jsx)(mh,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",style:I.Zu,items:mp.geo,value:n,onValueChange:t})}function mx({styles:e}){let t=mg(),n=e.get(I.t8);return void 0===n?null:(0,O.jsx)(mh,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",style:I.t8,items:mp.spline,value:n,onValueChange:t})}function mv({styles:e}){let t=mg(),n=e.get(I.ZJ),r=e.get(I.TA);return n&&r?(0,O.jsx)(md,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:I.TA,itemsA:mp.arrowheadStart,valueA:r,uiTypeB:"arrowheadEnd",styleB:I.ZJ,itemsB:mp.arrowheadEnd,valueB:n,onValueChange:t,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"}):null}function mS({toast:e}){let{removeToast:t}=dl(),n=l3(),r=e.actions&&e.actions.length>0;return(0,O.jsxs)(lj,{onOpenChange:n=>{n||t(e.id)},className:"tlui-toast__container",duration:e.keepOpen?1/0:5e3,children:[e.icon&&(0,O.jsx)("div",{className:"tlui-toast__icon",children:(0,O.jsx)(l4,{icon:e.icon})}),(0,O.jsxs)("div",{className:"tlui-toast__main",children:[(0,O.jsxs)("div",{className:"tlui-toast__content",children:[e.title&&(0,O.jsx)(l$,{className:"tlui-toast__title",children:e.title}),e.description&&(0,O.jsx)(lB,{className:"tlui-toast__description",children:e.description})]}),e.actions&&(0,O.jsxs)("div",{className:"tlui-toast__actions",children:[e.actions.map((e,t)=>(0,O.jsx)(lD,{altText:e.label,asChild:!0,onClick:e.onClick,children:(0,O.jsx)(cn,{type:e.type,children:e.label})},t)),(0,O.jsx)(lL,{asChild:!0,children:(0,O.jsx)(cn,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:e.closeLabel??n("toast.close")})})]})]}),!r&&(0,O.jsx)(lL,{asChild:!0,children:(0,O.jsx)(cn,{type:"normal",className:"tlui-toast__close",children:e.closeLabel??n("toast.close")})})]})}let mk=$.memo(function(){let{toasts:e}=dl();return(0,O.jsx)(O.Fragment,{children:e.map(e=>(0,O.jsx)(mS,{toast:e},e.id))})});function m_(){let{toasts:e}=dl(),[t,n]=$.useState(!1);return($.useEffect(()=>{let t=!1;return e.length?n(!0):setTimeout(()=>{t||n(!1)},1e3),()=>{t=!0}},[e.length,n]),t)?(0,O.jsx)(lC,{className:"tlui-toast__viewport"}):null}var mE="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;function mC(e,t,n,r){e.addEventListener?e.addEventListener(t,n,r):e.attachEvent&&e.attachEvent("on".concat(t),function(){n(window.event)})}function mP(e,t){for(var n=t.slice(0,t.length-1),r=0;r<n.length;r++)n[r]=e[n[r].toLowerCase()];return n}function mT(e){"string"!=typeof e&&(e="");for(var t=(e=e.replace(/\s/g,"")).split(","),n=t.lastIndexOf("");n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}for(var mj={backspace:8,"":8,tab:9,clear:12,enter:13,"":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"":20,",":188,".":190,"/":191,"`":192,"-":mE?173:189,"=":mE?61:187,";":mE?59:186,"'":222,"[":219,"]":221,"\\":220},mI={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,cmd:91,command:91},mM={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},mA={16:!1,18:!1,17:!1,91:!1},mO={},m$=1;m$<20;m$++)mj["f".concat(m$)]=111+m$;var mB=[],mD=!1,mL="all",mR=[],mz=function(e){return mj[e.toLowerCase()]||mI[e.toLowerCase()]||e.toUpperCase().charCodeAt(0)};function mN(e){mL=e||"all"}function mF(){return mL||"all"}var mU=function(e){var t=e.key,n=e.scope,r=e.method,i=e.splitKey,o=void 0===i?"+":i;mT(t).forEach(function(e){var t=e.split(o),i=t.length,s=t[i-1],a="*"===s?"*":mz(s);if(mO[a]){n||(n=mF());var l=i>1?mP(mI,t):[];mO[a]=mO[a].filter(function(e){return!((!r||e.method===r)&&e.scope===n&&function(e,t){for(var n=e.length>=t.length?e:t,r=e.length>=t.length?t:e,i=!0,o=0;o<n.length;o++)-1===r.indexOf(n[o])&&(i=!1);return i}(e.mods,l))})}})};function mV(e,t,n,r){var i;if(t.element===r&&(t.scope===n||"all"===t.scope)){for(var o in i=t.mods.length>0,mA)Object.prototype.hasOwnProperty.call(mA,o)&&(!mA[o]&&t.mods.indexOf(+o)>-1||mA[o]&&-1===t.mods.indexOf(+o))&&(i=!1);(0!==t.mods.length||mA[16]||mA[18]||mA[17]||mA[91])&&!i&&"*"!==t.shortcut||(t.keys=[],t.keys=t.keys.concat(mB),!1===t.method(e,t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0)))}}function mH(e,t){var n=mO["*"],r=e.keyCode||e.which||e.charCode;if(mZ.filter.call(this,e)){if((93===r||224===r)&&(r=91),-1===mB.indexOf(r)&&229!==r&&mB.push(r),["ctrlKey","altKey","shiftKey","metaKey"].forEach(function(t){var n=mM[t];e[t]&&-1===mB.indexOf(n)?mB.push(n):!e[t]&&mB.indexOf(n)>-1?mB.splice(mB.indexOf(n),1):"metaKey"===t&&e[t]&&3===mB.length&&!(e.ctrlKey||e.shiftKey||e.altKey)&&(mB=mB.slice(mB.indexOf(n)))}),r in mA){for(var i in mA[r]=!0,mI)mI[i]===r&&(mZ[i]=!0);if(!n)return}for(var o in mA)Object.prototype.hasOwnProperty.call(mA,o)&&(mA[o]=e[mM[o]]);e.getModifierState&&!(e.altKey&&!e.ctrlKey)&&e.getModifierState("AltGraph")&&(-1===mB.indexOf(17)&&mB.push(17),-1===mB.indexOf(18)&&mB.push(18),mA[17]=!0,mA[18]=!0);var s=mF();if(n)for(var a=0;a<n.length;a++)n[a].scope===s&&("keydown"===e.type&&n[a].keydown||"keyup"===e.type&&n[a].keyup)&&mV(e,n[a],s,t);if(r in mO){for(var l=0;l<mO[r].length;l++)if(("keydown"===e.type&&mO[r][l].keydown||"keyup"===e.type&&mO[r][l].keyup)&&mO[r][l].key){for(var c=mO[r][l],u=c.splitKey,d=c.key.split(u),h=[],p=0;p<d.length;p++)h.push(mz(d[p]));h.sort().join("")===mB.sort().join("")&&mV(e,c,s,t)}}}}function mZ(e,t,n){mB=[];var r,i=mT(e),o=[],s="all",a=document,l=0,c=!1,u=!0,d="+",h=!1;for(void 0===n&&"function"==typeof t&&(n=t),"[object Object]"===Object.prototype.toString.call(t)&&(t.scope&&(s=t.scope),t.element&&(a=t.element),t.keyup&&(c=t.keyup),void 0!==t.keydown&&(u=t.keydown),void 0!==t.capture&&(h=t.capture),"string"==typeof t.splitKey&&(d=t.splitKey)),"string"==typeof t&&(s=t);l<i.length;l++)e=i[l].split(d),o=[],e.length>1&&(o=mP(mI,e)),(e="*"===(e=e[e.length-1])?"*":mz(e))in mO||(mO[e]=[]),mO[e].push({keyup:c,keydown:u,scope:s,mods:o,shortcut:i[l],method:n,key:i[l],splitKey:d,element:a});void 0!==a&&(r=a,!(mR.indexOf(r)>-1))&&window&&(mR.push(a),mC(a,"keydown",function(e){mH(e,a)},h),mD||(mD=!0,mC(window,"focus",function(){mB=[]},h)),mC(a,"keyup",function(e){mH(e,a),function(e){var t=e.keyCode||e.which||e.charCode,n=mB.indexOf(t);if(n>=0&&mB.splice(n,1),e.key&&"meta"===e.key.toLowerCase()&&mB.splice(0,mB.length),(93===t||224===t)&&(t=91),t in mA)for(var r in mA[t]=!1,mI)mI[r]===t&&(mZ[r]=!1)}(e)},h))}var mK={getPressedKeyString:function(){return mB.map(function(e){return Object.keys(mj).find(function(t){return mj[t]===e})||Object.keys(mI).find(function(t){return mI[t]===e})||String.fromCharCode(e)})},setScope:mN,getScope:mF,deleteScope:function(e,t){var n,r;for(var i in e||(e=mF()),mO)if(Object.prototype.hasOwnProperty.call(mO,i))for(r=0,n=mO[i];r<n.length;)n[r].scope===e?n.splice(r,1):r++;mF()===e&&mN(t||"all")},getPressedKeyCodes:function(){return mB.slice(0)},getAllKeyCodes:function(){var e=[];return Object.keys(mO).forEach(function(t){mO[t].forEach(function(t){var n=t.key,r=t.scope,i=t.mods,o=t.shortcut;e.push({scope:r,shortcut:o,mods:i,keys:n.split("+").map(function(e){return mz(e)})})})}),e},isPressed:function(e){return"string"==typeof e&&(e=mz(e)),-1!==mB.indexOf(e)},filter:function(e){var t=e.target||e.srcElement,n=t.tagName,r=!0;return(t.isContentEditable||("INPUT"===n||"TEXTAREA"===n||"SELECT"===n)&&!t.readOnly)&&(r=!1),r},trigger:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";Object.keys(mO).forEach(function(n){mO[n].filter(function(n){return n.scope===t&&n.shortcut===e}).forEach(function(e){e&&e.method&&e.method()})})},unbind:function(e){if(void 0===e)Object.keys(mO).forEach(function(e){return delete mO[e]});else if(Array.isArray(e))e.forEach(function(e){e.key&&mU(e)});else if("object"==typeof e)e.key&&mU(e);else if("string"==typeof e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n[0],o=n[1];"function"==typeof i&&(o=i,i=""),mU({key:e,scope:i,method:o,splitKey:"+"})}},keyMap:mj,modifier:mI,modifierMap:mM};for(var mW in mK)Object.prototype.hasOwnProperty.call(mK,mW)&&(mZ[mW]=mK[mW]);if("undefined"!=typeof window){var mY=window.hotkeys;mZ.noConflict=function(e){return e&&window.hotkeys===mZ&&(window.hotkeys=mY),mZ},window.hotkeys=mZ}let mG=["copy","cut","paste","asset"];function mX(){let e=(0,G.j)(),t=r3(),n=dw(),r=dH(),i=(0,T.Hg)("is focused",()=>e.getInstanceState().isFocused,[e]),{itemsInPanel:o}=m4();(0,$.useEffect)(()=>{var o;if(!i)return;let s=e.getContainer();mZ.setScope(e.store.id);let a=(t,n)=>{mZ(t,{element:s,scope:e.store.id},n)};for(let r of Object.values(n))r.kbd&&(!t||r.readonlyOk)&&(mG.includes(r.id)||a(mq(r.kbd),t=>{mJ(e)||(H(t),r.onSelect("kbd"))}));for(let t of Object.values(r))t.kbd&&(t.readonlyOk||!e.getInstanceState().isReadonly)&&(mG.includes(t.id)||a(mq(t.kbd),n=>{mJ(e)||(H(n),t.onSelect("kbd"))}));return a(",",t=>{if(mJ(e)||e.inputs.keys.has("Comma"))return;H(t),s.focus(),e.inputs.keys.add("Comma");let{x:n,y:r,z:i}=e.inputs.currentScreenPoint,o={type:"pointer",name:"pointer_down",point:{x:n,y:r,z:i},shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey,pointerId:0,button:0,isPen:e.getInstanceState().isPenMode,target:"canvas"};e.dispatch(o)}),o=t=>{if(mJ(e)||!e.inputs.keys.has("Comma"))return;e.inputs.keys.delete("Comma");let{x:n,y:r,z:i}=e.inputs.currentScreenPoint,o={type:"pointer",name:"pointer_up",point:{x:n,y:r,z:i},shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey,pointerId:0,button:0,isPen:e.getInstanceState().isPenMode,target:"canvas"};e.dispatch(o)},mZ(",",{element:s,keyup:!0,keydown:!1,scope:e.store.id},o),()=>{mZ.deleteScope(e.store.id)}},[n,r,t,e,i,o])}function mq(e){return(function(e){"string"!=typeof e&&(e="");let t=(e=e.replace(/\s/g,"")).split(","),n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t})(e).map(e=>{let t=e.split("");return 1===t.length?t[0]:"!"===t[0]?`shift+${t[1]}`:"?"===t[0]?3===t.length&&"!"===t[1]?`alt+shift+${t[2]}`:`alt+${t[1]}`:"$"===t[0]?"!"===t[1]?`cmd+shift+${t[2]},ctrl+shift+${t[2]}`:"?"===t[1]?`cmd+\u2325+${t[2]},ctrl+alt+${t[2]}`:`cmd+${t[1]},ctrl+${t[1]}`:e}).join(",")}function mJ(e){return e.getIsMenuOpen()||null!==e.getEditingShapeId()||e.getCrashingError()}function mQ(){let e=(0,G.j)(),t=l3(),n=gZ(),r=n?.styles.get(I.R_),i=(0,I.y6)({isDarkMode:e.user.getIsDarkMode()}),o=(r?.type==="shared"?i[r.value]:i.black).solid,s=(0,T.Hg)("isHandOrEraserToolActive",()=>e.isInAny("hand","zoom","eraser","laser"),[e]),a=(0,$.useCallback)(t=>{t||e.updateInstanceState({isChangingStyle:!1})},[e]);return(0,O.jsxs)(gv,{id:"style menu",onOpenChange:a,children:[(0,O.jsx)(gS,{disabled:s,children:(0,O.jsx)(cn,{type:"tool","data-testid":"mobile.styles",style:{color:s?"var(--color-muted-1)":o},title:t("style-panel.title"),children:(0,O.jsx)(l4,{icon:s?"blob":r?.type==="mixed"?"mixed":"blob"})})}),(0,O.jsx)(gk,{side:"top",align:"end",children:(0,O.jsx)(mf,{isMobile:!0})})]})}let m0=["select","hand","draw","eraser","text","zoom","laser","highlight"];function m1({activeToolId:e}){let t=(0,G.j)(),n=dO(),r=l3(),i=(0,T.Hg)("is tool locked",()=>t.getInstanceState().isToolLocked,[t]);return!e||m0.includes(e)?null:(0,O.jsx)(cn,{type:"normal",title:r("action.toggle-tool-lock"),className:D("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":n<5}),icon:i?"lock":"unlock",onClick:()=>t.updateInstanceState({isToolLocked:!i}),smallIcon:!0})}let m2=(0,$.memo)(function(){let e=(0,G.j)(),t=l3(),n=dO(),r=$.useRef(void 0),i=r3(),o=d6(),s=(0,T.Hg)("current tool id",()=>e.getCurrentToolId(),[e]),a=(0,T.Hg)("geo",()=>e.getSharedStyles().getAsKnownValue(I.Zu),[e]),l=e=>e.label?`${t(e.label)} ${e.kbd?ce(e.kbd):""}`:"",c=o.find(e=>m8(e.toolItem,s,a)),{itemsInPanel:u,itemsInDropdown:d}=m4(),h=(0,$.useMemo)(()=>{let e=d.find(e=>e===c);return e||(r.current||(r.current=d[0]),e=r.current,d.includes(e)||(e=d[0])),r.current=e,e},[c,d]);return(0,$.useEffect)(()=>{let t=[...u,h];for(let n=0;n<Math.min(10,t.length);n++)mZ(`${n+1}`.slice(-1),r=>{mJ(e)||(H(r),t[n].toolItem.onSelect("kbd"))});return()=>{mZ.unbind("1,2,3,4,5,6,7,8,9,0")}},[h,e,u]),(0,O.jsx)("div",{className:"tlui-toolbar",children:(0,O.jsxs)("div",{className:"tlui-toolbar__inner",children:[(0,O.jsxs)("div",{className:"tlui-toolbar__left",children:[!i&&(0,O.jsxs)("div",{className:"tlui-toolbar__extras",children:[n<6&&!("hand"===s||"zoom"===s)&&(0,O.jsxs)("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[(0,O.jsx)(g$,{}),(0,O.jsx)(gA,{}),(0,O.jsx)(gO,{}),(0,O.jsx)(gE,{}),(0,O.jsx)(g_,{})]}),(0,O.jsx)(m1,{activeToolId:s})]}),(0,O.jsxs)("div",{className:D("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":n<5}),children:[u.map(({toolItem:e})=>(0,O.jsx)(m3,{item:e,title:l(e),isSelected:m8(e,s,a)},e.id)),d.length?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(m3,{item:h.toolItem,title:l(h.toolItem),isSelected:m8(h.toolItem,s,a)},h.toolItem.id),(0,O.jsxs)(fN,{id:"toolbar overflow",modal:!1,children:[(0,O.jsx)(fF,{children:(0,O.jsx)(cn,{className:"tlui-toolbar__overflow",icon:"chevron-up",type:"tool","data-testid":"tools.more",title:t("tool-panel.more")})}),(0,O.jsx)(fU,{side:"top",align:"center",children:(0,O.jsx)(m5,{toolbarItems:d})})]})]}):null]})]}),n<5&&!i&&(0,O.jsx)("div",{className:"tlui-toolbar__tools",children:(0,O.jsx)(mQ,{})})]})})}),m5=(0,T.j)(function({toolbarItems:e}){let t=l3();return(0,O.jsx)("div",{className:"tlui-buttons__grid",children:e.map(({toolItem:{id:e,meta:n,kbd:r,label:i,onSelect:o,icon:s}})=>(0,O.jsx)(fY,{type:"icon",className:"tlui-button-grid__button","data-testid":`tools.more.${e}`,"data-tool":e,"data-geo":n?.geo??"","aria-label":i,onClick:()=>o("toolbar"),title:i?`${t(i)} ${r?ce(r):""}`:"",icon:s},e))})});function m3({item:e,title:t,isSelected:n}){return(0,O.jsx)(cn,{type:"tool","data-testid":`tools.${e.id}`,"data-tool":e.id,"data-geo":e.meta?.geo??"","aria-label":e.label,title:t,icon:e.icon,"data-state":n?"selected":void 0,onClick:()=>e.onSelect("toolbar"),onTouchStart:t=>{H(t),e.onSelect("toolbar")}})}let m8=(e,t,n)=>e.meta?.geo?"geo"===t&&n===e.meta?.geo:t===e.id;function m4(){let e=dO(),t=d6(),n=r3();return(0,$.useMemo)(()=>{let r=t.filter(e=>!n||e.readonlyOk),i=Math.min(8,5+e),o=r.slice(0,i),s=r.slice(i);return s.length<=2?{itemsInPanel:r,itemsInDropdown:[]}:{itemsInPanel:o,itemsInDropdown:s}},[t,e,n])}let m6=$.memo(function({shareZone:e,topZone:t,renderDebugMenuItems:n,children:r,hideUi:i,...o}){return(0,O.jsx)(he,{...o,children:(0,O.jsx)(m9,{hideUi:i,shareZone:e,topZone:t,renderDebugMenuItems:n,children:r})})}),m9=$.memo(function({children:e,hideUi:t,...n}){return(0,O.jsxs)(O.Fragment,{children:[e,t?null:(0,O.jsx)(m7,{...n})]})}),m7=$.memo(function({shareZone:e,topZone:t,renderDebugMenuItems:n}){let r=(0,G.j)(),i=l3(),o=dO(),s=(0,T.Hg)("isReadonlyMode",()=>r.getInstanceState().isReadonly,[r]),a=(0,T.Hg)("focus",()=>r.getInstanceState().isFocusMode,[r]),l=(0,T.Hg)("debug",()=>r.getInstanceState().isDebugMode,[r]);mX(),u4(),function(){let e=(0,G.j)(),{addToast:t}=dl();(0,$.useEffect)(()=>{function n({name:e,count:n}){t({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${e} (${n}). Please delete some shapes or move to a different page to continue.`})}return e.addListener("max-shapes",n),()=>{e.removeListener("max-shapes",n)}},[e,t])}();let{"toggle-focus-mode":c}=dw();return(0,O.jsx)(lS,{children:(0,O.jsxs)("div",{className:D("tlui-layout",{"tlui-layout__mobile":o<5}),"data-breakpoint":o,children:[a?(0,O.jsx)("div",{className:"tlui-layout__top",children:(0,O.jsx)(cn,{type:"icon",className:"tlui-focus-button",title:`${i("focus-mode.toggle-focus-mode")}`,icon:"dot",onClick:()=>c.onSelect("menu")})}):(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)("div",{className:"tlui-layout__top",children:[(0,O.jsxs)("div",{className:"tlui-layout__top__left",children:[(0,O.jsx)(gB,{}),(0,O.jsxs)("div",{className:"tlui-helper-buttons",children:[(0,O.jsx)(gU,{}),(0,O.jsx)(hn,{}),(0,O.jsx)(gV,{})]})]}),(0,O.jsx)("div",{className:"tlui-layout__top__center",children:t}),(0,O.jsxs)("div",{className:"tlui-layout__top__right",children:[e,o>=5&&!s&&(0,O.jsx)("div",{className:"tlui-style-panel__wrapper",children:(0,O.jsx)(mf,{})})]})]}),(0,O.jsxs)("div",{className:"tlui-layout__bottom",children:[(0,O.jsxs)("div",{className:"tlui-layout__bottom__main",children:[(0,O.jsx)(gF,{}),(0,O.jsx)(m2,{}),o>=4&&(0,O.jsx)(gt,{})]}),l&&(0,O.jsx)(fJ,{renderDebugMenuItems:n??null})]})]}),(0,O.jsx)(mk,{}),(0,O.jsx)(f6,{}),(0,O.jsx)(m_,{}),(0,O.jsx)(f9,{})]})})}),ye="ContextMenu",[yt,yn]=a5(ye,[pV]),yr=pV(),[yi,yo]=yt(ye),ys=(0,$.forwardRef)((e,t)=>{let{__scopeContextMenu:n,disabled:r=!1,...i}=e,o=yo("ContextMenuTrigger",n),s=yr(n),a=(0,$.useRef)({x:0,y:0}),l=(0,$.useRef)({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),c=(0,$.useRef)(0),u=(0,$.useCallback)(()=>window.clearTimeout(c.current),[]),d=e=>{a.current={x:e.clientX,y:e.clientY},o.onOpenChange(!0)};return(0,$.useEffect)(()=>u,[u]),(0,$.useEffect)(()=>void(r&&u()),[r,u]),(0,$.createElement)($.Fragment,null,(0,$.createElement)(pX,aJ({},s,{virtualRef:l})),(0,$.createElement)(a7.span,aJ({"data-state":o.open?"open":"closed","data-disabled":r?"":void 0},i,{ref:t,style:{WebkitTouchCallout:"none",...e.style},onContextMenu:r?e.onContextMenu:a0(e.onContextMenu,e=>{u(),d(e),e.preventDefault()}),onPointerDown:r?e.onPointerDown:a0(e.onPointerDown,yp(e=>{u(),c.current=window.setTimeout(()=>d(e),700)})),onPointerMove:r?e.onPointerMove:a0(e.onPointerMove,yp(u)),onPointerCancel:r?e.onPointerCancel:a0(e.onPointerCancel,yp(u)),onPointerUp:r?e.onPointerUp:a0(e.onPointerUp,yp(u))})))}),ya=(0,$.forwardRef)((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=yo("ContextMenuContent",n),o=yr(n),s=(0,$.useRef)(!1);return(0,$.createElement)(p5,aJ({},o,r,{ref:t,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:t=>{var n;null===(n=e.onCloseAutoFocus)||void 0===n||n.call(e,t),!t.defaultPrevented&&s.current&&t.preventDefault(),s.current=!1},onInteractOutside:t=>{var n;null===(n=e.onInteractOutside)||void 0===n||n.call(e,t),t.defaultPrevented||i.modal||(s.current=!0)},style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),yl=(0,$.forwardRef)((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=yr(n);return(0,$.createElement)(p6,aJ({},i,r,{ref:t}))}),yc=(0,$.forwardRef)((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=yr(n);return(0,$.createElement)(fe,aJ({},i,r,{ref:t}))}),yu=(0,$.forwardRef)((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=yr(n);return(0,$.createElement)(fn,aJ({},i,r,{ref:t}))}),yd=(0,$.forwardRef)((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=yr(n);return(0,$.createElement)(fp,aJ({},i,r,{ref:t}))}),yh=(0,$.forwardRef)((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=yr(n);return(0,$.createElement)(ff,aJ({},i,r,{ref:t,style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))});function yp(e){return t=>"mouse"!==t.pointerType?e(t):void 0}let yf=e=>{let{__scopeContextMenu:t,children:n,onOpenChange:r,dir:i,modal:o=!0}=e,[s,a]=(0,$.useState)(!1),l=yr(t),c=lt(r),u=(0,$.useCallback)(e=>{a(e),c(e)},[c]);return(0,$.createElement)(yi,{scope:t,open:s,onOpenChange:u,modal:o},(0,$.createElement)(fw,aJ({},l,{dir:i,open:s,onOpenChange:u,modal:o}),n))},yg=e=>{let{__scopeContextMenu:t,...n}=e,r=yr(t);return(0,$.createElement)(fx,aJ({},r,n))},ym=e=>{let{__scopeContextMenu:t,children:n,onOpenChange:r,open:i,defaultOpen:o}=e,s=yr(t),[a,l]=lh({prop:i,defaultProp:o,onChange:r});return(0,$.createElement)(fv,aJ({},s,{open:a,onOpenChange:l}),n)},yy=(0,T.j)(function(){let e=(0,G.j)(),t=J(),n=e.getPages(),r=e.getCurrentPageId(),i=l3(),{addToast:o}=dl();return(0,O.jsxs)(ym,{children:[(0,O.jsx)(yd,{dir:"ltr",asChild:!0,children:(0,O.jsx)(cn,{type:"menu",label:"context-menu.move-to-page","data-testid":"menu-item.move-to-page",icon:"chevron-right"})}),(0,O.jsx)(yg,{container:t,children:(0,O.jsxs)(yh,{className:"tlui-menu",sideOffset:-4,collisionPadding:4,children:[(0,O.jsx)(yl,{dir:"ltr",className:"tlui-menu__group","data-testid":"menu-item.pages",children:n.map(t=>(0,O.jsx)(yc,{disabled:r===t.id,onSelect:()=>{e.mark("move_shapes_to_page"),e.moveShapesToPage(e.getSelectedShapeIds(),t.id);let n=e.getPage(t.id);n&&o({title:"Changed Page",description:`Moved to ${n.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{e.mark("change-page"),e.setCurrentPage(r)}}]})},asChild:!0,children:(0,O.jsx)(cn,{type:"menu",title:t.name,className:"tlui-context-menu__move-to-page__name",children:(0,O.jsx)("span",{className:"tlui-button__label",children:t.name})})},t.id))},"pages"),(0,O.jsx)(yl,{dir:"ltr",className:"tlui-menu__group","data-testid":"menu-item.new-page",children:(0,O.jsx)(yc,{onSelect:()=>{let t=I.ez.createId(),n=e.getSelectedShapeIds();e.batch(()=>{e.mark("move_shapes_to_page"),e.createPage({name:i("page-menu.new-page-initial-name"),id:t}),e.moveShapesToPage(n,t)})},asChild:!0,children:(0,O.jsx)(cn,{type:"menu",title:i("context.pages.new-page"),className:"tlui-context-menu__move-to-page__name",children:(0,O.jsx)("span",{className:"tlui-button__label",children:i("context.pages.new-page")})})},"new-page")},"new-page")]})})]})}),yb=function({children:e}){let t=(0,G.j)(),n=dF(),[r,i]=fz("context menu",(0,$.useCallback)(e=>{if(e){if(t.getInstanceState().isCoarsePointer){let e=t.getSelectedShapes(),{inputs:{currentPagePoint:n}}=t,r=t.getShapesAtPoint(n);if(!t.getSelectedShapes().length||!r.some(t=>e.includes(t))){let e=r.filter(e=>t.isShapeOrAncestorLocked(e));e.length&&t.select(...e.map(e=>e.id))}}}else{let e=t.getOnlySelectedShape();e&&t.isShapeOrAncestorLocked(e)&&t.setSelectedShapes([])}},[t])),o=r3(),s=0===n.length||o&&n.every(e=>!e.readonlyOk),a=!(0,T.Hg)("isSelectToolActive",()=>"select"===t.getCurrentToolId(),[t])||s;return(0,O.jsxs)(yf,{dir:"ltr",onOpenChange:i,modal:!1,children:[(0,O.jsx)(ys,{onContextMenu:a?H:void 0,dir:"ltr",disabled:a,children:e}),r&&(0,O.jsx)(yw,{})]})},yw=(0,$.forwardRef)(function(){let e=(0,G.j)(),t=l3(),n=dF(),[r,i]=fz("context menu sub"),o=r3(),s=dO(),a=J(),[l,c]=(0,$.useState)(!1);return(0,O.jsx)(yg,{container:a,children:(0,O.jsx)(ya,{className:"tlui-menu scrollable","data-testid":"context-menu",alignOffset:-4,collisionPadding:4,onContextMenu:H,children:n.map(n=>(function e(n,r,u,d){if(!r||o&&!r.readonlyOk)return null;switch(r.type){case"custom":if("MOVE_TO_PAGE_MENU"===r.id)return(0,O.jsx)(yy,{},r.id);break;case"group":return(0,O.jsx)(yl,{dir:"ltr",className:D("tlui-menu__group",{"tlui-menu__group__small":u?.type==="submenu"}),"data-testid":`menu-item.${r.id}`,children:r.children.map(t=>e(n,t,r,d+1))},r.id);case"submenu":return(0,O.jsxs)(ym,{onOpenChange:i,children:[(0,O.jsx)(yd,{dir:"ltr",disabled:r.disabled,asChild:!0,children:(0,O.jsx)(cn,{type:"menu",label:r.label,"data-testid":`menu-item.${r.id}`,icon:"chevron-right"})}),(0,O.jsx)(yg,{container:a,children:(0,O.jsx)(yh,{className:"tlui-menu",sideOffset:-4,collisionPadding:4,children:r.children.map(t=>e(n,t,r,d+1))})})]},r.id);case"item":{if(o&&!r.readonlyOk)return null;let{id:e,checkbox:n,contextMenuLabel:i,label:a,onSelect:u,kbd:h,icon:p}=r.actionItem,f=i??a,g=f?t(f):void 0;if(n)return(0,O.jsxs)(yu,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",disabled:r.disabled,onSelect:e=>{u("context-menu"),H(e)},title:g||void 0,checked:r.checked,children:[(0,O.jsx)(l4,{small:!0,icon:r.checked?"check":"checkbox-empty"}),g&&(0,O.jsx)("span",{className:"tlui-button__label",draggable:!1,children:g}),h&&(0,O.jsx)(ct,{children:h})]},e);return(0,O.jsx)(yc,{dir:"ltr",asChild:!0,children:(0,O.jsx)(cn,{type:"menu","data-testid":`menu-item.${e}`,kbd:h,label:f,disabled:r.disabled,iconLeft:s<3&&d>2?p:void 0,onClick:()=>{l?c(!1):u("context-menu")}})},e)}}})(e,n,null,0))})})});var yx=((m=yx||{})[m.SUCCESS=0]="SUCCESS",m[m.FAILED=1]="FAILED",m[m.WAITING=2]="WAITING",m);let yv=(e,t)=>{let[n,r]=(0,$.useState)(2);return(0,$.useEffect)(()=>{let{url:n,style:i="normal",weight:o="500",display:s,featureSettings:a,stretch:l,unicodeRange:c,variant:u}=t,d=!1;r(2);let h=new FontFace(e,`url(${n})`,{style:i,weight:o,display:s,featureSettings:a,stretch:l,unicodeRange:c,variant:u});return h.load().then(()=>{d||(document.fonts.add(h),r(0))}).catch(e=>{d||(console.error(e),r(1))}),h.$$_url=n,h.$$_fontface=`
@font-face {
	font-family: ${h.family};
	font-stretch: ${h.stretch};
	font-weight: ${h.weight};
	font-style: ${h.style};
	src: url("${n}") format("woff2")
}`,()=>{document.fonts.delete(h),d=!0}},[e,t]),n};function yS(e){var t;let{children:n,maxImageDimension:r,maxAssetSize:i,acceptedImageMimeTypes:o,acceptedVideoMimeTypes:s,onMount:a,...l}=e,c=rb(l.components??{}),u=ry(l.shapeUtils??[]),d=ry(l.tools??[]),h={initialState:"select",...l,components:(0,$.useMemo)(()=>({Scribble:r2,CollaboratorScribble:r2,SelectionForeground:r4,SelectionBackground:r5,Handles:rW,HoveredShapeIndicator:rY,...c}),[c]),shapeUtils:(0,$.useMemo)(()=>[...s7,...u],[u]),tools:(0,$.useMemo)(()=>[...aq,...on,...d],[d])},{done:p,error:f}=function(e){let t=(0,$.useMemo)(()=>({draw:{url:e.fonts.draw},serif:{url:e.fonts.serif},sansSerif:{url:e.fonts.sansSerif},monospace:{url:e.fonts.monospace}}),[e]),n=[yv("tldraw_draw",t.draw),yv("tldraw_serif",t.serif),yv("tldraw_sans",t.sansSerif),yv("tldraw_mono",t.monospace)];return{error:n.some(e=>1===e),done:!n.some(e=>2===e)}}((t=l.assetUrls,(0,$.useMemo)(()=>t?{fonts:{...lV.fonts,...t?.fonts}}:lV,[t])));return f?(0,O.jsx)(n7,{children:"Could not load assets. Please refresh the page."}):p?(0,O.jsx)(n2,{...h,children:(0,O.jsxs)(m6,{...h,children:[(0,O.jsx)(yb,{children:(0,O.jsx)(tU,{})}),(0,O.jsx)(yk,{maxImageDimension:r,maxAssetSize:i,acceptedImageMimeTypes:o,acceptedVideoMimeTypes:s,onMount:a}),n]})}):(0,O.jsx)(n9,{children:"Loading assets..."})}function yk({maxImageDimension:e=1e3,maxAssetSize:t=10485760,acceptedImageMimeTypes:n=["image/jpeg","image/png","image/gif","image/svg+xml"],acceptedVideoMimeTypes:r=["video/mp4","video/quicktime"],onMount:i}){let o=(0,G.j)(),s=function(e){let t=(0,$.useRef)();return(0,$.useLayoutEffect)(()=>{t.current=e}),(0,$.useDebugValue)(e),(0,$.useCallback)((...e)=>{let n=t.current;return(0,M.hu)(n,"fn does not exist"),n(...e)},[])}(o=>{let s=[];return s.push(o.sideEffects.registerAfterChangeHandler("instance",(e,t)=>{e.isFocused!==t.isFocused&&(t.isFocused?o.getContainer().focus():(o.complete(),o.getContainer().blur()),o.updateViewportScreenBounds())}),o.sideEffects.registerAfterChangeHandler("instance_page_state",(e,t)=>{if(e.croppingShapeId!==t.croppingShapeId){let n=o.isInAny("select.crop","select.pointing_crop_handle","select.cropping");!e.croppingShapeId&&t.croppingShapeId?n||o.setCurrentTool("select.crop.idle"):e.croppingShapeId&&!t.croppingShapeId&&n&&o.setCurrentTool("select.idle")}e.editingShapeId!==t.editingShapeId&&(!e.editingShapeId&&t.editingShapeId?o.isIn("select.editing_shape")||o.setCurrentTool("select.editing_shape"):e.editingShapeId&&!t.editingShapeId&&o.isIn("select.editing_shape")&&o.setCurrentTool("select.idle"))})),!function(e,{maxImageDimension:t,maxAssetSize:n,acceptedImageMimeTypes:r,acceptedVideoMimeTypes:i}){e.registerExternalAssetHandler("file",async({file:e})=>{let o=e.name,s=e,a=r.includes(s.type),l=i.includes(s.type);(0,M.hu)(a||l,`File type not allowed: ${s.type}`),(0,M.hu)(s.size<=n,`File size too big: ${(s.size/1024).toFixed()}kb > ${(n/1024).toFixed()}kb`),"video/quicktime"===s.type&&(s=new Blob([s],{type:"video/mp4"}));let c=a?await M.xe.getImageSize(s):await M.xe.getVideoSize(s),u="image/gif"===s.type?await i$(s):l,d=await (0,M.Aq)(await s.arrayBuffer());if(isFinite(t)){let e=iI(c,{w:t,h:t});c!==e&&("image/jpeg"===s.type||"image/png"===s.type)&&(c=e)}("image/jpeg"===s.type||"image/png"===s.type)&&(s=await iM(s,c.w,c.h,{type:s.type,quality:.92}));let h=I.Yk.createId(d);return I.Yk.create({id:h,type:a?"image":"video",typeName:"asset",props:{name:o,src:await M.xe.blobToDataUrl(s),w:c.w,h:c.h,mimeType:s.type,isAnimated:u}})}),e.registerExternalAssetHandler("url",async({url:e})=>{let t;try{let n=await fetch(e,{method:"GET",mode:"no-cors"}),r=await n.text(),i=new DOMParser().parseFromString(r,"text/html");t={image:i.head.querySelector('meta[property="og:image"]')?.getAttribute("content")??"",title:i.head.querySelector('meta[property="og:title"]')?.getAttribute("content")??iU(e,32),description:i.head.querySelector('meta[property="og:description"]')?.getAttribute("content")??""}}catch(n){console.error(n),t={image:"",title:iU(e,32),description:""}}return{id:I.Yk.createId((0,M.jK)(e)),typeName:"asset",type:"bookmark",props:{src:e,description:t.description,image:t.image,title:t.title},meta:{}}}),e.registerExternalContentHandler("svg-text",async({point:t,text:n})=>{let r=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageCenter()),i=new DOMParser().parseFromString(n,"image/svg+xml").querySelector("svg");if(!i)throw Error("No <svg/> element present");let o=parseFloat(i.getAttribute("width")||"0"),s=parseFloat(i.getAttribute("height")||"0");if(!(o&&s)){document.body.appendChild(i);let e=i.getBoundingClientRect();document.body.removeChild(i),o=e.width,s=e.height}let a=await e.getAssetForExternalContent({type:"file",file:new File([n],"asset.svg",{type:"image/svg+xml"})});if(!a)throw Error("Could not create an asset");iV(e,[a],r)}),e.registerExternalContentHandler("embed",({point:t,url:n,embed:r})=>{let i=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageCenter()),{width:o,height:s}=r,a=(0,I.F1)(),l={id:a,type:"embed",x:i.x-(o||450)/2,y:i.y-(s||450)/2,props:{w:o,h:s,url:n}};e.createShapes([l]).select(a)}),e.registerExternalContentHandler("files",async({point:t,files:o})=>{let s=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageCenter()),a=new eh.B(s.x,s.y),l=[];await Promise.all(o.map(async(t,o)=>{if(t.size>n)return console.warn(`File size too big: ${(t.size/1024).toFixed()}kb > ${(n/1024).toFixed()}kb`),null;if(!t.type)throw Error("No mime type");if(!r.concat(i).includes(t.type))return console.warn(`${t.name} not loaded - Extension not allowed.`),null;try{let n=await e.getAssetForExternalContent({type:"file",file:t});if(!n)throw Error("Could not create an asset");l[o]=n}catch(e){return console.error(e),null}})),iV(e,(0,M.oA)(l),a)}),e.registerExternalContentHandler("text",async({point:t,text:n})=>{let r,i,o;let s=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageCenter()),a=e.getShapeUtil("text").getDefaultProps(),l=(function(e){let t=e.split("\n");for(;t[0]&&0===t[0].trim().length;)t.shift();let n=1/0;for(let e of t)if(e.trim().length>0){let t=e.length-e.trimStart().length;n=Math.min(n,t)}return t.map(e=>e.slice(n)).join("\n")})(n.replace(/\t/g,"  ")).replace(/[ \t]+$/gm,"").replace(/\n+$/,""),c="middle",u=l.split("\n").length>1,d=iF.test(l);u&&(c=u?d?"end":"start":"middle");let h=e.textMeasure.measureText(l,{...ie,fontFamily:is[a.font],fontSize:ir[a.size],maxWidth:null}),p=Math.min(u?.9*e.getViewportPageBounds().width:920,Math.max(200,.9*e.getViewportPageBounds().width));if(h.w>p){let t=e.textMeasure.measureText(l,{...ie,fontFamily:is[a.font],fontSize:ir[a.size],maxWidth:p});r=t.w,i=t.h,o=!1,c=d?"end":"start"}else r=h.w,i=h.h,o=!0;s.y-i/2<e.getViewportPageBounds().minY+40&&(s.y=e.getViewportPageBounds().minY+40+i/2),e.createShapes([{id:(0,I.F1)(),type:"text",x:s.x-r/2,y:s.y-i/2,props:{text:l,align:c,autoSize:o,w:r}}])}),e.registerExternalContentHandler("url",async({point:t,url:n})=>{let r=iR(n);if(r)return e.putExternalContent({type:"embed",url:r.url,point:t,embed:r.definition});let i=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageCenter()),o=I.Yk.createId((0,M.jK)(n)),s=function(e,t,n){let r={id:(0,I.F1)(),type:"bookmark",x:n.x-150,y:n.y-160,opacity:1,props:{assetId:null,url:t}};return e.batch(()=>{e.createShapes([r]).select(r.id),iH(e,n)}),e.getShape(r.id)}(e,n,i),a=e.getAsset(o),l=!1;if(!a){l=!0;let t=await e.getAssetForExternalContent({type:"url",url:n});if(!t)throw Error("Could not create an asset");a=t}e.batch(()=>{l&&e.createAssets([a]),e.updateShapes([{id:s.id,type:s.type,props:{assetId:a.id}}])})})}(o,{maxImageDimension:e,maxAssetSize:t,acceptedImageMimeTypes:n,acceptedVideoMimeTypes:r}),s.push(i?.(o)),()=>{s.forEach(e=>e?.())}});return(0,$.useLayoutEffect)(()=>{if(o)return s?.(o)},[o,s]),null}function y_(){let e=l3(),t=(0,$.useRef)(null);return(0,O.jsxs)("div",{className:D("tlui-offline-indicator"),ref:t,children:[e("status.offline"),(0,O.jsx)(l4,{"aria-label":"offline",icon:"status-offline",small:!0})]})}function yE(e,t){e.batch(()=>{t=function(e,t){let{version:n=0}=e;e.assets||(e.assets={});let r=new Set;return Object.values(e.pages).forEach(e=>Object.values(e.shapes).forEach(t=>{let{parentId:n,children:i,assetId:o}=t;o&&r.add(o),n===e.id||e.shapes[n]||(console.warn("Encountered a shape with a missing parent!"),t.parentId=e.id),"group"===t.type&&i&&i.forEach(n=>{e.shapes[n]||(console.warn("Encountered a parent with a missing child!",t.id,n),i?.splice(i.indexOf(n),1))})})),Object.keys(e.assets).forEach(t=>{r.has(t)||delete e.assets[t]}),15.5!==n&&(n<14&&Object.values(e.pages).forEach(e=>{Object.values(e.shapes).filter(e=>"text"===e.type).forEach(e=>{void 0===e.style.font&&e.style.font})}),n<=13&&Object.values(e.pages).forEach(e=>{Object.values(e.bindings).forEach(e=>{Object.assign(e,e.meta)}),Object.values(e.shapes).forEach(e=>{Object.entries(e.style).forEach(([t,n])=>{"string"==typeof n&&(e.style[t]=n.toLowerCase())}),"arrow"===e.type&&e.decorations&&Object.entries(e.decorations).forEach(([t,n])=>{"Arrow"===n&&(e.decorations={...e.decorations,[t]:"arrow"})})})}),n<=13.1&&null==e.name&&(e.name="New Document"),n<15&&null==e.assets&&(e.assets={}),Object.values(e.pages).forEach(e=>{Object.values(e.shapes).forEach(e=>{n<15.2&&("image"===e.type||"video"===e.type)&&null==e.style.isFilled&&(e.style.isFilled=!0),n<15.3&&("rectangle"===e.type||"triangle"===e.type||"ellipse"===e.type||"arrow"===e.type)&&("text"in e&&"string"==typeof e.text&&(e.label=e.text),e.label||(e.label=""),e.labelPoint||(e.labelPoint=[.5,.5]))})})),Object.values(e.pageStates).forEach(t=>{t.selectedIds=t.selectedIds.filter(n=>void 0!==e.pages[t.id].shapes[n]),t.bindingId=void 0,t.editingId=void 0,t.hoveredId=void 0,t.pointedId=void 0}),e.version=15.5,e}(t,15.5),e.cancel().cancel().cancel().cancel();let n=e.getPages()[0].id;for(let t of(e.setCurrentPage(n),e.getPages().slice(1)))e.deletePage(t.id);e.selectAll(),e.deleteShapes(e.getSelectedShapeIds());let r=new Map;Object.values(t.assets??{}).forEach(t=>{switch(t.type){case"image":{let n=I.Yk.createId();r.set(t.id,n);let i={id:n,typeName:"asset",type:"image",props:{w:yP(t.size[0]),h:yP(t.size[1]),name:t.fileName??"Untitled",isAnimated:!1,mimeType:null,src:t.src},meta:{}};e.createAssets([i]),yT(e,i);break}case"video":{let n=I.Yk.createId();r.set(t.id,n),e.createAssets([{id:n,typeName:"asset",type:"video",props:{w:yP(t.size[0]),h:yP(t.size[1]),name:t.fileName??"Untitled",isAnimated:!0,mimeType:null,src:t.src},meta:{}}])}}});let i=new Map;Object.values(t.pages??{}).sort((e,t)=>(e.childIndex??1)<(t.childIndex??1)?-1:1).forEach((t,n)=>{if(0===n)i.set(t.id,e.getCurrentPageId());else{let n=I.ez.createId();i.set(t.id,n),e.createPage({name:t.name??"Page",id:n})}}),Object.values(t.pages??{}).sort((e,t)=>(e.childIndex??1)<(t.childIndex??1)?-1:1).forEach(t=>{e.setCurrentPage(i.get(t.id));let n=new Map,o=new Map,s=Object.values(t.shapes??{}).sort((e,t)=>e.childIndex<t.childIndex?-1:1).slice(0,L.kx);s.forEach(e=>{if("group"!==e.type)return;let t=(0,I.F1)();n.set(e.id,t),o.set(e.id,[])}),s.forEach(s=>{if("group"===s.type)return;let a=(0,I.F1)();n.set(s.id,a),s.parentId!==t.id&&(o.has(s.parentId)?o.get(s.parentId).push(s.id):console.warn("parent does not exist",s));let l={id:a,parentId:i.get(t.id),x:yC(s.point[0]),y:yC(s.point[1]),rotation:0,isLocked:!!s.isLocked};switch(s.type){case"sticky":e.createShapes([{...l,type:"note",props:{text:s.text??"",color:yV(s.style.color),size:yK(s.style.size),font:yH(s.style.font),align:yZ(s.style.textAlign)}}]);break;case"rectangle":{e.createShapes([{...l,type:"geo",props:{geo:"rectangle",w:yP(s.size[0]),h:yP(s.size[1]),text:s.label??"",fill:yX(s.style.isFilled,s.style.color),labelColor:yV(s.style.color),color:yV(s.style.color),size:yK(s.style.size),font:yH(s.style.font),dash:yW(s.style.dash),align:"middle"}}]);let t=e.getShapePageBounds(l.id);if(e.updateShapes([{id:l.id,type:"geo",props:{text:s.label??""}}]),t.width===t.height){let t=e.getShape(l.id),{growY:n}=t.props,r=yP(t.props.w),i=yP(t.props.h),o=r+n/2,s=i+n/2;e.updateShapes([{id:l.id,type:"geo",x:yC(t.x)-(o-r)/2,y:yC(t.y)-(s-i)/2,props:{w:o,h:s}}])}break}case"triangle":{e.createShapes([{...l,type:"geo",props:{geo:"triangle",w:yP(s.size[0]),h:yP(s.size[1]),fill:yX(s.style.isFilled,s.style.color),labelColor:yV(s.style.color),color:yV(s.style.color),size:yK(s.style.size),font:yH(s.style.font),dash:yW(s.style.dash),align:"middle"}}]);let t=e.getShapePageBounds(l.id);if(e.updateShapes([{id:l.id,type:"geo",props:{text:s.label??""}}]),t.width===t.height){let t=e.getShape(l.id),{growY:n}=t.props,r=yP(t.props.w),i=yP(t.props.h),o=r+n/2,s=i+n/2;e.updateShapes([{id:l.id,type:"geo",x:yC(t.x)-(o-r)/2,y:yC(t.y)-(s-i)/2,props:{w:o,h:s}}])}break}case"ellipse":{e.createShapes([{...l,type:"geo",props:{geo:"ellipse",w:2*yP(s.radius[0]),h:2*yP(s.radius[1]),fill:yX(s.style.isFilled,s.style.color),labelColor:yV(s.style.color),color:yV(s.style.color),size:yK(s.style.size),font:yH(s.style.font),dash:yW(s.style.dash),align:"middle"}}]);let t=e.getShapePageBounds(l.id);if(e.updateShapes([{id:l.id,type:"geo",props:{text:s.label??""}}]),t.width===t.height){let t=e.getShape(l.id),{growY:n}=t.props,r=yP(t.props.w),i=yP(t.props.h),o=r+n/2,s=i+n/2;e.updateShapes([{id:l.id,type:"geo",x:yC(t.x)-(o-r)/2,y:yC(t.y)-(s-i)/2,props:{w:o,h:s}}])}break}case"draw":if(0===s.points.length){!function(e){if(n.delete(e.id),o.has(e.parentId)){let t=o.get(e.parentId).filter(t=>t!==e.id);o.set(e.parentId,t)}}(s);break}e.createShapes([{...l,type:"draw",props:{fill:yX(s.style.isFilled,s.style.color),color:yV(s.style.color),size:yK(s.style.size),dash:yW(s.style.dash),isPen:!1,isComplete:s.isComplete,segments:[{type:"free",points:s.points.map(yY)}]}}]);break;case"arrow":{let t=yC(s.bend),n=yY(s.handles.start.point),r=yY(s.handles.end.point),i=eh.B.Dist(n,r);e.createShapes([{...l,type:"arrow",props:{text:s.label??"",color:yV(s.style.color),labelColor:yV(s.style.color),size:yK(s.style.size),font:yH(s.style.font),dash:yW(s.style.dash),arrowheadStart:yG(s.decorations?.start),arrowheadEnd:yG(s.decorations?.end),start:{type:"point",x:yC(s.handles.start.point[0]),y:yC(s.handles.start.point[1])},end:{type:"point",x:yC(s.handles.end.point[0]),y:yC(s.handles.end.point[1])},bend:-(i*t)/2}}]);break}case"text":var c;e.createShapes([{...l,type:"text",props:{text:s.text??" ",color:yV(s.style.color),size:(c=s.style.size)?yN[c]??"m":"m",font:yH(s.style.font),align:yZ(s.style.textAlign),scale:s.style.scale??1}}]);break;case"image":{let t=r.get(s.assetId);if(!t){console.warn("Could not find asset id",s.assetId);return}e.createShapes([{...l,type:"image",props:{w:yP(s.size[0]),h:yP(s.size[1]),assetId:t}}]);break}case"video":{let t=r.get(s.assetId);if(!t){console.warn("Could not find asset id",s.assetId);return}e.createShapes([{...l,type:"video",props:{w:yP(s.size[0]),h:yP(s.size[1]),assetId:t}}])}}let u=yC(s.rotation);0!==u&&(e.select(a),e.rotateShapesBy([a],u))}),o.forEach((r,i)=>{let o=r.map(e=>n.get(e)),s=n.get(i);e.groupShapes(o,s);let a=yC(t.shapes[i].rotation);0!==a&&(e.select(s),e.rotateShapesBy([s],a))}),s.forEach(r=>{if("arrow"!==r.type)return;let i=n.get(r.id),o=e.getShapeUtil("arrow");for(let s of(e.inputs.ctrlKey=!1,["start","end"])){let a=r.handles[s].bindingId;if(a){let r=t.bindings[a];if(!r)continue;let l=n.get(r.toId);if(!e.getShape(l))continue;if(l){let t=e.getShapePageBounds(l),n=e.getShape(i),a=(0,eu.uZ)((yC(r.point[0])+.5)/2,.2,.8),c=(0,eu.uZ)((yC(r.point[1])+.5)/2,.2,.8),u=e.getPointInShapeSpace(n,{x:t.minX+t.width*a,y:t.minY+t.height*c}),d=e.getShapeHandles(n),h=o.onHandleDrag(n,{handle:{...d.find(e=>e.id===s),x:u.x,y:u.y},isPrecise:.5!==u.x||.5!==u.y});if(h){if(h.props?.[s]){let e=h.props?.[s];"binding"===e.type&&(e.isExact=0===r.distance,e.boundShapeId!==l&&(console.warn("Hit the wrong shape!"),e.boundShapeId=l,e.normalizedAnchor={x:.5,y:.5}))}e.updateShapes([h])}}}}})}),e.setCurrentPage(n),e.history.clear(),e.selectNone(),e.updateViewportScreenBounds();let o=e.getCurrentPageBounds();o&&e.zoomToBounds(o,1)})}function yC(e){return"number"!=typeof e||Number.isNaN(e)||!Number.isFinite(e)?0:e}function yP(e){let t=yC(e);return t<=0?1:t}async function yT(e,t){try{if("bookmark"===t.type||!t.props.src)return;let n=await fetch(t.props.src);if(!n.ok)return;let r=new File([await n.blob()],t.props.name,{type:n.headers.get("content-type")??t.props.mimeType??void 0}),i=await e.getAssetForExternalContent({type:"file",file:r});if(!i)throw Error("Could not get asset for external content");if("bookmark"===i.type)return;e.updateAssets([{id:t.id,type:t.type,props:{...i.props,name:t.props.name}}])}catch(e){}}var yj=((y=yj||{}).Sticky="sticky",y.Ellipse="ellipse",y.Rectangle="rectangle",y.Triangle="triangle",y.Draw="draw",y.Arrow="arrow",y.Text="text",y.Group="group",y.Image="image",y.Video="video",y),yI=((b=yI||{}).White="white",b.LightGray="lightGray",b.Gray="gray",b.Black="black",b.Green="green",b.Cyan="cyan",b.Blue="blue",b.Indigo="indigo",b.Violet="violet",b.Red="red",b.Orange="orange",b.Yellow="yellow",b),yM=((w=yM||{}).Small="small",w.Medium="medium",w.Large="large",w),yA=((x=yA||{}).Draw="draw",x.Solid="solid",x.Dashed="dashed",x.Dotted="dotted",x),yO=((v=yO||{}).Start="start",v.Middle="middle",v.End="end",v.Justify="justify",v),y$=((S=y$||{}).Script="script",S.Sans="sans",S.Serif="serif",S.Mono="mono",S),yB=((k=yB||{}).Arrow="arrow",k),yD=((_=yD||{}).Image="image",_.Video="video",_);let yL={white:"black",black:"black",lightGray:"grey",gray:"grey",green:"light-green",cyan:"green",blue:"light-blue",indigo:"blue",orange:"orange",yellow:"yellow",red:"red",violet:"light-violet"},yR={mono:"mono",sans:"sans",script:"draw",serif:"serif"},yz={start:"start",middle:"middle",end:"end",justify:"start"},yN={small:"s",medium:"l",large:"xl"},yF={small:"m",medium:"l",large:"xl"},yU={solid:"solid",dashed:"dashed",dotted:"dotted",draw:"draw"};function yV(e){return e?yL[e]??"black":"black"}function yH(e){return e?yR[e]??"draw":"draw"}function yZ(e){return e?yz[e]??"middle":"middle"}function yK(e){return e?yF[e]??"l":"l"}function yW(e){return e?yU[e]??"draw":"draw"}function yY(e){return{x:yC(e[0]),y:yC(e[1]),z:null==e[2]?.5:yC(e[2])}}function yG(e){return"arrow"===e?"arrow":"none"}function yX(e,t){return e?"black"===t||"white"===t?"semi":"solid":"none"}let yq=".tldr",yJ=A.T.object({tldrawFileFormatVersion:A.T.nonZeroInteger,schema:A.T.object({schemaVersion:A.T.positiveInteger,storeVersion:A.T.positiveInteger,recordVersions:A.T.dict(A.T.string,A.T.object({version:A.T.positiveInteger,subTypeVersions:A.T.dict(A.T.string,A.T.positiveInteger).optional(),subTypeKey:A.T.string.optional()}))}),records:A.T.arrayOf(A.T.object({id:A.T.string,typeName:A.T.string}).allowUnknownProperties())});function yQ({json:e,schema:t}){let n,r;try{n=yJ.validate(JSON.parse(e))}catch(t){try{if(n=JSON.parse(e),function(e){try{if(e.document?.version)return!0;return!1}catch(e){return!1}}(n))return M.x4.err({type:"v1File",data:n})}catch(e){}return M.x4.err({type:"notATldrawFile",cause:t})}if(n.tldrawFileFormatVersion>1)return M.x4.err({type:"fileFormatVersionTooNew",version:n.tldrawFileFormatVersion});try{let e=Object.fromEntries(n.records.map(e=>[e.id,e]));r=t.migrateStoreSnapshot({store:e,schema:n.schema})}catch(e){return M.x4.err({type:"invalidRecords",cause:e})}if("error"===r.type)return M.x4.err({type:"migrationFailed",reason:r.reason});try{return M.x4.ok(nG({initialData:r.value,schema:t}))}catch(e){return M.x4.err({type:"invalidRecords",cause:e})}}async function y0(e){let t=[],n=new Set,r=[];for(let i of e.allRecords())switch(i.typeName){case"asset":if("bookmark"!==i.type&&i.props.src&&!i.props.src.startsWith("data:")){let e;try{e=await M.P6.fileToBase64(await (await fetch(i.props.src)).blob())}catch{e=i.props.src}r.push({...i,props:{...i.props,src:e}})}else r.push(i);break;case"shape":"assetId"in i.props&&n.add(i.props.assetId),t.push(i);break;default:t.push(i)}let i=t.concat(r.filter(e=>n.has(e.id)));return JSON.stringify({tldrawFileFormatVersion:1,schema:e.schema.serialize(),records:i})}async function y1(e){return new Blob([await y0(e)],{type:"application/vnd.tldraw+json"})}async function y2(e,t,n,r,i,o){let s=yQ({schema:e.store.schema,json:t});if(!s.ok){let t;switch(s.error.type){case"notATldrawFile":e.annotateError(s.error.cause,{origin:"file-system.open.parse",willCrashApp:!1,tags:{parseErrorType:s.error.type}}),reportError(s.error.cause),t=n("file-system.file-open-error.not-a-tldraw-file");break;case"fileFormatVersionTooNew":t=n("file-system.file-open-error.file-format-version-too-new");break;case"migrationFailed":t=n(s.error.reason===j.qx.TargetVersionTooNew?"file-system.file-open-error.file-format-version-too-new":"file-system.file-open-error.generic-corrupted-file");break;case"invalidRecords":e.annotateError(s.error.cause,{origin:"file-system.open.parse",willCrashApp:!1,tags:{parseErrorType:s.error.type}}),reportError(s.error.cause),t=n("file-system.file-open-error.generic-corrupted-file");break;case"v1File":yE(e,s.error.data.document),i?.();return;default:(0,M.iP)(s.error,"type")}r({title:n("file-system.file-open-error.title"),description:t});return}(0,T.ay)(()=>{let t=e.getInstanceState().isFocused;e.store.clear();let[n,r]=(0,M.uK)(s.value.allRecords(),e=>"shape"===e.typeName);e.store.put(r,"initialize"),e.store.ensureStoreIsUsable(),e.store.put(n,"initialize"),e.history.clear(),e.updateViewportScreenBounds(),e.updateRenderingBounds();let i=e.getCurrentPageBounds();i&&e.zoomToBounds(i,1),e.updateInstanceState({isFocused:t})}),o&&e.user.updateUserPreferences({isDarkMode:!0})}},5895:function(e,t,n){"use strict";n.d(t,{ZJ:function(){return ej},TA:function(){return eT},Yk:function(){return es},AN:function(){return d},R_:function(){return ex},qi:function(){return eb},ci:function(){return eS},pp:function(){return ek},p6:function(){return eE},Y8:function(){return e_},Xo:function(){return eW},ST:function(){return eC},HO:function(){return eY},_A:function(){return K},Lu:function(){return eF},$I:function(){return ec},Zu:function(){return eG},iS:function(){return $},AM:function(){return F},a2:function(){return ts},t8:function(){return e6},ez:function(){return E},zh:function(){return L},fV:function(){return el},G4:function(){return W},PQ:function(){return T},LV:function(){return R},z:function(){return b},Vm:function(){return eA},si:function(){return eM},_3:function(){return o},TD:function(){return eo},$A:function(){return ei},h9:function(){return e$},qU:function(){return eO},lz:function(){return p},MN:function(){return w},tL:function(){return s},GP:function(){return U},F1:function(){return ep},JY:function(){return M},HH:function(){return em},_l:function(){return eL},wu:function(){return eD},BF:function(){return eH},gB:function(){return eU},DW:function(){return eV},gR:function(){return eK},k7:function(){return eZ},P3:function(){return eq},eG:function(){return eX},y6:function(){return ew},Bz:function(){return ta},DR:function(){return ef},c4:function(){return eQ},A7:function(){return eJ},J1:function(){return e1},VW:function(){return e0},yd:function(){return i},y5:function(){return e3},Fc:function(){return e5},r5:function(){return C},VV:function(){return ed},YT:function(){return eh},FH:function(){return e7},BG:function(){return e9},C_:function(){return tt},m0:function(){return te},jm:function(){return y},CF:function(){return S},Mv:function(){return j},cL:function(){return eu},gw:function(){return v},u5:function(){return I},pL:function(){return tr},XB:function(){return tn},AT:function(){return h},lY:function(){return to},p$:function(){return ti}});var r=n(477);function i(e){return r.T.string.refine(t=>{if(!t.startsWith(`${e}:`))throw Error(`${e} ID must start with "${e}:"`);return t})}let o=i("asset");function s(e,t){return r.T.object({id:o,typeName:r.T.literal("asset"),type:r.T.literal(e),props:t,meta:r.T.jsonValue})}var a=n(5801),l=n(8418);let c=r.T.model("camera",r.T.object({typeName:r.T.literal("camera"),id:i("camera"),x:r.T.number,y:r.T.number,z:r.T.number,meta:r.T.jsonValue})),u=(0,l.zn)({currentVersion:1,migrators:{1:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),d=(0,l.ju)("camera",{validator:c,migrations:u,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),h=r.T.object({x:r.T.number,y:r.T.number,z:r.T.number.optional()}),p=r.T.object({x:r.T.number,y:r.T.number,w:r.T.number,h:r.T.number}),f=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),g=r.T.setEnum(f),m=r.T.object({type:g,rotation:r.T.number}),y=r.T.number.check(e=>{if(e<0||e>1)throw new r.T.ValidationError("Opacity must be between 0 and 1")}),b=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),w=r.T.setEnum(b),x=new Set(["starting","paused","active","stopping"]),v=r.T.object({id:r.T.string,points:r.T.arrayOf(h),size:r.T.positiveNumber,color:w,opacity:r.T.number,state:r.T.setEnum(x),delay:r.T.number,shrink:r.T.number,taper:r.T.boolean}),S=i("page"),k=r.T.model("page",r.T.object({typeName:r.T.literal("page"),id:S,name:r.T.string,index:r.T.string,meta:r.T.jsonValue})),_=(0,l.zn)({currentVersion:1,migrators:{1:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),E=(0,l.ju)("page",{validator:k,migrations:_,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function C(e){return E.isId(e)}i("instance");let P=(0,l.zn)({currentVersion:24,migrators:{1:{up:e=>({...e,exportBackground:!0}),down:({exportBackground:e,...t})=>t},2:{up:({dialog:e,...t})=>t,down:e=>({...e,dialog:null})},3:{up:e=>({...e,isToolLocked:!1}),down:({isToolLocked:e,...t})=>t},4:{up:({propsForNextShape:e,...t})=>({...t,propsForNextShape:Object.fromEntries(Object.entries(e).filter(([e])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(e)))}),down:e=>e},5:{up:({propsForNextShape:e,...t})=>({...t,propsForNextShape:{...e,labelColor:"black"}}),down:e=>{let{labelColor:t,...n}=e.propsForNextShape;return{...e,propsForNextShape:{...n}}}},6:{up:e=>({...e,followingUserId:null}),down:({followingUserId:e,...t})=>t},7:{up:e=>{let t=e.propsForNextShape.align;return"justify"===t&&(t="start"),{...e,propsForNextShape:{...e.propsForNextShape,align:t}}},down:e=>({...e})},8:{up:e=>({...e,zoomBrush:null}),down:({zoomBrush:e,...t})=>t},9:{up:e=>({...e,propsForNextShape:{...e.propsForNextShape,verticalAlign:"middle"}}),down:e=>{let{verticalAlign:t,...n}=e.propsForNextShape;return{...e,propsForNextShape:n}}},10:{up:e=>null!==e.scribble?{...e,scribble:{...e.scribble,delay:0}}:{...e},down:e=>{if(null!==e.scribble){let{delay:t,...n}=e.scribble;return{...e,scribble:n}}return{...e}}},11:{up:({userId:e,...t})=>t,down:e=>({...e,userId:"user:none"})},12:{up:e=>({...e,isPenMode:!1,isGridMode:!1}),down:({isPenMode:e,isGridMode:t,...n})=>n},13:{up:({propsForNextShape:{opacity:e,...t},...n})=>({...n,opacityForNextShape:Number(e??"1"),propsForNextShape:t}),down:({opacityForNextShape:e,...t})=>({...t,propsForNextShape:{...t.propsForNextShape,opacity:e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}})},14:{up:e=>({...e,chatMessage:"",isChatting:!1}),down:({chatMessage:e,isChatting:t,...n})=>n},15:{up:e=>({...e,highlightedUserIds:[]}),down:({highlightedUserIds:e,...t})=>t},16:{up:({propsForNextShape:e,...t})=>({...t,stylesForNextShape:{}}),down:({stylesForNextShape:e,...t})=>({...t,propsForNextShape:{color:"black",labelColor:"black",dash:"draw",fill:"none",size:"m",icon:"file",font:"draw",align:"middle",verticalAlign:"middle",geo:"rectangle",arrowheadStart:"none",arrowheadEnd:"arrow",spline:"line"}})},17:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})},18:{up:e=>{let{color:t,...n}=e.cursor;return{...e,cursor:n}},down:e=>({...e,cursor:{...e.cursor,color:"black"}})},19:{up:e=>({...e,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1}),down:({canMoveCamera:e,isFocused:t,devicePixelRatio:n,isCoarsePointer:r,openMenus:i,isChangingStyle:o,isReadOnly:s,...a})=>({...a})},20:{up:({isReadOnly:e,...t})=>({...t,isReadonly:e}),down:({isReadonly:e,...t})=>({...t,isReadOnly:e})},21:{up:e=>({...e,isHoveringCanvas:null}),down:({isHoveringCanvas:e,...t})=>({...t})},22:{up:({scribble:e,...t})=>({...t,scribbles:[]}),down:({scribbles:e,...t})=>({...t,scribble:null})},23:{up:e=>({...e,insets:[!1,!1,!1,!1]}),down:({insets:e,...t})=>({...t})},24:{up:e=>({...e,duplicateProps:null}),down:({duplicateProps:e,...t})=>({...t})}}}),T="instance:instance",j=r.T.string.refine(e=>{if(!e.startsWith("page:")&&!e.startsWith("shape:"))throw Error('Parent ID must start with "page:" or "shape:"');return e}),I=i("shape");function M(e,t,n){return r.T.object({id:I,typeName:r.T.literal("shape"),x:r.T.number,y:r.T.number,rotation:r.T.number,index:r.T.string,parentId:j,type:r.T.literal(e),isLocked:r.T.boolean,opacity:y,props:t?r.T.object(t):r.T.jsonValue,meta:n?r.T.object(n):r.T.jsonValue})}let A=r.T.model("instance_page_state",r.T.object({typeName:r.T.literal("instance_page_state"),id:i("instance_page_state"),pageId:S,selectedShapeIds:r.T.arrayOf(I),hintingShapeIds:r.T.arrayOf(I),erasingShapeIds:r.T.arrayOf(I),hoveredShapeId:I.nullable(),editingShapeId:I.nullable(),croppingShapeId:I.nullable(),focusedGroupId:I.nullable(),meta:r.T.jsonValue})),O=(0,l.zn)({currentVersion:5,migrators:{1:{up:e=>({...e,croppingShapeId:null}),down:({croppingShapeId:e,...t})=>t},2:{up:({instanceId:e,cameraId:t,...n})=>n,down:e=>({...e,instanceId:T,cameraId:d.createId("void")})},3:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})},4:{up:e=>{let{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}=e;return{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}},down:e=>{let{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}=e;return{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}}},5:{up:e=>{let{selectedIds:t,hintingIds:n,erasingIds:r,hoveredId:i,editingId:o,croppingShapeId:s,croppingId:a,focusLayerId:l,...c}=e;return{...c,selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s??a??null,focusedGroupId:l}},down:e=>{let{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}=e;return{...l,selectedIds:t,hintingIds:n,erasingIds:r,hoveredId:i,editingId:o,croppingId:s,focusLayerId:a}}}}}),$=(0,l.ju)("instance_page_state",{migrations:O,validator:A,scope:"session"}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),B=r.T.model("pointer",r.T.object({typeName:r.T.literal("pointer"),id:i("pointer"),x:r.T.number,y:r.T.number,lastActivityTimestamp:r.T.number,meta:r.T.jsonValue})),D=(0,l.zn)({currentVersion:1,migrators:{1:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),L=(0,l.ju)("pointer",{validator:B,migrations:D,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),R=L.createId("pointer"),z=r.T.model("instance_presence",r.T.object({typeName:r.T.literal("instance_presence"),id:i("instance_presence"),userId:r.T.string,userName:r.T.string,lastActivityTimestamp:r.T.number,followingUserId:r.T.string.nullable(),cursor:r.T.object({x:r.T.number,y:r.T.number,type:g,rotation:r.T.number}),color:r.T.string,camera:r.T.object({x:r.T.number,y:r.T.number,z:r.T.number}),screenBounds:p,selectedShapeIds:r.T.arrayOf(i("shape")),currentPageId:i("page"),brush:p.nullable(),scribbles:r.T.arrayOf(v),chatMessage:r.T.string,meta:r.T.jsonValue})),N=(0,l.zn)({currentVersion:5,migrators:{1:{up:e=>null!==e.scribble?{...e,scribble:{...e.scribble,delay:0}}:{...e},down:e=>{if(null!==e.scribble){let{delay:t,...n}=e.scribble;return{...e,scribble:n}}return{...e}}},2:{up:({instanceId:e,...t})=>t,down:e=>({...e,instanceId:T})},3:{up:e=>({...e,chatMessage:""}),down:({chatMessage:e,...t})=>t},4:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})},5:{up:e=>{let{selectedShapeIds:t,...n}=e;return{selectedShapeIds:t,...n}},down:e=>{let{selectedShapeIds:t,...n}=e;return{selectedShapeIds:t,...n}}}}}),F=(0,l.ju)("instance_presence",{migrations:N,validator:z,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})),U=(e,t)=>n=>(0,a.Fl)("instancePresence",()=>{let r=n.get(T),i=n.get($.createId(r?.currentPageId)),o=n.get(d.createId(r?.currentPageId)),s=n.get(R),a=e.get();return i&&r&&o&&s&&a?F.create({id:t??F.createId(n.id),selectedShapeIds:i.selectedShapeIds,brush:r.brush,scribbles:r.scribbles,userId:a.id,userName:a.name,followingUserId:r.followingUserId,camera:{x:o.x,y:o.y,z:o.z},color:a.color,currentPageId:r.currentPageId,cursor:{x:s.x,y:s.y,rotation:r.cursor.rotation,type:r.cursor.type},lastActivityTimestamp:s.lastActivityTimestamp,screenBounds:r.screenBounds,chatMessage:r.chatMessage,meta:{}}):null});var V=n(2302);let H=r.T.model("document",r.T.object({typeName:r.T.literal("document"),id:r.T.literal("document:document"),gridSize:r.T.number,name:r.T.string,meta:r.T.jsonValue})),Z=(0,l.zn)({currentVersion:2,migrators:{1:{up:e=>({...e,name:""}),down:({name:e,...t})=>t},2:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),K=(0,l.ju)("document",{migrations:Z,validator:H,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),W=K.createId("document");function Y(e,t){return e.index<t.index?-1:e.index>t.index?1:0}function G(e){"asset"===e.typeName&&("src"in e&&(e.src="<redacted>"),"src"in e.props&&(e.props.src="<redacted>"))}let X=({error:e,phase:t,record:n,recordBefore:r})=>{throw(0,V.lw)(e,{tags:{origin:"store.validateRecord",storePhase:t,isExistingValidationIssue:"initialize"===t},extras:{recordBefore:r?G((0,V.v4)(r)):void 0,recordAfter:G((0,V.v4)(n))}}),e};function q(e){let t=e.query.ids("page"),n=()=>{if(!e.has(W))return e.put([K.create({id:W,name:e.props.defaultName})]),n();if(!e.has(R))return e.put([L.create({id:R})]),n();let r=t.get();if(0===r.size)return e.put([E.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]),n();let i=e.get(T);if(!i)return e.put([e.schema.types.instance.create({id:T,currentPageId:[...r].map(t=>e.get(t)).sort(Y)[0].id,exportBackground:!0})]),n();if(!r.has(i.currentPageId))return e.put([{...i,currentPageId:[...r].map(t=>e.get(t)).sort(Y)[0].id}]),n();let o=new Set,s=new Set;for(let t of r){let n=$.createId(t);e.has(n)||o.add(n);let r=d.createId(t);e.has(r)||s.add(r)}o.size>0&&e.put([...o].map(e=>$.create({id:e,pageId:$.parseId(e)}))),s.size>0&&e.put([...s].map(e=>d.create({id:e})))};return n}let J=s("bookmark",r.T.object({title:r.T.string,description:r.T.string,image:r.T.string,src:r.T.srcUrl.nullable()})),Q=(0,l.zn)({currentVersion:1,migrators:{1:{up:e=>{let t=e.props.src;return t&&!r.T.srcUrl.isValid(t)?{...e,props:{...e.props,src:""}}:e},down:e=>e}}}),ee=s("image",r.T.object({w:r.T.number,h:r.T.number,name:r.T.string,isAnimated:r.T.boolean,mimeType:r.T.string.nullable(),src:r.T.srcUrl.nullable()})),et=(0,l.zn)({currentVersion:3,migrators:{1:{up:e=>({...e,props:{...e.props,isAnimated:!1}}),down:e=>{let{isAnimated:t,...n}=e.props;return{...e,props:n}}},2:{up:e=>{let{width:t,height:n,...r}=e.props;return{...e,props:{w:t,h:n,...r}}},down:e=>{let{w:t,h:n,...r}=e.props;return{...e,props:{width:t,height:n,...r}}}},3:{up:e=>{let t=e.props.src;return t&&!r.T.srcUrl.isValid(t)?{...e,props:{...e.props,src:""}}:e},down:e=>e}}}),en=s("video",r.T.object({w:r.T.number,h:r.T.number,name:r.T.string,isAnimated:r.T.boolean,mimeType:r.T.string.nullable(),src:r.T.srcUrl.nullable()})),er=(0,l.zn)({currentVersion:3,migrators:{1:{up:e=>({...e,props:{...e.props,isAnimated:!1}}),down:e=>{let{isAnimated:t,...n}=e.props;return{...e,props:n}}},2:{up:e=>{let{width:t,height:n,...r}=e.props;return{...e,props:{w:t,h:n,...r}}},down:e=>{let{w:t,h:n,...r}=e.props;return{...e,props:{width:t,height:n,...r}}}},3:{up:e=>{let t=e.props.src;return t&&!r.T.srcUrl.isValid(t)?{...e,props:{...e.props,src:""}}:e},down:e=>e}}}),ei=r.T.model("asset",r.T.union("type",{image:ee,video:en,bookmark:J})),eo=(0,l.zn)({subTypeKey:"type",subTypeMigrations:{image:et,video:er,bookmark:Q},currentVersion:1,migrators:{1:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),es=(0,l.ju)("asset",{migrations:eo,validator:ei,scope:"document"}).withDefaultProperties(()=>({meta:{}})),ea=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((e,t)=>((t&=63)<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");class el{constructor(e,t,n){this.id=e,this.defaultValue=t,this.type=n}static define(e,t){let{defaultValue:n,type:i=r.T.any}=t;return new el(e,n,i)}static defineEnum(e,t){let{defaultValue:n,values:r}=t;return new ec(e,n,r)}validate(e){return this.type.validate(e)}}class ec extends el{constructor(e,t,n){super(e,t,r.T.literalEnum(...n)),this.values=n}}let eu=(0,l.zn)({currentVersion:3,migrators:{1:{up:e=>({...e,isLocked:!1}),down:e=>{let{isLocked:t,...n}=e;return{...n}}},2:{up:({props:{opacity:e,...t},...n})=>({...n,opacity:Number(e??"1"),props:t}),down:({opacity:e,...t})=>({...t,props:{...t.props,opacity:e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}})},3:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}});function ed(e){return!!e&&"shape"===e.typeName}function eh(e){return!!e&&e.startsWith("shape:")}function ep(e){return`shape:${e??ea()}`}function ef(e){let t=new Map;for(let[n,r]of Object.entries(e))if(r instanceof el){if(t.has(r))throw Error(`Duplicate style prop ${r.id}. Each style prop can only be used once within a shape.`);t.set(r,n)}return t}let eg=(0,l.zn)({currentVersion:4,migrators:{1:{up:e=>Object.fromEntries(Object.entries(e).filter(([e,t])=>"shape"!==t.typeName||"icon"!==t.type&&"code"!==t.type)),down:e=>e},2:{up:e=>e,down:e=>Object.fromEntries(Object.entries(e).filter(([e,t])=>"instance_presence"!==t.typeName))},3:{up:e=>Object.fromEntries(Object.entries(e).filter(([e,t])=>!t.typeName.match(/^(user|user_presence)$/))),down:e=>Object.fromEntries(Object.entries(e).filter(([e,t])=>"pointer"!==t.typeName))},4:{up:e=>Object.fromEntries(Object.entries(e).filter(([e,t])=>!t.typeName.match("user_document"))),down:e=>e}}});function em({shapes:e}){let t=new Map;for(let n of(0,V.UM)(e))for(let e of ef(n.props??{}).keys()){if(t.has(e.id)&&t.get(e.id)!==e)throw Error(`Multiple StyleProp instances with the same id: ${e.id}`);t.set(e.id,e)}let n=(0,l.ju)("shape",{migrations:(0,l.zn)({currentVersion:eu.currentVersion,firstVersion:eu.firstVersion,migrators:eu.migrators,subTypeKey:"type",subTypeMigrations:(0,V.Fm)(e,(e,t)=>t.migrations??(0,l.zn)({}))}),scope:"document",validator:r.T.model("shape",r.T.union("type",(0,V.Fm)(e,(e,{props:t,meta:n})=>M(e,t,n))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}})),o=function(e){let t={};for(let[n,i]of e)t[n]=r.T.optional(i);let n=r.T.model("instance",r.T.object({typeName:r.T.literal("instance"),id:i("instance"),currentPageId:S,followingUserId:r.T.string.nullable(),brush:p.nullable(),opacityForNextShape:y,stylesForNextShape:r.T.object(t),cursor:m,scribbles:r.T.arrayOf(v),isFocusMode:r.T.boolean,isDebugMode:r.T.boolean,isToolLocked:r.T.boolean,exportBackground:r.T.boolean,screenBounds:p,insets:r.T.arrayOf(r.T.boolean),zoomBrush:p.nullable(),isPenMode:r.T.boolean,isGridMode:r.T.boolean,chatMessage:r.T.string,isChatting:r.T.boolean,highlightedUserIds:r.T.arrayOf(r.T.string),canMoveCamera:r.T.boolean,isFocused:r.T.boolean,devicePixelRatio:r.T.number,isCoarsePointer:r.T.boolean,isHoveringCanvas:r.T.boolean.nullable(),openMenus:r.T.arrayOf(r.T.string),isChangingStyle:r.T.boolean,isReadonly:r.T.boolean,meta:r.T.jsonValue,duplicateProps:r.T.object({shapeIds:r.T.arrayOf(i("shape")),offset:r.T.object({x:r.T.number,y:r.T.number})}).nullable()}));return(0,l.ju)("instance",{migrations:P,validator:n,scope:"session"}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],canMoveCamera:!0,isFocused:!1,devicePixelRatio:"undefined"==typeof window?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null}))}(t);return l.sS.create({asset:es,camera:d,document:K,instance:o,instance_page_state:$,page:E,shape:n,instance_presence:F,pointer:L},{snapshotMigrations:eg,onValidationFailure:X,createIntegrityChecker:q})}let ey=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red"],eb={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4263eb",semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#adb5bd",semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4dabf7",semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#40c057",semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#ff8787",semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e599f7",semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#f76707",semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#ffc078",semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 8%)",solid:"#010403",black:{solid:"#e1e1e1",semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4263eb",semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#099268",semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#9398b0",semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#4dabf7",semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#40c057",semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#ff8787",semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#e599f7",semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#f76707",semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#e03131",semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#ae3ec9",semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#ffc034",semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}}}};function ew(e){return e.isDarkMode?eb.darkMode:eb.lightMode}let ex=el.defineEnum("tldraw:color",{defaultValue:"black",values:ey}),ev=el.defineEnum("tldraw:labelColor",{defaultValue:"black",values:ey}),eS=el.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),ek=el.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern"]}),e_=el.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),eE={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},eC=el.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),eP=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],eT=el.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:eP}),ej=el.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:eP}),eI=r.T.union("type",{binding:r.T.object({type:r.T.literal("binding"),boundShapeId:I,normalizedAnchor:h,isExact:r.T.boolean,isPrecise:r.T.boolean}),point:r.T.object({type:r.T.literal("point"),x:r.T.number,y:r.T.number})}),eM={labelColor:ev,color:ex,fill:ek,dash:eS,size:eC,arrowheadStart:eT,arrowheadEnd:ej,font:e_,start:eI,end:eI,bend:r.T.number,text:r.T.string,labelPosition:r.T.number},eA=(0,l.zn)({currentVersion:3,migrators:{1:{up:e=>({...e,props:{...e.props,labelColor:"black"}}),down:e=>{let{labelColor:t,...n}=e.props;return{...e,props:n}}},2:{up:e=>{let{start:t,end:n}=e.props;return{...e,props:{...e.props,start:"binding"===t.type?{...t,isPrecise:!(.5===t.normalizedAnchor.x&&.5===t.normalizedAnchor.y)}:t,end:"binding"===n.type?{...n,isPrecise:!(.5===n.normalizedAnchor.x&&.5===n.normalizedAnchor.y)}:n}}},down:e=>{let{start:t,end:n}=e.props,r={...t},i={...n};return"binding"===r.type&&(r.isPrecise||(r.normalizedAnchor={x:.5,y:.5}),delete r.isPrecise),"binding"===i.type&&(i.isPrecise||(i.normalizedAnchor={x:.5,y:.5}),delete i.isPrecise),{...e,props:{...e.props,start:r,end:i}}}},3:{up:e=>({...e,props:{...e.props,labelPosition:.5}}),down:e=>{let{labelPosition:t,...n}=e.props;return{...e,props:n}}}}}),eO={w:r.T.nonZeroNumber,h:r.T.nonZeroNumber,assetId:o.nullable(),url:r.T.linkUrl},e$=(0,l.zn)({currentVersion:2,migrators:{1:{up:e=>void 0===e.props.assetId?{...e,props:{...e.props,assetId:null}}:e,down:e=>{if(null===e.props.assetId){let{assetId:t,...n}=e.props;return{...e,props:n}}return e}},2:{up:e=>""===e.props.url||r.T.linkUrl.isValid(e.props.url)?e:{...e,props:{...e.props,url:""}},down:e=>e}}}),eB=r.T.object({type:r.T.literalEnum("free","straight"),points:r.T.arrayOf(h)}),eD={color:ex,fill:ek,dash:eS,size:eC,segments:r.T.arrayOf(eB),isComplete:r.T.boolean,isClosed:r.T.boolean,isPen:r.T.boolean},eL=(0,l.zn)({currentVersion:1,migrators:{1:{up:e=>{let{points:t}=e.props.segments[0];if(0===t.length)return{...e,props:{...e.props,isPen:!1}};let n=!(0===t[0].z||.5===t[0].z);return t[1]&&(n=n&&!(0===t[1].z||.5===t[1].z)),{...e,props:{...e.props,isPen:n}}},down:e=>{let{isPen:t,...n}=e.props;return{...e,props:{...n}}}}}});var eR=n(357);let ez=/(^\/r\/[^/]+\/?$)/,eN=e=>{try{return new URL(e)}catch(e){return}},eF=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:e=>{let t=eN(e);if(t&&t.pathname.match(ez))return e},fromEmbedUrl:e=>{let t=eN(e);if(t&&t.pathname.match(ez))return e}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:e=>{if(e.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!e.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${e}`},fromEmbedUrl:e=>{let t=eN(e);if(t&&t.pathname.match(/^\/embed\/?$/)){let e=t.searchParams.get("url");if(e)return e}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{if(e.includes("/maps/")){let t;let n=e.match(/@(.*),(.*),(.*)z/);if(n){let[,r,i,o]=n,s=new URL(e).host.replace("www.","");t=`https://${s}/maps/embed/v1/view?key=${eR.env.NEXT_PUBLIC_GC_API_KEY}&center=${r},${i}&zoom=${o}`}else t="";return t}},fromEmbedUrl:e=>{let t=eN(e);if(t&&t.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&t.searchParams.has("center")&&t.searchParams.get("zoom")){let e=t.searchParams.get("zoom"),[n,r]=t.searchParams.get("center").split(",");return`https://www.google.com/maps/@${n},${r},${e}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=eN(e),n=t&&t.pathname.match(/\/v\/([^/]+)\/?/);if(n)return`https://www.val.town/embed/${n[1]}`},fromEmbedUrl:e=>{let t=eN(e),n=t&&t.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://www.val.town/v/${n[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=eN(e),n=t&&t.pathname.match(/\/s\/([^/]+)\/?/);if(n)return`https://codesandbox.io/embed/${n[1]}`},fromEmbedUrl:e=>{let t=eN(e),n=t&&t.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://codesandbox.io/s/${n[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=e.match(/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/);if(t){let[e,n,r]=t;return`https://codepen.io/${n}/embed/${r}`}},fromEmbedUrl:e=>{let t=e.match(/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/);if(t){let[e,n,r]=t;return`https://codepen.io/${n}/pen/${r}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,canUnmount:!1,toEmbedUrl:e=>{let t=e.match(/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/);if(t){let[e,n]=t;return`https://scratch.mit.edu/projects/embed/${n}`}},fromEmbedUrl:e=>{let t=e.match(/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/);if(t){let[e,n]=t;return`https://scratch.mit.edu/projects/${n}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,canUnmount:!1,overridePermissions:{"allow-presentation":!0},isAspectRatioLocked:!0,toEmbedUrl:e=>{let t=eN(e);if(!t)return;let n=t.hostname.replace(/^www./,"");if("youtu.be"===n){let e=t.pathname.split("/").filter(Boolean)[0];return`https://www.youtube.com/embed/${e}`}if(("youtube.com"===n||"m.youtube.com"===n)&&t.pathname.match(/^\/watch/)){let e=t.searchParams.get("v");return`https://www.youtube.com/embed/${e}`}},fromEmbedUrl:e=>{let t=eN(e);if(t&&"youtube.com"===t.hostname.replace(/^www./,"")){let e=t.pathname.match(/^\/embed\/([^/]+)\/?/);if(e)return`https://www.youtube.com/watch?v=${e[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,canUnmount:!1,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",toEmbedUrl:e=>{let t=eN(e),n=t?.searchParams.get("cid");if(t?.pathname.match(/\/calendar\/u\/0/)&&n){for(let e of(t.pathname="/calendar/embed",Array.from(t.searchParams.keys())))t.searchParams.delete(e);return t.searchParams.set("src",n),t.href}},fromEmbedUrl:e=>{let t=eN(e),n=t?.searchParams.get("src");if(t?.pathname.match(/\/calendar\/embed/)&&n){for(let e of(t.pathname="/calendar/u/0",Array.from(t.searchParams.keys())))t.searchParams.delete(e);return t.searchParams.set("cid",n),t.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=eN(e);if(t?.pathname.match(/^\/presentation/)&&t?.pathname.match(/\/pub\/?$/)){for(let e of(t.pathname=t.pathname.replace(/\/pub$/,"/embed"),Array.from(t.searchParams.keys())))t.searchParams.delete(e);return t.href}},fromEmbedUrl:e=>{let t=eN(e);if(t?.pathname.match(/^\/presentation/)&&t?.pathname.match(/\/embed\/?$/)){for(let e of(t.pathname=t.pathname.replace(/\/embed$/,"/pub"),Array.from(t.searchParams.keys())))t.searchParams.delete(e);return t.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:e=>{let t=eN(e);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/)){if(!e.split("/").pop())return;return e}},fromEmbedUrl:e=>{let t=eN(e);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/)){if(!e.split("/").pop())return;return e}}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=eN(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${e}?embed=true`},fromEmbedUrl:e=>{let t=eN(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/)&&t.searchParams.has("embed"))return t.searchParams.delete("embed"),t.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=eN(e);if(t&&t.pathname.match(/^\/map\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:e=>{let t=eN(e);if(t&&t.pathname.match(/^\/embed\/map\//))return t.pathname=t.pathname.replace(/^\/embed/,""),t.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=eN(e);if(t&&t.pathname.match(/^\/(artist|album)\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:e=>{let t=eN(e);if(t&&t.pathname.match(/^\/embed\/(artist|album)\//))return t.origin+t.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!0,toEmbedUrl:e=>{let t=eN(e);if(t&&"vimeo.com"===t.hostname&&t.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+t.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:e=>{let t=eN(e);if(t&&"player.vimeo.com"===t.hostname){let e=t.pathname.match(/^\/video\/([^/]+)\/?$/);if(e)return"https://vimeo.com/"+e[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!0,toEmbedUrl:e=>{let t=eN(e);if(t&&t.hash.match(/#room=/))return e},fromEmbedUrl:e=>{let t=eN(e);if(t&&t.hash.match(/#room=/))return e}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:e=>{let t=eN(e);if(t&&t.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${t.origin}/embed${t.pathname}?cell=*`;if(t&&t.pathname.match(/^\/d\/([^/]+)\/?$/)){let e=t.pathname.replace(/^\/d/,"");return`${t.origin}/embed${e}?cell=*`}},fromEmbedUrl:e=>{let t=eN(e);return t&&t.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/)?`${t.origin}${t.pathname.replace("/embed","")}#cell-*`:t&&t.pathname.match(/^\/embed\/([^/]+)\/?$/)?`${t.origin}${t.pathname.replace("/embed","/d")}#cell-*`:void 0}}],eU={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},eV={w:r.T.nonZeroNumber,h:r.T.nonZeroNumber,url:r.T.string},eH=(0,l.zn)({currentVersion:4,migrators:{1:{up:e=>{let t;let n=e.props.url,r=new URL(n).host.replace("www.","");for(let e of eF)if(e.hostnames.includes(r))try{t=e.fromEmbedUrl(n)}catch(e){console.warn(e)}return{...e,props:{...e.props,tmpOldUrl:e.props.url,url:t??""}}},down:e=>{let t=e.props.tmpOldUrl;if(!t||""===t){let n=e.props.url,r=new URL(n).host.replace("www.","");for(let e of eF)if(e.hostnames.includes(r))try{t=e.toEmbedUrl(n)}catch(e){console.warn(e)}}let{tmpOldUrl:n,...r}=e.props;return{...e,props:{...r,url:t??""}}}},2:{up:e=>{let{doesResize:t,...n}=e.props;return{...e,props:{...n}}},down:e=>({...e,props:{...e.props,doesResize:!0}})},3:{up:e=>{let{tmpOldUrl:t,...n}=e.props;return{...e,props:{...n}}},down:e=>({...e,props:{...e.props}})},4:{up:e=>{let{overridePermissions:t,...n}=e.props;return{...e,props:{...n}}},down:e=>({...e,props:{...e.props}})}}}),eZ={w:r.T.nonZeroNumber,h:r.T.nonZeroNumber,name:r.T.string},eK=(0,l.zn)({}),eW=el.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),eY=el.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),eG=el.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box"]}),eX={geo:eG,labelColor:ev,color:ex,fill:ek,dash:eS,size:eC,font:e_,align:eW,verticalAlign:eY,url:r.T.linkUrl,w:r.T.nonZeroNumber,h:r.T.nonZeroNumber,growY:r.T.positiveNumber,text:r.T.string},eq=(0,l.zn)({currentVersion:8,migrators:{1:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{let{url:t,...n}=e.props;return{...e,props:n}}},2:{up:e=>({...e,props:{...e.props,labelColor:"black"}}),down:e=>{let{labelColor:t,...n}=e.props;return{...e,props:n}}},3:{up:e=>{let t=e.props.align;return"justify"===t&&(t="start"),{...e,props:{...e.props,align:t}}},down:e=>({...e})},4:{up:e=>({...e}),down:e=>({...e,props:{...e.props,geo:"check-box"===e.props.geo?"rectangle":e.props.geo}})},5:{up:e=>({...e,props:{...e.props,verticalAlign:"middle"}}),down:e=>{let{verticalAlign:t,...n}=e.props;return{...e,props:n}}},6:{up:e=>{let t;switch(e.props.align){case"start":t="start-legacy";break;case"end":t="end-legacy";break;default:t="middle-legacy"}return{...e,props:{...e.props,align:t}}},down:e=>{let t;switch(e.props.align){case"start-legacy":t="start";break;case"end-legacy":t="end";break;case"middle-legacy":t="middle";break;default:t=e.props.align}return{...e,props:{...e.props,align:t}}}},7:{up:e=>e,down:e=>{if("cloud"===e.props.geo)return{...e,props:{...e.props,geo:"rectangle"}}}},8:{up:e=>""===e.props.url||r.T.linkUrl.isValid(e.props.url)?e:{...e,props:{...e.props,url:""}},down:e=>e}}}),eJ={},eQ=(0,l.zn)({}),e0={color:ex,size:eC,segments:r.T.arrayOf(eB),isComplete:r.T.boolean,isPen:r.T.boolean},e1=(0,l.zn)({}),e2=r.T.object({topLeft:h,bottomRight:h}),e5={w:r.T.nonZeroNumber,h:r.T.nonZeroNumber,playing:r.T.boolean,url:r.T.linkUrl,assetId:o.nullable(),crop:e2.nullable()},e3=(0,l.zn)({currentVersion:3,migrators:{1:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{let{url:t,...n}=e.props;return{...e,props:n}}},2:{up:e=>({...e,props:{...e.props,crop:null}}),down:e=>{let{crop:t,...n}=e.props;return{...e,props:n}}},3:{up:e=>""===e.props.url||r.T.linkUrl.isValid(e.props.url)?e:{...e,props:{...e.props,url:""}},down:e=>e}}}),e8=new Set(["vertex","virtual","create"]),e4=r.T.object({id:r.T.string,type:r.T.setEnum(e8),canBind:r.T.boolean.optional(),canSnap:r.T.boolean.optional(),index:r.T.string,x:r.T.number,y:r.T.number}),e6=el.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),e9={color:ex,dash:eS,size:eC,spline:e6,handles:r.T.dict(r.T.string,e4)},e7=(0,l.zn)({currentVersion:1,migrators:{1:{up:e=>{let t=(0,V.p$)(e.props.handles);for(let e in t)t[e].canSnap=!0;return{...e,props:{...e.props,handles:t}}},down:e=>{let t=(0,V.p$)(e.props.handles);for(let e in t)delete t[e].canSnap;return{...e,props:{...e.props,handles:t}}}}}}),te={color:ex,size:eC,font:e_,align:eW,verticalAlign:eY,growY:r.T.positiveNumber,url:r.T.linkUrl,text:r.T.string},tt=(0,l.zn)({currentVersion:5,migrators:{1:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{let{url:t,...n}=e.props;return{...e,props:n}}},2:{up:e=>{let t=e.props.align;return"justify"===t&&(t="start"),{...e,props:{...e.props,align:t}}},down:e=>({...e})},3:{up:e=>{let t;switch(e.props.align){case"start":t="start-legacy";break;case"end":t="end-legacy";break;default:t="middle-legacy"}return{...e,props:{...e.props,align:t}}},down:e=>{let t;switch(e.props.align){case"start-legacy":t="start";break;case"end-legacy":t="end";break;case"middle-legacy":t="middle";break;default:t=e.props.align}return{...e,props:{...e.props,align:t}}}},4:{up:e=>({...e,props:{...e.props,verticalAlign:"middle"}}),down:e=>{let{verticalAlign:t,...n}=e.props;return{...e,props:n}}},5:{up:e=>""===e.props.url||r.T.linkUrl.isValid(e.props.url)?e:{...e,props:{...e.props,url:""}},down:e=>e}}}),tn={color:ex,size:eC,font:e_,align:eW,w:r.T.nonZeroNumber,text:r.T.string,scale:r.T.nonZeroNumber,autoSize:r.T.boolean},tr=(0,l.zn)({currentVersion:1,migrators:{1:{up:e=>{let t=e.props.align;return"justify"===t&&(t="start"),{...e,props:{...e.props,align:t}}},down:e=>({...e})}}}),ti={w:r.T.nonZeroNumber,h:r.T.nonZeroNumber,time:r.T.number,playing:r.T.boolean,url:r.T.linkUrl,assetId:o.nullable()},to=(0,l.zn)({currentVersion:2,migrators:{1:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{let{url:t,...n}=e.props;return{...e,props:n}}},2:{up:e=>""===e.props.url||r.T.linkUrl.isValid(e.props.url)?e:{...e,props:{...e.props,url:""}},down:e=>e}}}),ts=[{locale:"ca",label:"Catal\xe0"},{locale:"cs",label:"etina"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Espa\xf1ol"},{locale:"fr",label:"Fran\xe7ais"},{locale:"gl",label:"Galego"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Portugu\xeas - Brasil"},{locale:"pt-pt",label:"Portugu\xeas - Europeu"},{locale:"ro",label:"Rom\xe2n"},{locale:"ru",label:"Russian"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Ting Vit"},{locale:"tr",label:"T\xfcrk\xe7e"},{locale:"uk",label:"Ukrainian"},{locale:"he",label:""},{locale:"ar",label:""},{locale:"fa",label:""},{locale:"ku",label:""},{locale:"ne",label:""},{locale:"hi-in",label:""},{locale:"te",label:""},{locale:"th",label:""},{locale:"my",label:""},{locale:"ko-kr",label:""},{locale:"ja",label:""},{locale:"zh-cn",label:""},{locale:"zh-tw",label:" ()"}];function ta(){return function(e){for(let t of e){let e=function(e){let t=ts.find(t=>t.locale===e.toLowerCase());if(t)return t.locale;let[n,r]=e.split(/[-_]/).map(e=>e.toLowerCase());if(r){let e=ts.find(e=>e.locale===n);if(e)return e.locale}return n in tl?tl[n]:null}(t);if(e)return e}return"en"}("undefined"!=typeof window?window.navigator.languages??["en"]:["en"])}let tl={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"}},2302:function(e,t,n){"use strict";let r;function i(e,t){return e.map((n,r)=>e[(r+t)%e.length])}function o(e,t){let n=[];t:for(let r of e){for(let e of n)if(t?t(r,e):r===e)continue t;n.push(r)}return n}function s(e){return e.filter(e=>null!=e)}function a(e){return e[e.length-1]}function l(e,t){let n;let r=1/0;for(let i of e){let e=t(i);e<r&&(n=i,r=e)}return n}function c(e,t){let n=[],r=[];for(let i of e)t(i)?n.push(i):r.push(i);return[n,r]}function u(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Object.is(e[n],t[n]))return!1;return!0}function d(e,t){let n,r;return function(...i){return n||(n=!0,setTimeout(()=>n=!1,t),r=e(...i)),r}}function h(e){let t=(...n)=>{try{return e(...n)}catch(e){throw e instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(e,t),e}};return t}function p(){}n.d(t,{P6:function(){return k},xe:function(){return A},bM:function(){return M},x4:function(){return f},lw:function(){return v},E8:function(){return u},dn:function(){return H},hu:function(){return m},kP:function(){return y},oA:function(){return s},Ds:function(){return w},D8:function(){return o},p$:function(){return function e(t){if(!t)return t;if(Array.isArray(t)){let n=[],r=t.length;for(let i=0;i<r;i++)n.push(e(t[i]));return n}if("object"==typeof t){let n=Object.keys(t),r=n.length,i={};for(let o=0;o<r;o++){let r=n[o];i[r]=e(t[r])}return i}return t}},iP:function(){return g},H4:function(){return U},wi:function(){return S},lr:function(){return T},Aq:function(){return C},pT:function(){return E},jK:function(){return _},eg:function(){return L},nr:function(){return D},$K:function(){return Q},GT:function(){return ee},cF:function(){return et},Z$:function(){return a},t7:function(){return O},L8:function(){return P},Fm:function(){return V},F:function(){return l},vm:function(){return B},ZT:function(){return p},EP:function(){return N},Ls:function(){return F},GH:function(){return R},UM:function(){return z},fP:function(){return h},uK:function(){return c},un:function(){return b},TE:function(){return X},Vk:function(){return $},R8:function(){return i},uv:function(){return J},v4:function(){return en},P2:function(){return d},xP:function(){return q},q4:function(){return ei}});let f={ok:e=>({ok:!0,value:e}),err:e=>({ok:!1,error:e})};function g(e,t){let n=t&&e&&"object"==typeof e&&t in e?e[t]:e;throw Error(`Unknown switch case ${n}`)}let m=h((e,t)=>{if(!e)throw Error(t||"Assertion Error")}),y=h((e,t)=>{if(null==e)throw Error(t??"value must be defined");return e});function b(){let e,t;return Object.assign(new Promise((n,r)=>{e=n,t=r}),{resolve:e,reject:t})}function w(e,t){let n;let r=(...r)=>(n||((n={}).promise=new Promise((e,t)=>{n.resolve=e,n.reject=t})),clearTimeout(n.timeout),n.latestArgs=r,n.timeout=setTimeout(()=>{let t=n;n=void 0;try{t.resolve(e(...t.latestArgs))}catch(e){t.reject(e)}},t),n.promise);return r.cancel=()=>{n&&clearTimeout(n.timeout)},r}let x=new WeakMap;function v(e,t){if("object"!=typeof e||null===e)return;let n=x.get(e);n||(n={tags:{},extras:{}},x.set(e,n)),t.tags&&(n.tags={...n.tags,...t.tags}),t.extras&&(n.extras={...n.extras,...t.extras})}function S(e){return x.get(e)??{tags:{},extras:{}}}class k{static async base64ToFile(e){return fetch(e).then(function(e){return e.arrayBuffer()})}static async fileToBase64(e){return await new Promise((t,n)=>{if(e){let r=new FileReader;r.readAsDataURL(e),r.onload=()=>t(r.result),r.onerror=e=>n(e),r.onabort=e=>n(e)}})}}function _(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)|0;return t+""}function E(e){return _(JSON.stringify(e))}function C(e){let t=new DataView(e),n=0;for(let e=0;e<t.byteLength;e++)n=(n<<5)-n+t.getUint8(e)|0;return n+""}function P(e){let t=e.split("");return t.push(...t.splice(0,Math.round(t.length/5))),t.push(...t.splice(0,Math.round(t.length/4))),t.push(...t.splice(0,Math.round(t.length/3))),t.push(...t.splice(0,Math.round(t.length/2))),t.reverse().map(e=>+e?5>+e?5+ +e:+e>5?+e-5:e:e).join("")}function T(e){return e.values().next().value}let j=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];"undefined"!=typeof Int32Array&&(j=new Int32Array(j));let I=(e,t)=>{let n=0===t?0:-1^~~t;for(let t=0;t<e.length;t++)n=j[(n^e[t])&255]^n>>>8;return -1^n};class M{static isPng(e,t){return 137===e.getUint8(t+0)&&80===e.getUint8(t+1)&&78===e.getUint8(t+2)&&71===e.getUint8(t+3)&&13===e.getUint8(t+4)&&10===e.getUint8(t+5)&&26===e.getUint8(t+6)&&10===e.getUint8(t+7)}static getChunkType(e,t){return[String.fromCharCode(e.getUint8(t)),String.fromCharCode(e.getUint8(t+1)),String.fromCharCode(e.getUint8(t+2)),String.fromCharCode(e.getUint8(t+3))].join("")}static readChunks(e,t=0){let n={};if(!M.isPng(e,t))throw Error("Not a PNG");for(t+=8;t<=e.buffer.byteLength;){let r=t,i=e.getInt32(t);t+=4;let o=M.getChunkType(e,t);if("IDAT"===o&&n[o]){t+=i+4+4;continue}if("IEND"===o)break;n[o]={start:r,dataOffset:t+4,size:i},t+=i+4+4}return n}static parsePhys(e,t){return{ppux:e.getUint32(t),ppuy:e.getUint32(t+4),unit:e.getUint8(t+4)}}static findChunk(e,t){return M.readChunks(e)[t]}static setPhysChunk(e,t=1,n){let r=46,i=0,o=M.findChunk(e,"pHYs");o&&(r=o.start,i=o.size);let s=M.findChunk(e,"IDAT");s&&(r=s.start,i=0);let a=new ArrayBuffer(21),l=new DataView(a);l.setUint32(0,9),l.setUint8(4,112),l.setUint8(5,72),l.setUint8(6,89),l.setUint8(7,115),l.setInt32(8,2835.5*t),l.setInt32(12,2835.5*t),l.setInt8(16,1);let c=new Uint8Array(a.slice(4,17));return l.setInt32(17,I(c)),new Blob([e.buffer.slice(0,r),a,e.buffer.slice(r+i)],n)}}class A{static loadVideo(e){return new Promise((t,n)=>{let r=document.createElement("video");r.onloadeddata=()=>t(r),r.onerror=e=>{console.error(e),n(Error("Could not load video"))},r.crossOrigin="anonymous",r.src=e})}static loadImage(e){return new Promise((t,n)=>{let r=new Image;r.onload=()=>t(r),r.onerror=e=>{console.error(e),n(Error("Could not load image"))},r.crossOrigin="anonymous",r.src=e})}static blobToDataUrl(e){return new Promise((t,n)=>{let r=new FileReader;r.onload=()=>t(r.result),r.onerror=e=>{console.error(e),n(Error("Could not read blob"))},r.readAsDataURL(e)})}static async getVideoSize(e){return A.usingObjectURL(e,async e=>{let t=await A.loadVideo(e);return{w:t.videoWidth,h:t.videoHeight}})}static async getImageSize(e){let t=await A.usingObjectURL(e,A.loadImage);try{if("image/png"===e.type){let n=new DataView(await e.arrayBuffer());if(M.isPng(n,0)){let e=M.findChunk(n,"pHYs");if(e){let r=M.parsePhys(n,e.dataOffset);if(0===r.unit&&r.ppux===r.ppuy){let e=Math.max(r.ppux/2834.5,1);return{w:Math.round(t.naturalWidth/e),h:Math.round(t.naturalHeight/e)}}}}}}catch(e){console.error(e)}return{w:t.naturalWidth,h:t.naturalHeight}}static async usingObjectURL(e,t){let n=URL.createObjectURL(e);try{return await t(n)}finally{URL.revokeObjectURL(n)}}}function O(e,t,n){return e+(t-e)*n}function $(e=""){let t=0,n=0,r=0,i=0;function o(){let e=t^t<<11;return t=n,n=r,r=i,(i^=(i>>>19^e^e>>>8)>>>0)/4294967296*2}for(let n=0;n<e.length+64;n++)t^=0|e.charCodeAt(n),o();return o}function B(e,t,n,r=!1){let[i,o]=t,[s,a]=n,l=s+(e-i)/(o-i)*(a-s);return r?s<a?Math.max(Math.min(l,a),s):Math.max(Math.min(l,s),a):l}function D(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function L(e,t){if(D(e,t))return e[t]}function R(e){return Object.keys(e)}function z(e){return Object.values(e)}function N(e){return Object.entries(e)}function F(e){return Object.fromEntries(e)}function U(e,t){let n={},r=!1;for(let[i,o]of N(e))t(i,o)?n[i]=o:r=!0;return r?n:e}function V(e,t){let n={};for(let[r,i]of N(e)){let e=t(r,i);n[r]=e}return n}function H(e,t){if(e===t)return!0;let n=new Set(Object.keys(e)),r=new Set(Object.keys(t));if(n.size!==r.size)return!1;for(let i of n)if(!r.has(i)||!Object.is(e[i],t[i]))return!1;return!0}var Z=n(357);let K=()=>void 0!==Z&&!1,W=[],Y=()=>{for(let e of W.splice(0,W.length))e()};function G(){r||(r=requestAnimationFrame(()=>{r=void 0,Y()}))}function X(e){return K()?e:()=>{W.includes(e)||(W.push(e),G())}}function q(e){if(K())return e();W.includes(e)||(W.push(e),G())}function J(e,t){return e.id>t.id?1:-1}function Q(e){return void 0!==e}function ee(e){return null!==e}function et(e){return null!=e}let en="undefined"!=typeof window&&window.structuredClone?window.structuredClone:e=>e?JSON.parse(JSON.stringify(e)):e,er=new Set;function ei(e){er.has(e)||(er.add(e),console.warn(`Using '${e}' is deprecated and will be removed in the near future. Please refactor to use 'get${e[0].toLocaleUpperCase()}${e.slice(1)}' instead.`))}},477:function(e,t,n){"use strict";n.d(t,{UR:function(){return c},oy:function(){return h},kx:function(){return u},T:function(){return r},zr:function(){return d},cX:function(){return l}});var r={};n.r(r),n.d(r,{ArrayOfValidator:function(){return c},DictValidator:function(){return h},ObjectValidator:function(){return u},UnionValidator:function(){return d},ValidationError:function(){return o},Validator:function(){return l},any:function(){return g},array:function(){return C},arrayOf:function(){return P},bigint:function(){return _},boolean:function(){return k},dict:function(){return A},integer:function(){return x},jsonDict:function(){return M},jsonValue:function(){return I},linkUrl:function(){return F},literal:function(){return E},literalEnum:function(){return R},model:function(){return $},nonZeroInteger:function(){return S},nonZeroNumber:function(){return w},nullable:function(){return L},number:function(){return y},object:function(){return j},optional:function(){return D},positiveInteger:function(){return v},positiveNumber:function(){return b},setEnum:function(){return B},srcUrl:function(){return V},string:function(){return m},union:function(){return O},unknown:function(){return f},unknownObject:function(){return T}});var i=n(2302);class o extends Error{constructor(e,t=[]){let n=function(e){if(!e.length)return null;let t="";for(let n of e)"number"==typeof n?t+=`.${n}`:n.startsWith("(")?t.endsWith(")")?t=`${t.slice(0,-1)}, ${n.slice(1)}`:t+=n:t+=`.${n}`;return t.startsWith(".")?t.slice(1):t}(t),r=e.split("\n").map((e,t)=>0===t?e:`  ${e}`).join("\n");super(t?`At ${n}: ${r}`:r),this.rawMessage=e,this.path=t}name="ValidationError"}function s(e,t){try{return t()}catch(t){if(t instanceof o)throw new o(t.rawMessage,[e,...t.path]);throw new o(t.toString(),[e])}}function a(e){if(null===e)return"null";if(Array.isArray(e))return"an array";let t=typeof e;switch(t){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${t}`;case"object":return`an ${t}`;case"undefined":return"undefined";default:(0,i.iP)(t)}}class l{constructor(e){this.validationFn=e}validate(e){return this.validationFn(e)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){return L(this)}optional(){return D(this)}refine(e){return new l(t=>e(this.validate(t)))}check(e,t){return"string"==typeof e?this.refine(n=>(s(`(check ${e})`,()=>t(n)),n)):this.refine(t=>(e(t),t))}}class c extends l{constructor(e){super(t=>{let n=C.validate(t);for(let t=0;t<n.length;t++)s(t,()=>e.validate(n[t]));return n}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(0===e.length)throw new o("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new o("Expected an array with length greater than 1")})}}class u extends l{constructor(e,t=!1){super(n=>{if("object"!=typeof n||null===n)throw new o(`Expected object, got ${a(n)}`);for(let[t,r]of Object.entries(e))s(t,()=>{r.validate((0,i.eg)(n,t))});if(!t){for(let t of Object.keys(n))if(!(0,i.nr)(e,t))throw new o("Unexpected property",[t])}return n}),this.config=e,this.shouldAllowUnknownProperties=t}allowUnknownProperties(){return new u(this.config,!0)}extend(e){return new u({...this.config,...e})}}class d extends l{constructor(e,t,n){super(n=>{if("object"!=typeof n||null===n)throw new o(`Expected an object, got ${a(n)}`,[]);let r=(0,i.eg)(n,e);if("string"!=typeof r)throw new o(`Expected a string for key "${e}", got ${a(r)}`);let l=(0,i.nr)(t,r)?t[r]:void 0;return void 0===l?this.unknownValueValidation(n,r):s(`(${e} = ${r})`,()=>l.validate(n))}),this.key=e,this.config=t,this.unknownValueValidation=n}validateUnknownVariants(e){return new d(this.key,this.config,e)}}class h extends l{constructor(e,t){super(n=>{if("object"!=typeof n||null===n)throw new o(`Expected object, got ${a(n)}`);for(let[r,i]of Object.entries(n))s(r,()=>{e.validate(r),t.validate(i)});return n}),this.keyValidator=e,this.valueValidator=t}}function p(e){return new l(t=>{if(typeof t!==e)throw new o(`Expected ${e}, got ${a(t)}`);return t})}let f=new l(e=>e),g=new l(e=>e),m=p("string"),y=p("number").check(e=>{if(Number.isNaN(e))throw new o("Expected a number, got NaN");if(!Number.isFinite(e))throw new o(`Expected a finite number, got ${e}`)}),b=y.check(e=>{if(e<0)throw new o(`Expected a positive number, got ${e}`)}),w=y.check(e=>{if(e<=0)throw new o(`Expected a non-zero positive number, got ${e}`)}),x=y.check(e=>{if(!Number.isInteger(e))throw new o(`Expected an integer, got ${e}`)}),v=x.check(e=>{if(e<0)throw new o(`Expected a positive integer, got ${e}`)}),S=x.check(e=>{if(e<=0)throw new o(`Expected a non-zero positive integer, got ${e}`)}),k=p("boolean"),_=p("bigint");function E(e){return new l(t=>{if(t!==e)throw new o(`Expected ${e}, got ${JSON.stringify(t)}`);return e})}let C=new l(e=>{if(!Array.isArray(e))throw new o(`Expected an array, got ${a(e)}`);return e});function P(e){return new c(e)}let T=new l(e=>{if("object"!=typeof e||null===e)throw new o(`Expected object, got ${a(e)}`);return e});function j(e){return new u(e)}let I=new l(e=>{if(function e(t){return null===t||"number"==typeof t||"string"==typeof t||"boolean"==typeof t||(Array.isArray(t)?t.every(e):"object"==typeof t&&Object.values(t).every(e))}(e))return e;throw new o(`Expected json serializable value, got ${typeof e}`)});function M(){return A(m,I)}function A(e,t){return new h(e,t)}function O(e,t){return new d(e,t,(n,r)=>{throw new o(`Expected one of ${Object.keys(t).map(e=>JSON.stringify(e)).join(" or ")}, got ${JSON.stringify(r)}`,[e])})}function $(e,t){return new l(n=>s(n&&"object"==typeof n&&"id"in n&&"string"==typeof n.id?`${e}(id = ${n.id})`:e,()=>t.validate(n)))}function B(e){return new l(t=>{if(!e.has(t)){let n=Array.from(e,e=>JSON.stringify(e)).join(" or ");throw new o(`Expected ${n}, got ${t}`)}return t})}function D(e){return new l(t=>{if(void 0!==t)return e.validate(t)})}function L(e){return new l(t=>null===t?null:e.validate(t))}function R(...e){return B(new Set(e))}function z(e){try{return new URL(e)}catch(t){if(e.startsWith("/")||e.startsWith("./"))try{return new URL(e,"http://example.com")}catch(e){}throw new o(`Expected a valid url, got ${JSON.stringify(e)}`)}}let N=new Set(["http:","https:","mailto:"]),F=m.check(e=>{if(""===e)return;let t=z(e);if(!N.has(t.protocol.toLowerCase()))throw new o(`Expected a valid url, got ${JSON.stringify(e)} (invalid protocol)`)}),U=new Set(["http:","https:","data:"]),V=m.check(e=>{if(""===e)return;let t=z(e);if(!U.has(t.protocol.toLowerCase()))throw new o(`Expected a valid url, got ${JSON.stringify(e)} (invalid protocol)`)})}}]);